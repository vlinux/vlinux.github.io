<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script>!function(){var t=localStorage.getItem("valaxy-locale")||"zh-CN";document.documentElement.setAttribute("lang",t)}()</script><script type="module" async="" crossorigin="" src="/assets/app.ac7ba69f.js"></script><style>@charset "UTF-8";.back-to-top{position:fixed;right:-1.5rem;bottom:1rem;z-index:var(--yun-z-go-up-btn);opacity:0;pointer-events:none;color:var(--va-c-primary);transform:translate(0) rotate(270deg);transition:transform var(--va-transition-duration),opacity var(--va-transition-duration-fast)!important}.progress-circle{transition:.3s stroke-dashoffset;transform:rotate(-90deg);transform-origin:50% 50%}.progress-circle-container{position:absolute}.menu-btn{display:inline-flex;position:fixed;left:.8rem;top:.6rem;line-height:1;z-index:var(--yun-z-menu-btn);cursor:pointer}.sidebar .links{display:flex;justify-content:center}.sidebar .link-item{display:inline-flex}.sidebar .link-item .icon{width:2rem;height:2rem}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author .icon{width:1.5rem;height:1.5rem}.links-of-author-item{line-height:1;font-size:.9rem}.site-nav{display:flex;justify-content:center;overflow:hidden;line-height:1.5;white-space:nowrap;text-align:center;margin-top:1rem}.site-link-item{display:flex;padding:0 15px;align-items:center;border-left:1px solid var(--va-c-gray);flex-direction:column;color:var(--va-c-text)}.site-link-item:first-child,.site-link-item:last-child{line-height:1;padding:0}.site-link-item:first-child{border-left:none;border-right:1px solid var(--va-c-gray)}.site-link-item:last-child{border-left:1px solid var(--va-c-gray)}.site-link-item:nth-child(2){border:none}.site-link-item .count{color:var(--va-c-text);font-family:var(--va-font-sans);display:block;text-align:center;font-size:1rem}.site-link-item .icon{width:1.5rem;height:1.5rem}.site-link-item .icon:hover{color:var(--va-c-primary-light)}.sidebar-panel{padding:.5rem}.site-author-avatar{display:inline-block;line-height:0;position:relative}.site-author-avatar img{height:96px;width:96px;max-width:100%;margin:0;padding:4px;background-color:#fff;box-shadow:0 0 10px #0003;transition:.4s}.site-author-avatar img:hover{box-shadow:0 0 30px rgba(var(--va-c-primary-rgb),.2)}.site-author-name{margin-top:0;margin-bottom:1rem;line-height:1.5}.site-author-status{position:absolute;height:1.8rem;width:1.8rem;bottom:0;right:0;line-height:1.8rem;border-radius:50%;box-shadow:0 1px 2px #0003;background-color:var(--va-c-bg-light);border:1px solid rgba(255,255,255,.1)}.site-name{color:var(--va-c-text);font-family:var(--va-font-serif);font-weight:900}.site-subtitle{color:var(--va-c-gray);display:block}.site-description{color:var(--va-c-text);font-size:.8rem}.va-bg{position:fixed;width:100%;height:100%;z-index:-1;background-image:var(--va-bg-image);background-size:cover;background-position:center;background-repeat:no-repeat;animation-name:bgFadeIn;animation-duration:2s;opacity:var(--va-bg-img-opacity,1)}@keyframes bgFadeIn{0%{opacity:0}to{opacity:var(--va-bg-img-opacity,1)}}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}h1,h2,h3,h4{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,textarea{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=button],button{-webkit-appearance:button;background-color:transparent;background-image:none}blockquote,h1,h2,h3,h4,hr,p,pre{margin:0}ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button{cursor:pointer}img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}body{counter-reset:katexEqnNo mmlEqnNo}html{-webkit-tap-highlight-color:transparent}a{color:var(--va-c-link);font-weight:500}*{outline:0}hr{opacity:.2;margin:1rem}.va-card{background-color:var(--va-c-bg-light)}#app,body,html{margin:0;padding:0;line-height:2}body{background-color:var(--va-c-bg)}@media screen and (max-width:640px){.markdown-body div[class*=language-]{margin:0 -1rem}}@media (min-width:640px){.markdown-body div[class*=language-]{border-radius:6px;margin:16px 0}}@media (max-width:639px){.markdown-body li div[class*=language-]{border-radius:6px 0 0 6px}}.markdown-body code{font-size:.85em}.markdown-body div[class*=language-]{position:relative;background-color:var(--va-code-block-bg);overflow-x:auto}.markdown-body div[class*=language-] code{padding:0 24px;line-height:var(--va-code-line-height);font-size:var(--va-code-font-size);color:var(--va-code-block-color);transition:color .5s;width:fit-content;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}.markdown-body div[class*=language-] pre{position:relative;z-index:1;margin:0;padding:1rem 0;background:0 0;overflow-x:auto}.markdown-body div[class*=language-] pre code{display:block}.markdown-body [class*=language-]>span.copy{position:absolute;top:8px;right:8px;z-index:2;display:block;justify-content:center;align-items:center;border-radius:4px;width:40px;height:40px;background-color:var(--va-code-block-bg);opacity:0;cursor:pointer;background-image:var(--va-icon-copy);background-position:50%;background-size:20px;background-repeat:no-repeat;transition:opacity .25s}.markdown-body [class*=language-]:hover>span.copy{opacity:1}.markdown-body [class*=language-]>span.copy:hover{background-color:var(--va-code-copy-code-hover-bg)}.markdown-body [class*=language-]:before{position:absolute;top:6px;right:12px;z-index:2;font-size:12px;font-weight:500;color:var(--va-c-text-dark-3);transition:color .5s,opacity .5s}.markdown-body [class*=language-]:hover:before{opacity:0}:root{--va-c-text-warning:#544500}.vt-hamburger{display:flex;justify-content:center;align-items:center}.vt-hamburger:hover .vt-hamburger-top{transform:translate(-5.5px)}.vt-hamburger:hover .vt-hamburger-middle{transform:translate(0)}.vt-hamburger:hover .vt-hamburger-bottom{transform:translate(-11px)}.vt-hamburger-container{position:relative;width:22px;height:20px;overflow:hidden}.vt-hamburger-bottom,.vt-hamburger-middle,.vt-hamburger-top{left:0;position:absolute;width:22px;height:2px;background-color:var(--va-c-primary);transition:top .25s,background-color .5s,transform .25s}.vt-hamburger-top{top:0;transform:translate(0)}.vt-hamburger-middle{top:9px;transform:translate(-11px)}.vt-hamburger-bottom{top:18px;transform:translate(-5.5px)}.sidebar{position:fixed;overflow-y:auto;top:0;bottom:0;left:0;width:calc(100vw - 64px);max-width:var(--va-sidebar-width);background-image:var(--yun-sidebar-bg-image);background-color:var(--yun-sidebar-bg-color);background-size:contain;background-repeat:no-repeat;background-position:bottom 1rem center;text-align:center;z-index:var(--yun-z-sidebar);transform:translate(-100%);transition:box-shadow var(--va-transition-duration),background-color var(--va-transition-duration),opacity .25s,transform var(--va-transition-duration) cubic-bezier(.19,1,.22,1)!important}h1:focus .header-anchor,h1:hover .header-anchor,h2:focus .header-anchor,h2:hover .header-anchor,h3:focus .header-anchor,h3:hover .header-anchor,h4:focus .header-anchor,h4:hover .header-anchor{visibility:visible;opacity:1}a.header-anchor{float:left;margin-top:.125em;margin-left:-.87em;padding-right:.23em;font-size:.85em;visibility:hidden;opacity:0;transition:opacity var(--va-transition-duration)}a.header-anchor:before{content:none}a.header-anchor:focus,a.header-anchor:hover{text-decoration:none}:root{--va-sidebar-width:320px;--va-border-width:1px;--va-font-sans:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;--va-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace;--va-font-serif:"Noto Serif SC",STZhongsong,STKaiti,KaiTi,Roboto,serif;--va-transition-duration-fast:.2s;--va-transition-duration:.4s;--va-transition-duration-slow:.6s;--va-transition:all var(--va-transition-duration-fast) ease-in-out}:root{--va-c-white:#ffffff;--va-c-black:#1a1a1a;--va-c-gray:#8e8e8e;--va-c-danger:#db2828;--va-c-warning:#f2711c;--va-c-text-light-1:#213547;--va-c-text-light-2:rgba(60, 60, 60, .7);--va-c-text-light-3:rgba(60, 60, 60, .33);--va-c-text-light-4:rgba(60, 60, 60, .18);--va-c-text-dark-1:rgba(255, 255, 255, .87);--va-c-text-dark-2:rgba(235, 235, 235, .6);--va-c-text-dark-3:rgba(235, 235, 235, .38);--va-c-text-dark-4:rgba(235, 235, 235, .18);--va-c-primary-light:#359eff;--va-c-primary-lighter:#81c2ff;--va-c-primary-dark:#006bce;--va-c-primary:#0078E7}:root{color-scheme:light;--va-c-brand:#0078E7;--va-border-color:#222;--va-c-bg:white;--va-c-bg-light:white;--va-c-bg-dark:#fafafa;--va-c-bg-soft:#f9f9f9;--va-c-bg-alt:#f9f9f9;--va-c-bg-mute:#f1f1f1;--va-c-text:#333;--va-c-text-light:#555;--va-c-text-lighter:#666;--va-c-text-dark:#111;--va-c-primary-rgb:0,120,231;--va-c-link:var(--va-c-primary-dark);--va-c-divider:rgba(60, 60, 60, .2)}:root{--va-code-line-height:1.7;--va-code-font-size:.875em;--va-code-block-color:var(--va-c-text-dark-1);--va-code-block-bg:#282c34;--va-code-line-highlight-color:rgba(0, 0, 0, .5);--va-code-line-number-color:var(--va-c-text-dark-3);--va-code-copy-code-hover-bg:rgba(255, 255, 255, .05);--va-code-copy-code-active-text:var(--va-c-text-dark-2)}:root{--va-icon-copy:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2'/%3E%3C/svg%3E");--va-icon-copied:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2m-6 9 2 2 4-4'/%3E%3C/svg%3E")}.post-title{display:flex;justify-content:center;align-items:center}.yun-main{padding-left:var(--va-sidebar-width);transition:padding-left var(--va-transition-duration);box-sizing:border-box}.yun-icon-btn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border:none;width:3rem;height:3rem;border-radius:50%;transition:background-color var(--va-transition-duration)}.yun-icon-btn div{font-size:1.2rem}.yun-icon-btn:hover{background-color:rgba(var(--va-c-primary-rgb),.08)}.yun-icon-btn:active{background-color:rgba(var(--va-c-primary-rgb),.16)}:root{--smc-font-sans:Raleway,-apple-system,"PingFang SC","Microsoft YaHei",Arial,sans-serif;--smc-font-serif:"Songti SC","Noto Serif SC",STZhongsong,STKaiti,KaiTi,Roboto,serif;--smc-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace}:root{--smc-c-primary-light:#4eaaff;--smc-c-primary-lighter:#9bcfff;--smc-c-primary:#0078E7;--smc-theme-name:yun;--smc-line-height:1.8;--smc-c-primary-rgb:0,120,231;--smc-c-text:#24292e;--smc-c-text-light:#555;--smc-c-text-lighter:#666;--smc-header-bottom-color:#eaecef;--smc-border-color:var(--smc-c-primary-light);--smc-code-bg-color:#f6f8fa;--smc-link-color:#005eb4}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--smc-bg-color);color:var(--smc-c-text);font-family:var(--smc-font-sans);font-size:1rem;line-height:var(--smc-line-height);overflow-wrap:break-word}.markdown-body *{box-sizing:border-box}.markdown-body a{background-color:transparent}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body hr{background-color:var(--smc-c-primary,#333);height:2px;margin:1.5rem 0}.markdown-body blockquote{margin:1rem 0;padding:0 1rem;border-left:.25em solid var(--smc-border-color)}.markdown-body code,.markdown-body pre{font-family:Source Code Pro,Consolas,Monaco,SFMono-Regular,Ubuntu Mono,Menlo,monospace}.markdown-body code{padding:3px 6px;font-size:.85rem;color:var(--smc-c-text-light);background:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre{margin-top:0;margin-bottom:0;overflow-wrap:normal;padding:1rem;overflow:auto;background-color:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre>code{font-size:.85rem;white-space:pre}.markdown-body pre code{display:block;padding:0;margin:0;overflow:visible;line-height:inherit;word-break:normal;background-color:transparent;border:0}.markdown-body img{display:block;margin:1rem auto;max-width:92%;max-height:600px;border-radius:.2rem;transition:.4s;--tw-shadow:0 1px 3px 0 rgb(0 0 0/.1),0 1px 2px -1px rgb(0 0 0/.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color);-webkit-box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow);box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.markdown-body img:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0/.1),0 2px 4px -2px rgb(0 0 0/.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.markdown-body img:before{content:"\300c  LOADING ERROR \300d"}@media screen and (min-width:1600px){.markdown-body img{max-width:800px}}.markdown-body a{color:var(--smc-c-primary);text-decoration:none;border-bottom-color:transparent;transition:all .2s ease-in-out}.markdown-body a:hover{color:var(--smc-link-color);border-bottom:1px solid var(--smc-link-color)}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ul,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{overflow-wrap:break-all;margin-top:.25em}.markdown-body li>p{margin-top:16px}.markdown-body table{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid var(--smc-c-primary-light,#999)}.markdown-body table thead th{font-weight:600}.markdown-body table>tbody>tr:hover{background-color:rgba(var(--smc-c-primary-rgb),.1)}.markdown-body strong{font-family:var(--smc-font-serif);font-weight:900}.markdown-body p{margin-top:1rem;margin-bottom:1rem;overflow-x:auto;overflow-y:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4{margin-top:1.5rem;margin-bottom:1rem;font-weight:300;line-height:1.5}.markdown-body h1{font-size:2.5rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h2{font-size:2.2rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h3{font-size:1.9rem}.markdown-body h4{font-size:1.6rem}@media screen and (max-width:768px){.markdown-body h1{font-size:2rem}.markdown-body h2{font-size:1.8rem}.markdown-body h3{font-size:1.6rem}.markdown-body h4{font-size:1.4rem}}.markdown-body{--smc-font-family:var(--va-font-sans);--c-toc-link:var(--va-c-text-light)}.markdown-body{word-wrap:break-word}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4{font-family:var(--va-font-serif);font-weight:900}.markdown-body ul{list-style:initial}.markdown-body ul li>p{margin-bottom:0}:root{--yun-post-card-max-width:900px;--yun-z-cloud:8;--yun-z-go-down:9;--yun-z-backdrop:9;--yun-z-sidebar:10;--yun-z-fireworks:11;--yun-z-menu-btn:20;--yun-z-go-up-btn:20;--yun-z-search-popup:30;--yun-z-search-btn:31;--va-z-overlay:var(--yun-z-backdrop)}:root{--yun-bg-image:url(https://cdn.yunyoujun.cn/img/bg/stars-timing-0-blur-30px.jpg);--yun-sidebar-bg-color:var(--va-c-bg-light);--yun-sidebar-bg-image:url(https://cdn.yunyoujun.cn/img/bg/alpha-stars-timing-1.webp)}*,::after,::before{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-scroll-snap-strictness:proximity;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow:0 0 rgba(0,0,0,0);--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,0.5)}.i-ri-alipay-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M18.408 16.79c-2.173-.95-3.72-1.646-4.64-2.086c-1.4 1.696-2.872 2.72-5.08 2.72S5 16.064 5.176 14.392c.12-1.096.872-2.888 4.128-2.576c1.72.16 2.504.48 3.912.944c.36-.664.664-1.4.888-2.176H7.88v-.616h3.072V8.864H7.2v-.68h3.752V6.592s.032-.248.312-.248H12.8v1.848h4v.68h-4v1.104h3.264a12.41 12.41 0 0 1-1.32 3.32c.51.182 2.097.676 4.76 1.483a8 8 0 1 0-1.096 2.012zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm-3.568-5.632c1.44 0 2.824-.872 3.96-2.352c-1.608-.776-2.944-1.16-4.44-1.16c-1.304 0-1.984.8-2.104 1.416c-.12.616.248 2.096 2.584 2.096z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-archive-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M3 10H2V4.003C2 3.449 2.455 3 2.992 3h18.016A.99.99 0 0 1 22 4.003V10h-1v10.001a.996.996 0 0 1-.993.999H3.993A.996.996 0 0 1 3 20.001V10zm16 0H5v9h14v-9zM4 5v3h16V5H4zm5 7h6v2H9v-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-left-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m10.828 12l4.95 4.95l-1.414 1.414L8 12l6.364-6.364l1.414 1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-right-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m13.172 12l-4.95-4.95l1.414-1.414L16 12l-6.364 6.364l-1.414-1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-up-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m12 10.828l-4.95 4.95l-1.414-1.414L12 8l6.364 6.364l-1.414 1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-calendar-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M17 3h4a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h4V1h2v2h6V1h2v2zm-2 2H9v2H7V5H4v4h16V5h-3v2h-2V5zm5 6H4v8h16v-8z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-clipboard-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M7 4V2h10v2h3.007c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 21.007V4.993C3 4.445 3.445 4 3.993 4H7zm0 2H5v14h14V6h-2v2H7V6zm2-2v2h6V4H9z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-cloud-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M17 21H7A6 6 0 0 1 5.008 9.339a7 7 0 1 1 13.984 0A6 6 0 0 1 17 21zm0-12a5 5 0 1 0-9.994.243l.07 1.488l-1.404.494A4.002 4.002 0 0 0 7 19h10a4 4 0 1 0-3.796-5.265l-1.898-.633A6.003 6.003 0 0 1 17 9z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-download-cloud-2-fill{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M13 13v5.585l1.828-1.828l1.415 1.415L12 22.414l-4.243-4.242l1.415-1.415L11 18.585V13h2zM12 2a7.001 7.001 0 0 1 6.954 6.194a5.5 5.5 0 0 1-.953 10.784L18 17a6 6 0 0 0-11.996-.225L6 17v1.978a5.5 5.5 0 0 1-.954-10.784A7 7 0 0 1 12 2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-file-list-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1zm-1-2V4H5v16h14zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h8v2H8v-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-folder-2-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.414 5H21a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2zM20 11H4v8h16v-8zm0-2V7h-8.414l-2-2H4v4h16z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-genderless-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M13 7.066A7.501 7.501 0 0 1 12 22a7.5 7.5 0 0 1-1-14.934V1h2v6.066zM12 20a5.5 5.5 0 1 0 0-11a5.5 5.5 0 0 0 0 11z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-github-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32 0 0 1-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 0 1 .676-1.883c.752.27 1.261.735 1.947 1.588c-.094-.117.34.427.433.539c.19.227.33.365.44.438c.204.137.587.196 1.15.14c.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292c-.218-.894-.185-1.975.302-3.192a1 1 0 0 1 .63-.582c.081-.024.127-.035.208-.047c.803-.123 1.937.17 3.415 1.096A11.731 11.731 0 0 1 12 3.315c.912 0 1.818.104 2.684.308c1.477-.933 2.613-1.226 3.422-1.096c.085.013.157.03.218.05a1 1 0 0 1 .616.58c.487 1.216.52 2.297.302 3.19c.691.936 1.058 2.045 1.058 3.293c0 3.757-1.674 5.665-4.642 6.392c.125.415.19.879.19 1.38a300.492 300.492 0 0 1-.012 2.716a1 1 0 0 1-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446l.005-.705c.005-.708.007-1.338.007-1.998c0-.697-.183-1.152-.425-1.36c-.661-.57-.326-1.655.54-1.752c2.967-.333 4.337-1.482 4.337-4.66c0-.955-.312-1.744-.913-2.404a1 1 0 0 1-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 0 1-.833.135A9.626 9.626 0 0 0 12 5.315c-.89 0-1.772.119-2.592.35a1 1 0 0 1-.83-.134c-.752-.507-1.374-.807-1.868-.947c-.144.653-.073 1.194.092 1.607a1 1 0 0 1-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66c.865.097 1.201 1.177.544 1.748c-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 0 1-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-heart-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.001 4.529a5.998 5.998 0 0 1 8.242.228a6 6 0 0 1 .236 8.236l-8.48 8.492l-8.478-8.492a6 6 0 0 1 8.48-8.464zm6.826 1.641a3.998 3.998 0 0 0-5.49-.153l-1.335 1.198l-1.336-1.197a3.999 3.999 0 0 0-5.494.154a4 4 0 0 0-.192 5.451L12 18.654l7.02-7.03a4 4 0 0 0-.193-5.454z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-home-4-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M19 21H5a1 1 0 0 1-1-1v-9H1l10.327-9.388a1 1 0 0 1 1.346 0L23 11h-3v9a1 1 0 0 1-1 1zm-6-2h5V9.157l-6-5.454l-6 5.454V19h5v-6h2v6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-mail-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm17 4.238l-7.928 7.1L4 7.216V19h16V7.238zM4.511 5l7.55 6.662L19.502 5H4.511z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-money-cny-circle-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16zm1-7h3v2h-3v2h-2v-2H8v-2h3v-1H8v-2h2.586L8.464 7.879L9.88 6.464L12 8.586l2.121-2.122l1.415 1.415L13.414 10H16v2h-3v1z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-price-tag-3-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m10.9 2.1l9.899 1.415l1.414 9.9l-9.192 9.192a1 1 0 0 1-1.414 0l-9.9-9.9a1 1 0 0 1 0-1.414L10.9 2.1zm.707 2.122L3.828 12l8.486 8.485l7.778-7.778l-1.06-7.425l-7.425-1.06zm2.12 6.364a2 2 0 1 1 2.83-2.829a2 2 0 0 1-2.83 2.829z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-qq-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m17.535 12.514l-.696-1.796c0-.021.01-.375.01-.558C16.848 7.088 15.446 4 12 4s-4.848 3.088-4.848 6.16c0 .183.009.537.01.558l-.696 1.796c-.19.515-.38 1.05-.517 1.51c-.657 2.189-.444 3.095-.282 3.115c.348.043 1.354-1.648 1.354-1.648c0 .98.488 2.258 1.542 3.18c-.394.127-.878.32-1.188.557c-.28.214-.245.431-.194.52c.22.385 3.79.245 4.82.125c1.03.12 4.599.26 4.82-.126c.05-.088.085-.305-.194-.519c-.311-.237-.795-.43-1.19-.556c1.055-.923 1.542-2.202 1.542-3.181c0 0 1.007 1.691 1.355 1.648c.162-.02.378-.928-.283-3.116c-.14-.463-.325-.994-.516-1.509zm1.021 8.227c-.373.652-.833.892-1.438 1.057a4.91 4.91 0 0 1-.794.138c-.44.045-.986.065-1.613.064a33.23 33.23 0 0 1-2.71-.116c-.692.065-1.785.114-2.71.116a16.07 16.07 0 0 1-1.614-.064a4.928 4.928 0 0 1-.793-.138c-.605-.164-1.065-.405-1.44-1.059a2.274 2.274 0 0 1-.239-1.652c-.592-.132-1.001-.483-1.279-.911a2.43 2.43 0 0 1-.309-.71a4.028 4.028 0 0 1-.116-1.106c.013-.785.187-1.762.532-2.912c.14-.466.327-1.008.568-1.655l.553-1.43a15.496 15.496 0 0 1-.002-.203C5.152 5.605 7.588 2 12 2c4.413 0 6.848 3.605 6.848 8.16l-.001.203l.553 1.43l.01.026c.225.606.413 1.153.556 1.626c.348 1.15.522 2.129.535 2.916c.007.407-.03.776-.118 1.108c-.066.246-.161.48-.31.708c-.276.427-.684.776-1.277.91c.13.554.055 1.14-.24 1.654z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-speaker-fill{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M4 2h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1zm8 18a5 5 0 1 0 0-10a5 5 0 0 0 0 10zm0-12a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3zm0 10a3 3 0 1 1 0-6a3 3 0 0 1 0 6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-train-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m17.2 20l1.8 1.5v.5H5v-.5L6.8 20H5a2 2 0 0 1-2-2V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v11a2 2 0 0 1-2 2h-1.8zM7 5a2 2 0 0 0-2 2v11h14V7a2 2 0 0 0-2-2H7zm5 12a2 2 0 1 1 0-4a2 2 0 0 1 0 4zM6 7h12v4H6V7z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-translate=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M5 15v2a2 2 0 0 0 1.85 1.995L7 19h3v2H7a4 4 0 0 1-4-4v-2h2zm13-5l4.4 11h-2.155l-1.201-3h-4.09l-1.199 3h-2.154L16 10h2zm-1 2.885L15.753 16h2.492L17 12.885zM8 2v2h4v7H8v3H6v-3H2V4h4V2h2zm9 1a4 4 0 0 1 4 4v2h-2V7a2 2 0 0 0-2-2h-3V3h3zM6 6H4v3h2V6zm4 0H8v3h2V6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-wechat-2-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M8.667 11.511a1.276 1.276 0 0 1-1.285-1.285c0-.718.567-1.286 1.285-1.286c.717 0 1.285.568 1.285 1.286c0 .717-.568 1.285-1.285 1.285zm6.666 0a1.276 1.276 0 0 1-1.285-1.285c0-.718.568-1.286 1.285-1.286c.718 0 1.285.568 1.285 1.286c0 .717-.567 1.285-1.285 1.285zm-8.51 7.704l.715-.436a4 4 0 0 1 2.705-.536c.212.033.386.059.52.076c.406.054.82.081 1.237.081c4.42 0 7.9-3.022 7.9-6.6S16.42 5.2 12 5.2s-7.9 3.022-7.9 6.6c0 1.366.5 2.673 1.432 3.781c.048.057.12.137.214.235a4 4 0 0 1 1.101 3.102l-.025.297zm-.63 2.727a1 1 0 0 1-1.527-.93l.188-2.26a2 2 0 0 0-.55-1.551A6.993 6.993 0 0 1 4 16.868c-1.194-1.421-1.9-3.173-1.9-5.068c0-4.75 4.432-8.6 9.9-8.6s9.9 3.85 9.9 8.6s-4.432 8.6-9.9 8.6c-.51 0-1.01-.033-1.499-.098a23.61 23.61 0 0 1-.569-.084a2 2 0 0 0-1.353.268l-2.387 1.456z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-wechat-pay-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m19.145 8.993l-9.799 5.608l-.07.046a.646.646 0 0 1-.3.068a.655.655 0 0 1-.58-.344l-.046-.092l-1.83-3.95c-.024-.046-.024-.092-.024-.138c0-.184.139-.321.324-.321c.07 0 .14.023.209.069l2.155 1.515c.162.092.348.161.556.161a.937.937 0 0 0 .348-.069l8.275-3.648C16.934 6.273 14.634 5.2 12 5.2c-4.42 0-7.9 3.022-7.9 6.6c0 1.366.5 2.673 1.432 3.781c.048.057.12.137.214.235a4 4 0 0 1 1.101 3.102l-.025.297l.716-.436a4 4 0 0 1 2.705-.536c.212.033.386.059.52.076c.406.054.82.081 1.237.081c4.42 0 7.9-3.022 7.9-6.6c0-.996-.27-1.95-.755-2.807zM6.192 21.943a1 1 0 0 1-1.526-.932l.188-2.259a2 2 0 0 0-.55-1.551A6.993 6.993 0 0 1 4 16.868c-1.194-1.421-1.9-3.173-1.9-5.068c0-4.75 4.432-8.6 9.9-8.6s9.9 3.85 9.9 8.6s-4.432 8.6-9.9 8.6c-.51 0-1.01-.033-1.499-.098a23.61 23.61 0 0 1-.569-.084a2 2 0 0 0-1.353.268l-2.387 1.456z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-women-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M11 15.934A7.501 7.501 0 0 1 12 1a7.5 7.5 0 0 1 1 14.934V18h5v2h-5v4h-2v-4H6v-2h5v-2.066zM12 14a5.5 5.5 0 1 0 0-11a5.5 5.5 0 0 0 0 11z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i~=ri-sun-line]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.yun-card{margin:auto;--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow);transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms;transition-duration:var(--va-transition-duration)}.va-card{--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.va-card:hover,.yun-card:hover{--un-shadow:var(--un-shadow-inset) 0 10px 15px -3px var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 4px 6px -4px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}@media (max-width:767.9px){.yun-main{padding-left:0}}.fixed{position:fixed}.relative{position:relative}[bottom~="\31 9"]{bottom:4.75rem}[right~="\32 "]{right:.5rem}.z-1{z-index:1}.z-350{z-index:350}[m~="\30 "]{margin:0}[m~="\32 "]{margin:.5rem}[m~=y-4]{margin-top:1rem;margin-bottom:1rem}.my-1{margin-top:.25rem;margin-bottom:.25rem}[m~=x-2]{margin-left:.5rem;margin-right:.5rem}[m~=y-2]{margin-top:.5rem;margin-bottom:.5rem}[m~=t-4]{margin-top:1rem}[mt-6=""],[m~=t-6]{margin-top:1.5rem}[m~=b-2]{margin-bottom:.5rem}[m~=l-1]{margin-left:.25rem}[m~=l-4]{margin-left:1rem}.block{display:block}.inline-block{display:inline-block}[h~="\38 "]{height:2rem}[w~="\38 "]{width:2rem}[w~=full]{width:100%}.flex,[flex~="\~"]{display:flex}.inline-flex{display:inline-flex}.flex-grow,[flex~=grow]{flex-grow:1}.flex-col,[flex~=col]{flex-direction:column}.transform{transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}.animate-iteration-1{animation-iteration-count:1}.items-center{align-items:center}.justify-center{justify-content:center}.justify-around{justify-content:space-around}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[border~="\~"]{border-width:1px;border-style:solid}[border~=rounded]{border-radius:.25rem}.rounded-full{border-radius:9999px}[fill~=none]{fill:none}[stroke-width~="\32 "]{stroke-width:2px}.p-4,[p~="\34 "]{padding:1rem}[p~="\31 "]{padding:.25rem}[p~="\32 "]{padding:.5rem}[p~=x-4]{padding-left:1rem;padding-right:1rem}[p~=b-8]{padding-bottom:2rem}[p~=l-4]{padding-left:1rem}[text~=center]{text-align:center}[text~="\32 xl"]{font-size:1.5rem;line-height:2rem}[text-xl=""],[text~=xl]{font-size:1.25rem;line-height:1.75rem}[text~=sm]{font-size:.875rem;line-height:1.25rem}[text~=xs]{font-size:.75rem;line-height:1rem}[font~=black]{font-weight:900}.text-\$va-c-text-light{color:var(--va-c-text-light)}[text~=red-400]{--un-text-opacity:1;color:rgba(248,113,113,var(--un-text-opacity))}[opacity~="\37 5"]{opacity:.75}.hover\:shadow-md:hover{--un-shadow:var(--un-shadow-inset) 0 4px 6px -1px var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 2px 4px -2px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.shadow{--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms}[font~=serif]{font-family:var(--va-font-serif)}@media (max-width:767.9px){.lt-md\:ml-0{margin-left:0}[p~="lt-md\:0"]{padding:0}}@media (min-width:640px){.sm\:p-6{padding:1.5rem}.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}}@media (min-width:768px){.md\:hidden{display:none}.md\:translate-x-0{--un-translate-x:0rem;transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}}@media (min-width:1024px){.lg\:px-12{padding-left:3rem;padding-right:3rem}}@media (min-width:1280px){.xl\:hidden{display:none}.xl\:px-16{padding-left:4rem;padding-right:4rem}}.post-copyright{font-size:.9rem;padding:.5rem 1rem;border-left:4px solid #ff5252;background-color:var(--va-c-bg-dark);list-style:none;word-break:break-all;position:relative;overflow:hidden}.post-copyright:after{pointer-events:none;position:absolute;color:#fff;background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'%3E%3Cpath fill='gray' d='M245.8 214.9l-33.2 17.3c-9.4-19.6-25.2-20-27.4-20-22.2 0-33.3 14.6-33.3 43.9 0 23.5 9.2 43.8 33.3 43.8 14.4 0 24.6-7 30.5-21.3l30.6 15.5a73.2 73.2 0 01-65.1 39c-22.6 0-74-10.3-74-77 0-58.7 43-77 72.6-77 30.8-.1 52.7 11.9 66 35.8zm143 0l-32.7 17.3c-9.5-19.8-25.7-20-27.9-20-22.1 0-33.2 14.6-33.2 43.9 0 23.5 9.2 43.8 33.2 43.8 14.5 0 24.7-7 30.5-21.3l31 15.5c-2 3.8-21.3 39-65 39-22.7 0-74-9.9-74-77 0-58.7 43-77 72.6-77C354 179 376 191 389 214.8zM247.7 8C104.7 8 0 123 0 256c0 138.4 113.6 248 247.6 248C377.5 504 496 403 496 256 496 118 389.4 8 247.6 8zm.8 450.8c-112.5 0-203.7-93-203.7-202.8 0-105.5 85.5-203.3 203.8-203.3A201.7 201.7 0 01451.3 256c0 121.7-99.7 202.9-202.9 202.9z'/%3E%3C/svg%3E");content:" ";height:10rem;width:10rem;right:-2rem;top:-2rem;opacity:.1}.sponsor-button{background-color:#ffffff1a}.sponsor-button div{transform:scale(1.1);transition:transform var(--va-transition-duration) ease-in-out}.sponsor-button:hover{background-color:#ffffffe6}.sponsor-button:hover div{transform:scale(1.2)}.qrcode-container{overflow:hidden;height:0;transition:height var(--va-transition-duration) ease-in-out}.sponsor-method-img{width:12rem;max-width:90%;aspect-ratio:1}.va-toc[data-v-928b99a5]{text-align:left}.content[data-v-928b99a5]{position:relative;padding-left:16px;font-size:14px;text-align:left}.outline-marker[data-v-928b99a5]{position:absolute;top:32px;left:-2px;z-index:0;opacity:0;width:4px;height:18px;background-color:var(--va-c-brand);transition:top .25s cubic-bezier(0,1,.5,1),background-color .5s,opacity .25s;border-top-right-radius:2px;border-bottom-right-radius:2px}.outline-title[data-v-928b99a5]{letter-spacing:.4px;line-height:28px;font-size:14px;font-weight:600}.visually-hidden[data-v-928b99a5]{position:absolute;width:1px;height:1px;white-space:nowrap;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden}.aside{position:fixed;right:0;top:0;bottom:0;min-width:var(--va-sidebar-width);transform:translate(100%);transition:box-shadow var(--va-transition-duration),background-color var(--va-transition-duration),opacity .25s,transform var(--va-transition-duration) cubic-bezier(.19,1,.22,1)}.aside-container{position:sticky;top:0;height:100vh}@media screen and (min-width:1280px){.aside{transform:translate(0)}}.toc-btn{color:var(--va-c-primary);background-color:#fff}.post-nav{display:flex;justify-content:space-between;align-items:center}.post-nav-item{display:inline-flex;justify-content:center;align-items:center;color:var(--va-c-primary);outline:0;font-size:1.5rem;font-weight:700;text-transform:uppercase;height:3rem;transition:.4s}.post-nav-item:hover{background-color:rgba(var(--va-c-primary-rgb),.1);box-shadow:0 0 15px #0000001a}.post-nav-prev{padding:0 .6rem 0 .1rem}.post-nav-next{padding:0 .1rem 0 .6rem}.post-nav-next,.post-nav-prev{display:inline-flex;align-items:center;height:3rem;font-size:1rem}.post-nav-next .title,.post-nav-prev .title{overflow:hidden;max-width:10rem}.post-nav-next .icon,.post-nav-prev .icon{width:1.2rem;height:1.2rem}@media screen and (min-width:1024px){.post-nav-next .title,.post-nav-prev .title{max-width:18rem}}@media screen and (min-width:1280px){.content{max-width:calc(100vw - 2 * var(--va-sidebar-width) - 1rem - 8px)}}:root{--waline-font-size:1rem;--waline-white:#fff;--waline-light-grey:#999;--waline-dark-grey:#666;--waline-theme-color:#27ae60;--waline-active-color:#2ecc71;--waline-color:#444;--waline-bgcolor:#fff;--waline-bgcolor-light:#f8f8f8;--waline-bgcolor-hover:#f0f0f0;--waline-border-color:#ddd;--waline-disable-bgcolor:#f8f8f8;--waline-disable-color:#000;--waline-code-bgcolor:#282c34;--waline-bq-color:#f0f0f0;--waline-avatar-size:3.25rem;--waline-m-avatar-size:calc(var(--waline-avatar-size) * 9 / 13);--waline-badge-color:#3498db;--waline-badge-font-size:.75em;--waline-info-bgcolor:#f8f8f8;--waline-info-color:#999;--waline-info-font-size:.625em;--waline-border:1px solid var(--waline-border-color);--waline-avatar-radius:50%;--waline-box-shadow:none}[data-waline]{font-size:var(--waline-font-size);text-align:left}[data-waline] *{box-sizing:content-box;line-height:1.75}[data-waline] a{position:relative;display:inline-block;color:var(--waline-theme-color);text-decoration:none;word-break:break-word;cursor:pointer}[data-waline] a:hover{color:var(--waline-active-color)}[data-waline] hr{margin:.825em 0;border-style:dashed;border-color:var(--waline-bgcolor-light)}[data-waline] ul{margin-left:1.25em;padding:0}.wl-btn{display:inline-block;vertical-align:middle;min-width:2.5em;margin-bottom:0;padding:.5em 1em;border:1px solid var(--waline-border-color);border-radius:.5em;background:rgba(0,0,0,0);color:var(--waline-color);font-weight:400;font-size:.75em;line-height:1.5;text-align:center;white-space:nowrap;cursor:pointer;user-select:none;transition-duration:.4s;touch-action:manipulation}.wl-btn:active,.wl-btn:hover{border-color:var(--waline-theme-color);color:var(--waline-theme-color)}.wl-btn:disabled{border-color:var(--waline-border-color);background:var(--waline-disable-bgcolor);color:var(--waline-disable-color);cursor:not-allowed}.wl-btn.primary{border-color:var(--waline-theme-color);background:var(--waline-theme-color);color:var(--waline-white)}.wl-btn.primary:active,.wl-btn.primary:hover{border-color:var(--waline-active-color);background:var(--waline-active-color);color:var(--waline-white)}.wl-btn.primary:disabled{border-color:var(--waline-border-color);background:var(--waline-disable-bgcolor);color:var(--waline-disable-color);cursor:not-allowed}.wl-loading{text-align:center}.wl-loading svg{margin:0 auto}.wl-comment{position:relative;display:flex;margin-bottom:.75em}.wl-panel{position:relative;flex-shrink:1;width:100%;margin:.5em;border:var(--waline-border);border-radius:.75em;background:var(--waline-bgcolor);box-shadow:var(--waline-box-shadow)}.wl-header{display:flex;overflow:hidden;padding:0 4px;border-bottom:2px dashed var(--waline-border-color);border-top-left-radius:.75em;border-top-right-radius:.75em}@media (max-width:580px){.wl-header{display:block}}.wl-header label{min-width:40px;padding:.75em .5em;color:var(--waline-color);font-size:.75em;text-align:center}.wl-header input{flex:1;width:0;padding:.5em;background:rgba(0,0,0,0);font-size:.625em;resize:none}.wl-header-item{display:flex;flex:1}@media (max-width:580px){.wl-header-item:not(:last-child){border-bottom:2px dashed var(--waline-border-color)}}.wl-editor,.wl-input{max-width:100%;border:none;color:var(--waline-color);outline:0;transition:all .25s ease}.wl-editor:focus,.wl-input:focus{background:var(--waline-bgcolor-light)}.wl-editor{position:relative;width:calc(100% - 1em);min-height:8.75em;margin:.75em .5em;border-radius:.5em;background:rgba(0,0,0,0);font-size:.875em;resize:vertical}.wl-preview{padding:0 .5em .5em}.wl-preview h4{margin:.25em;font-weight:700;font-size:.9375em}.wl-preview .wl-content{min-height:1.25em;padding:.25em;word-break:break-word;hyphens:auto}.wl-footer{position:relative;display:flex;flex-wrap:wrap;margin:.5em .75em}.wl-actions{display:flex;flex:2;align-items:center}.wl-action{display:inline-flex;align-items:center;justify-content:center;width:1.5em;height:1.5em;margin:2px;padding:0;border:none;background:rgba(0,0,0,0);color:var(--waline-color);font-size:16px;cursor:pointer}.wl-action:hover{color:var(--waline-theme-color)}#wl-image-upload{display:none}#wl-image-upload:focus+label{color:var(--waline-color)}#wl-image-upload:focus-visible+label{outline:-webkit-focus-ring-color auto 1px}.wl-info{display:flex;flex:3;align-items:center;justify-content:flex-end}.wl-info .wl-text-number{color:var(--waline-info-color);font-size:.75em}.wl-info button{margin-left:.75em}.wl-emoji-popup{position:absolute;top:100%;left:1.25em;z-index:10;max-width:526px;border:var(--waline-border);border-radius:6px;background:var(--waline-bgcolor);box-shadow:var(--waline-box-shadow);opacity:0;visibility:hidden;transition:transform .2s ease-out,opacity .2s ease-out;transform:scale(.9);transform-origin:0 0}.wl-gif-popup{position:absolute;top:100%;left:1.25em;z-index:10;width:calc(100% - 3em);padding:.75em .75em .25em;border:var(--waline-border);border-radius:6px;background:var(--waline-bgcolor);box-shadow:var(--waline-box-shadow);opacity:0;visibility:hidden;transition:transform .2s ease-out,opacity .2s ease-out;transform:scale(.9);transform-origin:0 0}.wl-gif-popup input{box-sizing:border-box;width:100%;margin-bottom:10px;padding:3px 5px;border:var(--waline-border)}.wl-gallery{display:flex;overflow-y:auto;max-height:80vh}.wl-count{flex:1;font-weight:700;font-size:1.25em}.wl-power{padding:.5em 0;color:var(--waline-light-grey);font-size:var(--waline-info-font-size);text-align:right}.wl-meta-head{display:flex;flex-direction:row;align-items:center;padding:.375em}ul.wl-sort{margin:0;list-style-type:none}.wl-sort li{display:inline-block;color:var(--waline-info-color);font-size:.75em;cursor:pointer}.wl-sort li+li{margin-left:1em}.wl-sort li.active{color:var(--waline-theme-color)}:root{--waline-theme-color:var(--va-c-primary);--waline-active-color:var(--va-c-primary-light)}</style><link rel="preload" href="/assets/index.5e999eb6.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/post.b71e5ca6.js"><link rel="preload" href="/assets/post.1d1be697.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/Docker_K8s.041aea5a.js"><link rel="modulepreload" crossorigin="" href="/assets/ValaxyMain.vue_vue_type_style_index_0_lang.932fecce.js"><link rel="preload" href="/assets/ValaxyMain.d58abc01.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/YunWaline.bf7ec54d.js"><link rel="preload" href="/assets/YunWaline.55def383.css" as="style"><title></title><link rel="icon" href="/favicon.svg" type="image/svg+xml"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#ffffff"><meta name="generator" content="Valaxy 0.11.4"><meta name="description" content=""><meta property="og:description" content=""><meta property="og:locale" content="zh-CN"><meta property="og:site:name" content=""><meta property="og:title" content="Docker+K8s"><meta property="og:image" content="/favicon.svg"><meta property="og:url" content="https://www.vlinux.cn/"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_AMS-Regular.0cdd387c.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Bold.de7701e4.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Regular.5d53e70a.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Bold.74444efd.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Regular.51814d27.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Bold.0f60d1b8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-BoldItalic.99cd42a3.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Italic.97479ca6.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Regular.c2342cd8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-BoldItalic.dc47344d.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-Italic.7af58c5e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Bold.e99ae511.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Italic.00b26ac8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Regular.68e8c73e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Script-Regular.036d4e95.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size1-Regular.6b47c401.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size2-Regular.d04c5421.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="data:font/woff2;base64,d09GMgABAAAAAA4oAA4AAAAAHbQAAA3TAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgRQIDgmcDBEICo1oijYBNgIkA14LMgAEIAWJAAeBHAyBHBvbGiMRdnO0IkRRkiYDgr9KsJ1NUAf2kILNxgUmgqIgq1P89vcbIcmsQbRps3vCcXdYOKSWEPEKgZgQkprQQsxIXUgq0DqpGKmIvrgkeVGtEQD9DzAO29fM9jYhxZEsL2FeURH2JN4MIcTdO049NCVdxQ/w9NrSYFEBKTDKpLKfNkCGDc1RwjZLQcm3vqJ2UW9Xfa3tgAHz6ivp6vgC2yD4/6352ndnN0X0TL7seypkjZlMsjmZnf0Mm5Q+JykRWQBKCVCVPbARPXWyQtb5VgLB6Biq7/Uixcj2WGqdI8tGSgkuRG+t910GKP2D7AQH0DB9FMDW/obJZ8giFI3Wg8Cvevz0M+5m0rTh7XDBlvo9Y4vm13EXmfttwI4mBo1EG15fxJhUiCLbiiyCf/ZA6MFAhg3pGIZGdGIVjtPn6UcMk9A/UUr9PhoNsCENw1APAq0gpH73e+M+0ueyHbabc3vkbcdtzcf/fiy+NxQEjf9ud/ELBHAXJ0nk4z+MXH2Ev/kWyV4k7SkvpPc9Qr38F6RPWnM9cN6DJ0AdD1BhtgABtmoRoFCvPsBAumNm6soZG2Gk5GyVTo2sJncSyp0jQTYoR6WDvTwaaEcHsxHfvuWhHA3a6bN7twRKtcGok6NsCi7jYRrM2jExsUFMxMQYuJbMhuWNOumEJy9hi29Dmg5zMp/A5+hhPG19j1vBrq8JTLr8ki5VLPmG/PynJHVul440bxg5xuymHUFPBshC+nA9I1FmwbRBTNHAcik3Oae0cxKoI3MOriM42UrPe51nsaGxJ+WfXubAsP84aabUlQSJ1IiE0iPETLUU4CATgfXSCSpuRFRmCGbO+wSpAnzaeaCYW1VNEysRtuXCEL1kUFUbbtMv3Tilt/1c11jt3Q5bbMa84cpWipp8Elw3MZhOHsOlwwVUQM3lAR35JiFQbaYCRnMF2lxAWoOg2gyoIV4PouX8HytNIfLhqpJtXB4vjiViUI8IJ7bkC4ikkQvKksnOTKICwnqWSZ9YS5f0WCxmpgjbIq7EJcM4aI2nmhLNY2JIUgOjXZFWBHb+x5oh6cwb0Tv1ackHdKi0I9OO2wE9aogIOn540CCCziyhN+IaejtgAONKznHlHyutPrHGwCx9S6B8kfS4Mfi4Eyv7OU730bT1SCBjt834cXsf43zVjPUqqJjgrjeGnBxSG4aYAKFuVbeCfkDIjAqMb6yLNIbCuvXhMH2/+k2vkNpkORhR59N1CkzoOENvneIosjYmuTxlhUzaGEJQ/iWqx4dmwpmKjrwTiTGTCVozNAYqk/zXOndWxuWSmJkQpJw3pK5KX6QrLt5LATMqpmPAQhkhK6PUjzHUn7E0gHE0kPE0iKkolgkUx9SZmVAdDgpffdyJKg3k7VmzYGCwVXGz/tXmkOIp+vcWs+EMuhhvN0h9uhfzWJziBQmCREGSIFmQIkgVpAnSBRmC//6hkLZwaVhwxlrJSOdqlFtOYxlau9F2QN5Y98xmIAsiM1HVp2VFX+DHHGg6Ecjh3vmqtidX3qHI2qycTk/iwxSt5UzTmEP92ZBnEWTk4Mx8Mpl78ZDokxg/KWb+Q0QkvdKVmq3TMW+RXEgrsziSAfNXFMhDc60N5N9jQzjfO0kBKpUZl0ZmwJ41j/B9Hz6wmRaJB84niNmQrzp9eSlQCDDzazGDdVi3P36VZQ+Jy4f9UBNp+3zTjqI4abaFAm+GShVaXlsGdF3FYzZcDI6cori4kMxUECl9IjJZpzkvitAoxKue+90pDMvcKRxLl53TmOKCmV/xRolNKSqqUxc6LStOETmFOiLZZptlZepcKiAzteG8PEdpnQpbOMNcMsR4RR2Bs0cKFEvSmIjAFcnarqwUL4lDhHmnVkwu1IwshbiCcgvOheZuYyOteufZZwlcTlLgnZ3o/WcYdzZHW/WGaqaVfmTZ1aWCceJjkbZqsfbkOtcFlUZM/jy+hXHDbaUobWqqXaeWobbLO99yG5N3U4wxco0rQGGcOLASFMXeJoham8M+/x6O2WywK2l4HGbq1CoUyC/IZikQhdq3SiuNrvAEj0AVu9x2x3lp/xWzahaxidezFVtdcb5uEnzyl0ZmYiuKI0exvCd4Xc9CV1KB0db00z92wDPde0kukbvZIWN6jUWFTmPIC/Y4UPCm8UfDTFZpZNon1qLFTkBhxzB+FjQRA2Q/YRJT8pQigslMaUpFyAG8TMlXigiqmAZX4xgijKjRlGpLE0GdplRfCaJo0JQaSxNBk6ZmMzcya0FmrcisDdn0Q3HI2sWSppYigmlM1XT/kLQZSNpMJG0WkjYbSZuDpM1F0uYhFc1HxU4m1QJjDK6iL0S5uSj5rgXc3RejEigtcRBtqYPQsiTskmO5vosV+q4VGIKbOkDg0jtRrq+Em1YloaTFar3EGr1EUC8R0kus1Uus00usL97ABr2BjXoDm/QGNhuWtMVBKOwg/i78lT7hBsAvDmwHc/ao3vmUbBmhjeYySZNWvGkfZAgISDSaDo1SVpzGDsAEkF8B+gEapViUoZgUWXcRIGFZNm6gWbAKk0bp0k1MHG9fLYtV4iS2SmLEQFARzRcnf9PUS0LVn05/J9MiRRBU3v2IrvW974v4N00L7ZMk0wXP1409CHo/an8zTRHD3eSJ6m8D4YMkZNl3M79sqeuAsr/m3f+8/yl7A50aiAEJgeBeMWzu7ui9UfUBCe2TIqZIoOd/3/udRBOQidQZUERzb2/VwZN1H/Sju82ew2H2Wfr6qvfVf3hqwDvAIpkQVFy4B9Pe9e4/XvPeceu7h3dvO56iJPf0+A6cqA2ip18ER+iFgggiuOkvj24bby0N9j2UHIkgqIt+sVgfodC4YghLSMjSZbH0VR/6dMDrYJeKHilKTemt6v6kvzvn3/RrdWtr0GoN/xL+Sex/cPYLUpepx9cz/D46UPU5KXgAQa+NDps1v6J3xP1i2HtaDB0M9aX2deA7SYff//+gUCovMmIK/qfsFcOk+4Y5ZN97XlG6zebqtMbKgeRFi51vnxTQYBUik2rS/Cn6PC8ADR8FGxsRPB82dzfND90gIcshOcYUkfjherBz53odpm6TP8txlwOZ71xmfHHOvq053qFF/MRlS3jP0ELudrf2OeN8DHvp6ZceLe8qKYvWz/7yp0u4dKPfli3CYq0O13Ih71mylJ80tOi10On8wi+F4+LWgDPeJ30msSQt9/vkmHq9/Lvo2b461mP801v3W4xTcs6CbvF9UDdrSt+A8OUbpSh55qAUFXWznBBfdeJ8a4d7ugT5tvxUza3h9m4H7ptTqiG4z0g5dc0X29OcGlhpGFMpQo9ytTS+NViZpNdvU4kWx+LKxNY10kQ1yqGXrhe4/1nvP7E+nd5A92TtaRplbHSqoIdOqtRWti+fkB5/n1+/VvCmz12pG1kpQWsfi1ftlBobm0bpngs16CHkbIwdLnParxtTV3QYRlfJ0KFskH7pdN/YDn+yRuSd7sNH3aO0DYPggk6uWuXrfOc+fa3VTxFVvKaNxHsiHmsXyCLIE5yuOeN3/Jdf8HBL/5M6shjyhxHx9BjB1O0+4NLOnjLLSxwO7ukN4jMbOIcD879KLSi6Pk61Oqm2377n8079PXEEQ7cy7OKEC9nbpet118fxweTafpt69x/Bt8UqGzNQt7aelpc44dn5cqhwf71+qKp/Zf/+a0zcizOUWpl/iBcSXip0pplkatCchoH5c5aUM8I7/dWxAej8WicPL1URFZ9BDJelUwEwTkGqUhgSlydVes95YdXvhh9Gfz/aeFWvgVb4tuLbcv4+wLdutVZv/cUonwBD/6eDlE0aSiKK/uoH3+J1wDE/jMVqY2ysGufN84oIXB0sPzy8ollX/LegY74DgJXJR57sn+VGza0x3DnuIgABFM15LmajjjsNlYj+JEZGbuRYcAMOWxFkPN2w6Wd46xo4gVWQR/X4lyI/R6K/YK0110GzudPRW7Y+UOBGTfNNzHeYT0fiH0taunBpq9HEW8OKSaBGj21L0MqenEmNRWBAWDWAk4CpNoEZJ2tTaPFgbQYj8HxtFilErs3BTRwT8uO1NXQaWfIotchmPkAF5mMBAliEmZiOGVgCG9LgRzpscMAOOwowlT3JhusdazXGSC/hxR3UlmWVwWHpOIKheqONvjyhSiTHIkVUco5bnji8m//zL7PKaT1Vl5I6UE609f+gkr6MZKVyKc7zJRmCahLsdlyA5fdQkRSan9LgnnLEyGSkaKJCJog0wAgvepWBt80+1yKln1bMVtCljfNWDueKLsWwaEbBSfSPTEmVRsUcYYMnEjcjeyCZzBXK9E9BYBXLKjOSpUDR+nEV3TFSUdQaz+ot98QxgXwx0GQ+EEUAKB2qZPkQQ0GqFD8UPFMqyaCHM24BZmSGic9EYMagKizOw9Hz50DMrDLrqqLkTAhplMictiCAx5S3BIUQdeJeLnBy2CNtMfz6cV4u8XKoFZQesbf9YZiIERiHjaNodDW6LgcirX/mPnJIkBGDUpTBhSa0EIr38D5hCIszhCM8URGBqImoWjpvpt1ebu/v3Gl3qJfMnNM+9V+kiRFyROTPHQWOcs1dNW94/ukKMPZBvDi55i5CttdeJz84DLngLqjcdwEZ87bFFR8CIG35OAkDVN6VRDZ7aq67NteYqZ2lpT8oYB2CytoBd6VuAx4WgiAsnuj3WohG+LugzXiQRDeM3XYXlULv4dp5VFYC"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size4-Regular.a4af7d41.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Typewriter-Regular.71d517d6.woff2"></head><body><div id="app" data-server-rendered="true"><!--[--><!--[--><!--[--><div class="va-bg" style="background-image:url(https://cdn.yunyoujun.cn/img/bg/stars-timing-0-blur-30px.jpg)"></div><!--]--><!----><!--]--><!--[--><!--]--><!----><!--[--><!--[--><!----><button type="button" class="vt-hamburger menu-btn sidebar-toggle yun-icon-btn md:hidden" aria-label="mobile navigation" aria-expanded="false"><span class="vt-hamburger-container"><span class="vt-hamburger-top"></span><span class="vt-hamburger-middle"></span><span class="vt-hamburger-bottom"></span></span></button><aside class="md:translate-x-0 va-card transition sidebar"><!--[--><!--[--><!--[--><!----><div class=""><!--[--><div class="sidebar-panel"><div class="site-info" m="t-6"><a href="/about" class="site-author-avatar"><img class="rounded-full" src="http://cos.vlinux.cn/vlinux-logo/user.jpg" alt="avatar"><span class="site-author-status"></span></a><div class="site-author-name"><a href="/about" class=""></a></div><a href="/about/site" class="site-name"></a><h4 class="site-subtitle block" text="xs"></h4><div class="site-description my-1"></div></div><nav class="site-nav" text-xl="" mt-6=""><a href="/" class="site-link-item yun-icon-btn" title=""><div i-ri-home-4-line=""></div></a><a href="/archives/" class="site-link-item" title=""><div class="icon" i-ri-archive-line=""></div><span class="count">86</span></a><a href="/categories/" class="site-link-item" title=""><div class="icon" i-ri-folder-2-line=""></div><span class="count">16</span></a><a href="/tags/" class="site-link-item" title=""><div class="icon" i-ri-price-tag-3-line=""></div><span class="count">118</span></a><a href="/about" class="site-link-item yun-icon-btn" title=""><div class="i-ri-clipboard-line"></div></a></nav><hr m="t-4 b-2"><div class="links-of-author"><!--[--><a class="links-of-author-item yun-icon-btn" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=38867033&amp;site=qq&amp;menu=yes&amp;jumpflag=1" title="QQ 38867033" target="_blank" style="color:#12b7f5"><div class="i-ri-qq-line icon"></div></a><a class="links-of-author-item yun-icon-btn" rel="noopener" href="https://github.com/vlinux" title="GitHub" target="_blank" style="color:#6e5494"><div class="i-ri-github-line icon"></div></a><a class="links-of-author-item yun-icon-btn" rel="noopener" href="https://repo.vlinux.cn/" title=" Repo" target="_blank" style="color:#08c"><div class="i-ri-download-cloud-2-fill icon"></div></a><a class="links-of-author-item yun-icon-btn" rel="noopener" href="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG18.jpeg" title="" target="_blank" style="color:#1aad19"><div class="i-ri-wechat-2-line icon"></div></a><a class="links-of-author-item yun-icon-btn" rel="noopener" href="https://music.kococ.cn/" title="Music" target="_blank" style="color:#e6162d"><div class="i-ri-speaker-fill icon"></div></a><a class="links-of-author-item yun-icon-btn" rel="noopener" href="mailto:ilinux@88.com" title="E-Mail" target="_blank" style="color:#8e71c1"><div class="i-ri-mail-line icon"></div></a><a class="links-of-author-item yun-icon-btn" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--va-c-text)"><div class="i-ri-train-line icon"></div></a><!--]--></div><hr m="y-2"><div class="links"><!--[--><a class="link-item yun-icon-btn" title="" style="color:#1e90ff" href="https://www.vlinux.cn/links/" target="_blank"><!--[--><div class="i-ri-genderless-line icon"></div><!--]--><!----></a><a href="/bill" class="link-item yun-icon-btn" showexternalicon="false" title="" style="color:gold"><!--[--><div class="i-ri-money-cny-circle-line icon"></div><!--]--></a><a class="link-item yun-icon-btn" title="" style="color:#ff69b4" href="https://www.vlinux.cn/girls/" target="_blank"><!--[--><div class="i-ri-women-line icon"></div><!--]--><!----></a><!--]--></div><br></div><div><button class="yun-icon-btn" title="" style="color:#f1cb64"><div i="ri-sun-line dark:ri-moon-line"></div></button><button class="yun-icon-btn" title="" style="color:var(--va-c-text)"><div i-ri-translate="" class="transition transform"></div></button></div><!--]--></div><!--]--><!--]--><!--]--></aside><!--]--><main class="yun-main lt-md:ml-0" flex="~"><div w="full" flex="~"><!--[--><div class="content" flex="~ col grow" w="full" p="l-4 lt-md:0"><div class="yun-card relative" m="0" style=""><!----><!----><!--[--><!--[--><header class="post-header" m="t-4"><h1 class="post-title" p="2" text="2xl center" font="serif black" style=""><!----><span>Docker+K8s</span></h1></header><!--]--><!--[--><!--[--><!--[--><!--[--><!----><!----><div class="post-meta justify-center" flex="~" text="sm"><div class="post-time flex items-center"><div class="inline-block" i-ri-calendar-line=""></div><time m="l-1" title="">2020-02-28</time><!----></div></div><!--]--><!--]--><!--]--><!--]--><div p="x-4 b-8" class="sm:px-6 lg:px-12 xl:px-16" w="full"><!--[--><article class="markdown-body"><!--[--><!--[--><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p>IT</p><p>KVMOpenStackDockerKubernetesKubernetesAWSAzureUcloud</p><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><ul><li>Docker<a href="https://docs.docker.com/" target="_blank" rel="noreferrer">https://docs.docker.com/</a></li><li>Kubernetes<a href="https://kubernetes.io/docs/home/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/home/</a></li><li>OpenStack<a href="https://docs.openstack.org/" target="_blank" rel="noreferrer">https://docs.openstack.org/</a></li><li>Prometheus<a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noreferrer">https://prometheus.io/docs/introduction/overview/</a></li></ul><h1 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h1><p><strong></strong></p><ul><li>CPUVT&gt;4G80G</li><li>VMware Workstation Pro</li><li>CentOS-7.7-x86_64</li></ul><p><strong></strong></p><table><thead><tr><th></th><th>IPNAT</th><th></th></tr></thead><tbody><tr><td><a href="http://linux-node1.linuxhot.com" target="_blank" rel="noreferrer">linux-node1.linuxhot.com</a></td><td>eth0:192.168.56.11</td><td>1VCPU2Gsda50G</td></tr><tr><td><a href="http://linux-node2.linuxhot.com" target="_blank" rel="noreferrer">linux-node2.linuxhot.com</a></td><td>eth0:192.168.56.12</td><td>1VCPU2Gsda50G</td></tr><tr><td><a href="http://linux-node3.linuxhot.com" target="_blank" rel="noreferrer">linux-node3.linuxhot.com</a></td><td>eth0:192.168.56.13</td><td>1VCPU2Gsda50G</td></tr><tr><td></td><td>1.eth0eth1 2.linux-node3Kubernetes</td><td></td></tr></tbody></table><p><strong></strong></p><ul><li>CentOS-7.7-x86_64</li><li>1VCPU+2048M+50G</li><li>NAT</li><li>Minimal Install</li><li>iptablesSELinux</li><li>IPDNS/etc/hosts</li></ul><p><strong></strong></p><p>[hide]</p><ul><li>IP</li><li></li><li> [/hide]</li></ul><h1 id="-" tabindex="-1">  <a class="header-anchor" href="#-" aria-hidden="true">#</a></h1><p><strong></strong></p><p>****</p><p><strong></strong></p><p><strong></strong></p><p>eth*CentOS 7</p><p>1)Install CentOS 7</p><p><img src="http://k8s.unixhot.com/media/c4bb194b0f60ef7a32a7a4a269b31094.png" alt="img"></p><p>2)Tabkernelnet.ifnames=0 biosdevname=0</p><p><img src="http://k8s.unixhot.com/media/40432332febddc210781b55066a87252.png" alt="img"></p><p><strong></strong></p><p>1.</p><p>NAT192.168.56.0/24VMware Workstation</p><p><img src="http://k8s.unixhot.com/media/b4ac2c94cc558e1150c8cc77ecd6ad13.png" alt="img"></p><p>2.IPIPUUIDMAC</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0</span></span>
<span class="line"><span style="color:#a6accd">TYPE=Ethernet</span></span>
<span class="line"><span style="color:#a6accd">BOOTPROTO=static</span></span>
<span class="line"><span style="color:#a6accd">DEFROUTE=yes</span></span>
<span class="line"><span style="color:#a6accd">PEERDNS=no</span></span>
<span class="line"><span style="color:#a6accd">PEERROUTES=yes</span></span>
<span class="line"><span style="color:#a6accd">IPV4_FAILURE_FATAL=no</span></span>
<span class="line"><span style="color:#a6accd">NAME=eth0</span></span>
<span class="line"><span style="color:#a6accd">DEVICE=eth0</span></span>
<span class="line"><span style="color:#a6accd">ONBOOT=yes</span></span>
<span class="line"><span style="color:#a6accd">IPADDR=192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">NETMASK=255.255.255.0</span></span>
<span class="line"><span style="color:#a6accd">GATEWAY=192.168.56.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# systemctl restart network</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.NetworkManager</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl disable firewalld</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl disable NetworkManager</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vi /etc/hostname</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>5.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat /etc/hosts</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#a6accd">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 linux-node1 linux-node1.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.12 linux-node2 linux-node2.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.13 linux-node3 linux-node3.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>6.DNS</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vi /etc/resolv.conf</span></span>
<span class="line"><span style="color:#a6accd">nameserver 192.168.56.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>7.EPEL</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y net-tools vim lrzsz tree screen lsof tcpdump nc mtr nmap</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>8.SELinux</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/selinux</span></span>
<span class="line"><span style="color:#a6accd">SELINUX=disabled #disabled</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>9.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum update -y &amp;&amp; reboot</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>10.</p><p>linux-node1linux-node2linux-node2IP</p><p>11.</p><p></p><h1 id="-cobbler" tabindex="-1"> Cobbler <a class="header-anchor" href="#-cobbler" aria-hidden="true">#</a></h1><h1 id="_1-" tabindex="-1">1  <a class="header-anchor" href="#_1-" aria-hidden="true">#</a></h1><p>Cobbler LinuxPXE+KickStartKickStart</p><h2 id="_1-1-pxe-kickstart" tabindex="-1">1.1 PXE+Kickstart <a class="header-anchor" href="#_1-1-pxe-kickstart" aria-hidden="true">#</a></h2><h3 id="_1-1-1-kickstart" tabindex="-1">1.1.1 KickStart <a class="header-anchor" href="#_1-1-1-kickstart" aria-hidden="true">#</a></h3><p>KickStartLinuxKickStart ks.cfg KickStart KickStartks.cfgPXE</p><h3 id="_1-1-2-pxe" tabindex="-1">1.1.2 PXE <a class="header-anchor" href="#_1-1-2-pxe" aria-hidden="true">#</a></h3><p>PCUPXEPXEPXE PXE Client PXEPXE Pre-boot Execution EnvironmentPXE Client  Server PXE client  ROM BIOS  PXE client  PXE client   PXE  DHCP  TFTP DHCP  PXE Client IP  PXE Client  IP  DHCP  PXE  PXE Client  ROM  TFTP ClientPXE Client  TFTP  TFTP Server </p><h3 id="_1-1-3-pxe-kickstart" tabindex="-1">1.1.3 PXE+Kickstart <a class="header-anchor" href="#_1-1-3-pxe-kickstart" aria-hidden="true">#</a></h3><p>PXE+Kickstart</p><p>1.PXE ClientDHCPDHCP Server 2.DHCP ServerIPTFTP 3.PXE ClientTFTP Server 4.TFTP ServerPXE Client 5.PXE ClientKickstartKickstart 6.</p><h2 id="_1-2-yum" tabindex="-1">1.2 Yum <a class="header-anchor" href="#_1-2-yum" aria-hidden="true">#</a></h2><p>PXE+KickstartYUMCentOS 7</p><h3 id="_1-2-1-" tabindex="-1">1.2.1  <a class="header-anchor" href="#_1-2-1-" aria-hidden="true">#</a></h3><ol><li><p> HTTPYUMApachecreaterepo rpm </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y httpd createrepo</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>iso</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"># wget https://mirrors.aliyun.com/centos/7.4.1708/isos/x86_64/CentOS-7-x86_64-DVD-1708.iso</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>yum</p></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mount -o loop /usr/local/src/CentOS-7-x86_64-DVD-1511.iso /mnt/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>VMWare WorkstationISO</p></blockquote><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mount /dev/cdrom /mnt/</span></span>
<span class="line"><span style="color:#a6accd">mount: /dev/sr0 is write-protected, mounting read-only</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Apache</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /var/www/html/CentOS-7.4-x86_64</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp -a /mnt/* /var/www/html/CentOS-7.4-x86_64/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>Kickstart</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /var/www/html/CentOS-7-x86_64/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 CentOS-7-x86_64]# vim CentOS-7-x86_64.cfg</span></span>
<span class="line"><span style="color:#a6accd">#Kickstart Configurator by Jason Zhao</span></span>
<span class="line"><span style="color:#a6accd">#platform=x86, AMD64, or Intel EM64T</span></span>
<span class="line"><span style="color:#a6accd">#System  language</span></span>
<span class="line"><span style="color:#a6accd">lang en_US</span></span>
<span class="line"><span style="color:#a6accd">#System keyboard</span></span>
<span class="line"><span style="color:#a6accd">keyboard us</span></span>
<span class="line"><span style="color:#a6accd">#Sytem timezone</span></span>
<span class="line"><span style="color:#a6accd">timezone Asia/Shanghai</span></span>
<span class="line"><span style="color:#a6accd">#Root password</span></span>
<span class="line"><span style="color:#a6accd">rootpw --iscrypted $1$example$I.i3m26O7QYNja8p5Cj9.0</span></span>
<span class="line"><span style="color:#a6accd">#Use text mode install</span></span>
<span class="line"><span style="color:#a6accd">text</span></span>
<span class="line"><span style="color:#a6accd">#Install OS instead of upgrade</span></span>
<span class="line"><span style="color:#a6accd">install</span></span>
<span class="line"><span style="color:#a6accd">#Use NFS installation Media</span></span>
<span class="line"><span style="color:#a6accd">url --url=http://192.168.56.11/CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">#System bootloader configuration</span></span>
<span class="line"><span style="color:#a6accd">bootloader --location=mbr --driveorder=sda --append="net.ifnames=0 biosdevname=0"</span></span>
<span class="line"><span style="color:#a6accd">#Clear the Master Boot Record</span></span>
<span class="line"><span style="color:#a6accd">zerombr</span></span>
<span class="line"><span style="color:#a6accd">#Partition clearing information</span></span>
<span class="line"><span style="color:#a6accd">clearpart --all --initlabel </span></span>
<span class="line"><span style="color:#a6accd">#Disk partitioning information</span></span>
<span class="line"><span style="color:#a6accd">part /boot --fstype=xfs --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part swap --asprimary --fstype="swap" --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part / --fstype=xfs --size=1 --grow</span></span>
<span class="line"><span style="color:#a6accd">#System authorization infomation</span></span>
<span class="line"><span style="color:#a6accd">auth  --useshadow  --enablemd5 </span></span>
<span class="line"><span style="color:#a6accd">#Network information</span></span>
<span class="line"><span style="color:#a6accd">network --bootproto=dhcp --device=eth0 --onboot=on --activate</span></span>
<span class="line"><span style="color:#a6accd"># Reboot after installation</span></span>
<span class="line"><span style="color:#a6accd">reboot</span></span>
<span class="line"><span style="color:#a6accd">#Firewall configuration</span></span>
<span class="line"><span style="color:#a6accd">firewall --disabled </span></span>
<span class="line"><span style="color:#a6accd">#SELinux configuration</span></span>
<span class="line"><span style="color:#a6accd">selinux --disabled</span></span>
<span class="line"><span style="color:#a6accd">#Service configuration</span></span>
<span class="line"><span style="color:#a6accd">services --disabled=postfix</span></span>
<span class="line"><span style="color:#a6accd">#Do not configure XWindows</span></span>
<span class="line"><span style="color:#a6accd">skipx</span></span>
<span class="line"><span style="color:#a6accd">#Package install information</span></span>
<span class="line"><span style="color:#a6accd">%packages</span></span>
<span class="line"><span style="color:#a6accd">@ base</span></span>
<span class="line"><span style="color:#a6accd">@ core</span></span>
<span class="line"><span style="color:#a6accd">bash-completion</span></span>
<span class="line"><span style="color:#a6accd">sysstat</span></span>
<span class="line"><span style="color:#a6accd">ntp</span></span>
<span class="line"><span style="color:#a6accd">lrzsz</span></span>
<span class="line"><span style="color:#a6accd">openssl-devel</span></span>
<span class="line"><span style="color:#a6accd">zlib-devel</span></span>
<span class="line"><span style="color:#a6accd">OpenIPMI-tools</span></span>
<span class="line"><span style="color:#a6accd">screen</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><h3 id="_1-2-2-tftp-server" tabindex="-1">1.2.2 TFTP-Server <a class="header-anchor" href="#_1-2-2-tftp-server" aria-hidden="true">#</a></h3><p>PXE+Kickstartdhcptftp-server</p><ol><li><p>tftp-server</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y tftp-server xinetd</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/xinetd.d/tftp</span></span>
<span class="line"><span style="color:#a6accd">disable                 = nono</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y syslinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /var/lib/tftpboot/pxelinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/pxelinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /mnt/isolinux/* /var/lib/tftpboot/pxelinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /mnt/images/pxeboot/{vmlinuz,initrd.img} /var/lib/tftpboot/pxelinux/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p>tftpbootpxelinux.cfg</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /var/lib/tftpboot/pxelinux/pxelinux.cfg </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /mnt/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux/pxelinux.cfg/default</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>defaultkickstart</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /var/lib/tftpboot/pxelinux.cfg/default</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#label linux</span></span>
<span class="line"><span style="color:#a6accd">label ks</span></span>
<span class="line"><span style="color:#a6accd">  menu label ^Auto Install CentOS 7</span></span>
<span class="line"><span style="color:#a6accd">  kernel vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">  append initrd=initrd.img ip=dhcp inst.repo=http://192.168.56.11/CentOS-7-x86_64/ inst.ks=http://192.168.56.11/CentOS-7-x86_64/CentOS-7-x86_64.cfg net.ifnames=0 biosdevname=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>DHCP Server</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y dhcp</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# /bin/cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example /etc/dhcp/dhcpd.conf</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/dhcp/dhcpd.conf</span></span>
<span class="line"><span style="color:#a6accd">option domain-name "devopsedu.com";</span></span>
<span class="line"><span style="color:#a6accd">option domain-name-servers 192.168.56.2;</span></span>
<span class="line"><span style="color:#a6accd">#subnet</span></span>
<span class="line"><span style="color:#a6accd">subnet 192.168.56.0 netmask 255.255.255.0 {</span></span>
<span class="line"><span style="color:#a6accd">     range dynamic-bootp 192.168.56.100 192.168.56.200;</span></span>
<span class="line"><span style="color:#a6accd">     option subnet-mask              255.255.255.0;  #</span></span>
<span class="line"><span style="color:#a6accd">option routers                  192.168.56.2;    #</span></span>
<span class="line"><span style="color:#a6accd">     next-server                     192.168.56.11;   #TFTP-Server</span></span>
<span class="line"><span style="color:#a6accd">     filename                        "pxelinux/pxelinux.0";   #TFTP</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>httpdtftpdhcpd</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start xinetd.service dhcpd.service httpd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp</span></span>
<span class="line"><span style="color:#a6accd">Active Internet connections (only servers)</span></span>
<span class="line"><span style="color:#a6accd">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span></span>
<span class="line"><span style="color:#a6accd">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      871/sshd            </span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::80                   :::*                    LISTEN      1321/httpd          </span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::22                   :::*                    LISTEN      871/sshd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p>dhcpdtftpd</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -nulp</span></span>
<span class="line"><span style="color:#a6accd">Active Internet connections (only servers)</span></span>
<span class="line"><span style="color:#a6accd">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span></span>
<span class="line"><span style="color:#a6accd">udp        0      0 0.0.0.0:67              0.0.0.0:*                           1487/dhcpd          </span></span>
<span class="line"><span style="color:#a6accd">udp        0      0 0.0.0.0:69              0.0.0.0:*                           1486/xinetd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_1-2-4-" tabindex="-1">1.2.4  <a class="header-anchor" href="#_1-2-4-" aria-hidden="true">#</a></h3><p>DHCPAuto Install CentOS </p><p>PXE+KickStart  1.PXE512DHCPTFTP 2. 3.PXEDHCPDHCPIP 4.DHCPIPpxeTFTP next-server 192.168.56.11 filename "pxelinux.0" 5.pxelinux.0PXEpxelinux.cfgdefault 6.pxeks.cfg</p><p><strong></strong> </p><ul><li><p> DHCPTFTPDNSHTTPFTP  NFS</p></li><li><p> DHCP  TFTP </p></li><li><p> kickstart  autoinst</p></li><li><p> HTTP/FTP/NFS  DHCPCobbler <a href="http://cobbler.github.io/" target="_blank" rel="noreferrer">http://cobbler.github.io/</a></p></li></ul><h1 id="_2-cobbler" tabindex="-1">2 Cobbler <a class="header-anchor" href="#_2-cobbler" aria-hidden="true">#</a></h1><p> CobblerCobblerPXEDHCP  TFTPCobbler </p><ul><li> DHCP  DHCP</li><li>yum  rsync</li><li> DHCP IP  MAC </li><li> TFTFP  PXE </li><li> DHCP </li><li></li></ul><h2 id="_2-1-cobbler" tabindex="-1">2.1 Cobbler <a class="header-anchor" href="#_2-1-cobbler" aria-hidden="true">#</a></h2><h3 id="_2-1-1-cobbler" tabindex="-1">2.1.1 Cobbler <a class="header-anchor" href="#_2-1-1-cobbler" aria-hidden="true">#</a></h3><p>Cobbler Red HatFedoraCentOSDebianUbuntu  SuSE ISO Cobbler </p><p>Cobbler  kickstart  Red Hat  Fedora  kickstart  kickstart  $domain  $machine_name Cobbler  <a href="http://domain=mydomain.com" target="_blank" rel="noreferrer">domain=mydomain.com</a> machine_name  kickstart  <a href="http://domain=mydomain.com" target="_blank" rel="noreferrer">domain=mydomain.com</a>  kickstart </p><p> koan Cobbler  koan </p><h3 id="_2-1-2-cobbler" tabindex="-1">2.1.2 Cobbler <a class="header-anchor" href="#_2-1-2-cobbler" aria-hidden="true">#</a></h3><ol><li>EPEL</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>yumcobbler</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y httpd dhcp tftp python-ctypes cobbler cobbler-web pykickstart fence-agents xinetd debmirror</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>cobbler</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable httpd cobblerd</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd cobblerd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Cobbler</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler get-loaders</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Cobbler</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler check</span></span>
<span class="line"><span style="color:#a6accd">The following are potential configuration items that you may want to fix:</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1 : The 'server' field in /etc/cobbler/settings must be set to something other than localhost, or kickstarting features will not work.  This should be a resolvable hostname or IP for the boot server as reachable by all machines that will use it.</span></span>
<span class="line"><span style="color:#a6accd">2 : For PXE to be functional, the 'next_server' field in /etc/cobbler/settings must be set to something other than 127.0.0.1, and should match the IP of the boot server on the PXE network.</span></span>
<span class="line"><span style="color:#a6accd">3 : change 'disable' to 'no' in /etc/xinetd.d/tftp</span></span>
<span class="line"><span style="color:#a6accd">4 : enable and start rsyncd.service with systemctl</span></span>
<span class="line"><span style="color:#a6accd">5 : comment out 'dists' on /etc/debmirror.conf for proper debian support</span></span>
<span class="line"><span style="color:#a6accd">6 : comment out 'arches' on /etc/debmirror.conf for proper debian support</span></span>
<span class="line"><span style="color:#a6accd">7 : The default password used by the sample templates for newly installed machines (default_password_crypted in /etc/cobbler/settings) is still set to 'cobbler' and should be changed, try: "openssl passwd -1 -salt 'random-phrase-here' 'your-password-here'" to generate new one</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Restart cobblerd and then run 'cobbler sync' to apply changes.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>cobblerdcobbler sync</p><p><strong>7</strong></p><ul><li>12</li></ul><p>cobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">#127.0.0.1</span></span>
<span class="line"><span style="color:#a6accd">server: 192.168.56.11   #cobbler serverIP</span></span>
<span class="line"><span style="color:#a6accd">next_server: 192.168.56.11  #PXE serverIP</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>3</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/xinetd.d/tftp</span></span>
<span class="line"><span style="color:#a6accd">service tftp</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">        socket_type             = dgram</span></span>
<span class="line"><span style="color:#a6accd">        protocol                = udp</span></span>
<span class="line"><span style="color:#a6accd">        wait                    = yes</span></span>
<span class="line"><span style="color:#a6accd">        user                    = root</span></span>
<span class="line"><span style="color:#a6accd">        server                  = /usr/sbin/in.tftpd</span></span>
<span class="line"><span style="color:#a6accd">        server_args             = -s /var/lib/tftpboot</span></span>
<span class="line"><span style="color:#a6accd">        disable                 = no</span></span>
<span class="line"><span style="color:#a6accd">        per_source              = 11</span></span>
<span class="line"><span style="color:#a6accd">        cps                     = 100 2</span></span>
<span class="line"><span style="color:#a6accd">        flags                   = IPv4</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>4</li></ul><p>rsyncd</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable rsyncd</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start rsyncd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>56</li></ul><p>debmirrordebian</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y debmirror</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/debmirror.conf</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">#@dists="sid";</span></span>
<span class="line"><span style="color:#a6accd">#@arches="i386"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>7</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl passwd -1 -salt 'example' 'devopsedu.com'</span></span>
<span class="line"><span style="color:#a6accd">$1$example$I.i3m26O7QYNja8p5Cj9.0 </span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">default_password_crypted: "$1$example$I.i3m26O7QYNja8p5Cj9.0"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart cobblerd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Cobbler</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"> [root@ops-node1 ~]# cobbler check</span></span>
<span class="line"><span style="color:#a6accd">No configuration problems found.  All systems go.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-3-cobblerdhcp" tabindex="-1">2.1.3 CobblerDHCP <a class="header-anchor" href="#_2-1-3-cobblerdhcp" aria-hidden="true">#</a></h3><ol><li>DHCPCobblerDHCP</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">manage_dhcp: 1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>dhcp</li></ol><p>dhcpDHCPIP</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# vim /etc/cobbler/dhcp.template </span></span>
<span class="line"><span style="color:#a6accd">subnet 192.168.56.0 netmask 255.255.255.0 {</span></span>
<span class="line"><span style="color:#a6accd">     option routers             192.168.56.2;</span></span>
<span class="line"><span style="color:#a6accd">     option domain-name-servers 192.168.56.2;</span></span>
<span class="line"><span style="color:#a6accd">     option subnet-mask         255.255.255.0;</span></span>
<span class="line"><span style="color:#a6accd">     range dynamic-bootp        192.168.56.100 192.168.56.254;</span></span>
<span class="line"><span style="color:#a6accd">     default-lease-time         21600;</span></span>
<span class="line"><span style="color:#a6accd">     max-lease-time             43200;</span></span>
<span class="line"><span style="color:#a6accd">     next-server                $next_server;</span></span>
<span class="line"><span style="color:#a6accd">  </span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Cobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart cobblerd </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler sync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>cobbler sync/etc/dhcpd.confdhcpCobblerDHCP/etc/dhcpd.confdhcpCobblerDHCP/etc/cobbler/dhcp.template</p></blockquote><h3 id="_2-1-4-cobbler" tabindex="-1">2.1.4 Cobbler <a class="header-anchor" href="#_2-1-4-cobbler" aria-hidden="true">#</a></h3><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# wget https://mirror.tuna.tsinghua.edu.cn/centos/7.7.1908/isos/x86_64/CentOS-7-x86_64-Minimal-1908.iso</span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# mmount -o loop /usr/local/src/CentOS-7-x86_64-Minimal-1908.iso /mnt/</span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cobbler import --path=/mnt/ --name=CentOS-7.7-x86_64 --arch=x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>:</strong></p><ul><li>--name </li><li>--arch 3264ia64, : x86x86_64ia64</li></ul><blockquote><p>Cobbler ISO: /var/www/cobbler/ks_mirror/</p></blockquote><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler list</span></span>
<span class="line"><span style="color:#a6accd">distros:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">profiles:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-5-kickstart" tabindex="-1">2.1.5 kickstart <a class="header-anchor" href="#_2-1-5-kickstart" aria-hidden="true">#</a></h3><p>CobblerKickstartCobblerkickstartCobblerkickstart/var/lib/cobbler/kickstartsCobblerkickstart</p><ol><li>Kickstart</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /var/lib/cobbler/kickstarts/CentOS-7.7-x86_64-Cobbler.cfg</span></span>
<span class="line"><span style="color:#a6accd">#Kickstart Configurator by Jason Zhao</span></span>
<span class="line"><span style="color:#a6accd">#platform=x86, AMD64, or Intel EM64T</span></span>
<span class="line"><span style="color:#a6accd">#System  language</span></span>
<span class="line"><span style="color:#a6accd">lang en_US</span></span>
<span class="line"><span style="color:#a6accd">#System keyboard</span></span>
<span class="line"><span style="color:#a6accd">keyboard us</span></span>
<span class="line"><span style="color:#a6accd">#Sytem timezone</span></span>
<span class="line"><span style="color:#a6accd">timezone Asia/Shanghai</span></span>
<span class="line"><span style="color:#a6accd">#Root password</span></span>
<span class="line"><span style="color:#a6accd">rootpw --iscrypted $default_password_crypted</span></span>
<span class="line"><span style="color:#a6accd">#Use text mode install</span></span>
<span class="line"><span style="color:#a6accd">text</span></span>
<span class="line"><span style="color:#a6accd">#Install OS instead of upgrade</span></span>
<span class="line"><span style="color:#a6accd">install</span></span>
<span class="line"><span style="color:#a6accd">#Use NFS installation Media</span></span>
<span class="line"><span style="color:#a6accd">url --url=$tree</span></span>
<span class="line"><span style="color:#a6accd">#System bootloader configuration</span></span>
<span class="line"><span style="color:#a6accd">bootloader --location=mbr --driveorder=sda --append="net.ifnames=0 biosdevname=0"</span></span>
<span class="line"><span style="color:#a6accd">#Clear the Master Boot Record</span></span>
<span class="line"><span style="color:#a6accd">zerombr</span></span>
<span class="line"><span style="color:#a6accd">#Partition clearing information</span></span>
<span class="line"><span style="color:#a6accd">clearpart --all --initlabel </span></span>
<span class="line"><span style="color:#a6accd">#Disk partitioning information</span></span>
<span class="line"><span style="color:#a6accd">part /boot --fstype=xfs --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part swap --asprimary --fstype="swap" --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part / --fstype=xfs --size=1 --grow</span></span>
<span class="line"><span style="color:#a6accd">#System authorization infomation</span></span>
<span class="line"><span style="color:#a6accd">auth  --useshadow  --enablemd5 </span></span>
<span class="line"><span style="color:#a6accd">#Network information</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('network_config')</span></span>
<span class="line"><span style="color:#a6accd"># Reboot after installation</span></span>
<span class="line"><span style="color:#a6accd">reboot</span></span>
<span class="line"><span style="color:#a6accd">#Firewall configuration</span></span>
<span class="line"><span style="color:#a6accd">firewall --disabled </span></span>
<span class="line"><span style="color:#a6accd">#SELinux configuration</span></span>
<span class="line"><span style="color:#a6accd">selinux --disabled</span></span>
<span class="line"><span style="color:#a6accd">#Service configuration</span></span>
<span class="line"><span style="color:#a6accd">services --disabled=postfix</span></span>
<span class="line"><span style="color:#a6accd">#Do not configure XWindows</span></span>
<span class="line"><span style="color:#a6accd">skipx</span></span>
<span class="line"><span style="color:#a6accd">#Package install information</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">%pre</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('log_ks_pre')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('kickstart_start')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('pre_install_network_config')</span></span>
<span class="line"><span style="color:#a6accd"># Enable installation monitoring</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('pre_anamon')</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">%packages</span></span>
<span class="line"><span style="color:#a6accd">@ base</span></span>
<span class="line"><span style="color:#a6accd">@ core</span></span>
<span class="line"><span style="color:#a6accd">bash-completion</span></span>
<span class="line"><span style="color:#a6accd">sysstat</span></span>
<span class="line"><span style="color:#a6accd">ntp</span></span>
<span class="line"><span style="color:#a6accd">lrzsz</span></span>
<span class="line"><span style="color:#a6accd">openssl-devel</span></span>
<span class="line"><span style="color:#a6accd">zlib-devel</span></span>
<span class="line"><span style="color:#a6accd">OpenIPMI-tools</span></span>
<span class="line"><span style="color:#a6accd">screen</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>profilekickstart</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cobbler profile edit --name=CentOS-7.7-x86_64 --kickstart=/var/lib/cobbler/kickstarts/CentOS-7.7-x86_64-Cobbler.cfg</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cobbler profile edit --name=CentOS-7.7-x86_64 --kopts='net.ifnames=0 biosdevname=0'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Cobbler</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler sync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_2-2-cobblercentos" tabindex="-1">2.2 CobblerCentOS <a class="header-anchor" href="#_2-2-cobblercentos" aria-hidden="true">#</a></h2><p>CobblerCobblerLocal</p><h3 id="_2-2-1-cobblercentos" tabindex="-1">2.2.1 CobblerCentOS <a class="header-anchor" href="#_2-2-1-cobblercentos" aria-hidden="true">#</a></h3><ol><li></li><li>CentOS-7.7-x86_64</li></ol><blockquote><p>VLAN</p></blockquote><h3 id="_2-2-2-koan" tabindex="-1">2.2.2 Koan <a class="header-anchor" href="#_2-2-2-koan" aria-hidden="true">#</a></h3><p>CobblerKoankoan</p><p>Koan</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">[root@localhost ~]# yum install -y koan</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# koan --server=192.168.56.11 --list=profiles</span></span>
<span class="line"><span style="color:#a6accd">- looking for Cobbler at http://192.168.56.11:80/cobbler_api</span></span>
<span class="line"><span style="color:#a6accd">CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# koan --replace-self --server=192.168.56.11 --profile=CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">- looking for Cobbler at http://192.168.56.11:80/cobbler_api</span></span>
<span class="line"><span style="color:#a6accd">- reading URL: http://192.168.56.11/cblr/svc/op/ks/profile/CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">install_tree: http://192.168.56.11/cblr/links/CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">downloading initrd initrd.img to /boot/initrd.img_koan</span></span>
<span class="line"><span style="color:#a6accd">url=http://192.168.56.11/cobbler/images/CentOS-7.7-x86_64/initrd.img</span></span>
<span class="line"><span style="color:#a6accd">- reading URL: http://192.168.56.11/cobbler/images/CentOS-7.7-x86_64/initrd.img</span></span>
<span class="line"><span style="color:#a6accd">downloading kernel vmlinuz to /boot/vmlinuz_koan</span></span>
<span class="line"><span style="color:#a6accd">url=http://192.168.56.11/cobbler/images/CentOS-7.7-x86_64/vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">- reading URL: http://192.168.56.11/cobbler/images/CentOS-7.4-x86_64/vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">- ['/sbin/grubby', '--add-kernel', '/boot/vmlinuz_koan', '--initrd', '/boot/initrd.img_koan', '--args', '"ksdevice=link lang= text net.ifnames=0 ks=http://192.168.56.11/cblr/svc/op/ks/profile/CentOS-7.4-x86_64 biosdevname=0 kssendmac "', '--copy-default', '--make-default', '--title=kick1526449287']</span></span>
<span class="line"><span style="color:#a6accd">- ['/sbin/grubby', '--update-kernel', '/boot/vmlinuz_koan', '--remove-args=root']</span></span>
<span class="line"><span style="color:#a6accd">- reboot to apply changes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Koan</p><p>rebootGrub</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vim /boot/grub2/grub.cfg</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">menuentry 'kick1526449287' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-693.el7.x86_64-advanced-49e658db-2c61-475a-9325-903fdbeb7cd4' {</span></span>
<span class="line"><span style="color:#a6accd">        load_video</span></span>
<span class="line"><span style="color:#a6accd">        set gfxpayload=keep</span></span>
<span class="line"><span style="color:#a6accd">        insmod gzio</span></span>
<span class="line"><span style="color:#a6accd">        insmod part_msdos</span></span>
<span class="line"><span style="color:#a6accd">        insmod xfs</span></span>
<span class="line"><span style="color:#a6accd">        set root='hd0,msdos1'</span></span>
<span class="line"><span style="color:#a6accd">        if [ x$feature_platform_search_hint = xy ]; then</span></span>
<span class="line"><span style="color:#a6accd">          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1'  0a801c26-5320-448d-b261-883499529bc6</span></span>
<span class="line"><span style="color:#a6accd">        else</span></span>
<span class="line"><span style="color:#a6accd">          search --no-floppy --fs-uuid --set=root 0a801c26-5320-448d-b261-883499529bc6</span></span>
<span class="line"><span style="color:#a6accd">        fi</span></span>
<span class="line"><span style="color:#a6accd">        linux16 /vmlinuz_koan ro crashkernel=auto biosdevname=0 net.ifnames=0 rhgb quiet LANG=en_US.UTF-8 ksdevice=link lang= text net.ifnames=0 ks=http://192.168.56.11/cblr/svc/op/ks/profile/CentOS-7.4-x86_64 biosdevname=0 kssendmac</span></span>
<span class="line"><span style="color:#a6accd">        initrd16 /initrd.img_koan</span></span>
<span class="line"><span style="color:#a6accd">koanGrub</span></span>
<span class="line"><span style="color:#a6accd">[root@hadoop-node1 ~]# reboot</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><h2 id="_2-3-cobbler-web" tabindex="-1">2.3 Cobbler Web <a class="header-anchor" href="#_2-3-cobbler-web" aria-hidden="true">#</a></h2><p>CobblerWebCobbler Webyum/etc/http/conf.d/cobbler_web.conf<a href="https://ip/cobbler_web%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E3%80%82" target="_blank" rel="noreferrer">https://IP/cobbler_web</a></p><ol><li><p>Cobbler Web</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y cobbler-web</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Cobbler Web</p></li></ol><p>Cobbler web /etc/cobbler/users.conf/etc/cobbler/users.digest Cobblerhtdigest</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# htdigest  /etc/cobbler/users.digest "Cobbler" cobbler</span></span>
<span class="line"><span style="color:#a6accd">Changing password for user cobbler in realm Cobbler</span></span>
<span class="line"><span style="color:#a6accd">New password: </span></span>
<span class="line"><span style="color:#a6accd">Re-type new password:</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>cobbler <a href="https://192.168.56.11/cobbler_web" target="_blank" rel="noreferrer">https://192.168.56.11/cobbler_web</a></p><h2 id="_2-4-cobbler" tabindex="-1">2.4 Cobbler <a class="header-anchor" href="#_2-4-cobbler" aria-hidden="true">#</a></h2><p>CobblerKoanCobbler</p><h3 id="_2-4-1-cobbler-" tabindex="-1">2.4.1 Cobbler  <a class="header-anchor" href="#_2-4-1-cobbler-" aria-hidden="true">#</a></h3><ol><li>Cobbler Cobbler</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# find / -name cobbler</span></span>
<span class="line"><span style="color:#a6accd">/etc/selinux/targeted/active/modules/100/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/etc/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/var/lib/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/var/log/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/var/www/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/usr/bin/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/usr/lib/python2.7/site-packages/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/usr/share/cobbler</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Cobbler</li></ol><p>Cobbler/etc/cobbler</p><ul><li>/etc/cobbler/settings</li><li>/etc/cobblerdhcpdnspxednsmasq</li><li>/etc/cobbler/users.digestweb</li><li>/etc/cobbler/modules.conf </li><li>/etc/cobbler/users.confCobbler WebUI/Web service</li><li>Cobbler</li></ul><p>Cobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@test-node1 ~]# vim /etc/cobbler/pxe/pxedefault.template</span></span>
<span class="line"><span style="color:#a6accd">DEFAULT menu</span></span>
<span class="line"><span style="color:#a6accd">PROMPT 0</span></span>
<span class="line"><span style="color:#a6accd">MENU TITLE DevOpsEDU | http://www.devopsedu.com</span></span>
<span class="line"><span style="color:#a6accd">TIMEOUT 200</span></span>
<span class="line"><span style="color:#a6accd">TOTALTIMEOUT 6000</span></span>
<span class="line"><span style="color:#a6accd">ONTIMEOUT $pxe_timeout_profile</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">LABEL local</span></span>
<span class="line"><span style="color:#a6accd">        MENU LABEL (local)</span></span>
<span class="line"><span style="color:#a6accd">        MENU DEFAULT</span></span>
<span class="line"><span style="color:#a6accd">        LOCALBOOT -1</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">$pxe_menu_items</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">MENU end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Cobbler/var/lib/cobbler</li></ol><p>Cobbler profilessystemsdistros</p><ul><li>configs/ - distrosrepossystemsprofiles</li><li>backup/ - </li><li>snippets/ - kickstarts</li><li>triggers/ - </li><li>kickstarts/ - kickstart</li><li>Repo/var/www/cobbler</li></ul><p>reposkickstart/var/www/cobbler/var</p><ul><li>images/ - Kernelinitrd</li><li>ks_mirror/ - </li><li>repo_mirror/ - yum repos</li><li>Cobbler</li></ul><p>/var/log/cobbler/var/log/cobbler/cobbler.log</p><h3 $cs="" id="_2-4-2-cobbler" tabindex="-1">2.4.2 Cobbler <a class="header-anchor" href="#_2-4-2-cobbler" aria-hidden="true">#</a></h3><p>Cobbler </p><ul><li>Repo yum  rsync ZabbixRepo</li><li>Distro initrd </li><li>profiledistro kickstart Repo</li><li>system IP  MAC </li><li>Image initrd  Cobbler </li></ul><h3 id="_2-4-3-cobbler-distro" tabindex="-1">2.4.3 Cobbler distro <a class="header-anchor" href="#_2-4-3-cobbler-distro" aria-hidden="true">#</a></h3><p>CobblerDistrocobbler importdistro</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler distro list</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Cobblerhelp</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler distro help</span></span>
<span class="line"><span style="color:#a6accd">usage</span></span>
<span class="line"><span style="color:#a6accd">=====</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro add</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro copy</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro edit</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro find</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro list</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro remove</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro rename</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro report</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>reportdistro</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler distro report</span></span>
<span class="line"><span style="color:#a6accd">Name                           : CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">Architecture                   : x86_64</span></span>
<span class="line"><span style="color:#a6accd">TFTP Boot Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Breed                          : redhat</span></span>
<span class="line"><span style="color:#a6accd">Comment                        : </span></span>
<span class="line"><span style="color:#a6accd">Fetchable Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Initrd                         : /var/www/cobbler/ks_mirror/CentOS-7.7-x86_64/images/pxeboot/initrd.img</span></span>
<span class="line"><span style="color:#a6accd">Kernel                         : /var/www/cobbler/ks_mirror/CentOS-7.7-x86_64/images/pxeboot/vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options                 : {}</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options (Post Install)  : {}</span></span>
<span class="line"><span style="color:#a6accd">Kickstart Metadata             : {'tree': 'http://@@http_server@@/cblr/links/CentOS-7.7-x86_64'}</span></span>
<span class="line"><span style="color:#a6accd">Management Classes             : []</span></span>
<span class="line"><span style="color:#a6accd">OS Version                     : rhel7</span></span>
<span class="line"><span style="color:#a6accd">Owners                         : ['admin']</span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Template Files                 : {}</span></span>
<span class="line"><span style="color:#a6accd">  distrokernelinitrd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-4-cobbler-profile" tabindex="-1">2.1.4 Cobbler profile <a class="header-anchor" href="#_2-1-4-cobbler-profile" aria-hidden="true">#</a></h3><p>cobbler importdistroprofilecobbler profiledistributionkickstart filerepoprofiledistrokiskstart cobbler profile editProfilekickstartprofilecobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler profile report</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-5cobbler-repo" tabindex="-1">2.1.5Cobbler repo <a class="header-anchor" href="#_2-1-5cobbler-repo" aria-hidden="true">#</a></h3><p>Cobbler reposyumyumEPEL EPEL</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># cobbler repo add --name=CentOS-7-x86_64-epel \</span></span>
<span class="line"><span style="color:#a6accd">--mirror=http://mirrors.aliyun.com/epel/7/x86_64/ --arch=x86_64 --breed=wget</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>: --name  --arch 3264ia64, : x86x86_64ia64 reposync  reposync screen</p><p>repoprofile repoprofileprofilerepo</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># cobbler profile edit --name=CentOS-7-x86_64 --repos="openstack-liberty"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">yum_post_install_mirror: 1  #</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> crontab echo "0 2 0 cobbler reposync --tries=3 --no-fail" &gt;&gt; /var/spool/cron/root</p><p>Yum ks</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">%post</span></span>
<span class="line"><span style="color:#a6accd"># Start yum configuration</span></span>
<span class="line"><span style="color:#a6accd">$yum_config_stanza</span></span>
<span class="line"><span style="color:#a6accd"># End yum configuration</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd">yum_config_stanzasnippetssnippets</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-6-cobbler-snippets" tabindex="-1">2.1.6 Cobbler snippets <a class="header-anchor" href="#_2-1-6-cobbler-snippets" aria-hidden="true">#</a></h3><p>snippetscobblercobblerSnippetCobblerkickstartsnippets</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /var/lib/cobbler/kickstarts/sample_end.ks</span></span>
<span class="line"><span style="color:#a6accd">%post</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('log_ks_post')</span></span>
<span class="line"><span style="color:#a6accd"># Start yum configuration</span></span>
<span class="line"><span style="color:#a6accd">$yum_config_stanza</span></span>
<span class="line"><span style="color:#a6accd"># End yum configuration</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('post_install_kernel_options')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('post_install_network_config')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('func_register_if_enabled')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('download_config_files')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('koan_environment')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('redhat_register')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('cobbler_register')</span></span>
<span class="line"><span style="color:#a6accd"># Enable post-install boot notification</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('post_anamon')</span></span>
<span class="line"><span style="color:#a6accd"># Start final steps</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('kickstart_done')</span></span>
<span class="line"><span style="color:#a6accd"># End final steps</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>%post%end /var/lib/cobbler/kickstarts/CentOS-7.4-x86_64-Cobbler.cfg</p><h1 id="_3-cobbler" tabindex="-1">3 Cobbler <a class="header-anchor" href="#_3-cobbler" aria-hidden="true">#</a></h1><p>CobblerCobblerCobbler</p><h2 id="_3-1-cobbleryum" tabindex="-1">3.1 CobblerYUM <a class="header-anchor" href="#_3-1-cobbleryum" aria-hidden="true">#</a></h2><p>CobblerYUMCobbler</p><h3 id="_3-1-1-openstack" tabindex="-1">3.1.1 OpenStack <a class="header-anchor" href="#_3-1-1-openstack" aria-hidden="true">#</a></h3><p>OpenStack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo add --name=openstack-queens-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd"> --mirror=http://mirrors.aliyun.com/centos/7.4.1708/cloud/x86_64/openstack-queens/ \</span></span>
<span class="line"><span style="color:#a6accd"> --arch=x86_64 --breed=yum</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> yum  URLCobbler  <a href="http://xn--ftp-3y3b//%E3%80%81rsync://%E3%80%81%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%B7%AF%E5%BE%84%E5%92%8C" target="_blank" rel="noreferrer">http://ftp://rsync://</a> ssh </p><ul><li>http </li><li>rsync rsync </li></ul><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>OpenStack Queens900M</p></blockquote><h3 id="_3-1-2-zabbix" tabindex="-1">3.1.2 Zabbix <a class="header-anchor" href="#_3-1-2-zabbix" aria-hidden="true">#</a></h3><p>Zabbixrsynchttp</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo add --name=zabbix-3.4-rhel7-x86_64  \</span></span>
<span class="line"><span style="color:#a6accd">--mirror=http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo list</span></span>
<span class="line"><span style="color:#a6accd">   zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>Zabbix 3.420M</p></blockquote><h3 id="_3-1-3-saltstack" tabindex="-1">3.1.3 SaltStack <a class="header-anchor" href="#_3-1-3-saltstack" aria-hidden="true">#</a></h3><p>SaltStackCobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo add --name=saltstack-2018.3-rhel7-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd"> --mirror=https://repo.saltstack.com/yum/redhat/7/x86_64/2018.3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>SaltStack 2018.350M</p></blockquote><h3 id="_3-1-4-profile" tabindex="-1">3.1.4 Profile <a class="header-anchor" href="#_3-1-4-profile" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo list</span></span>
<span class="line"><span style="color:#a6accd">   openstack-queens-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   saltstack-2018.3-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>RepoProfileProfile reposyncProfilerepo</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler profile edit --name CentOS-7.4-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd">--repos="openstack-queens-rhel7-x86_64 saltstack-2018.3-rhel7-x86_64 zabbix-3.4-rhel7-x86_64"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Profile CentOS-7.4-x86_64cobbler-config.repo</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# cd /etc/yum.repos.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@localhost yum.repos.d]# cat cobbler-config.repo </span></span>
<span class="line"><span style="color:#a6accd">[openstack-queens-rhel7-x86_64]</span></span>
<span class="line"><span style="color:#a6accd">name=openstack-queens-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">baseurl=http://192.168.56.11/cobbler/repo_mirror/openstack-queens-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">priority=99</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[saltstack-2018.3-rhel7-x86_64]</span></span>
<span class="line"><span style="color:#a6accd">name=saltstack-2018.3-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">baseurl=http://192.168.56.11/cobbler/repo_mirror/saltstack-2018.3-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">priority=99</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[zabbix-3.4-rhel7-x86_64]</span></span>
<span class="line"><span style="color:#a6accd">name=zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">baseurl=http://192.168.56.11/cobbler/repo_mirror/zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">priority=99</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_3-2-cobbleresxi" tabindex="-1">3.2 CobblerESXi <a class="header-anchor" href="#_3-2-cobbleresxi" aria-hidden="true">#</a></h2><ol><li>ESXI</li></ol><p>Vmware WorkstationESXi6.5</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mount /dev/cdrom /mnt/</span></span>
<span class="line"><span style="color:#a6accd">mount: /dev/sr0 is write-protected, mounting read-only</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler import --path=/mnt --name=ESXi6.5 --arch=x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>distrosprofiles</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler list</span></span>
<span class="line"><span style="color:#a6accd">distros:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7.4-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">profiles:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7.4-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>kickstart</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler profile report --name ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd">Name                           : ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd">TFTP Boot Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Comment                        : </span></span>
<span class="line"><span style="color:#a6accd">DHCP Tag                       : default</span></span>
<span class="line"><span style="color:#a6accd">Distribution                   : ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd">Enable gPXE?                   : 0</span></span>
<span class="line"><span style="color:#a6accd">Enable PXE Menu?               : 1</span></span>
<span class="line"><span style="color:#a6accd">Fetchable Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options                 : {}</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options (Post Install)  : {}</span></span>
<span class="line"><span style="color:#a6accd">Kickstart                      : /var/lib/cobbler/kickstarts/sample_esxi6.ks</span></span>
<span class="line"><span style="color:#a6accd">Kickstart Metadata             : {}</span></span>
<span class="line"><span style="color:#a6accd">Management Classes             : []</span></span>
<span class="line"><span style="color:#a6accd">Management Parameters          : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Name Servers                   : []</span></span>
<span class="line"><span style="color:#a6accd">Name Servers Search Path       : []</span></span>
<span class="line"><span style="color:#a6accd">Owners                         : ['admin']</span></span>
<span class="line"><span style="color:#a6accd">Parent Profile                 : </span></span>
<span class="line"><span style="color:#a6accd">Internal proxy                 : </span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Repos                          : []</span></span>
<span class="line"><span style="color:#a6accd">Server Override                : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Template Files                 : {}</span></span>
<span class="line"><span style="color:#a6accd">Virt Auto Boot                 : 1</span></span>
<span class="line"><span style="color:#a6accd">Virt Bridge                    : xenbr0</span></span>
<span class="line"><span style="color:#a6accd">Virt CPUs                      : 1</span></span>
<span class="line"><span style="color:#a6accd">Virt Disk Driver Type          : raw</span></span>
<span class="line"><span style="color:#a6accd">Virt File Size(GB)             : 5</span></span>
<span class="line"><span style="color:#a6accd">Virt Path                      : </span></span>
<span class="line"><span style="color:#a6accd">Virt RAM (MB)                  : 512</span></span>
<span class="line"><span style="color:#a6accd">Virt Type                      : kvm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>CobblerESXi</li></ol><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler sync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><h2 id="_3-3-" tabindex="-1">3.3  <a class="header-anchor" href="#_3-3-" aria-hidden="true">#</a></h2><h3 id="_3-3-1-" tabindex="-1">3.3.1  <a class="header-anchor" href="#_3-3-1-" aria-hidden="true">#</a></h3><ul><li></li><li></li><li>CMDBMAC</li><li>IPMICobbler API</li><li>SaltStackSaltStack</li></ul><p> PXE  Hostname   PXEProfile KS KS     cobbler system </p><h3 id="_3-3-2-cobbler" tabindex="-1">3.3.2 Cobbler <a class="header-anchor" href="#_3-3-2-cobbler" aria-hidden="true">#</a></h3><p>Cobbler APICobblerRedhatLinuxAnacondaCobblerAnaconda</p><ol><li><p>Anaconda</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">anamon_enabled: 1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p>Cobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart cobblerd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Kickstartsnippet ``` %pre $SNIPPET('pre_anamon')</li></ol><p>%post $SNIPPET('post_anamon')</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">3. /var/log/cobbler/anamon/System</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>[root@linux-node1 ~]# tree /var/log/cobbler/anamon/ /var/log/cobbler/anamon/  cobbler-api-test  anaconda.log  boot.log  dmesg  ks-post.log  ks-pre.log  messages  program.log  storage.log  sys.log</p><p>1 directory, 9 files</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">### 3.3.3 Cobbler system</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Cobbler systemCobblerCobbler systemIP</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1. </span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>[root@linux-node1 ~]# cobbler system add --name=linux-node3 --mac=00:50:56:3F:84:4F \ --profile=CentOS-7.4-x86_64 --ip-address=192.168.56.110 --subnet=255.255.255.0 \ --gateway=192.168.56.2 --interface=eth0 --static=1 --hostname=<a href="http://new.devopsedu.com" target="_blank" rel="noreferrer">new.devopsedu.com</a> \ --name-servers="192.168.56.2" \ --kickstart=/var/lib/cobbler/kickstarts/CentOS-7.4-x86_64-Cobbler.cfg</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">- --name=linux-node3   #</span></span>
<span class="line"><span style="color:#a6accd">- --mac=08:00:27:67:A0:BB  #MAC</span></span>
<span class="line"><span style="color:#a6accd">- --profile=CentOS-7.4-x86_64  #</span></span>
<span class="line"><span style="color:#a6accd">- --ip-address=192.168.56.13 #IP</span></span>
<span class="line"><span style="color:#a6accd">- --subnet=255.255.255.0    #</span></span>
<span class="line"><span style="color:#a6accd">- --gateway=192.168.56.2    #</span></span>
<span class="line"><span style="color:#a6accd">- --interface=eth0 \          </span></span>
<span class="line"><span style="color:#a6accd">- --static=1                 IP</span></span>
<span class="line"><span style="color:#a6accd">- --dns-name=linux-node3.example.com  #dns name</span></span>
<span class="line"><span style="color:#a6accd">- --hostname=linux-node3.example.com  #</span></span>
<span class="line"><span style="color:#a6accd">- --netboot-enabled=true #</span></span>
<span class="line"><span style="color:#a6accd">- --name-servers="192.168.56.2" #DNS</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">2. </span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>[root@linux-node1 ~]# cobbler system list linux-node3 ``` </p><h1 id="_4-cobbler" tabindex="-1">4 Cobbler <a class="header-anchor" href="#_4-cobbler" aria-hidden="true">#</a></h1><p>CobblerCobbler API</p><h2 id="_4-1-bonding" tabindex="-1">4.1 bonding <a class="header-anchor" href="#_4-1-bonding" aria-hidden="true">#</a></h2><ol><li>linux-node4</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system add --name=linux-node4 --profile=CentOS-7.7-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd"> --hostname=new.devopsedu.com \</span></span>
<span class="line"><span style="color:#a6accd"> --name-servers="192.168.56.2" \</span></span>
<span class="line"><span style="color:#a6accd"> --kickstart=/var/lib/cobbler/kickstarts/CentOS-7.7-x86_64-Cobbler.cfg</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>bonding</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node4 --interface=eth0 \</span></span>
<span class="line"><span style="color:#a6accd"> --mac=00:50:56:27:F0:07 --interface-type=bond_slave --interface-master=bond0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>bonding</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node4 --interface=eth1 \</span></span>
<span class="line"><span style="color:#a6accd"> --mac=00:50:56:36:09:66 --interface-type=bond_slave --interface-master=bond0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node4 --interface=bond0 \</span></span>
<span class="line"><span style="color:#a6accd"> --interface-type=bond --bonding-opts="miimon=100 mode=1" \</span></span>
<span class="line"><span style="color:#a6accd"> --ip-address=192.168.56.111 --subnet=255.255.255.0 --gateway=192.168.56.2 --static=1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>IPMIIPMI</p><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@new ~]# cat /proc/net/bonding/bond0 </span></span>
<span class="line"><span style="color:#a6accd">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Bonding Mode: fault-tolerance (active-backup)</span></span>
<span class="line"><span style="color:#a6accd">Primary Slave: None</span></span>
<span class="line"><span style="color:#a6accd">Currently Active Slave: eth0</span></span>
<span class="line"><span style="color:#a6accd">MII Status: up</span></span>
<span class="line"><span style="color:#a6accd">MII Polling Interval (ms): 100</span></span>
<span class="line"><span style="color:#a6accd">Up Delay (ms): 0</span></span>
<span class="line"><span style="color:#a6accd">Down Delay (ms): 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Slave Interface: eth0</span></span>
<span class="line"><span style="color:#a6accd">MII Status: up</span></span>
<span class="line"><span style="color:#a6accd">Speed: 1000 Mbps</span></span>
<span class="line"><span style="color:#a6accd">Duplex: full</span></span>
<span class="line"><span style="color:#a6accd">Link Failure Count: 0</span></span>
<span class="line"><span style="color:#a6accd">Permanent HW addr: 00:50:56:27:f0:07</span></span>
<span class="line"><span style="color:#a6accd">Slave queue ID: 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Slave Interface: eth1</span></span>
<span class="line"><span style="color:#a6accd">MII Status: up</span></span>
<span class="line"><span style="color:#a6accd">Speed: 1000 Mbps</span></span>
<span class="line"><span style="color:#a6accd">Duplex: full</span></span>
<span class="line"><span style="color:#a6accd">Link Failure Count: 0</span></span>
<span class="line"><span style="color:#a6accd">Permanent HW addr: 00:50:56:36:09:66</span></span>
<span class="line"><span style="color:#a6accd">Slave queue ID: 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_4-2-cobbler" tabindex="-1">4.2 Cobbler <a class="header-anchor" href="#_4-2-cobbler" aria-hidden="true">#</a></h2><p>IPMIcobblerIPMICobblerIPMIcobblersettings</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">power_management_default_type: 'ipmitool'</span></span>
<span class="line"><span style="color:#a6accd">power_template_dir: "/etc/cobbler/power"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node3 --power-address=192.168.0.21 --power-type='ipmilan' --power-user=ipmi --power-pass=ipmi</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><ul><li>cobbler system poweroff</li><li>cobbler system poweron</li><li>cobbler system powerstatus</li><li>cobbler system reboot</li></ul><p>PXE</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@log-node1 ~]# cobbler system edit  --name=host-188116  --netboot-enabled=1 --profile=centos5.8-x86_64</span></span>
<span class="line"><span style="color:#a6accd">[root@log-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_4-3-cobbler-api" tabindex="-1">4.3 Cobbler API <a class="header-anchor" href="#_4-3-cobbler-api" aria-hidden="true">#</a></h2><ol><li><p>Cobbler</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat cobbler.py </span></span>
<span class="line"><span style="color:#a6accd">#!/usr/bin/env python</span></span>
<span class="line"><span style="color:#a6accd">import xmlrpclib</span></span>
<span class="line"><span style="color:#a6accd">server = xmlrpclib.Server("http://192.168.56.11/cobbler_api")</span></span>
<span class="line"><span style="color:#a6accd">print server.get_distros()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_profiles()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_systems()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_images()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_repos()</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Cobbler</p></li></ol><p>CobblerCobblerCobblertokenCobblertoken</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat cobbler.py </span></span>
<span class="line"><span style="color:#a6accd">#!/usr/bin/env python</span></span>
<span class="line"><span style="color:#a6accd">import xmlrpclib</span></span>
<span class="line"><span style="color:#a6accd">server = xmlrpclib.Server("http://192.168.56.11/cobbler_api")</span></span>
<span class="line"><span style="color:#a6accd">print server.get_distros()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_profiles()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_systems()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_images()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_repos()</span></span>
<span class="line"><span style="color:#a6accd">token = server.login("cobbler","devopsedu.com")</span></span>
<span class="line"><span style="color:#a6accd">print(token)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#!/usr/bin/env python </span></span>
<span class="line"><span style="color:#a6accd"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#a6accd">import xmlrpclib </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">class CobblerAPI(object):</span></span>
<span class="line"><span style="color:#a6accd">    def __init__(self,url,user,password):</span></span>
<span class="line"><span style="color:#a6accd">        self.cobbler_user= user</span></span>
<span class="line"><span style="color:#a6accd">        self.cobbler_pass = password</span></span>
<span class="line"><span style="color:#a6accd">        self.cobbler_url = url</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">    def add_system(self,hostname,ip_add,mac_add,profile):</span></span>
<span class="line"><span style="color:#a6accd">        '''</span></span>
<span class="line"><span style="color:#a6accd">        Add Cobbler System Infomation</span></span>
<span class="line"><span style="color:#a6accd">        '''</span></span>
<span class="line"><span style="color:#a6accd">        ret = {</span></span>
<span class="line"><span style="color:#a6accd">            "result": True,</span></span>
<span class="line"><span style="color:#a6accd">            "comment": [],</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">        #get token</span></span>
<span class="line"><span style="color:#a6accd">        remote = xmlrpclib.Server(self.cobbler_url) </span></span>
<span class="line"><span style="color:#a6accd">        token = remote.login(self.cobbler_user,self.cobbler_pass) </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">        #add system</span></span>
<span class="line"><span style="color:#a6accd">        system_id = remote.new_system(token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,"name",hostname,token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,"hostname",hostname,token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,'modify_interface', { </span></span>
<span class="line"><span style="color:#a6accd">            "macaddress-eth0" : mac_add, </span></span>
<span class="line"><span style="color:#a6accd">            "ipaddress-eth0" : ip_add, </span></span>
<span class="line"><span style="color:#a6accd">            "dnsname-eth0" : hostname, </span></span>
<span class="line"><span style="color:#a6accd">        }, token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,"profile",profile,token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.save_system(system_id, token) </span></span>
<span class="line"><span style="color:#a6accd">        try:</span></span>
<span class="line"><span style="color:#a6accd">            remote.sync(token)</span></span>
<span class="line"><span style="color:#a6accd">        except Exception as e:</span></span>
<span class="line"><span style="color:#a6accd">            ret['result'] = False</span></span>
<span class="line"><span style="color:#a6accd">            ret['comment'].append(str(e))</span></span>
<span class="line"><span style="color:#a6accd">        return ret</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">def main():</span></span>
<span class="line"><span style="color:#a6accd">    cobbler = CobblerAPI("http://192.168.56.11/cobbler_api","cobbler","devopsedu.com")</span></span>
<span class="line"><span style="color:#a6accd">    ret = cobbler.add_system(hostname='cobbler-api-test',ip_add='192.168.56.111',mac_add='00:50:56:25:C2:AA',profile='CentOS-7.4-x86_64')</span></span>
<span class="line"><span style="color:#a6accd">    print ret</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">if __name__ == '__main__':</span></span>
<span class="line"><span style="color:#a6accd">    main()</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="-kvmopenstack" tabindex="-1"> KVMOpenStack <a class="header-anchor" href="#-kvmopenstack" aria-hidden="true">#</a></h1><h1 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h1><p>KVMKVMKVMOpenStack</p><h2 id="-1" tabindex="-1"> <a class="header-anchor" href="#-1" aria-hidden="true">#</a></h2><p></p><p><strong></strong></p><ul><li>15%</li><li>IT</li><li></li></ul><p><strong></strong></p><p>Cloud Computing ,NIST</p><p><strong></strong></p><ol><li></li><li></li><li></li></ol><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>,1-1</p><p>1-1</p><p><strong></strong></p><p>Internet </p><p><strong></strong> IAAS </p><p><strong></strong>   </p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>Infrastructure-as-a- ServicePlatform-as-a-ServiceSoftware-as-a-Service</p><p>1-6 IaaS(Infrastructure as a Service)IaaS/IaaSAWS(Elastic Compute Cloud)IBMVmwareIT IaaS""OpenStackIAAS PaaS(Platform as a Service)GoogleApp EngineSAEPASSDockerPAASPAASDocker SaaS(Software as a Service)"(on demand)"GoogleGmailJiraSAAS</p><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p> 1.1.1</p><p>1-1</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p> Full Virtualization) guestVMMVirtual Machine MonitorGuestOSHypervisor1-2</p><p>1-2 KVMKVMLinuxHypervisorX86Intel VTAMD-VLinuxLinuxLinux1-3</p><p>Para VirtualizationHypervisorguestguestguest1-4</p><p>1-4 XenXen(Hypervisor),XenhypervisorXenxen(Windows)hypervisor1-5</p><p>1-5 Xen VMMhypervisorHypervisor HypervisorXenDomainDomain0,hypervisor domain0domain0XenDomainUdomainUdomain</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p> KVMXenVMWARE ESXiESXi</p><p><strong></strong></p><p>IT Win7RDPVNCSpice IAASDAAS Desktop As a Service.IAASSAASDAAS</p><p><strong></strong></p><p>C/SWebCirtrixXenappERP </p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p> Internet </p><h1 id="_2-kvm" tabindex="-1">2 KVM <a class="header-anchor" href="#_2-kvm" aria-hidden="true">#</a></h1><p>www.xoxoyun.cnKVM</p><h1 id="_3-openstack" tabindex="-1">3 OpenStack <a class="header-anchor" href="#_3-openstack" aria-hidden="true">#</a></h1><p>OpenStackOpenStackOpenStackOpenStack</p><ul><li>OpenStackMySQLRabbitMQMemcached</li><li>OpenStackKeystone</li><li>OpenStackGlance</li><li>OpenStackNova</li><li>OpenSTackNeutron</li><li>OpenStackHorizon</li></ul><h1 id="_1-1-openstack" tabindex="-1">1.1 OpenStack <a class="header-anchor" href="#_1-1-openstack" aria-hidden="true">#</a></h1><p>OpenStack  Rackspace  NASA IAASApacheAmazon EC2S3</p><p>OpenStackOpenStackwebOpenStack</p><ul><li><p>OpenStackAPIweb</p></li><li><p>OpenStackOpenStack</p></li><li><p>IPOpenStackAPIIP OpenStackIaaSAPI</p></li></ul><h1 id="_3-2-openstack" tabindex="-1">3.2 OpenStack <a class="header-anchor" href="#_3-2-openstack" aria-hidden="true">#</a></h1><h3 id="_3-2-1-openstack" tabindex="-1">3.2.1 OpenStack <a class="header-anchor" href="#_3-2-1-openstack" aria-hidden="true">#</a></h3><p>OpenStack </p><p>OpenStackOpenStack</p><p></p><h3 id="_3-2-2-ntp" tabindex="-1">3.2.2 NTP <a class="header-anchor" href="#_3-2-2-ntp" aria-hidden="true">#</a></h3><p>OpenStackOpenStack CentOS 7Chrony ChronyNTPchronydchronycchronydchronycchronyd</p><p><strong></strong> chrony</p><ol><li><p>chrony</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y chrony</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>chrony</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/chrony.conf</span></span>
<span class="line"><span style="color:#a6accd">#NTP</span></span>
<span class="line"><span style="color:#a6accd">server time1.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">server time2.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">server time3.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">server time4.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">#192.168.0.0/16</span></span>
<span class="line"><span style="color:#a6accd">allow 192.168.56.0/24</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p> NTP </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable chronyd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start chronyd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p><strong></strong></p><ol><li><p>chrony</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# yum install -y chrony</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>chrony</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/chrony.conf</span></span>
<span class="line"><span style="color:#a6accd">#IP</span></span>
<span class="line"><span style="color:#a6accd">server 192.168.56.11 iburst</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p> NTP </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl enable chronyd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl start chronyd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p><strong></strong></p><p>CentOS7timedatectl</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# timedatectl set-timezone Asia/Shanghai</span></span>
<span class="line"><span style="color:#a6accd">chronyc source</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chronyc sources</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_3-2-3-" tabindex="-1">3.2.3  <a class="header-anchor" href="#_3-2-3-" aria-hidden="true">#</a></h3><p>OpenStack</p><ol><li>EPEL</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>OpenStack</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># yum install -y centos-release-openstack-train</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>OpenStack</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># yum install -y python-openstackclient</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>SELinuxopenstack-selinux OpenStac</p></blockquote><ol><li>openstack SELinux</li></ol><p>SELinuxopenstack-selinux</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># yum install -y openstack-selinux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>OpenStack</strong></p><p>yumOpenStackOpenStack<a href="http://tarballs.openstack.org/%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AEhttps://launchpad.net/openstack/%E8%8E%B7%E5%8F%96%E5%88%B0%E6%AF%8F%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%AF%A6%E6%83%85%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%82" target="_blank" rel="noreferrer">http://tarballs.openstack.org/https://launchpad.net/openstack/</a></p><h3 id="_3-2-4-mysql" tabindex="-1">3.2.4 MySQL <a class="header-anchor" href="#_3-2-4-mysql" aria-hidden="true">#</a></h3><p>OpenStackOpenStackKeyStoneGlanceNovaNeutronCinderHorizonSessionOpenStackOpenStack OpenStackMySQLPostgreSQLCentOS7MySQLmariadb MySQL ServerCPUIO DBAMySQL</p><ol><li>MySQL</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y mariadb mariadb-server python2-PyMySQL</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>MySQL</p><p>MySQL/etc/my.cnf.d</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/my.cnf.d/openstack.cnf</span></span>
<span class="line"><span style="color:#a6accd">[mysqld]</span></span>
<span class="line"><span style="color:#a6accd">bind-address = 192.168.56.11 #IP</span></span>
<span class="line"><span style="color:#a6accd">default-storage-engine = innodb  #</span></span>
<span class="line"><span style="color:#a6accd">innodb_file_per_table = on#</span></span>
<span class="line"><span style="color:#a6accd">collation-server = utf8_general_ci #</span></span>
<span class="line"><span style="color:#a6accd">character-set-server = utf8 #</span></span>
<span class="line"><span style="color:#a6accd">max_connections = 4096 #MySQL</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>MySQL Server</p></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable mariadb.service </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start mariadb.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql_secure_installation</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><p>MySQL</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -u root -p</span></span>
<span class="line"><span style="color:#a6accd">Enter password: </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">MariaDB [(none)]&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE keystone;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'keystone';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'keystone';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE glance;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'glance';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'glance';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE placement;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON placement.* TO placement@'localhost' IDENTIFIED BY 'placement';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON placement.* TO placement@'%' IDENTIFIED BY 'placement';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE nova;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE nova_api;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE nova_cell0;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Neutron </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE neutron;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'neutron';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' IDENTIFIED BY 'neutron';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Cinder</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE cinder;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'cinder';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'cinder';</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> </p><h3 id="rabbitmq" tabindex="-1">RabbitMQ <a class="header-anchor" href="#rabbitmq" aria-hidden="true">#</a></h3><p>OpenStack Message brokerOpenStackRabbitMQQpidZeroMQOpenstackRabbitMQ OpenStackOpenStackOpenStackOpenStack RabbitMQRabbitMQ</p><ol><li>RabbitMQ</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y rabbitmq-server</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>RabbitMQ</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable rabbitmq-server.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start rabbitmq-server.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>openstack</li></ol><p>openstackopenstackOpenStack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmqctl add_user openstack openstack</span></span>
<span class="line"><span style="color:#a6accd">Creating user "openstack" ...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>openstack</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmqctl set_permissions openstack ".*" ".*" ".*"</span></span>
<span class="line"><span style="color:#a6accd">Setting permissions for user "openstack" in vhost "/" ...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Web</li></ol><p>RabbitMQWebWebRabbitMQHTTP APINagiosZabbix Web<a href="http://ip:15672/%E6%9D%A5%E8%AE%BF%E9%97%AEweb%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E3%80%82" target="_blank" rel="noreferrer">http://IP:15672/web</a></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmq-plugins list</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmq-plugins enable rabbitmq_management</span></span>
<span class="line"><span style="color:#a6accd">rabbitMQ1</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# lsof -i:15672</span></span>
<span class="line"><span style="color:#a6accd">COMMAND  PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span>
<span class="line"><span style="color:#a6accd">beam    2620 rabbitmq   15u  IPv4  16805      0t0  TCP *:15672 (LISTEN)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>RabbitMQ5672Web15672<a href="http://192.168.56.11:15672/" target="_blank" rel="noreferrer">http://192.168.56.11:15672</a></p><blockquote><p>RabbitMQguestopenstackWeb</p></blockquote><p>2.2.2</p><blockquote><p>HAOpenStackDownOpenStackRabbitMQRabbitMQHTTPAPI</p></blockquote><h1 id="_1-3-openstackkeystone" tabindex="-1">1.3 OpenStackKeyStone <a class="header-anchor" href="#_1-3-openstackkeystone" aria-hidden="true">#</a></h1><p>KeystoneOpenStack Identity ServiceOpenStackOpenStackIdentity API</p><p>Keystone OpenStackkeystoneEndpointURLKeystoneEndpoint</p><h3 id="keystone" tabindex="-1">Keystone <a class="header-anchor" href="#keystone" aria-hidden="true">#</a></h3><p>Keystone</p><ul><li>:</li><li>:Api</li></ul><p>KeystoneKeystoneOpenstack</p><ol><li><p>Keystone</p><p>KeystoneOpenstackKeystoneOpenstackAPIKeystoneKyestonetokenAPI</p></li></ol><p><strong>User</strong></p><p>UserOpenStacktokens tenantUserscredentialsAPI Keys</p><p><strong>Credentials</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">Credentials()</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>:  API </p><p><strong>Authentication</strong></p><p>Authentication (username&amp;password, or username and API key)(Token)</p><p><strong>Token</strong></p><p>Token T <strong>Tenant</strong></p><p>TenantNovatenantSwiftGlancetenantNeutrontenantUserstenant</p><p><strong>Role</strong></p><p>RoleRolesNovaGlanceUsersrolerolerolerolerole</p><p><strong>Domain</strong></p><p>KeyStone V3 Tenant  Project  Domain  Domain multi-tenancyDomain  Project  Domain  Domain  ProjectsUsersGroups  Roles Domain Project  Project </p><p><strong>Group</strong></p><p>Group  Users  Group  Group  Group  Group  Group Keystone V3  V2  User/Project  Role  DomainGroupProjectUser  Role </p><p> 2  Domain  3  Projects, Group1  Role Sysadmin Domain, Group1  Domain  Projects  Group2  Role Engineer  Project3, Group2  User  Project3  Projects</p><ol><li><p>Keystone</p><p>KeystoneKeyStoneOpenstackREST API</p></li><li><p>Service ServiceNovaGlanceSwiftUserTenantRoleuserserviceserviceserviceRoleservice</p></li><li><p>Endpoint Endpointendpointkeystoneendpointendpoint templatekeystoneconfendpointsendpoint templateURLsURLpublicprivateadminpublic url<a href="http://compute.example.com" target="_blank" rel="noreferrer">http://compute.example.comprivate</a>%2Cprivate/) url<a href="http://compute.example.local" target="_blank" rel="noreferrer">http://compute.example.localadmin</a>%2Cadmin/) url</p></li></ol><h3 id="keystone" tabindex="-1">KeyStone <a class="header-anchor" href="#keystone" aria-hidden="true">#</a></h3><p>OpenStackKeystoneOpenStackKeystoneServiceEndpoint</p><ol><li>keystone</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-keystone httpd mod_wsgi memcached python-memcached</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>MemcacheMemcached</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">#keystoneMemcachedtoken</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable memcached.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/memcached</span></span>
<span class="line"><span style="color:#a6accd">PORT="11211"</span></span>
<span class="line"><span style="color:#a6accd">USER="memcached"</span></span>
<span class="line"><span style="color:#a6accd">MAXCONN="1024"</span></span>
<span class="line"><span style="color:#a6accd">CACHESIZE="64"</span></span>
<span class="line"><span style="color:#a6accd">OPTIONS="-l 192.168.56.11,::1"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start memcached.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Keystone</li></ol><p>KeyStone/etc/keystone/keystone.confAdmin TokenMysql/etc/keystone/var/log/keystone OpenStack[DEFAULT] [dtabase] </p><ul><li><p>KeyStone</p><p>OpenStack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/keystone/keystone.conf</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>TokenMemcached</p></li></ul><p>KeyStoneAPIKeystoneTokenMySQLmemcache</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[token]</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "keystone-manage db_sync" keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>keystone/var/log/keystone/keystone.logrootrootkeystone</p></blockquote><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -ukeystone -pkeystone -e "use keystone;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>fernet keys</p><p>/etc/keystone/fernet-keys</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>keystone</p></li></ol><p>OpenstackKeystoneKeystone API  OpenStackAPIadmininternalpublicAPIAPIs APIAPIAPIOpenStackOpenStackIP192.168.56.11</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage bootstrap --bootstrap-password admin \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-admin-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-internal-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-public-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-region-id RegionOne</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Keystone</li></ol><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# grep "^[a-z]" /etc/keystone/keystone.conf </span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>KeyStone</li></ol><p>OpenStack KeystoneApache ServerName</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#a6accd">ServerName 192.168.56.11:80</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>keystone</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::5000                 :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::80                   :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">KeystoneOpenStack</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="keystone" tabindex="-1">Keystone <a class="header-anchor" href="#keystone" aria-hidden="true">#</a></h3><p>Keystone KeystoneKeyStoneADMIN_TOKENKeyStoneADMIN_TOKEN Keystone</p><ul><li>--os-token</li><li>keystone</li><li></li></ul><p>keystoneadminkeystone-manage bootstrap</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# </span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><ol><li>demo</li></ol><p>Openstack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack domain create --description "An Example Domain" example</span></span>
<span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Demo Project" myproject</span></span>
<span class="line"><span style="color:#a6accd"># openstack user create --domain default --password-prompt myuser</span></span>
<span class="line"><span style="color:#a6accd"># openstack role create myrole</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project myproject --user myuser myrole</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>--password-prompt</p></blockquote><ol><li><p></p><p>OpenStackOpenStack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Service Project" service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Keystone Keystoneservice</p><ul><li><p>glance</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password glance glance</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user glance admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>nova</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password nova nova</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user nova admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>placement</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password placement placement</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user placement admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Neutron</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password neutron neutron</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user neutron admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>cinder</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password cinder cinder</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user cinder admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul></li></ol><h3 id="keystone" tabindex="-1">Keystone <a class="header-anchor" href="#keystone" aria-hidden="true">#</a></h3><p>OS_TOKENOS_URLAdminKeystoneServiceEndpoint</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# unset OS_AUTH_URL OS_PASSWORD</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>admin</strong></p><p>admintoken</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name admin --os-username admin token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#admintoken</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>myuser</strong></p><p>token</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name myproject --os-username myuser token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>Keystone--os-username--os-password--os-password </p><ol><li>admin</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=myproject</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=myuser</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=123.com</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>source</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>demotoken</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/demo-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-3-openstackkeystone-1" tabindex="-1">1.3 OpenStackKeyStone <a class="header-anchor" href="#_1-3-openstackkeystone-1" aria-hidden="true">#</a></h1><p>KeystoneOpenStack Identity ServiceOpenStackOpenStackIdentity API</p><p>Keystone OpenStackkeystoneEndpointURLKeystoneEndpoint</p><h3 id="keystone-1" tabindex="-1">Keystone <a class="header-anchor" href="#keystone-1" aria-hidden="true">#</a></h3><p>Keystone</p><ul><li>:</li><li>:Api</li></ul><p>KeystoneKeystoneOpenstack</p><ol><li><p>Keystone</p><p>KeystoneOpenstackKeystoneOpenstackAPIKeystoneKyestonetokenAPI</p></li></ol><p><strong>User</strong></p><p>UserOpenStacktokens tenantUserscredentialsAPI Keys</p><p><strong>Credentials</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">Credentials()</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>:  API </p><p><strong>Authentication</strong></p><p>Authentication (username&amp;password, or username and API key)(Token)</p><p><strong>Token</strong></p><p>Token T <strong>Tenant</strong></p><p>TenantNovatenantSwiftGlancetenantNeutrontenantUserstenant</p><p><strong>Role</strong></p><p>RoleRolesNovaGlanceUsersrolerolerolerolerole</p><p><strong>Domain</strong></p><p>KeyStone V3 Tenant  Project  Domain  Domain multi-tenancyDomain  Project  Domain  Domain  ProjectsUsersGroups  Roles Domain Project  Project </p><p><strong>Group</strong></p><p>Group  Users  Group  Group  Group  Group  Group Keystone V3  V2  User/Project  Role  DomainGroupProjectUser  Role </p><p> 2  Domain  3  Projects, Group1  Role Sysadmin Domain, Group1  Domain  Projects  Group2  Role Engineer  Project3, Group2  User  Project3  Projects</p><ol><li><p>Keystone</p><p>KeystoneKeyStoneOpenstackREST API</p></li><li><p>Service ServiceNovaGlanceSwiftUserTenantRoleuserserviceserviceserviceRoleservice</p></li><li><p>Endpoint Endpointendpointkeystoneendpointendpoint templatekeystoneconfendpointsendpoint templateURLsURLpublicprivateadminpublic url<a href="http://compute.example.com" target="_blank" rel="noreferrer">http://compute.example.comprivate</a>%2Cprivate/) url<a href="http://compute.example.local" target="_blank" rel="noreferrer">http://compute.example.localadmin</a>%2Cadmin/) url</p></li></ol><h3 id="keystone-1" tabindex="-1">KeyStone <a class="header-anchor" href="#keystone-1" aria-hidden="true">#</a></h3><p>OpenStackKeystoneOpenStackKeystoneServiceEndpoint</p><ol><li>keystone</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-keystone httpd mod_wsgi memcached python-memcached</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>MemcacheMemcached</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">#keystoneMemcachedtoken</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable memcached.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/memcached</span></span>
<span class="line"><span style="color:#a6accd">PORT="11211"</span></span>
<span class="line"><span style="color:#a6accd">USER="memcached"</span></span>
<span class="line"><span style="color:#a6accd">MAXCONN="1024"</span></span>
<span class="line"><span style="color:#a6accd">CACHESIZE="64"</span></span>
<span class="line"><span style="color:#a6accd">OPTIONS="-l 192.168.56.11,::1"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start memcached.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Keystone</li></ol><p>KeyStone/etc/keystone/keystone.confAdmin TokenMysql/etc/keystone/var/log/keystone OpenStack[DEFAULT] [dtabase] </p><ul><li><p>KeyStone</p><p>OpenStack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/keystone/keystone.conf</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>TokenMemcached</p></li></ul><p>KeyStoneAPIKeystoneTokenMySQLmemcache</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[token]</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "keystone-manage db_sync" keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>keystone/var/log/keystone/keystone.logrootrootkeystone</p></blockquote><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -ukeystone -pkeystone -e "use keystone;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>fernet keys</p><p>/etc/keystone/fernet-keys</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>keystone</p></li></ol><p>OpenstackKeystoneKeystone API  OpenStackAPIadmininternalpublicAPIAPIs APIAPIAPIOpenStackOpenStackIP192.168.56.11</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage bootstrap --bootstrap-password admin \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-admin-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-internal-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-public-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-region-id RegionOne</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Keystone</li></ol><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# grep "^[a-z]" /etc/keystone/keystone.conf </span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>KeyStone</li></ol><p>OpenStack KeystoneApache ServerName</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#a6accd">ServerName 192.168.56.11:80</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>keystone</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::5000                 :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::80                   :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">KeystoneOpenStack</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="keystone-1" tabindex="-1">Keystone <a class="header-anchor" href="#keystone-1" aria-hidden="true">#</a></h3><p>Keystone KeystoneKeyStoneADMIN_TOKENKeyStoneADMIN_TOKEN Keystone</p><ul><li>--os-token</li><li>keystone</li><li></li></ul><p>keystoneadminkeystone-manage bootstrap</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# </span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><ol><li>demo</li></ol><p>Openstack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack domain create --description "An Example Domain" example</span></span>
<span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Demo Project" myproject</span></span>
<span class="line"><span style="color:#a6accd"># openstack user create --domain default --password-prompt myuser</span></span>
<span class="line"><span style="color:#a6accd"># openstack role create myrole</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project myproject --user myuser myrole</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>--password-prompt</p></blockquote><ol><li><p></p><p>OpenStackOpenStack</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Service Project" service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Keystone Keystoneservice</p><ul><li><p>glance</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password glance glance</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user glance admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>nova</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password nova nova</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user nova admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>placement</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password placement placement</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user placement admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Neutron</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password neutron neutron</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user neutron admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>cinder</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password cinder cinder</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user cinder admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul></li></ol><h3 id="keystone-1" tabindex="-1">Keystone <a class="header-anchor" href="#keystone-1" aria-hidden="true">#</a></h3><p>OS_TOKENOS_URLAdminKeystoneServiceEndpoint</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# unset OS_AUTH_URL OS_PASSWORD</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>admin</strong></p><p>admintoken</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name admin --os-username admin token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#admintoken</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>myuser</strong></p><p>token</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name myproject --os-username myuser token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="-1" tabindex="-1"> <a class="header-anchor" href="#-1" aria-hidden="true">#</a></h3><p>Keystone--os-username--os-password--os-password </p><ol><li>admin</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=myproject</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=myuser</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=123.com</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>source</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>demotoken</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/demo-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-4-openstackglance" tabindex="-1">1.4 OpenStackGlance <a class="header-anchor" href="#_1-4-openstackglance" aria-hidden="true">#</a></h1><h3 id="glance" tabindex="-1">Glance <a class="header-anchor" href="#glance" aria-hidden="true">#</a></h3><p>OpenStackGlanceOpenstackRest API OpenStackGlanceOpenStack/var/lib/glance/images/ Glance</p><p>Glance</p><p>2.5.2</p><ul><li>Glance-apiREST APIglance-registryimage storeapi9292</li><li>glance-registryMySQLmetadataRESTglance-registryglance-registry9191Glanceimageimage propertyImageimage property</li><li>database </li><li>image storeglanceimage storeAmazonS3OpenStackSwiftcephsheepdogGlusterFS Image store</li></ul><h3 id="glance" tabindex="-1">Glance <a class="header-anchor" href="#glance" aria-hidden="true">#</a></h3><ol><li><p>Glance</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Glance</p></li></ol><p>GlanceGlanceMySQLKeystone</p><ul><li>Glance</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/glance/glance-api.conf </span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection= mysql+pymysql://glance:glance@192.168.56.11/glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Keystone</li></ul><p>KeystoneOpenStackKeystoneGlanceKeystoneglance-api.confglance-registry.conf glance-api.conf</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/glance/glance-api.conf</span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri  = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = glance</span></span>
<span class="line"><span style="color:#a6accd">password = glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[paste_deploy]</span></span>
<span class="line"><span style="color:#a6accd">flavor=keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>Glance</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/glance/glance-api.conf</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">[glance_store]</span></span>
<span class="line"><span style="color:#a6accd">stores = file,http</span></span>
<span class="line"><span style="color:#a6accd">default_store=file</span></span>
<span class="line"><span style="color:#a6accd">filesystem_store_datadir=/var/lib/glance/images/</span></span>
<span class="line"><span style="color:#a6accd">#/var/lib/glance/images</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul><ol><li><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "glance-manage db_sync" glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -uglance -pglance -e "use glance;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Glance</p></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable openstack-glance-api.service </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start openstack-glance-api.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>Glance</p><p>GlanceKeystonesourceadmin</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd"># openstack service create --name glance --description "OpenStack Image" image</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne image public http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne image internal http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne image admin http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><h3 id="glance" tabindex="-1">Glance <a class="header-anchor" href="#glance" aria-hidden="true">#</a></h3><ol><li><p>Glance</p><p>glanceGlance</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack image list</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p></li><li><p>Glance</p></li></ol><p>OpenStackLinux</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#openstacksource</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# openstack image create "cirros" --disk-format qcow2 \</span></span>
<span class="line"><span style="color:#a6accd">--container-format bare --file cirros-0.4.0-x86_64-disk.img --public</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="openstack-image-listglance-var-lib-glance-images-image-id" tabindex="-1">openstack image listGlance/var/lib/glance/images/image id <a class="header-anchor" href="#openstack-image-listglance-var-lib-glance-images-image-id" aria-hidden="true">#</a></h1><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 src]# openstack image list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name   | Status |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| cf154a84-a73a-451b-bcb3-83c98e7c0d3e | cirros | active |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="id" tabindex="-1">ID <a class="header-anchor" href="#id" aria-hidden="true">#</a></h1><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ls -l /var/lib/glance/images/</span></span>
<span class="line"><span style="color:#a6accd">total 12980</span></span>
<span class="line"><span style="color:#a6accd">-rw-r----- 1 glance glance 13287936 Dec  1 14:11 65f9826a-5ccb-47d9-8a1a-75e31fb88a4a</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>GlanceOpenStackglance</p><h1 id="_3-5-placement" tabindex="-1">3.5 Placement <a class="header-anchor" href="#_3-5-placement" aria-hidden="true">#</a></h1><h3 id="_3-5-1-placement" tabindex="-1">3.5.1 Placement <a class="header-anchor" href="#_3-5-1-placement" aria-hidden="true">#</a></h3><h3 id="_3-5-2-placement" tabindex="-1">3.5.2 Placement <a class="header-anchor" href="#_3-5-2-placement" aria-hidden="true">#</a></h3><ol><li>Placement</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># openstack service create --name placement   --description "Placement API" placement</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne   placement public http://192.168.56.11:8778</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne   placement internal http://192.168.56.11:8778</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne   placement admin http://192.168.56.11:8778</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>Placement</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-placement-api</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>Palacement</p></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/placement/placement.conf</span></span>
<span class="line"><span style="color:#a6accd">[placement_database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://placement:placement@192.168.56.11/placement</span></span>
<span class="line"><span style="color:#a6accd">[api]</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy = keystone</span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = placement</span></span>
<span class="line"><span style="color:#a6accd">password = placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/httpd/conf.d/00-placement-api.conf </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">&lt;Directory /usr/bin&gt;</span></span>
<span class="line"><span style="color:#a6accd">Require all granted</span></span>
<span class="line"><span style="color:#a6accd">&lt;/Directory&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Listen 8778</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">&lt;VirtualHost *:8778&gt;</span></span>
<span class="line"><span style="color:#a6accd">  &lt;Directory /usr/bin&gt;</span></span>
<span class="line"><span style="color:#a6accd">Require all granted</span></span>
<span class="line"><span style="color:#a6accd">&lt;/Directory&gt;</span></span>
<span class="line"><span style="color:#a6accd">  WSGIProcessGroup placement-api</span></span>
<span class="line"><span style="color:#a6accd">  WSGIApplicationGroup %{GLOBAL}</span></span>
<span class="line"><span style="color:#a6accd">  WSGIPassAuthorization On</span></span>
<span class="line"><span style="color:#a6accd">  WSGIDaemonProcess placement-api processes=3 threads=1 user=placement group=placement</span></span>
<span class="line"><span style="color:#a6accd">  WSGIScriptAlias / /usr/bin/placement-api</span></span>
<span class="line"><span style="color:#a6accd">  &lt;IfVersion &gt;= 2.4&gt;</span></span>
<span class="line"><span style="color:#a6accd">    ErrorLogFormat "%M"</span></span>
<span class="line"><span style="color:#a6accd">  &lt;/IfVersion&gt;</span></span>
<span class="line"><span style="color:#a6accd">  ErrorLog /var/log/placement/placement-api.log</span></span>
<span class="line"><span style="color:#a6accd">  #SSLEngine On</span></span>
<span class="line"><span style="color:#a6accd">  #SSLCertificateFile ...</span></span>
<span class="line"><span style="color:#a6accd">  #SSLCertificateKeyFile ...</span></span>
<span class="line"><span style="color:#a6accd">&lt;/VirtualHost&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Alias /placement-api /usr/bin/placement-api</span></span>
<span class="line"><span style="color:#a6accd">&lt;Location /placement-api&gt;</span></span>
<span class="line"><span style="color:#a6accd">  SetHandler wsgi-script</span></span>
<span class="line"><span style="color:#a6accd">  Options +ExecCGI</span></span>
<span class="line"><span style="color:#a6accd">  WSGIProcessGroup placement-api</span></span>
<span class="line"><span style="color:#a6accd">  WSGIApplicationGroup %{GLOBAL}</span></span>
<span class="line"><span style="color:#a6accd">  WSGIPassAuthorization On</span></span>
<span class="line"><span style="color:#a6accd">&lt;/Location&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "placement-manage db sync" placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>httpd</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart httpd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-6-openstacknova" tabindex="-1">1.6 OpenStackNova <a class="header-anchor" href="#_1-6-openstacknova" aria-hidden="true">#</a></h1><p>NovaOpenStackOpenStackNovaOpenStacknova-computenova-compute</p><h3 id="nova" tabindex="-1">Nova <a class="header-anchor" href="#nova" aria-hidden="true">#</a></h3><ul><li><p>Nova-Api</p><p>OpenStack APIAmazon EC2 API</p><ul><li>nova-apiRESTful APINova</li><li>Message QueueEC2 APIEC2nova</li></ul></li><li><p>Nova-Cert</p><p>NovaEC2EC2 API</p></li><li><p>Nova-Scheduler</p><p>Nova</p></li><li><p>Nova-Conductor</p><p>Nova-Compute</p></li><li><p>Nova-Console</p><p>Novanova-consolenova-consoleauth).</p></li><li><p>Nova-Consoleauth</p><p></p></li><li><p>Nova-Novncproxy</p><p>VNCVNCnovncconsole</p></li><li><p>Nova-Compute</p><p>Nova-computeNova</p><ul><li>nova-compute Message QueueVM</li><li>Nova-compute LibvirtKVMXenAPIXen</li></ul></li></ul><h3 id="nova" tabindex="-1">Nova <a class="header-anchor" href="#nova" aria-hidden="true">#</a></h3><p>nova-compute</p><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-nova-api \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-conductor \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-novncproxy openstack-nova-scheduler</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>nova.confNovaNova</p><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[api_database]</span></span>
<span class="line"><span style="color:#a6accd">connection= mysql+pymysql://nova:nova@192.168.56.11/nova_api</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection= mysql+pymysql://nova:nova@192.168.56.11/nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>RabbitMQ</p><p>NovaNovaRabbmitMQDEFAULT</p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">transport_url = rabbit://openstack:openstack@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>Keystone</p><p>NovaKeystone</p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[api]</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy=keystone</span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri = http://192.168.56.11:5000/</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000/</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = nova</span></span>
<span class="line"><span style="color:#a6accd">password = nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>Nova</p><p>NeutronNova</p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">use_neutron=true</span></span>
<span class="line"><span style="color:#a6accd">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>VNC</p><p>vncVNCnovncproxyDashBoardnovnc</p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[vnc]</span></span>
<span class="line"><span style="color:#a6accd">enabled=true</span></span>
<span class="line"><span style="color:#a6accd">server_listen = 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">server_proxyclient_address = 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>glance</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[glance]</span></span>
<span class="line"><span style="color:#a6accd">api_servers = http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li> [oslo_concurrency] </li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[oslo_concurrency]</span></span>
<span class="line"><span style="color:#a6accd">lock_path=/var/lib/nova/tmp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>api</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">enabled_apis=osapi_compute,metadata</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>placement</li></ul><h1 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h1><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[placement]</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">username = placement</span></span>
<span class="line"><span style="color:#a6accd">password = placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage api_db sync" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>cell0</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>cell1cell</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>nova</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage db sync" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>cell0cell1</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 list_cells" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -unova -pnova -e "use nova;show tables;"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -unova -pnova -e "use nova_api;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Nova Service<ul><li></li></ul></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable openstack-nova-api.service \</span></span>
<span class="line"><span style="color:#a6accd">openstack-nova-scheduler.service \</span></span>
<span class="line"><span style="color:#a6accd">openstack-nova-conductor.service \</span></span>
<span class="line"><span style="color:#a6accd">openstack-nova-novncproxy.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start openstack-nova-api.service \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-scheduler.service openstack-nova-conductor.service \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-novncproxy.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>Nova</p><p>KeystoneGlanceNovaKeystoneKeystoneAPI</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># source admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd"># openstack service create --name nova --description "OpenStack Compute" compute</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne compute public http://192.168.56.11:8774/v2.1</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne compute internal http://192.168.56.11:8774/v2.1</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne compute admin http://192.168.56.11:8774/v2.1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@openstack-node1 ~]# openstack compute service list</span></span>
<span class="line"><span style="color:#a6accd">+----+----------------+-----------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID | Binary         | Host                        | Zone     | Status  | State | Updated At                 |</span></span>
<span class="line"><span style="color:#a6accd">+----+----------------+-----------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">|  4 | nova-scheduler | linux-node1.example.com | internal | enabled | up    | 2020-02-04T04:48:47.000000 |</span></span>
<span class="line"><span style="color:#a6accd">| 11 | nova-conductor | linux-node1.example.com | internal | enabled | up    | 2020-02-04T04:48:47.000000 |</span></span>
<span class="line"><span style="color:#a6accd">+----+----------------+-----------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="nova" tabindex="-1">Nova <a class="header-anchor" href="#nova" aria-hidden="true">#</a></h3><p>CPU</p><ol><li></li></ol><p>OpenStackOpenStackKVMHypervisorKVMlibvirtOpenStacknovaNova-compute</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# yum install -y openstack-nova-compute</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p></p><p>nova.conf</p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# scp /etc/nova/nova.conf 192.168.56.12:/etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# chown root:nova /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p></p><p> VNC</p></li><li><p>VNC</p><p>IPnovncproxy</p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[vnc]</span></span>
<span class="line"><span style="color:#a6accd">enabled=true</span></span>
<span class="line"><span style="color:#a6accd">server_listen = 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">server_proxyclient_address = 192.168.56.12</span></span>
<span class="line"><span style="color:#a6accd">novncproxy_base_url = http://192.168.56.11:6080/vnc_auto.html</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p></p><p></p></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# egrep -c '(vmx|svm)' /proc/cpuinfo</span></span>
<span class="line"><span style="color:#a6accd">0nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[libvirt]</span></span>
<span class="line"><span style="color:#a6accd">virt_type=qemu</span></span>
<span class="line"><span style="color:#a6accd">0nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[libvirt]</span></span>
<span class="line"><span style="color:#a6accd">virt_type=kvm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>nova-compute</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># systemctl enable libvirtd.service openstack-nova-compute.service</span></span>
<span class="line"><span style="color:#a6accd"># systemctl start libvirtd.service openstack-nova-compute.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><p>nova-manage cell_v2 discover_hosts</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>/etc/nova/nova.conf:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[scheduler]</span></span>
<span class="line"><span style="color:#a6accd">discover_hosts_in_cells_interval = 300</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><p>host listnova-compute host list</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack host list</span></span>
<span class="line"><span style="color:#a6accd">+------------------------+-------------+----------+</span></span>
<span class="line"><span style="color:#a6accd">| Host Name              | Service     | Zone     |</span></span>
<span class="line"><span style="color:#a6accd">+------------------------+-------------+----------+</span></span>
<span class="line"><span style="color:#a6accd">| linux-node1.example.com | conductor   | internal |</span></span>
<span class="line"><span style="color:#a6accd">| linux-node1.example.com | consoleauth | internal |</span></span>
<span class="line"><span style="color:#a6accd">| linux-node1.example.com | scheduler   | internal |</span></span>
<span class="line"><span style="color:#a6accd">| linux-node2.example.com | compute     | nova     |</span></span>
<span class="line"><span style="color:#a6accd">+------------------------+-------------+----------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="nova" tabindex="-1">Nova <a class="header-anchor" href="#nova" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack compute service list</span></span>
<span class="line"><span style="color:#a6accd">+----+------------------+-------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID | Binary           | Host                    | Zone     | Status  | State | Updated At                 |</span></span>
<span class="line"><span style="color:#a6accd">+----+------------------+-------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">|  1 | nova-consoleauth | linux-node1.example.com | internal | enabled | up    | 2018-02-03T10:38:30.000000 |</span></span>
<span class="line"><span style="color:#a6accd">|  2 | nova-conductor   | linux-node1.example.com | internal | enabled | up    | 2018-02-03T10:38:30.000000 |</span></span>
<span class="line"><span style="color:#a6accd">|  3 | nova-scheduler   | linux-node1.example.com | internal | enabled | up    | 2018-02-03T10:38:30.000000 |</span></span>
<span class="line"><span style="color:#a6accd">|  6 | nova-compute     | linux-node2.example.com | nova     | enabled | up    | None                       |</span></span>
<span class="line"><span style="color:#a6accd">+----+------------------+-------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Endpoint API</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack catalog list</span></span>
<span class="line"><span style="color:#a6accd">+-----------+-----------+--------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Name      | Type      | Endpoints                                  |</span></span>
<span class="line"><span style="color:#a6accd">+-----------+-----------+--------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| placement | placement | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:8778        |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   internal: http://192.168.56.11:8778      |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:8778         |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">| keystone  | identity  | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:5000/v3/    |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:35357/v3/    |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   internal: http://192.168.56.11:35357/v3/ |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">| glance    | image     | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:9292        |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:9292         |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">| nova      | compute   | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:8774/v2.1    |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:8774/v2.1   |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   internal: http://192.168.56.11:8774/v2.1 |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">+-----------+-----------+--------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>cellsplacement API</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# nova-status upgrade check</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Upgrade Check Results     |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Check: Cells v2           |</span></span>
<span class="line"><span style="color:#a6accd">| Result: Success           |</span></span>
<span class="line"><span style="color:#a6accd">| Details: None             |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Check: Placement API      |</span></span>
<span class="line"><span style="color:#a6accd">| Result: Success           |</span></span>
<span class="line"><span style="color:#a6accd">| Details: None             |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Check: Resource Providers |</span></span>
<span class="line"><span style="color:#a6accd">| Result: Success           |</span></span>
<span class="line"><span style="color:#a6accd">| Details: None             |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-7-openstackneutron" tabindex="-1">1.7 OpenStackNeutron <a class="header-anchor" href="#_1-7-openstackneutron" aria-hidden="true">#</a></h1><p>NovaOpenStack</p><h3 id="neutron" tabindex="-1">Neutron <a class="header-anchor" href="#neutron" aria-hidden="true">#</a></h3><p>OpenStack Networking ServicesNeutronOpenStack OpenStacknova-networkOpenStack</p><p>OpenStacknova-networknova-networkLinuxLinuxLinuxflat, vlan)</p><p>quantumquantumLinuxOpenvSwitchSDNflatvlangre, vxlanquantumneutron</p><ol><li>Neutron Server</li></ol><p>neutron-serverneutron-*-pluginneutron-serverAPIAPIIP</p><ol><li>ML2(Module Layer2)plugin</li></ol><p>NeutronpluginNeutrondbpluginpluginpluginagent dbpluginNeutronpluginML2(ModuleLayer2) pluginML2 pluginplugin ML2pulginlinux bridgeopenvswitchML2MechanismDriverMechanismDriveragentagent_typevif_typevif_typeapi ML2flat, vlan, gre, vxlanml2_conf.ini</p><ol><li><p>L3-Agent</p><p>ml2L2L3neturonl3-agent3 L3   Linux  ipv4 forward   RIPOSPF BGP</p></li></ol><p> Neutron   tenant  namespace  Linux  namespace  linux  TCP/IP  tenant  namespace TCP/IP  tenant  iptables tenant L3  L2 tenant L3-agent </p><ol><li>dhcp-agent</li></ol><p>Dhcp-agentDHCP L4-L7Agent L4-L7FwaaS,VPNaaS, DNATaaS, DNSaaSneutronL2ml2 FLATneutron</p><h3 id="neutron" tabindex="-1">Neutron <a class="header-anchor" href="#neutron" aria-hidden="true">#</a></h3><ol><li>Neutron</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-neutron openstack-neutron-ml2 \</span></span>
<span class="line"><span style="color:#a6accd">openstack-neutron-linuxbridge ebtables</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron<ul><li>Neutron</li></ul></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://neutron:neutron@192.168.56.11:3306/neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Keystone</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy = keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>RabbitMQ</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">transport_url = rabbit://openstack:openstack@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">#DEFAULTtransport_url</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Neutron</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">core_plugin = ml2</span></span>
<span class="line"><span style="color:#a6accd"># </span></span>
<span class="line"><span style="color:#a6accd">service_plugins =</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Nova</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd"># </span></span>
<span class="line"><span style="color:#a6accd">notify_nova_on_port_status_changes = True</span></span>
<span class="line"><span style="color:#a6accd">notify_nova_on_port_data_changes = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># </span></span>
<span class="line"><span style="color:#a6accd">[nova]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = nova</span></span>
<span class="line"><span style="color:#a6accd">password = nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li> [oslo_concurrency] </li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[oslo_concurrency]</span></span>
<span class="line"><span style="color:#a6accd">lock_path = /var/lib/neutron/tmp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron ML2</li></ol><p>Neutron ML2ML2LinuxLayer-2</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/plugins/ml2/ml2_conf.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[ml2]</span></span>
<span class="line"><span style="color:#a6accd">type_drivers = flat,vlan,gre,vxlan,geneve #</span></span>
<span class="line"><span style="color:#a6accd">tenant_network_types = flat,vlan,gre,vxlan,geneve #</span></span>
<span class="line"><span style="color:#a6accd">mechanism_drivers = linuxbridge,openvswitch,l2population #linuxbridgeopenvswitch</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">extension_drivers = port_security,qos </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[ml2_type_flat]</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">flat_networks = provider</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[securitygroup]</span></span>
<span class="line"><span style="color:#a6accd">#ipset</span></span>
<span class="line"><span style="color:#a6accd">enable_ipset = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron Linuxbridge</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[linux_bridge]</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">physical_interface_mappings = provider:eth0 </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[vxlan]</span></span>
<span class="line"><span style="color:#a6accd">#vxlan</span></span>
<span class="line"><span style="color:#a6accd">enable_vxlan = False</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[securitygroup]</span></span>
<span class="line"><span style="color:#a6accd">#Linux Bridge</span></span>
<span class="line"><span style="color:#a6accd">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span>
<span class="line"><span style="color:#a6accd">enable_security_group = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron DHCP-Agent</li></ol><p>Neutrondhcp-agentIPDHCP AgentdnsmasqDHCPdhcp-agentLbaas-agentnamespace,linuxnamespache</p><p><strong>namespace</strong> Namespace()aabbpc  linuxcontainernamespace NamespacepidnetipcmntutsusernamespaceUTS("UNIX Time-sharing System")Dockernamespace</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/dhcp_agent.ini</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">interface_driver = linuxbridge</span></span>
<span class="line"><span style="color:#a6accd">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span></span>
<span class="line"><span style="color:#a6accd">enable_isolated_metadata = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron metadata</li></ol><p>metadata agentKeystonenova</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/metadata_agent.ini</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">nova_metadata_host = 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">#nova</span></span>
<span class="line"><span style="color:#a6accd">metadata_proxy_shared_secret = unixhot.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutronnova.conf</li></ol><p>NeutronnovaOpenStacknova.confnova-network</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf </span></span>
<span class="line"><span style="color:#a6accd">[neutron]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd">service_metadata_proxy = true</span></span>
<span class="line"><span style="color:#a6accd">metadata_proxy_shared_secret = unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>plugin.ini</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \</span></span>
<span class="line"><span style="color:#a6accd">--config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>API </li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart openstack-nova-api.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># systemctl enable neutron-server.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-metadata-agent.service</span></span>
<span class="line"><span style="color:#a6accd"># systemctl start neutron-server.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-metadata-agent.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">service</span></span>
<span class="line"><span style="color:#a6accd"># openstack service create --name neutron --description "OpenStack Networking" network</span></span>
<span class="line"><span style="color:#a6accd">endpoint</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne network public http://192.168.56.11:9696</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne network internal http://192.168.56.11:9696</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne network admin http://192.168.56.11:9696</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron**</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node1 neutron]# openstack network agent list</span></span>
<span class="line"><span style="color:#a6accd">WARNING: Failed to import plugin orchestration.</span></span>
<span class="line"><span style="color:#a6accd">WARNING: Failed to import plugin data_processing.</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-------------------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Agent Type         | Host                                | Availability Zone | Alive | State | Binary                    |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-------------------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| c4a78188-a3ad-4cda-8c47-41f854aad375 | Linux bridge agent | openstack-compute-node1.dianjoy.com | None              | :-)   | UP    | neutron-linuxbridge-agent |</span></span>
<span class="line"><span style="color:#a6accd">| e2325b10-281b-447c-b46f-7875c0eda1fc | Metadata agent     | openstack-compute-node1.dianjoy.com | None              | :-)   | UP    | neutron-metadata-agent    |</span></span>
<span class="line"><span style="color:#a6accd">| fb73fabc-2825-42c4-ae24-ea50bb1d37b8 | DHCP agent         | openstack-compute-node1.dianjoy.com | nova              | :-)   | UP    | neutron-dhcp-agent        |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-------------------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Neutron</p><h3 id="neutron" tabindex="-1">Neutron <a class="header-anchor" href="#neutron" aria-hidden="true">#</a></h3><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"> [root@linux-node2 ~]# yum install -y openstack-neutron openstack-neutron-linuxbridge ebtables</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron<ul><li>Keystone</li></ul></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy = keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>RabbitMQ</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">transport_url = rabbit://openstack:openstack@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">#DEFAULTtransport_url</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[oslo_concurrency]</span></span>
<span class="line"><span style="color:#a6accd">lock_path = /var/lib/neutron/tmp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>LinuxBridge</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# scp /etc/neutron/plugins/ml2/linuxbridge_agent.ini 192.168.56.12:/etc/neutron/plugins/ml2/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>nova.conf</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[neutron]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl restart openstack-nova-compute.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>linuxbridge-agent</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl enable neutron-linuxbridge-agent.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl start neutron-linuxbridge-agent.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source admin-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network agent list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-----------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Agent Type         | Host                        | Availability Zone | Alive | State | Binary                    |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-----------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 11f1de57-836f-412f-b9b4-51dcdc9ae931 | Metadata agent     | linux-node1.example.com | None              | :-)   | UP    | neutron-metadata-agent    |</span></span>
<span class="line"><span style="color:#a6accd">| 197b84cd-7d6e-4ed2-9fa0-46499fe7cdb7 | Linux bridge agent | linux-node2.example.com | None              | :-)   | UP    | neutron-linuxbridge-agent |</span></span>
<span class="line"><span style="color:#a6accd">| 531afd6d-ee81-4b64-a0f4-ec5fd523eff8 | DHCP agent         | linux-node1.example.com | nova              | :-)   | UP    | neutron-dhcp-agent        |</span></span>
<span class="line"><span style="color:#a6accd">| dfc431ff-dede-4a54-8371-653c6e72ffd9 | Linux bridge agent | linux-node1.example.com | None              | :-)   | UP    | neutron-linuxbridge-agent |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-----------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>linux-node2.example.comLinux bridge agent</p><h3 id="bug" tabindex="-1">Bug <a class="header-anchor" href="#bug" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent [req-68a7936c-2bbc-454e-bee4-6785cd3dce7b - - - - -] Error in agent loop. Devices info: {'current': set(['tap07dc4c9c-f3']), 'timestamps': {'tap07dc4c9c-f3': 7}, 'removed': set([]), 'added': set(['tap07dc4c9c-f3']), 'updated': set([])}: KeyError: 'gateway'</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent Traceback (most recent call last):</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 465, in daemon_loop</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     sync = self.process_network_devices(device_info)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/osprofiler/profiler.py", line 160, in wrapper</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     result = f(*args, **kwargs)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 214, in process_network_devices</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     resync_a = self.treat_devices_added_updated(devices_added_updated)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/osprofiler/profiler.py", line 160, in wrapper</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     result = f(*args, **kwargs)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 231, in treat_devices_added_updated</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     self._process_device_if_exists(device_details)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 258, in _process_device_if_exists</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     device, device_details['device_owner'])</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 585, in plug_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     network_segment.mtu)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 521, in add_tap_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     return False</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/oslo_utils/excutils.py", line 220, in __exit__</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     self.force_reraise()</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/oslo_utils/excutils.py", line 196, in force_reraise</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     six.reraise(self.type_, self.value, self.tb)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 513, in add_tap_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     tap_device_name, device_owner, mtu)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 546, in _add_tap_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     mtu):</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 497, in ensure_physical_in_bridge</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     physical_interface)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 286, in ensure_flat_bridge</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     if self.ensure_bridge(bridge_name, physical_interface):</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 455, in ensure_bridge</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     self.update_interface_ip_details(bridge_name, interface)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 417, in update_interface_ip_details</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     gateway)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 401, in _update_interface_ip_details</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     dst_device.route.add_gateway(gateway=gateway['gateway'],</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent KeyError: 'gateway'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Neutron</p><ol><li>prioritymetric</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node3 ~]# vim +1503 /usr/lib/python2.7/site-packages/neutron/agent/linux/ip_lib.py</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#'priority': get_attr(route, 'RTA_PRIORITY'),</span></span>
<span class="line"><span style="color:#a6accd">'metric': get_attr(route, 'RTA_PRIORITY'),</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>gatewayvia</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node3 ~]# vim +402 /usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#dst_device.route.add_gateway(gateway=gateway['gateway'],</span></span>
<span class="line"><span style="color:#a6accd">            dst_device.route.add_gateway(gateway=gateway['via'],</span></span>
<span class="line"><span style="color:#a6accd">                                         metric=metric)</span></span>
<span class="line"><span style="color:#a6accd">            #src_device.route.delete_gateway(gateway=gateway['gateway'])</span></span>
<span class="line"><span style="color:#a6accd">            src_device.route.delete_gateway(gateway=gateway['via'])</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node3 ~]# systemctl restart neutron-linuxbridge-agent</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node1 ~]# systemctl restart neutron-server.service   neutron-linuxbridge-agent.s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-8-openstack" tabindex="-1">1.8 OpenStack <a class="header-anchor" href="#_1-8-openstack" aria-hidden="true">#</a></h1><p></p><ul><li>MySQL</li><li>RabbitMQ</li><li>KeyStone</li><li>Glance</li><li>Nova</li><li>Neutron</li></ul><p>OpenStackDashboardWeb</p><h3 id="flat" tabindex="-1">FLAT <a class="header-anchor" href="#flat" aria-hidden="true">#</a></h3><p>demoFLAT</p><ol><li>Flant</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network create  --share --external \</span></span>
<span class="line"><span style="color:#a6accd">  --provider-physical-network provider \</span></span>
<span class="line"><span style="color:#a6accd">  --provider-network-type flat provider</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network list</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack subnet create --network provider \</span></span>
<span class="line"><span style="color:#a6accd">  --allocation-pool start=192.168.56.100,end=192.168.56.200 \</span></span>
<span class="line"><span style="color:#a6accd">  --dns-nameserver 223.5.5.5  --gateway 192.168.56.2 \</span></span>
<span class="line"><span style="color:#a6accd">  --subnet-range 192.168.56.0/24 provider-subnet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack subnet list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+----------+--------------------------------------+-----------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name     | Network                              | Subnet          |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+----------+--------------------------------------+-----------------+</span></span>
<span class="line"><span style="color:#a6accd">| 297530f8-62b6-4954-ad33-c8a4ba922a3e | provider | 6cf562b4-0537-4232-a2b9-ce5481e6a505 | 192.168.56.0/24 |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+----------+--------------------------------------+-----------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><ol><li></li></ol><p>512MPC</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><p>OpenStack demodemo</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh-keygen -q -N ""</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack keypair list</span></span>
<span class="line"><span style="color:#a6accd">+-------+-------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Name  | Fingerprint                                     |</span></span>
<span class="line"><span style="color:#a6accd">+-------+-------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| mykey | d2:e0:bc:3e:35:58:5f:7b:fd:c1:0a:93:5e:bf:8f:2d |</span></span>
<span class="line"><span style="color:#a6accd">+-------+-------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><p>defaultICMP22</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack security group rule create --proto icmp default</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack security group rule create --proto tcp --dst-port 22 default</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack flavor list</span></span>
<span class="line"><span style="color:#a6accd">+----+---------+-----+------+-----------+-------+-----------+</span></span>
<span class="line"><span style="color:#a6accd">| ID | Name    | RAM | Disk | Ephemeral | VCPUs | Is Public |</span></span>
<span class="line"><span style="color:#a6accd">+----+---------+-----+------+-----------+-------+-----------+</span></span>
<span class="line"><span style="color:#a6accd">| 0  | m1.nano |  64 |    1 |         0 |     1 | True      |</span></span>
<span class="line"><span style="color:#a6accd">+----+---------+-----+------+-----------+-------+-----------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack image list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name   | Status | Server |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| 68615b2c-d10e-422f-9acb-c724808657ab | cirros | ACTIVE |        |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name   | Subnets                              |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 557a00fa-f61d-4244-b350-29ffe0a03125 | public | c003b4b5-23d1-4211-ad2d-a62ec07d8853 |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li></li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack security group list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+---------+------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name    | Description            | Project                          |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+---------+------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 74d74309-0660-4eb9-abba-e89fb6fd23ae | default | Default security group | aec911c3ae68464ba989213e5f6060b1 |</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack server create --flavor m1.nano --image cirros \</span></span>
<span class="line"><span style="color:#a6accd">--nic net-id=5c4d0706-24cd-4d42-ba78-36a05b6c81c8 --security-group default \</span></span>
<span class="line"><span style="color:#a6accd">--key-name mykey demo-instance</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="id" tabindex="-1">ID <a class="header-anchor" href="#id" aria-hidden="true">#</a></h1><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack server list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+-----------------+--------+------------+-------------+-----------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name            | Status | Task State | Power State | Networks              |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+-----------------+--------+------------+-------------+-----------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 7f94df9a-e547-4f56-9887-bbc52c4e0fff | public-instance | ACTIVE | -          | Running     | public=192.168.56.101 |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+-----------------+--------+------------+-------------+-----------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ping -c 2 192.168.56.101</span></span>
<span class="line"><span style="color:#a6accd">PING 192.168.56.101 (192.168.56.101) 56(84) bytes of data.</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 192.168.56.101: icmp_seq=1 ttl=64 time=5.90 ms</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 192.168.56.101: icmp_seq=2 ttl=64 time=0.484 ms</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh cirros@192.168.56.101</span></span>
<span class="line"><span style="color:#a6accd">The authenticity of host '192.168.56.101 (192.168.56.101)' can't be established.</span></span>
<span class="line"><span style="color:#a6accd">RSA key fingerprint is 29:4d:76:17:05:1a:4e:e6:f9:81:a5:1d:8c:27:ff:2c.</span></span>
<span class="line"><span style="color:#a6accd">Are you sure you want to continue connecting (yes/no)? yes</span></span>
<span class="line"><span style="color:#a6accd">Warning: Permanently added '192.168.56.101' (RSA) to the list of known hosts.</span></span>
<span class="line"><span style="color:#a6accd">$ ifconfig eth0</span></span>
<span class="line"><span style="color:#a6accd">eth0      Link encap:Ethernet  HWaddr FA:16:3E:E8:B9:C1  </span></span>
<span class="line"><span style="color:#a6accd">          inet addr:192.168.56.101  Bcast:192.168.56.255  Mask:255.255.255.0</span></span>
<span class="line"><span style="color:#a6accd">          inet6 addr: fe80::f816:3eff:fee8:b9c1/64 Scope:Link</span></span>
<span class="line"><span style="color:#a6accd">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></span>
<span class="line"><span style="color:#a6accd">          RX packets:150 errors:0 dropped:0 overruns:0 frame:0</span></span>
<span class="line"><span style="color:#a6accd">          TX packets:162 errors:0 dropped:0 overruns:0 carrier:0</span></span>
<span class="line"><span style="color:#a6accd">          collisions:0 txqueuelen:1000 </span></span>
<span class="line"><span style="color:#a6accd">          RX bytes:18634 (18.1 KiB)  TX bytes:17264 (16.8 KiB)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>pingWeb</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack console url show demo-instance</span></span>
<span class="line"><span style="color:#a6accd">+-------+------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Type  | Url                                                                                |</span></span>
<span class="line"><span style="color:#a6accd">+-------+------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| novnc | http://192.168.56.11:6080/vnc_auto.html?token=e97cffb8-cf0c-4c22-8dbc-fa88ff61f453 |</span></span>
<span class="line"><span style="color:#a6accd">+-------+------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>OpenStackOpenStack</p><h1 id="openstack-dashboard" tabindex="-1">OpenStack Dashboard <a class="header-anchor" href="#openstack-dashboard" aria-hidden="true">#</a></h1><p>OpenStackKeystoneGlanceNovaNeutronOpenStackDashBoard OpenStackHorizonCLIAPIHorizon HorizonOpenStackDashboardOpenStackwebHorizonOpenStack API DashboardKeystoneServiceKeystoneDashboard</p><h3 id="horizon" tabindex="-1">Horizon <a class="header-anchor" href="#horizon" aria-hidden="true">#</a></h3><blockquote><p>KeystoneHoarizonlinux-node2</p></blockquote><ol><li>Horizon</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# yum install -y openstack-dashboard</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Horizon</li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/openstack-dashboard/local_settings</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">ALLOWED_HOSTS = ['*', ]</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Keystone</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_HOST = "192.168.56.11"</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_URL = "http://%s:5000/v3" % OPENSTACK_HOST</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#API</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_API_VERSIONS = {</span></span>
<span class="line"><span style="color:#a6accd">    "identity": 3,</span></span>
<span class="line"><span style="color:#a6accd">    "volume": 2,</span></span>
<span class="line"><span style="color:#a6accd">    "compute": 2,</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"># user </span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_DEFAULT_ROLE = "user"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = 'Default'</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#SessionMemcached</span></span>
<span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">    'default': {</span></span>
<span class="line"><span style="color:#a6accd">        'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',</span></span>
<span class="line"><span style="color:#a6accd">        'LOCATION': '192.168.56.11:11211',</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Web</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_HYPERVISOR_FEATURES = {</span></span>
<span class="line"><span style="color:#a6accd">    'can_set_mount_point': True,</span></span>
<span class="line"><span style="color:#a6accd">    'can_set_password': True,</span></span>
<span class="line"><span style="color:#a6accd">    'requires_keypair': False,</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">TIME_ZONE = "Asia/Shanghai"</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_NEUTRON_NETWORK = {</span></span>
<span class="line"><span style="color:#a6accd">    ...</span></span>
<span class="line"><span style="color:#a6accd">    'enable_router': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_quotas': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_distributed_router': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_ha_router': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_lb': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_firewall': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_vpn': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_fip_topology_check': False,</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Horizon</li></ol><p>/dashboard/auth/login404 Not Found</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# cd /usr/share/openstack-dashboard</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# python manage.py make_web_conf --apache &gt; /etc/httpd/conf.d/openstack-dashboard.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li></li></ol><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl enable httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl restart httpd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><a href="http://192.168.56.11/%E6%9D%A5%E8%AE%BF%E9%97%AE%E4%BB%AA%E8%A1%A8%E7%9B%98%E4%BA%86%E3%80%82%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8admin%E6%88%96%E8%80%85demo%E3%80%82%E9%9C%80%E8%A6%81%E4%BD%A0%E4%BA%B2%E8%87%AA%E6%9D%A5%E4%BD%93%E9%AA%8C%E4%BB%96%E4%BB%AC%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%E3%80%82" target="_blank" rel="noreferrer">http://192.168.56.11/admindemo</a></p><h3 id="horizonsession" tabindex="-1">HorizonSession <a class="header-anchor" href="#horizonsession" aria-hidden="true">#</a></h3><p>Session</p><ul><li>Session</li><li>Session</li><li>Session</li></ul><p>HorizonDjango Django sessionsessionsession</p><ul><li></li><li>MemcachedRedis</li><li></li><li>cookies</li></ul><p> local_settings  SESSION_ENGINE session</p><p><strong></strong></p><p>session</p><ul><li><p></p></li><li><p> Horizon</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">  'BACKEND': 'django.core.cache.backends.locmem.LocMemCache'</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul><p><strong></strong></p><p>Memcached  Redis sessionsession</p><ol><li>Memcached</li></ol><p>Memcached   Memcached python-memcached  Python  </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">    'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache'</span></span>
<span class="line"><span style="color:#a6accd">    'LOCATION': 'my_memcached_host:11211',</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Redis</li></ol><p>RedisBSD  Redis  redis  django-redis python </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">    "default": {</span></span>
<span class="line"><span style="color:#a6accd">        "BACKEND": "redis_cache.cache.RedisCache",</span></span>
<span class="line"><span style="color:#a6accd">        "LOCATION": "127.0.0.1:6379:1",</span></span>
<span class="line"><span style="color:#a6accd">        "OPTIONS": {</span></span>
<span class="line"><span style="color:#a6accd">            "CLIENT_CLASS": "redis_cache.client.DefaultClient",</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="-openstack" tabindex="-1"> OpenStack <a class="header-anchor" href="#-openstack" aria-hidden="true">#</a></h1><p>----------------------------------------------------------------------</p><h1 id="-dockerkubernetes" tabindex="-1"> DockerKubernetes <a class="header-anchor" href="#-dockerkubernetes" aria-hidden="true">#</a></h1><p>1.docker</p><p>SaltStackSaltStack</p><p><img src="http://k8s.unixhot.com/docker/media/6b19e69aac9d176124a719ad038e3bb2.png" alt="img"></p><p></p><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>DockerDocker.IncLXCContainerGitHub,GoApache2.0</p><p>DockernamespacescgroupsDockerDockerVM</p><p><strong>Docker</strong></p><p><img src="http://k8s.unixhot.com/docker/media/3185f40a56d6a22b714b444d515be3f0.png" alt=": Docker Engine Components Flow"></p><p>DockerC/SDocker ClientRESTAPIDocker Server</p><ul><li>Docker ClientDocker</li><li>REST APIRESTful</li><li>Docker Server:Docker daemonDocker ClientREST API</li></ul><p><strong>Docker </strong></p><ul><li>Image</li><li>Container</li><li>Repository</li></ul><p><strong>Docker</strong></p><p>Docker KVM</p><p>CentOSNginx</p><p>Docker</p><p>Docker </p><p><strong>CentOSUbuntuDockerDockerKernelLinux</strong></p><p><strong>Docker</strong></p><p>DockerKVM</p><p>Linux root</p><p><strong>Docker</strong></p><p>DockerOpenStackGlancePublicPrivateGitGitHubGitlab</p><p>DockerDocker HubDocker Hub</p><p>DockerRegistryDocker Registrytag</p><p>Registry</p><p>docker pushdocker pullGit</p><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h3><p>Docker</p><p><img src="http://k8s.unixhot.com/docker/media/50b4ac39d02c080a7e3284e9b078e0c2.jpg" alt="0731013"></p><p>DockerHypervisorDocker EngineHypervisorDockerDockerU KeyUSBDocker</p><p>Docker</p><h3 id="dockeropenstack" tabindex="-1">DockerOpenStack <a class="header-anchor" href="#dockeropenstack" aria-hidden="true">#</a></h3><p>DockerOpenStackDockerOpenStackKVM</p><table><thead><tr><th></th><th>Docker</th><th>OpenStack/KVM</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td>VM</td></tr><tr><td></td><td>MB</td><td>GB</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td>SSH</td><td></td></tr><tr><td></td><td></td><td>Neutron</td></tr></tbody></table><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h3><p>Docker</p><p><strong></strong></p><p>DockerDockerDockerfile</p><p><strong></strong></p><p>DockerDocker</p><p><strong></strong></p><p>DockerADocker</p><p><strong></strong></p><p>SaltStackDockerDockerDocker</p><p><strong></strong></p><p>SOASOADockerKVMDocker</p><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>DockerLinuxUnixWindows Server 2016Windows</p><h3 id="docker-for-centos" tabindex="-1">Docker for CentOS <a class="header-anchor" href="#docker-for-centos" aria-hidden="true">#</a></h3><p><strong>yum</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y yum-utils</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Yum</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /etc/yum.repos.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 yum.repos.d]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Docker</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y docker-ce</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start docker</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 yum.repos.d]# docker --version</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Docker version 18.09.2, build 6247962</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="docker-for-windows" tabindex="-1">Docker for windows: <a class="header-anchor" href="#docker-for-windows" aria-hidden="true">#</a></h3><p>boot2docker<a href="https://github.com/boot2docker/windows-installer/releases/latest" target="_blank" rel="noreferrer">https://github.com/boot2docker/windows-installer/releases/latest</a></p><p></p><p><img src="http://k8s.unixhot.com/docker/media/ee82a72fe806ac1ae99ab7fa0aac210c.png" alt="img"></p><p>Full installation</p><p><img src="http://k8s.unixhot.com/docker/media/920a1b8c46b133f431f0255197ddb3f8.png" alt="img"></p><p><img src="http://k8s.unixhot.com/docker/media/bbe62c1244b68a92383658af3a72b3a0.png" alt="img"></p><p>Dockervirtualbox</p><h3 id="docker-hub" tabindex="-1">Docker Hub <a class="header-anchor" href="#docker-hub" aria-hidden="true">#</a></h3><p>DockerDocker HubDockerGitHubDocker15,000 Docker Hub </p><p><strong></strong></p><p>Docker</p><p><img src="http://k8s.unixhot.com/docker/media/bd38bd717fa1a2f84aa5f62a965a7ecd.png" alt="img"></p><p>OFFICIALOK</p><p>DockerDocker</p><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>DockerDockersearch</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p></p><p>**ISO**OpenStackisoGlanceDockerISO</p><p>****DockerCentosfebootstrapdebian/ubuntudebootstrap</p><p>****Docker</p><p>Docker File</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>Docker Hubcentos</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull centos</span></span>
<span class="line"><span style="color:#a6accd">Using default tag: latest</span></span>
<span class="line"><span style="color:#a6accd">latest: Pulling from library/centos</span></span>
<span class="line"><span style="color:#a6accd">a02a4930cb5d: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">Digest: sha256:184e5f35598e333bfa7de10d8fb1cebb5ee4df5bc0f970bf2b1e7c7345136426</span></span>
<span class="line"><span style="color:#a6accd">Status: Downloaded newer image for centos:latest</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>DockerIDDockerdocker pull centos</p><p>v1.0v1.1centoslatestdocker hub</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>docker images</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images</span></span>
<span class="line"><span style="color:#a6accd">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#a6accd">centos latest 1e1148e4cc2c 2 months ago 202MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>docker imagesID</p><ul><li>REPOSITORY</li><li>TAG</li><li>IMAGE IDID</li><li>CREATED</li><li>VIRTUAL SIZE</li></ul><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>Docker</p><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker save -o centos.tar centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p>scp</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# docker load --input centos.tar</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# docker load &lt; centos.tar</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>DockerID</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# docker images</span></span>
<span class="line"><span style="color:#a6accd">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#a6accd">centos latest 1e1148e4cc2c 2 months ago 202MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>docker rmiID</p><p>docker rmi Linux</p><p>docker rmi IDID</p><p>-f</p><p>Docker</p><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>DockerOpenStack</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>stopped</p><p><strong></strong></p><p>Hello World</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run centos /bin/echo 'Hello world'</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Hello world</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Hello World+1/bin/echo Hello world Docker</p><blockquote><p>Docker</p></blockquote><p>docker ps a</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -a</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">789de67bb454 centos "/bin/echo 'Hello wor" 30 seconds ago Exited (0) 29 seconds</span></span>
<span class="line"><span style="color:#a6accd">ago pedantic_kare</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Docker</p><p>Dockerpedantic_kare</p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --name mydocker -t -i centos /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]#</span></span>
<span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]# ls /</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">anaconda-post.log bin dev etc home lib lib64 lost+found media mnt opt proc root</span></span>
<span class="line"><span style="color:#a6accd">run sbin srv sys tmp usr var</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>-t Docker -i </p><p>/bin/bash/bin/bashPID1</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.1 0.1 11776 1872 ? Ss 15:30 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 18 0.0 0.0 47424 1660 ? R+ 15:31 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> docker run Docker </p><ul><li></li><li></li><li></li><li></li><li>ip</li><li></li><li></li></ul><p>exitDockerDockerdockerCONTAINER ID</p><p><strong></strong></p><p>docker run-d</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name mydocker2 centos /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">38e42accfa2226bb6c7da2e28e12dc95f6b6d6717326442131887a24bb321cdd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ID</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>Hello WorldDockerexit/bin/bashCtrl+d</p><p>docker stopSIGTERM10SIGKILL-ttime</p><p>docker stop ID</p><p>docker startdocker restart</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@bc419cd0b8fa /]# exit</span></span>
<span class="line"><span style="color:#a6accd">Exit</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>docker ps a</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -a</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">38e42accfa22 centos "/bin/bash" 17 seconds ago Exited (0) 16 seconds ago</span></span>
<span class="line"><span style="color:#a6accd">mydocker2</span></span>
<span class="line"><span style="color:#a6accd">a5ef57e8783f centos "/bin/bash" 3 minutes ago Exited (0) About a minute ago</span></span>
<span class="line"><span style="color:#a6accd">mydocker</span></span>
<span class="line"><span style="color:#a6accd">d132d6e645ad centos "/bin/echo 'Hello wo" 3 minutes ago Exited (0) 3 minutes</span></span>
<span class="line"><span style="color:#a6accd">ago serene_dijkstra</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p>docker startCONTAINER IDNAMES</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker start mydocker</span></span>
<span class="line"><span style="color:#a6accd">mydocker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>/bin/bash</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p><strong>Docker attach</strong></p><p>Dockerdocker attachdocker start</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker attach mydocker</span></span>
<span class="line"><span style="color:#a6accd">[root@a5ef57e8783f /]#</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><p> attach  attach ,?exit</p><p><strong>nsenter</strong></p><p>nsenterutil-linuxnsenter,LinuxCentOS</p><blockquote><p><strong>Yum</strong></p></blockquote><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@docker ~]# yum install -y util-linux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> PID</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># docker inspect --format "{{ .State.Pid }}" &lt;container ID or NAMES&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> PID</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># nsenter --target $PID --mount --uts --ipc --net pid</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# PID=$(docker inspect --format "{{ .State.Pid }}"</span></span>
<span class="line"><span style="color:#a6accd">mydocker)</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# echo $PID</span></span>
<span class="line"><span style="color:#a6accd">8029</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PID0mydocker</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# nsenter --target $PID --mount --uts --ipc --net --pid</span></span>
<span class="line"><span style="color:#a6accd">[root@a5ef57e8783f /]# ps -ef</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">UID PID PPID C STIME TTY TIME CMD</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">root 1 0 0 21:11 pts/0 00:00:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">root 14 0 0 21:12 pts/0 00:00:00 -bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">root 27 14 0 21:12 pts/0 00:00:00 ps -ef</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim docker_in.sh</span></span>
<span class="line"><span style="color:#a6accd">#!/bin/bash</span></span>
<span class="line"><span style="color:#a6accd"># Use nsenter to access docker</span></span>
<span class="line"><span style="color:#a6accd">docker_in(){</span></span>
<span class="line"><span style="color:#a6accd">NAME_ID=$1</span></span>
<span class="line"><span style="color:#a6accd">PID=$(docker inspect --format "{{ .State.Pid }}" $NAME_ID)</span></span>
<span class="line"><span style="color:#a6accd">nsenter --target $PID --mount --uts --ipc --net --pid</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">docker_in $1</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chmod +x docker_in.sh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>docker_in.shDockerID</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh mydocker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>dockerexecexec</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker exec mydocker whoami</span></span>
<span class="line"><span style="color:#a6accd">root</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>exec</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker exec -it mydocker /bin/bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>/bin/bashshellshellPID33</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]# ps -ef</span></span>
<span class="line"><span style="color:#a6accd">UID PID PPID C STIME TTY TIME CMD</span></span>
<span class="line"><span style="color:#a6accd">root 1 0 0 15:37 ? 00:00:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 33 0 0 15:41 ? 00:00:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 46 33 0 15:41 ? 00:00:00 ps -ef</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>docker execnsenterexitdocker attachexitattachnsenterexecshellattach/bin/bashshellDockerdockerDocker</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p> docker rm  </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@docker ~]# docker rm mydocker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>-fDocker SIGKILL</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p></p><h4 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">docker run --rm centos /bin/echo "One"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">docker kill $(docker ps -a -q)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">docker rm $(docker ps -a -q)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="-dangling-" tabindex="-1"> dangling  <a class="header-anchor" href="#-dangling-" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">docker rmi $(docker images -q -f dangling=true)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">docker rmi $(docker images -q)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><h4 id="" tabindex="-1">. <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">alias dockerkill='docker kill $(docker ps -a -q)'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="" tabindex="-1">. <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">alias dockerclean='docker rm $(docker ps -a -q)'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="" tabindex="-1">. <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">alias dockercleani='docker rmi $(docker images -q -f dangling=true)'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="" tabindex="-1">. <a class="header-anchor" href="#" aria-hidden="true">#</a></h4><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">alias dockerclean='dockercleanc || true &amp;&amp; dockercleani'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p></p></blockquote><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>dockerDockerIPDocker</p><p>Docker</p><p> -P  -p </p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p> -P Docker  49000~49900 </p><p>nginx-Psearchnginxnginx</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker search nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>docker pulldocker</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -P nginx</span></span>
<span class="line"><span style="color:#a6accd">Unable to find image 'nginx:latest' locally</span></span>
<span class="line"><span style="color:#a6accd">latest: Pulling from library/nginx</span></span>
<span class="line"><span style="color:#a6accd">6ae821421a7d: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">da4474e5966c: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">eb2aec2b9c9f: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">Digest: sha256:dd2d0ac3fff2f007d99e033b64854be0941e19a2ad51f174d9240dda20d9f534</span></span>
<span class="line"><span style="color:#a6accd">Status: Downloaded newer image for nginx:latest</span></span>
<span class="line"><span style="color:#a6accd">ecf14adb9dec09555ae31673753093e03941c41d917669dd1f254b51fdec7b51</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>-d</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">6819734a680c nginx "nginx -g 'daemon off" About an hour ago Up About an hour</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:32769-&gt;80/tcp, 0.0.0.0:32768-&gt;443/tcp hungry_mayer</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3276980</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head http://192.168.56.11:32769/</span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.11.3</span></span>
<span class="line"><span style="color:#a6accd">Date: Fri, 02 Sep 2016 17:44:14 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Tue, 26 Jul 2016 14:54:48 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "579779b8-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> docker logs </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker logs hungry_mayer</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 - - [02/Sep/2016:17:44:01 +0000] "HEAD / HTTP/1.1" 200 0 "-"</span></span>
<span class="line"><span style="color:#a6accd">"curl/7.29.0" "-"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 - - [02/Sep/2016:17:44:06 +0000] "GET / HTTP/1.1" 200 612 "-"</span></span>
<span class="line"><span style="color:#a6accd">"curl/7.29.0" "-"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 - - [02/Sep/2016:17:44:14 +0000] "HEAD / HTTP/1.1" 200 0 "-"</span></span>
<span class="line"><span style="color:#a6accd">"curl/7.29.0" "-"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ID</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>-p</p><ul><li>hostPort:containerPort</li><li>ip:hostPort:containerPort</li><li>ip::containerPort</li></ul><p><strong>IP</strong></p><p> hostPort:containerPort 80 Nginx 80 </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 80:80 --name nginx-demo1 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><p><strong></strong></p><p>IP ip:hostPort:containerPort Nginx80IP81</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 192.168.56.11:81:80 --name nginx-demo2</span></span>
<span class="line"><span style="color:#a6accd">nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p> ip::containerPort Nginx80192.168.56.11</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 192.168.56.11::80 --name nginx-demo3 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong> udp  udp </strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 192.168.56.11:53:53/udp name dns-udp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p>Docker-p </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 80:80 -p 443:443 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p> docker port </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker port nginx-demo1</span></span>
<span class="line"><span style="color:#a6accd">80/tcp -&gt; 0.0.0.0:80 </span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>DockerVolumemount</p><p></p><ul><li>Data volumes</li><li>Data volume containers</li></ul><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p><strong></strong></p><p>docker run-v</p><p>nginx/data</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test1 -v /data nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>/data</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh nginx-volume-test1</span></span>
<span class="line"><span style="color:#a6accd">root@00741a2a44ad:/# ls -l /data</span></span>
<span class="line"><span style="color:#a6accd">total 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>data/data Volume</p><p> docker inspect Volume</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker inspect -f {{.Mounts}} nginx-volume-test1</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[{861cbee5b650461490633fc60bd94a0df0f8b01e4a4dcc4adff4825dff509159</span></span>
<span class="line"><span style="color:#a6accd">/var/lib/docker/volumes/861cbee5b650461490633fc60bd94a0df0f8b01e4a4dcc4adff4825dff509159/_data</span></span>
<span class="line"><span style="color:#a6accd">/data local true }]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>/data/var/lib/docker/volumes/ID/_data</p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 _data]# touch mount-test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh nginx-volume-test1</span></span>
<span class="line"><span style="color:#a6accd">root@00741a2a44ad:/# ls -l /data</span></span>
<span class="line"><span style="color:#a6accd">total 0</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 0 Sep 2 18:58 mount-test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p>-v </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p /data/docker-volume-nginx</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test2 \</span></span>
<span class="line"><span style="color:#a6accd">-v /data/docker-volume-nginx:/data nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>/data/data/ docker-volume-nginx</p><p><strong></strong></p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test3 \</span></span>
<span class="line"><span style="color:#a6accd">-v /$HOME/.bash_history:/root/.bash_history nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>.bash_history</p><p><strong></strong></p><p>Docker  :ro </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test \</span></span>
<span class="line"><span style="color:#a6accd">-v /data/docker-volume-nginx:/data:ro nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p></p><p><strong></strong></p><p>Docker/home/code/data/webrootwebroot/data/webrootDockerD:codeVirtualBoxVmware workstationVmwareVmware Tools</p><p><img src="http://k8s.unixhot.com/docker/media/03822b520894cafdde1dbbc64b8b99e6.png" alt="img"></p><p><strong></strong></p><p></p><p>DockerBuildShipRunDocker</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>DockerVolume -volumes-from </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test4 \</span></span>
<span class="line"><span style="color:#a6accd">--volumes-from nginx-volume-test1 nginx</span></span>
<span class="line"><span style="color:#a6accd">7d650d332e3d9bf4086be35ae5a04b618f9d8e1df03fa2fef5f5766318a4ca12</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh nginx-volume-test4</span></span>
<span class="line"><span style="color:#a6accd">root@7d650d332e3d:~# ls /data</span></span>
<span class="line"><span style="color:#a6accd">mount-test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>nginx-volume-test1nginx-volume-test4nginx-volume-test1</p><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>logstashfilebeatlog-volume--volumes-from log-volumelogstash</p><h1 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h1><p>DockerDockerpullcentosNginx</p><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p></p><h3 id="-1" tabindex="-1"> <a class="header-anchor" href="#-1" aria-hidden="true">#</a></h3><p>CentOSmynginx</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull centos</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --name mynginx -it centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Nginx</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# yum install -y nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>DockerNginxforkNginx</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# vi /etc/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#a6accd">#</span></span>
<span class="line"><span style="color:#a6accd">daemon off;</span></span>
<span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# exit</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p><strong>ID</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -a | grep mynginx</span></span>
<span class="line"><span style="color:#a6accd">2e110e00eef4 centos "/bin/bash" 8 minutes ago Exited (0) 2 minutes ago mynginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker commit -m "My Nginx" 2e110e00eef4 test/mynginx:v1</span></span>
<span class="line"><span style="color:#a6accd">sha256:cfd25da2c9c5dd2bcce9e5d2ef4e316b46b5f03617176b97b60a34f2958a6d70</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>-mSVNGit</li><li> ID</li><li></li></ul><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images</span></span>
<span class="line"><span style="color:#a6accd">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#a6accd">test/mynginx v1 cfd25da2c9c5 49 seconds ago 373MB</span></span>
<span class="line"><span style="color:#a6accd">nginx latest f09fe80eb0e7 2 weeks ago 109MB</span></span>
<span class="line"><span style="color:#a6accd">centos latest 1e1148e4cc2c 2 months ago 202MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 91:80 test/mynginx:v1 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><h2 id="dockerfile" tabindex="-1">Dockerfile <a class="header-anchor" href="#dockerfile" aria-hidden="true">#</a></h2><p>Dockerfiledocker imagedocker builddocker Dockerfile()docker imageSaltStack</p><p>Dockerfile #</p><p>NginxDockerfile</p><h3 id="nginx-dockerfile" tabindex="-1">Nginx Dockerfile <a class="header-anchor" href="#nginx-dockerfile" aria-hidden="true">#</a></h3><p><strong>FROM</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p /opt/dockerfile/mynginx</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/mynginx/</span></span>
<span class="line"><span style="color:#a6accd">[root@test-node1 nginx]# vim Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># This docker file uses the centos image</span></span>
<span class="line"><span style="color:#a6accd"># VERSION 1</span></span>
<span class="line"><span style="color:#a6accd"># Author: Jason Zhao</span></span>
<span class="line"><span style="color:#a6accd"># Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM centos</span></span>
<span class="line"><span style="color:#a6accd"># Maintainer</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER shundong.zhao zhaoshundong@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Commands to update the image</span></span>
<span class="line"><span style="color:#a6accd">RUN rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y nginx --enablerepo=epel</span></span>
<span class="line"><span style="color:#a6accd">ADD index.html /usr/share/nginx/html/index.html</span></span>
<span class="line"><span style="color:#a6accd">RUN echo "daemon off;" &gt;&gt; /etc/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 80</span></span>
<span class="line"><span style="color:#a6accd">CMD ["nginx"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><p>Dockerfile </p><ul><li></li><li></li><li></li><li></li></ul><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p><img src="http://k8s.unixhot.com/docker/media/74da151d98647093a4d1ade4f222fbe7.png" alt="img"></p><p><strong>Dockerfile</strong></p><p>ADD index.html</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 mynginx]# echo "nginx in docker test" &gt; index.html</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>dokcer build.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 mynginx]# docker build -t mynginx:v2 .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Run</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 92:80 mynginx:v2 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 mynginx]# curl http://192.168.56.11:92</span></span>
<span class="line"><span style="color:#a6accd">nginx in docker test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Dockerfile</p><h3 id="dockerfile" tabindex="-1">Dockerfile <a class="header-anchor" href="#dockerfile" aria-hidden="true">#</a></h3><p></p><p><strong>FROM</strong></p><p>FROM <img src="" alt="img">FROM <img src="" alt="img">: FROMDockerfilePullFROM</p><p><strong>MAINTAINER</strong></p><p>MAINTAINER </p><p><strong>RUN</strong></p><p>RUN  RUN ["executable", "param1", "param2"] </p><p><strong>CMD</strong></p><p></p><p>CMD ["executable","param1","param2"]  exec  CMD command param1 param2  /bin/sh  CMD ["param1","param2"] ENTRYPOINT</p><p></p><p>CMDDockerfileCMDDockerfileCMD</p><p><strong>ENTRYPOINT</strong></p><p></p><p>ENTRYPOINT ["executable", "param1", "param2"] ENTRYPOINT command param1 param2shell CMD docker run</p><p> Dockerfile ENTRYPOINTENTRYPOINTCMDENTRYPOINT</p><p>ENTRYPOINTCMD</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">ENTRYPOINT ["/usr/bin/rethinkdb"]</span></span>
<span class="line"><span style="color:#a6accd">CMD ["--help"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>USER</strong></p><p>USER daemon UIDRUN</p><p><strong>EXPOSE</strong></p><p>EXPOSE [...] Docker-p-P</p><p><strong>ENV</strong></p><p>ENV ENV = ... RUNRUN</p><p><strong>ADD</strong></p><p> ADD ... ADD ["",... ""] </p><p>container0755,uidgid0 docker</p><p><strong>VOLUME</strong></p><p>VOLUME ["/data"] containercontainer</p><p><strong>WORKDIR</strong></p><p>WORKDIR /path/to/workdir  RUNCMDENTRYPOINT (cd) WORKDIR </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">WORKDIR /a</span></span>
<span class="line"><span style="color:#a6accd">WORKDIR b</span></span>
<span class="line"><span style="color:#a6accd">WORKDIR c</span></span>
<span class="line"><span style="color:#a6accd">RUN pwd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> /a/b/c</p><p><strong>ONBUILD</strong></p><p>ONBUILD </p><p><strong>ARG</strong></p><p>ARG [=] ARGdocker build--build-arg =</p><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h2><p>DockerfileDockerfile</p><p>Dockerfile<a href="https://github.com/dockerfile%E3%80%82" target="_blank" rel="noreferrer">https://github.com/dockerfile</a></p><p>DockerfileDockerDocker</p><ul><li></li><li></li><li></li></ul><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /opt/dockerfile</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 dockerfile]# mkdir system runtime app</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 dockerfile]# tree</span></span>
<span class="line"><span style="color:#a6accd">.</span></span>
<span class="line"><span style="color:#a6accd"> app</span></span>
<span class="line"><span style="color:#a6accd"> runtime</span></span>
<span class="line"><span style="color:#a6accd"> system</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><h3 id="centos" tabindex="-1">CentOS <a class="header-anchor" href="#centos" aria-hidden="true">#</a></h3><p>CentOSyumyum clean all</p><p>yumheadercacheyum clean all</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/system/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 system]# mkdir centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>1.Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# vim centos/Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">**FROM** centos</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">**MAINTAINER** Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">**RUN** rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">**RUN** yum install -y wget mysql-devel supervisor git redis tree net-tools sudo</span></span>
<span class="line"><span style="color:#a6accd">psmisc &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker build -t unixhot/centos ./centos/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 24 seconds ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker run --name mycentos -it unixhot/centos</span></span>
<span class="line"><span style="color:#a6accd">/bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@b137b1cdd3ac /]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.3 0.0 11776 1872 ? Ss 03:56 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 15 0.0 0.0 47424 1668 ? R+ 03:56 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="centosssh" tabindex="-1">CentOSSSH <a class="header-anchor" href="#centosssh" aria-hidden="true">#</a></h3><p>CentOSsshdopenssh-serverSSHchpasswd</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/system/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 system]# mkdir centos-ssh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>1.Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# vim centos-ssh/Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM centos</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#EPEL</span></span>
<span class="line"><span style="color:#a6accd">RUN rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y openssh-clients openssl-devel openssh-server wget mysql-devel</span></span>
<span class="line"><span style="color:#a6accd">supervisor git redis tree net-tools sudo psmisc &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># For SSHD</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -A -t dsa -f /etc/ssh/ssh_host_dsa_key</span></span>
<span class="line"><span style="color:#a6accd"># Set root password</span></span>
<span class="line"><span style="color:#a6accd">RUN echo "root:unixhot.com" | chpasswd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker build -t unixhot/centos-ssh:v1 ./centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd">Sending build context to Docker daemon 2.048 kB</span></span>
<span class="line"><span style="color:#a6accd">Step 1 : FROM centos</span></span>
<span class="line"><span style="color:#a6accd">---&gt; 980e0e4c79ec</span></span>
<span class="line"><span style="color:#a6accd">Step 2 : MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">---&gt; **Using cache**</span></span>
<span class="line"><span style="color:#a6accd">---&gt; d08da8648d91</span></span>
<span class="line"><span style="color:#a6accd">Step 3 : RUN rpm -ivh</span></span>
<span class="line"><span style="color:#a6accd">http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">---&gt; **Using cache**</span></span>
<span class="line"><span style="color:#a6accd">---&gt; ad9a05bcfb78</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>Using cacheDockerlayer</p></blockquote><p><strong>3.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 19 seconds ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 2 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker run -d --name centos-ssh-demo -p 8022:22</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh:v1 /usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">5f5bbe98a17c620f91a7d3e68a605a4bcbd48621f32aaa095245e59a8691e229</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">5f5bbe98a17c unixhot/centos-ssh:v1 "/usr/sbin/sshd -D" 5 seconds ago Up 2</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:8022-&gt;22/tcp centos-ssh-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.ssh</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh -p 8022 root@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">root@192.168.56.11's password:</span></span>
<span class="line"><span style="color:#a6accd">[root@5f5bbe98a17c ~]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.0 0.0 82560 3600 ? Ss 05:46 0:00 /usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">root 7 0.0 0.0 11636 1116 ? Ss 05:47 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 13 0.0 0.0 11636 1116 ? Ss 05:48 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 63 0.7 0.0 139272 5424 ? Ss 05:51 0:00 sshd: root@pts/0</span></span>
<span class="line"><span style="color:#a6accd">root 65 0.5 0.0 13376 1988 pts/0 Ss 05:51 0:00 -bash</span></span>
<span class="line"><span style="color:#a6accd">root 78 0.0 0.0 49024 1808 pts/0 R+ 05:51 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Good JobsshDockerDockersshdssh<a href="http://xn--start-fg1hyjn9fbll9onm0app1b175dr5f.sh" target="_blank" rel="noreferrer">start.sh</a>start.shSupervisor</p><h3 id="supervisor" tabindex="-1">Supervisor <a class="header-anchor" href="#supervisor" aria-hidden="true">#</a></h3><p>Supervisor (<a href="http://supervisord.org/" target="_blank" rel="noreferrer">http://supervisord.org</a>)  Python  Python </p><p>Supervisor  LinuxMac OS X supervisor  Python  pip :</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">pip install supervisor</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>sshsupervisorDockerfile</p><p><strong>1.supervisordocker</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker run --rm -it unixhot/centos-ssh:v1 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 /]# ls -l /etc/supervisord*</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 7953 Aug 20 2015 /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">/etc/supervisord.d:</span></span>
<span class="line"><span style="color:#a6accd">total 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>yumsupervisordsupervisor/etc/supervisord.conf</p><p><strong>2.Supervisor</strong></p><p>Supervisor supervisordsupervisor  C/S  server  client supervisorctl</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@98aced104917 /]# vi /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**[unix_http_server]**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># file=/var/run/supervisor/supervisor.sock #UNIX socket supervisorctl</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**[supervisord]**</span></span>
<span class="line"><span style="color:#a6accd">logfile=/var/log/supervisor/supervisord.log #</span></span>
<span class="line"><span style="color:#a6accd">$CWD/supervisord.log</span></span>
<span class="line"><span style="color:#a6accd">logfile_maxbytes=50MB # rotate 50MB</span></span>
<span class="line"><span style="color:#a6accd">logfile_backups=10 # 10</span></span>
<span class="line"><span style="color:#a6accd">loglevel=info # info: debug,warn,trace</span></span>
<span class="line"><span style="color:#a6accd">pidfile=/var/run/supervisord.pid #pid</span></span>
<span class="line"><span style="color:#a6accd">**nodaemon=true #supervisor**</span></span>
<span class="line"><span style="color:#a6accd">minfds=1024 # 1024</span></span>
<span class="line"><span style="color:#a6accd">minprocs=200 # 200</span></span>
<span class="line"><span style="color:#a6accd">**[supervisorctl]**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># UNIX socket  supervisord unix_http_server  file </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">serverurl=unix:///var/run/supervisor/supervisor.sock ; use a unix:// URL for a</span></span>
<span class="line"><span style="color:#a6accd">unix socket</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**[include]**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#supervisord.d*.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">files = supervisord.d/*.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3. program </strong></p><p>supervisornodaemon=true</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">;[program:theprogramname]</span></span>
<span class="line"><span style="color:#a6accd">;command=/bin/cat ; the program (relative uses PATH, can take args)</span></span>
<span class="line"><span style="color:#a6accd">;process_name=%(program_name)s ; process_name expr (default %(program_name)s)</span></span>
<span class="line"><span style="color:#a6accd">;numprocs=1 ; number of processes copies to start (def 1)</span></span>
<span class="line"><span style="color:#a6accd">;directory=/tmp ; directory to cwd to before exec (def no cwd)</span></span>
<span class="line"><span style="color:#a6accd">;umask=022 ; umask for process (default None)</span></span>
<span class="line"><span style="color:#a6accd">;priority=999 ; the relative start priority (default 999)</span></span>
<span class="line"><span style="color:#a6accd">;autostart=true ; start at supervisord start (default: true)</span></span>
<span class="line"><span style="color:#a6accd">;autorestart=true ; retstart at unexpected quit (default: true)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>sshd/etc/supervisord.d.ini</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@98aced104917 /]# vi /etc/supervisord.d/sshd.ini</span></span>
<span class="line"><span style="color:#a6accd">[program:sshd]</span></span>
<span class="line"><span style="color:#a6accd">command=/usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">process_name=%(program_name)s</span></span>
<span class="line"><span style="color:#a6accd">autostart=true</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_maxbytes=100MB</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_backups=10</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.supervisord</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# /usr/bin/supervisord -c /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# netstat -ntlp</span></span>
<span class="line"><span style="color:#a6accd">Active Internet connections (only servers)</span></span>
<span class="line"><span style="color:#a6accd">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</span></span>
<span class="line"><span style="color:#a6accd">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 31/sshd</span></span>
<span class="line"><span style="color:#a6accd">tcp6 0 0 :::22 :::* LISTEN 31/sshd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>sshdsupervisor</p><p><strong>5.  supervisorctl</strong></p><p>Supervisorctl  supervisord supervisord</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd RUNNING pid 31, uptime 0:02:35</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>sshd</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl stop sshd</span></span>
<span class="line"><span style="color:#a6accd">sshd: stopped</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd STOPPED Oct 14 06:45 AM</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl start sshd</span></span>
<span class="line"><span style="color:#a6accd">sshd: started</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd RUNNING pid 42, uptime 0:00:03</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6..supervisord.confscpDockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@98aced104917 /]# scp /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11:/opt/dockerfile/system/centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# scp /etc/supervisord.d/sshd.ini</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11:/opt/dockerfile/system/centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><h3 id="centos" tabindex="-1">CentOS <a class="header-anchor" href="#centos" aria-hidden="true">#</a></h3><p>sshcentossshsupervisor</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/system/centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 16</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 554 Oct 14 01:40 Dockerfile</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 142 Oct 14 02:53 sshd.ini</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 7953 Oct 14 02:30 supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>1.Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# vim Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM centos</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#EPEL</span></span>
<span class="line"><span style="color:#a6accd">RUN rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y openssh-clients openssl-devel openssh-server wget mysql-devel</span></span>
<span class="line"><span style="color:#a6accd">supervisor git redis tree net-tools sudo psmisc &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># For SSHD</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -A -t dsa -f /etc/ssh/ssh_host_dsa_key</span></span>
<span class="line"><span style="color:#a6accd"># Set root password</span></span>
<span class="line"><span style="color:#a6accd">RUN echo "root:unixhot.com" | chpasswd</span></span>
<span class="line"><span style="color:#a6accd">#Supervisord config</span></span>
<span class="line"><span style="color:#a6accd">ADD supervisord.conf /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">ADD sshd.ini /etc/supervisord.d/sshd.ini</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# docker build -t unixhot/centos-ssh:latest .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest 0d4b39f9100e 31 seconds ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 About an hour ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 3 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name centos-ssh-supervisor -p 2222:22</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh</span></span>
<span class="line"><span style="color:#a6accd">9ebf53b3cacd093c11a9b5773c5fc62875626061f3f3fe0b5380013c78f2f15b</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">9ebf53b3cacd unixhot/centos-ssh "/usr/bin/supervisord" 6 seconds ago Up 3</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:2222-&gt;22/tcp centos-ssh-supervisor</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.ssh</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh root@192.168.56.11 -p 2222</span></span>
<span class="line"><span style="color:#a6accd">root@192.168.56.11's password:</span></span>
<span class="line"><span style="color:#a6accd">[root@9ebf53b3cacd ~]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.3 0.0 117248 14668 ? Ss 07:25 0:00 /usr/bin/python /usr/bin/supervisord</span></span>
<span class="line"><span style="color:#a6accd">-c /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">root 9 0.0 0.0 82560 3608 ? S 07:25 0:00 /usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">root 25 1.2 0.0 139272 5428 ? Ss 07:26 0:00 sshd: root@pts/0</span></span>
<span class="line"><span style="color:#a6accd">root 27 0.0 0.0 13376 1984 pts/0 Ss 07:27 0:00 -bash</span></span>
<span class="line"><span style="color:#a6accd">root 40 0.0 0.0 49024 1808 pts/0 R+ 07:27 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p>supervisor</p><p>Dockercentos-sshsupervisorini</p><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p></p><h3 id="java-" tabindex="-1">Java  <a class="header-anchor" href="#java-" aria-hidden="true">#</a></h3><p>JavaJavaJDKJDK</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/runtime/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# mkdir java</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Javacentos-sshJavaDockerfile</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --rm -it unixhot/centos-ssh /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@ec2696c0f9f4 /]# yum install -y java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd">java-1.8.0-openjdk-devel</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>yumopenjdkJAVA_HOMEjava</p><p><strong>1.Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# vim java/Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM unixhot/centos-ssh</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># JAVA_HOME</span></span>
<span class="line"><span style="color:#a6accd">ENV JAVA_HOME /usr/lib/jvm/java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# docker build -t unixhot/runtime-java ./java/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-java latest ff3a2bb0b2a9 2 minutes ago 505.1 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest 02d375a33cd1 38 minutes ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 2 hours ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 4 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><h3 id="tomcat" tabindex="-1">Tomcat <a class="header-anchor" href="#tomcat" aria-hidden="true">#</a></h3><p><strong>JavaJavaTomcat</strong></p><p><strong>1.centos-ssh</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --rm -it unixhot/centos-ssh /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef /]# yum install -y java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd">java-1.8.0-openjdk-devel</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>JavaTomcat</strong></p><p>JavaTomcat</p><p>TomcatJavaJDK 1.8Java1.7JDK 1.7TomcatJava 1.7</p><p><strong>2.Tomcat 8</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@80f529b965ef /]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# wget http://mirrors.cnnic.cn/apache/tomcat/tomcat-8/v8.5.6/bin/apache-tomcat-8.5.6.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# tar zxf apache-tomcat-8.5.6.tar</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# mv apache-tomcat-8.5.6 /usr/local/</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# ln -s /usr/local/apache-tomcat-8.5.6/</span></span>
<span class="line"><span style="color:#a6accd">/usr/local/tomcat</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.supervisortomcat</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@897cc10b8adf ~]# cd /etc/supervisord.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@897cc10b8adf supervisord.d]# vi tomcat.ini</span></span>
<span class="line"><span style="color:#a6accd">[program:tomcat]</span></span>
<span class="line"><span style="color:#a6accd">command=/usr/local/tomcat/bin/catalina.sh run</span></span>
<span class="line"><span style="color:#a6accd">process_name=%(program_name)s</span></span>
<span class="line"><span style="color:#a6accd">autostart=true</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_maxbytes=100MB</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_backups=10</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>supervisortomcat</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@897cc10b8adf supervisord.d]# supervisorctl update</span></span>
<span class="line"><span style="color:#a6accd">tomcat: stopped</span></span>
<span class="line"><span style="color:#a6accd">tomcat: updated process group</span></span>
<span class="line"><span style="color:#a6accd">[root@897cc10b8adf supervisord.d]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd RUNNING pid 408, uptime 0:06:00</span></span>
<span class="line"><span style="color:#a6accd">tomcat RUNNING pid 704, uptime 0:00:03</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.Dockerfile</strong></p><p>Dockerfileapache-tomcatwgetDockerfile ADD</p><p>Tomcat</p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/runtime/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# mkdir tomcat</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# cd tomcat/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# wget http://mirrors.cnnic.cn/apache/tomcat/tomcat-8/v8.5.6/bin/apache-tomcat-8.5.6.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM unixhot/centos-ssh</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># JAVA_HOME</span></span>
<span class="line"><span style="color:#a6accd">ENV JAVA_HOME /usr/lib/jvm/java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd"># Tomcat</span></span>
<span class="line"><span style="color:#a6accd">ADD apache-tomcat-8.5.6.tar.gz /usr/local/</span></span>
<span class="line"><span style="color:#a6accd">RUN ln -s /usr/local/apache-tomcat-8.5.6 /usr/local/tomcat</span></span>
<span class="line"><span style="color:#a6accd">ADD tomcat.ini /etc/supervisord.d/tomcat.ini</span></span>
<span class="line"><span style="color:#a6accd">ENV TOMCAT_HOME /usr/local/tomcat</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22 8080</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.tomcat</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 9096</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 9304958 Oct 6 16:39 apache-tomcat-8.5.6.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 546 Oct 14 05:51 Dockerfile</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 165 Oct 14 06:33 tomcat.ini</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker build -t unixhot/runtime-tomcat .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>7.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-tomcat latest ef8372a88ad4 6 minutes ago 518.2 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-java latest ff3a2bb0b2a9 2 hours ago 505.1 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest 02d375a33cd1 3 hours ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 4 hours ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 6 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>8.tomcat-demo</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker run -d --name tomcat-demo -p 88:8080 -p</span></span>
<span class="line"><span style="color:#a6accd">89:22 unixhot/runtime-tomcat</span></span>
<span class="line"><span style="color:#a6accd">8cea3ef85634210eb0cfab0f65a63b0ebd6961b5a67fc765b762785c01cd2c18</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">8cea3ef85634 unixhot/runtime-tomcat "/usr/bin/supervisord" 5 seconds ago Up 2</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:89-&gt;22/tcp, 0.0.0.0:88-&gt;8080/tcp tomcat-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>9.tomcat</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">http://192.168.56.11:88/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p>PHPJenkins</p><h3 id="jenkins" tabindex="-1">Jenkins <a class="header-anchor" href="#jenkins" aria-hidden="true">#</a></h3><p>JenkinsJenkinsJavayumwartomcat</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/app/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 app]# mkdir jenkins</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 app]# cd jenkins/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# wget http://mirrors.jenkins-ci.org/war/latest/jenkins.war</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM unixhot/runtime-tomcat</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd"># Jenkins</span></span>
<span class="line"><span style="color:#a6accd">ADD jenkins.war /usr/local/tomcat/webapps/</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22 8080</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.jenkins</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker build -t unixhot/jenkins .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins latest a7b16bc093ed 40 seconds ago 588.7 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-tomcat latest 3b596c9a7696 2 hours ago 518.8 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-java latest 476a6a2fc074 2 hours ago 505.8 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest d85aa8a9dfd4 3 hours ago 304.6 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 3309208ed679 4 hours ago 300.9 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 83f0491a30e1 4 hours ago 282.3 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.jenkins-demo</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker run -d --name jenkins-demo -p 91:22 -p</span></span>
<span class="line"><span style="color:#a6accd">92:8080 unixhot/jenkins</span></span>
<span class="line"><span style="color:#a6accd">6d88ba756befc84ef1820818994be028c12ac13825c2b439d680358d101e922e</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">6d88ba756bef unixhot/jenkins "/usr/bin/supervisord" 7 seconds ago Up 2 seconds</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:91-&gt;22/tcp, 0.0.0.0:92-&gt;8080/tcp jenkins-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.jenkins</strong></p><p><img src="http://k8s.unixhot.com/docker/media/e59722d6316d2cc9702c1989e1c9f3f1.png" alt="img"></p><p>Jenkins</p><p><strong>7.Jenkinsjenkins-login</strong></p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh jenkins-demo</span></span>
<span class="line"><span style="color:#a6accd">[root@b3bbada66693 /]# cat /root/.jenkins/secrets/initialAdminPassword</span></span>
<span class="line"><span style="color:#a6accd">b5257b8891464ebf890b38c00d24de71</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Container ID</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">b3bbada66693 unixhot/jenkins "/usr/bin/supervisord" 9 minutes ago Up 9 minutes</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:91-&gt;22/tcp, 0.0.0.0:92-&gt;8080/tcp jenkins-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker commit -m "jenkins login" b3bbada66693</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins-login</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images | grep jenkins</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins-login latest c453363bb9f7 22 seconds ago 776.6 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins latest a7b16bc093ed 13 minutes ago 588.7 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>8.jenkins-login</strong></p><p>Jenkins</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name jenkins-login -p 93:22 -p 94:8080</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins-login</span></span>
<span class="line"><span style="color:#a6accd">af421b4d5b076c756ab58ed8cc95c615a321f9517d30b755667d5d80d1336a63</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">af421b4d5b07 unixhot/jenkins-login "/usr/bin/supervisord" 4 seconds ago Up 2</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:93-&gt;22/tcp, 0.0.0.0:94-&gt;8080/tcp jenkins-login</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>9.Jenkins</strong></p><p><img src="http://k8s.unixhot.com/docker/media/04b8b149d6c7ce1e18f67796998be9b5.png" alt="img"></p><h1 id="_3-docker" tabindex="-1">3 Docker <a class="header-anchor" href="#_3-docker" aria-hidden="true">#</a></h1><h2 id="docker-registry" tabindex="-1">Docker Registry <a class="header-anchor" href="#docker-registry" aria-hidden="true">#</a></h2><h3 id="docker-registry" tabindex="-1">Docker Registry <a class="header-anchor" href="#docker-registry" aria-hidden="true">#</a></h3><p> Docker  registry </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name docker-registry -p 5000:5000 registry</span></span>
<span class="line"><span style="color:#a6accd">b822d0a3e77e6a3144408119ccc2e7344f60f7404651adc025ce84561245b2d2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">"registry-mirrors": ["https://tdimi5q1.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">"insecure-registries" : ["http://192.168.56.11:5000"]</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="pushdocker-registry" tabindex="-1">PushDocker Registry <a class="header-anchor" href="#pushdocker-registry" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker tag system/centos 192.168.56.11:5000/system/centos</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker push 192.168.56.11:5000/system/centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="registryharbor" tabindex="-1">RegistryHarbor <a class="header-anchor" href="#registryharbor" aria-hidden="true">#</a></h2><p>Docker RegistryDocker RegisryRegistryHarbor</p><p><strong>Harbor</strong></p><p>HarborDockerRegistryDocker DistributionRegistryHarborRegistryHarborRegistryRegistry Harbor</p><p> - Dockerproject</p><p> - Registry</p><p> - Docker</p><p>AD/LDAP  - HarborAD/LDAP</p><p> - </p><p> - </p><p>RESTful API - RESTful API Harbor, </p><p> -  vSphere(OVA)</p><h3 id="harbor" tabindex="-1">Harbor <a class="header-anchor" href="#harbor" aria-hidden="true">#</a></h3><p>Harborcloneofflinegithubreleases1.7.1<em><a href="https://github.com/vmware/harbor/releases" target="_blank" rel="noreferrer">https://github.com/vmware/harbor/releases</a></em></p><p>offlineharbordockerharbor</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"># wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.1.tgz</span></span>
<span class="line"><span style="color:#a6accd"># tar zxf harbor-offline-installer-v1.7.1.tgz</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>HarborDockerDocker Composedocker-compose.yml</p><h3 id="harbor" tabindex="-1">Harbor <a class="header-anchor" href="#harbor" aria-hidden="true">#</a></h3><p><strong>HarborHTTP</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd harbor</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 harbor]# vim harbor.cfg</span></span>
<span class="line"><span style="color:#a6accd">hostname = 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Docker</strong></p><p>httpharborDocker</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">"registry-mirrors": ["https://tdimi5q1.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">"insecure-registries" : ["http://192.168.56.11"]</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Harborhttps</strong></p><p>HarborhttpSSL</p><p><strong>1.</strong></p><p>SSLSymantec DV SSLNginx</p><p><strong>2.Harbor</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@docker-node1 harbor]# cd /usr/local/src/harbor/</span></span>
<span class="line"><span style="color:#a6accd">[root@docker-node1 harbor]# vim harbor.cfg</span></span>
<span class="line"><span style="color:#a6accd">hostname = reg.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">ui_url_protocol = https</span></span>
<span class="line"><span style="color:#a6accd">ssl_cert = /usr/local/src/harbor/1_registry.linuxhot.com_bundle.crt</span></span>
<span class="line"><span style="color:#a6accd">ssl_cert_key = /usr/local/src/harbor/2_registry.linuxhot.com.key</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><p><strong>Docker Compose</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]#yum install -y docker-compose</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker-compose --version</span></span>
<span class="line"><span style="color:#a6accd">docker-compose version 1.8.0, build 94f7016</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Harbor</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-harbor-1 ~]# cd /usr/local/src/harbor/</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-harbor-1 harbor]# ./install.sh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Harbor</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-harbor-1 harbor]# docker-compose ps</span></span>
<span class="line"><span style="color:#a6accd">Name Command State Ports</span></span>
<span class="line"><span style="color:#a6accd">------------------------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">harbor-adminserver /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd">harbor-core /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd">harbor-db /entrypoint.sh postgres Up 5432/tcp</span></span>
<span class="line"><span style="color:#a6accd">harbor-jobservice /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd">harbor-log /bin/sh -c /usr/local/bin/ ... Up 127.0.0.1:1514-&gt;10514/tcp</span></span>
<span class="line"><span style="color:#a6accd">harbor-portal nginx -g daemon off; Up 80/tcp</span></span>
<span class="line"><span style="color:#a6accd">nginx nginx -g daemon off; Up 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp,</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:80-&gt;80/tcp</span></span>
<span class="line"><span style="color:#a6accd">redis docker-entrypoint.sh redis ... Up 6379/tcp</span></span>
<span class="line"><span style="color:#a6accd">registry /entrypoint.sh /etc/regist ... Up 5000/tcp</span></span>
<span class="line"><span style="color:#a6accd">registryctl /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="harborregistry" tabindex="-1">HarborRegistry <a class="header-anchor" href="#harborregistry" aria-hidden="true">#</a></h3><p><a href="http://reg.linuxhot.xn--com-vj3fu53h4lw8bl.xn--admin%2Charbor12345-8l75a8z3f3f3fwrmtj9hrk9d./" target="_blank" rel="noreferrer">http://reg.linuxhot.comadminHarbor12345</a></p><p><img src="http://k8s.unixhot.com/docker/media/366c20c68d5e6467434fb8108baa6081.png" alt="img"></p><p>library</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker login reg.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">Username: admin</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span>
<span class="line"><span style="color:#a6accd">Configure a credential helper to remove this warning. See</span></span>
<span class="line"><span style="color:#a6accd">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span>
<span class="line"><span style="color:#a6accd">Login Succeeded</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Registry</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd"># docker tag centos:latest reg.linuxhot.com/system/centos:latest</span></span>
<span class="line"><span style="color:#a6accd"># docker push reg.linuxhot.com/system/centos:latest</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h1><p>KubernetesKubernetesKubernetesKubernetes</p><ul><li>Kubernetes<a href="https://kubernetes.io/docs/home/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/home/</a></li><li>Kuernetes Github<a href="https://github.com/kubernetes/" target="_blank" rel="noreferrer">https://github.com/kubernetes/</a></li></ul><h2 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h2><p>Kubernetes    KS8K8SKubernetes  Google 15 KubernetesGoogleBrog</p><h3 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h3><p>KubernetesMasterNodeOpenStackMasterNodeMasterAPI ServerRestAPIKubernetesAPI Server</p><p><img src="http://k8s.unixhot.com/kubernetes/media/4f93fc22b605a967fa54a2491557c04e.png" alt="img"></p><p><strong>Master</strong></p><p>Kubernetes Master4API ServerSchedulerControlleretcd</p><p><img src="http://k8s.unixhot.com/kubernetes/media/0786901c59be2f756d7b979619a048b2.png" alt="img"></p><ul><li><strong>API Server</strong>Kubernetes API RestEtcd</li><li><strong>Scheduler</strong>PodNode</li><li><strong>Controller Manager</strong>ManagerKubernetes</li><li><strong>Etcd</strong>EtcdKubernetes</li></ul><p><strong>Node</strong></p><p>NodeKubernetesNodeDockerKubeletkube-proxyFluentd</p><p><img src="http://k8s.unixhot.com/kubernetes/media/ff26ae9ea18c1a93e50b8226abfa2fa7.png" alt="img"></p><ul><li><strong>Docker Engine</strong>Docker</li><li><strong>Kubelet</strong>NodePodsVolume</li><li><strong>Kube-proxy</strong>NodeService</li></ul><h3 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h3><p>PodServiceKubernetesKubernetesMasterNodeKubernetesPodService</p><p><strong>Pod</strong></p><p>PodKubernetesPodPodPodIPPodIP</p><p><img src="http://k8s.unixhot.com/kubernetes/media/e2a89d5ac819b578808e62d8fee0e960.png" alt="img"></p><p><strong>Controller</strong></p><p>PodPodKubernetesPodReplication ControllerPod</p><p><img src="http://k8s.unixhot.com/kubernetes/media/c4ae2886ff4fdb51b9a0dd20a14c8e50.png" alt="img"></p><p>Kubernetes</p><ul><li>Replication ControllerReplicaSet</li><li>ReplicaSetDeployment</li><li>DeploymentPod</li><li>DaemonSetNodePod</li><li>StatefulSet Pod  scale </li><li>JobKubernetes</li><li>CronJobKubernetes</li></ul><p><strong>Service</strong></p><p>PodPodIPPodKubernetesServicePodServiceCluster IPVIP</p><p><img src="http://k8s.unixhot.com/kubernetes/media/2e61328894d1eaf548ad6ff06d85a6a3.png" alt="img"></p><h3 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h3><p>KubernetesNodePodServiceKubernetesFlannelCalicoCannal</p><p><strong>Node</strong></p><p>NodeKubernetes Node192.168.56.0/24NodeMaster</p><p><strong>Pod</strong></p><p>PodPodIPIPPod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-hpn68 1/1 Running 0 9m7s 10.2.1.2 linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">&lt;none&gt; &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-r4mfq 1/1 Running 0 7m46s 10.2.1.3 linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">&lt;none&gt; &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Service</strong></p><p>ServicePod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">kubernetes ClusterIP 10.1.0.1 &lt;none&gt; 443/TCP 64m</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx NodePort 10.1.216.23 &lt;none&gt; 80:30893/TCP 8m3s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>KubernetesKubernetes</p><h2 id="kubeadmkubernetes-v1-16-4" tabindex="-1">kubeadmKubernetes v1.16.4 <a class="header-anchor" href="#kubeadmkubernetes-v1-16-4" aria-hidden="true">#</a></h2><p>KuberneteskubeadmKubernetesKuberneteskubeadmKubernetesKubernetesKubernetes</p><blockquote><p></p></blockquote><p>Kubernetesv1.13kubeadmGAKuberneteskubeadmKuberneteskubeadmKubernetes v1.16.2</p><p><strong></strong></p><p></p><table><thead><tr><th></th><th>IPNAT</th><th></th><th></th></tr></thead><tbody><tr><td><a href="http://linux-node1.linuxhot.com" target="_blank" rel="noreferrer">linux-node1.linuxhot.com</a></td><td>eth0:192.168.56.11</td><td>1CPU/1G</td><td>Kubernets Master/Etcd</td></tr><tr><td><a href="http://linux-node2.linuxhot.com" target="_blank" rel="noreferrer">linux-node2.linuxhot.com</a></td><td>eth0:192.168.56.12</td><td>1CPU/1G</td><td>Kubernets Node</td></tr><tr><td><a href="http://linux-node3.linuxhot.com" target="_blank" rel="noreferrer">linux-node3.linuxhot.com</a></td><td>eth0:192.168.56.13</td><td>1CPU/1G</td><td>Kubernets Node</td></tr><tr><td>Service</td><td>10.1.0.0/16</td><td></td><td></td></tr><tr><td>Pod</td><td>10.2.0.0/16</td><td></td><td></td></tr><tr><td></td><td>Kubernets node</td><td></td><td></td></tr></tbody></table><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h3><p>KubernetesDockerkubeadm</p><p><strong>1.Yum</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /etc/yum.repos.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 yum.repos.d]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.Docker</strong></p><p>kubeadmDockerKubernetesChanglog1.16.2CHANGELOG<a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.16.md" target="_blank" rel="noreferrer">CHANGELOG</a></p><p>v1.16.2Dockerv1.13.1, 17.03, 17.06, 17.09, 18.06, 18.09,</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum list docker-ce.x86_64 --showduplicates | sort -r</span></span>
<span class="line"><span style="color:#a6accd"> * updates: mirror.jdcloud.com</span></span>
<span class="line"><span style="color:#a6accd">Loading mirror speeds from cached hostfile</span></span>
<span class="line"><span style="color:#a6accd">Loaded plugins: fastestmirror</span></span>
<span class="line"><span style="color:#a6accd"> * extras: mirror.jdcloud.com</span></span>
<span class="line"><span style="color:#a6accd"> * epel: mirrors.njupt.edu.cn</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.4-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.3-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.2-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.1-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.0-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.9-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.8-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.7-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.6-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.5-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.4-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.3-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.2-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.1-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.0-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.3.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.2.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.1.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.0.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.03.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.03.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.12.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.12.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.09.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.09.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.06.2.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.06.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.06.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.3.ce-1.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.2.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd"> * base: mirrors.neusoft.edu.cn</span></span>
<span class="line"><span style="color:#a6accd">Available Packages</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.Docker18.09</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum -y install docker-ce-18.09.9-3.el7 docker-ce-cli-18.09.9-3.el7</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.cgroupsystemd</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /etc/docker</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">      "registry-mirrors": ["https://dx5z2hy7.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">      "exec-opts": ["native.cgroupdriver=systemd"]</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">EOF</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable docker &amp;&amp; systemctl start docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.Docker</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker --version</span></span>
<span class="line"><span style="color:#a6accd">Docker version 18.09.9, build 039a7df9ba</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="kubadmkubelet" tabindex="-1">kubadmkubelet <a class="header-anchor" href="#kubadmkubelet" aria-hidden="true">#</a></h3><p>KubernetesDockerkubeadmkubeletkubeadmkubeletKubernetes</p><p><strong>1.kubernetes YUM</strong></p><p>yum</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#a6accd">[kubernetes]</span></span>
<span class="line"><span style="color:#a6accd">name=Kubernetes</span></span>
<span class="line"><span style="color:#a6accd">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">repo_gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>gpgkeyURL</p></blockquote><p><strong>2.</strong></p><p>1.16.2</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y kubelet-1.16.2 kubeadm-1.16.2 kubectl-1.16.2 ipvsadm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.kubelet</strong></p><p>KubeletSwapKubelet</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/kubelet</span></span>
<span class="line"><span style="color:#a6accd">KUBELET_CGROUP_ARGS="--cgroup-driver=systemd"</span></span>
<span class="line"><span style="color:#a6accd">KUBELET_EXTRA_ARGS="--fail-swap-on=false"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>SWAP</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# swapoff -a</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="color:#a6accd">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="color:#a6accd">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="color:#a6accd">net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="color:#a6accd">EOF</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# sysctl --system</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.kubelet</strong></p><p>kubelet/var/log/messages</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable kubelet &amp;&amp; systemctl start kubelet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.IPVS</strong></p><p>KubernetesKube-Proxyiptablesipvsipvs</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#a6accd">#!/bin/bash</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs_rr</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs_wrr</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs_sh</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chmod +x /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">ip_vs_sh               12688  0 </span></span>
<span class="line"><span style="color:#a6accd">ip_vs_wrr              12697  0 </span></span>
<span class="line"><span style="color:#a6accd">ip_vs_rr               12600  0 </span></span>
<span class="line"><span style="color:#a6accd">ip_vs                 145497  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr</span></span>
<span class="line"><span style="color:#a6accd">nf_conntrack_ipv4      15053  15 </span></span>
<span class="line"><span style="color:#a6accd">nf_defrag_ipv4         12729  1 nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">nf_conntrack          133095  7 ip_vs,nf_nat,nf_nat_ipv4,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_netlink,nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">libcrc32c              12644  4 xfs,ip_vs,nf_nat,nf_conntrack</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Kuberneteslinux-node1linux-node2linux-node3DockerkubeadmkubeletSaltStacksalt-kubeadm<a href="https://github.com/unixhot/salt-kubeadm" target="_blank" rel="noreferrer">https://github.com/unixhot/salt-kubeadm</a></li></ul><h3 id="master" tabindex="-1">Master <a class="header-anchor" href="#master" aria-hidden="true">#</a></h3><p>linux-node1Master</p><p><strong>1.</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm config print init-defaults &gt; kubeadm.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>kubeadm</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat kubeadm.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span style="color:#a6accd">bootstrapTokens:</span></span>
<span class="line"><span style="color:#a6accd">- groups:</span></span>
<span class="line"><span style="color:#a6accd">  - system:bootstrappers:kubeadm:default-node-token</span></span>
<span class="line"><span style="color:#a6accd">  token: abcdef.0123456789abcdef</span></span>
<span class="line"><span style="color:#a6accd">  ttl: 24h0m0s</span></span>
<span class="line"><span style="color:#a6accd">  usages:</span></span>
<span class="line"><span style="color:#a6accd">  - signing</span></span>
<span class="line"><span style="color:#a6accd">  - authentication</span></span>
<span class="line"><span style="color:#a6accd">kind: InitConfiguration</span></span>
<span class="line"><span style="color:#a6accd">localAPIEndpoint:</span></span>
<span class="line"><span style="color:#a6accd">  advertiseAddress: 192.168.56.11  #API Server</span></span>
<span class="line"><span style="color:#a6accd">  bindPort: 6443</span></span>
<span class="line"><span style="color:#a6accd">nodeRegistration:</span></span>
<span class="line"><span style="color:#a6accd">  criSocket: /var/run/dockershim.sock</span></span>
<span class="line"><span style="color:#a6accd">  name: linux-node1.example.com</span></span>
<span class="line"><span style="color:#a6accd">  taints:</span></span>
<span class="line"><span style="color:#a6accd">  - effect: NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">    key: node-role.kubernetes.io/master</span></span>
<span class="line"><span style="color:#a6accd">---</span></span>
<span class="line"><span style="color:#a6accd">apiServer:</span></span>
<span class="line"><span style="color:#a6accd">  timeoutForControlPlane: 4m0s</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span style="color:#a6accd">certificatesDir: /etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#a6accd">clusterName: kubernetes</span></span>
<span class="line"><span style="color:#a6accd">controllerManager: {}</span></span>
<span class="line"><span style="color:#a6accd">dns:</span></span>
<span class="line"><span style="color:#a6accd">  type: CoreDNS</span></span>
<span class="line"><span style="color:#a6accd">etcd:</span></span>
<span class="line"><span style="color:#a6accd">  local:</span></span>
<span class="line"><span style="color:#a6accd">    dataDir: /var/lib/etcd</span></span>
<span class="line"><span style="color:#a6accd">imageRepository: registry.aliyuncs.com/google_containers  #</span></span>
<span class="line"><span style="color:#a6accd">kind: ClusterConfiguration</span></span>
<span class="line"><span style="color:#a6accd">kubernetesVersion: v1.16.2  #</span></span>
<span class="line"><span style="color:#a6accd">networking:</span></span>
<span class="line"><span style="color:#a6accd">  dnsDomain: cluster.local</span></span>
<span class="line"><span style="color:#a6accd">  serviceSubnet: 10.1.0.0/16   #Service</span></span>
<span class="line"><span style="color:#a6accd">  podSubnet: 10.2.0.0/16      #Pod</span></span>
<span class="line"><span style="color:#a6accd">scheduler: {}</span></span>
<span class="line"><span style="color:#a6accd">---   #KubeproxyLVS</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span></span>
<span class="line"><span style="color:#a6accd">kind: KubeProxyConfiguration</span></span>
<span class="line"><span style="color:#a6accd">mode: ipvs</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2. </strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm init --config kubeadm.yaml</span></span>
<span class="line"><span style="color:#a6accd">[init] Using Kubernetes version: v1.16.2</span></span>
<span class="line"><span style="color:#a6accd">[preflight] Running pre-flight checks</span></span>
<span class="line"><span style="color:#a6accd">error execution phase preflight: [preflight] Some fatal errors occurred:</span></span>
<span class="line"><span style="color:#a6accd">        [ERROR NumCPU]: the number of available CPUs 1 is less than the required 2</span></span>
<span class="line"><span style="color:#a6accd">        [ERROR Swap]: running with swap on is not supported. Please disable swa</span></span>
<span class="line"><span style="color:#a6accd">[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`</span></span>
<span class="line"><span style="color:#a6accd">To see the stack trace of this error execute with --v=5 or higher</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>CPU2--ignore-preflight-errors= --ignore-preflight-errors=[ERROR NumCPU][ERROR Swap]--ignore-preflight-errors=NumCPU --ignore-preflight-errors=Swap</p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm init --config kubeadm.yaml \</span></span>
<span class="line"><span style="color:#a6accd">  --ignore-preflight-errors=Swap,NumCPU </span></span>
<span class="line"><span style="color:#a6accd">[init] Using Kubernetes version: v1.16.2</span></span>
<span class="line"><span style="color:#a6accd">[preflight] Running pre-flight checks</span></span>
<span class="line"><span style="color:#a6accd">        [WARNING NumCPU]: the number of available CPUs 1 is less than the required 2</span></span>
<span class="line"><span style="color:#a6accd">        [WARNING Swap]: running with swap on is not supported. Please disable swap</span></span>
<span class="line"><span style="color:#a6accd">[preflight] Pulling images required for setting up a Kubernetes cluster</span></span>
<span class="line"><span style="color:#a6accd">[preflight] This might take a minute or two, depending on the speed of your internet connection</span></span>
<span class="line"><span style="color:#a6accd">[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>KubernetesDocker1-5docker images</p><p>15[]</p><ol><li>[init]</li><li>[preflight] Docker</li><li>[kubelet-start]kubelet/var/lib/kubelet/config.yamlkubeletkubelet</li><li>[certificates]Kubernetes/etc/kubernetes/pki</li><li>[kubeconfig]  KubeConfig/etc/kubernetes</li><li>[control-plane]/etc/kubernetes/manifestYAML Master</li><li>[etcd]/etc/kubernetes/manifest/etcd.yamlEtcd</li><li>[wait-control-plane]control-planMaster</li><li>[apiclient]Master</li><li>[uploadconfig]</li><li>[kubelet]configMapkubelet</li><li>[patchnode]CNINode</li><li>[mark-control-plane]MasterMasterPod</li><li>[bootstrap-token]tokenkubeadm join</li><li>[addons]CoreDNSkube-proxy</li></ol><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">Your Kubernetes master has initialized successfully!</span></span>
<span class="line"><span style="color:#a6accd">To start using your cluster, you need to run the following as a regular user:</span></span>
<span class="line"><span style="color:#a6accd">mkdir -p $HOME/.kube</span></span>
<span class="line"><span style="color:#a6accd">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd">You should now deploy a pod network to the cluster.</span></span>
<span class="line"><span style="color:#a6accd">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span></span>
<span class="line"><span style="color:#a6accd">https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"><span style="color:#a6accd">You can now join any number of machines by running the following on each node</span></span>
<span class="line"><span style="color:#a6accd">as root:</span></span>
<span class="line"><span style="color:#a6accd">kubeadm join 192.168.56.11:6443 --token 19fhhl.3mzkyk16tcgp6vga --discovery-token-ca-cert-hash sha256:76a88c38b673d3b2ac73e33127a809688cb3e58c533512ac6d92ecb66aa57a45</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><ul><li></li><li>SELinuxiptables</li><li>free -m</li><li>IPVS</li><li></li><li>Docker</li><li>Kubelet</li><li>kubeadm</li><li>systemctl status kubeletkubelet</li><li>kubelet</li><li></li><li>kubeadm reset </li><li>kubeadm reset iptablesLVS</li></ul><p>kubectl</p><p><strong>3.kubectlKubeconfig</strong></p><p>kubectl.kubeconfig[kubeconfig]admin.conf.kube/config</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p $HOME/.kube</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chown $(id -u):$(id -g) $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>API ServerkubectlAPI Server</p><p><strong>4.kubectl</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get cs</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS MESSAGE ERROR</span></span>
<span class="line"><span style="color:#a6accd">scheduler Healthy ok</span></span>
<span class="line"><span style="color:#a6accd">controller-manager Healthy ok</span></span>
<span class="line"><span style="color:#a6accd">etcd-0 Healthy {"health": "true"}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>**API Server</p><p>API ServerKubernetesKubernetesAPIServerkubectlAPI ServerkubectlAPI Server</p><p><strong>5.kubectlNode</strong></p><p>MasterNotReady</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get node</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.unixhot.com NotReady master 14m v1.16.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p>MasterNotReadyNodeMasterKubernetesFlannelCalicoCanalCanalFlannel KuberneteskubectlYAML</p><p>canal</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl apply -f https://docs.projectcalico.org/v3.3/getting-started/kubernetes/installation/hosted/canal/rbac.yaml</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl apply -f https://docs.projectcalico.org/v3.3/getting-started/kubernetes/installation/hosted/canal/canal.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Flannel FlannelPodIPFlannelYAML</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# git clone --depth 1 https://github.com/coreos/flannel.git</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd flannel/Documentation/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 Documentation]# vim kube-flannel.yml</span></span>
<span class="line"><span style="color:#a6accd"># "Network": "10.244.0.0/16""Network": "10.2.0.0/16",</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">74   net-conf.json: |</span></span>
<span class="line"><span style="color:#a6accd">75     {</span></span>
<span class="line"><span style="color:#a6accd">76       "Network": "10.2.0.0/16",</span></span>
<span class="line"><span style="color:#a6accd">77       "Backend": {</span></span>
<span class="line"><span style="color:#a6accd">78         "Type": "vxlan"</span></span>
<span class="line"><span style="color:#a6accd">79       }</span></span>
<span class="line"><span style="color:#a6accd">80     }</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># Flannel</span></span>
<span class="line"><span style="color:#a6accd"># image: quay.io/coreos/flannel:v0.10.0-amd64</span></span>
<span class="line"><span style="color:#a6accd">image: quay-mirror.qiniu.com/coreos/flannel:v0.11.0-amd64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># Node--iface</span></span>
<span class="line"><span style="color:#a6accd">containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: kube-flannel</span></span>
<span class="line"><span style="color:#a6accd">        image: quay-mirror.qiniu.com/coreos/flannel:v0.11.0-amd64</span></span>
<span class="line"><span style="color:#a6accd">        command:</span></span>
<span class="line"><span style="color:#a6accd">        - /opt/bin/flanneld</span></span>
<span class="line"><span style="color:#a6accd">        args:</span></span>
<span class="line"><span style="color:#a6accd">        - --ip-masq</span></span>
<span class="line"><span style="color:#a6accd">        - --kube-subnet-mgr</span></span>
<span class="line"><span style="color:#a6accd">        - --iface=eth0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Flannel</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 Documentation]# kubectl create -f kube-flannel.yml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 Documentation]# kubectl get pod -n kube-system</span></span>
<span class="line"><span style="color:#a6accd">NAME                                              READY   STATUS     RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">coredns-58cc8c89f4-cjhdv                          0/1     Pending    0          41m</span></span>
<span class="line"><span style="color:#a6accd">coredns-58cc8c89f4-vdfn2                          0/1     Pending    0          41m</span></span>
<span class="line"><span style="color:#a6accd">etcd-linux-node1.unixhot.com                      1/1     Running    0          41m</span></span>
<span class="line"><span style="color:#a6accd">kube-apiserver-linux-node1.unixhot.com            1/1     Running    0          40m</span></span>
<span class="line"><span style="color:#a6accd">kube-controller-manager-linux-node1.unixhot.com   1/1     Running    1          40m</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-bwsxl                       0/1     Init:0/1   0          20s</span></span>
<span class="line"><span style="color:#a6accd">kube-proxy-5qrmh                                  1/1     Running    0          41m</span></span>
<span class="line"><span style="color:#a6accd">kube-scheduler-linux-node1.unixhot.com            1/1     Running    1          41m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>CoreDNSPendingcanalFlannelPodRunningCoreDNSPodRunningNodeReady</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get node</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.unixhot.com Ready master 29m v1.16.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><em>kubeadmKubernetesKubernetesDockerkubeletkubeadmkubeletPodKubernetesPod</em></p><h3 id="node" tabindex="-1">Node <a class="header-anchor" href="#node" aria-hidden="true">#</a></h3><p>MasterNodeDockerkubeadmNodedockerkubeadmkubelet</p><p><strong>1.Master</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm token create --print-join-command</span></span>
<span class="line"><span style="color:#a6accd">kubeadm join 192.168.56.11:6443 --token isggqa.xjwsm3i6nex91d2x --discovery-token-ca-cert-hash sha256:718827895a9a5e63dfa9ff54e16ad6dc0c493139c9c573b67ad66968036cd569</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.Node</strong></p><p>--ignore-preflight-errors=Swap</p><p>linux-node2</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# kubeadm join 192.168.56.11:6443 --token isggqa.xjwsm3i6nex91d2x --discovery-token-ca-cert-hash sha256:718827895a9a5e63dfa9ff54e16ad6dc0c493139c9c573b67ad66968036cd569 --ignore-preflight-errors=Swap</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>linux-node3</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node3 ~]# kubeadm join 192.168.56.11:6443 --tokenisggqa.xjwsm3i6nex91d2x --discovery-token-ca-cert-hash sha256:718827895a9a5e63dfa9ff54e16ad6dc0c493139c9c573b67ad66968036cd569 --ignore-preflight-errors=Swap</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>kubernetesDaemonSetcanal/flannelkube-proxyDaemonSet</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">    [root@linux-node1 ~]# kubectl get daemonset --all-namespaces</span></span>
<span class="line"><span style="color:#a6accd">    NAMESPACE NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE</span></span>
<span class="line"><span style="color:#a6accd">    kube-system canal 2 2 1 2 1 beta.kubernetes.io/os=linux 17m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-proxy 2 2 2 2 2 &lt;none&gt; 47m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PodReady</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">    [root@linux-node1 ~]# kubectl get pod --all-namespaces</span></span>
<span class="line"><span style="color:#a6accd">    NAMESPACE NAME READY STATUS RESTARTS AGE</span></span>
<span class="line"><span style="color:#a6accd">    kube-system canal-lv92w 3/3 Running 0 8m45s</span></span>
<span class="line"><span style="color:#a6accd">    kube-system canal-rq5n5 3/3 Running 0 23m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system coredns-78d4cf999f-5k4sg 1/1 Running 0 53m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system coredns-78d4cf999f-bnbgf 1/1 Running 0 53m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system etcd-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-apiserver-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-controller-manager-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-proxy-sddlp 1/1 Running 0 53m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-proxy-tw96b 1/1 Running 0 8m45s</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-scheduler-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong> `` [root@linux-node1 ~]# kubectl get node NAME STATUS ROLES AGE VERSION <a href="http://linux-node1.linuxhot.com" target="_blank" rel="noreferrer">linux-node1.linuxhot.com</a> Ready master 49m v1.13.2 <a href="http://linux-node2.linuxhot.com" target="_blank" rel="noreferrer">linux-node2.linuxhot.com</a> Ready 4m48s v1.13.2</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">**NodeRoles**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">kubectl get nodelinux-node1.linuxhot.comROLESmaster[mark-control-plane]</span></span>
<span class="line"><span style="color:#a6accd">[mark-control-plane] Marking the node linux-node1.linuxhot.com as control-plane</span></span>
<span class="line"><span style="color:#a6accd">by adding the label "node-role.kubernetes.io/master=''"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[mark-control-plane] Marking the node linux-node1.linuxhot.com as control-plane</span></span>
<span class="line"><span style="color:#a6accd">by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span></span>
<span class="line"><span style="color:#a6accd">1.</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get nodes --show-labels</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION LABELS</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">linux-node1.linuxhot.com Ready master 48m v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=linux-node1.linuxhot.com,node-role.kubernetes.io/master=</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">linux-node2.linuxhot.com Ready &lt;none&gt; 7m13s v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">2.</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl label nodes linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">node-role.kubernetes.io/node=</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">node/linux-node2.linuxhot.com labeled</span></span>
<span class="line"><span style="color:#a6accd">3.</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get nodes</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.linuxhot.com Ready master 50m v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">linux-node2.linuxhot.com Ready node 8m41s v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">### Kubernetes {#test}</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Kubernetes1Master2NodeMaster</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**1.PodNginx**</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create deployment nginx --image=nginx:alpine</span></span>
<span class="line"><span style="color:#a6accd">deployment.apps/nginx created</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE</span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-9j7ql 0/1 ContainerCreating 0 10s</span></span>
<span class="line"><span style="color:#a6accd">**2.Pod**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">PodRunningPodIPIPMaster--pod-network-cidr=10.2.0.0/16</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-9j7ql 1/1 Running 0 59s 10.2.1.2 linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">&lt;none&gt; &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">**3.Nginx**</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head http://10.2.1.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.15.8</span></span>
<span class="line"><span style="color:#a6accd">Date: Sun, 13 Jan 2019 01:16:36 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Wed, 26 Dec 2018 23:21:49 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "5c240d0d-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd">**4.**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NginxPod2</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl scale deployment nginx --replicas=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">deployment.extensions/nginx scaled</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-9j7ql 1/1 Running 0 2m13s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-vnm4f 1/1 Running 0 5s</span></span>
<span class="line"><span style="color:#a6accd">**5.NginxService**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NginxServiceCluster</span></span>
<span class="line"><span style="color:#a6accd">IPMaster--service-cidr=10.1.0.0/16</span></span>
<span class="line"><span style="color:#a6accd">NodePortNode</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl expose deployment nginx --port=80</span></span>
<span class="line"><span style="color:#a6accd">--type=NodePort</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">service/nginx exposed</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span></span>
<span class="line"><span style="color:#a6accd">kubernetes ClusterIP 10.1.0.1 &lt;none&gt; 443/TCP 88m</span></span>
<span class="line"><span style="color:#a6accd">nginx NodePort 10.1.147.204 &lt;none&gt; 80:30599/TCP 67m</span></span>
<span class="line"><span style="color:#a6accd">**6.ServiceVIP**</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head http://10.1.147.204/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK </span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.15.8</span></span>
<span class="line"><span style="color:#a6accd">Date: Sun, 13 Jan 2019 01:26:21 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Wed, 26 Dec 2018 23:21:49 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "5c240d0d-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>``` <strong>7.NodePort</strong></p><p><img src="http://k8s.unixhot.com/kubernetes/media/1f9d523f359ce6d49515d04703d8e941.png" alt="img"></p><p>KubernetesKubernetes</p><h2 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h2><p>20192KubernetesKubernetesKubernetes</p><h3 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h3><p> Kubernetes  ACK Kubernetes  Kubernetes  Kubernetes </p><p><strong>Kubernetes</strong></p><p>KubernetesDedicated KubernetesServerless</p><ul><li>Dedicated KubernetesKubernetes  Kubernetes  Kubernetes </li><li>Serverless  Kubernetes CPU </li></ul><p><strong>Kubernetes</strong></p><p><img src="http://k8s.unixhot.com/kubernetes/media/43688d33a81f2bd6af354d0715b6b297.png" alt="C:UsersjasonDesktop15447553537457_zh-CN.png"></p><p><strong>Kubernetes</strong></p><p>5 40 </p><p><img src="http://k8s.unixhot.com/kubernetes/media/4c165d0ebc842862595f9fd0f4650d43.png" alt="img"></p><p>KubernetesTerwayFlannel</p><ul><li>FlannelFlannel CNIVPCKubernetesNetwork Policy</li><li>TerwayFlannelKubernetesNetworkPolicyNetwork PolicyFlannelTerwayTerwayTerway</li></ul><p>kubeadmKubernetes</p><h3 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h3><p><strong>Kubernetes</strong></p><p>KubernetesKubernetes</p><ol><li>YUM</li><li>Docker RegistryHarbor</li><li>HarborHarborCOPY</li></ol><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim k8s-images.sh</span></span>
<span class="line"><span style="color:#a6accd">#!/bin/bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># EVN</span></span>
<span class="line"><span style="color:#a6accd">ALIYUN_REG="registry.aliyuncs.com/google_containers"</span></span>
<span class="line"><span style="color:#a6accd">FLANNEL_REG="quay-mirror.qiniu.com/coreos"</span></span>
<span class="line"><span style="color:#a6accd">LOCAL_REG="192.168.56.11/kubernetes"</span></span>
<span class="line"><span style="color:#a6accd">K8S_VER=v1.15.5</span></span>
<span class="line"><span style="color:#a6accd">PAUSE_VER=3.1</span></span>
<span class="line"><span style="color:#a6accd">ETCD_VER=3.3.10</span></span>
<span class="line"><span style="color:#a6accd">COREDNS_VER=1.3.1</span></span>
<span class="line"><span style="color:#a6accd">FLANNEL_VER=v0.11.0-amd64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># Kubernetes Docker Images</span></span>
<span class="line"><span style="color:#a6accd">IMAGES=(</span></span>
<span class="line"><span style="color:#a6accd">  kube-proxy:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  kube-scheduler:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  kube-controller-manager:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  kube-apiserver:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  pause:${PAUSE_VER}</span></span>
<span class="line"><span style="color:#a6accd">  etcd-amd64:${ETCD_VER}</span></span>
<span class="line"><span style="color:#a6accd">  coredns:${COREDNS_VER}</span></span>
<span class="line"><span style="color:#a6accd">)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">for IMAGE in ${IMAGES[@]}</span></span>
<span class="line"><span style="color:#a6accd">do</span></span>
<span class="line"><span style="color:#a6accd">  docker pull ${ALIYUN_REG}/${IMAGE}</span></span>
<span class="line"><span style="color:#a6accd">  docker tag ${ALIYUN_REG}/${IMAGE} ${LOCAL_REG}/${IMAGE}</span></span>
<span class="line"><span style="color:#a6accd">  #docker push ${LOCAL_REG}/${IMAGES}</span></span>
<span class="line"><span style="color:#a6accd">done</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># Flannel</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">docker pull ${FLANNEL_REG}/flannel:${FLANNEL_VER}</span></span>
<span class="line"><span style="color:#a6accd">docker tag ${FLANNEL_REG}/flannel:${FLANNEL_VER} ${LOCAL_REG}/flannel:${FLANNEL_VER}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="-kubernetes" tabindex="-1"> Kubernetes <a class="header-anchor" href="#-kubernetes" aria-hidden="true">#</a></h1><h1 id="_6-" tabindex="-1">6  <a class="header-anchor" href="#_6-" aria-hidden="true">#</a></h1><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p>Nginx</p><h3 id="harbor" tabindex="-1">Harbor <a class="header-anchor" href="#harbor" aria-hidden="true">#</a></h3><p>HarborDockerHarborHarbordevopsedu</p><p><img src="http://k8s.unixhot.com/kubernetes/media/093b4b731c05b54a1b8426e924f93d45.png" alt="img"></p><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h3><p>Docker</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root\@linux-node1 ~]# vim /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">    "registry-mirrors": ["https://tdimi5q1.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">    "insecure-registries" : ["http://192.168.56.11"]</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="harbor" tabindex="-1">Harbor <a class="header-anchor" href="#harbor" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker login 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">Username: admin</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span>
<span class="line"><span style="color:#a6accd">    Configure a credential helper to remove this warning. See</span></span>
<span class="line"><span style="color:#a6accd">    https://docs.docker.com/engine/reference/commandline/login/\#credentials-store</span></span>
<span class="line"><span style="color:#a6accd">    Login Succeeded</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="registry" tabindex="-1">Registry <a class="header-anchor" href="#registry" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker tag nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11/devopsedu/nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker tag nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11/devopsedu/nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker push 192.168.56.11/devopsedu/nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker push 192.168.56.11/devopsedu/nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3</p><h1 id="_7-pod" tabindex="-1">7 Pod <a class="header-anchor" href="#_7-pod" aria-hidden="true">#</a></h1><p>PodKubernetesPodPodPodPodIP</p><p><strong>Pod</strong> KubernetesPodMesosKubernetesPodPodPod KubernetesPod</p><ul><li>PodKubernetesPodKubernetesPod</li><li>PodNginx+TomcatJavaNginx+TomcatNginxTomcatKubernetesPodNginxTomcatPodPod</li></ul><h2 id="pod" tabindex="-1">Pod <a class="header-anchor" href="#pod" aria-hidden="true">#</a></h2><p>KubernetesYAMLPod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nginx-pod.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Pod</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-pod</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  containers:</span></span>
<span class="line"><span style="color:#a6accd">  - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">    image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">    ports:</span></span>
<span class="line"><span style="color:#a6accd">- containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PodYAMLkubeadmKubernetesPodYAML</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ls -l /etc/kubernetes/manifests/</span></span>
<span class="line"><span style="color:#a6accd">total 16</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 2041 Feb 11 20:33 etcd.yaml</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 2700 Feb 11 20:33 kube-apiserver.yaml</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 2345 Feb 11 20:33 kube-controller-manager.yaml</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 1080 Feb 11 20:33 kube-scheduler.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nginx-pod.yaml </span></span>
<span class="line"><span style="color:#a6accd">pod "nginx-pod" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd">NAME                                READY     STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">nginx-pod                           1/1       Running   0          49s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd">NAME                                READY     STATUS    RESTARTS   AGE       IP           NODE</span></span>
<span class="line"><span style="color:#a6accd">nginx-pod  1/1       Running   0          1m        10.2.53.18   192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe pod nginx-pod</span></span>
<span class="line"><span style="color:#a6accd">Name:         nginx-pod</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Node:         192.168.56.13/192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd">Start Time:   Sat, 02 Jun 2018 06:42:53 +0800</span></span>
<span class="line"><span style="color:#a6accd">Labels:       app=nginx</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Status:       Running</span></span>
<span class="line"><span style="color:#a6accd">IP:           10.2.53.18</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl logs pod/nginx-pod</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Pod</strong> kubelet[imagePullPolicy]</p><ul><li>imagePullPolicy: IfNotPresent</li><li>imagePullPolicy: Always pod </li></ul><p>imagePullPolicy:latestAlways imagePullPolicy:latestIfNotPresent imagePullPolicy: Never </p><h1 id="_7-3-controllerspod" tabindex="-1">7.3 ControllersPod <a class="header-anchor" href="#_7-3-controllerspod" aria-hidden="true">#</a></h1><p>PodPodKubernetes Controllers  Pod,  Controller  pod  pod</p><h1 id="_8-1-replication-controller" tabindex="-1">8.1 Replication Controller <a class="header-anchor" href="#_8-1-replication-controller" aria-hidden="true">#</a></h1><h1 id="_8-2-replica-sets" tabindex="-1">8.2 Replica Sets <a class="header-anchor" href="#_8-2-replica-sets" aria-hidden="true">#</a></h1><h1 id="_8-3-deployment" tabindex="-1">8.3 Deployment <a class="header-anchor" href="#_8-3-deployment" aria-hidden="true">#</a></h1><h1 id="_8-4-daemonset" tabindex="-1">8.4 DaemonSet <a class="header-anchor" href="#_8-4-daemonset" aria-hidden="true">#</a></h1><p>DaemonSet Node  Pod  Node  Pod  Node  Pod  DaemonSet  Pod  DaemonSet </p><ul><li> daemon Node  glusterdceph</li><li> Node  daemonfilebeatlogstash</li><li> Node  daemon Prometheus Node ExportercollectdDatadog Zabbix Agent</li></ul><p><strong>DaemonSet</strong></p><p>DaemonSetDeploymentKind</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 example]# vim nginx-daemonset.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: DaemonSet</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-daemonset</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    matchLabels:</span></span>
<span class="line"><span style="color:#a6accd">      app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  template:</span></span>
<span class="line"><span style="color:#a6accd">    metadata:</span></span>
<span class="line"><span style="color:#a6accd">      labels:</span></span>
<span class="line"><span style="color:#a6accd">        app: nginx</span></span>
<span class="line"><span style="color:#a6accd">    spec:</span></span>
<span class="line"><span style="color:#a6accd">      containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">        image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">        ports:</span></span>
<span class="line"><span style="color:#a6accd">        - containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PodNode</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd">NAME                    READY     STATUS    RESTARTS   AGE       IP           NODE</span></span>
<span class="line"><span style="color:#a6accd">nginx-daemonset-hk28q   1/1       Running   0          1m        10.2.56.10   192.168.56.12</span></span>
<span class="line"><span style="color:#a6accd">nginx-daemonset-wtt68   1/1       Running   0          1m        10.2.53.10   192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get daemonset</span></span>
<span class="line"><span style="color:#a6accd">NAME              DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span></span>
<span class="line"><span style="color:#a6accd">nginx-daemonset   2         2         2         2            2           &lt;none&gt;          1m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_7-4-servicepod" tabindex="-1">7.4 ServicePod <a class="header-anchor" href="#_7-4-servicepod" aria-hidden="true">#</a></h1><p>DeploymentPodPodKubernetes Pod PodIPPodPodIP  Pod  IP  IP   Kubernetes  Pod backend Pod  frontend frontend  Pod  backend </p><h1 id="_9-1-service" tabindex="-1">9.1 Service <a class="header-anchor" href="#_9-1-service" aria-hidden="true">#</a></h1><h3 id="service" tabindex="-1">Service <a class="header-anchor" href="#service" aria-hidden="true">#</a></h3><p>NginxService</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat nginx-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">kind: Service</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-service</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  ports:</span></span>
<span class="line"><span style="color:#a6accd">  - protocol: TCP</span></span>
<span class="line"><span style="color:#a6accd">    port: 80</span></span>
<span class="line"><span style="color:#a6accd">    targetPort: 80</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>1Service</li><li>2Service API</li><li>3metadata</li><li>4Servicenginx-service</li><li>5spec: Service</li><li>6selector: Service</li><li>7app: nginx app nginxPodService</li><li>8ports: Service</li><li>9TCPUDP</li><li>10Service</li><li>11PodKubernetesServicePod</li></ul><p>Nginx Service</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nginx-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">service "nginx-service" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Nginx Service</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd">NAME            TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span></span>
<span class="line"><span style="color:#a6accd">kubernetes      ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP   7h</span></span>
<span class="line"><span style="color:#a6accd">nginx-service   ClusterIP   10.1.184.53   &lt;none&gt;        80/TCP    25s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Servce IP</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head 10.1.181.45</span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.11.10</span></span>
<span class="line"><span style="color:#a6accd">Date: Tue, 21 Feb 2017 08:20:42 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Tue, 14 Feb 2017 15:36:04 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "58a323e4-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_9-2-serviceendpoint" tabindex="-1">9.2 ServiceEndpoint <a class="header-anchor" href="#_9-2-serviceendpoint" aria-hidden="true">#</a></h1><p>ServiceKubernetesPodServicePodPodIPServiceEndpoint EndpointsServicePodEndpoints ControllerEndpointsServicePod</p><ul><li>ServiceServiceEndpoints</li><li>ServiceServicePodServiceEndpoints</li><li>PodServiceEndpoints</li></ul><p>kube-proxyServiceEndpointsService</p><h3 id="headless-service" tabindex="-1">Headless Service <a class="header-anchor" href="#headless-service" aria-hidden="true">#</a></h3><p>Serviceclusterip</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat mysql-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">kind: Service</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: mysql-service</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  ports:</span></span>
<span class="line"><span style="color:#a6accd">  - protocol: TCP</span></span>
<span class="line"><span style="color:#a6accd">    port: 3306</span></span>
<span class="line"><span style="color:#a6accd">    targetPort: 3306</span></span>
<span class="line"><span style="color:#a6accd">  clusterIP: None</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f mysql-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">service "mysql-service" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ServiceCLUSTER-IPNone</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service mysql-service</span></span>
<span class="line"><span style="color:#a6accd">NAME            TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span></span>
<span class="line"><span style="color:#a6accd">mysql-service   ClusterIP   None         &lt;none&gt;        3306/TCP   17s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.Endpoint</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim mysql-endpoint.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Endpoints</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd"> name: mysql-service</span></span>
<span class="line"><span style="color:#a6accd">subsets:</span></span>
<span class="line"><span style="color:#a6accd">- addresses:</span></span>
<span class="line"><span style="color:#a6accd">  - ip: 192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd">  ports:</span></span>
<span class="line"><span style="color:#a6accd">  - port: 3306</span></span>
<span class="line"><span style="color:#a6accd">    protocol: TCP</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f mysql-endpoint.yaml </span></span>
<span class="line"><span style="color:#a6accd">endpoints "mysql-service" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.ServiceEndpoint</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get ep mysql-service</span></span>
<span class="line"><span style="color:#a6accd">NAME            ENDPOINTS            AGE</span></span>
<span class="line"><span style="color:#a6accd">mysql-service   192.168.56.13:3306   42s</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe svc mysql-service</span></span>
<span class="line"><span style="color:#a6accd">Name:              mysql-service</span></span>
<span class="line"><span style="color:#a6accd">Namespace:         default</span></span>
<span class="line"><span style="color:#a6accd">Labels:            &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Selector:          &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Type:              ClusterIP</span></span>
<span class="line"><span style="color:#a6accd">IP:                None</span></span>
<span class="line"><span style="color:#a6accd">Port:              &lt;unset&gt;  3306/TCP</span></span>
<span class="line"><span style="color:#a6accd">TargetPort:        3306/TCP</span></span>
<span class="line"><span style="color:#a6accd">Endpoints:         192.168.56.13:3306</span></span>
<span class="line"><span style="color:#a6accd">Session Affinity:  None</span></span>
<span class="line"><span style="color:#a6accd">Events:            &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_7-5-ingress" tabindex="-1">7.5 Ingress <a class="header-anchor" href="#_7-5-ingress" aria-hidden="true">#</a></h1><p>ServiceKubernetesIPPort4OSI</p><p>NginxURLNginxNginxKubernetesIngress IngresskubernetesURLserviceingressnginxURL</p><h2 id="_10-1-ingress-controller" tabindex="-1">10.1 Ingress Controller <a class="header-anchor" href="#_10-1-ingress-controller" aria-hidden="true">#</a></h2><p>Servicekube-proxyLVSIngress7Ingress Controller</p><p>Ingress Controller Ingress Controller  kubernetes API  servicepod  podservice Ingress Controller  Ingress </p><p>Ingress ControllerNginx ControllerTraefikTraefikDocker, Swarm, Mesos/Marathon, Mesos, Kubernetes, Consul, Etcd, Zookeeper, BoltDB, Rest API</p><h2 id="ingress-controller-traefik" tabindex="-1">Ingress Controller Traefik <a class="header-anchor" href="#ingress-controller-traefik" aria-hidden="true">#</a></h2><h3 id="treafik" tabindex="-1">Treafik <a class="header-anchor" href="#treafik" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl label nodes 192.168.56.12 edgenode=true</span></span>
<span class="line"><span style="color:#a6accd">node "192.168.56.12" labeled</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f /srv/addons/ingress/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_11-pvpvc" tabindex="-1">11 PVPVC <a class="header-anchor" href="#_11-pvpvc" aria-hidden="true">#</a></h1><p>PodPodPod KubernetesVolumePersistentVolumePVPersistentVolumeClaim PVCStorageClassKubernetes</p><h1 id="_11-1-kubernetes-volume" tabindex="-1">11.1 Kubernetes Volume <a class="header-anchor" href="#_11-1-kubernetes-volume" aria-hidden="true">#</a></h1><h1 id="_11-2-persistentvolumepv" tabindex="-1">11.2 PersistentVolumePV <a class="header-anchor" href="#_11-2-persistentvolumepv" aria-hidden="true">#</a></h1><p>PersistentVolumePVPV  PV  Volume  PV  Pod  API  NFSiSCSI </p><p><strong>1.NFS</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y nfs-utils rpcbind</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p /data/k8s-nfs</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/exports</span></span>
<span class="line"><span style="color:#a6accd">/data/k8s-nfs *(rw,sync,no_root_squash)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>NFS</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable rpcbind nfs</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start rpcbind nfs</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.PV</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nfs-pv.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: PersistentVolume</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: pv-demo</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  capacity:</span></span>
<span class="line"><span style="color:#a6accd">storage: 1Gi</span></span>
<span class="line"><span style="color:#a6accd">  volumeMode: Filesystem</span></span>
<span class="line"><span style="color:#a6accd">  accessModes:</span></span>
<span class="line"><span style="color:#a6accd">    - ReadWriteOnce</span></span>
<span class="line"><span style="color:#a6accd">  persistentVolumeReclaimPolicy: Recycle</span></span>
<span class="line"><span style="color:#a6accd">  storageClassName: nfs</span></span>
<span class="line"><span style="color:#a6accd">  nfs:</span></span>
<span class="line"><span style="color:#a6accd">    path: /data/k8s-nfs/pv-demo</span></span>
<span class="line"><span style="color:#a6accd">    server: 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nfs-pv.yaml </span></span>
<span class="line"><span style="color:#a6accd">persistentvolume "pv-demo" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PV</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pv</span></span>
<span class="line"><span style="color:#a6accd">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM     STORAGECLASS   REASON    AGE</span></span>
<span class="line"><span style="color:#a6accd">pv-demo   1Gi        RWO            Recycle          Available             nfs                      15s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_11-3-persistentvolumeclaimpvc" tabindex="-1">11.3 PersistentVolumeClaimPVC <a class="header-anchor" href="#_11-3-persistentvolumeclaimpvc" aria-hidden="true">#</a></h1><p>PersistentVolumeClaimPVC Pod Pod PVC  PV Pod CPU / </p><p>1.PVC</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nfs-pvc.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  accessModes:</span></span>
<span class="line"><span style="color:#a6accd">    - ReadWriteOnce</span></span>
<span class="line"><span style="color:#a6accd">  resources:</span></span>
<span class="line"><span style="color:#a6accd">    requests:</span></span>
<span class="line"><span style="color:#a6accd">      storage: 1Gi</span></span>
<span class="line"><span style="color:#a6accd">  storageClassName: nfs</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PVC</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nfs-pvc.yaml </span></span>
<span class="line"><span style="color:#a6accd">persistentvolumeclaim "pvc-demo" created</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pvc</span></span>
<span class="line"><span style="color:#a6accd">NAME       STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span style="color:#a6accd">pvc-demo   Bound     pv-demo   1Gi        RWO            nfs            6s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.PVC</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nginx-deployment-pvc.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Deployment</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-deployment</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  replicas: 3</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    matchLabels:</span></span>
<span class="line"><span style="color:#a6accd">      app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  template:</span></span>
<span class="line"><span style="color:#a6accd">    metadata:</span></span>
<span class="line"><span style="color:#a6accd">      labels:</span></span>
<span class="line"><span style="color:#a6accd">        app: nginx</span></span>
<span class="line"><span style="color:#a6accd">    spec:</span></span>
<span class="line"><span style="color:#a6accd">      containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">        image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">        ports:</span></span>
<span class="line"><span style="color:#a6accd">        - containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd">        volumeMounts:</span></span>
<span class="line"><span style="color:#a6accd">        - mountPath: "/usr/share/nginx/html"</span></span>
<span class="line"><span style="color:#a6accd">          name: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd">      volumes:</span></span>
<span class="line"><span style="color:#a6accd">      - name: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd">        persistentVolumeClaim:</span></span>
<span class="line"><span style="color:#a6accd">          claimName: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_11-4-storageclass" tabindex="-1">11.4 StorageClass <a class="header-anchor" href="#_11-4-storageclass" aria-hidden="true">#</a></h1><h1 id="_7-rancherkubernetes" tabindex="-1">7 RancherKubernetes <a class="header-anchor" href="#_7-rancherkubernetes" aria-hidden="true">#</a></h1><p>KubernetesDashbaordRancher</p><h2 id="_7-1-rancher" tabindex="-1">7.1 Rancher <a class="header-anchor" href="#_7-1-rancher" aria-hidden="true">#</a></h2><p>Rancher</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /opt/rancher</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --restart=unless-stopped -v /opt/rancher:/var/lib/rancher/ -p 80:80 -p 443:443 rancher/rancher</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_7-2-rancher" tabindex="-1">7.2 Rancher <a class="header-anchor" href="#_7-2-rancher" aria-hidden="true">#</a></h2><h2 id="_7-3-rancher" tabindex="-1">7.3 Rancher <a class="header-anchor" href="#_7-3-rancher" aria-hidden="true">#</a></h2><h1 id="-kubernetes" tabindex="-1"> Kubernetes <a class="header-anchor" href="#-kubernetes" aria-hidden="true">#</a></h1><h1 id="_13-" tabindex="-1">13  <a class="header-anchor" href="#_13-" aria-hidden="true">#</a></h1><h1 id="_13-1-" tabindex="-1">13.1  <a class="header-anchor" href="#_13-1-" aria-hidden="true">#</a></h1><h1 id="_13-2-" tabindex="-1">13.2  <a class="header-anchor" href="#_13-2-" aria-hidden="true">#</a></h1><h3 id="liveness" tabindex="-1">Liveness <a class="header-anchor" href="#liveness" aria-hidden="true">#</a></h3><p>KubernetesLivenessReadiness LivenessPodKubernetes LivenessrestartPolicy  Always  OnFailure </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">livenessProbe:</span></span>
<span class="line"><span style="color:#a6accd">exec:</span></span>
<span class="line"><span style="color:#a6accd">    command:</span></span>
<span class="line"><span style="color:#a6accd">    - ps aux | grep nginx</span></span>
<span class="line"><span style="color:#a6accd">initialDelaySeconds: 10</span></span>
<span class="line"><span style="color:#a6accd">periodSeconds: 5</span></span>
<span class="line"><span style="color:#a6accd">timeoutSeconds: 3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="readiness" tabindex="-1">Readiness <a class="header-anchor" href="#readiness" aria-hidden="true">#</a></h3><p>ReadinessPodPodTomcatJenkinsJenkins11ServiceReadiness ReadinessKubernetesServiceLivenesslivennessProbereadinessProbe</p><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p>KubernetesNodekubeletkubelet</p><ul><li>ExecAction0</li><li>TCPSocketAction:IPTCP</li><li>HTTPGetAction:IPHTTP Get200400</li></ul><p></p><ul><li><p>Success</p></li><li><p>Failure</p></li><li><p>Unknown</p><p>LivenessReadiness</p></li><li><p>initialDelaySeconds: Java5050s</p></li><li><p>periodSeconds101</p></li><li><p>timeoutSeconds: 11</p></li><li><p>failureThresholdKubernetesPodPod31</p></li><li><p>successThreshold: 111</p><h1 id="dns" tabindex="-1">DNS <a class="header-anchor" href="#dns" aria-hidden="true">#</a></h1></li></ul><h1 id="_14-1-kubernetesdns" tabindex="-1"><a href="http://k8s.unixhot.com/" target="_blank" rel="noreferrer">14.1 KubernetesDNS</a> <a class="header-anchor" href="#_14-1-kubernetesdns" aria-hidden="true">#</a></h1><h1 id="dns" tabindex="-1">DNS <a class="header-anchor" href="#dns" aria-hidden="true">#</a></h1><h3 id="pod" tabindex="-1">Pod <a class="header-anchor" href="#pod" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl run dns-test --generator=run-pod/v1 --image=alpine --replicas=1 sleep 360000</span></span>
<span class="line"><span style="color:#a6accd">pod/dns-test created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod dns-test</span></span>
<span class="line"><span style="color:#a6accd">NAME       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">dns-test   1/1     Running   0          79s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PodDNS</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl exec -it dns-test /bin/sh</span></span>
<span class="line"><span style="color:#a6accd">/ # cat /etc/resolv.conf </span></span>
<span class="line"><span style="color:#a6accd">nameserver 10.1.0.10</span></span>
<span class="line"><span style="color:#a6accd">search default.svc.cluster.local svc.cluster.local cluster.local</span></span>
<span class="line"><span style="color:#a6accd">options ndots:5</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Service</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">/ # ping -c 3 wordpress-service.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#a6accd">PING wordpress-service.default.svc.cluster.local (10.1.92.244): 56 data bytes</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 10.1.92.244: seq=0 ttl=64 time=0.074 ms</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 10.1.92.244: seq=1 ttl=64 time=0.141 ms</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 10.1.92.244: seq=2 ttl=64 time=0.187 ms</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">--- wordpress-service.default.svc.cluster.local ping statistics ---</span></span>
<span class="line"><span style="color:#a6accd">3 packets transmitted, 3 packets received, 0% packet loss</span></span>
<span class="line"><span style="color:#a6accd">round-trip min/avg/max = 0.074/0.134/0.187 ms</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>DNS</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod dns-test -o yaml | grep dnsPolicy</span></span>
<span class="line"><span style="color:#a6accd">  dnsPolicy: ClusterFirst</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Default: Pod</li><li>ClusterFirst:DNS</li><li>ClusterFirstWithHostNet: PodhostNetworkIngress Controller TreafikhostNetwokDNSClusterFirstWithHostNet</li><li>None: PodKubernetesDNSPod SpecdnsConfigDNS</li></ul><h2 id="dns-1" tabindex="-1">DNS <a class="header-anchor" href="#dns-1" aria-hidden="true">#</a></h2><h2 id="_15-1-configmap" tabindex="-1">15.1 ConfigMap <a class="header-anchor" href="#_15-1-configmap" aria-hidden="true">#</a></h2><h3 id="kubectlconfigmap" tabindex="-1">kubectlConfigMap <a class="header-anchor" href="#kubectlconfigmap" aria-hidden="true">#</a></h3><p><strong>cmd-configConfigMap</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap cmd-config --from-literal=host=www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">configmap/cmd-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ConfigMap</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap</span></span>
<span class="line"><span style="color:#a6accd">NAME         DATA   AGE</span></span>
<span class="line"><span style="color:#a6accd">cmd-config   1      63s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ConfigMap</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe configmap cmd-config</span></span>
<span class="line"><span style="color:#a6accd">Name:         cmd-config</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Labels:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Data</span></span>
<span class="line"><span style="color:#a6accd">====</span></span>
<span class="line"><span style="color:#a6accd">host:</span></span>
<span class="line"><span style="color:#a6accd">----</span></span>
<span class="line"><span style="color:#a6accd">www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">Events:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ConfigMap</strong> --from-literalConfigMap</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap mcmd-config --from-literal=host=www.unixhot.com --from-literal=port=443 --from-literal=ssl=on</span></span>
<span class="line"><span style="color:#a6accd">configmap/mcmd-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="yamlconfigmap" tabindex="-1">YAMLConfigMap <a class="header-anchor" href="#yamlconfigmap" aria-hidden="true">#</a></h3><p>ConfigMapYAML</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap mcmd-config -o yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">data:</span></span>
<span class="line"><span style="color:#a6accd">  host: www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">  port: "443"</span></span>
<span class="line"><span style="color:#a6accd">  ssl: "on"</span></span>
<span class="line"><span style="color:#a6accd">kind: ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  creationTimestamp: "2019-11-05T01:45:13Z"</span></span>
<span class="line"><span style="color:#a6accd">  name: mcmd-config</span></span>
<span class="line"><span style="color:#a6accd">  namespace: default</span></span>
<span class="line"><span style="color:#a6accd">  resourceVersion: "5394993"</span></span>
<span class="line"><span style="color:#a6accd">  selfLink: /api/v1/namespaces/default/configmaps/mcmd-config</span></span>
<span class="line"><span style="color:#a6accd">  uid: 02012d69-e324-4e9d-ba04-7132e9f6ecd8</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>metadataYAML</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap mcmd-config -o yaml &gt; mcmd-config-v2.yaml</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# vim mcmd-config-v2.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">data:</span></span>
<span class="line"><span style="color:#a6accd">  host: www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">  port: "443"</span></span>
<span class="line"><span style="color:#a6accd">  ssl: "on"</span></span>
<span class="line"><span style="color:#a6accd">kind: ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: mcmd-config-v2</span></span>
<span class="line"><span style="color:#a6accd">  namespace: default</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><a href="http://xn--metadata-0n3mp82lcujlhxj58f8qvb.name" target="_blank" rel="noreferrer">metadata.name</a>,</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create -f mcmd-config-v2.yaml </span></span>
<span class="line"><span style="color:#a6accd">configmap/mcmd-config-v2 created</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap</span></span>
<span class="line"><span style="color:#a6accd">NAME             DATA   AGE</span></span>
<span class="line"><span style="color:#a6accd">cmd-config       1      24m</span></span>
<span class="line"><span style="color:#a6accd">mcmd-config      3      16m</span></span>
<span class="line"><span style="color:#a6accd">mcmd-config-v2   3      9s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="configmap" tabindex="-1">ConfigMap <a class="header-anchor" href="#configmap" aria-hidden="true">#</a></h3><p>ConfigMapConfigMap</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap file-config --from-file=/etc/hosts</span></span>
<span class="line"><span style="color:#a6accd">configmap/file-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ConfigMapKeyhostsKey</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe configmap file-config</span></span>
<span class="line"><span style="color:#a6accd">Name:         file-config</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Labels:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Data</span></span>
<span class="line"><span style="color:#a6accd">====</span></span>
<span class="line"><span style="color:#a6accd">hosts:</span></span>
<span class="line"><span style="color:#a6accd">----</span></span>
<span class="line"><span style="color:#a6accd">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#a6accd">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.27 k8s-master1 k8s-master1.dianjoy.com </span></span>
<span class="line"><span style="color:#a6accd">192.168.99.28 k8s-master2 k8s-master2.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.29 k8s-master3 k8s-master3.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Events:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Keyhost-hosts</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap file-config-v2 --from-file=host-hosts=/etc/hosts</span></span>
<span class="line"><span style="color:#a6accd">configmap/file-config-v2 created</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe configmap file-config-v2</span></span>
<span class="line"><span style="color:#a6accd">Name:         file-config-v2</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Labels:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Data</span></span>
<span class="line"><span style="color:#a6accd">====</span></span>
<span class="line"><span style="color:#a6accd">host-hosts:</span></span>
<span class="line"><span style="color:#a6accd">----</span></span>
<span class="line"><span style="color:#a6accd">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#a6accd">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.27 k8s-master1 k8s-master1.dianjoy.com </span></span>
<span class="line"><span style="color:#a6accd">192.168.99.28 k8s-master2 k8s-master2.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.29 k8s-master3 k8s-master3.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Events:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="configmap" tabindex="-1">ConfigMap <a class="header-anchor" href="#configmap" aria-hidden="true">#</a></h3><p>ConfigMapkubectl</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap dir-config --from-file=/etc/kubernetes</span></span>
<span class="line"><span style="color:#a6accd">configmap/dir-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="configmap" tabindex="-1">ConfigMap <a class="header-anchor" href="#configmap" aria-hidden="true">#</a></h3><p>ConfigMap</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap mycp --from-literal=env=test \</span></span>
<span class="line"><span style="color:#a6accd"> --from-file=/etc/hosts \</span></span>
<span class="line"><span style="color:#a6accd"> --from-file=myhosts=/etc/hosts \</span></span>
<span class="line"><span style="color:#a6accd"> --from-file=/etc/kubernetes</span></span>
<span class="line"><span style="color:#a6accd">configmap/mycp created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ConfigMapVolume</p><h3 id="configmap" tabindex="-1">ConfigMap <a class="header-anchor" href="#configmap" aria-hidden="true">#</a></h3><p>ConfigMapConfigMapPod</p><h2 id="_15-2-secret" tabindex="-1">15.2 Secret <a class="header-anchor" href="#_15-2-secret" aria-hidden="true">#</a></h2><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">KubernetesSecretSSH KeyPod</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="podharbor" tabindex="-1">PodHarbor <a class="header-anchor" href="#podharbor" aria-hidden="true">#</a></h3><p>1docker login docker</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker login 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat /root/.docker/config.json |base64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.harborSecret YAML</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim harbor-secret.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Secret</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: harbor-secret</span></span>
<span class="line"><span style="color:#a6accd">  namespace: default</span></span>
<span class="line"><span style="color:#a6accd">data:</span></span>
<span class="line"><span style="color:#a6accd">  .dockerconfigjson: 'ewoJImF1dGhzIjogewoJCSJyZWcuZ3JlYXRvcHMubmV0IjogewoJCQkiYXV0aCI6ICJZV1J0YVc0Nk1YRmhlbmh6ZHpJPSIKCQl9Cgl9Cn0='</span></span>
<span class="line"><span style="color:#a6accd">type: kubernetes.io/dockerconfigjson</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4.Secret</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@jenkins k8s-deploy]# kubectl create -f reg-harbor.yaml </span></span>
<span class="line"><span style="color:#a6accd">secret "reg-harbor" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>5.pod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Pod</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: sectest</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  containers:</span></span>
<span class="line"><span style="color:#a6accd">  - name: sectest</span></span>
<span class="line"><span style="color:#a6accd">    image: 123.207.154.16/base/redis:alpine</span></span>
<span class="line"><span style="color:#a6accd">    ports:</span></span>
<span class="line"><span style="color:#a6accd">    - containerPort: 6379</span></span>
<span class="line"><span style="color:#a6accd">  imagePullSecrets:</span></span>
<span class="line"><span style="color:#a6accd">    - name: harbor-secret</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="helmkubernetes" tabindex="-1">HelmKubernetes <a class="header-anchor" href="#helmkubernetes" aria-hidden="true">#</a></h1><p>KubernetesDeploymentServiceIngressPVPVCKubernetesHelm HelmkuberneteschartsUbuntuAPTCentOSyum Helm chartkubernetesyamlmetadata</p><p>Helmcharts</p><ul><li></li><li></li><li></li><li></li></ul><h2 id="helm" tabindex="-1">Helm <a class="header-anchor" href="#helm" aria-hidden="true">#</a></h2><h3 id="helm" tabindex="-1">Helm <a class="header-anchor" href="#helm" aria-hidden="true">#</a></h3><p>1.Helm</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# tar zxf helm-v3.0.2-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# mv linux-amd64/helm /usr/local/bin/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm version</span></span>
<span class="line"><span style="color:#a6accd">version.BuildInfo{Version:"v3.0.2", GitCommit:"19e47ee3283ae98139d98460de796c1be1e3975f", GitTreeState:"clean", GoVersion:"go1.13.5"}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="helm" tabindex="-1">Helm <a class="header-anchor" href="#helm" aria-hidden="true">#</a></h3><p>4.Helm</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm search jenkins</span></span>
<span class="line"><span style="color:#a6accd">NAME              CHART VERSION    APP VERSION    DESCRIPTION                                       </span></span>
<span class="line"><span style="color:#a6accd">stable/jenkins    0.13.5           2.73           Open source continuous integration server. It s...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>5.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm repo list</span></span>
<span class="line"><span style="color:#a6accd">NAME      URL                                                   </span></span>
<span class="line"><span style="color:#a6accd">stable    https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span>
<span class="line"><span style="color:#a6accd">local     http://127.0.0.1:8879/charts</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>6.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm install stable/jenkins</span></span>
<span class="line"><span style="color:#a6accd">NAME:   viable-seal</span></span>
<span class="line"><span style="color:#a6accd">LAST DEPLOYED: Thu Jul 26 19:21:07 2018</span></span>
<span class="line"><span style="color:#a6accd">NAMESPACE: default</span></span>
<span class="line"><span style="color:#a6accd">STATUS: DEPLOYED</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">RESOURCES:</span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">NAME                       DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins        3     1s</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins-tests  1     1s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#a6accd">NAME                 STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins  Pending  1s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Service</span></span>
<span class="line"><span style="color:#a6accd">NAME                       TYPE          CLUSTER-IP   EXTERNAL-IP  PORT(S)         AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins-agent  ClusterIP     10.1.154.54  &lt;none&gt;       50000/TCP       1s</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins        LoadBalancer  10.1.63.24   &lt;pending&gt;    8080:20031/TCP  0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1beta1/Deployment</span></span>
<span class="line"><span style="color:#a6accd">NAME                 DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins  1        1        1           0          0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Pod(related)</span></span>
<span class="line"><span style="color:#a6accd">NAME                                  READY  STATUS   RESTARTS  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins-7f5c7bd8d4-gc5hv  0/1    Pending  0         0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Secret</span></span>
<span class="line"><span style="color:#a6accd">NAME                 TYPE    DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins  Opaque  2     1s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NOTES:</span></span>
<span class="line"><span style="color:#a6accd">1. Get your 'admin' user password by running:</span></span>
<span class="line"><span style="color:#a6accd">  printf $(kubectl get secret --namespace default viable-seal-jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo</span></span>
<span class="line"><span style="color:#a6accd">2. Get the Jenkins URL to visit by running these commands in the same shell:</span></span>
<span class="line"><span style="color:#a6accd">  NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span></span>
<span class="line"><span style="color:#a6accd">        You can watch the status of by running 'kubectl get svc --namespace default -w viable-seal-jenkins'</span></span>
<span class="line"><span style="color:#a6accd">  export SERVICE_IP=$(kubectl get svc --namespace default viable-seal-jenkins --template "{{ range (index .status.loadBalancer.ingress 0) }}{{ . }}{{ end }}")</span></span>
<span class="line"><span style="color:#a6accd">  echo http://$SERVICE_IP:8080/login</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">3. Login with the password from step 1 and the username: admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">For more information on running Jenkins on Kubernetes, visit:</span></span>
<span class="line"><span style="color:#a6accd">https://cloud.google.com/solutions/jenkins-on-container-engine</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_15-2-helm" tabindex="-1">15.2 Helm <a class="header-anchor" href="#_15-2-helm" aria-hidden="true">#</a></h1><h3 id="helm" tabindex="-1">Helm <a class="header-anchor" href="#helm" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# tree ~/.helm/</span></span>
<span class="line"><span style="color:#a6accd">/root/.helm/</span></span>
<span class="line"><span style="color:#a6accd"> cache</span></span>
<span class="line"><span style="color:#a6accd">    archive</span></span>
<span class="line"><span style="color:#a6accd">        jenkins-0.13.5.tgz</span></span>
<span class="line"><span style="color:#a6accd"> plugins</span></span>
<span class="line"><span style="color:#a6accd"> repository</span></span>
<span class="line"><span style="color:#a6accd">    cache</span></span>
<span class="line"><span style="color:#a6accd">       local-index.yaml -&gt; /root/.helm/repository/local/index.yaml</span></span>
<span class="line"><span style="color:#a6accd">       stable-index.yaml</span></span>
<span class="line"><span style="color:#a6accd">    local</span></span>
<span class="line"><span style="color:#a6accd">       index.yaml</span></span>
<span class="line"><span style="color:#a6accd">    repositories.yaml</span></span>
<span class="line"><span style="color:#a6accd"> starters</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">7 directories, 5 files</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd .helm/cache/archive/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 archive]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 16</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 12650 Jul 26 19:21 jenkins-0.13.5.tgz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 archive]# tar zxf jenkins-0.13.5.tgz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 archive]# mv jenkins ~/.helm/repository/local/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd ~/.helm/repository/local/jenkins/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# tree</span></span>
<span class="line"><span style="color:#a6accd">.</span></span>
<span class="line"><span style="color:#a6accd"> Chart.yaml</span></span>
<span class="line"><span style="color:#a6accd"> OWNERS</span></span>
<span class="line"><span style="color:#a6accd"> README.md</span></span>
<span class="line"><span style="color:#a6accd"> templates</span></span>
<span class="line"><span style="color:#a6accd">    config.yaml</span></span>
<span class="line"><span style="color:#a6accd">    _helpers.tpl</span></span>
<span class="line"><span style="color:#a6accd">    home-pvc.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jenkins-agent-svc.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jenkins-master-deployment.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jenkins-master-ingress.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jenkins-master-networkpolicy.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jenkins-master-svc.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jenkins-test.yaml</span></span>
<span class="line"><span style="color:#a6accd">    jobs.yaml</span></span>
<span class="line"><span style="color:#a6accd">    NOTES.txt</span></span>
<span class="line"><span style="color:#a6accd">    rbac.yaml</span></span>
<span class="line"><span style="color:#a6accd">    secret.yaml</span></span>
<span class="line"><span style="color:#a6accd">    service-account.yaml</span></span>
<span class="line"><span style="color:#a6accd">    test-config.yaml</span></span>
<span class="line"><span style="color:#a6accd"> values.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1 directory, 19 files</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="jenkinschart" tabindex="-1">JenkinsChart <a class="header-anchor" href="#jenkinschart" aria-hidden="true">#</a></h3><p>NodePort</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# vim values.yaml</span></span>
<span class="line"><span style="color:#a6accd">ServiceType: NodePort</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm lint ~/.helm/repository/local/jenkins/</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Linting /root/.helm/repository/local/jenkins/</span></span>
<span class="line"><span style="color:#a6accd">Lint OK</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1 chart(s) linted, no failures</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm list</span></span>
<span class="line"><span style="color:#a6accd">NAME           REVISION    UPDATED                     STATUS      CHART          NAMESPACE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal    1           Thu Jul 26 19:21:07 2018    DEPLOYED    jenkins-0.13.5 default</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm delete --purge viable-seal</span></span>
<span class="line"><span style="color:#a6accd">release "viable-seal" deleted</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm install ~/.helm/repository/local/jenkins/ --name devops-jenkins </span></span>
<span class="line"><span style="color:#a6accd">NAME:   devops-jenkins</span></span>
<span class="line"><span style="color:#a6accd">LAST DEPLOYED: Thu Jul 26 19:36:10 2018</span></span>
<span class="line"><span style="color:#a6accd">NAMESPACE: default</span></span>
<span class="line"><span style="color:#a6accd">STATUS: DEPLOYED</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">RESOURCES:</span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Secret</span></span>
<span class="line"><span style="color:#a6accd">NAME            TYPE    DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins  Opaque  2     0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">NAME                  DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins        3     0s</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins-tests  1     0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#a6accd">NAME            STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins  Pending  0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Service</span></span>
<span class="line"><span style="color:#a6accd">NAME                  TYPE       CLUSTER-IP   EXTERNAL-IP  PORT(S)         AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins-agent  ClusterIP  10.1.74.175  &lt;none&gt;       50000/TCP       0s</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins        NodePort   10.1.3.112   &lt;none&gt;       8080:23558/TCP  0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1beta1/Deployment</span></span>
<span class="line"><span style="color:#a6accd">NAME            DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins  1        1        1           0          0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Pod(related)</span></span>
<span class="line"><span style="color:#a6accd">NAME                            READY  STATUS   RESTARTS  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins-64d54b79c-pwjfb  0/1    Pending  0         0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NOTES:</span></span>
<span class="line"><span style="color:#a6accd">1. Get your 'admin' user password by running:</span></span>
<span class="line"><span style="color:#a6accd">  printf $(kubectl get secret --namespace default devops-jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo</span></span>
<span class="line"><span style="color:#a6accd">2. Get the Jenkins URL to visit by running these commands in the same shell:</span></span>
<span class="line"><span style="color:#a6accd">  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services devops-jenkins)</span></span>
<span class="line"><span style="color:#a6accd">  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")</span></span>
<span class="line"><span style="color:#a6accd">  echo http://$NODE_IP:$NODE_PORT/login</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">3. Login with the password from step 1 and the username: admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">For more information on running Jenkins on Kubernetes, visit:</span></span>
<span class="line"><span style="color:#a6accd">https://cloud.google.com/solutions/jenkins-on-container-engine</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm status devops-jenkins</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="chart" tabindex="-1">Chart <a class="header-anchor" href="#chart" aria-hidden="true">#</a></h2><h3 id="nginxchart" tabindex="-1">NginxChart <a class="header-anchor" href="#nginxchart" aria-hidden="true">#</a></h3><p>1.Chart Nginx</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm create helm-nginx</span></span>
<span class="line"><span style="color:#a6accd">Creating helm-nginx</span></span>
<span class="line"><span style="color:#a6accd"> [root@linux-node1 ~]# tree helm-nginx/</span></span>
<span class="line"><span style="color:#a6accd">opencmdb/</span></span>
<span class="line"><span style="color:#a6accd"> charts       #chart</span></span>
<span class="line"><span style="color:#a6accd"> Chart.yaml   #chart</span></span>
<span class="line"><span style="color:#a6accd"> templates    #</span></span>
<span class="line"><span style="color:#a6accd">    deployment.yaml</span></span>
<span class="line"><span style="color:#a6accd">    _helpers.tpl</span></span>
<span class="line"><span style="color:#a6accd">    ingress.yaml</span></span>
<span class="line"><span style="color:#a6accd">    NOTES.txt</span></span>
<span class="line"><span style="color:#a6accd">    service.yaml</span></span>
<span class="line"><span style="color:#a6accd"> values.yaml   #</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.Chart</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd helm-nginx/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 helm-nginx]# vim values.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.Chart</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 helm-nginx]# helm install --dry-run --debug --name helm-nginx .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4.Chart</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 helm-nginx]# helm install --name helm-nginx .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="helm" tabindex="-1">Helm <a class="header-anchor" href="#helm" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm list</span></span>
<span class="line"><span style="color:#a6accd">NAME          REVISION    UPDATED                     STATUS      CHART                 NAMESPACE</span></span>
<span class="line"><span style="color:#a6accd">helm-nginx    1           Sun Sep 16 19:32:19 2018    DEPLOYED    helm-nginx-0.1.0      default  </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd">NAME                          READY     STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">helm-nginx-6975f8dbcd-htvtd   1/1       Running   0          51s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get ingress</span></span>
<span class="line"><span style="color:#a6accd">NAME         HOSTS                ADDRESS   PORTS     AGE</span></span>
<span class="line"><span style="color:#a6accd">helm-nginx   www.helm-nginx.com             80        1m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_17-" tabindex="-1">17  <a class="header-anchor" href="#_17-" aria-hidden="true">#</a></h1><h2 id="prometheus" tabindex="-1">Prometheus <a class="header-anchor" href="#prometheus" aria-hidden="true">#</a></h2><h3 id="prometheus" tabindex="-1">Prometheus <a class="header-anchor" href="#prometheus" aria-hidden="true">#</a></h3><p>PrometheusPrometheusPrometheus ServerAlertmanagerPushgatewayPrometheus ServerPrometheus web UI</p><p><img src="http://k8s.unixhot.com/kubernetes/media/2ada1ece66fcc81d704c2ba46f9dd7d3.png" alt="architecture"></p><p><strong>Prometheus Server</strong></p><p>Promethedus ServerPrometheusPullJobs/ExportersTSDBPrometheus web UIPromQL</p><p><strong>Exporters</strong></p><p>ExportersExportersExportesHTTPPrometheus ServerServerExportersNode ExporterServerZabbixZabbix Agent</p><p><strong>Prometheus web UI</strong></p><p>Prometheus web UIServerWebWeb</p><p><img src="http://k8s.unixhot.com/kubernetes/media/cc11e0cf02ff729fb905ac3648af18f7.png" alt="img"></p><p><strong>PromQL</strong></p><p>PromQLPrometheusPrometheus ServerTSDBPromQL</p><p><strong>Alertmanager</strong></p><p>AlertmanagerPromethedusPromQLZabbixPromQL</p><p><strong>Pushgateway</strong></p><p>PushgatewayPrometheus ServerExporters</p><h3 id="prometheus" tabindex="-1">Prometheus <a class="header-anchor" href="#prometheus" aria-hidden="true">#</a></h3><p>PrometheusPrometheus</p><ul><li></li><li></li><li>Docker</li><li>AnsibleSaltStackPuppetChef</li></ul><p><a href="https://prometheus.io/download/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E3%80%82" target="_blank" rel="noreferrer">https://prometheus.io/download/</a></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget</span></span>
<span class="line"><span style="color:#a6accd">https://github.com/prometheus/prometheus/releases/download/v2.7.1/prometheus-2.7.1.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# tar zxf prometheus-2.7.1.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# mv prometheus-2.7.1.linux-amd64 /usr/local/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# ln -s /usr/local/prometheus-2.7.1.linux-amd64/</span></span>
<span class="line"><span style="color:#a6accd">/usr/local/prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Prometheus</strong></p><p>Prometheusprometheus.yml</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 prometheus]# vim prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># my global config</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">global:</span></span>
<span class="line"><span style="color:#a6accd">scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span>
<span class="line"><span style="color:#a6accd">evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.</span></span>
<span class="line"><span style="color:#a6accd"># scrape_timeout is set to the global default (10s).</span></span>
<span class="line"><span style="color:#a6accd"># Alertmanager configuration</span></span>
<span class="line"><span style="color:#a6accd">alerting:</span></span>
<span class="line"><span style="color:#a6accd">alertmanagers:</span></span>
<span class="line"><span style="color:#a6accd">- static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets:</span></span>
<span class="line"><span style="color:#a6accd"># - alertmanager:9093</span></span>
<span class="line"><span style="color:#a6accd"># Load rules once and periodically evaluate them according to the global</span></span>
<span class="line"><span style="color:#a6accd">'evaluation_interval'.</span></span>
<span class="line"><span style="color:#a6accd">rule_files:</span></span>
<span class="line"><span style="color:#a6accd"># - "first_rules.yml"</span></span>
<span class="line"><span style="color:#a6accd"># - "second_rules.yml"</span></span>
<span class="line"><span style="color:#a6accd"># A scrape configuration containing exactly one endpoint to scrape:</span></span>
<span class="line"><span style="color:#a6accd"># Here it's Prometheus itself.</span></span>
<span class="line"><span style="color:#a6accd">scrape_configs:</span></span>
<span class="line"><span style="color:#a6accd"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries</span></span>
<span class="line"><span style="color:#a6accd">scraped from this config.</span></span>
<span class="line"><span style="color:#a6accd">- job_name: 'prometheus'</span></span>
<span class="line"><span style="color:#a6accd"># metrics_path defaults to '/metrics'</span></span>
<span class="line"><span style="color:#a6accd"># scheme defaults to 'http'.</span></span>
<span class="line"><span style="color:#a6accd">static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets: ['localhost:9090']</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Prometheus</strong></p><p>Prometheus./data--storage.tsdb.path="data/"help</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 prometheus]# ./prometheus help</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 prometheus]# ./prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.799169159Z caller=main.go:620 msg="Starting</span></span>
<span class="line"><span style="color:#a6accd">TSDB ..."</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.835497463Z caller=main.go:635 msg="TSDB</span></span>
<span class="line"><span style="color:#a6accd">started"</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.835598421Z caller=main.go:695 msg="Loading</span></span>
<span class="line"><span style="color:#a6accd">configuration file" filename=prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.83756508Z caller=main.go:722 msg="Completed</span></span>
<span class="line"><span style="color:#a6accd">loading of configuration file" filename=prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.83760078Z caller=main.go:589 msg="Server is</span></span>
<span class="line"><span style="color:#a6accd">ready to receive web requests."</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.837641772Z caller=web.go:416 component=web</span></span>
<span class="line"><span style="color:#a6accd">msg="Start listening for connections" address=0.0.0.0:9090</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>9090data</p><p><img src="http://k8s.unixhot.com/kubernetes/media/266a101825cbabc2782820895e161f59.png" alt="img"></p><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# groupadd prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# useradd -g prometheus -d /var/lib/prometheus -s</span></span>
<span class="line"><span style="color:#a6accd">/sbin/nologin prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /usr/lib/systemd/system/prometheus.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[Unit]</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Description=prometheus</span></span>
<span class="line"><span style="color:#a6accd">After=network.target</span></span>
<span class="line"><span style="color:#a6accd">[Service]</span></span>
<span class="line"><span style="color:#a6accd">Type=simple</span></span>
<span class="line"><span style="color:#a6accd">User=prometheus</span></span>
<span class="line"><span style="color:#a6accd">ExecStart=/usr/local/prometheus/prometheus</span></span>
<span class="line"><span style="color:#a6accd">--config.file=/usr/local/prometheus/prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd">--storage.tsdb.path=/var/lib/prometheus</span></span>
<span class="line"><span style="color:#a6accd">Restart=on-failure</span></span>
<span class="line"><span style="color:#a6accd">[Install]</span></span>
<span class="line"><span style="color:#a6accd">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep 9090</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">tcp6 0 0 :::9090 :::* LISTEN 61333/prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="node-exporter" tabindex="-1">Node Exporter <a class="header-anchor" href="#node-exporter" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget</span></span>
<span class="line"><span style="color:#a6accd">&lt;https://github.com/prometheus/node_exporter/releases/download/v0.17.0/node_exporter-0.17.0.linux-amd64.tar.gz&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# tar zxf node_exporter-0.17.0.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# mv node_exporter-0.17.0.linux-amd64 /usr/local/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# ln -s /usr/local/node_exporter-0.17.0.linux-amd64/</span></span>
<span class="line"><span style="color:#a6accd">/usr/local/node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /usr/lib/systemd/system/node_exporter.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[Unit]</span></span>
<span class="line"><span style="color:#a6accd">Description=node_exporter</span></span>
<span class="line"><span style="color:#a6accd">After=network.target</span></span>
<span class="line"><span style="color:#a6accd">[Service]</span></span>
<span class="line"><span style="color:#a6accd">Type=simple</span></span>
<span class="line"><span style="color:#a6accd">User=prometheus</span></span>
<span class="line"><span style="color:#a6accd">ExecStart=/usr/local/prometheus/node_exporter/node_exporter</span></span>
<span class="line"><span style="color:#a6accd">Restart=on-failure</span></span>
<span class="line"><span style="color:#a6accd">[Install]</span></span>
<span class="line"><span style="color:#a6accd">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Node Exporter</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p> [root@linux-node1 ~]# netstat -ntlp | grep 9100</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">tcp6 0 0 :::9100 :::* LISTEN 66239/node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Node Exporter9100/metricsPrometheus</p><p><img src="http://k8s.unixhot.com/kubernetes/media/1004a69a33423c72a2989005be5a790e.png" alt="img"></p><p><strong>PrometheusNode Exporter</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /usr/local/prometheus/prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">scrape_configs:</span></span>
<span class="line"><span style="color:#a6accd"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries</span></span>
<span class="line"><span style="color:#a6accd">scraped from this config.</span></span>
<span class="line"><span style="color:#a6accd">- job_name: 'prometheus'</span></span>
<span class="line"><span style="color:#a6accd"># metrics_path defaults to '/metrics'</span></span>
<span class="line"><span style="color:#a6accd"># scheme defaults to 'http'.</span></span>
<span class="line"><span style="color:#a6accd">static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets: ['localhost:9090']</span></span>
<span class="line"><span style="color:#a6accd">- job_name: 'linux-node1'</span></span>
<span class="line"><span style="color:#a6accd">static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets: ['192.168.56.11:9100']</span></span>
<span class="line"><span style="color:#a6accd">labels:</span></span>
<span class="line"><span style="color:#a6accd">instance: linux-node1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>prometheus</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><p>PrometheusWebStatusTargetslinux-node1UP</p><p><img src="http://k8s.unixhot.com/kubernetes/media/8c3da60dbf5558dc649de1fd6ce43bf0.png" alt="img"></p><h3 id="prometheus-ui" tabindex="-1">Prometheus UI <a class="header-anchor" href="#prometheus-ui" aria-hidden="true">#</a></h3><p>Prometheus<a href="http://192.168.56.11:9100/metrics%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%AD%98%E5%82%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8Prometheus" target="_blank" rel="noreferrer">http://192.168.56.11:9100/metricsPrometheus</a> UI</p><h3 id="grafana" tabindex="-1">Grafana <a class="header-anchor" href="#grafana" aria-hidden="true">#</a></h3><p><strong>1.Grafana</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/yum.repos.d/grafana.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[grafana]</span></span>
<span class="line"><span style="color:#a6accd">name=grafana</span></span>
<span class="line"><span style="color:#a6accd">baseurl=https://packages.grafana.com/oss/rpm</span></span>
<span class="line"><span style="color:#a6accd">repo_gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">gpgkey=https://packages.grafana.com/gpg.key</span></span>
<span class="line"><span style="color:#a6accd">sslverify=1</span></span>
<span class="line"><span style="color:#a6accd">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y grafana</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.Grafana</strong></p><p>Grafana/etc/grafana/grafana.iniGrafana3000</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/grafana/grafana.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.Grafana</strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable grafana-server</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start grafana-server</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep 3000</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">tcp6 0 0 :::3000 :::* LISTEN 81427/grafana-serve</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.Grafana</strong></p><p><a href="http://192.168.56.11:3000/" target="_blank" rel="noreferrer">http://192.168.56.11:3000</a>admin/admin</p><p><strong>5.Prometheus</strong></p><p></p><p><img src="http://k8s.unixhot.com/kubernetes/media/b681a9b528d2ff21ba66666ce2452e51.png" alt="img"></p><p></p><p><img src="http://k8s.unixhot.com/kubernetes/media/d3e83ac4f090a51c5b5e0c341b99dda5.png" alt="img"></p><p></p><p>URL<a href="http://192.168.56.11:9090/" target="_blank" rel="noreferrer">http://192.168.56.11:9090</a>Save&amp;Test</p><p><img src="http://k8s.unixhot.com/kubernetes/media/e35d8aaebedd7e168ebd1b29b65b30bb.png" alt="img"></p><p><strong>6.Dashboard</strong></p><p>DashboardJson</p><p><a href="https://grafana.com/dashboards/405%EF%BC%8C%E5%9C%A8%E5%8F%B3%E4%BE%A7%E6%9C%89Download" target="_blank" rel="noreferrer">https://grafana.com/dashboards/405Download</a> JsonJson</p><p><img src="http://k8s.unixhot.com/kubernetes/media/d9ab69b29a964a12df52512a7b128b5b.png" alt="img"></p><p>HomeImport Dashboard</p><p><img src="http://k8s.unixhot.com/kubernetes/media/53ffc0e739ca7b9421f9568ae4cbf117.png" alt="img"></p><p>JSON</p><p><img src="http://k8s.unixhot.com/kubernetes/media/500958891a82067b0c987d514239ffb0.png" alt="img"></p><p>Grafana</p><p><img src="http://k8s.unixhot.com/kubernetes/media/698a6241faa0adc1af6c09cc369b259b.png" alt="img"></p><h1 id="-kubernetes" tabindex="-1"> Kubernetes <a class="header-anchor" href="#-kubernetes" aria-hidden="true">#</a></h1><h1 id="kubernetesrbac" tabindex="-1">KubernetesRBAC <a class="header-anchor" href="#kubernetesrbac" aria-hidden="true">#</a></h1><p><strong></strong></p><ul><li><p>Role: </p></li><li><p>ClusterRole</p><p>RoleClusterROleKubernetes API  PodConfigMap kubectl Subject3</p></li></ul><p>User Account KeyStone Goolge  API  Groupcluster-admin Service AccountKubernetes API  namespace  API  ServiceAccount RoleBinding  ClusterRoleBinding Subject  Role ()RoleBinding  namespace  ClusterRoleBinding  namespace</p><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl genrsa -out jenkins.key 2048</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl req -new -key jenkins.key -out jenkins.csr -subj "/CN=jenkins/O=vmware"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl x509 -req -in jenkins.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out jenkins.crt -days 365</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl config set-credentials jenkins --client-certificate=jenkins.crt  --client-key=jenkins.key</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl config set-context jenkins-context --cluster=kubernetes --namespace=jenkins --user=jenkins  </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pods --context=jenkins-context</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim jenkins-role.yml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Role</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins-role</span></span>
<span class="line"><span style="color:#a6accd">  namespace: jenkins</span></span>
<span class="line"><span style="color:#a6accd">rules:</span></span>
<span class="line"><span style="color:#a6accd">- apiGroups: ["", "extensions", "apps"]</span></span>
<span class="line"><span style="color:#a6accd">  resources: ["deployments", "replicasets", "pods"]</span></span>
<span class="line"><span style="color:#a6accd">  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim jenkins-role-binding.yml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: RoleBinding</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins-rolebinding</span></span>
<span class="line"><span style="color:#a6accd">  namespace: jenkins</span></span>
<span class="line"><span style="color:#a6accd">subjects:</span></span>
<span class="line"><span style="color:#a6accd">- kind: User</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins</span></span>
<span class="line"><span style="color:#a6accd">  apiGroup: ""</span></span>
<span class="line"><span style="color:#a6accd">roleRef:</span></span>
<span class="line"><span style="color:#a6accd">  kind: Role</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins-role</span></span>
<span class="line"><span style="color:#a6accd">  apiGroup: ""</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_22-pod" tabindex="-1">22 Pod <a class="header-anchor" href="#_22-pod" aria-hidden="true">#</a></h1><h1 id="pod" tabindex="-1">Pod <a class="header-anchor" href="#pod" aria-hidden="true">#</a></h1><p>Kuberneteskube-schedulerPodPodNodePodkube-schedulerKubernetes</p><p>kube-scheduler<a href="https://github.com/kubernetes/kubernetes/tree/master/pkg/scheduler" target="_blank" rel="noreferrer">GitHub</a></p><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# git clone --depth 1 https://github.com/kubernetes/kubernetes.git</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>algorithmPredicatesprioritiesNodeNodeNodeNode</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 algorithm]# pwd</span></span>
<span class="line"><span style="color:#a6accd">/root/kubernetes/pkg/scheduler/algorithm</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 algorithm]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 20</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 1256 Dec 17 22:52 BUILD</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root  735 Dec 17 22:52 doc.go</span></span>
<span class="line"><span style="color:#a6accd">drwxr-xr-x 2 root root  276 Dec 17 22:52 predicates</span></span>
<span class="line"><span style="color:#a6accd">drwxr-xr-x 3 root root 4096 Dec 17 22:52 priorities</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 3278 Dec 17 22:52 scheduler_interface.go</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 3383 Dec 17 22:52 types.go</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><a href="https://kubernetes.io/docs/concepts/scheduling/kube-scheduler/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/concepts/scheduling/kube-scheduler/</a></p><p><strong></strong></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod kube-proxy-5wbtf -n kube-system -o yaml | grep schedulerName</span></span>
<span class="line"><span style="color:#a6accd">  schedulerName: default-scheduler</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="taints" tabindex="-1">Taints <a class="header-anchor" href="#taints" aria-hidden="true">#</a></h2><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe node linux-node1.unixhot.com | grep Taints</span></span>
<span class="line"><span style="color:#a6accd">Taints:             node-role.kubernetes.io/master:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Taints</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">&lt;key&gt;=&lt;value&gt;:&lt;effect&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>effect</p><ul><li>NoSchedule: Pod</li><li>PreferNoSchedulePod</li><li>NoExecute NoSchedulerPreferNoScheduleNoExecutePodNoExecutePod</li></ul><p>FlannelMaster</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get po -n kube-system | grep flannel</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-f2jrk                       1/1     Running   2          22h</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-mh75v                       1/1     Running   2          22h</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-n52zm                       1/1     Running   4          22h</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe pod kube-flannel-ds-amd64-f2jrk -n kube-system</span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd">Tolerations:     :NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/disk-pressure:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/memory-pressure:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/network-unavailable:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/not-ready:NoExecute</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/pid-pressure:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/unreachable:NoExecute</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/unschedulable:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h3><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl taint node linux-node2.example.com node-ytpe=gpu:NoSchedule       </span></span>
<span class="line"><span style="color:#a6accd">node/linux-node2.example.com tainted</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 example]# cat nginx-deployment-taint.yaml    </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Deployment</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-deployment</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  replicas: 3</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    matchLabels:</span></span>
<span class="line"><span style="color:#a6accd">      app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  template:</span></span>
<span class="line"><span style="color:#a6accd">    metadata:</span></span>
<span class="line"><span style="color:#a6accd">      labels:</span></span>
<span class="line"><span style="color:#a6accd">        app: nginx</span></span>
<span class="line"><span style="color:#a6accd">    spec:</span></span>
<span class="line"><span style="color:#a6accd">      containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">        image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">        ports:</span></span>
<span class="line"><span style="color:#a6accd">        - containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd">      tolerations:</span></span>
<span class="line"><span style="color:#a6accd">      - key: node-type</span></span>
<span class="line"><span style="color:#a6accd">        operator: Equal</span></span>
<span class="line"><span style="color:#a6accd">        value: gpu</span></span>
<span class="line"><span style="color:#a6accd">        effect: Noschedule</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 example]# kubectl get po -o wide</span></span>
<span class="line"><span style="color:#a6accd">NAME                                READY   STATUS    RESTARTS   AGE     IP          NODE                      NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#a6accd">dns-test                            1/1     Running   1          6h15m   10.2.2.23   linux-node3.example.com   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">nginx-deployment-77564d4546-2jkw9   1/1     Running   0          13s     10.2.2.26   linux-node3.example.com   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">nginx-deployment-77564d4546-4hrbf   1/1     Running   0          13s     10.2.2.24   linux-node3.example.com   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">nginx-deployment-77564d4546-s2r4h   1/1     Running   0          13s     10.2.2.25   linux-node3.example</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="" tabindex="-1"> <a class="header-anchor" href="#" aria-hidden="true">#</a></h2><h1 id="_23-kubernetes-api" tabindex="-1">23 Kubernetes API <a class="header-anchor" href="#_23-kubernetes-api" aria-hidden="true">#</a></h1><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl cluster-info</span></span>
<span class="line"><span style="color:#a6accd">Kubernetes master is running at https://192.168.56.11:6443</span></span>
<span class="line"><span style="color:#a6accd">KubeDNS is running at https://192.168.56.11:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Kubernetes API</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# curl -k https://192.168.56.11:6443</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">  "kind": "Status",</span></span>
<span class="line"><span style="color:#a6accd">  "apiVersion": "v1",</span></span>
<span class="line"><span style="color:#a6accd">  "metadata": {</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">  },</span></span>
<span class="line"><span style="color:#a6accd">  "status": "Failure",</span></span>
<span class="line"><span style="color:#a6accd">  "message": "forbidden: User \"system:anonymous\" cannot get path \"/\"",</span></span>
<span class="line"><span style="color:#a6accd">  "reason": "Forbidden",</span></span>
<span class="line"><span style="color:#a6accd">  "details": {</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">  },</span></span>
<span class="line"><span style="color:#a6accd">  "code": 403</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ProxyKubernetes API</strong></p><p>kubectl proxyMaster</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl proxy</span></span>
<span class="line"><span style="color:#a6accd">Starting to serve on 127.0.0.1:8001</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>127.0.0.1:8001API Server</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# curl http://127.0.0.1:8001</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">  "paths": [</span></span>
<span class="line"><span style="color:#a6accd">    "/api",</span></span>
<span class="line"><span style="color:#a6accd">    "/api/v1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/admissionregistration.k8s.io",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/admissionregistration.k8s.io/v1beta1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiextensions.k8s.io",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiextensions.k8s.io/v1beta1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiregistration.k8s.io",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiregistration.k8s.io/v1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiregistration.k8s.io/v1beta1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apps",</span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>API</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl proxy --address=0.0.0.0 --disable-filter=true</span></span>
<span class="line"><span style="color:#a6accd">W1105 16:18:45.669591   16730 proxy.go:142] Request filter disabled, your proxy is vulnerable to XSRF attacks, please be cautious</span></span>
<span class="line"><span style="color:#a6accd">Starting to serve on [::]:8001</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="swagger-uiapi" tabindex="-1">Swagger UIAPI <a class="header-anchor" href="#swagger-uiapi" aria-hidden="true">#</a></h3><p>KubernetesSwagger UIAPIAPI ServerkubeadmPodYAMLPod</p><p><strong>API ServerPod</strong></p><p>- kube-apiserver--enable-swagger-ui=true</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# vim /etc/kubernetes/manifests/kube-apiserver.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Pod</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  creationTimestamp: null</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    component: kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">    tier: control-plane</span></span>
<span class="line"><span style="color:#a6accd">  name: kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">  namespace: kube-system</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  containers:</span></span>
<span class="line"><span style="color:#a6accd">  - command:</span></span>
<span class="line"><span style="color:#a6accd">    - kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">    - --enable-swagger-ui=true</span></span>
<span class="line"><span style="color:#a6accd">    - --advertise-address=192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">    - --allow-privileged=true</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>PodkubeletYAMLPod</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get pod -n kube-system | grep api</span></span>
<span class="line"><span style="color:#a6accd">kube-apiserver-linux-node1.unixhot.com            1/1     Running   0          55m</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl delete pod kube-apiserver-linux-node1.unixhot.com -n kube-system</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe pod kube-apiserver-linux-node1.unixhot.com -n kube-system </span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd">    Command:</span></span>
<span class="line"><span style="color:#a6accd">      kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">      --enable-swagger-ui=true</span></span>
<span class="line"><span style="color:#a6accd">      --advertise-address=192.168.99.27</span></span>
<span class="line"><span style="color:#a6accd">....</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Swagger UIAPI</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl run swagger-ui --image=swaggerapi/swagger-ui:latest</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl expose deployment swagger-ui --port=8080 --type=NodePort</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd">NAME         TYPE        CLUSTER-IP    EXTERNAL-IP     PORT(S)          AGE</span></span>
<span class="line"><span style="color:#a6accd">kubernetes   ClusterIP   10.1.0.1      &lt;none&gt;          443/TCP          43d</span></span>
<span class="line"><span style="color:#a6accd">swagger-ui   NodePort    10.1.205.94   &lt;none&gt;   8080:30410/TCP   34s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Swagger UIAPI ServerChromeAllow CROS</p><hr><hr><p>--------</p><!--]--><!--[--><!--]--><!--]--><div text="center"><!----></div><!----></article><!--]--><!--[--><!--[--><!--[--><div class="yun-sponsor-container flex justify-center items-center flex-col"><button class="sponsor-button yun-icon-btn shadow hover:shadow-md" title="" text="red-400"><div i-ri-heart-line=""></div></button><div m="y-4" class="qrcode-container qrcode flex justify-around"><!--[--><a class="flex flex-col justify-center items-center animate-iteration-1" href="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG203.jpeg" target="_blank" style="color:#00a3ee"><img class="sponsor-method-img" border="~ rounded" p="1" loading="lazy" src="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG203.jpeg" title=""><div text="xl" m="2" class="i-ri-alipay-line"></div></a><a class="flex flex-col justify-center items-center animate-iteration-1" href="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG205.jpeg" target="_blank" style="color:#12b7f5"><img class="sponsor-method-img" border="~ rounded" p="1" loading="lazy" src="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG205.jpeg" title="QQ "><div text="xl" m="2" class="i-ri-qq-line"></div></a><a class="flex flex-col justify-center items-center animate-iteration-1" href="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG204.jpeg" target="_blank" style="color:#2dc100"><img class="sponsor-method-img" border="~ rounded" p="1" loading="lazy" src="https://cos.vlinux.cn/www-vlinux-cn-blog-img/WechatIMG204.jpeg" title=""><div text="xl" m="2" class="i-ri-wechat-pay-line"></div></a><!--]--></div></div><ul class="post-copyright" m="y-4"><li class="post-copyright-author"><strong></strong><span></span></li><li class="post-copyright-link"><strong></strong><a href="https://www.vlinux.cn/posts/docker+k8s">https://www.vlinux.cn/posts/docker+k8s</a></li><li class="post-copyright-license"><strong></strong><span> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 ">CC BY-NC-SA</a> </span></li></ul><!--]--><!--]--><!--]--></div><!--]--><!----></div><!--[--><!--]--><!--[--><div class="post-nav"><div class="post-nav-item"><a href="/posts/k8s(kubernetes)" class="post-nav-prev" title="K8S(kubernetes)"><div class="icon" i-ri-arrow-left-s-line=""></div><span class="title truncate" text="sm">K8S(kubernetes)</span></a></div><div class="post-nav-item"><a href="/posts/linux" class="post-nav-next" title="Linux"><span class="title truncate" text="sm">Linux</span><div class="icon" i-ri-arrow-right-s-line=""></div></a></div></div><!--]--><!--[--><!--]--><!--[--><div class="yun-card comment sm:p-6 lg:px-12 xl:px-16" w="full" p="4"><!----><!----><!--[--><div data-waline="" w="full"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick"></label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value=""></div><div class="wl-header-item"><label for="wl-mail"></label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value=""></div><div class="wl-header-item"><label for="wl-link"></label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value=""></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder=""></textarea><div class="wl-preview" style="display:none"><hr><h4>:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariahidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="" style="display:none"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title=""><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform:translateY(.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title=""><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title=""><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0<!--v-if--> &nbsp;</div><button class="wl-btn"></button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[--><!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder=""><div class="wl-gallery" style="gap:6px"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> </div><ul class="wl-sort"><!--[--><li class="active"></li><li class=""></li><li class=""></li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><div class="wl-power">Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noreferrer">Waline </a>v2.14.1</div></div><!-- <YunTwikoo /> --><!--]--><!----></div><!--]--><!--[--><!--]--><footer class="va-footer p-4 text-$va-c-text-light" text="center sm"><div class="beian" m="y-2"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">ICP20001100-3</a></div><div class="copyright flex justify-center items-center" p="1"><span><!--[--> 2016 -<!--]--> 2022</span><a m="x-2" class="inline-flex animate-pulse" href="https://sponsors.yunyoujun.cn" target="_blank" title="Sponsor YunYouJun"><div class="i-ri-cloud-line"></div></a><span></span></div><div class="powered" m="2"><span> <a href="https://github.com/YunYouJun/valaxy" target="_blank" rel="noopener">Valaxy</a> v0.11.4 </span> | <span> - <a href="https://yun.valaxy.site" title="valaxy-theme-yun" target="_blank">Yun</a> v0.11.4</span></div><!--[--><!--]--></footer><!--[--><!--]--></div><!--]--><!--[--><!--[--><button class="xl:hidden toc-btn shadow fixed yun-icon-btn z-350" opacity="75" right="2" bottom="19"><div i-ri-file-list-line=""></div></button><!----><!--  --><aside class="va-card aside" m="l-4" text="center"><div class="aside-container" flex="~ col"><h2 m="t-6 b-2" font="serif black"></h2><div style="display:none" data-v-928b99a5=""><div class="content" data-v-928b99a5=""><div class="outline-title" data-v-928b99a5="">On this page</div><div class="outline-marker" data-v-928b99a5=""></div><nav aria-labelledby="doc-outline-aria-label" data-v-928b99a5=""><span id="doc-outline-aria-label" class="visually-hidden" data-v-928b99a5="">Table of Contents for current page</span><ul class="root va-toc relative z-1" data-v-928b99a5="" data-v-5552addd=""><!--[--><!--]--></ul></nav></div></div><div class="flex-grow"></div><div class="custom-container"><!--[--><!--]--></div></div></aside><!--]--><!--]--></div></main><a href="#" class="back-to-top yun-icon-btn"><div w="8" h="8" i-ri-arrow-up-s-line=""></div><svg class="progress-circle-container" viewBox="0 0 100 100"><circle stroke-dasharray="301.59289474462014 301.59289474462014" stroke-dashoffset="301.59289474462014" class="progress-circle" cx="50" cy="50" r="48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></circle></svg></a><!--]--><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"app":{"isSidebarOpen":false,"isRightSidebarOpen":false}}}'</script><link rel="stylesheet" href="/assets/index.5e999eb6.css"><link rel="stylesheet" href="/assets/post.1d1be697.css"><link rel="stylesheet" href="/assets/YunWaline.55def383.css"><link rel="stylesheet" href="/assets/ValaxyMain.d58abc01.css"></body></html>