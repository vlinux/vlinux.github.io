<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg"><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script>!function(){var e=localStorage.getItem("valaxy-locale")||"en";document.documentElement.setAttribute("lang",e)}()</script><script type="module" async="" crossorigin="" src="/assets/app-c05f80d3.js"></script><style>@charset "UTF-8";.back-to-top{position:fixed;right:-1.5rem;bottom:1rem;z-index:var(--yun-z-go-up-btn);opacity:0;pointer-events:none;color:var(--va-c-primary);transform:translate(0) rotate(270deg);transition:transform var(--va-transition-duration),opacity var(--va-transition-duration-fast)!important}.progress-circle{transition:.3s stroke-dashoffset;transform:rotate(-90deg);transform-origin:50% 50%}.progress-circle-container{position:absolute}.menu-btn{display:inline-flex;position:fixed;left:.8rem;top:.6rem;line-height:1;z-index:var(--yun-z-menu-btn);cursor:pointer}.sidebar .links{display:flex;justify-content:center}.sidebar .link-item{display:inline-flex}.sidebar .link-item .icon{width:2rem;height:2rem}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.site-nav{display:flex;justify-content:center;overflow:hidden;line-height:1.5;white-space:nowrap;text-align:center;margin-top:1rem}.site-link-item{display:flex;padding:0 15px;align-items:center;border-left:1px solid var(--va-c-gray);flex-direction:column;color:var(--va-c-text)}.site-link-item:first-child,.site-link-item:last-child{line-height:1;padding:0}.site-link-item:first-child{border-left:none;border-right:1px solid var(--va-c-gray)}.site-link-item:last-child{border-left:1px solid var(--va-c-gray)}.site-link-item:nth-child(2){border:none}.site-link-item .count{color:var(--va-c-text);font-family:var(--va-font-sans);display:block;text-align:center;font-size:1rem}.site-link-item .icon{width:1.5rem;height:1.5rem}.site-link-item .icon:hover{color:var(--va-c-primary-light)}.sidebar-panel{padding:.5rem}.site-author-avatar{display:inline-block;line-height:0;position:relative}.site-author-avatar img{height:96px;width:96px;max-width:100%;margin:0;padding:4px;background-color:#fff;box-shadow:0 0 10px #0003;transition:.4s}.site-author-avatar img:hover{box-shadow:0 0 30px rgba(var(--va-c-primary-rgb),.2)}.site-author-name{margin-top:0;margin-bottom:1rem;line-height:1.5}.site-author-status{position:absolute;height:1.8rem;width:1.8rem;bottom:0;right:0;line-height:1.8rem;border-radius:50%;box-shadow:0 1px 2px #0003;background-color:var(--va-c-bg-light);border:1px solid rgba(255,255,255,.1)}.site-name{color:var(--va-c-text);font-family:var(--va-font-serif);font-weight:900}.site-subtitle{color:var(--va-c-gray);display:block}.site-description{color:var(--va-c-text);font-size:.8rem}.va-bg{position:fixed;width:100%;height:100%;z-index:-1;background-image:var(--va-bg-img);background-size:cover;background-position:center;background-repeat:no-repeat;background-attachment:fixed;animation-name:bgFadeIn;animation-duration:2s;opacity:var(--va-bg-img-opacity,1)}@supports (-webkit-touch-callout:none){.va-bg{background-attachment:scroll}}@keyframes bgFadeIn{0%{opacity:0}to{opacity:var(--va-bg-img-opacity,1)}}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}h1,h2,h3,h4{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=button],button{-webkit-appearance:button;background-color:transparent;background-image:none}blockquote,h1,h2,h3,h4,hr,p,pre{margin:0}ol,ul{list-style:none;margin:0;padding:0}button{cursor:pointer}img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}body{counter-reset:katexEqnNo mmlEqnNo}html{-webkit-tap-highlight-color:transparent}a{color:var(--va-c-link);font-weight:500}*{outline:0}hr{opacity:.2;margin:1rem}.va-card{background-color:var(--va-c-bg-light)}.inline-flex-center{display:inline-flex;justify-content:center;align-items:center}#app,body,html{margin:0;padding:0;line-height:2}body{background-color:var(--va-c-bg)}a{cursor:pointer}@media screen and (max-width:640px){.markdown-body div[class*=language-]{margin:0 var(--va-code-mobile-margin-x,-1rem)}}@media (min-width:640px){.markdown-body div[class*=language-]{border-radius:6px;margin:16px 0}}@media (max-width:639px){.markdown-body li div[class*=language-]{border-radius:6px 0 0 6px}}.markdown-body code{font-size:.85em}.markdown-body div[class*=language-]{position:relative;background-color:var(--va-code-block-bg);overflow-x:auto}.markdown-body div[class*=language-] code{padding:0 24px;line-height:var(--va-code-line-height);font-size:var(--va-code-font-size);color:var(--va-code-block-color);transition:color .5s;width:fit-content;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}.markdown-body div[class*=language-] pre{position:relative;z-index:1;margin:0;padding:1rem 0;background:0 0;overflow-x:auto}.markdown-body div[class*=language-] pre code{display:block}.markdown-body [class*=language-]>span.copy{position:absolute;top:8px;right:8px;z-index:2;display:block;justify-content:center;align-items:center;border-radius:4px;width:40px;height:40px;background-color:var(--va-code-block-bg);opacity:0;cursor:pointer;background-image:var(--va-icon-copy);background-position:50%;background-size:20px;background-repeat:no-repeat;transition:opacity .25s}.markdown-body [class*=language-]:hover>span.copy{opacity:1}.markdown-body [class*=language-]>span.copy:hover{background-color:var(--va-code-copy-code-hover-bg)}.markdown-body [class*=language-]:before{position:absolute;top:6px;right:12px;z-index:2;font-size:12px;font-weight:500;color:var(--va-c-text-dark-3);transition:color .5s,opacity .5s}.markdown-body [class*=language-]:hover:before{opacity:0}:root{--va-c-text-warning:#544500}.vt-hamburger{display:flex;justify-content:center;align-items:center}.vt-hamburger:hover .vt-hamburger-top{transform:translate(-5.5px)}.vt-hamburger:hover .vt-hamburger-middle{transform:translate(0)}.vt-hamburger:hover .vt-hamburger-bottom{transform:translate(-11px)}.vt-hamburger-container{position:relative;width:22px;height:20px;overflow:hidden}.vt-hamburger-bottom,.vt-hamburger-middle,.vt-hamburger-top{left:0;position:absolute;width:22px;height:2px;background-color:var(--va-c-primary);transition:top .25s,background-color .5s,transform .25s}.vt-hamburger-top{top:0;transform:translate(0)}.vt-hamburger-middle{top:9px;transform:translate(-11px)}.vt-hamburger-bottom{top:18px;transform:translate(-5.5px)}.sidebar{position:fixed;overflow-y:auto;top:0;bottom:0;left:0;width:calc(100vw - 64px);max-width:var(--va-sidebar-width);background-image:var(--yun-sidebar-bg-img);background-color:var(--yun-sidebar-bg-color);background-size:contain;background-repeat:no-repeat;background-position:bottom 1rem center;text-align:center;z-index:var(--yun-z-sidebar);transform:translate(-100%);transition:box-shadow var(--va-transition-duration),background-color var(--va-transition-duration),opacity .25s,transform var(--va-transition-duration) cubic-bezier(.19,1,.22,1)!important}h1:focus .header-anchor,h1:hover .header-anchor,h2:focus .header-anchor,h2:hover .header-anchor,h3:focus .header-anchor,h3:hover .header-anchor,h4:focus .header-anchor,h4:hover .header-anchor{visibility:visible;opacity:1}a.header-anchor{float:left;margin-top:.125em;margin-left:-.87em;padding-right:.23em;font-size:.85em;visibility:hidden;opacity:0;transition:opacity var(--va-transition-duration)}a.header-anchor:before{content:none}a.header-anchor:focus,a.header-anchor:hover{text-decoration:none}:root{--va-aside-width:256px;--va-sidebar-width:300px;--va-border-width:1px;--va-font-serif:"Noto Serif SC",STZhongsong,Roboto,serif;--va-font-sans:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;--va-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace;--va-transition-duration-fast:.2s;--va-transition-duration:.4s;--va-transition-duration-slow:.6s;--va-transition:all var(--va-transition-duration-fast) ease-in-out}:root{--va-c-white:#ffffff;--va-c-black:#1a1a1a;--va-c-gray:#8e8e8e;--va-c-danger:#db2828;--va-c-warning:#f2711c;--va-c-text-light-1:#213547;--va-c-text-light-2:rgba(60, 60, 60, .7);--va-c-text-light-3:rgba(60, 60, 60, .33);--va-c-text-light-4:rgba(60, 60, 60, .18);--va-c-text-dark-1:rgba(255, 255, 255, .87);--va-c-text-dark-2:rgba(235, 235, 235, .6);--va-c-text-dark-3:rgba(235, 235, 235, .38);--va-c-text-dark-4:rgba(235, 235, 235, .18);--va-c-primary-light:#359eff;--va-c-primary-lighter:#81c2ff;--va-c-primary-dark:#006bce;--va-c-primary:#0078E7}:root{color-scheme:light;--va-c-brand:#0078E7;--va-border-color:#222;--va-c-bg:white;--va-c-bg-light:white;--va-c-bg-dark:#fafafa;--va-c-bg-opacity:rgba(255, 255, 255, .8);--va-c-bg-soft:#f9f9f9;--va-c-bg-alt:#f9f9f9;--va-c-bg-mute:#f1f1f1;--va-c-text:#333;--va-c-text-light:#555;--va-c-text-lighter:#666;--va-c-text-dark:#111;--va-c-primary-rgb:0,120,231;--va-c-link:var(--va-c-primary-dark);--va-c-divider:rgba(60, 60, 60, .2)}:root{--va-code-line-height:1.7;--va-code-font-size:.875em;--va-code-block-color:var(--va-c-text-dark-1);--va-code-block-bg:#282c34;--va-code-line-highlight-color:rgba(0, 0, 0, .5);--va-code-line-number-color:var(--va-c-text-dark-3);--va-code-copy-code-hover-bg:rgba(255, 255, 255, .05);--va-code-copy-code-active-text:var(--va-c-text-dark-2)}:root{--va-icon-copy:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2'/%3E%3C/svg%3E");--va-icon-copied:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2m-6 9 2 2 4-4'/%3E%3C/svg%3E")}.post-title{display:flex;justify-content:center;align-items:center}.post-tag{white-space:nowrap;color:var(--yun-tag-color)}.post-tag:hover{color:var(--va-c-primary)}.yun-main{padding-left:var(--va-sidebar-width);transition:padding-left var(--va-transition-duration);box-sizing:border-box}.yun-icon-btn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border:none;width:3rem;height:3rem;border-radius:50%;transition:background-color var(--va-transition-duration)}.yun-icon-btn div{font-size:1.2rem}.yun-icon-btn:hover{background-color:rgba(var(--va-c-primary-rgb),.08)}.yun-icon-btn:active{background-color:rgba(var(--va-c-primary-rgb),.16)}:root{--smc-font-sans:Raleway,-apple-system,"PingFang SC","Microsoft YaHei",Arial,sans-serif;--smc-font-serif:"Songti SC","Noto Serif SC",STZhongsong,STKaiti,KaiTi,Roboto,serif;--smc-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace}:root{--smc-c-primary-light:#4eaaff;--smc-c-primary-lighter:#9bcfff;--smc-c-primary:#0078E7;--smc-theme-name:yun;--smc-line-height:1.8;--smc-c-primary-rgb:0,120,231;--smc-c-text:#24292e;--smc-c-text-light:#555;--smc-c-text-lighter:#666;--smc-header-bottom-color:#eaecef;--smc-border-color:var(--smc-c-primary-light);--smc-code-bg-color:#f6f8fa;--smc-link-color:#005eb4}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--smc-bg-color);color:var(--smc-c-text);font-family:var(--smc-font-sans);font-size:1rem;line-height:var(--smc-line-height);overflow-wrap:break-word}.markdown-body *{box-sizing:border-box}.markdown-body a{background-color:transparent}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body hr{background-color:var(--smc-c-primary,#333);height:2px;margin:1.5rem 0}.markdown-body blockquote{margin:1rem 0;padding:0 1rem;border-left:.25em solid var(--smc-border-color)}.markdown-body code,.markdown-body pre{font-family:Source Code Pro,Consolas,Monaco,SFMono-Regular,Ubuntu Mono,Menlo,monospace}.markdown-body code{padding:3px 6px;font-size:.85rem;color:var(--smc-c-text-light);background:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre{margin-top:0;margin-bottom:0;overflow-wrap:normal;padding:1rem;overflow:auto;background-color:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre>code{font-size:.85rem;white-space:pre}.markdown-body pre code{display:block;padding:0;margin:0;overflow:visible;line-height:inherit;word-break:normal;background-color:transparent;border:0}.markdown-body img{display:block;margin:1rem auto;max-width:92%;max-height:600px;border-radius:.2rem;transition:.4s;--tw-shadow:0 1px 3px 0 rgb(0 0 0/.1),0 1px 2px -1px rgb(0 0 0/.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color);-webkit-box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow);box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.markdown-body img:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0/.1),0 2px 4px -2px rgb(0 0 0/.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.markdown-body img:before{content:"\300c  LOADING ERROR \300d"}@media screen and (min-width:1600px){.markdown-body img{max-width:800px}}.markdown-body a{color:var(--smc-c-primary);text-decoration:none;border-bottom-color:transparent;transition:all .2s ease-in-out}.markdown-body a:hover{color:var(--smc-link-color);border-bottom:1px solid var(--smc-link-color)}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ul,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{overflow-wrap:break-all;margin-top:.25em}.markdown-body li>p{margin-top:16px}.markdown-body table{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid var(--smc-c-primary-light,#999)}.markdown-body table thead th{font-weight:600}.markdown-body table>tbody>tr:hover{background-color:rgba(var(--smc-c-primary-rgb),.1)}.markdown-body strong{font-family:var(--smc-font-serif);font-weight:900}.markdown-body p{margin-top:1rem;margin-bottom:1rem;overflow-x:auto;overflow-y:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4{margin-top:1.5rem;margin-bottom:1rem;font-weight:300;line-height:1.5}.markdown-body h1{font-size:2.5rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h2{font-size:2.2rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h3{font-size:1.9rem}.markdown-body h4{font-size:1.6rem}@media screen and (max-width:768px){.markdown-body h1{font-size:2rem}.markdown-body h2{font-size:1.8rem}.markdown-body h3{font-size:1.6rem}.markdown-body h4{font-size:1.4rem}}.markdown-body{--smc-font-family:var(--va-font-sans);--c-toc-link:var(--va-c-text-light)}.markdown-body{word-wrap:break-word}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4{font-family:var(--va-font-serif);font-weight:900}.markdown-body ul{list-style:initial}.markdown-body ul li>p{margin-bottom:0}.markdown-body ol li{list-style:decimal}.markdown-body img{margin:auto}.markdown-body p{overflow:unset}:root{--yun-post-card-max-width:900px;--yun-c-cloud:white;--yun-z-toc-btn:7;--yun-z-cloud:7;--yun-z-go-down:9;--yun-z-backdrop:9;--yun-z-sidebar:10;--yun-z-fireworks:11;--yun-z-menu-btn:20;--yun-z-go-up-btn:20;--yun-z-search-popup:30;--yun-z-search-btn:31;--va-z-overlay:var(--yun-z-backdrop)}:root{--yun-bg-img:url(https://cdn.yunyoujun.cn/img/bg/stars-timing-0-blur-30px.jpg);--yun-sidebar-bg-color:var(--va-c-bg-light);--yun-sidebar-bg-img:url(https://cdn.yunyoujun.cn/img/bg/alpha-stars-timing-1.webp)}*,::after,::before{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-scroll-snap-strictness:proximity;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow:0 0 rgba(0,0,0,0);--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,0.5)}[i-ri-archive-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M3 10H2V4.003C2 3.449 2.455 3 2.992 3h18.016A.99.99 0 0 1 22 4.003V10h-1v10.001a.996.996 0 0 1-.993.999H3.993A.996.996 0 0 1 3 20.001V10zm16 0H5v9h14v-9zM4 5v3h16V5H4zm5 7h6v2H9v-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-left-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m10.828 12l4.95 4.95l-1.414 1.414L8 12l6.364-6.364l1.414 1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-right-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m13.172 12l-4.95-4.95l1.414-1.414L16 12l-6.364 6.364l-1.414-1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-up-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m12 10.828l-4.95 4.95l-1.414-1.414L12 8l6.364 6.364l-1.414 1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-calendar-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M17 3h4a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h4V1h2v2h6V1h2v2zm-2 2H9v2H7V5H4v4h16V5h-3v2h-2V5zm5 6H4v8h16v-8z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-clipboard-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M7 4V2h10v2h3.007c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 21.007V4.993C3 4.445 3.445 4 3.993 4H7zm0 2H5v14h14V6h-2v2H7V6zm2-2v2h6V4H9z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-cloud-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M17 21H7A6 6 0 0 1 5.008 9.339a7 7 0 1 1 13.984 0A6 6 0 0 1 17 21zm0-12a5 5 0 1 0-9.994.243l.07 1.488l-1.404.494A4.002 4.002 0 0 0 7 19h10a4 4 0 1 0-3.796-5.265l-1.898-.633A6.003 6.003 0 0 1 17 9z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-file-list-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1zm-1-2V4H5v16h14zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h8v2H8v-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-folder-2-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.414 5H21a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2zM20 11H4v8h16v-8zm0-2V7h-8.414l-2-2H4v4h16z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-genderless-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M13 7.066A7.501 7.501 0 0 1 12 22a7.5 7.5 0 0 1-1-14.934V1h2v6.066zM12 20a5.5 5.5 0 1 0 0-11a5.5 5.5 0 0 0 0 11z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-heart-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.001 4.529a5.998 5.998 0 0 1 8.242.228a6 6 0 0 1 .236 8.236l-8.48 8.492l-8.478-8.492a6 6 0 0 1 8.48-8.464zm6.826 1.641a3.998 3.998 0 0 0-5.49-.153l-1.335 1.198l-1.336-1.197a3.999 3.999 0 0 0-5.494.154a4 4 0 0 0-.192 5.451L12 18.654l7.02-7.03a4 4 0 0 0-.193-5.454z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-home-4-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M19 21H5a1 1 0 0 1-1-1v-9H1l10.327-9.388a1 1 0 0 1 1.346 0L23 11h-3v9a1 1 0 0 1-1 1zm-6-2h5V9.157l-6-5.454l-6 5.454V19h5v-6h2v6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-money-cny-circle-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16zm1-7h3v2h-3v2h-2v-2H8v-2h3v-1H8v-2h2.586L8.464 7.879L9.88 6.464L12 8.586l2.121-2.122l1.415 1.415L13.414 10H16v2h-3v1z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-price-tag-3-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m10.9 2.1l9.899 1.415l1.414 9.9l-9.192 9.192a1 1 0 0 1-1.414 0l-9.9-9.9a1 1 0 0 1 0-1.414L10.9 2.1zm.707 2.122L3.828 12l8.486 8.485l7.778-7.778l-1.06-7.425l-7.425-1.06zm2.12 6.364a2 2 0 1 1 2.83-2.829a2 2 0 0 1-2.83 2.829z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-translate=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M5 15v2a2 2 0 0 0 1.85 1.995L7 19h3v2H7a4 4 0 0 1-4-4v-2h2zm13-5l4.4 11h-2.155l-1.201-3h-4.09l-1.199 3h-2.154L16 10h2zm-1 2.885L15.753 16h2.492L17 12.885zM8 2v2h4v7H8v3H6v-3H2V4h4V2h2zm9 1a4 4 0 0 1 4 4v2h-2V7a2 2 0 0 0-2-2h-3V3h3zM6 6H4v3h2V6zm4 0H8v3h2V6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-women-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M11 15.934A7.501 7.501 0 0 1 12 1a7.5 7.5 0 0 1 1 14.934V18h5v2h-5v4h-2v-4H6v-2h5v-2.066zM12 14a5.5 5.5 0 1 0 0-11a5.5 5.5 0 0 0 0 11z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i~=ri-sun-line]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.yun-card{margin:auto;--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow);transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms;transition-duration:var(--va-transition-duration)}.va-card{--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.va-card:hover,.yun-card:hover{--un-shadow:var(--un-shadow-inset) 0 10px 15px -3px var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 4px 6px -4px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}@media (max-width:767.9px){.yun-main{padding-left:0}}.fixed{position:fixed}.relative{position:relative}[bottom~="\31 9"]{bottom:4.75rem}[right~="\32 "]{right:.5rem}.z-1{z-index:1}.z-350{z-index:350}[m~="\30 "]{margin:0}[m~="\32 "]{margin:.5rem}[m~=y-4]{margin-top:1rem;margin-bottom:1rem}.my-1{margin-top:.25rem;margin-bottom:.25rem}[m~=x-1]{margin-left:.25rem;margin-right:.25rem}[mx~="\32 "]{margin-left:.5rem;margin-right:.5rem}[m~=y-2]{margin-top:.5rem;margin-bottom:.5rem}[m~=l-1]{margin-left:.25rem}[m~=t-4]{margin-top:1rem}[mt-6=""],[m~=t-6]{margin-top:1.5rem}[m~=b-2]{margin-bottom:.5rem}[m~=l-4]{margin-left:1rem}[m~=r-1]{margin-right:.25rem}.block{display:block}.inline-block{display:inline-block}[h~="\38 "]{height:2rem}[w~="\38 "]{width:2rem}[w~=full]{width:100%}.flex,[flex~="\~"]{display:flex}.inline-flex{display:inline-flex}.flex-grow,[flex~=grow]{flex-grow:1}.flex-col,[flex~=col]{flex-direction:column}.rotate-y-180{--un-rotate:0;--un-rotate-y:180deg;transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}.transform{transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}.items-center{align-items:center}.justify-center{justify-content:center}.justify-around{justify-content:space-around}.gap-2{grid-gap:.5rem;gap:.5rem}[overflow~=auto]{overflow:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded-full{border-radius:9999px}[fill~=none]{fill:none}[stroke-width~="\32 "]{stroke-width:2px}.p-4{padding:1rem}[p~="\31 "]{padding:.25rem}[p~="\32 "]{padding:.5rem}[p~=x-4]{padding-left:1rem;padding-right:1rem}[py~="\31 "]{padding-top:.25rem;padding-bottom:.25rem}[p~=b-8]{padding-bottom:2rem}[p~=l-4]{padding-left:1rem}[text~=center]{text-align:center}[text~="\32 xl"]{font-size:1.5rem;line-height:2rem}[text-xl=""]{font-size:1.25rem;line-height:1.75rem}[text~=xs]{font-size:.75rem;line-height:1rem}[text~=sm]{font-size:.875rem;line-height:1.25rem}[font~=black]{font-weight:900}.text-\$va-c-text-light{color:var(--va-c-text-light)}[text~=red-400]{--un-text-opacity:1;color:rgba(248,113,113,var(--un-text-opacity))}[opacity~="\37 5"]{opacity:.75}.hover\:shadow-md:hover{--un-shadow:var(--un-shadow-inset) 0 4px 6px -1px var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 2px 4px -2px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.shadow{--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms}[font~=serif]{font-family:var(--va-font-serif)}@media (max-width:767.9px){.lt-md\:ml-0{margin-left:0}[p~="lt-md\:0"]{padding:0}}@media (min-width:640px){.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}}@media (min-width:768px){.md\:hidden{display:none}.md\:translate-x-0{--un-translate-x:0rem;transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}}@media (min-width:1024px){.lg\:px-12{padding-left:3rem;padding-right:3rem}}@media (min-width:1280px){.xl\:hidden{display:none}.xl\:px-16{padding-left:4rem;padding-right:4rem}}.post-copyright{font-size:.9rem;padding:.5rem 1rem;border-left:4px solid #ff5252;background-color:var(--va-c-bg-dark);list-style:none;word-break:break-all;position:relative;overflow:hidden}.post-copyright:after{pointer-events:none;position:absolute;color:#fff;background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'%3E%3Cpath fill='gray' d='M245.8 214.9l-33.2 17.3c-9.4-19.6-25.2-20-27.4-20-22.2 0-33.3 14.6-33.3 43.9 0 23.5 9.2 43.8 33.3 43.8 14.4 0 24.6-7 30.5-21.3l30.6 15.5a73.2 73.2 0 01-65.1 39c-22.6 0-74-10.3-74-77 0-58.7 43-77 72.6-77 30.8-.1 52.7 11.9 66 35.8zm143 0l-32.7 17.3c-9.5-19.8-25.7-20-27.9-20-22.1 0-33.2 14.6-33.2 43.9 0 23.5 9.2 43.8 33.2 43.8 14.5 0 24.7-7 30.5-21.3l31 15.5c-2 3.8-21.3 39-65 39-22.7 0-74-9.9-74-77 0-58.7 43-77 72.6-77C354 179 376 191 389 214.8zM247.7 8C104.7 8 0 123 0 256c0 138.4 113.6 248 247.6 248C377.5 504 496 403 496 256 496 118 389.4 8 247.6 8zm.8 450.8c-112.5 0-203.7-93-203.7-202.8 0-105.5 85.5-203.3 203.8-203.3A201.7 201.7 0 01451.3 256c0 121.7-99.7 202.9-202.9 202.9z'/%3E%3C/svg%3E");content:" ";height:10rem;width:10rem;right:-2rem;top:-2rem;opacity:.1}.sponsor-button{background-color:#ffffff1a}.sponsor-button div{transform:scale(1.1);transition:transform var(--va-transition-duration) ease-in-out}.sponsor-button:hover{background-color:#ffffffe6}.sponsor-button:hover div{transform:scale(1.2)}.qrcode-container{overflow:hidden;height:0;transition:height var(--va-transition-duration) ease-in-out}.va-toc[data-v-f0c1ef64]{text-align:left}.content[data-v-f0c1ef64]{position:relative;padding-left:16px;font-size:14px;text-align:left}.outline-marker[data-v-f0c1ef64]{position:absolute;top:32px;left:-2px;z-index:0;opacity:0;width:4px;height:18px;background-color:var(--va-c-brand);transition:top .25s cubic-bezier(0,1,.5,1),background-color .5s,opacity .25s;border-top-right-radius:2px;border-bottom-right-radius:2px}.outline-title[data-v-f0c1ef64]{letter-spacing:.4px;line-height:28px;font-size:14px;font-weight:600}.visually-hidden[data-v-f0c1ef64]{position:absolute;width:1px;height:1px;white-space:nowrap;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden}.aside{position:fixed;right:0;top:0;bottom:0;width:var(--va-sidebar-width,300px);transform:translate(100%);transition:box-shadow var(--va-transition-duration),background-color var(--va-transition-duration),opacity .25s,transform var(--va-transition-duration) cubic-bezier(.19,1,.22,1)}.aside-container{position:sticky;top:0;height:100vh}@media screen and (min-width:1280px){.aside{transform:translate(0)}}.toc-btn{color:var(--va-c-primary);background-color:#fff;z-index:var(--yun-z-toc-btn)}.post-nav{display:flex;justify-content:space-between;align-items:center}.post-nav-item{display:inline-flex;justify-content:center;align-items:center;color:var(--va-c-primary);outline:0;font-size:1.5rem;font-weight:700;text-transform:uppercase;height:3rem;transition:.4s}.post-nav-item:hover{background-color:rgba(var(--va-c-primary-rgb),.1);box-shadow:0 0 15px #0000001a}.post-nav-prev{padding:0 .6rem 0 .1rem}.post-nav-next{padding:0 .1rem 0 .6rem}.post-nav-next,.post-nav-prev{display:inline-flex;align-items:center;height:3rem;font-size:1rem}.post-nav-next .title,.post-nav-prev .title{overflow:hidden;max-width:10rem}.post-nav-next .icon,.post-nav-prev .icon{width:1.2rem;height:1.2rem}@media screen and (min-width:1024px){.post-nav-next .title,.post-nav-prev .title{max-width:18rem}}@media screen and (min-width:1280px){.content{max-width:calc(100vw - 2 * var(--va-sidebar-width) - 1rem - 8px)}}</style><link rel="preload" href="/assets/index-4070d21c.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/post-f950f327.js"><link rel="preload" href="/assets/post-1d1be697.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/Docker_K8så®è·µæŒ‡å—-36130389.js"><link rel="modulepreload" crossorigin="" href="/assets/ValaxyMain.vue_vue_type_style_index_0_lang-f9369a8c.js"><link rel="preload" href="/assets/ValaxyMain-5904cb61.css" as="style"><title>Docker+K8så®è·µæŒ‡å— - Valaxy Blog</title><link rel="icon" href="/favicon.svg" type="image/svg+xml"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#ffffff"><meta name="generator" content="Valaxy 0.14.0"><meta name="description" content="A blog generated by Valaxy."><meta property="og:description" content="A blog generated by Valaxy."><meta property="og:locale" content="en"><meta property="og:site:name" content="Valaxy Blog"><meta property="og:title" content="Docker+K8så®è·µæŒ‡å—"><meta property="og:image" content="/favicon.svg"><meta property="og:url" content="/"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_AMS-Regular-0cdd387c.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Bold-de7701e4.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Regular-5d53e70a.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Bold-74444efd.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Regular-51814d27.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Bold-0f60d1b8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-BoldItalic-99cd42a3.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Italic-97479ca6.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Regular-c2342cd8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-BoldItalic-dc47344d.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-Italic-7af58c5e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Bold-e99ae511.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Italic-00b26ac8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Regular-68e8c73e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Script-Regular-036d4e95.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size1-Regular-6b47c401.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size2-Regular-d04c5421.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="data:font/woff2;base64,d09GMgABAAAAAA4oAA4AAAAAHbQAAA3TAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgRQIDgmcDBEICo1oijYBNgIkA14LMgAEIAWJAAeBHAyBHBvbGiMRdnO0IkRRkiYDgr9KsJ1NUAf2kILNxgUmgqIgq1P89vcbIcmsQbRps3vCcXdYOKSWEPEKgZgQkprQQsxIXUgq0DqpGKmIvrgkeVGtEQD9DzAO29fM9jYhxZEsL2FeURH2JN4MIcTdO049NCVdxQ/w9NrSYFEBKTDKpLKfNkCGDc1RwjZLQcm3vqJ2UW9Xfa3tgAHz6ivp6vgC2yD4/6352ndnN0X0TL7seypkjZlMsjmZnf0Mm5Q+JykRWQBKCVCVPbARPXWyQtb5VgLB6Biq7/Uixcj2WGqdI8tGSgkuRG+t910GKP2D7AQH0DB9FMDW/obJZ8giFI3Wg8Cvevz0M+5m0rTh7XDBlvo9Y4vm13EXmfttwI4mBo1EG15fxJhUiCLbiiyCf/ZA6MFAhg3pGIZGdGIVjtPn6UcMk9A/UUr9PhoNsCENw1APAq0gpH73e+M+0ueyHbabc3vkbcdtzcf/fiy+NxQEjf9ud/ELBHAXJ0nk4z+MXH2Ev/kWyV4k7SkvpPc9Qr38F6RPWnM9cN6DJ0AdD1BhtgABtmoRoFCvPsBAumNm6soZG2Gk5GyVTo2sJncSyp0jQTYoR6WDvTwaaEcHsxHfvuWhHA3a6bN7twRKtcGok6NsCi7jYRrM2jExsUFMxMQYuJbMhuWNOumEJy9hi29Dmg5zMp/A5+hhPG19j1vBrq8JTLr8ki5VLPmG/PynJHVul440bxg5xuymHUFPBshC+nA9I1FmwbRBTNHAcik3Oae0cxKoI3MOriM42UrPe51nsaGxJ+WfXubAsP84aabUlQSJ1IiE0iPETLUU4CATgfXSCSpuRFRmCGbO+wSpAnzaeaCYW1VNEysRtuXCEL1kUFUbbtMv3Tilt/1c11jt3Q5bbMa84cpWipp8Elw3MZhOHsOlwwVUQM3lAR35JiFQbaYCRnMF2lxAWoOg2gyoIV4PouX8HytNIfLhqpJtXB4vjiViUI8IJ7bkC4ikkQvKksnOTKICwnqWSZ9YS5f0WCxmpgjbIq7EJcM4aI2nmhLNY2JIUgOjXZFWBHb+x5oh6cwb0Tv1ackHdKi0I9OO2wE9aogIOn540CCCziyhN+IaejtgAONKznHlHyutPrHGwCx9S6B8kfS4Mfi4Eyv7OU730bT1SCBjt834cXsf43zVjPUqqJjgrjeGnBxSG4aYAKFuVbeCfkDIjAqMb6yLNIbCuvXhMH2/+k2vkNpkORhR59N1CkzoOENvneIosjYmuTxlhUzaGEJQ/iWqx4dmwpmKjrwTiTGTCVozNAYqk/zXOndWxuWSmJkQpJw3pK5KX6QrLt5LATMqpmPAQhkhK6PUjzHUn7E0gHE0kPE0iKkolgkUx9SZmVAdDgpffdyJKg3k7VmzYGCwVXGz/tXmkOIp+vcWs+EMuhhvN0h9uhfzWJziBQmCREGSIFmQIkgVpAnSBRmC//6hkLZwaVhwxlrJSOdqlFtOYxlau9F2QN5Y98xmIAsiM1HVp2VFX+DHHGg6Ecjh3vmqtidX3qHI2qycTk/iwxSt5UzTmEP92ZBnEWTk4Mx8Mpl78ZDokxg/KWb+Q0QkvdKVmq3TMW+RXEgrsziSAfNXFMhDc60N5N9jQzjfO0kBKpUZl0ZmwJ41j/B9Hz6wmRaJB84niNmQrzp9eSlQCDDzazGDdVi3P36VZQ+Jy4f9UBNp+3zTjqI4abaFAm+GShVaXlsGdF3FYzZcDI6cori4kMxUECl9IjJZpzkvitAoxKue+90pDMvcKRxLl53TmOKCmV/xRolNKSqqUxc6LStOETmFOiLZZptlZepcKiAzteG8PEdpnQpbOMNcMsR4RR2Bs0cKFEvSmIjAFcnarqwUL4lDhHmnVkwu1IwshbiCcgvOheZuYyOteufZZwlcTlLgnZ3o/WcYdzZHW/WGaqaVfmTZ1aWCceJjkbZqsfbkOtcFlUZM/jy+hXHDbaUobWqqXaeWobbLO99yG5N3U4wxco0rQGGcOLASFMXeJoham8M+/x6O2WywK2l4HGbq1CoUyC/IZikQhdq3SiuNrvAEj0AVu9x2x3lp/xWzahaxidezFVtdcb5uEnzyl0ZmYiuKI0exvCd4Xc9CV1KB0db00z92wDPde0kukbvZIWN6jUWFTmPIC/Y4UPCm8UfDTFZpZNon1qLFTkBhxzB+FjQRA2Q/YRJT8pQigslMaUpFyAG8TMlXigiqmAZX4xgijKjRlGpLE0GdplRfCaJo0JQaSxNBk6ZmMzcya0FmrcisDdn0Q3HI2sWSppYigmlM1XT/kLQZSNpMJG0WkjYbSZuDpM1F0uYhFc1HxU4m1QJjDK6iL0S5uSj5rgXc3RejEigtcRBtqYPQsiTskmO5vosV+q4VGIKbOkDg0jtRrq+Em1YloaTFar3EGr1EUC8R0kus1Uus00usL97ABr2BjXoDm/QGNhuWtMVBKOwg/i78lT7hBsAvDmwHc/ao3vmUbBmhjeYySZNWvGkfZAgISDSaDo1SVpzGDsAEkF8B+gEapViUoZgUWXcRIGFZNm6gWbAKk0bp0k1MHG9fLYtV4iS2SmLEQFARzRcnf9PUS0LVn05/J9MiRRBU3v2IrvW974v4N00L7ZMk0wXP1409CHo/an8zTRHD3eSJ6m8D4YMkZNl3M79sqeuAsr/m3f+8/yl7A50aiAEJgeBeMWzu7ui9UfUBCe2TIqZIoOd/3/udRBOQidQZUERzb2/VwZN1H/Sju82ew2H2Wfr6qvfVf3hqwDvAIpkQVFy4B9Pe9e4/XvPeceu7h3dvO56iJPf0+A6cqA2ip18ER+iFgggiuOkvj24bby0N9j2UHIkgqIt+sVgfodC4YghLSMjSZbH0VR/6dMDrYJeKHilKTemt6v6kvzvn3/RrdWtr0GoN/xL+Sex/cPYLUpepx9cz/D46UPU5KXgAQa+NDps1v6J3xP1i2HtaDB0M9aX2deA7SYff//+gUCovMmIK/qfsFcOk+4Y5ZN97XlG6zebqtMbKgeRFi51vnxTQYBUik2rS/Cn6PC8ADR8FGxsRPB82dzfND90gIcshOcYUkfjherBz53odpm6TP8txlwOZ71xmfHHOvq053qFF/MRlS3jP0ELudrf2OeN8DHvp6ZceLe8qKYvWz/7yp0u4dKPfli3CYq0O13Ih71mylJ80tOi10On8wi+F4+LWgDPeJ30msSQt9/vkmHq9/Lvo2b461mP801v3W4xTcs6CbvF9UDdrSt+A8OUbpSh55qAUFXWznBBfdeJ8a4d7ugT5tvxUza3h9m4H7ptTqiG4z0g5dc0X29OcGlhpGFMpQo9ytTS+NViZpNdvU4kWx+LKxNY10kQ1yqGXrhe4/1nvP7E+nd5A92TtaRplbHSqoIdOqtRWti+fkB5/n1+/VvCmz12pG1kpQWsfi1ftlBobm0bpngs16CHkbIwdLnParxtTV3QYRlfJ0KFskH7pdN/YDn+yRuSd7sNH3aO0DYPggk6uWuXrfOc+fa3VTxFVvKaNxHsiHmsXyCLIE5yuOeN3/Jdf8HBL/5M6shjyhxHx9BjB1O0+4NLOnjLLSxwO7ukN4jMbOIcD879KLSi6Pk61Oqm2377n8079PXEEQ7cy7OKEC9nbpet118fxweTafpt69x/Bt8UqGzNQt7aelpc44dn5cqhwf71+qKp/Zf/+a0zcizOUWpl/iBcSXip0pplkatCchoH5c5aUM8I7/dWxAej8WicPL1URFZ9BDJelUwEwTkGqUhgSlydVes95YdXvhh9Gfz/aeFWvgVb4tuLbcv4+wLdutVZv/cUonwBD/6eDlE0aSiKK/uoH3+J1wDE/jMVqY2ysGufN84oIXB0sPzy8ollX/LegY74DgJXJR57sn+VGza0x3DnuIgABFM15LmajjjsNlYj+JEZGbuRYcAMOWxFkPN2w6Wd46xo4gVWQR/X4lyI/R6K/YK0110GzudPRW7Y+UOBGTfNNzHeYT0fiH0taunBpq9HEW8OKSaBGj21L0MqenEmNRWBAWDWAk4CpNoEZJ2tTaPFgbQYj8HxtFilErs3BTRwT8uO1NXQaWfIotchmPkAF5mMBAliEmZiOGVgCG9LgRzpscMAOOwowlT3JhusdazXGSC/hxR3UlmWVwWHpOIKheqONvjyhSiTHIkVUco5bnji8m//zL7PKaT1Vl5I6UE609f+gkr6MZKVyKc7zJRmCahLsdlyA5fdQkRSan9LgnnLEyGSkaKJCJog0wAgvepWBt80+1yKln1bMVtCljfNWDueKLsWwaEbBSfSPTEmVRsUcYYMnEjcjeyCZzBXK9E9BYBXLKjOSpUDR+nEV3TFSUdQaz+ot98QxgXwx0GQ+EEUAKB2qZPkQQ0GqFD8UPFMqyaCHM24BZmSGic9EYMagKizOw9Hz50DMrDLrqqLkTAhplMictiCAx5S3BIUQdeJeLnBy2CNtMfz6cV4u8XKoFZQesbf9YZiIERiHjaNodDW6LgcirX/mPnJIkBGDUpTBhSa0EIr38D5hCIszhCM8URGBqImoWjpvpt1ebu/v3Gl3qJfMnNM+9V+kiRFyROTPHQWOcs1dNW94/ukKMPZBvDi55i5CttdeJz84DLngLqjcdwEZ87bFFR8CIG35OAkDVN6VRDZ7aq67NteYqZ2lpT8oYB2CytoBd6VuAx4WgiAsnuj3WohG+LugzXiQRDeM3XYXlULv4dp5VFYC"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size4-Regular-a4af7d41.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Typewriter-Regular-71d517d6.woff2"></head><body><div id="app" data-server-rendered="true"><!--[--><!--[--><!--[--><div class="va-bg"></div><!--]--><!----><!--]--><!--[--><!--]--><!----><!--[--><!--[--><!----><button type="button" class="vt-hamburger menu-btn sidebar-toggle yun-icon-btn md:hidden" aria-label="mobile navigation" aria-expanded="false"><span class="vt-hamburger-container"><span class="vt-hamburger-top"></span><span class="vt-hamburger-middle"></span><span class="vt-hamburger-bottom"></span></span></button><aside class="md:translate-x-0 va-card transition sidebar"><!--[--><!--[--><!--[--><!----><div class=""><!--[--><div class="sidebar-panel"><div class="site-info" m="t-6"><a href="/about" class="site-author-avatar"><img class="rounded-full" src="https://www.yunyoujun.cn/images/avatar.jpg" alt="avatar"><span class="site-author-status">ğŸŒŒ</span></a><div class="site-author-name"><a href="/about" class="">VALAXY Developer</a></div><a href="/about/site" class="site-name">Valaxy Blog</a><h4 class="site-subtitle block" text="xs">Next Generation Static Blog Framework.</h4><div class="site-description my-1">A blog generated by Valaxy.</div></div><nav class="site-nav" text-xl="" mt-6=""><a href="/" class="site-link-item yun-icon-btn" title="Home"><div i-ri-home-4-line=""></div></a><a href="/archives/" class="site-link-item" title="Archives"><div class="icon" i-ri-archive-line=""></div><span class="count">85</span></a><a href="/categories/" class="site-link-item" title="Categories"><div class="icon" i-ri-folder-2-line=""></div><span class="count">16</span></a><a href="/tags/" class="site-link-item" title="Tags"><div class="icon" i-ri-price-tag-3-line=""></div><span class="count">118</span></a><a class="site-link-item yun-icon-btn" showexternalicon="false" title="About"><!--[--><div class="i-ri-clipboard-line"></div><!--]--></a></nav><hr m="t-4 b-2"><div class="links-of-author"><!--[--><!--]--></div><hr m="y-2"><div class="links"><!--[--><a class="link-item yun-icon-btn" showexternalicon="false" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:#1e90ff"><!--[--><div class="i-ri-genderless-line icon"></div><!--]--></a><a class="link-item yun-icon-btn" showexternalicon="false" title="æˆ‘çš„å°è´¦å•" style="color:gold"><!--[--><div class="i-ri-money-cny-circle-line icon"></div><!--]--></a><a class="link-item yun-icon-btn" showexternalicon="false" title="å–œæ¬¢çš„å¥³å­©å­" style="color:#ff69b4"><!--[--><div class="i-ri-women-line icon"></div><!--]--></a><!--]--></div><br></div><div><button class="yun-icon-btn" title="Switch to dark mode" style="color:#f1cb64"><div i="ri-sun-line dark:ri-moon-line"></div></button><button class="yun-icon-btn" title="Change languages" style="color:var(--va-c-text)"><div i-ri-translate="" class="rotate-y-180 transition transform"></div></button></div><!--]--></div><!--]--><!--]--><!--]--></aside><!--]--><main class="yun-main lt-md:ml-0" flex="~"><div w="full" flex="~"><!--[--><div class="content" flex="~ col grow" w="full" p="l-4 lt-md:0"><div class="yun-card relative" m="0" style=""><!----><!----><!--[--><!--[--><header class="post-header" m="t-4"><h1 class="post-title" p="2" text="2xl center" font="serif black" style=""><!----><span>Docker+K8så®è·µæŒ‡å—</span></h1></header><!--]--><!--[--><!--[--><!--[--><!--[--><!----><!----><!----><div class="post-meta justify-center" flex="~" text="sm" py="1"><div class="post-time flex items-center"><span class="inline-flex-center" title="Posted on"><div class="inline-block" i-ri-calendar-line=""></div><time m="l-1">2020-02-28</time></span><!----></div></div><!--[--><!--]--><!--]--><div flex="~" text="sm" py="1"><!----><!----></div><div class="inline-flex" text="sm" py="1"><a href="/categories/?category=DevOps" class="post-categories inline-flex justify-center items-center"><div m="x-1" i-ri-folder-2-line=""></div>DevOps</a><span mx="2">-</span><!--[--><a href="/tags/?tag=Prometheus" class="post-tag inline-flex-center" m="x-1"><div m="r-1" i-ri-price-tag-3-line=""></div>Prometheus</a><a href="/tags/?tag=Kubernetes" class="post-tag inline-flex-center" m="x-1"><div m="r-1" i-ri-price-tag-3-line=""></div>Kubernetes</a><!--]--></div><!--]--><!--]--><!--]--><div p="x-4 b-8" class="sm:px-6 lg:px-12 xl:px-16" w="full"><!--[--><article class="markdown-body"><!--[--><!--[--><h2 id="å†™åœ¨å‰é¢çš„è¯" tabindex="-1">å†™åœ¨å‰é¢çš„è¯ <a aria-current="page" href="#å†™åœ¨å‰é¢çš„è¯" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä¸å¾—ä¸æ‰¿è®¤ä¸­å›½çš„ITè¡Œä¸šå·²ç»è¿›å…¥äº†äº‘è®¡ç®—æ—¶ä»£ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå¼€å§‹ä½¿ç”¨å¼¹æ€§çš„äº‘æœåŠ¡æ¥æ”¯æ’‘è‡ªå·±çš„ä¸šåŠ¡ã€‚äº‘è®¡ç®—æ˜¯æœºé‡ä¹Ÿæ˜¯æŒ‘æˆ˜ï¼Œä½œä¸ºè¿ç»´äººå‘˜éœ€è¦é¢ä¸´äº‘è®¡ç®—æ—¶ä»£ä¼ä¸šå¯¹è¿ç»´éœ€æ±‚çš„èç¼©ï¼Œä»¥åŠå¯¹è¿ç»´æŠ€æœ¯èƒ½åŠ›è¦æ±‚çš„å¤§å¹…åº¦æé«˜çš„å›°å¢ƒã€‚</p><p>å¦‚æœè¯´äº‘è®¡ç®—å¯¹è¿ç»´è¡Œä¸šçš„å½±å“æ˜¯ç¬¬ä¸€æ³¢æµªæ½®ï¼Œé‚£æˆ‘è®¤ä¸ºå®¹å™¨æŠ€æœ¯çš„å‘å±•å¯¹æœ¬è¡Œä¸šçš„å½±å“ç®—æ˜¯ç¬¬äºŒæ³¢æµªæ½®ï¼Œç›®å‰å‡ ä¹æ‰€æœ‰çš„ä¼ä¸šæ‹›è˜è¿ç»´å·¥ç¨‹å¸ˆéƒ½è¦æ±‚ç†Ÿæ‚‰KVMã€OpenStackã€Dockerå’ŒKubernetesæŠ€æœ¯ï¼Œå„å¤§å…¬æœ‰äº‘å¹³å°ä¹Ÿéƒ½ä¸Šçº¿äº†å®¹å™¨æœåŠ¡Kubernetesç‰ˆï¼ˆAWSã€Azureï¼ˆå…¨çƒç‰ˆï¼‰é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€Ucloudã€äº¬ä¸œäº‘ã€å¤©ç¿¼äº‘ï¼ˆå…¬æµ‹é˜¶æ®µï¼‰ç­‰ï¼‰ï¼ŒæŒæ¡è¿™äº›æŠ€æœ¯å·²ç»æ˜¯å¤§åŠ¿æ‰€éœ€ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®" tabindex="-1">å‚è€ƒæ–‡çŒ® <a aria-current="page" href="#å‚è€ƒæ–‡çŒ®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><ul><li>Dockerå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://docs.docker.com/<!--]--></a></li><li>Kuberneteså®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/docs/home/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://kubernetes.io/docs/home/<!--]--></a></li><li>OpenStackå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.openstack.org/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://docs.openstack.org/<!--]--></a></li><li>Prometheuså®˜æ–¹æ–‡æ¡£ï¼š<a href="https://prometheus.io/docs/introduction/overview/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://prometheus.io/docs/introduction/overview/<!--]--></a></li></ul><h1 id="å®éªŒç¯å¢ƒ" tabindex="-1">å®éªŒç¯å¢ƒ <a aria-current="page" href="#å®éªŒç¯å¢ƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p><strong>ç¡¬ä»¶è®¾å¤‡å‡†å¤‡</strong></p><ul><li>ç”µè„‘ä¸€å°ï¼ŒCPUæ”¯æŒVTï¼Œå†…å­˜&gt;4Gï¼Œå¯ç”¨ç£ç›˜ç©ºé—´å¤§äº80Gã€‚</li><li>å®‰è£…VMware Workstation Proè™šæ‹Ÿæœºè½¯ä»¶ï¼Œç”¨äºåˆ›å»ºè™šæ‹Ÿæœºã€‚</li><li>åˆ›å»ºä¸‰å°è™šæ‹Ÿæœºï¼Œå®‰è£…CentOS-7.7-x86_64ç³»ç»Ÿã€‚</li></ul><p><strong>å®éªŒç¯å¢ƒè¯¦æƒ…</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>IPåœ°å€ï¼ˆNATï¼‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="http://linux-node1.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node1.linuxhot.com<!--]--></a></td><td>eth0:192.168.56.11</td><td>1VCPUã€2Gå†…å­˜ã€ä¸€å—ç¡¬ç›˜sda50Gï¼ˆåŠ¨æ€ï¼‰</td></tr><tr><td><a href="http://linux-node2.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node2.linuxhot.com<!--]--></a></td><td>eth0:192.168.56.12</td><td>1VCPUã€2Gå†…å­˜ã€ä¸€å—ç¡¬ç›˜sda50Gï¼ˆåŠ¨æ€ï¼‰</td></tr><tr><td><a href="http://linux-node3.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node3.linuxhot.com<!--]--></a></td><td>eth0:192.168.56.13</td><td>1VCPUã€2Gå†…å­˜ã€ä¸€å—ç¡¬ç›˜sda50Gï¼ˆåŠ¨æ€ï¼‰</td></tr><tr><td>å¤‡æ³¨</td><td>1.å¦‚ä½•åœ¨å®‰è£…çš„æ—¶å€™å°†ç½‘å¡å‘½åä¸ºeth0ã€eth1ï¼Œè¯·å‚è€ƒã€Šé™„å½•ä¸€ã€‹ã€‚ 2.å…¶ä¸­linux-node3åœ¨å­¦ä¹ Kubernetesä¸­ä½¿ç”¨ã€‚</td><td></td></tr></tbody></table><p><strong>ç¯å¢ƒå‡†å¤‡</strong></p><ul><li>å®‰è£…æ“ä½œç³»ç»ŸCentOS-7.7-x86_64ã€‚</li><li>åŸºæœ¬ç³»ç»Ÿï¼š1VCPU+2048Må†…å­˜+50Gï¼ˆåŠ¨æ€ï¼‰ç¡¬ç›˜ã€‚</li><li>ç½‘ç»œé€‰æ‹©ï¼šä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ã€‚</li><li>è½¯ä»¶åŒ…é€‰æ‹©ï¼šMinimal Installã€‚</li><li>å…³é—­iptableså’ŒSELinuxã€‚</li><li>è®¾ç½®æ‰€æœ‰èŠ‚ç‚¹çš„ä¸»æœºåå’ŒIPåœ°å€ï¼ŒåŒæ—¶ä½¿ç”¨å†…éƒ¨DNSæˆ–è€…/etc/hostsåšå¥½ä¸»æœºåè§£æã€‚</li></ul><p><strong>å®éªŒå°æŠ€å·§</strong></p><p>[hide]</p><ul><li>å»ºè®®åˆå­¦è€…ä¿æŒå®éªŒç¯å¢ƒå’Œæœ¬ä¹¦ä¸€è‡´ï¼ŒåŒ…æ‹¬ä½†ä¸å±€é™äºIPåœ°å€ï¼Œä¸»æœºåï¼Œç½‘å¡åç§°ç­‰ï¼Œå¯ä»¥å¸®ä½ èŠ‚çº¦å¾ˆå¤šå› ä¸ºç¯å¢ƒé—®é¢˜çš„æ’é”™æ—¶é—´ã€‚</li><li>åšå¥½è™šæ‹Ÿæœºçš„å¿«ç…§ï¼Œæ¯”å¦‚å¯ä»¥æ ¹æ®æœ¬ä¹¦çš„ä¸åŒç« èŠ‚ï¼Œåˆ›å»ºä¸åŒçš„å¿«ç…§ï¼Œä¾¿äºä¿ç•™å®éªŒç¯å¢ƒå’Œåœ¨å®éªŒè¿‡ç¨‹ä¸­è¿›è¡Œç¯å¢ƒçš„å›æ»šã€‚</li><li>è¯·ä¸è¦æŠŠå…³æ³¨ç‚¹ä»…ä»…æ”¾åœ¨å®éªŒç¯èŠ‚ï¼Œä¸€å®šè¦åœ¨ç†è§£çš„åŸºç¡€ä¸Šå®Œæˆå®éªŒï¼Œå¯¹äºä¸æ˜ç™½çš„åœ°æ–¹éœ€è¦åå¤é˜…è¯»ï¼Œæˆ–è€…æ ¹æ®æœ¬ä¹¦å‰è¨€æåˆ°çš„é€”å¾„è·å–æŠ€æœ¯æ”¯æŒã€‚ [/hide]</li></ul><h1 id="é™„å½•ä¸€-å®éªŒç¯å¢ƒå‡†å¤‡" tabindex="-1">é™„å½•ä¸€ å®éªŒç¯å¢ƒå‡†å¤‡ <a aria-current="page" href="#é™„å½•ä¸€-å®éªŒç¯å¢ƒå‡†å¤‡" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p><strong>ç¯å¢ƒå‡†å¤‡æ¡ˆä¾‹ï¼š</strong></p><p>**ç•Œé¢ä½ç½®ï¼š**æ–‡ä»¶æ–°å»ºè™šæ‹Ÿæœºï¼Œæ‰“å¼€æ–°å»ºè™šæ‹Ÿæœºé€‰é¡¹ï¼Œ</p><p><strong>åˆ›å»ºè™šæ‹Ÿæœº</strong>ï¼šè¯·å‚è€ƒç›®å½•å‰å®éªŒç¯å¢ƒç« èŠ‚ï¼ŒæŒ‰è¦æ±‚åˆ›å»ºè™šæ‹Ÿæœºï¼ˆåˆ›å»ºæ­¥éª¤ç•¥ï¼‰ã€‚</p><p><strong>æ“ä½œç³»ç»Ÿå®‰è£…ï¼š</strong></p><p>ä¸ºäº†ç»Ÿä¸€ç¯å¢ƒï¼Œä¿è¯å®éªŒçš„é€šç”¨æ€§ï¼Œå°†ç½‘å¡åç§°è®¾ç½®ä¸ºeth*ï¼Œä¸ä½¿ç”¨CentOS 7é»˜è®¤çš„ç½‘å¡å‘½åè§„åˆ™ã€‚æ‰€ä»¥éœ€è¦åœ¨å®‰è£…çš„æ—¶å€™ï¼Œå¢åŠ å†…æ ¸å‚æ•°ã€‚</p><p>1)å…‰æ ‡é€‰æ‹©â€œInstall CentOS 7â€</p><p><img src="http://k8s.unixhot.com/media/c4bb194b0f60ef7a32a7a4a269b31094.png" alt="img"></p><p>2)ç‚¹å‡»Tabï¼Œæ‰“å¼€kernelå¯åŠ¨é€‰é¡¹åï¼Œå¢åŠ net.ifnames=0 biosdevname=0ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="http://k8s.unixhot.com/media/40432332febddc210781b55066a87252.png" alt="img"></p><p><strong>å®‰è£…å®Œæ¯•åè®¾ç½®ï¼š</strong></p><p>1.è®¾ç½®ç½‘ç»œã€‚</p><p>å¦‚æœä½ çš„é»˜è®¤NATåœ°å€æ®µä¸æ˜¯192.168.56.0/24å¯ä»¥ä¿®æ”¹VMware Workstationçš„é…ç½®ï¼Œç‚¹å‡»ç¼–è¾‘è™šæ‹Ÿç½‘ç»œé…ç½®ï¼Œç„¶åè¿›è¡Œé…ç½®ã€‚</p><p><img src="http://k8s.unixhot.com/media/b4ac2c94cc558e1150c8cc77ecd6ad13.png" alt="img"></p><p>2.è®¾ç½®IPåœ°å€ï¼Œè¯·é…ç½®é™æ€IPåœ°å€ã€‚æ³¨æ„å°†UUIDå’ŒMACåœ°å€åˆ é™¤æ‰ï¼Œä¾¿äºè¿›è¡Œè™šæ‹Ÿæœºå…‹éš†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0</span></span>
<span class="line"><span style="color:#a6accd">TYPE=Ethernet</span></span>
<span class="line"><span style="color:#a6accd">BOOTPROTO=static</span></span>
<span class="line"><span style="color:#a6accd">DEFROUTE=yes</span></span>
<span class="line"><span style="color:#a6accd">PEERDNS=no</span></span>
<span class="line"><span style="color:#a6accd">PEERROUTES=yes</span></span>
<span class="line"><span style="color:#a6accd">IPV4_FAILURE_FATAL=no</span></span>
<span class="line"><span style="color:#a6accd">NAME=eth0</span></span>
<span class="line"><span style="color:#a6accd">DEVICE=eth0</span></span>
<span class="line"><span style="color:#a6accd">ONBOOT=yes</span></span>
<span class="line"><span style="color:#a6accd">IPADDR=192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">NETMASK=255.255.255.0</span></span>
<span class="line"><span style="color:#a6accd">GATEWAY=192.168.56.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é‡å¯ç½‘ç»œæœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# systemctl restart network</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.å…³é—­NetworkManagerå’Œé˜²ç«å¢™å¼€å¯è‡ªå¯åŠ¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl disable firewalld</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl disable NetworkManager</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4.è®¾ç½®ä¸»æœºå</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vi /etc/hostname</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>5.è®¾ç½®ä¸»æœºåè§£æ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat /etc/hosts</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#a6accd">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 linux-node1 linux-node1.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.12 linux-node2 linux-node2.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.13 linux-node3 linux-node3.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>6.è®¾ç½®DNSè§£æ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vi /etc/resolv.conf</span></span>
<span class="line"><span style="color:#a6accd">nameserver 192.168.56.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>7.å®‰è£…EPELä»“åº“å’Œå¸¸ç”¨å‘½ä»¤</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y net-tools vim lrzsz tree screen lsof tcpdump nc mtr nmap</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>8.å…³é—­å¹¶ç¡®è®¤SELinuxå¤„äºå…³é—­çŠ¶æ€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/selinux</span></span>
<span class="line"><span style="color:#a6accd">SELINUX=disabled #ä¿®æ”¹ä¸ºdisabled</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>9.æ›´æ–°ç³»ç»Ÿå¹¶é‡å¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum update -y &amp;&amp; reboot</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>10.å…‹éš†è™šæ‹Ÿæœº</p><p>è¯·å…³é—­è™šæ‹Ÿæœºï¼Œå¹¶å…‹éš†å½“å‰è™šæ‹Ÿæœºlinux-node1åˆ°linux-node2ï¼Œå»ºè®®é€‰æ‹©â€œåˆ›å»ºå®Œæ•´å…‹éš†â€ï¼Œè€Œä¸æ˜¯â€œåˆ›å»ºé“¾æ¥å…‹éš†â€ã€‚å…‹éš†å®Œæ¯•åè¯·ç»™linux-node2è®¾ç½®æ­£ç¡®çš„IPåœ°å€å’Œä¸»æœºåã€‚</p><p>11.ç»™è™šæ‹Ÿæœºåšå¿«ç…§</p><p>åˆ†åˆ«ç»™ä¸¤å°è™šæ‹Ÿæœºåšå¿«ç…§ã€‚ä»¥ä¾¿äºéšæ—¶å›åˆ°ä¸€ä¸ªåˆšåˆå§‹åŒ–å®Œæ¯•çš„ç³»ç»Ÿä¸­ã€‚å¯ä»¥æœ‰æ•ˆçš„å‡å°‘å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¯å¢ƒå‡†å¤‡æ—¶é—´ã€‚</p><h1 id="ç¬¬ä¸€éƒ¨åˆ†-cobblerè‡ªåŠ¨åŒ–å®‰è£…å®è·µ" tabindex="-1">ç¬¬ä¸€éƒ¨åˆ† Cobblerè‡ªåŠ¨åŒ–å®‰è£…å®è·µ <a aria-current="page" href="#ç¬¬ä¸€éƒ¨åˆ†-cobblerè‡ªåŠ¨åŒ–å®‰è£…å®è·µ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_1-è‡ªåŠ¨åŒ–å®‰è£…æ¦‚è¿°" tabindex="-1">1 è‡ªåŠ¨åŒ–å®‰è£…æ¦‚è¿° <a aria-current="page" href="#_1-è‡ªåŠ¨åŒ–å®‰è£…æ¦‚è¿°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>å¯¹äºè¿ç»´å·¥ç¨‹å¸ˆæ¥è¯´ï¼ŒæœåŠ¡å™¨ä¸Šæ¶å’Œæ“ä½œç³»ç»Ÿçš„å®‰è£…ï¼Œæ˜¯å®æ–½è¿ç»´å·¥ä½œçš„å¼€å§‹ã€‚å¯¹äºè‡ªåŠ¨åŒ–è¿ç»´æ¥è¯´ï¼Œè‡ªåŠ¨åŒ–å®‰è£…æ˜¯å®æ–½è‡ªåŠ¨åŒ–è¿ç»´çš„ç¬¬ä¸€æ­¥ã€‚é¢å¯¹å¤§é‡çš„æœåŠ¡å™¨è®¾å¤‡ï¼Œæˆ‘ä»¬éœ€è¦æŒæ¡å¦‚ä½•å¿«é€Ÿï¼Œå¹¶ä¸”è‡ªåŠ¨çš„å°†æ–°ä¸Šæ¶çš„æœåŠ¡å™¨å®‰è£…ä¸Šå¯¹åº”çš„æ“ä½œç³»ç»Ÿã€æˆ–è€…ç»™å·²ç»åœ¨è¿è¡Œçš„æœåŠ¡å™¨é‡æ–°å®‰è£…ç³»ç»Ÿã€‚è€Œä¸”å¾ˆé‡è¦çš„æ˜¯ï¼Œä»ç¬¬ä¸€æ­¥å¼€å§‹ï¼Œæˆ‘ä»¬å°±è¦åˆ›å»ºè‡ªå·±å†…éƒ¨çš„è½¯ä»¶ä»“åº“ï¼Œè€Œè¿™ä¸€åˆ‡çš„å·¥ä½œï¼ŒCobbleréƒ½å¯ä»¥å®Œæˆã€‚ å¯¹äºLinuxæ¥è¯´ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨PXE+KickStartçš„æ–¹å¼è¿›è¡Œæ“ä½œç³»ç»Ÿçš„è‡ªåŠ¨åŒ–å®‰è£…ã€‚é‚£ä¹ˆé¦–å…ˆéœ€è¦å…ˆäº†è§£ä¸€ä¸‹KickStartã€‚</p><h2 id="_1-1-pxe-kickstartä»‹ç»" tabindex="-1">1.1 PXE+Kickstartä»‹ç» <a aria-current="page" href="#_1-1-pxe-kickstartä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="_1-1-1-kickstartå·¥ä½œåŸç†" tabindex="-1">1.1.1 KickStartå·¥ä½œåŸç† <a aria-current="page" href="#_1-1-1-kickstartå·¥ä½œåŸç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>KickStartæ˜¯Linuxçš„ä¸€ç§æ— äººèŒå®ˆçš„å®‰è£…æ–¹å¼ã€‚KickStartçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡è®°å½•å…¸å‹çš„å®‰è£…è¿‡ç¨‹ä¸­æ‰€éœ€äººå·¥å¹²é¢„å¡«å†™çš„å„ç§å‚æ•°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåä¸º ks.cfgçš„æ–‡ä»¶ï¼›è¿™æ ·åœ¨åé¢å®‰è£…è¿‡ç¨‹ä¸­å½“å‡ºç°è¦æ±‚å¡«å†™å‚æ•°çš„æƒ…å†µæ—¶ï¼Œå®‰è£…ç¨‹åºä¼šé¦–å…ˆå»æŸ¥æ‰¾ KickStartç”Ÿæˆçš„æ–‡ä»¶ï¼Œå½“æ‰¾åˆ°åˆé€‚çš„å‚æ•°æ—¶ï¼Œå°±é‡‡ç”¨æ‰¾åˆ°çš„å‚æ•°ï¼Œå½“æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å‚æ•°æ—¶ï¼Œæ‰éœ€è¦å®‰è£…è€…æ‰‹å·¥å¹²é¢„ã€‚ å¦‚æœKickStartæ–‡ä»¶æ¶µç›–äº†å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°çš„æ‰€æœ‰éœ€è¦å¡«å†™çš„å‚æ•°æ—¶ï¼Œé‚£ä¹ˆå°±å®Œå…¨ä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œå®‰è£…ç¨‹åºä¼šæ ¹æ®ks.cfgä¸­è®¾ç½®çš„é€‰é¡¹è‡ªåŠ¨è¿›è¡Œå®‰è£…ï¼Œå¹¶é€šè¿‡è®¾ç½®é‡å¯é€‰é¡¹æ¥é‡å¯ç³»ç»Ÿï¼Œå¹¶ç»“æŸå®‰è£…ã€‚é‚£ä¹ˆå¦‚ä½•è®©æœåŠ¡å™¨å¼€æœºå°±å¼€å§‹è‡ªåŠ¨å®‰è£…æ“ä½œç³»ç»Ÿå‘¢ï¼Œæˆ‘ä»¬è¦å€ŸåŠ©å¼€æœºå¯åŠ¨é€‰é¡¹ï¼Œæ¯”å¦‚ä»PXEå¯åŠ¨ã€‚</p><h3 id="_1-1-2-pxeå·¥ä½œåŸç†" tabindex="-1">1.1.2 PXEå·¥ä½œåŸç† <a aria-current="page" href="#_1-1-2-pxeå·¥ä½œåŸç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä¸ç®¡æ˜¯æœåŠ¡å™¨è¿˜æ˜¯æ™®é€šçš„PCæœºéƒ½æ”¯æŒå¤šç§å¯åŠ¨æ–¹å¼ï¼Œä¾‹å¦‚ä»ç¡¬ç›˜ã€ä»Uç›˜ã€ä»ç½‘ç»œå¯åŠ¨ã€‚è€ŒPXEæ˜¯æœåŠ¡å™¨å¼€æœºå¯åŠ¨çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºç½‘å¡å¯åŠ¨ï¼Œå› ä¸ºè¿›è¡ŒPXEå®‰è£…çš„å¿…è¦æ¡ä»¶æ˜¯è®¡ç®—æœºä¸Šçš„ç½‘å¡è¦æ”¯æŒPXEï¼Œå³ç½‘å¡ä¸­å¿…é¡»è¦æœ‰ PXE Clientï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒåŸºæœ¬ä¸Šæˆ‘ä»¬å¸¸è§çš„æœåŠ¡å™¨éƒ½æ”¯æŒè¿™ç§æ–¹å¼ã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸‹PXEçš„å·¥ä½œæ–¹å¼ï¼šPXE ï¼ˆPre-boot Execution Environmentï¼‰åè®®ä½¿è®¡ç®—æœºå¯ä»¥é€šè¿‡ç½‘ç»œå¯åŠ¨ã€‚PXEåè®®åˆ†ä¸º Client å’Œ Server ç«¯ï¼ŒPXE client åœ¨ç½‘å¡çš„ ROM ä¸­ï¼Œå½“è®¡ç®—æœºå¼•å¯¼æ—¶ï¼ŒBIOS æŠŠ PXE client è°ƒå…¥å†…å­˜æ‰§è¡Œï¼Œç”± PXE client å°†æ”¾ç½®åœ¨è¿œç«¯çš„æ–‡ä»¶é€šè¿‡ç½‘ç»œä¸‹è½½åˆ°æœ¬åœ°è¿è¡Œã€‚ è¿è¡Œ PXE åè®®éœ€è¦è®¾ç½® DHCP æœåŠ¡å™¨å’Œ TFTP æœåŠ¡å™¨ã€‚DHCP æœåŠ¡å™¨ç”¨æ¥ç»™ PXE Clientï¼ˆå°†è¦å®‰è£…ç³»ç»Ÿçš„ä¸»æœºï¼‰åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼Œç”±äºæ˜¯ç»™ PXE Client åˆ†é… IP åœ°å€ï¼Œæ‰€ä»¥åœ¨é…ç½® DHCP æœåŠ¡å™¨æ—¶éœ€è¦å¢åŠ ç›¸åº”çš„ PXE è®¾ç½®ã€‚æ­¤å¤–ï¼Œåœ¨ PXE Client çš„ ROM ä¸­ï¼Œå·²ç»å­˜åœ¨äº† TFTP Clientã€‚PXE Client é€šè¿‡ TFTP åè®®åˆ° TFTP Server ä¸Šä¸‹è½½æ‰€éœ€çš„æ–‡ä»¶ã€‚</p><h3 id="_1-1-3-pxe-kickstartå·¥ä½œæµç¨‹" tabindex="-1">1.1.3 PXE+Kickstartå·¥ä½œæµç¨‹ <a aria-current="page" href="#_1-1-3-pxe-kickstartå·¥ä½œæµç¨‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä¸‹å›¾æ˜¾ç¤ºäº†PXE+Kickstartçš„å·¥ä½œæµç¨‹</p><p>1.PXE Clientå‘é€DHCPè¯·æ±‚åˆ°DHCP Server 2.DHCP Serveræä¾›ç›¸å…³ä¿¡æ¯åŒ…æ‹¬IPåœ°å€å’ŒTFTPæœåŠ¡å™¨çš„ä½ç½®ï¼Œä»¥åŠè¦ä¸‹è½½çš„æ–‡ä»¶ã€‚ 3.PXE Clientè¯·æ±‚TFTP Serverã€‚ 4.TFTP Serverå“åº”è¯·æ±‚å¹¶å°†æ–‡ä»¶å‘é€ç»™PXE Client 5.PXE Clientå»ä¸‹è½½å¯¹åº”çš„Kickstartæ–‡ä»¶ï¼Œå¹¶æ ¹æ®Kickstartæ–‡ä»¶ä¸­çš„å†…å®¹å¼€å§‹è¿›è¡Œå®‰è£… 6.å®‰è£…æ“ä½œç³»ç»Ÿã€‚</p><h2 id="_1-2-åˆ¶ä½œæœ¬åœ°yumä»“åº“" tabindex="-1">1.2 åˆ¶ä½œæœ¬åœ°Yumä»“åº“ <a aria-current="page" href="#_1-2-åˆ¶ä½œæœ¬åœ°yumä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä¸‹é¢æˆ‘ä»¬å°±è¦å‡†å¤‡å…ˆæ‰‹åŠ¨æ¥é€šè¿‡PXE+Kickstartæ¥å®ç°è‡ªåŠ¨åŒ–çš„ç³»ç»Ÿå®‰è£…ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªYUMä»“åº“ï¼Œè€Œä¸”æ˜¯æœ¬åœ°çš„ã€‚ä¸‹é¢æˆ‘å°±æ‹¿CentOS 7ä¸ºä¾‹ï¼š</p><h3 id="_1-2-1-å‡†å¤‡å®‰è£…æº" tabindex="-1">1.2.1 å‡†å¤‡å®‰è£…æº <a aria-current="page" href="#_1-2-1-å‡†å¤‡å®‰è£…æº" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li><p>å®‰è£…éœ€è¦è½¯ä»¶åŒ… æˆ‘ä»¬ä½¿ç”¨HTTPçš„æ–¹å¼ä½œä¸ºYUMä»“åº“çš„å®‰è£…æºï¼Œéœ€è¦é¦–å…ˆå®‰è£…Apacheï¼Œå…¶ä¸­createrepo æ˜¯ä¸€ä¸ªå¯¹rpm æ–‡ä»¶è¿›è¡Œç´¢å¼•å»ºç«‹çš„å·¥å…·ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y httpd createrepo</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>ä¸‹è½½isoé•œåƒ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"># wget https://mirrors.aliyun.com/centos/7.4.1708/isos/x86_64/CentOS-7-x86_64-DVD-1708.iso</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºyumä»“åº“</p></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mount -o loop /usr/local/src/CentOS-7-x86_64-DVD-1511.iso /mnt/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>å¦‚æœä½ ä½¿ç”¨VMWare Workstationåˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™è®¾ç½®äº†ISOé•œåƒï¼Œå¯ä»¥ä¸ç”¨ä¸‹è½½ï¼Œç›´æ¥æŒ‚è½½ä½¿ç”¨ã€‚</p></blockquote><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mount /dev/cdrom /mnt/</span></span>
<span class="line"><span style="color:#a6accd">mount: /dev/sr0 is write-protected, mounting read-only</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨é»˜è®¤Apacheçš„å®¶ç›®å½•ä¸‹åˆ›å»ºç›®å½•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /var/www/html/CentOS-7.4-x86_64</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp -a /mnt/* /var/www/html/CentOS-7.4-x86_64/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>å‡†å¤‡Kickstartå®‰è£…æ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /var/www/html/CentOS-7-x86_64/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 CentOS-7-x86_64]# vim CentOS-7-x86_64.cfg</span></span>
<span class="line"><span style="color:#a6accd">#Kickstart Configurator by Jason Zhao</span></span>
<span class="line"><span style="color:#a6accd">#platform=x86, AMD64, or Intel EM64T</span></span>
<span class="line"><span style="color:#a6accd">#System  language</span></span>
<span class="line"><span style="color:#a6accd">lang en_US</span></span>
<span class="line"><span style="color:#a6accd">#System keyboard</span></span>
<span class="line"><span style="color:#a6accd">keyboard us</span></span>
<span class="line"><span style="color:#a6accd">#Sytem timezone</span></span>
<span class="line"><span style="color:#a6accd">timezone Asia/Shanghai</span></span>
<span class="line"><span style="color:#a6accd">#Root password</span></span>
<span class="line"><span style="color:#a6accd">rootpw --iscrypted $1$example$I.i3m26O7QYNja8p5Cj9.0</span></span>
<span class="line"><span style="color:#a6accd">#Use text mode install</span></span>
<span class="line"><span style="color:#a6accd">text</span></span>
<span class="line"><span style="color:#a6accd">#Install OS instead of upgrade</span></span>
<span class="line"><span style="color:#a6accd">install</span></span>
<span class="line"><span style="color:#a6accd">#Use NFS installation Media</span></span>
<span class="line"><span style="color:#a6accd">url --url=http://192.168.56.11/CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">#System bootloader configuration</span></span>
<span class="line"><span style="color:#a6accd">bootloader --location=mbr --driveorder=sda --append="net.ifnames=0 biosdevname=0"</span></span>
<span class="line"><span style="color:#a6accd">#Clear the Master Boot Record</span></span>
<span class="line"><span style="color:#a6accd">zerombr</span></span>
<span class="line"><span style="color:#a6accd">#Partition clearing information</span></span>
<span class="line"><span style="color:#a6accd">clearpart --all --initlabel </span></span>
<span class="line"><span style="color:#a6accd">#Disk partitioning information</span></span>
<span class="line"><span style="color:#a6accd">part /boot --fstype=xfs --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part swap --asprimary --fstype="swap" --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part / --fstype=xfs --size=1 --grow</span></span>
<span class="line"><span style="color:#a6accd">#System authorization infomation</span></span>
<span class="line"><span style="color:#a6accd">auth  --useshadow  --enablemd5 </span></span>
<span class="line"><span style="color:#a6accd">#Network information</span></span>
<span class="line"><span style="color:#a6accd">network --bootproto=dhcp --device=eth0 --onboot=on --activate</span></span>
<span class="line"><span style="color:#a6accd"># Reboot after installation</span></span>
<span class="line"><span style="color:#a6accd">reboot</span></span>
<span class="line"><span style="color:#a6accd">#Firewall configuration</span></span>
<span class="line"><span style="color:#a6accd">firewall --disabled </span></span>
<span class="line"><span style="color:#a6accd">#SELinux configuration</span></span>
<span class="line"><span style="color:#a6accd">selinux --disabled</span></span>
<span class="line"><span style="color:#a6accd">#Service configuration</span></span>
<span class="line"><span style="color:#a6accd">services --disabled=postfix</span></span>
<span class="line"><span style="color:#a6accd">#Do not configure XWindows</span></span>
<span class="line"><span style="color:#a6accd">skipx</span></span>
<span class="line"><span style="color:#a6accd">#Package install information</span></span>
<span class="line"><span style="color:#a6accd">%packages</span></span>
<span class="line"><span style="color:#a6accd">@ base</span></span>
<span class="line"><span style="color:#a6accd">@ core</span></span>
<span class="line"><span style="color:#a6accd">bash-completion</span></span>
<span class="line"><span style="color:#a6accd">sysstat</span></span>
<span class="line"><span style="color:#a6accd">ntp</span></span>
<span class="line"><span style="color:#a6accd">lrzsz</span></span>
<span class="line"><span style="color:#a6accd">openssl-devel</span></span>
<span class="line"><span style="color:#a6accd">zlib-devel</span></span>
<span class="line"><span style="color:#a6accd">OpenIPMI-tools</span></span>
<span class="line"><span style="color:#a6accd">screen</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><h3 id="_1-2-2-é…ç½®tftp-server" tabindex="-1">1.2.2 é…ç½®TFTP-Server <a aria-current="page" href="#_1-2-2-é…ç½®tftp-server" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æˆ‘ä»¬å·²ç»äº†è§£äº†PXE+Kickstartçš„åŸç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ç›¸å…³dhcpã€tftp-serverç­‰ã€‚</p><ol><li><p>å®‰è£…é…ç½®tftp-server</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y tftp-server xinetd</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/xinetd.d/tftp</span></span>
<span class="line"><span style="color:#a6accd">disable                 = noï¼ˆä¿®æ”¹ä¸ºnoï¼‰</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>å‡†å¤‡å®‰è£…éœ€è¦çš„æ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y syslinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /var/lib/tftpboot/pxelinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/pxelinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /mnt/isolinux/* /var/lib/tftpboot/pxelinux</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /mnt/images/pxeboot/{vmlinuz,initrd.img} /var/lib/tftpboot/pxelinux/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p>åœ¨tftpbootä¸‹åˆ›å»ºpxelinux.cfgç›®å½•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /var/lib/tftpboot/pxelinux/pxelinux.cfg </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp /mnt/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux/pxelinux.cfg/default</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>ä¿®æ”¹defaulté…ç½®ï¼ŒæŒ‡å®šç½‘ç«™å®‰è£…çš„kickstartæ–‡ä»¶</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /var/lib/tftpboot/pxelinux.cfg/default</span></span>
<span class="line"><span style="color:#a6accd">â€¦çœç•¥â€¦</span></span>
<span class="line"><span style="color:#a6accd">#åœ¨label linuxä¸Šé¢å¢åŠ è‡ªåŠ¨åŒ–å®‰è£…çš„é…ç½®</span></span>
<span class="line"><span style="color:#a6accd">label ks</span></span>
<span class="line"><span style="color:#a6accd">  menu label ^Auto Install CentOS 7</span></span>
<span class="line"><span style="color:#a6accd">  kernel vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">  append initrd=initrd.img ip=dhcp inst.repo=http://192.168.56.11/CentOS-7-x86_64/ inst.ks=http://192.168.56.11/CentOS-7-x86_64/CentOS-7-x86_64.cfg net.ifnames=0 biosdevname=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>é…ç½®DHCP Server</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y dhcp</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# /bin/cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example /etc/dhcp/dhcpd.conf</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/dhcp/dhcpd.conf</span></span>
<span class="line"><span style="color:#a6accd">option domain-name "devopsedu.com";</span></span>
<span class="line"><span style="color:#a6accd">option domain-name-servers 192.168.56.2;</span></span>
<span class="line"><span style="color:#a6accd">#è¯·åˆ é™¤å…¶ä»–çš„subneté…ç½®</span></span>
<span class="line"><span style="color:#a6accd">subnet 192.168.56.0 netmask 255.255.255.0 {</span></span>
<span class="line"><span style="color:#a6accd">     range dynamic-bootp 192.168.56.100 192.168.56.200;</span></span>
<span class="line"><span style="color:#a6accd">     option subnet-mask              255.255.255.0;  #è®¾ç½®å­ç½‘æ©ç </span></span>
<span class="line"><span style="color:#a6accd">option routers                  192.168.56.2;    #è®¾ç½®ç½‘å…³</span></span>
<span class="line"><span style="color:#a6accd">     next-server                     192.168.56.11;   #è®¾ç½®TFTP-Serveråœ°å€</span></span>
<span class="line"><span style="color:#a6accd">     filename                        "pxelinux/pxelinux.0";   #è®¾ç½®TFTPéœ€è¦ä¸‹è½½çš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>å¯åŠ¨httpdã€tftpå’ŒdhcpdæœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start xinetd.service dhcpd.service httpd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp</span></span>
<span class="line"><span style="color:#a6accd">Active Internet connections (only servers)</span></span>
<span class="line"><span style="color:#a6accd">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span></span>
<span class="line"><span style="color:#a6accd">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      871/sshd            </span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::80                   :::*                    LISTEN      1321/httpd          </span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::22                   :::*                    LISTEN      871/sshd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p>æŸ¥çœ‹dhcpdå’Œtftpdæ˜¯å¦å¯åŠ¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -nulp</span></span>
<span class="line"><span style="color:#a6accd">Active Internet connections (only servers)</span></span>
<span class="line"><span style="color:#a6accd">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span></span>
<span class="line"><span style="color:#a6accd">udp        0      0 0.0.0.0:67              0.0.0.0:*                           1487/dhcpd          </span></span>
<span class="line"><span style="color:#a6accd">udp        0      0 0.0.0.0:69              0.0.0.0:*                           1486/xinetd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_1-2-4-è‡ªåŠ¨åŒ–å®‰è£…å’Œæµç¨‹æ€»ç»“" tabindex="-1">1.2.4 è‡ªåŠ¨åŒ–å®‰è£…å’Œæµç¨‹æ€»ç»“ <a aria-current="page" href="#_1-2-4-è‡ªåŠ¨åŒ–å®‰è£…å’Œæµç¨‹æ€»ç»“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç°åœ¨å°±å¯ä»¥æ–°åˆ›å»ºä¸€å°è™šæ‹Ÿæœºæ¥è¿›è¡Œæµ‹è¯•äº†ï¼Œè®°ç€é€‰æ‹©ç½‘å¡å¯åŠ¨ã€‚DHCPåï¼Œå°±å¯ä»¥çœ‹åˆ°å®‰è£…é¡µé¢ã€‚æˆ‘ä»¬åˆšæ‰æ·»åŠ çš„Auto Install CentOS ä¹Ÿå¯ä»¥çœ‹åˆ°äº†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¯ä»¥æ¥æ€»ç»“ä¸‹PXE+KickStartçš„å®‰è£…æµç¨‹äº†ï¼š éœ€è¦ç»å†ä»¥ä¸‹çš„è¿‡ç¨‹ï¼š 1.ç½‘å¡ä¸Šçš„PXEèŠ¯ç‰‡æœ‰512å­—èŠ‚ï¼Œå­˜æ”¾äº†DHCPå’ŒTFTPçš„å®¢æˆ·ç«¯ã€‚ 2.å¯åŠ¨è®¡ç®—æœºé€‰æ‹©ç½‘å¡å¯åŠ¨ã€‚ 3.PXEä¸Šçš„DHCPå®¢æˆ·ç«¯ä¼šå‘DHCPæœåŠ¡å™¨ï¼Œç”³è¯·IPåœ°å€ 4.DHCPæœåŠ¡å™¨åˆ†é…ç»™å®ƒIPåœ°å€çš„åŒæ—¶é€šè¿‡ä»¥ä¸‹å­—æ®µï¼Œå‘Šè¯‰pxeï¼ŒTFTPçš„åœ°å€å’Œå®ƒè¦ä¸‹è½½çš„æ–‡ä»¶ ï¬next-server 192.168.56.11ï¼› ï¬filename "pxelinux.0"ï¼› 5.pxelinux.0å‘Šè¯‰PXEè¦ä¸‹è½½çš„é…ç½®æ–‡ä»¶æ˜¯pxelinux.cfgç›®å½•ä¸‹é¢çš„default 6.pxeä¸‹è½½å¹¶ä¾æ®é…ç½®æ–‡ä»¶çš„å†…å®¹ä¸‹è½½å¯åŠ¨å¿…é¡»çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ks.cfgé…ç½®å†…å®¹å¼€å§‹ç³»ç»Ÿå®‰è£…ã€‚</p><p><strong>æˆ‘ä»¬éƒ½å¹²äº†ä»€ä¹ˆ</strong> æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°è®¾ç½®ä¸€ä¸ªç½‘ç»œç¯å¢ƒå¯èƒ½æ¶‰åŠåˆ°è®¸å¤šæ­¥éª¤ï¼Œæ‰èƒ½ä¸ºå¼€å§‹å®‰è£…åšå¥½å‡†å¤‡ã€‚æ‚¨å¿…é¡»ï¼š</p><ul><li><p>é…ç½®æœåŠ¡ï¼Œæ¯”å¦‚ DHCPã€TFTPã€DNSã€HTTPã€FTP å’Œ NFS</p></li><li><p>åœ¨ DHCP å’Œ TFTP é…ç½®æ–‡ä»¶ä¸­å¡«å…¥å„ä¸ªå®¢æˆ·ç«¯æœºå™¨çš„ä¿¡æ¯</p></li><li><p>åˆ›å»ºè‡ªåŠ¨éƒ¨ç½²æ–‡ä»¶ï¼ˆæ¯”å¦‚ kickstart å’Œ autoinstï¼‰</p></li><li><p>å°†å®‰è£…åª’ä»‹è§£å‹ç¼©åˆ° HTTP/FTP/NFS å­˜å‚¨åº“ä¸­ã€‚ è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸ç®€å•ï¼Œç”šè‡³å¯ä»¥è¯´å¤æ‚ï¼Œæˆ‘ä»¬è¦è‡ªå·±ç®¡ç†å’Œåˆ›å»ºä¸åŒçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€æ‰‹åŠ¨ç®¡ç†DHCPç­‰ï¼Œé‚£ä¹ˆå¦‚ä½•èƒ½è®©æˆ‘ä»¬æœ‰ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ï¼Œæ›´å®ç”¨çš„è‡ªåŠ¨åŒ–è£…æœºå¹³å°ï¼Œå¼€æºç¤¾åŒºç»™äº†æˆ‘ä»¬ç­”æ¡ˆå°±æ˜¯Cobblerã€‚ å®˜æ–¹ç½‘ç«™ï¼š<a href="http://cobbler.github.io/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://cobbler.github.io/<!--]--></a></p></li></ul><h1 id="_2-cobblerå¿«é€Ÿå…¥é—¨" tabindex="-1">2 Cobblerå¿«é€Ÿå…¥é—¨ <a aria-current="page" href="#_2-cobblerå¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>ä½¿ç”¨ Cobblerï¼Œæ‚¨æ— éœ€è¿›è¡Œäººå·¥å¹²é¢„å³å¯å®‰è£…æœºå™¨ã€‚Cobblerè®¾ç½®ä¸€ä¸ªPXEå¼•å¯¼ç¯å¢ƒï¼Œå¹¶æ§åˆ¶ä¸å®‰è£…ç›¸å…³çš„æ‰€æœ‰è½¯ä»¶å’Œç¯å¢ƒå‡†å¤‡ï¼Œæ¯”å¦‚ç½‘ç»œå¼•å¯¼æœåŠ¡ï¼ˆDHCP å’Œ TFTPï¼‰ä¸å­˜å‚¨åº“é•œåƒã€‚å½“å¸Œæœ›å®‰è£…ä¸€å°æ–°æœºå™¨æ—¶ï¼ŒCobbler å¯ä»¥ï¼š</p><ul><li>ä½¿ç”¨ä¸€ä¸ªä»¥å‰å®šä¹‰çš„æ¨¡æ¿æ¥é…ç½® DHCP æœåŠ¡ï¼ˆå¦‚æœå¯ç”¨äº†ç®¡ç† DHCPï¼‰</li><li>å°†ä¸€ä¸ªå­˜å‚¨åº“ï¼ˆyum æˆ– rsyncï¼‰å»ºç«‹é•œåƒæˆ–è§£å‹ç¼©ä¸€ä¸ªåª’ä»‹ï¼Œä»¥æ³¨å†Œä¸€ä¸ªæ–°æ“ä½œç³»ç»Ÿ</li><li>åœ¨ DHCP é…ç½®æ–‡ä»¶ä¸­ä¸ºéœ€è¦å®‰è£…çš„æœºå™¨åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œå¹¶ä½¿ç”¨æ‚¨æŒ‡å®šçš„å‚æ•°ï¼ˆIP å’Œ MAC åœ°å€ï¼‰</li><li>åœ¨ TFTFP æœåŠ¡ç›®å½•ä¸‹åˆ›å»ºé€‚å½“çš„ PXE æ–‡ä»¶</li><li>é‡æ–°å¯åŠ¨ DHCP æœåŠ¡ä»¥åæ˜ æ›´æ”¹</li><li>é‡æ–°å¯åŠ¨æœºå™¨ä»¥å¼€å§‹å®‰è£…ï¼ˆå¦‚æœç”µæºç®¡ç†å·²å¯ç”¨ï¼‰</li></ul><h2 id="_2-1-cobbleréƒ¨ç½²" tabindex="-1">2.1 Cobbleréƒ¨ç½² <a aria-current="page" href="#_2-1-cobbleréƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="_2-1-1-cobbleråŠŸèƒ½" tabindex="-1">2.1.1 CobbleråŠŸèƒ½ <a aria-current="page" href="#_2-1-1-cobbleråŠŸèƒ½" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Cobbler æ”¯æŒä¼—å¤šçš„å‘è¡Œç‰ˆï¼šRed Hatã€Fedoraã€CentOSã€Debianã€Ubuntu å’Œ SuSEã€‚å½“æ·»åŠ ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼ˆé€šå¸¸é€šè¿‡ä½¿ç”¨ ISO æ–‡ä»¶ï¼‰æ—¶ï¼ŒCobbler çŸ¥é“å¦‚ä½•è§£å‹ç¼©åˆé€‚çš„æ–‡ä»¶å¹¶è°ƒæ•´ç½‘ç»œæœåŠ¡ï¼Œä»¥æ­£ç¡®å¼•å¯¼æœºå™¨ã€‚</p><p>Cobbler å¯ä½¿ç”¨ kickstart æ¨¡æ¿ã€‚åŸºäº Red Hat æˆ– Fedora çš„ç³»ç»Ÿä½¿ç”¨ kickstart æ–‡ä»¶æ¥è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹ã€‚é€šè¿‡ä½¿ç”¨æ¨¡æ¿ï¼Œæ‚¨å°±ä¼šæ‹¥æœ‰åŸºæœ¬çš„ kickstart æ¨¡æ¿ï¼Œç„¶åå®šä¹‰å¦‚ä½•é’ˆå¯¹ä¸€ç§é…ç½®æ–‡ä»¶æˆ–æœºå™¨é…ç½®è€Œæ›¿æ¢å…¶ä¸­çš„å˜é‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¨¡æ¿å¯èƒ½åŒ…å«ä¸¤ä¸ªå˜é‡ $domain å’Œ $machine_nameã€‚åœ¨ Cobbler é…ç½®ä¸­ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶æŒ‡å®š <a href="http://domain=mydomain.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->domain=mydomain.com<!--]--></a>ï¼Œå¹¶ä¸”æ¯å°ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶çš„æœºå™¨åœ¨ machine_name å˜é‡ä¸­æŒ‡å®šå…¶åç§°ã€‚è¯¥é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰æœºå™¨éƒ½ä½¿ç”¨ç›¸åŒçš„ kickstart å®‰è£…ä¸”é’ˆå¯¹ <a href="http://domain=mydomain.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->domain=mydomain.com<!--]--></a> è¿›è¡Œé…ç½®ï¼Œä½†æ¯å°æœºå™¨æ‹¥æœ‰å…¶è‡ªå·±çš„æœºå™¨åç§°ã€‚æ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨ kickstart æ¨¡æ¿åœ¨ä¸åŒçš„åŸŸä¸­å®‰è£…å…¶ä»–æœºå™¨å¹¶ä½¿ç”¨ä¸åŒçš„æœºå™¨åç§°ã€‚</p><p>ä½¿ç”¨ koan å®¢æˆ·ç«¯ï¼ŒCobbler å¯ä»å®¢æˆ·ç«¯é…ç½®è™šæ‹Ÿæœºå¹¶é‡æ–°å®‰è£…ç³»ç»Ÿã€‚æˆ‘ä¸ä¼šè®¨è®ºé…ç½®ç®¡ç†å’Œ koan ç‰¹æ€§ï¼Œå› ä¸ºå®ƒä»¬ä¸å±äºæœ¬æ–‡çš„ä»‹ç»èŒƒç•´ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬æ˜¯å€¼å¾—ç ”ç©¶çš„æœ‰ç”¨ç‰¹æ€§ã€‚</p><h3 id="_2-1-2-cobblerå®‰è£…" tabindex="-1">2.1.2 Cobblerå®‰è£… <a aria-current="page" href="#_2-1-2-cobblerå®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>å®‰è£…EPELæº</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>yumå®‰è£…cobbler</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y httpd dhcp tftp python-ctypes cobbler cobbler-web pykickstart fence-agents xinetd debmirror</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨å¹¶é…ç½®cobbler</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable httpd cobblerd</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd cobblerd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>ä¸‹è½½Cobbleréœ€è¦çš„å¯åŠ¨æ–‡ä»¶</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler get-loaders</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æ£€æŸ¥CobblerçŠ¶æ€</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler check</span></span>
<span class="line"><span style="color:#a6accd">The following are potential configuration items that you may want to fix:</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1 : The 'server' field in /etc/cobbler/settings must be set to something other than localhost, or kickstarting features will not work.  This should be a resolvable hostname or IP for the boot server as reachable by all machines that will use it.</span></span>
<span class="line"><span style="color:#a6accd">2 : For PXE to be functional, the 'next_server' field in /etc/cobbler/settings must be set to something other than 127.0.0.1, and should match the IP of the boot server on the PXE network.</span></span>
<span class="line"><span style="color:#a6accd">3 : change 'disable' to 'no' in /etc/xinetd.d/tftp</span></span>
<span class="line"><span style="color:#a6accd">4 : enable and start rsyncd.service with systemctl</span></span>
<span class="line"><span style="color:#a6accd">5 : comment out 'dists' on /etc/debmirror.conf for proper debian support</span></span>
<span class="line"><span style="color:#a6accd">6 : comment out 'arches' on /etc/debmirror.conf for proper debian support</span></span>
<span class="line"><span style="color:#a6accd">7 : The default password used by the sample templates for newly installed machines (default_password_crypted in /etc/cobbler/settings) is still set to 'cobbler' and should be changed, try: "openssl passwd -1 -salt 'random-phrase-here' 'your-password-here'" to generate new one</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Restart cobblerd and then run 'cobbler sync' to apply changes.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™æ®µè¯çš„æ„æ€å°±æ˜¯éœ€è¦å¤„ç†ä¸Šé¢çš„æ‰€æœ‰é—®é¢˜ï¼Œç„¶åé‡å¯cobblerdæœåŠ¡ï¼Œç„¶åæ‰§è¡Œcobbler syncåŒæ­¥ä¿®æ”¹æ“ä½œã€‚</p><p><strong>å°†ä¸Šé¢æåˆ°çš„7ä¸ªé—®é¢˜è¿›è¡Œä¿®å¤</strong></p><ul><li>é—®é¢˜1å’Œ2è§£å†³</li></ul><p>å‡æ˜¯éœ€è¦ä¿®æ”¹cobblerçš„é…ç½®æ–‡ä»¶ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">#ä¿®æ”¹ä»¥ä¸‹ä¸¤è¡Œå³å¯ï¼Œå¯ä»¥ç›´æ¥æœç´¢127.0.0.1æ¥å®šä½</span></span>
<span class="line"><span style="color:#a6accd">server: 192.168.56.11   #è®¾ç½®cobbler serverçš„IPåœ°å€</span></span>
<span class="line"><span style="color:#a6accd">next_server: 192.168.56.11  #è®¾ç½®PXE serverçš„IPåœ°å€</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>é—®é¢˜3è§£å†³</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/xinetd.d/tftp</span></span>
<span class="line"><span style="color:#a6accd">service tftp</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">        socket_type             = dgram</span></span>
<span class="line"><span style="color:#a6accd">        protocol                = udp</span></span>
<span class="line"><span style="color:#a6accd">        wait                    = yes</span></span>
<span class="line"><span style="color:#a6accd">        user                    = root</span></span>
<span class="line"><span style="color:#a6accd">        server                  = /usr/sbin/in.tftpd</span></span>
<span class="line"><span style="color:#a6accd">        server_args             = -s /var/lib/tftpboot</span></span>
<span class="line"><span style="color:#a6accd">        disable                 = no</span></span>
<span class="line"><span style="color:#a6accd">        per_source              = 11</span></span>
<span class="line"><span style="color:#a6accd">        cps                     = 100 2</span></span>
<span class="line"><span style="color:#a6accd">        flags                   = IPv4</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>é—®é¢˜4è§£å†³</li></ul><p>å¯åŠ¨rsyncdæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable rsyncd</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start rsyncd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>é—®é¢˜5ã€6è§£å†³</li></ul><p>å®‰è£…debmirroræ˜¯debianç³»åˆ—ç³»ç»Ÿä½¿ç”¨çš„</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y debmirror</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/debmirror.conf</span></span>
<span class="line"><span style="color:#a6accd">#è¯·æ³¨é‡Šæ‰ä¸‹é¢ä¸¤è¡Œé…ç½®</span></span>
<span class="line"><span style="color:#a6accd">#@dists="sid";</span></span>
<span class="line"><span style="color:#a6accd">#@arches="i386"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>é—®é¢˜7è§£å†³</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl passwd -1 -salt 'example' 'devopsedu.com'</span></span>
<span class="line"><span style="color:#a6accd">$1$example$I.i3m26O7QYNja8p5Cj9.0 </span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">å°†ä¸‹é¢å­—æ®µæ›¿æ¢ä¸ºä¸Šé¢ç”Ÿæˆçš„å­—æ®µï¼š</span></span>
<span class="line"><span style="color:#a6accd">default_password_crypted: "$1$example$I.i3m26O7QYNja8p5Cj9.0"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart cobblerd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>å†æ¬¡æ£€æŸ¥Cobbler</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"> [root@ops-node1 ~]# cobbler check</span></span>
<span class="line"><span style="color:#a6accd">No configuration problems found.  All systems go.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-3-cobblerç®¡ç†dhcp" tabindex="-1">2.1.3 Cobblerç®¡ç†DHCP <a aria-current="page" href="#_2-1-3-cobblerç®¡ç†dhcp" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>å¼€å¯ç®¡ç†DHCPæœåŠ¡ï¼Œè¿™æ ·Cobblerå°±å¯ä»¥æ¥ç®¡DHCPçš„ç®¡ç†å·¥ä½œ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">manage_dhcp: 1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é¦–å…ˆä¿®æ”¹dhcpçš„é…ç½®æ–‡ä»¶</li></ol><p>ä¿®æ”¹dhcpçš„æ¨¡æ¿é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ç›¸å¯¹åº”çš„DHCPçš„IPåœ°å€å’Œåˆ†é…çš„ç½‘æ®µã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# vim /etc/cobbler/dhcp.template </span></span>
<span class="line"><span style="color:#a6accd">subnet 192.168.56.0 netmask 255.255.255.0 {</span></span>
<span class="line"><span style="color:#a6accd">     option routers             192.168.56.2;</span></span>
<span class="line"><span style="color:#a6accd">     option domain-name-servers 192.168.56.2;</span></span>
<span class="line"><span style="color:#a6accd">     option subnet-mask         255.255.255.0;</span></span>
<span class="line"><span style="color:#a6accd">     range dynamic-bootp        192.168.56.100 192.168.56.254;</span></span>
<span class="line"><span style="color:#a6accd">     default-lease-time         21600;</span></span>
<span class="line"><span style="color:#a6accd">     max-lease-time             43200;</span></span>
<span class="line"><span style="color:#a6accd">     next-server                $next_server;</span></span>
<span class="line"><span style="color:#a6accd">  â€¦</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é‡å¯Cobblerå¹¶è¿›è¡ŒåŒæ­¥æ“ä½œ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart cobblerd </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler sync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æ‰§è¡Œå®Œæ¯•cobbler syncåï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ/etc/dhcpd.confã€‚å¹¶é‡å¯dhcpæœåŠ¡ã€‚æ‰€ä»¥è¯´ä½¿ç”¨Cobblerç®¡ç†DHCPåï¼Œè¯·å‹¿ä¿®æ”¹/etc/dhcpd.confã€‚ä»¥åæ‰€æœ‰dhcpç›¸å…³çš„é…ç½®éƒ½æ˜¯ä¿®æ”¹Cobblerçš„DHCPæ¨¡æ¿æ–‡ä»¶/etc/cobbler/dhcp.templateã€‚</p></blockquote><h3 id="_2-1-4-cobblerå¯¼å…¥é•œåƒ" tabindex="-1">2.1.4 Cobblerå¯¼å…¥é•œåƒ <a aria-current="page" href="#_2-1-4-cobblerå¯¼å…¥é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>ä¸‹è½½å¹¶å¯¼å…¥é•œåƒ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# wget https://mirror.tuna.tsinghua.edu.cn/centos/7.7.1908/isos/x86_64/CentOS-7-x86_64-Minimal-1908.iso</span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# mmount -o loop /usr/local/src/CentOS-7-x86_64-Minimal-1908.iso /mnt/</span></span>
<span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cobbler import --path=/mnt/ --name=CentOS-7.7-x86_64 --arch=x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>å‚æ•°è¯´æ˜:</strong></p><ul><li>--name ä¸ºå®‰è£…æºå®šä¹‰ä¸€ä¸ªåå­—</li><li>--arch æŒ‡å®šå®‰è£…æºæ˜¯32ä½è¿˜æ˜¯64ä½ã€ia64, ç›®å‰æ”¯æŒçš„é€‰é¡¹æœ‰: x86â”‚x86_64â”‚ia64</li></ul><blockquote><p>å°æç¤ºï¼šCobbler ä¼šæŠŠå®‰è£…çš„é•œåƒISOæ‹·è´åˆ°æºå®‰è£…é•œåƒç›®å½•ä¸‹: /var/www/cobbler/ks_mirror/</p></blockquote><ol><li>æŸ¥çœ‹å¯¼å…¥åç»“æœ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler list</span></span>
<span class="line"><span style="color:#a6accd">distros:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">profiles:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-5-è‡ªå®šä¹‰kickstartæ–‡ä»¶" tabindex="-1">2.1.5 è‡ªå®šä¹‰kickstartæ–‡ä»¶ <a aria-current="page" href="#_2-1-5-è‡ªå®šä¹‰kickstartæ–‡ä»¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Cobblerçš„Kickstartæ–‡ä»¶å’Œé»˜è®¤çš„ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ï¼Œä¸»è¦æ˜¯å¢åŠ ä¸ŠCobblerçš„å˜é‡ã€‚å¯¼å…¥é•œåƒåï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè‡ªå®šä¹‰kickstartæ–‡ä»¶ç»™è¿™ä¸ªé•œåƒã€‚é¦–å…ˆå¯ä»¥å°†è‡ªå®šä¹‰åçš„Cobblerçš„kickstartæ–‡ä»¶æ”¾ç½®åœ¨/var/lib/cobbler/kickstartsç›®å½•ä¸‹ï¼Œè¿™ä¹Ÿæ˜¯Cobblerçš„é»˜è®¤å­˜æ”¾kickstartæ–‡ä»¶çš„åœ°æ–¹ã€‚</p><ol><li>è‡ªå®šä¹‰Kickstartæ–‡ä»¶</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /var/lib/cobbler/kickstarts/CentOS-7.7-x86_64-Cobbler.cfg</span></span>
<span class="line"><span style="color:#a6accd">#Kickstart Configurator by Jason Zhao</span></span>
<span class="line"><span style="color:#a6accd">#platform=x86, AMD64, or Intel EM64T</span></span>
<span class="line"><span style="color:#a6accd">#System  language</span></span>
<span class="line"><span style="color:#a6accd">lang en_US</span></span>
<span class="line"><span style="color:#a6accd">#System keyboard</span></span>
<span class="line"><span style="color:#a6accd">keyboard us</span></span>
<span class="line"><span style="color:#a6accd">#Sytem timezone</span></span>
<span class="line"><span style="color:#a6accd">timezone Asia/Shanghai</span></span>
<span class="line"><span style="color:#a6accd">#Root password</span></span>
<span class="line"><span style="color:#a6accd">rootpw --iscrypted $default_password_crypted</span></span>
<span class="line"><span style="color:#a6accd">#Use text mode install</span></span>
<span class="line"><span style="color:#a6accd">text</span></span>
<span class="line"><span style="color:#a6accd">#Install OS instead of upgrade</span></span>
<span class="line"><span style="color:#a6accd">install</span></span>
<span class="line"><span style="color:#a6accd">#Use NFS installation Media</span></span>
<span class="line"><span style="color:#a6accd">url --url=$tree</span></span>
<span class="line"><span style="color:#a6accd">#System bootloader configuration</span></span>
<span class="line"><span style="color:#a6accd">bootloader --location=mbr --driveorder=sda --append="net.ifnames=0 biosdevname=0"</span></span>
<span class="line"><span style="color:#a6accd">#Clear the Master Boot Record</span></span>
<span class="line"><span style="color:#a6accd">zerombr</span></span>
<span class="line"><span style="color:#a6accd">#Partition clearing information</span></span>
<span class="line"><span style="color:#a6accd">clearpart --all --initlabel </span></span>
<span class="line"><span style="color:#a6accd">#Disk partitioning information</span></span>
<span class="line"><span style="color:#a6accd">part /boot --fstype=xfs --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part swap --asprimary --fstype="swap" --size=1024</span></span>
<span class="line"><span style="color:#a6accd">part / --fstype=xfs --size=1 --grow</span></span>
<span class="line"><span style="color:#a6accd">#System authorization infomation</span></span>
<span class="line"><span style="color:#a6accd">auth  --useshadow  --enablemd5 </span></span>
<span class="line"><span style="color:#a6accd">#Network information</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('network_config')</span></span>
<span class="line"><span style="color:#a6accd"># Reboot after installation</span></span>
<span class="line"><span style="color:#a6accd">reboot</span></span>
<span class="line"><span style="color:#a6accd">#Firewall configuration</span></span>
<span class="line"><span style="color:#a6accd">firewall --disabled </span></span>
<span class="line"><span style="color:#a6accd">#SELinux configuration</span></span>
<span class="line"><span style="color:#a6accd">selinux --disabled</span></span>
<span class="line"><span style="color:#a6accd">#Service configuration</span></span>
<span class="line"><span style="color:#a6accd">services --disabled=postfix</span></span>
<span class="line"><span style="color:#a6accd">#Do not configure XWindows</span></span>
<span class="line"><span style="color:#a6accd">skipx</span></span>
<span class="line"><span style="color:#a6accd">#Package install information</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">%pre</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('log_ks_pre')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('kickstart_start')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('pre_install_network_config')</span></span>
<span class="line"><span style="color:#a6accd"># Enable installation monitoring</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('pre_anamon')</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">%packages</span></span>
<span class="line"><span style="color:#a6accd">@ base</span></span>
<span class="line"><span style="color:#a6accd">@ core</span></span>
<span class="line"><span style="color:#a6accd">bash-completion</span></span>
<span class="line"><span style="color:#a6accd">sysstat</span></span>
<span class="line"><span style="color:#a6accd">ntp</span></span>
<span class="line"><span style="color:#a6accd">lrzsz</span></span>
<span class="line"><span style="color:#a6accd">openssl-devel</span></span>
<span class="line"><span style="color:#a6accd">zlib-devel</span></span>
<span class="line"><span style="color:#a6accd">OpenIPMI-tools</span></span>
<span class="line"><span style="color:#a6accd">screen</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>ç„¶åç¼–è¾‘profileæ¥åˆ¶å®škickstartæ–‡ä»¶ã€‚</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cobbler profile edit --name=CentOS-7.7-x86_64 --kickstart=/var/lib/cobbler/kickstarts/CentOS-7.7-x86_64-Cobbler.cfg</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¢åŠ å®‰è£…æ—¶çš„å†…æ ¸å‚æ•°</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@ops-node1 ~]# cobbler profile edit --name=CentOS-7.7-x86_64 --kopts='net.ifnames=0 biosdevname=0'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æœ€åï¼Œä¸€å®šè¦æ‰§è¡ŒåŒæ­¥ï¼Œæ‰èƒ½å°†Cobblerè®¾ç½®å®Œæˆ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler sync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_2-2-ä½¿ç”¨cobblerè‡ªåŠ¨åŒ–å®‰è£…centos" tabindex="-1">2.2 ä½¿ç”¨Cobblerè‡ªåŠ¨åŒ–å®‰è£…CentOS <a aria-current="page" href="#_2-2-ä½¿ç”¨cobblerè‡ªåŠ¨åŒ–å®‰è£…centos" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Cobblerè¿›è¡Œå®‰è£…äº†ã€‚å®éªŒç¯å¢ƒä¸‹ï¼Œä½ å¯ä»¥æ–°åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆæ³¨æ„ç½‘å¡çš„é€‰æ‹©ï¼‰æ¥è¿›è¡Œæµ‹è¯•äº†ã€‚Cobbleréå¸¸äººæ€§åŒ–çš„åˆ›å»ºäº†ä¸€ä¸ªLocalï¼Œå³ä½¿ä»ç¡¬ç›˜å¯åŠ¨ï¼Œè¿™æ ·ä¹Ÿé¿å…äº†æœ‰æœåŠ¡å™¨ä»ç½‘å¡å¯åŠ¨å¼€å§‹è‡ªåŠ¨å®‰è£…çš„é—®é¢˜ã€‚</p><h3 id="_2-2-1-ä½¿ç”¨cobblerå®‰è£…centos" tabindex="-1">2.2.1 ä½¿ç”¨Cobblerå®‰è£…CentOS <a aria-current="page" href="#_2-2-1-ä½¿ç”¨cobblerå®‰è£…centos" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>å¯åŠ¨ç‰©ç†æœåŠ¡å™¨</li><li>é€‰æ‹©CentOS-7.7-x86_64ä¹‹åå³å¯é‡æ–°å¼€å§‹å®‰è£…ã€‚</li></ol><blockquote><p>åœ¨ç”Ÿäº§ç¯å¢ƒå¦‚æœæƒ³è¦è‡ªåŠ¨å¼€å§‹å®‰è£…ï¼Œæˆ‘ä»¬çš„é€šå¸¸åšæ³•æ˜¯æœ‰ä¸€ä¸ªä¸“é—¨è¿›è¡ŒæœåŠ¡å™¨å®‰è£…çš„VLANï¼Œå®‰è£…å®Œæ¯•åï¼Œè¿›å…¥å¾…è°ƒé…çŠ¶æ€ï¼Œç„¶åæ ¹æ®æµç¨‹è¿›å…¥åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ä½†æ˜¯æé†’å¤§å®¶ï¼Œè‡ªåŠ¨åŒ–å¼€å§‹è¿›è¡Œæ“ä½œç³»ç»Ÿå®‰è£…é£é™©ä¾ç„¶å¾ˆå¤§ã€‚</p></blockquote><h3 id="_2-2-2-koané‡æ–°å®‰è£…ç³»ç»Ÿ" tabindex="-1">2.2.2 Koané‡æ–°å®‰è£…ç³»ç»Ÿ <a aria-current="page" href="#_2-2-2-koané‡æ–°å®‰è£…ç³»ç»Ÿ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨å®è·µçš„è¿ç»´å·¥ä½œä¸­ï¼Œä½ è‚¯å®šéœ€è¦é‡æ–°å®‰è£…æ“ä½œç³»ç»Ÿï¼Œæœ‰äº†Cobblerä½ å°±ä¸ç”¨å»æœºæˆ¿äº†ï¼Œç›´æ¥ä½¿ç”¨Koanå°±å¯ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–é‡æ–°å®‰è£…æ“ä½œç³»ç»Ÿã€‚éœ€è¦å†å¾…é‡è£…çš„æœåŠ¡å™¨ä¸Šå®‰è£…koanã€‚</p><p>å®‰è£…Koanè½¯ä»¶åŒ…</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">[root@localhost ~]# yum install -y koan</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ—å‡ºå¯ä»¥å®‰è£…çš„ç³»ç»Ÿ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# koan --server=192.168.56.11 --list=profiles</span></span>
<span class="line"><span style="color:#a6accd">- looking for Cobbler at http://192.168.56.11:80/cobbler_api</span></span>
<span class="line"><span style="color:#a6accd">CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŒ‡å®šéœ€è¦é‡æ–°å®‰è£…çš„æ“ä½œç³»ç»Ÿ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# koan --replace-self --server=192.168.56.11 --profile=CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">- looking for Cobbler at http://192.168.56.11:80/cobbler_api</span></span>
<span class="line"><span style="color:#a6accd">- reading URL: http://192.168.56.11/cblr/svc/op/ks/profile/CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">install_tree: http://192.168.56.11/cblr/links/CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">downloading initrd initrd.img to /boot/initrd.img_koan</span></span>
<span class="line"><span style="color:#a6accd">url=http://192.168.56.11/cobbler/images/CentOS-7.7-x86_64/initrd.img</span></span>
<span class="line"><span style="color:#a6accd">- reading URL: http://192.168.56.11/cobbler/images/CentOS-7.7-x86_64/initrd.img</span></span>
<span class="line"><span style="color:#a6accd">downloading kernel vmlinuz to /boot/vmlinuz_koan</span></span>
<span class="line"><span style="color:#a6accd">url=http://192.168.56.11/cobbler/images/CentOS-7.7-x86_64/vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">- reading URL: http://192.168.56.11/cobbler/images/CentOS-7.4-x86_64/vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">- ['/sbin/grubby', '--add-kernel', '/boot/vmlinuz_koan', '--initrd', '/boot/initrd.img_koan', '--args', '"ksdevice=link lang= text net.ifnames=0 ks=http://192.168.56.11/cblr/svc/op/ks/profile/CentOS-7.4-x86_64 biosdevname=0 kssendmac "', '--copy-default', '--make-default', '--title=kick1526449287']</span></span>
<span class="line"><span style="color:#a6accd">- ['/sbin/grubby', '--update-kernel', '/boot/vmlinuz_koan', '--remove-args=root']</span></span>
<span class="line"><span style="color:#a6accd">- reboot to apply changes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒKoanä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯åŠ¨é€‰é¡¹ï¼Œé‡å¯åï¼Œç›´æ¥å¼€å§‹è‡ªåŠ¨å®‰è£…ã€‚</p><p>æˆ‘ä»¬å…ˆä¸è¦æ‰§è¡Œrebootå…ˆç ”ç©¶ä¸‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚ä½ æ‰“å¼€Grubçš„é…ç½®æ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# vim /boot/grub2/grub.cfg</span></span>
<span class="line"><span style="color:#a6accd">ä½ ä¼šå‘ç°è¿™æ ·çš„é…ç½®</span></span>
<span class="line"><span style="color:#a6accd">menuentry 'kick1526449287' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-693.el7.x86_64-advanced-49e658db-2c61-475a-9325-903fdbeb7cd4' {</span></span>
<span class="line"><span style="color:#a6accd">        load_video</span></span>
<span class="line"><span style="color:#a6accd">        set gfxpayload=keep</span></span>
<span class="line"><span style="color:#a6accd">        insmod gzio</span></span>
<span class="line"><span style="color:#a6accd">        insmod part_msdos</span></span>
<span class="line"><span style="color:#a6accd">        insmod xfs</span></span>
<span class="line"><span style="color:#a6accd">        set root='hd0,msdos1'</span></span>
<span class="line"><span style="color:#a6accd">        if [ x$feature_platform_search_hint = xy ]; then</span></span>
<span class="line"><span style="color:#a6accd">          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1'  0a801c26-5320-448d-b261-883499529bc6</span></span>
<span class="line"><span style="color:#a6accd">        else</span></span>
<span class="line"><span style="color:#a6accd">          search --no-floppy --fs-uuid --set=root 0a801c26-5320-448d-b261-883499529bc6</span></span>
<span class="line"><span style="color:#a6accd">        fi</span></span>
<span class="line"><span style="color:#a6accd">        linux16 /vmlinuz_koan ro crashkernel=auto biosdevname=0 net.ifnames=0 rhgb quiet LANG=en_US.UTF-8 ksdevice=link lang= text net.ifnames=0 ks=http://192.168.56.11/cblr/svc/op/ks/profile/CentOS-7.4-x86_64 biosdevname=0 kssendmac</span></span>
<span class="line"><span style="color:#a6accd">        initrd16 /initrd.img_koan</span></span>
<span class="line"><span style="color:#a6accd">ä¹Ÿå°±æ˜¯è¯´ï¼Œkoanå¸®æˆ‘ä»¬ä¸‹è½½äº†å®‰è£…éœ€è¦çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä¿®æ”¹äº†Grubçš„å¼€æœºå¯åŠ¨é€‰é¡¹ï¼Œå¢åŠ äº†å®‰è£…çš„é…ç½®ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨é€‰é¡¹ï¼Œè¿™æ ·æˆ‘ä»¬æ‰§è¡Œé‡å¯é»˜è®¤å°±å¼€å§‹å®‰è£…äº†ã€‚ç°åœ¨æ‰§è¡Œé‡å¯æ¥éªŒè¯ä¸€ä¸‹ã€‚</span></span>
<span class="line"><span style="color:#a6accd">[root@hadoop-node1 ~]# reboot</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç•Œé¢ï¼Œç„¶åå¼€å§‹è¿›è¡Œè‡ªåŠ¨åŒ–é‡æ–°å®‰è£…ã€‚</p><h2 id="_2-3-cobbler-webä»‹ç»" tabindex="-1">2.3 Cobbler Webä»‹ç» <a aria-current="page" href="#_2-3-cobbler-webä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Cobblerè¿˜æä¾›äº†å¯è§†åŒ–çš„WebèŠ‚ç•Œé¢å«åšCobbler Webã€‚æˆ‘ä»¬ä½¿ç”¨yumå®‰è£…å®Œæ¯•åï¼Œä¼šå†/etc/http/conf.d/ç›®å½•ä¸‹ç”Ÿæˆcobbler_web.confé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡<a href="https://ip/cobbler_web%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E3%80%82" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://IP/cobbler_webæ¥è¿›è¡Œè®¿é—®ã€‚<!--]--></a></p><ol><li><p>å®‰è£…Cobbler Web</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y cobbler-web</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>é…ç½®Cobbler Web</p></li></ol><p>Cobbler webçš„æƒé™ç®¡ç†æœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶ /etc/cobbler/users.confå’Œ/etc/cobbler/users.digest åè€…ä¸ºCobbleræƒé™é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨htdigestæ¥ä¸ºç”¨æˆ·è®¾ç½®å¯†ç </p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# htdigest  /etc/cobbler/users.digest "Cobbler" cobbler</span></span>
<span class="line"><span style="color:#a6accd">Changing password for user cobbler in realm Cobbler</span></span>
<span class="line"><span style="color:#a6accd">New password: </span></span>
<span class="line"><span style="color:#a6accd">Re-type new password:</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨cobblerç”¨æˆ·å’Œä½ è®¾ç½®çš„å¯†ç ç™»é™†äº†ã€‚ <a href="https://192.168.56.11/cobbler_web" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://192.168.56.11/cobbler_web<!--]--></a></p><h2 id="_2-4-æ·±å…¥ç†è§£cobbler" tabindex="-1">2.4 æ·±å…¥ç†è§£Cobbler <a aria-current="page" href="#_2-4-æ·±å…¥ç†è§£cobbler" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ç»è¿‡å‰é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥é¡ºåˆ©çš„ä½¿ç”¨Cobblerè¿›è¡Œæ“ä½œç³»ç»Ÿçš„å®‰è£…ï¼Œä½¿ç”¨Koanè¿›è¡Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨é‡æ–°å®‰è£…çš„æ“ä½œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦æ›´å¤šçš„æŒæ¡ä¸€äº›Cobblerçš„çŸ¥è¯†ï¼Œæ‰èƒ½åœ¨ç”Ÿäº§çš„åº”ç”¨ä¸­ï¼Œæ›´å¦‚é±¼å¾—æ°´ã€‚</p><h3 id="_2-4-1-cobbler-é…ç½®æ–‡ä»¶" tabindex="-1">2.4.1 Cobbler é…ç½®æ–‡ä»¶ <a aria-current="page" href="#_2-4-1-cobbler-é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>Cobblerçš„ç›®å½• Cobblerå®‰è£…å®Œæ¯•åä¼šåœ¨ç³»ç»Ÿç”Ÿæˆå¦‚ä¸‹ç›®å½•ï¼š</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# find / -name cobbler</span></span>
<span class="line"><span style="color:#a6accd">/etc/selinux/targeted/active/modules/100/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/etc/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/var/lib/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/var/log/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/var/www/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/usr/bin/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/usr/lib/python2.7/site-packages/cobbler</span></span>
<span class="line"><span style="color:#a6accd">/usr/share/cobbler</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Cobbleré…ç½®æ–‡ä»¶ç›®å½•</li></ol><p>Cobblerçš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨/etc/cobblerä¸‹ã€‚</p><ul><li>/etc/cobbler/settingsä¸ºä¸»é…ç½®æ–‡ä»¶ï¼›</li><li>åœ¨/etc/cobblerä¸‹ä½ è¿˜èƒ½çœ‹åˆ°dhcpã€dnsã€pxeã€dnsmasqçš„æ¨¡æ¿é…ç½®æ–‡ä»¶ï¼›</li><li>/etc/cobbler/users.digestä¸ºç”¨äºwebè®¿é—®çš„ç”¨æˆ·åå¯†ç é…ç½®æ–‡ä»¶ï¼›</li><li>/etc/cobbler/modules.conf ä¸ºæ¨¡å—é…ç½®æ–‡ä»¶ï¼›</li><li>/etc/cobbler/users.confä¸ºCobbler WebUI/Web serviceæˆæƒé…ç½®æ–‡ä»¶ã€‚</li><li>ä¿®æ”¹Cobbleræç¤º</li></ul><p>å¦‚æœä½ æƒ³ä¿®æ”¹Cobblerçš„æç¤ºï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘ä¸‹é¢æ–‡ä»¶ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@test-node1 ~]# vim /etc/cobbler/pxe/pxedefault.template</span></span>
<span class="line"><span style="color:#a6accd">DEFAULT menu</span></span>
<span class="line"><span style="color:#a6accd">PROMPT 0</span></span>
<span class="line"><span style="color:#a6accd">MENU TITLE DevOpsEDU | http://www.devopsedu.com</span></span>
<span class="line"><span style="color:#a6accd">TIMEOUT 200</span></span>
<span class="line"><span style="color:#a6accd">TOTALTIMEOUT 6000</span></span>
<span class="line"><span style="color:#a6accd">ONTIMEOUT $pxe_timeout_profile</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">LABEL local</span></span>
<span class="line"><span style="color:#a6accd">        MENU LABEL (local)</span></span>
<span class="line"><span style="color:#a6accd">        MENU DEFAULT</span></span>
<span class="line"><span style="color:#a6accd">        LOCALBOOT -1</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">$pxe_menu_items</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">MENU end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Cobbleræ•°æ®ç›®å½•/var/lib/cobblerï¼Œ</li></ol><p>æ­¤ç›®å½•å­˜å‚¨å’ŒCobbler profilesã€systemsã€distrosç›¸å…³çš„é…ç½®ã€‚</p><ul><li>configs/ - æ­¤ç›®å½•ç”¨äºå­˜å‚¨distrosã€reposã€systemså’Œprofilesç›¸å…³ä¿¡æ¯ã€‚</li><li>backup/ - å¤‡ä»½ç›®å½•</li><li>snippets/ - ç”¨äºæ”¾ç½®ä¸€äº›å¯ä»¥åœ¨kickstartså¯¼å…¥çš„è„šæœ¬å°ç‰‡æ®µ</li><li>triggers/ - æ­¤ç›®å½•ç”¨æ¥æ”¾ç½®ä¸€äº›å¯æ‰§è¡Œè„šæœ¬</li><li>kickstarts/ - æ­¤ç›®å½•ç”¨æ¥æ”¾ç½®kickstartæ¨¡æ¿æ–‡ä»¶</li><li>Repoæ•°æ®ç›®å½•/var/www/cobbler</li></ul><p>å¯¼å…¥çš„å‘è¡Œç‰ˆï¼Œreposé•œåƒå’Œkickstartæ–‡ä»¶éƒ½æ”¾ç½®åœ¨/var/www/cobblerç›®å½•ä¸‹ã€‚ç¡®ä¿/varç›®å½•æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å­˜å‚¨è¿™äº›æ–‡ä»¶ã€‚</p><ul><li>images/ - å­˜å‚¨æ‰€æœ‰å¯¼å…¥å‘è¡Œç‰ˆçš„Kernelå’Œinitrdé•œåƒç”¨äºè¿œç¨‹ç½‘ç»œå¯åŠ¨</li><li>ks_mirror/ - å­˜å‚¨å¯¼å…¥çš„å‘è¡Œç‰ˆ</li><li>repo_mirror/ - yum reposå­˜å‚¨ç›®å½•</li><li>Cobbleræ—¥å¿—ç›®å½•</li></ul><p>/var/log/cobblerç”¨äºå­˜æ”¾æ—¥å¿—æ–‡ä»¶/var/log/cobbler/cobbler.log</p><h3 $cs="" id="_2-4-2-cobblerè®¾è®¡æ–¹å¼" tabindex="-1">2.4.2 Cobblerè®¾è®¡æ–¹å¼ <a aria-current="page" href="#_2-4-2-cobblerè®¾è®¡æ–¹å¼" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Cobbler æœ‰å¤šä¸ªå¯¹è±¡ç»„æˆçš„ï¼Œå¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´å¯ä»¥ç›¸äº’å¼•ç”¨ï¼š</p><ul><li>Repoï¼ˆå­˜å‚¨åº“ï¼‰ï¼šä¿å­˜ä¸€ä¸ª yum æˆ– rsync å­˜å‚¨åº“çš„é•œåƒä¿¡æ¯ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å°†Zabbixçš„è½¯ä»¶ä»“åº“åŒæ­¥åˆ°æˆ‘ä»¬æœ¬åœ°ï¼Œå°±æ˜¯ä¸€ä¸ªRepoã€‚</li><li>Distroï¼ˆå‘è¡Œç‰ˆï¼‰ï¼šè¡¨ç¤ºä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚å®ƒæ‰¿è½½äº†å†…æ ¸å’Œ initrd çš„ä¿¡æ¯ï¼Œä»¥åŠå†…æ ¸å‚æ•°ç­‰å…¶ä»–æ•°æ®ã€‚</li><li>profileï¼ˆé…ç½®æ–‡ä»¶ï¼‰ï¼šåŒ…å«ä¸€ä¸ªdistroï¼ˆå‘è¡Œç‰ˆï¼‰ã€ä¸€ä¸ª kickstart æ–‡ä»¶ä»¥åŠå¯èƒ½çš„Repoï¼ˆå­˜å‚¨åº“ï¼‰ï¼Œè¿˜åŒ…å«æ›´å¤šç‰¹å®šçš„å†…æ ¸å‚æ•°ç­‰å…¶ä»–æ•°æ®ã€‚</li><li>systemï¼ˆç³»ç»Ÿï¼‰ï¼šè¡¨ç¤ºè¦å®‰è£…çš„æœºå™¨ã€‚å®ƒåŒ…å«ä¸€ä¸ªé…ç½®æ–‡ä»¶æˆ–ä¸€ä¸ªé•œåƒï¼Œè¿˜åŒ…å« IP å’Œ MAC åœ°å€ã€ç”µæºç®¡ç†ï¼ˆåœ°å€ã€å‡­æ®ã€ç±»å‹ï¼‰ä»¥åŠæ›´ä¸ºä¸“ä¸šçš„æ•°æ®ç­‰ä¿¡æ¯ã€‚</li><li>Imageï¼ˆé•œåƒï¼‰ï¼šå¯æ›¿æ¢ä¸€ä¸ªåŒ…å«ä¸å±äºæ­¤ç±»åˆ«çš„æ–‡ä»¶çš„å‘è¡Œç‰ˆå¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œæ— æ³•åˆ†ä¸ºå†…æ ¸å’Œ initrd çš„å¯¹è±¡ï¼‰ã€‚ åŸºäºæ³¨å†Œçš„å¯¹è±¡ä»¥åŠå„ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³è”ï¼ŒCobbler çŸ¥é“å¦‚ä½•æ›´æ”¹æ–‡ä»¶ç³»ç»Ÿä»¥åæ˜ å…·ä½“é…ç½®ã€‚å› ä¸ºç³»ç»Ÿé…ç½®çš„å†…éƒ¨æ˜¯æŠ½è±¡çš„ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ä»…å…³æ³¨æƒ³è¦æ‰§è¡Œçš„æ“ä½œã€‚</li></ul><h3 id="_2-4-3-cobbler-distro" tabindex="-1">2.4.3 Cobbler distro <a aria-current="page" href="#_2-4-3-cobbler-distro" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä½¿ç”¨Cobblerçš„ç¬¬ä¸€æ­¥å°±æ˜¯å®šä¹‰Distroï¼Œå›æƒ³ä¸‹æˆ‘ä»¬æœ€æ—©æ‰§è¡Œçš„cobbler importï¼Œå°±ä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdistroï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler distro list</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Cobbleræ‰€æœ‰çš„å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨helpè¿™æ ·çš„æ–¹å¼è·å–å¸®åŠ©ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler distro help</span></span>
<span class="line"><span style="color:#a6accd">usage</span></span>
<span class="line"><span style="color:#a6accd">=====</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro add</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro copy</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro edit</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro find</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro list</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro remove</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro rename</span></span>
<span class="line"><span style="color:#a6accd">cobbler distro report</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨reportå‘½ä»¤æ¥çœ‹distroéƒ½åŒ…å«å“ªäº›å†…å®¹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler distro report</span></span>
<span class="line"><span style="color:#a6accd">Name                           : CentOS-7.7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">Architecture                   : x86_64</span></span>
<span class="line"><span style="color:#a6accd">TFTP Boot Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Breed                          : redhat</span></span>
<span class="line"><span style="color:#a6accd">Comment                        : </span></span>
<span class="line"><span style="color:#a6accd">Fetchable Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Initrd                         : /var/www/cobbler/ks_mirror/CentOS-7.7-x86_64/images/pxeboot/initrd.img</span></span>
<span class="line"><span style="color:#a6accd">Kernel                         : /var/www/cobbler/ks_mirror/CentOS-7.7-x86_64/images/pxeboot/vmlinuz</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options                 : {}</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options (Post Install)  : {}</span></span>
<span class="line"><span style="color:#a6accd">Kickstart Metadata             : {'tree': 'http://@@http_server@@/cblr/links/CentOS-7.7-x86_64'}</span></span>
<span class="line"><span style="color:#a6accd">Management Classes             : []</span></span>
<span class="line"><span style="color:#a6accd">OS Version                     : rhel7</span></span>
<span class="line"><span style="color:#a6accd">Owners                         : ['admin']</span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Template Files                 : {}</span></span>
<span class="line"><span style="color:#a6accd">  å¯ä»¥çœ‹åˆ°distroå®šä¹‰çš„ä»…ä»…æ˜¯æˆ‘ä»¬è¦å®‰è£…æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆçš„kernelå’Œinitrdã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-4-cobbler-profile" tabindex="-1">2.1.4 Cobbler profile <a aria-current="page" href="#_2-1-4-cobbler-profile" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é‚£ä¹ˆåœ¨cobbler importçš„åŒæ—¶ä¹Ÿé»˜è®¤åˆ›å»ºäº†ä¸€ä¸ªå’ŒdistroåŒåçš„profileï¼Œé‚£ä¹ˆcobbler profileé‡Œé¢åŒ…æ‹¬äº†distributionã€kickstart fileå’Œrepoã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠprofileç†è§£ä¸ºä¸€ä¸ªé…ç½®é›†åˆï¼Œæ¯”å¦‚åœ¨distroçš„åŸºç¡€ä¸Šå¢åŠ å¯ä¸€ä¸ªkiskstartæ–‡ä»¶æ¥ç”Ÿæˆä¸€ä¸ªç‰¹å®šçš„ç³»ç»Ÿå®‰è£…é…ç½®ã€‚ æ¯”å¦‚å‰é¢æˆ‘ä»¬å¤šæ¬¡ä½¿ç”¨cobbler profile editä¸ºæŒ‡å®šçš„Profileè®¾ç½®kickstartæ–‡ä»¶å’Œå†…æ ¸å‚æ•°ï¼Œprofileçš„åç§°å³ä½¿æˆ‘ä»¬åœ¨ä½¿ç”¨cobblerè¿›è¡Œè‡ªåŠ¨åŒ–å®‰è£…é€‰æ‹©çš„èœå•åç§°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler profile report</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-5cobbler-repo" tabindex="-1">2.1.5Cobbler repo <a aria-current="page" href="#_2-1-5cobbler-repo" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Cobbler reposå¯ä»¥å¸®æˆ‘ä»¬ç®¡ç†yumä»“åº“ï¼ŒæŠŠåˆ›å»ºä¼ä¸šå†…éƒ¨çš„yumæºå˜æˆäº†ä¸€ä»¶æå…¶ç®€å•çš„å·¥ä½œï¼Œæ¯”å¦‚é€šå¸¸ç”Ÿæˆç¯å¢ƒæˆ‘ä»¬æƒ³æŠŠEPELä»“åº“åŒæ­¥åˆ°æœ¬åœ°ï¼Œè¿™æ ·å°±é¿å…æ¯æ¬¡å®‰è£…è½¯ä»¶åŒ…å ç”¨å…¬ç½‘è´·æ¬¾ã€‚ æ·»åŠ EPELæºï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># cobbler repo add --name=CentOS-7-x86_64-epel \</span></span>
<span class="line"><span style="color:#a6accd">--mirror=http://mirrors.aliyun.com/epel/7/x86_64/ --arch=x86_64 --breed=wget</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å‚æ•°è¯´æ˜: --name ä¸ºå®‰è£…æºå®šä¹‰ä¸€ä¸ªåå­— --arch æŒ‡å®šå®‰è£…æºæ˜¯32ä½è¿˜æ˜¯64ä½ã€ia64, ç›®å‰æ”¯æŒçš„é€‰é¡¹æœ‰: x86â”‚x86_64â”‚ia64 reposync æ“ä½œå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä¼šä»è¿œç¨‹å­˜å‚¨åº“ä¸­å¤åˆ¶æ–‡ä»¶ã€‚å¦‚æœåˆ›å»ºäº†å­˜å‚¨åº“å¯¹è±¡ä½†æœªè¿è¡Œ reposyncï¼Œé‚£ä¹ˆæ‚¨çš„å­˜å‚¨åº“å°†æ˜¯ç©ºçš„ï¼Œè€Œä¸”æ‚¨çš„å®‰è£…å¯èƒ½ä¼šå¤±è´¥ã€‚ æ ¹æ®éœ€è¦åŒæ­¥çš„ä»“åº“å¤§å°ï¼Œæ³¨æ„ç¡¬ç›˜ç©ºé—´ï¼Œç¬¬ä¸€æ¬¡åŒæ­¥æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå»ºè®®æ”¾åˆ°screené‡Œé¢å…è®¸ã€‚</p><p>æ·»åŠ repoåˆ°profile æŠŠæˆ‘ä»¬è‡ªå®šä¹‰çš„repoæ·»åŠ åˆ°å¯¹åº”çš„profileåï¼Œé‚£ä¹ˆä½¿ç”¨å¯¹åº”profileå®‰è£…çš„æœºå™¨ï¼Œé»˜è®¤å°±ä¼šæ·»åŠ è¯¥repoï¼Œå‰ææ˜¯éœ€è¦è¿›è¡Œè®¾ç½®</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># cobbler profile edit --name=CentOS-7-x86_64 --repos="openstack-liberty"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">yum_post_install_mirror: 1  #é»˜è®¤æ˜¯å¼€å¯çš„ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ·»åŠ æ›´æ–°ä»“åº“æºè®¡åˆ’ä»»åŠ¡ å¦‚æœä½¿ç”¨çš„å¤–åŒ…æºé“¾æ¥ï¼Œå¯ä»¥å®šæœŸçš„è¿›è¡ŒåŒæ­¥ï¼Œæ”¾åœ¨crontabé‡Œé¢æ¯å¤©æ‰§è¡Œã€‚ echo "0 2 0 cobbler reposync --tries=3 --no-fail" &gt;&gt; /var/spool/cron/root</p><p>è®¾ç½®è£…æœºè‡ªåŠ¨è®¾ç½®Yum ä¿®æ”¹ksè„šæœ¬ï¼Œå¢åŠ </p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">%post</span></span>
<span class="line"><span style="color:#a6accd"># Start yum configuration</span></span>
<span class="line"><span style="color:#a6accd">$yum_config_stanza</span></span>
<span class="line"><span style="color:#a6accd"># End yum configuration</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd">è¿™æ ·å¼€æœºçš„æ—¶å€™å°±å¯ä»¥è°ƒç”¨yum_config_stanzaè¿™ä¸ªsnippetsè¿›è¡Œè®¾ç½®äº†ã€‚ç­‰ç­‰ï¼Œè¿™ä¸ªsnippetsæ˜¯ä»€ä¹ˆä¸œä¸œï¼Ÿ</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_2-1-6-cobbler-snippets" tabindex="-1">2.1.6 Cobbler snippets <a aria-current="page" href="#_2-1-6-cobbler-snippets" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>snippetså¯ä»¥è¯´æ˜¯cobblerç®¡ç†ä¸­çš„ç²¾åéƒ¨åˆ†ï¼Œå¾ˆå°‘æœ‰æ–‡æ¡£æåŠï¼Œå› ä¸ºå¤§å¤šæ•°äººä½¿ç”¨ç®€å•çš„cobbleråŠŸèƒ½å·²ç»è¶³å¤Ÿäº†ï¼Œå¦‚æœä½ æƒ³å¯¹å®‰è£…è¿‡ç¨‹å’Œå®‰è£…åè¿›è¡Œå®šåˆ¶ï¼Œå¯ä»¥è‡ªå·±ç¼–å†™Snippetæ¥å®ç°ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å‚è€ƒCobblerè‡ªå¸¦çš„kickstartæ¨¡æ¿ï¼Œç»™æˆ‘ä»¬çš„æ¨¡æ¿å¢åŠ ä¸Šsnippetsçš„åŠŸèƒ½</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /var/lib/cobbler/kickstarts/sample_end.ks</span></span>
<span class="line"><span style="color:#a6accd">%post</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('log_ks_post')</span></span>
<span class="line"><span style="color:#a6accd"># Start yum configuration</span></span>
<span class="line"><span style="color:#a6accd">$yum_config_stanza</span></span>
<span class="line"><span style="color:#a6accd"># End yum configuration</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('post_install_kernel_options')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('post_install_network_config')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('func_register_if_enabled')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('download_config_files')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('koan_environment')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('redhat_register')</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('cobbler_register')</span></span>
<span class="line"><span style="color:#a6accd"># Enable post-install boot notification</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('post_anamon')</span></span>
<span class="line"><span style="color:#a6accd"># Start final steps</span></span>
<span class="line"><span style="color:#a6accd">$SNIPPET('kickstart_done')</span></span>
<span class="line"><span style="color:#a6accd"># End final steps</span></span>
<span class="line"><span style="color:#a6accd">%end</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å°†%postå¼€å§‹åˆ°%endçš„å†…å®¹å¤åˆ¶ä¸‹æ¥ï¼Œç¼–è¾‘åˆ° /var/lib/cobbler/kickstarts/CentOS-7.4-x86_64-Cobbler.cfgæ–‡ä»¶ä¸­ã€‚åœ¨åé¢çš„è‡ªåŠ¨åŒ–å®è·µå’Œé«˜çº§è¯é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚</p><h1 id="_3-cobblerè‡ªåŠ¨åŒ–å®è·µ" tabindex="-1">3 Cobblerè‡ªåŠ¨åŒ–å®è·µ <a aria-current="page" href="#_3-cobblerè‡ªåŠ¨åŒ–å®è·µ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨äº†è§£äº†Cobblerçš„åŸºæœ¬ä½¿ç”¨å’ŒCobblerçš„å„ç§ç»„ä»¶ä¹‹åï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥çµæ´»çš„è¿ç”¨Cobbleræ¥å®Œæˆå¾ˆå¤šè‡ªåŠ¨åŒ–çš„å·¥ä½œã€‚</p><h2 id="_3-1-cobbleræ„å»ºç§æœ‰yumä»“åº“" tabindex="-1">3.1 Cobbleræ„å»ºç§æœ‰YUMä»“åº“ <a aria-current="page" href="#_3-1-cobbleræ„å»ºç§æœ‰yumä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Cobbleré™¤äº†ç”¨æ¥è¿›è¡Œè‡ªåŠ¨åŒ–å®‰è£…ä¹‹å¤–ï¼Œæœ€æ–¹ä¾¿çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯åšYUMä»“åº“äº†ã€‚ä»æ­¤å†ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œåœ¨æœåŠ¡å™¨æ— æ³•ä¸Šå¤–ç½‘çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨å¼€æºå·¥å…·äº†ã€‚è€Œä¸”å¦‚æœä½ éœ€è¦ï¼ŒCobblerå¯ä»¥å¸®ä½ è¿›è¡ŒåŒæ­¥ï¼ŒåŠæ—¶çš„å’Œå®˜æ–¹çš„æºä¿æŒä¸€è‡´ã€‚</p><h3 id="_3-1-1-æ„å»ºopenstackç§æœ‰ä»“åº“" tabindex="-1">3.1.1 æ„å»ºOpenStackç§æœ‰ä»“åº“ <a aria-current="page" href="#_3-1-1-æ„å»ºopenstackç§æœ‰ä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æ·»åŠ OpenStackæºï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo add --name=openstack-queens-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd"> --mirror=http://mirrors.aliyun.com/centos/7.4.1708/cloud/x86_64/openstack-queens/ \</span></span>
<span class="line"><span style="color:#a6accd"> --arch=x86_64 --breed=yum</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯¹äº yum å­˜å‚¨åº“ URLï¼ŒCobbler æ¥å— <a href="http://xn--ftp-3y3b//%E3%80%81rsync://%E3%80%81%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%B7%AF%E5%BE%84%E5%92%8C" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://ã€ftp://ã€rsync://ã€æ–‡ä»¶ç³»ç»Ÿè·¯å¾„å’Œ<!--]--></a> ssh ä½ç½®ï¼ˆé€šè¿‡ä½¿ç”¨åŸºäºç§é’¥çš„èº«ä»½éªŒè¯ï¼‰ã€‚</p><ul><li>httpåè®® æ–¹å¼ï¼šåªèƒ½æ‹‰å–åˆ°æŸä¸€è½¯ä»¶çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ— æ³•æ‹‰å–æ‰€æœ‰ç‰ˆæœ¬ã€‚</li><li>rsyncåè®®æ–¹å¼ï¼šé•œåƒæ–¹å¼ï¼Œå¯ä»¥æ‹‰å–æä¾› rsync æœåŠ¡ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ã€‚</li></ul><p>åŒæ­¥ä»“åº“</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æç¤ºï¼šOpenStack Queensçš„æºåŒæ­¥å®Œæˆå¤§çº¦åœ¨900Må·¦å³ã€‚</p></blockquote><h3 id="_3-1-2-æ„å»ºzabbixç§æœ‰ä»“åº“" tabindex="-1">3.1.2 æ„å»ºZabbixç§æœ‰ä»“åº“ <a aria-current="page" href="#_3-1-2-æ„å»ºzabbixç§æœ‰ä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç”±äºZabbixå®˜æ–¹ä¸æ”¯æŒrsyncçš„æ–¹å¼åŒæ­¥ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨httpçš„æ–¹å¼åŒæ­¥æœ€æ–°ç‰ˆæœ¬çš„æºã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo add --name=zabbix-3.4-rhel7-x86_64  \</span></span>
<span class="line"><span style="color:#a6accd">--mirror=http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo list</span></span>
<span class="line"><span style="color:#a6accd">   zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åŒæ­¥ä»“åº“</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æç¤ºï¼šZabbix 3.4ç‰ˆæœ¬çš„æºåŒæ­¥å®Œæˆå¤§çº¦åœ¨20Må·¦å³ã€‚</p></blockquote><h3 id="_3-1-3-æ„å»ºsaltstackç§æœ‰ä»“åº“" tabindex="-1">3.1.3 æ„å»ºSaltStackç§æœ‰ä»“åº“ <a aria-current="page" href="#_3-1-3-æ„å»ºsaltstackç§æœ‰ä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç”±äºSaltStackçš„å›½å¤–æºç›¸å¯¹æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥ç”Ÿäº§ä¼šä½¿ç”¨Cobbleræ„å»ºå†…éƒ¨æºã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo add --name=saltstack-2018.3-rhel7-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd"> --mirror=https://repo.saltstack.com/yum/redhat/7/x86_64/2018.3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åŒæ­¥ä»“åº“</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æç¤ºï¼šSaltStack 2018.3ç‰ˆæœ¬çš„æºåŒæ­¥å®Œæˆå¤§çº¦åœ¨50Må·¦å³ã€‚</p></blockquote><h3 id="_3-1-4-å°†ç§æœ‰ä»“åº“æ·»åŠ åˆ°profile" tabindex="-1">3.1.4 å°†ç§æœ‰ä»“åº“æ·»åŠ åˆ°Profile <a aria-current="page" href="#_3-1-4-å°†ç§æœ‰ä»“åº“æ·»åŠ åˆ°profile" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler repo list</span></span>
<span class="line"><span style="color:#a6accd">   openstack-queens-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   saltstack-2018.3-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å°†è‡ªå®šä¹‰çš„Repoæ·»åŠ åˆ°å¯¹åº”çš„Profileä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥Profileå®‰è£…å®Œæ¯•çš„è™šæ‹Ÿæœºé»˜è®¤å°±ä¼šå¢åŠ è¿™äº›ä»“åº“çš„é…ç½®ã€‚ æç¤ºï¼šå¿…é¡»æ‰§è¡Œå®Œæ¯•reposyncä¹‹åï¼Œæ‰èƒ½æ·»åŠ åˆ°Profileã€‚å¤šä¸ªrepoä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler profile edit --name CentOS-7.4-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd">--repos="openstack-queens-rhel7-x86_64 saltstack-2018.3-rhel7-x86_64 zabbix-3.4-rhel7-x86_64"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿ç”¨Profile CentOS-7.4-x86_64åˆ›å»ºå‡ºæ¥çš„è™šæ‹Ÿæœºéƒ½ä¼šæœ‰ä¸€ä¸ªcobbler-config.repoæ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@localhost ~]# cd /etc/yum.repos.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@localhost yum.repos.d]# cat cobbler-config.repo </span></span>
<span class="line"><span style="color:#a6accd">[openstack-queens-rhel7-x86_64]</span></span>
<span class="line"><span style="color:#a6accd">name=openstack-queens-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">baseurl=http://192.168.56.11/cobbler/repo_mirror/openstack-queens-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">priority=99</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[saltstack-2018.3-rhel7-x86_64]</span></span>
<span class="line"><span style="color:#a6accd">name=saltstack-2018.3-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">baseurl=http://192.168.56.11/cobbler/repo_mirror/saltstack-2018.3-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">priority=99</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[zabbix-3.4-rhel7-x86_64]</span></span>
<span class="line"><span style="color:#a6accd">name=zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">baseurl=http://192.168.56.11/cobbler/repo_mirror/zabbix-3.4-rhel7-x86_64</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">priority=99</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_3-2-ä½¿ç”¨cobblerè‡ªåŠ¨åŒ–å®‰è£…esxi" tabindex="-1">3.2 ä½¿ç”¨Cobblerè‡ªåŠ¨åŒ–å®‰è£…ESXi <a aria-current="page" href="#_3-2-ä½¿ç”¨cobblerè‡ªåŠ¨åŒ–å®‰è£…esxi" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><ol><li>æŒ‚è½½ESXIé•œåƒå¹¶å¯¼å…¥</li></ol><p>é¦–å…ˆä½¿ç”¨Vmware WorkstationæŒ‚è½½å¯¹åº”çš„ESXié•œåƒï¼Œè¿™é‡Œä½¿ç”¨çš„6.5ç‰ˆæœ¬ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mount /dev/cdrom /mnt/</span></span>
<span class="line"><span style="color:#a6accd">mount: /dev/sr0 is write-protected, mounting read-only</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler import --path=/mnt --name=ESXi6.5 --arch=x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>ä¼šè‡ªåŠ¨ç”Ÿæˆdistroså’Œprofiles</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler list</span></span>
<span class="line"><span style="color:#a6accd">distros:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7.4-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">profiles:</span></span>
<span class="line"><span style="color:#a6accd">   CentOS-7.4-x86_64</span></span>
<span class="line"><span style="color:#a6accd">   ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æŸ¥çœ‹kickstartæ–‡ä»¶</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler profile report --name ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd">Name                           : ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd">TFTP Boot Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Comment                        : </span></span>
<span class="line"><span style="color:#a6accd">DHCP Tag                       : default</span></span>
<span class="line"><span style="color:#a6accd">Distribution                   : ESXi6.5-x86_64</span></span>
<span class="line"><span style="color:#a6accd">Enable gPXE?                   : 0</span></span>
<span class="line"><span style="color:#a6accd">Enable PXE Menu?               : 1</span></span>
<span class="line"><span style="color:#a6accd">Fetchable Files                : {}</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options                 : {}</span></span>
<span class="line"><span style="color:#a6accd">Kernel Options (Post Install)  : {}</span></span>
<span class="line"><span style="color:#a6accd">Kickstart                      : /var/lib/cobbler/kickstarts/sample_esxi6.ks</span></span>
<span class="line"><span style="color:#a6accd">Kickstart Metadata             : {}</span></span>
<span class="line"><span style="color:#a6accd">Management Classes             : []</span></span>
<span class="line"><span style="color:#a6accd">Management Parameters          : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Name Servers                   : []</span></span>
<span class="line"><span style="color:#a6accd">Name Servers Search Path       : []</span></span>
<span class="line"><span style="color:#a6accd">Owners                         : ['admin']</span></span>
<span class="line"><span style="color:#a6accd">Parent Profile                 : </span></span>
<span class="line"><span style="color:#a6accd">Internal proxy                 : </span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Repos                          : []</span></span>
<span class="line"><span style="color:#a6accd">Server Override                : &lt;&lt;inherit&gt;&gt;</span></span>
<span class="line"><span style="color:#a6accd">Template Files                 : {}</span></span>
<span class="line"><span style="color:#a6accd">Virt Auto Boot                 : 1</span></span>
<span class="line"><span style="color:#a6accd">Virt Bridge                    : xenbr0</span></span>
<span class="line"><span style="color:#a6accd">Virt CPUs                      : 1</span></span>
<span class="line"><span style="color:#a6accd">Virt Disk Driver Type          : raw</span></span>
<span class="line"><span style="color:#a6accd">Virt File Size(GB)             : 5</span></span>
<span class="line"><span style="color:#a6accd">Virt Path                      : </span></span>
<span class="line"><span style="color:#a6accd">Virt RAM (MB)                  : 512</span></span>
<span class="line"><span style="color:#a6accd">Virt Type                      : kvm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>ä½¿ç”¨Cobblerå®‰è£…ESXi</li></ol><p>é¦–å…ˆéœ€è¦åŒæ­¥ä¸€ä¸‹</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler sync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åˆ›å»ºè™šæ‹Ÿæœºè¿›è¡Œå®éªŒã€‚</li></ol><h2 id="_3-3-å®šåˆ¶åŒ–æœåŠ¡å™¨å®‰è£…" tabindex="-1">3.3 å®šåˆ¶åŒ–æœåŠ¡å™¨å®‰è£… <a aria-current="page" href="#_3-3-å®šåˆ¶åŒ–æœåŠ¡å™¨å®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="_3-3-1-è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹æ¢³ç†" tabindex="-1">3.3.1 è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹æ¢³ç† <a aria-current="page" href="#_3-3-1-è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹æ¢³ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ul><li>é‡‡è´­è®¾å¤‡é€åˆ°æœºæˆ¿ã€‚</li><li>æœºæˆ¿åŒäº‹ï¼Œå¼€æœºï¼Œæ’ç”µéªŒæ”¶ï¼ŒéªŒæ”¶å®Œæ¯•ã€‚</li><li>è¿›è¡ŒCMDBèµ„äº§å½•å…¥ã€‚æä¾›æœºå™¨ä½ç½®å’ŒMACåœ°å€åˆ—è¡¨ï¼ˆä¾›åº”å•†ä¹Ÿå¯ä»¥æä¾›ï¼‰</li><li>è°ƒç”¨IPMIå¼€æœºï¼ŒCobbler APIå®‰è£…æ“ä½œç³»ç»Ÿã€‚</li><li>å®‰è£…å®Œæ¯•ï¼Œå¯åŠ¨åï¼Œè‡ªåŠ¨å¯åŠ¨SaltStackã€‚ç„¶åå‰©ä¸‹çš„ä»¥SaltStackä¸ºæ ¸å¿ƒäº†ã€‚</li></ul><p>è¯´æ˜ï¼š æœåŠ¡å™¨ç½‘å¡å¿…é¡»æ”¯æŒPXEåŠŸèƒ½ å®šåˆ¶åŒ– è‡³å°‘æœ‰è¿™ä¹ˆå‡ ä¸ªï¼šç½‘ç»œé…ç½®ï¼ŒHostname è¿™äº› æ³¨æ„ï¼š å¦‚æœä¸å®šåˆ¶åŒ–ï¼Œç½‘å¡é€šè¿‡PXEå¯åŠ¨åï¼Œä¼šå‡ºç°ä¸€ä¸ªèœå•ä¾›äººé€‰æ‹©ç”¨å“ªä¸ªé…ç½®ï¼ˆå…¶å®å°±æ˜¯Profileçš„åå­—ï¼‰è€Œä¸”æ¯ä¸ªå®‰è£…æº éƒ½æœ‰è‡ªå·±çš„é»˜è®¤KSæ–‡ä»¶ï¼Œè¶…è¿‡æ—¶é—´åï¼Œä¼šæŒ‡å®šä½¿ç”¨é»˜è®¤çš„ KSæ–‡ä»¶ è¿›è¡Œå®‰è£…æœ¬æ–‡ä¸»è¦è®¨è®º è‡ªåŠ¨åŒ–ä¸€é”®éƒ¨ç½²ï¼Œæ‰€ä»¥å¿…é¡»è¦åšå®šåˆ¶åŒ– è¿™éƒ¨åˆ†çš„æ“ä½œ ä¸»è¦é€šè¿‡ cobbler system æ¥å®ç°</p><h3 id="_3-3-2-cobblerè·å–å®‰è£…è¿›åº¦" tabindex="-1">3.3.2 Cobblerè·å–å®‰è£…è¿›åº¦ <a aria-current="page" href="#_3-3-2-cobblerè·å–å®‰è£…è¿›åº¦" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åé¢æœ‰ç« èŠ‚ä»‹ç»å¦‚ä½•é€šè¿‡Cobbler APIæ¥è°ƒç”¨Cobblerï¼Œåœ¨å¼€å§‹è¿›è¡Œç³»ç»Ÿå®šåˆ¶å®‰è£…ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªéœ€æ±‚å°±æ˜¯éœ€è¦æƒ³çŸ¥é“å®‰è£…è¿›åº¦ã€‚é’ˆå¯¹äºåŸºäºRedhatçš„Linuxå‘è¡Œç‰ˆçš„ç³»ç»Ÿå®‰è£…ç¨‹åºå«åšAnacondaï¼ŒCobbleræä¾›äº†å¯¹Anacondaçš„ç›‘æ§ï¼Œä»è€Œè·å–å®‰è£…è¿›åº¦ã€‚</p><ol><li><p>å¼€å¯Anacondaç›‘æ§</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">anamon_enabled: 1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p>é‡å¯Cobbler</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart cobblerd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æŸ¥çœ‹Kickstartæ–‡ä»¶ç¡®ä¿å¯¹åº”çš„snippetå­˜åœ¨ ``` %pre $SNIPPET('pre_anamon')</li></ol><p>%post $SNIPPET('post_anamon')</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">3. è¿›è¡Œç³»ç»Ÿå®‰è£…åï¼Œä¼šåœ¨/var/log/cobbler/anamon/ä¸‹åˆ›å»ºå¯¹åº”çš„Systemç›®å½•</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>[root@linux-node1 ~]# tree /var/log/cobbler/anamon/ /var/log/cobbler/anamon/ â””â”€â”€ cobbler-api-test â”œâ”€â”€ anaconda.log â”œâ”€â”€ boot.log â”œâ”€â”€ dmesg â”œâ”€â”€ ks-post.log â”œâ”€â”€ ks-pre.log â”œâ”€â”€ messages â”œâ”€â”€ program.log â”œâ”€â”€ storage.log â””â”€â”€ sys.log</p><p>1 directory, 9 files</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">### 3.3.3 Cobbler systemå®šåˆ¶å®‰è£…</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Cobbler systemæ˜¯Cobbleræä¾›çš„å¯ä»¥ç”¨æ¥è¿›è¡Œç³»ç»Ÿå®šåˆ¶çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Cobbler systemæ¥å®šåˆ¶å¾…å®‰è£…æœåŠ¡å™¨çš„IPåœ°å€ã€ä¸»æœºåç­‰æ“ä½œã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1. æ·»åŠ ä¸€ä¸ªä¸»æœº</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>[root@linux-node1 ~]# cobbler system add --name=linux-node3 --mac=00:50:56:3F:84:4F \ --profile=CentOS-7.4-x86_64 --ip-address=192.168.56.110 --subnet=255.255.255.0 \ --gateway=192.168.56.2 --interface=eth0 --static=1 --hostname=<a href="http://new.devopsedu.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->new.devopsedu.com<!--]--></a> \ --name-servers="192.168.56.2" \ --kickstart=/var/lib/cobbler/kickstarts/CentOS-7.4-x86_64-Cobbler.cfg</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">- --name=linux-node3   #è®¾ç½®ä¸€ä¸ªä¸»æœºåç§°</span></span>
<span class="line"><span style="color:#a6accd">- --mac=08:00:27:67:A0:BB  #è®¾ç½®å¯¹åº”çš„MACåœ°å€</span></span>
<span class="line"><span style="color:#a6accd">- --profile=CentOS-7.4-x86_64  #è®¾ç½®éœ€è¦å®‰è£…çš„æ“ä½œç³»ç»Ÿ</span></span>
<span class="line"><span style="color:#a6accd">- --ip-address=192.168.56.13 #è®¾ç½®ä¸€ä¸ªé™æ€IPåœ°å€</span></span>
<span class="line"><span style="color:#a6accd">- --subnet=255.255.255.0    #è®¾ç½®å­ç½‘æ©ç </span></span>
<span class="line"><span style="color:#a6accd">- --gateway=192.168.56.2    #è®¾ç½®ç½‘å…³</span></span>
<span class="line"><span style="color:#a6accd">- --interface=eth0 \          è®¾ç½®ç½‘å¡</span></span>
<span class="line"><span style="color:#a6accd">- --static=1                 è®¾ç½®é™æ€IP</span></span>
<span class="line"><span style="color:#a6accd">- --dns-name=linux-node3.example.com  #è®¾ç½®dns name</span></span>
<span class="line"><span style="color:#a6accd">- --hostname=linux-node3.example.com  #è®¾ç½®ä¸»æœºå</span></span>
<span class="line"><span style="color:#a6accd">- --netboot-enabled=true #è®¾ç½®ç½‘ç»œå¯åŠ¨</span></span>
<span class="line"><span style="color:#a6accd">- --name-servers="192.168.56.2" #è®¾ç½®DNSåŸŸåæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">2. æŸ¥çœ‹ä¸»æœº</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>[root@linux-node1 ~]# cobbler system list linux-node3 ``` ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å¯åŠ¨è™šæ‹Ÿæœºï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–å®‰è£…ï¼Œä¸å†å‡ºç°é€‰æ‹©çš„èœå•ï¼Œç›´æ¥å®‰è£…ä½ åˆ¶å®šçš„æ“ä½œç³»ç»Ÿã€‚</p><h1 id="_4-cobbleré«˜çº§è¯é¢˜" tabindex="-1">4 Cobbleré«˜çº§è¯é¢˜ <a aria-current="page" href="#_4-cobbleré«˜çº§è¯é¢˜" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨å®é™…çš„å·¥ä½œç¯å¢ƒä¸­ï¼ŒCobblerè¿˜æœ‰å¾ˆå¤šé«˜çº§çš„åº”ç”¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¿«çš„è¿›è¡Œæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²å·¥ä½œã€‚ä¾‹å¦‚ç½‘å¡ç»‘å®šã€ç”µæºç®¡ç†å’ŒCobbler APIç­‰ã€‚</p><h2 id="_4-1-è‡ªå®šä¹‰ç‰©ç†ç½‘å¡bonding" tabindex="-1">4.1 è‡ªå®šä¹‰ç‰©ç†ç½‘å¡bonding <a aria-current="page" href="#_4-1-è‡ªå®šä¹‰ç‰©ç†ç½‘å¡bonding" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><ol><li>æ·»åŠ ä¸€å°ä¸»æœºlinux-node4</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system add --name=linux-node4 --profile=CentOS-7.7-x86_64 \</span></span>
<span class="line"><span style="color:#a6accd"> --hostname=new.devopsedu.com \</span></span>
<span class="line"><span style="color:#a6accd"> --name-servers="192.168.56.2" \</span></span>
<span class="line"><span style="color:#a6accd"> --kickstart=/var/lib/cobbler/kickstarts/CentOS-7.7-x86_64-Cobbler.cfg</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æ·»åŠ bondingç½‘å¡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node4 --interface=eth0 \</span></span>
<span class="line"><span style="color:#a6accd"> --mac=00:50:56:27:F0:07 --interface-type=bond_slave --interface-master=bond0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æ·»åŠ bondingç½‘å¡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node4 --interface=eth1 \</span></span>
<span class="line"><span style="color:#a6accd"> --mac=00:50:56:36:09:66 --interface-type=bond_slave --interface-master=bond0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è®¾ç½®ç»‘å®šç½‘å¡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node4 --interface=bond0 \</span></span>
<span class="line"><span style="color:#a6accd"> --interface-type=bond --bonding-opts="miimon=100 mode=1" \</span></span>
<span class="line"><span style="color:#a6accd"> --ip-address=192.168.56.111 --subnet=255.255.255.0 --gateway=192.168.56.2 --static=1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¥½çš„ï¼Œä¸‡äº‹å…·å¤‡ï¼Œå°±å·®å¼€æœºå®‰è£…æ“ä½œç³»ç»Ÿäº†ã€‚ç­‰ç­‰ï¼Œæ€ä¹ˆå¼€æœºå‘¢ï¼Ÿæ—¢ç„¶æ˜¯è‡ªåŠ¨åŒ–å®‰è£…ï¼Œæ‰“ç”µè¯è®©æœºæˆ¿å€¼ç­äººå‘˜å¸®æˆ‘ä»¬å¼€æœºå½“ç„¶æ˜¯ä¸åˆé€‚çš„ï¼Œè¿˜è®°å¾—IPMIå—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨IPMIæ¥è¿›è¡Œç”µæºç®¡ç†ã€‚</p><ol><li>ç½‘å¡ç»‘å®šåçš„æ•ˆæœ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@new ~]# cat /proc/net/bonding/bond0 </span></span>
<span class="line"><span style="color:#a6accd">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Bonding Mode: fault-tolerance (active-backup)</span></span>
<span class="line"><span style="color:#a6accd">Primary Slave: None</span></span>
<span class="line"><span style="color:#a6accd">Currently Active Slave: eth0</span></span>
<span class="line"><span style="color:#a6accd">MII Status: up</span></span>
<span class="line"><span style="color:#a6accd">MII Polling Interval (ms): 100</span></span>
<span class="line"><span style="color:#a6accd">Up Delay (ms): 0</span></span>
<span class="line"><span style="color:#a6accd">Down Delay (ms): 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Slave Interface: eth0</span></span>
<span class="line"><span style="color:#a6accd">MII Status: up</span></span>
<span class="line"><span style="color:#a6accd">Speed: 1000 Mbps</span></span>
<span class="line"><span style="color:#a6accd">Duplex: full</span></span>
<span class="line"><span style="color:#a6accd">Link Failure Count: 0</span></span>
<span class="line"><span style="color:#a6accd">Permanent HW addr: 00:50:56:27:f0:07</span></span>
<span class="line"><span style="color:#a6accd">Slave queue ID: 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Slave Interface: eth1</span></span>
<span class="line"><span style="color:#a6accd">MII Status: up</span></span>
<span class="line"><span style="color:#a6accd">Speed: 1000 Mbps</span></span>
<span class="line"><span style="color:#a6accd">Duplex: full</span></span>
<span class="line"><span style="color:#a6accd">Link Failure Count: 0</span></span>
<span class="line"><span style="color:#a6accd">Permanent HW addr: 00:50:56:36:09:66</span></span>
<span class="line"><span style="color:#a6accd">Slave queue ID: 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_4-2-cobblerç”µæºç®¡ç†" tabindex="-1">4.2 Cobblerç”µæºç®¡ç† <a aria-current="page" href="#_4-2-cobblerç”µæºç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>è¦ç®¡ç†æœåŠ¡å™¨çš„ç”µæºï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨IPMIå‘½ä»¤è¿›è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨cobbleré—´æ¥çš„è°ƒç”¨IPMIè¿›è¡Œæ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹Cobblerä½¿ç”¨IPMIè¿›è¡Œç”µæºç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨cobblerçš„settingsé…ç½®çœ‹åˆ°ä»¥ä¸‹é…ç½®ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/cobbler/settings</span></span>
<span class="line"><span style="color:#a6accd">power_management_default_type: 'ipmitool'</span></span>
<span class="line"><span style="color:#a6accd">power_template_dir: "/etc/cobbler/power"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cobbler system edit --name=linux-node3 --power-address=192.168.0.21 --power-type='ipmilan' --power-user=ipmi --power-pass=ipmi</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æœåŠ¡å™¨ç”µæºç®¡ç†ï¼š</p><ul><li>cobbler system poweroff</li><li>cobbler system poweron</li><li>cobbler system powerstatus</li><li>cobbler system reboot</li></ul><p>é‡å¯ä»PXEå¼•å¯¼å¯åŠ¨ï¼Œå¹¶æŒ‡å®šå®‰è£…çš„æ“ä½œç³»ç»Ÿé…ç½®ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼Œ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@log-node1 ~]# cobbler system edit  --name=host-188116  --netboot-enabled=1 --profile=centos5.8-x86_64</span></span>
<span class="line"><span style="color:#a6accd">[root@log-node1 ~]# cobbler reposync</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_4-3-cobbler-apiä½¿ç”¨" tabindex="-1">4.3 Cobbler APIä½¿ç”¨ <a aria-current="page" href="#_4-3-cobbler-apiä½¿ç”¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><ol><li><p>è¿æ¥Cobbler</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat cobbler.py </span></span>
<span class="line"><span style="color:#a6accd">#!/usr/bin/env python</span></span>
<span class="line"><span style="color:#a6accd">import xmlrpclib</span></span>
<span class="line"><span style="color:#a6accd">server = xmlrpclib.Server("http://192.168.56.11/cobbler_api")</span></span>
<span class="line"><span style="color:#a6accd">print server.get_distros()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_profiles()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_systems()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_images()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_repos()</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>ç™»å½•Cobbler</p></li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ç”¨ç™»å½•Cobblerå°±å¯ä»¥è·å–åˆ°Cobblerçš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœéœ€è¦è¿›è¡Œæ“ä½œï¼Œå°±éœ€è¦ç™»å½•ã€‚ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•åï¼ŒCobblerä¼šè¿”å›ä¸€ä¸ªtokenä»¤ç‰Œï¼Œåé¢çš„æ“ä½œï¼Œæˆ‘ä»¬è°ƒç”¨ä»»ä½•ä¸€ä¸ªCobblerçš„æ–¹æ³•ï¼Œéƒ½éœ€è¦å°†tokenä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat cobbler.py </span></span>
<span class="line"><span style="color:#a6accd">#!/usr/bin/env python</span></span>
<span class="line"><span style="color:#a6accd">import xmlrpclib</span></span>
<span class="line"><span style="color:#a6accd">server = xmlrpclib.Server("http://192.168.56.11/cobbler_api")</span></span>
<span class="line"><span style="color:#a6accd">print server.get_distros()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_profiles()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_systems()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_images()</span></span>
<span class="line"><span style="color:#a6accd">print server.get_repos()</span></span>
<span class="line"><span style="color:#a6accd">token = server.login("cobbler","devopsedu.com")</span></span>
<span class="line"><span style="color:#a6accd">print(token)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">ä¸€ä¸ªæ·»åŠ ä¸»æœºçš„ä¾‹å­</span></span>
<span class="line"><span style="color:#a6accd">#!/usr/bin/env python </span></span>
<span class="line"><span style="color:#a6accd"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#a6accd">import xmlrpclib </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">class CobblerAPI(object):</span></span>
<span class="line"><span style="color:#a6accd">    def __init__(self,url,user,password):</span></span>
<span class="line"><span style="color:#a6accd">        self.cobbler_user= user</span></span>
<span class="line"><span style="color:#a6accd">        self.cobbler_pass = password</span></span>
<span class="line"><span style="color:#a6accd">        self.cobbler_url = url</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">    def add_system(self,hostname,ip_add,mac_add,profile):</span></span>
<span class="line"><span style="color:#a6accd">        '''</span></span>
<span class="line"><span style="color:#a6accd">        Add Cobbler System Infomation</span></span>
<span class="line"><span style="color:#a6accd">        '''</span></span>
<span class="line"><span style="color:#a6accd">        ret = {</span></span>
<span class="line"><span style="color:#a6accd">            "result": True,</span></span>
<span class="line"><span style="color:#a6accd">            "comment": [],</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">        #get token</span></span>
<span class="line"><span style="color:#a6accd">        remote = xmlrpclib.Server(self.cobbler_url) </span></span>
<span class="line"><span style="color:#a6accd">        token = remote.login(self.cobbler_user,self.cobbler_pass) </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">        #add system</span></span>
<span class="line"><span style="color:#a6accd">        system_id = remote.new_system(token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,"name",hostname,token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,"hostname",hostname,token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,'modify_interface', { </span></span>
<span class="line"><span style="color:#a6accd">            "macaddress-eth0" : mac_add, </span></span>
<span class="line"><span style="color:#a6accd">            "ipaddress-eth0" : ip_add, </span></span>
<span class="line"><span style="color:#a6accd">            "dnsname-eth0" : hostname, </span></span>
<span class="line"><span style="color:#a6accd">        }, token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.modify_system(system_id,"profile",profile,token) </span></span>
<span class="line"><span style="color:#a6accd">        remote.save_system(system_id, token) </span></span>
<span class="line"><span style="color:#a6accd">        try:</span></span>
<span class="line"><span style="color:#a6accd">            remote.sync(token)</span></span>
<span class="line"><span style="color:#a6accd">        except Exception as e:</span></span>
<span class="line"><span style="color:#a6accd">            ret['result'] = False</span></span>
<span class="line"><span style="color:#a6accd">            ret['comment'].append(str(e))</span></span>
<span class="line"><span style="color:#a6accd">        return ret</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">def main():</span></span>
<span class="line"><span style="color:#a6accd">    cobbler = CobblerAPI("http://192.168.56.11/cobbler_api","cobbler","devopsedu.com")</span></span>
<span class="line"><span style="color:#a6accd">    ret = cobbler.add_system(hostname='cobbler-api-test',ip_add='192.168.56.111',mac_add='00:50:56:25:C2:AA',profile='CentOS-7.4-x86_64')</span></span>
<span class="line"><span style="color:#a6accd">    print ret</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">if __name__ == '__main__':</span></span>
<span class="line"><span style="color:#a6accd">    main()</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="ç¬¬äºŒéƒ¨åˆ†-kvmå’ŒopenstackåŸºç¡€" tabindex="-1">ç¬¬äºŒéƒ¨åˆ† KVMå’ŒOpenStackåŸºç¡€ <a aria-current="page" href="#ç¬¬äºŒéƒ¨åˆ†-kvmå’ŒopenstackåŸºç¡€" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="äº‘è®¡ç®—æ¦‚è¿°" tabindex="-1">äº‘è®¡ç®—æ¦‚è¿° <a aria-current="page" href="#äº‘è®¡ç®—æ¦‚è¿°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨ç¬¬ä¸€ç« ï¼Œä¼šä»‹ç»ä»€ä¹ˆæ˜¯äº‘è®¡ç®—ï¼Ÿä»€ä¹ˆæ˜¯è™šæ‹ŸåŒ–ï¼Ÿä»¥åŠäº‘è®¡ç®—ä¸è™šæ‹ŸåŒ–çš„å…³ç³»ï¼Œç„¶åè®²è§£ç›®å‰æ¯”è¾ƒæµè¡Œçš„è™šæ‹ŸåŒ–é¡¹ç›®ï¼šKVMï¼Œäº†è§£KVMè™šæ‹ŸåŒ–çš„åŸºæœ¬æ¦‚å¿µï¼Œä½¿ç”¨KVMåˆ›å»ºå¹¶ç®¡ç†è™šæ‹Ÿæœºï¼Œä¸ºå­¦ä¹ OpenStackæ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p><h2 id="äº‘è®¡ç®—æ¦‚è¿°-1" tabindex="-1">äº‘è®¡ç®—æ¦‚è¿° <a aria-current="page" href="#äº‘è®¡ç®—æ¦‚è¿°-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä»»ä½•äº‹ç‰©çš„å‡ºç°éƒ½æ˜¯æœ‰èƒŒæ™¯çš„ï¼Œäº‘è®¡ç®—ä¹Ÿä¸ä¾‹å¤–ã€‚äº‘è®¡ç®—æ˜¯ç”±éœ€æ±‚é©±åŠ¨çš„ï¼Œé¦–å…ˆè®©æˆ‘ä»¬çœ‹çœ‹æ²¡æœ‰äº‘è®¡ç®—ä¹‹å‰æˆ‘ä»¬éƒ½é¢ä¸´ä»€ä¹ˆé—®é¢˜ã€‚</p><p><strong>ä¼ ç»Ÿæ•°æ®ä¸­å¿ƒé¢ä¸´çš„é—®é¢˜ï¼Ÿ</strong></p><ul><li>èµ„æºåˆ©ç”¨ç‡ä½ï¼šèµ„æºåˆ©ç”¨ç‡ä½æ˜¯æ•°æ®ä¸­å¿ƒç›®å‰æ™®éå­˜åœ¨çš„é—®é¢˜ï¼Œå¤šé¡¹è°ƒæŸ¥æ•°æ®è¡¨æ˜ä¼ä¸šæ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨çš„å¹³å‡åˆ©ç”¨ç‡æ™®éä½äº15%ã€‚</li><li>èµ„æºåˆ†é…ä¸åˆç†ï¼šç³»ç»Ÿç»Ÿå»ºè®¾ç›¸å¯¹ç‹¬ç«‹ã€å„è‡ªä¸ºæ”¿ï¼Œå…¶åŸºç¡€è®¾æ–½ç›¸å½“äºä¸€ä¸ªä¸ªç‹¬ç«‹çš„â€œå­¤å²›â€ï¼Œå› æ­¤å¾ˆéš¾ä»æ•´ä½“çš„è§’åº¦è€ƒè™‘ITåŸºç¡€æ¶æ„çš„èµ„æºåˆ†é…åŠä½¿ç”¨çš„åˆç†æ€§ã€‚</li><li>è‡ªåŠ¨åŒ–èƒ½åŠ›å·®ï¼šèµ„æºé…ç½®å’Œéƒ¨ç½²è¿‡ç¨‹å¤šé‡‡ç”¨äººå·¥æ–¹å¼ï¼Œæ²¡æœ‰ç›¸åº”çš„å¹³å°æ”¯æŒï¼Œä½¿å¤§é‡äººåŠ›èµ„æºè€—è´¹åœ¨ç¹é‡çš„é‡å¤æ€§å·¥ä½œä¸Šï¼Œæ²¡æœ‰è‡ªæœåŠ¡å’Œè‡ªåŠ¨éƒ¨ç½²çš„èƒ½åŠ›ã€‚</li></ul><p><strong>ä»€ä¹ˆæ˜¯äº‘è®¡ç®—ï¼Ÿ</strong></p><p>äº‘è®¡ç®—ï¼ˆCloud Computingï¼‰æ˜¯åŸºäºäº’è”ç½‘çš„ç›¸å…³æœåŠ¡çš„å¢åŠ ã€ä½¿ç”¨å’Œäº¤ä»˜æ¨¡å¼ã€‚ å¥½å§ï¼Œæˆ‘æ‰¿è®¤ï¼å¦‚æœä½ æŠŠä¸Šé¢é‚£å¥è¯å‘Šè¯‰ä¸šå†…äººå‘˜ï¼Œä¼°è®¡åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†äººå¯ä»¥ç†è§£ï¼Œæ›´ä¸ç”¨è¯´éä¸šå†…äººå£«äº†ã€‚å¯¹äº‘è®¡ç®—çš„å®šä¹‰æœ‰å¤šç§è¯´æ³•ã€‚å¯¹äºåˆ°åº•ä»€ä¹ˆæ˜¯äº‘è®¡ç®—,ç›®å‰å¹¿ä¸ºæ¥å—çš„æ˜¯ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰å®šä¹‰ï¼šäº‘è®¡ç®—æ˜¯ä¸€ç§æŒ‰ä½¿ç”¨é‡ä»˜è´¹çš„æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æä¾›å¯ç”¨çš„ã€ä¾¿æ·çš„ã€æŒ‰éœ€çš„ç½‘ç»œè®¿é—®ï¼Œè¿›å…¥å¯é…ç½®çš„è®¡ç®—èµ„æºå…±äº«æ± ï¼ˆèµ„æºåŒ…æ‹¬ç½‘ç»œï¼ŒæœåŠ¡å™¨ï¼Œå­˜å‚¨ï¼Œåº”ç”¨è½¯ä»¶ï¼ŒæœåŠ¡ï¼‰ï¼Œè¿™äº›èµ„æºèƒ½å¤Ÿè¢«å¿«é€Ÿæä¾›ï¼Œåªéœ€æŠ•å…¥å¾ˆå°‘çš„ç®¡ç†å·¥ä½œï¼Œæˆ–ä¸æœåŠ¡ä¾›åº”å•†è¿›è¡Œå¾ˆå°‘çš„äº¤äº’ã€‚</p><p><strong>ç”¨æ¯”è¾ƒå¥½ç†è§£çš„æ–¹å¼è§£é‡Šå°±æ˜¯ï¼š</strong></p><ol><li>æ˜¯ä»€ä¹ˆï¼šäº‘è®¡ç®—æŒ‡çš„æ˜¯ä¸€ç§æ¨¡å¼ã€‚</li><li>ä½¿ç”¨æ–¹æ³•ï¼šäº‘è®¡ç®—çš„å¿…é¡»é€šè¿‡ç½‘ç»œæ¥ä½¿ç”¨ã€‚</li><li>ç‰¹ç‚¹å’Œä¼˜åŠ¿ï¼šå¼¹æ€§è®¡ç®—ã€æŒ‰éœ€ä»˜è´¹ã€å¿«é€Ÿæ‰©å±•ï¼Œä¹Ÿå°±æ˜¯ä½ ç”¨å¤šå°‘ï¼Œä»˜å¤šå°‘é’±ã€‚åŒæ—¶ä¹Ÿä¸ç”¨å…³å¿ƒåŸºç¡€è®¾æ–½çš„ç®¡ç†ï¼Œç”±äº‘è®¡ç®—ä¾›åº”å•†æä¾›ã€‚</li></ol><h3 id="äº‘è®¡ç®—çš„åˆ†ç±»" tabindex="-1">äº‘è®¡ç®—çš„åˆ†ç±» <a aria-current="page" href="#äº‘è®¡ç®—çš„åˆ†ç±»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æ ¹æ®äº‘è®¡ç®—æœåŠ¡æ€§è´¨çš„ä¸åŒ,å¯ä»¥å°†äº‘è®¡ç®—åŒºåˆ†ä¸ºå…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ï¼Œå¦‚å›¾1-1</p><p>ï¼ˆå›¾1-1ï¼‰</p><p><strong>å…¬æœ‰äº‘</strong></p><p>æ˜¯å°†æ­å»ºå¥½çš„äº‘èµ„æºæ± æ”¾åˆ°Internetä¸Šï¼Œæ‰€æœ‰æœ‰ä½¿ç”¨æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥æŒ‰éœ€ä½¿ç”¨ã€‚ç›¸å¯¹äºç§æœ‰äº‘ï¼Œå…¬æœ‰äº‘çš„æ‰€æœ‰è€…æ˜¯æä¾›å•†ï¼Œä¼ä¸šç”¨æˆ·åªæ˜¯å…·å¤‡ä½¿ç”¨æƒã€‚ ä¼˜åŠ¿ï¼šäº‘è®¡ç®—çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯å…¶è§„æ¨¡ç»æµæ•ˆç›Šï¼Œå¤§å¤šæ•°ä¼ä¸šé€‰æ‹©äº‘è®¡ç®—æ–¹æ¡ˆæ˜¯å‡ºäºæˆæœ¬è€ƒè™‘ï¼Œé‚£ä¹ˆå…¬æœ‰äº‘ä¸éœ€è¦æŠ•å…¥åŸºç¡€å»ºè®¾ï¼Œå¯ä»¥å®ç°æŒ‰éœ€ä»˜è´¹ï¼Œéšæ—¶ä½¿ç”¨ã€‚</p><p><strong>ç§æœ‰äº‘</strong> æ˜¯ä¸ºä¸€ä¸ªå®¢æˆ·å•ç‹¬ä½¿ç”¨è€Œæ„å»ºçš„ä¸€å¥—IAASï¼ˆåŸºç¡€è®¾æ–½æ—¢æœåŠ¡ï¼‰ï¼Œä¼ä¸šå¯ä»¥å¯¹æ•°æ®ã€å®‰å…¨æ€§å’ŒæœåŠ¡è´¨é‡è¿›è¡Œæœ€æœ‰æ•ˆæ§åˆ¶ã€‚è¯¥å…¬å¸æ‹¥æœ‰åŸºç¡€è®¾æ–½ï¼Œå¹¶å¯ä»¥æ§åˆ¶åœ¨æ­¤åŸºç¡€è®¾æ–½ä¸Šéƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚ç§æœ‰äº‘å¯éƒ¨ç½²åœ¨ä¼ä¸šæ•°æ®ä¸­å¿ƒçš„é˜²ç«å¢™å†…ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬éƒ¨ç½²åœ¨ä¸€ä¸ªå®‰å…¨çš„ä¸»æœºæ‰˜ç®¡åœºæ‰€ã€‚ ä¼˜åŠ¿ï¼šæ•°æ®å®‰å…¨å¯¹äºä¼ä¸šæ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå…¬æœ‰äº‘æœåŠ¡å­˜åœ¨è¾ƒå¤§çš„å®‰å…¨éšæ‚£ï¼Œå…¬æœ‰äº‘å¹³å°åªé€‚åˆé‚£äº›éå…³é”®æ€§ä¸šåŠ¡ã€‚å°¤å…¶æ˜¯å¤§å‹ä¼ä¸šä¼šæ›´å¤šåœ°å€¾å‘äºé€‰æ‹©ç§æœ‰äº‘è®¡ç®—å¹³å°ã€‚</p><p><strong>æ··åˆäº‘</strong> æŒ‡å…¬æœ‰äº‘å’Œç§æœ‰äº‘çš„æ··åˆï¼Œå¤§å¤šæ•°æ˜¯æŒ‡åœ¨ç§æœ‰äº‘æ­å»ºå¥½è‡ªåï¼Œç”±äºä¸šåŠ¡å‘å±•ç­‰åŸå› ï¼Œèµ„æºéœ€æ±‚é‡è¶…è¿‡äº†èµ„æºæ± ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ç”³è¯·ä½¿ç”¨å…¬æœ‰äº‘ä½œä¸ºç§æœ‰äº‘çš„è¡¥å……ã€‚ ä¼˜åŠ¿ï¼šæ··åˆäº‘æ—¢å¯ä»¥å°½å¯èƒ½å¤šåœ°å‘æŒ¥äº‘è®¡ç®—ç³»ç»Ÿçš„è§„æ¨¡ç»æµæ•ˆç›Šï¼ŒåŒæ—¶åˆå¯ä»¥ä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚å¯¹äºä¸æ˜¯å¾ˆæ•æ„Ÿçš„éå…³é”®ä¸šåŠ¡å¯ä»¥ç”±æ··åˆäº‘ä¸­çš„å…¬æœ‰æ¨¡å—å®ç°ï¼Œè€Œå¯¹é‚£äº›å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨åˆ™å¯ä»¥è¿ç§»åˆ°ç§æœ‰æ¨¡å—å®ç°ã€‚ å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ä¸‰ç§äº‘è®¡ç®—æ¨¡å¼å¹¶ä¸ä¼šè°å–ä»£è°ï¼Œè°ä¼˜è¿‡è°ã€‚ä¸åŒä¼ä¸šã€ä¸åŒéœ€æ±‚ï¼Œéœ€è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ä¼šé•¿æœŸå…±å­˜ï¼Œä¼˜åŠ¿äº’è¡¥ï¼Œå…±åŒæœåŠ¡äºä¼ä¸šç”¨æˆ·ã€‚</p><h3 id="äº‘è®¡ç®—çš„åˆ†å±‚" tabindex="-1">äº‘è®¡ç®—çš„åˆ†å±‚ <a aria-current="page" href="#äº‘è®¡ç®—çš„åˆ†å±‚" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å¦‚æœä½ ç†è§£äº†ä»€ä¹ˆæ˜¯äº‘è®¡ç®—ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒæ¡ï¼Œäº‘åŸºç¡€æ˜¯åˆ†å±‚çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†äº‘è®¡ç®—åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯Infrastructureï¼ˆåŸºç¡€è®¾æ–½ï¼‰-as-a- Serviceï¼ŒPlatformï¼ˆå¹³å°ï¼‰-as-a-Serviceï¼ŒSoftwareï¼ˆè½¯ä»¶ï¼‰-as-a-Serviceã€‚åŸºç¡€è®¾æ–½åœ¨æœ€ä¸‹ç«¯ï¼Œå¹³å°åœ¨ä¸­é—´ï¼Œè½¯ä»¶åœ¨é¡¶ç«¯ã€‚</p><p>ï¼ˆå›¾1-6ï¼‰ IaaS(Infrastructure as a Serviceï¼ŒåŸºç¡€æ¶æ„å³æœåŠ¡)é€šè¿‡äº’è”ç½‘æä¾›äº†æ•°æ®ä¸­å¿ƒã€åŸºç¡€æ¶æ„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æºã€‚IaaSå¯ä»¥æä¾›æœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿã€ç£ç›˜å­˜å‚¨ã€æ•°æ®åº“å’Œ/æˆ–ä¿¡æ¯èµ„æºã€‚æœ€é«˜ç«¯IaaSçš„ä»£è¡¨äº§å“æ˜¯äºšé©¬é€Šçš„AWS(Elastic Compute Cloud)ï¼Œä¸è¿‡IBMã€Vmwareå’Œæƒ æ™®ä»¥åŠå…¶ä»–ä¸€äº›ä¼ ç»ŸITå‚å•†ä¹Ÿæä¾›è¿™ç±»çš„æœåŠ¡ã€‚å›½å†…çš„è¯é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€é’äº‘ã€ç››å¤§äº‘ç­‰ä»£è¡¨ã€‚ IaaSé€šå¸¸ä¼šæŒ‰ç…§"å¼¹æ€§äº‘"çš„æ¨¡å¼å¼•å…¥å…¶ä»–çš„ä½¿ç”¨å’Œè®¡ä»·æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ä»»ä½•ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´ï¼Œéƒ½åªä½¿ç”¨ä½ éœ€è¦çš„æœåŠ¡ï¼Œå¹¶ä¸”åªä¸ºä¹‹ä»˜è´¹ã€‚æˆ‘ä»¬è¦è®²çš„OpenStackå°±æ˜¯IAASçš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥ç”¨æ¥æ„å»ºå…¬æœ‰äº‘æˆ–è€…ç§æœ‰äº‘ã€‚ PaaS(Platform as a Serviceï¼Œå¹³å°å³æœåŠ¡)æä¾›äº†åŸºç¡€æ¶æ„ï¼Œè½¯ä»¶å¼€å‘è€…å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€æ¶æ„ä¹‹ä¸Šå»ºè®¾æ–°çš„åº”ç”¨ï¼Œæˆ–è€…æ‰©å±•å·²æœ‰çš„åº”ç”¨ï¼ŒåŒæ—¶å´ä¸å¿…è´­ä¹°å¼€å‘ã€è´¨é‡æ§åˆ¶æˆ–ç”Ÿäº§æœåŠ¡å™¨ã€‚Googleçš„App Engineå’Œæ–°æµªçš„SAEéƒ½é‡‡ç”¨äº†PASSçš„æ¨¡å¼ã€‚è¿™äº›å¹³å°å…è®¸å…¬å¸åˆ›å»ºä¸ªæ€§åŒ–çš„åº”ç”¨ï¼Œä¹Ÿå…è®¸ç‹¬ç«‹è½¯ä»¶å‚å•†æˆ–è€…å…¶ä»–çš„ç¬¬ä¸‰æ–¹æœºæ„é’ˆå¯¹å‚ç›´ç»†åˆ†è¡Œä¸šåˆ›é€ æ–°çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬è¦è®²çš„Dockerå¯ä»¥ç”¨æ¥æ„å»ºPAASå¹³å°ï¼Œç™¾åº¦çš„PAASå¹³å°æ ¸å¿ƒå°±æ˜¯åŸºäºDockerã€‚ SaaS(Software as a Serviceï¼Œè½¯ä»¶å³æœåŠ¡)æ˜¯æœ€ä¸ºæˆç†Ÿã€æœ€å‡ºåï¼Œä¹Ÿæ˜¯å¾—åˆ°æœ€å¹¿æ³›åº”ç”¨çš„ä¸€ç§äº‘è®¡ç®—ã€‚å¤§å®¶å¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ç§è½¯ä»¶åˆ†å¸ƒæ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåº”ç”¨è½¯ä»¶å®‰è£…åœ¨å‚å•†æˆ–è€…æœåŠ¡ä¾›åº”å•†é‚£é‡Œï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æŸä¸ªç½‘ç»œæ¥ä½¿ç”¨è¿™äº›è½¯ä»¶ï¼Œé€šå¸¸ä½¿ç”¨çš„ç½‘ç»œæ˜¯äº’è”ç½‘ã€‚è¿™ç§æ¨¡å¼é€šå¸¸ä¹Ÿè¢«ç§°ä¸º"éšéœ€åº”å˜(on demand)"è½¯ä»¶ï¼Œè¿™æ˜¯æœ€æˆç†Ÿçš„äº‘è®¡ç®—æ¨¡å¼ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼å…·æœ‰é«˜åº¦çš„çµæ´»æ€§ã€å·²ç»è¯æ˜å¯é çš„æ”¯æŒæœåŠ¡ã€å¼ºå¤§çš„å¯æ‰©å±•æ€§ï¼Œå› æ­¤èƒ½å¤Ÿé™ä½å®¢æˆ·çš„ç»´æŠ¤æˆæœ¬å’ŒæŠ•å…¥ï¼Œè€Œä¸”ç”±äºè¿™ç§æ¨¡å¼çš„å¤šå®—æ—¨å¼çš„åŸºç¡€æ¶æ„ï¼Œè¿è¥æˆæœ¬ä¹Ÿå¾—ä»¥é™ä½ã€‚Googleçš„Gmailå’ŒJiraéƒ½æ˜¯SAASçš„æ¨¡å¼ã€‚</p><h2 id="äº‘è®¡ç®—ä¸è™šæ‹ŸåŒ–" tabindex="-1">äº‘è®¡ç®—ä¸è™šæ‹ŸåŒ– <a aria-current="page" href="#äº‘è®¡ç®—ä¸è™šæ‹ŸåŒ–" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>é¦–å…ˆè¯·å¤§å®¶ä¸è¦æŠŠè™šæ‹ŸåŒ–å’Œæˆ‘ä»¬ä¹‹å‰è®²è§£çš„äº‘è®¡ç®—è¿›è¡Œè”æƒ³ï¼Œå…ˆå…¥ä¸ºä¸»å¾ˆå®¹æ˜“è®©æˆ‘ä»¬é™·å…¥æ¦‚å¿µçš„è¯¯åŒºï¼Œè®©æˆ‘æ¥ä»£ç†å¤§å®¶ææ˜ç™½äº‘è®¡ç®—ä¸è™šæ‹ŸåŒ–çš„æ©æ©æ€¨æ€¨ã€‚å› ä¸ºæåˆ°äº‘è®¡ç®—å°±ä¸å¾—ä¸æåˆ°è™šæ‹ŸåŒ–ï¼Œç”šè‡³è¯´å¾ˆå¤šäººå°†äº‘è®¡ç®—å’Œè™šæ‹ŸåŒ–æ··ä¸ºä¸€è°ˆï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚å¥½çš„ï¼Œç­”æ¡ˆæœ‰äº†ï¼Œäº‘è®¡ç®—ä¸ç­‰äºè™šæ‹ŸåŒ–ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå‘¢ï¼Ÿ è™šæ‹ŸåŒ–ï¼Œæ˜¯æŒ‡é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯å°†ä¸€å°è®¡ç®—æœºè™šæ‹Ÿä¸ºå¤šå°é€»è¾‘è®¡ç®—æœºã€‚åœ¨ä¸€å°è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªé€»è¾‘è®¡ç®—æœºï¼Œæ¯ä¸ªé€»è¾‘è®¡ç®—æœºå¯è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºéƒ½å¯ä»¥åœ¨ç›¸äº’ç‹¬ç«‹çš„ç©ºé—´å†…è¿è¡Œè€Œäº’ä¸å½±å“ï¼Œä»è€Œæ˜¾è‘—æé«˜è®¡ç®—æœºçš„å·¥ä½œæ•ˆç‡ã€‚å¦‚å›¾1.1.1æ‰€ç¤ºï¼š</p><p>ï¼ˆå›¾1-1ï¼‰</p><h3 id="å…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–" tabindex="-1">å…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ– <a aria-current="page" href="#å…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>è™šæ‹ŸåŒ–æŠ€æœ¯æ ¹æ®ç‰¹ç‚¹ï¼Œå¯ä»¥åˆ†ä¸ºå…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–ã€‚ å…¨è™šæ‹ŸåŒ–ï¼ˆFull Virtualization)ï¼Œ æ˜¯åŸå§‹è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œè¯¥æ¨¡å‹ä½¿ç”¨è™šæ‹Ÿæœºåè°ƒguestæ“ä½œç³»ç»Ÿå’ŒåŸå§‹ç¡¬ä»¶ï¼ŒVMMï¼ˆVirtual Machine Monitorï¼‰åœ¨GuestOSå’Œè£¸ç¡¬ä»¶ä¹‹é—´ç”¨äºå·¥ä½œåè°ƒï¼Œä¸€äº›å—ä¿æŠ¤æŒ‡ä»¤å¿…é¡»ç”±Hypervisorï¼ˆè™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼‰æ¥æ•è·å¤„ç†ï¼Œå¦‚å›¾1-2ã€‚</p><p>ï¼ˆå›¾1-2ï¼‰ KVMæ˜¯å…¨è™šæ‹ŸåŒ–çš„å…¸å‹ä»£è¡¨ï¼ŒKVMæ˜¯é›†æˆåˆ°Linuxå†…æ ¸çš„Hypervisorï¼Œæ˜¯X86æ¶æ„ä¸”ç¡¬ä»¶æ”¯æŒè™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆIntel VTæˆ–AMD-Vï¼‰çš„Linuxçš„å…¨è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚å®ƒæ˜¯Linuxçš„ä¸€ä¸ªå¾ˆå°çš„æ¨¡å—ï¼Œåˆ©ç”¨Linuxåšå¤§é‡çš„äº‹ï¼Œå¦‚ä»»åŠ¡è°ƒåº¦ã€å†…å­˜ç®¡ç†ä¸ç¡¬ä»¶è®¾å¤‡äº¤äº’ç­‰ï¼Œå¦‚å›¾1-3ã€‚</p><p>åŠè™šæ‹ŸåŒ–ï¼ˆPara Virtualizationï¼‰ï¼Œæ˜¯å¦ä¸€ç§ç±»ä¼¼äºå…¨è™šæ‹ŸåŒ–çš„æŠ€æœ¯ï¼Œå®ƒä½¿ç”¨Hypervisoråˆ†äº«å­˜å–åº•å±‚çš„ç¡¬ä»¶ï¼Œä½†æ˜¯å®ƒçš„guestæ“ä½œç³»ç»Ÿé›†æˆäº†è™šæ‹ŸåŒ–æ–¹é¢çš„ä»£ç ã€‚è¯¥æ–¹æ³•æ— éœ€é‡æ–°ç¼–è¯‘æˆ–å¼•èµ·é™·é˜±ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè‡ªèº«èƒ½å¤Ÿä¸è™šæ‹Ÿè¿›ç¨‹è¿›è¡Œå¾ˆå¥½çš„åä½œã€‚åŠè™šæ‹ŸåŒ–éœ€è¦guestæ“ä½œç³»ç»Ÿåšä¸€äº›ä¿®æ”¹ï¼Œä½¿guestæ“ä½œç³»ç»Ÿæ„è¯†åˆ°è‡ªå·±æ˜¯å¤„äºè™šæ‹ŸåŒ–ç¯å¢ƒçš„ï¼Œä½†æ˜¯åŠè™šæ‹ŸåŒ–æä¾›äº†ä¸åŸæ“ä½œç³»ç»Ÿç›¸è¿‘çš„æ€§èƒ½ï¼Œå¦‚å›¾1-4ã€‚</p><p>ï¼ˆå›¾1-4ï¼‰ åŠè™šæ‹ŸåŒ–çš„ä¸€ä¸ªå…¸å‹ä»£è¡¨æ˜¯Xenã€‚Xenæ˜¯ç¬¬ä¸€ç±»è¿è¡Œåœ¨è£¸æœºä¸Šçš„è™šæ‹ŸåŒ–ç®¡ç†ç¨‹åº(Hypervisor)ã€‚å®ƒæ”¯æŒå…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–,Xenæ”¯æŒhypervisorå’Œè™šæ‹Ÿæœºäº’ç›¸é€šè®¯ã€‚Xenæœ€é‡è¦çš„ä¼˜åŠ¿åœ¨äºåŠè™šæ‹ŸåŒ–ï¼Œæ­¤å¤–æœªç»ä¿®æ”¹çš„æ“ä½œç³»ç»Ÿä¹Ÿå¯ä»¥ç›´æ¥åœ¨xenä¸Šè¿è¡Œ(å¦‚Windows)ï¼Œèƒ½è®©è™šæ‹Ÿæœºæœ‰æ•ˆè¿è¡Œè€Œä¸éœ€è¦ä»¿çœŸï¼Œå› æ­¤è™šæ‹Ÿæœºèƒ½æ„ŸçŸ¥åˆ°hypervisorï¼Œè€Œä¸éœ€è¦æ¨¡æ‹Ÿè™šæ‹Ÿç¡¬ä»¶ï¼Œä»è€Œèƒ½å®ç°é«˜æ€§èƒ½ï¼Œå¦‚å›¾1-5ã€‚</p><p>ï¼ˆå›¾1-5ï¼‰ åœ¨Xenç¯å¢ƒä¸­ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†ã€‚ ä¸€ä¸ªæ˜¯è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰ï¼Œä¹Ÿå«hypervisorã€‚Hypervisorå±‚ç¡¬ä»¶ä¸è™šæ‹Ÿæœºä¹‹é—´ï¼Œæœ€å…ˆè¢«è½½å…¥åˆ°ç¡¬ä»¶çš„ç¬¬ä¸€å±‚ã€‚ Hypervisorè½½å…¥å°±å¯éƒ¨ç½²è™šæ‹Ÿæœºã€‚åœ¨Xenä¸­ï¼Œè™šæ‹Ÿæœºå«åšDomainã€‚åœ¨è¿™äº›è™šæ‹Ÿæœºä¸­ï¼ŒDomain0å…·æœ‰å¾ˆé«˜çš„ç‰¹æƒ,è´Ÿè´£ä¸€äº›ä¸“é—¨çš„å·¥ä½œã€‚ç”±äºhypervisorä¸­ä¸åŒ…å«ä»»ä½•ä¸ç¡¬ä»¶å¯¹è¯çš„é©±åŠ¨ï¼Œä¹Ÿæ²¡æœ‰ä¸ç®¡ç†å‘˜å¯¹è¯çš„æ¥å£ï¼Œè¿™äº›é©±åŠ¨å°±ç”± domain0æ¥æä¾›äº†ã€‚é€šè¿‡domain0ï¼Œç®¡ç†å‘˜å¯ä»¥åˆ©ç”¨ä¸€äº›Xenå·¥å…·æ¥åˆ›å»ºå…¶å®ƒè™šæ‹Ÿæœºï¼ˆDomainUï¼‰ã€‚è¿™äº›domainUå±äºæ— ç‰¹æƒdomainã€‚</p><h3 id="è™šæ‹ŸåŒ–åˆ†ç±»" tabindex="-1">è™šæ‹ŸåŒ–åˆ†ç±» <a aria-current="page" href="#è™šæ‹ŸåŒ–åˆ†ç±»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åˆšæ‰ä»ç±»å‹ä¸­æŠŠè™šæ‹ŸåŒ–åˆ†ä¸ºå…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–ï¼Œä»ä½¿ç”¨åœºæ™¯ä¸­è¿›è¡ŒåŒºåˆ†ï¼Œè™šæ‹ŸåŒ–å¯ä»¥åˆ†ä¸ºæœåŠ¡å™¨è™šæ‹ŸåŒ–ã€æ¡Œé¢è™šæ‹ŸåŒ–å’Œåº”ç”¨è™šæ‹ŸåŒ–ã€‚æ›´è¯¦ç»†çš„æ ¹æ®èµ„æºçš„ä¸åŒè¿˜æå‡ºäº†ç½‘ç»œè™šæ‹ŸåŒ–ã€å­˜å‚¨è™šæ‹ŸåŒ–ç­‰ã€‚ æœåŠ¡å™¨è™šæ‹ŸåŒ–æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ–¹å¼ï¼Œæˆ‘ä»¬é€šè¿‡KVMã€Xenã€VMWARE ESXiç­‰è½¯ä»¶å°†æˆ‘ä»¬çš„æœåŠ¡å™¨è™šæ‹Ÿæˆå¤šä¸ªæ¥ä½¿ç”¨ï¼Œæé«˜ç¡¬ä»¶çš„ä½¿ç”¨æ•ˆç‡ã€‚ä¸ç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥ä½¿ç”¨æœç´¢å¼•æ“æ¥è·å–ç›¸å…³çŸ¥è¯†ï¼Œç›®å‰æˆ‘çš„ç”Ÿäº§ç¯å¢ƒè¿˜ç¨³å®šçš„è¿è¡Œç€æ•°å¹´å‰çš„ESXiã€‚</p><p><strong>æ¡Œé¢è™šæ‹Ÿ</strong></p><p>åŒ–æ˜¯æŒ‡å°†è®¡ç®—æœºçš„ç»ˆç«¯ç³»ç»Ÿï¼ˆä¹Ÿç§°ä½œæ¡Œé¢ï¼‰è¿›è¡Œè™šæ‹ŸåŒ–ï¼Œä»¥è¾¾åˆ°æ¡Œé¢ä½¿ç”¨çš„å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚å¯ä»¥é€šè¿‡ä»»ä½•è®¾å¤‡ï¼Œåœ¨ä»»ä½•åœ°ç‚¹ï¼Œä»»ä½•æ—¶é—´é€šè¿‡ç½‘ç»œè®¿é—®å±äºæˆ‘ä»¬ä¸ªäººçš„æ¡Œé¢ç³»ç»Ÿã€‚ç›®å‰åœ¨ä¸­å°ä¼ä¸šå¹¶æ²¡æœ‰å®Œå…¨æ™®åŠï¼Œä¸»è¦ç”¨äºITå¤–åŒ…ã€å‘¼å«ä¸­å¿ƒã€ç§»åŠ¨æ¡Œé¢ç­‰ï¼Œå› ä¸ºåœ¨æ˜¾ç¤ºæ–¹é¢å¯¹äºä½æˆæœ¬çš„è§£å†³æ–¹æ¡ˆæ•ˆæœå¹¶ä¸å¥½ï¼Œæ•ˆæœå¥½çš„åˆå§‹é‡‡è´­æˆæœ¬è¾ƒé«˜ã€‚ æ¡Œé¢è™šæ‹ŸåŒ–ä¾èµ–äºæœåŠ¡å™¨è™šæ‹ŸåŒ–ï¼Œé¦–å…ˆåœ¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ä¸Šè¿›è¡ŒæœåŠ¡å™¨è™šæ‹ŸåŒ–ï¼Œç”Ÿæˆå¤§é‡çš„ç‹¬ç«‹çš„æ¡Œé¢æ“ä½œç³»ç»Ÿï¼ˆæ¯”å¦‚Win7ï¼‰ï¼ŒåŒæ—¶æ ¹æ®ä¸“æœ‰çš„è™šæ‹Ÿæ¡Œé¢åè®®å‘é€ç»™ç»ˆç«¯è®¾å¤‡ï¼ˆä¾‹å¦‚RDPã€VNCã€Spiceåè®®ï¼‰ã€‚ç”¨æˆ·ç»ˆç«¯é€šè¿‡ä»¥å¤ªç½‘ç™»é™†åˆ°è™šæ‹Ÿä¸»æœºä¸Šï¼Œåªéœ€è¦è®°ä½ç”¨æˆ·åå’Œå¯†ç åŠç½‘å…³ä¿¡æ¯ï¼Œå³å¯éšæ—¶éšåœ°çš„é€šè¿‡ç½‘ç»œè®¿é—®è‡ªå·±çš„æ¡Œé¢ç³»ç»Ÿï¼Œä»è€Œå®ç°å•æœºå¤šç”¨æˆ·ã€‚ é€šè¿‡ä¸IAASçš„ç»“åˆï¼Œæ¡Œé¢è™šæ‹ŸåŒ–ä¹Ÿæ¼”å˜æˆæ¡Œé¢äº‘ï¼ˆDAAS ï¼šDesktop As a Serviceï¼‰.IAASæä¾›åŸºç¡€èµ„æºå¹³å°ï¼Œæ¡Œé¢è™šæ‹ŸåŒ–å’Œäº‘å¹³å°çš„å®Œç¾èåˆè¾¾åˆ°ç±»ä¼¼äºSAASä¸€æ ·çš„æ•ˆæœï¼Œè¿™ä¾¿æ˜¯DAASã€‚</p><p><strong>åº”ç”¨è™šæ‹ŸåŒ–</strong></p><p>æ¯”è¾ƒç®€å•çš„è§£é‡Šå°±æ˜¯é€šè¿‡è™šæ‹ŸåŒ–è½¯ä»¶å®ç°ä¼ ç»ŸC/Sç»“æ„çš„è½¯ä»¶é€šè¿‡Webæµè§ˆå™¨è¿›è¡Œäº¤ä»˜ã€‚åœ¨ç”¨æˆ·è®¿é—®ä¸€ä¸ªæœåŠ¡å™¨è™šæ‹ŸåŒ–åçš„åº”ç”¨æ—¶ï¼Œç”¨æˆ·è®¡ç®—æœºåªéœ€è¦æŠŠäººæœºäº¤äº’é€»è¾‘ä¼ é€åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ä¸ºç”¨æˆ·å¼€è®¾ç‹¬ç«‹çš„ä¼šè¯ç©ºé—´ï¼Œåº”ç”¨ç¨‹åºçš„è®¡ç®—é€»è¾‘åœ¨è¿™ä¸ªä¼šè¯ç©ºé—´ä¸­è¿è¡Œï¼ŒæŠŠå˜åŒ–åçš„äººæœºäº¤äº’é€»è¾‘ä¼ é€ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”åœ¨å®¢æˆ·ç«¯ç›¸åº”è®¾å¤‡å±•ç¤ºå‡ºæ¥ï¼Œä»è€Œä½¿ç”¨æˆ·è·å¾—å¦‚åŒè¿è¡Œæœ¬åœ°åº”ç”¨ç¨‹åºä¸€æ ·çš„è®¿é—®æ„Ÿå—ã€‚æ¯”å¦‚æˆ‘æ›¾ç»ä½¿ç”¨è¿‡Cirtrixå…¬å¸çš„Xenappè¿™æ¬¾åº”ç”¨è™šæ‹ŸåŒ–äº§å“ï¼Œå®ç°ERPå®¢æˆ·ç«¯çš„æµè§ˆå™¨äº¤ä»˜ã€‚ ç»è¿‡ä¸Šé¢çš„ç†è§£ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥çœ‹å‡ºï¼Œä»è¡¨é¢æ¥çœ‹è™šæ‹ŸåŒ–æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œé‚£ä¹ˆäº‘è®¡ç®—æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚äº‘è®¡ç®—é‡Œé¢åŒ…å«äº†å¾ˆå¤šçš„æŠ€æœ¯ï¼Œä¹ŸåŒ…æ‹¬è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚äº‘è®¡ç®—æ˜¯å’ŒæœåŠ¡ç›¸å…³çš„ï¼Œè™šæ‹ŸåŒ–æ˜¯ç›¸å¯¹äºç‰©ç†è®¾å¤‡çš„ã€‚æ‰€ä»¥è¯´è™šæ‹ŸåŒ–ç»ä¸æ˜¯äº‘è®¡ç®—ã€‚è€Œäº‘è®¡ç®—åˆ™è¿œè¿œè¶…å‡ºäº†è™šæ‹ŸåŒ–çš„èŒƒç•´ã€‚</p><h3 id="äº‘è®¡ç®—ä¸ç­‰äºè™šæ‹ŸåŒ–" tabindex="-1">äº‘è®¡ç®—ä¸ç­‰äºè™šæ‹ŸåŒ– <a aria-current="page" href="#äº‘è®¡ç®—ä¸ç­‰äºè™šæ‹ŸåŒ–" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç»è¿‡ä¹‹å‰å¯¹äº‘è®¡ç®—å’Œè™šæ‹ŸåŒ–çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—å‡ºç­”æ¡ˆï¼šäº‘è®¡ç®—ä¸ç­‰äºè™šæ‹ŸåŒ–ï¼Œäº‘è®¡ç®—å®è´¨ä¸Šæ˜¯æ ¹æ®éœ€è¦é€šè¿‡ Internet äº¤ä»˜å…±äº«è®¡ç®—èµ„æºã€‚äº‘è®¡ç®—å¯ä»¥é€šè¿‡è™šæ‹ŸåŒ–æ¥å®ç°ï¼Œåƒä¸‡ä¸è¦ä»¥ä¸ºäº‘è®¡ç®—å°±æ˜¯è™šæ‹ŸåŒ–ã€‚æˆ‘ä»¬å†æ€»ç»“ä¸€ä¸‹ï¼Œäº‘è®¡ç®—æ˜¯ä¸€ç§èµ„æºä½¿ç”¨å’Œäº¤ä»˜æ–¹å¼ï¼Œè™šæ‹ŸåŒ–æ˜¯ä¸€ç§å…·ä½“çš„æŠ€æœ¯å®ç°ã€‚ä½†æ˜¯å‘¢ï¼Œäº‘è®¡ç®—çš„å…·ä½“å®ç°éœ€è¦ä½¿ç”¨åˆ°è™šæ‹ŸåŒ–è¿™é¡¹æŠ€æœ¯ã€‚</p><h1 id="_2-kvmè™šæ‹ŸåŒ–å®æˆ˜" tabindex="-1">2 KVMè™šæ‹ŸåŒ–å®æˆ˜ <a aria-current="page" href="#_2-kvmè™šæ‹ŸåŒ–å®æˆ˜" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>å¯ç¿»é˜…www.xoxoyun.cnåšå®¢å…¶ä»–KVMæ–‡ç« è¿›è¡Œå­¦ä¹ </p><h1 id="_3-openstackå…¥é—¨å®æˆ˜" tabindex="-1">3 OpenStackå…¥é—¨å®æˆ˜ <a aria-current="page" href="#_3-openstackå…¥é—¨å®æˆ˜" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨OpenStackå…¥é—¨å®æˆ˜ç« èŠ‚ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šä»‹ç»OpenStackçš„å†å²ã€æ¶æ„ã€‚ç„¶åé€šè¿‡éƒ¨ç½²ä¸€ä¸ªä¸¤ä¸ªèŠ‚ç‚¹çš„OpenStacké›†ç¾¤æ¥å­¦ä¹ OpenStackçš„åŸºç¡€ç»„å»ºã€‚åŒ…æ‹¬</p><ul><li>OpenStackå…±äº«æœåŠ¡MySQLã€RabbitMQã€Memcached</li><li>OpenStackéªŒè¯æœåŠ¡Keystone</li><li>OpenStacké•œåƒæœåŠ¡Glance</li><li>OpenStackè®¡ç®—æœåŠ¡Nova</li><li>OpenSTackç½‘ç»œæœåŠ¡Neutron</li><li>OpenStackç®¡ç†èŠ‚ç›®Horizon</li></ul><h1 id="_1-1-openstackä»‹ç»" tabindex="-1">1.1 OpenStackä»‹ç» <a aria-current="page" href="#_1-1-openstackä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>OpenStack æ˜¯ç”± Rackspace å’Œ NASAï¼ˆç¾å›½å®‡èˆªå±€ï¼‰ å…±åŒå¼€å‘çš„äº‘è®¡ç®—å¹³å°ï¼Œæ˜¯äº‘è®¡ç®—ä¸­IAASçš„å¼€æºå®ç°ã€‚é€šè¿‡Apacheè®¸å¯è¯æˆæƒå¼€æ”¾æºç ï¼Œå®ƒå¯ä»¥å¸®åŠ©æœåŠ¡å•†å’Œä¼ä¸šå®ç°ç±»ä¼¼äºAmazon EC2å’ŒS3çš„äº‘åŸºç¡€æ¶æ„æœåŠ¡ã€‚</p><p>OpenStackæ˜¯ä¸€ä¸ªäº‘å¹³å°ç®¡ç†çš„é¡¹ç›®ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªè½¯ä»¶ã€‚OpenStackæ˜¯ä¸€ä¸ªå¯ä»¥ç®¡ç†æ•´ä¸ªæ•°æ®ä¸­å¿ƒé‡Œå¤§é‡èµ„æºæ± çš„äº‘æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬è®¡ç®—ã€å­˜å‚¨åŠç½‘ç»œèµ„æºã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ç®¡ç†å°ç®¡ç†æ•´ä¸ªç³»ç»Ÿï¼Œå¹¶å¯ä»¥é€šè¿‡webæ¥å£ä¸ºç”¨æˆ·åˆ’å®šèµ„æºã€‚ç”±ä»¥ä¸Šå¯ä»¥çŸ¥é“OpenStackçš„ä¸»è¦ç›®æ ‡æ˜¯ç®¡ç†æ•°æ®ä¸­å¿ƒçš„èµ„æºï¼Œç®€åŒ–èµ„æºåˆ†æ´¾ã€‚å®ƒç®¡ç†ä¸‰éƒ¨åˆ†èµ„æºï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><p>è®¡ç®—èµ„æºï¼šOpenStackå¯ä»¥è§„åˆ’å¹¶ç®¡ç†å¤§é‡äº‘ä¸»æœºï¼Œä»è€Œå…è®¸ä¼ä¸šæˆ–æœåŠ¡æä¾›å•†æŒ‰éœ€æä¾›è®¡ç®—èµ„æºï¼›å¼€å‘è€…å¯ä»¥é€šè¿‡APIè®¿é—®è®¡ç®—èµ„æºä»è€Œåˆ›å»ºäº‘åº”ç”¨ï¼Œç®¡ç†å‘˜ä¸ç”¨æˆ·åˆ™å¯ä»¥é€šè¿‡webè®¿é—®è¿™äº›èµ„æºï¼›</p></li><li><p>å­˜å‚¨èµ„æºï¼šOpenStackå¯ä»¥ä¸ºäº‘æœåŠ¡æˆ–äº‘åº”ç”¨æä¾›æ‰€éœ€çš„å¯¹è±¡åŠå—å­˜å‚¨èµ„æºï¼›å› å¯¹æ€§èƒ½åŠä»·æ ¼æœ‰éœ€æ±‚ï¼Œå¾ˆå¤šç»„ç»‡å·²ç»ä¸èƒ½æ»¡è¶³äºä¼ ç»Ÿçš„ä¼ä¸šçº§å­˜å‚¨æŠ€æœ¯ï¼Œå› æ­¤OpenStackå¯ä»¥æ ¹æ®ç”¨æˆ·éœ€è¦æä¾›å¯é…ç½®çš„å¯¹è±¡å­˜å‚¨æˆ–å—å­˜å‚¨åŠŸèƒ½ï¼›</p></li><li><p>ç½‘ç»œèµ„æºï¼šå¦‚ä»Šçš„æ•°æ®ä¸­å¿ƒå­˜åœ¨å¤§é‡çš„è®¾ç½®ï¼Œå¦‚æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡ã€å­˜å‚¨è®¾å¤‡ã€å®‰å…¨è®¾å¤‡è€Œå®ƒä»¬è¿˜å°†è¢«åˆ’åˆ†æˆæ›´å¤šçš„è™šæ‹Ÿè®¾å¤‡æˆ–è™šæ‹Ÿç½‘ç»œï¼›è¿™ä¼šå¯¼è‡´IPåœ°å€çš„æ•°é‡ã€è·¯ç”±é…ç½®ã€å®‰å…¨è§„åˆ™å°†çˆ†ç‚¸å¼å¢é•¿ï¼›ä¼ ç»Ÿçš„ç½‘ç»œç®¡ç†æŠ€æœ¯æ— æ³•çœŸæ­£çš„å¯é«˜æ‰©å±•ã€é«˜è‡ªåŠ¨åŒ–åœ°ç®¡ç†ä¸‹ä¸€ä»£ç½‘ç»œï¼›å› è€ŒOpenStackæä¾›äº†æ’ä»¶å¼ã€å¯æ‰©å±•ã€APIé©±åŠ¨å‹çš„ç½‘ç»œåŠIPç®¡ç†ï¼› OpenStacké€šè¿‡æ•´åˆç›¸å…³çš„ä¸€ç»„æœåŠ¡ï¼Œæä¾›äº†åŸºç¡€è®¾æ–½å³æœåŠ¡ï¼ˆIaaSï¼‰çš„è§£å†³æ–¹æ¡ˆã€‚æ¯ä¸ªæœåŠ¡æä¾›äº†ä¸€ç»„åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰æ¥ä¿ƒè¿›ä»–ä»¬ä¹‹é—´çš„æ•´åˆã€‚ä½ å¯ä»¥æ ¹æ®æ‚¨çš„éœ€è¦ï¼Œé€‰æ‹©å®‰è£…è¿™äº›æœåŠ¡ä¸­çš„ä¸€äº›æˆ–å…¨éƒ¨ã€‚</p></li></ul><h1 id="_3-2-openstackç¯å¢ƒå‡†å¤‡" tabindex="-1">3.2 OpenStackç¯å¢ƒå‡†å¤‡ <a aria-current="page" href="#_3-2-openstackç¯å¢ƒå‡†å¤‡" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="_3-2-1-openstackå®æˆ˜æ¡ˆä¾‹" tabindex="-1">3.2.1 OpenStackå®æˆ˜æ¡ˆä¾‹ <a aria-current="page" href="#_3-2-1-openstackå®æˆ˜æ¡ˆä¾‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä»æœ¬ç« å¼€å§‹ï¼Œå¼€å§‹ä»‹ç»OpenStackçš„å„ä¸ªç»„ä»¶ï¼Œä¸ºäº†è®©è¯»è€…æ›´ç›´è§‚çš„äº†è§£ç»„ä»¶çš„ä½œç”¨å’Œç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°†é€šè¿‡ç†è®ºå’Œå®è·µéƒ¨ç½²ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œè®²è§£ã€‚ è¯·å‚è€ƒã€Šå®éªŒç¯å¢ƒã€‹æ¥å®Œæˆæœ¬å®ä¾‹çš„ç¯å¢ƒå‡†å¤‡å·¥ä½œã€‚</p><p>ä¸‹å›¾æ˜¯æˆ‘ä»¬å¿«é€Ÿå­¦ä¹ OpenStackçš„å®æˆ˜æ¶æ„å›¾ï¼Œç›®æ ‡æ˜¯å…ˆä»¥æœ€å°ç»„ä»¶ä¾èµ–è¿è¡Œä¸€ä¸ªOpenStackå¹³å°ï¼Œç„¶åå†åé¢çš„ç« èŠ‚æ·»åŠ å…¶å®ƒç»„ä»¶ã€‚</p><p>æ³¨æ„ï¼šåœ¨åé¢çš„å®éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°æ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²å’Œè®¡ç®—èŠ‚ç‚¹éƒ¨ç½²è¿™æ ·çš„æè¿°æ–¹æ³•ï¼Œè¯·åˆ°å¯¹åº”çš„ä¸»æœºä¸Šè¿›è¡Œæ“ä½œã€‚</p><h3 id="_3-2-2-ntpæ—¶é—´åŒæ­¥" tabindex="-1">3.2.2 NTPæ—¶é—´åŒæ­¥ <a aria-current="page" href="#_3-2-2-ntpæ—¶é—´åŒæ­¥" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å„ä¸ªæœåŠ¡å™¨çš„æ—¶é—´åŒæ­¥æ˜¯OpenStackéƒ¨ç½²å’Œè¿ç»´ä¸­å¾€å¾€è¢«å¿½è§†çš„é—®é¢˜ã€‚å¦‚æœå„ä¸ªèŠ‚ç‚¹æ—¶é—´ä¸åŒæ­¥ï¼Œä¼šå½±å“OpenStackå¹³å°çš„æ­£å¸¸ã€‚æ‰€ä»¥éœ€è¦ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æ—¶é—´åŒæ­¥ã€‚ åœ¨CentOS 7æ¨èä½¿ç”¨Chronyæ¥è¿›è¡Œæ—¶é—´åŒæ­¥ã€‚ Chronyæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªç”±è½¯ä»¶ï¼Œå®ƒèƒ½å¸®åŠ©ä½ ä¿æŒç³»ç»Ÿæ—¶é’Ÿä¸æ—¶é’ŸæœåŠ¡å™¨ï¼ˆNTPï¼‰åŒæ­¥ï¼Œå› æ­¤è®©ä½ çš„æ—¶é—´ä¿æŒç²¾ç¡®ã€‚å®ƒç”±ä¸¤ä¸ªç¨‹åºç»„æˆï¼Œåˆ†åˆ«æ˜¯chronydå’Œchronycã€‚chronydæ˜¯ä¸€ä¸ªåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºè°ƒæ•´å†…æ ¸ä¸­è¿è¡Œçš„ç³»ç»Ÿæ—¶é’Ÿå’Œæ—¶é’ŸæœåŠ¡å™¨åŒæ­¥ã€‚å®ƒç¡®å®šè®¡ç®—æœºå¢å‡æ—¶é—´çš„æ¯”ç‡ï¼Œå¹¶å¯¹æ­¤è¿›è¡Œè¡¥å¿ã€‚chronycæä¾›äº†ä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§æ€§èƒ½å¹¶è¿›è¡Œå¤šæ ·åŒ–çš„é…ç½®ã€‚å®ƒå¯ä»¥åœ¨chronydå®ä¾‹æ§åˆ¶çš„è®¡ç®—æœºä¸Šå·¥ä½œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€å°ä¸åŒçš„è¿œç¨‹è®¡ç®—æœºä¸Šå·¥ä½œã€‚</p><p><strong>æ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²</strong> æœ¬å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŠŠæ§åˆ¶èŠ‚ç‚¹çš„chronyä½œä¸ºå†…éƒ¨çš„æ—¶é’ŸæœåŠ¡å™¨ï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½åŒæ­¥æ§åˆ¶èŠ‚ç‚¹çš„æ—¶é—´ï¼Œå¦‚æœä½ çš„ç¯å¢ƒä¸­å·²ç»å­˜åœ¨æ—¶é—´æœåŠ¡å™¨å¯ä»¥è®¾ç½®ä¸ºå·²ç»å­˜åœ¨çš„æ—¶é—´æœåŠ¡å™¨ã€‚</p><ol><li><p>å®‰è£…chrony</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y chrony</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>é…ç½®chrony</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/chrony.conf</span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®æ—¶é’ŸæœåŠ¡å™¨ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œè¿™é‡Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘çš„å…¬å…±NTPæ—¶é—´æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#a6accd">server time1.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">server time2.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">server time3.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">server time4.aliyun.com iburst</span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®å…è®¸192.168.0.0/16ç½‘æ®µè¿æ¥</span></span>
<span class="line"><span style="color:#a6accd">allow 192.168.56.0/24</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>å¯åŠ¨ NTP æœåŠ¡å¹¶å°†å…¶é…ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable chronyd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start chronyd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p><strong>å…¶å®ƒèŠ‚ç‚¹éƒ¨ç½²</strong></p><ol><li><p>å®‰è£…chrony</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# yum install -y chrony</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>é…ç½®chrony</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/chrony.conf</span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®ä¸ºæ§åˆ¶èŠ‚ç‚¹çš„IPåœ°å€ï¼Œå¹¶å°†å…¶å®ƒé…ç½®å…¨éƒ¨åˆ é™¤ã€‚</span></span>
<span class="line"><span style="color:#a6accd">server 192.168.56.11 iburst</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>å¯åŠ¨ NTP æœåŠ¡å¹¶å°†å…¶é…ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl enable chronyd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl start chronyd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><p><strong>éªŒè¯åŒæ­¥æ—¶é—´</strong></p><p>åœ¨åŒæ—¶æ—¶é—´ä¹‹å‰è¦ç¡®ä¿ä½ çš„æ—¶åŒºæ˜¯æ­£ç¡®çš„ã€‚CentOS7æä¾›äº†timedatectlç”¨æ¥ä¿®æ”¹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# timedatectl set-timezone Asia/Shanghai</span></span>
<span class="line"><span style="color:#a6accd">åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œchronyc sourceä¿è¯é…ç½®éƒ½æ­£ç¡®</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chronyc sources</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="_3-2-3-åŸºç¡€è½¯ä»¶åŒ…å®‰è£…" tabindex="-1">3.2.3 åŸºç¡€è½¯ä»¶åŒ…å®‰è£… <a aria-current="page" href="#_3-2-3-åŸºç¡€è½¯ä»¶åŒ…å®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åŸºç¡€è½¯ä»¶åŒ…éœ€è¦åœ¨æ‰€æœ‰çš„OpenStackèŠ‚ç‚¹ä¸Šè¿›è¡Œå®‰è£…ï¼ŒåŒ…æ‹¬æ§åˆ¶èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹ã€‚</p><ol><li>å®‰è£…EPELä»“åº“</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å®‰è£…OpenStackä»“åº“</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># yum install -y centos-release-openstack-train</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å®‰è£…OpenStackå®¢æˆ·ç«¯</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># yum install -y python-openstackclient</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šæœ¬æ–‡çš„å®éªŒç¯å¢ƒæ˜¯å…³é—­SELinuxï¼Œå¦‚æœä½ å¯ç”¨äº†ï¼Œéœ€è¦å®‰è£…openstack-selinux åŒ…å®ç°å¯¹OpenStacæœåŠ¡çš„å®‰å…¨ç­–ç•¥è¿›è¡Œè‡ªåŠ¨ç®¡ç†ã€‚</p></blockquote><ol><li>å®‰è£…openstack SELinuxç®¡ç†åŒ…</li></ol><p>è™½ç„¶æˆ‘ä»¬åœ¨å®éªŒç¯å¢ƒå‡†å¤‡ä¸­ï¼Œå·²ç»è¦æ±‚ç¯å¢ƒä¸­å…³é—­SELinuxï¼Œä½†æ˜¯ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œä½ è¿˜æ˜¯éœ€è¦å®‰è£…ä¸Šopenstack-selinuxã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># yum install -y openstack-selinux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>OpenStackæºç åŒ…</strong></p><p>æœ¬æ¡ˆä¾‹ä½¿ç”¨çš„æ˜¯yumå®‰è£…ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨æºç è¿›è¡ŒOpenStackéƒ¨ç½²å’Œå¼€å‘ï¼Œç›®å‰OpenStackæ‰€æœ‰çš„æºç åŒ…ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°<a href="http://tarballs.openstack.org/%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AEhttps://launchpad.net/openstack/%E8%8E%B7%E5%8F%96%E5%88%B0%E6%AF%8F%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%AF%A6%E6%83%85%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%82" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://tarballs.openstack.org/ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è®¿é—®https://launchpad.net/openstack/è·å–åˆ°æ¯ä¸ªé¡¹ç›®çš„è¯¦æƒ…å’Œä¸‹è½½åœ°å€ã€‚<!--]--></a></p><h3 id="_3-2-4-mysqlæ•°æ®åº“éƒ¨ç½²" tabindex="-1">3.2.4 MySQLæ•°æ®åº“éƒ¨ç½² <a aria-current="page" href="#_3-2-4-mysqlæ•°æ®åº“éƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æ•°æ®åº“æ˜¯OpenStackçš„åŸºç¡€ç»„ä»¶ä¹‹ä¸€ï¼ŒOpenStackçš„å¤§å¤šæ•°ç»„ä»¶å¦‚KeyStoneã€Glanceã€Novaã€Neutronå’ŒCinderéƒ½éœ€è¦ä½¿ç”¨æ•°æ®åº“å­˜å‚¨æ•°æ®ï¼ŒåŒ…æ‹¬Horizonä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®åº“æ¥è¿›è¡ŒSessionçš„å­˜å‚¨ã€‚å› æ­¤æ•°æ®åº“çš„å¯ç”¨ç‡ä¼šç›´æ¥å½±å“åˆ°æ•´ä¸ªOpenStackå¹³å°çš„å¯ç”¨ç‡ã€‚å¦‚æœæ•°æ®åº“æ•…éšœï¼ŒOpenStackå¹³å°å°†æ— æ³•åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºå’Œç®¡ç†è™šæ‹Ÿæœºï¼Œä½†æ˜¯ä¸ä¸ä¼šå½±å“åˆ°æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºã€‚ OpenStackæ”¯æŒMySQLã€PostgreSQLç­‰å¤šç§æ•°æ®åº“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨CentOS7ä¸Šé»˜è®¤ä¸æ˜¯MySQLï¼Œè€Œæ˜¯mariadbã€‚ ä½ å¯ä»¥å°†MySQL Serverå®‰è£…åœ¨ä»»æ„çš„æœåŠ¡å™¨ä¸Šï¼Œå½“ç„¶æœ€å¥½æ˜¯ä¸“ç”¨çš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½¿ç”¨æ›´å¤šçš„CPUå’ŒIOæ€§èƒ½æ›´å¥½çš„ç¡¬ç›˜ã€‚ æ³¨ï¼šç”Ÿäº§ç¯å¢ƒå¯ä»¥å’¨è¯¢DBAè¿›è¡ŒMySQLçš„æ€§èƒ½ä¼˜åŒ–å’Œé«˜å¯ç”¨çš„é…ç½®ã€‚</p><ol><li>MySQLå®‰è£…</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y mariadb mariadb-server python2-PyMySQL</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶</p><p>é»˜è®¤æƒ…å†µä¸‹MySQLå·²ç»åŒ…å«äº†/etc/my.cnf.dçš„ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé…ç½®æ”¾åœ¨è¯¥ç›®å½•ä¸‹å³å¯ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/my.cnf.d/openstack.cnf</span></span>
<span class="line"><span style="color:#a6accd">[mysqld]</span></span>
<span class="line"><span style="color:#a6accd">bind-address = 192.168.56.11 #è®¾ç½®ç›‘å¬çš„IPåœ°å€</span></span>
<span class="line"><span style="color:#a6accd">default-storage-engine = innodb  #è®¾ç½®é»˜è®¤çš„å­˜å‚¨å¼•æ“</span></span>
<span class="line"><span style="color:#a6accd">innodb_file_per_table = on#ä½¿ç”¨ç‹¬äº«è¡¨ç©ºé—´</span></span>
<span class="line"><span style="color:#a6accd">collation-server = utf8_general_ci #æœåŠ¡å™¨çš„é»˜è®¤æ ¡å¯¹è§„åˆ™</span></span>
<span class="line"><span style="color:#a6accd">character-set-server = utf8 #æœåŠ¡å™¨å®‰è£…æ—¶æŒ‡å®šçš„é»˜è®¤å­—ç¬¦é›†è®¾å®š</span></span>
<span class="line"><span style="color:#a6accd">max_connections = 4096 #è®¾ç½®MySQLçš„æœ€å¤§è¿æ¥æ•°ï¼Œç”Ÿäº§è¯·æ ¹æ®å®é™…æƒ…å†µè®¾ç½®ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>å¯åŠ¨MySQL Serverå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</p></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable mariadb.service </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start mariadb.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è¿›è¡Œæ•°æ®åº“å®‰å…¨è®¾ç½®</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql_secure_installation</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æ•°æ®åº“åˆ›å»º</li></ol><p>åœ¨éƒ¨ç½²å®ŒMySQLæ•°æ®åï¼Œå¯ä»¥å°†å„ä¸ªæœåŠ¡çš„æ•°æ®åº“åˆ›å»ºä¸Šï¼Œç»™åæœŸå®‰è£…ä½¿ç”¨ã€‚æ³¨æ„åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€å®šè¦ä½¿ç”¨å¤æ‚åº¦æ›´é«˜çš„å¯†ç å’Œåšå¥½è®¿é—®æ§åˆ¶ï¼Œè¿™é‡Œå®éªŒä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç›¸åŒã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -u root -p</span></span>
<span class="line"><span style="color:#a6accd">Enter password: </span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd">MariaDB [(none)]&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Keystoneæ•°æ®åº“</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE keystone;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'keystone';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'keystone';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Glanceæ•°æ®åº“</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE glance;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'glance';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'glance';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Placementæ•°æ®åº“</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE placement;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON placement.* TO placement@'localhost' IDENTIFIED BY 'placement';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON placement.* TO placement@'%' IDENTIFIED BY 'placement';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Novaæ•°æ®åº“</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE nova;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE nova_api;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE nova_cell0;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' IDENTIFIED BY 'nova';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Neutron æ•°æ®åº“</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE neutron;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'neutron';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' IDENTIFIED BY 'neutron';</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#Cinderæ•°æ®åº“</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">CREATE DATABASE cinder;</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'cinder';</span></span>
<span class="line"><span style="color:#a6accd">GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'cinder';</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ•°æ®åº“éƒ¨ç½²å®Œæ¯•åï¼ŒåæœŸçš„å¾ˆå¤šæ“ä½œéƒ½å¯ä»¥é€šè¿‡å‘½ä»¤ï¼Œç”šè‡³ç›´æ¥ä¿®æ”¹æ•°æ®åº“çš„æ•°æ®æ¥è¿›è¡Œã€‚æ³¨æ„ï¼šæœ¬å®ä¾‹ä¸ºäº†ç®€åŒ–æ­¥éª¤ï¼Œä½¿ç”¨äº†è¾ƒä¸ºç®€å•çš„å¯†ç ï¼Œç”Ÿäº§ç¯å¢ƒè¯·è®¾ç½®ç¬¦åˆè¿ç»´è§„èŒƒçš„å¤æ‚å¯†ç æ¥è¿›è¡Œæ›¿æ¢ã€‚ æ³¨æ„ï¼šä¸€å®šè¦ç»™æ•°æ®åº“åšå¥½ç›¸å…³çš„é«˜å¯ç”¨å’Œå¤‡ä»½æªæ–½ï¼Œåƒå¯¹å¾…ç”Ÿæˆä¸šåŠ¡æ•°æ®åº“ä¸€æ ·å¯¹å¾…å®ƒå“¦ã€‚</p><h3 id="æ¶ˆæ¯ä»£ç†rabbitmq" tabindex="-1">æ¶ˆæ¯ä»£ç†RabbitMQ <a aria-current="page" href="#æ¶ˆæ¯ä»£ç†rabbitmq" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>OpenStack ä½¿ç”¨ï¼ˆMessage brokerï¼‰æ¶ˆæ¯ä»£ç†åœ¨å„ä¸ªæœåŠ¡ä¹‹é—´è¿›è¡Œåè°ƒå’ŒçŠ¶æ€ç®¡ç†ã€‚OpenStackæ”¯æŒä¸‰ç§å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ã€‚åˆ†åˆ«ä¸ºRabbitMQã€Qpidã€ZeroMQã€‚Openstacké»˜è®¤ä½¿ç”¨RabbitMQã€‚ æ¶ˆæ¯é˜Ÿåˆ—åœ¨OpenStackæ•´ä¸ªæ¶æ„ä¸­æ‰®æ¼”ç€äº¤é€šæ¢çº½çš„ä½œç”¨ï¼Œæ­£æ˜¯å› ä¸ºOpenStackéƒ¨ç½²çš„çµæ´»æ€§ã€å„ä¸ªç»„ä»¶çš„æ¾è€¦åˆã€æ¶æ„çš„æ‰å¹³åŒ–ï¼Œåè€Œä½¿å¾—OpenStackæ›´åŠ ä¾èµ–äºæ¶ˆæ¯é˜Ÿåˆ—ã€‚OpenStackçš„æ§åˆ¶ã€è®¡ç®—ã€ç½‘ç»œä¸å­˜å‚¨æœåŠ¡å‡éœ€è¦é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œé€šä¿¡ã€‚ ä½ å¯ä»¥å°†RabbitMQéƒ¨ç½²åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸­ï¼Œæˆ–è€…ä½¿ç”¨RabbitMQé›†ç¾¤è¿™å–å†³äºä½ çš„å®é™…æƒ…å†µï¼Œåœ¨å®éªŒç¯å¢ƒï¼Œéƒ¨ç½²åœ¨æ§åˆ¶èŠ‚ç‚¹å³å¯ã€‚</p><ol><li>å®‰è£…RabbitMQ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y rabbitmq-server</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è®¾ç½®å¼€å¯å¯åŠ¨ï¼Œå¹¶å¯åŠ¨RabbitMQ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable rabbitmq-server.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start rabbitmq-server.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æ·»åŠ openstackç”¨æˆ·ã€‚</li></ol><p>åˆ›å»ºä¸€ä¸ªopenstackç”¨æˆ·ï¼Œå¯†ç ä¸ºopenstackã€‚æ³¨æ„å®é™…ä½¿ç”¨ä¸­è¿›è¡Œå¯†ç ä¿®æ”¹ï¼Œè¿™é‡Œè®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç åœ¨åé¢é…ç½®OpenStackç»„ä»¶çš„æ—¶å€™éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œé¢è®¾ç½®ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmqctl add_user openstack openstack</span></span>
<span class="line"><span style="color:#a6accd">Creating user "openstack" ...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>ç»™åˆšæ‰åˆ›å»ºçš„openstackç”¨æˆ·ï¼Œåˆ›å»ºæƒé™ã€‚</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmqctl set_permissions openstack ".*" ".*" ".*"</span></span>
<span class="line"><span style="color:#a6accd">Setting permissions for user "openstack" in vhost "/" ...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯ç”¨Webç›‘æ§æ’ä»¶</li></ol><p>RabbitMQè‡ªå¸¦äº†ä¸€ä¸ªWebç›‘æ§æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡Webç•Œé¢ç›‘æ§RabbitMQçš„è¿è¡ŒçŠ¶æ€ã€‚åŒæ—¶ä¹Ÿæä¾›äº†HTTP APIã€‚å¯ä»¥æ–¹ä¾¿çš„é›†æˆåˆ°Nagiosã€Zabbixç­‰ç›‘æ§å¹³å°ä¸Šã€‚ Webç›‘æ§æ’ä»¶å¯ç”¨åå°±å¯ä»¥é€šè¿‡<a href="http://ip:15672/%E6%9D%A5%E8%AE%BF%E9%97%AEweb%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E3%80%82" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://IP:15672/æ¥è®¿é—®webç®¡ç†ç•Œé¢ã€‚<!--]--></a></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmq-plugins list</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# rabbitmq-plugins enable rabbitmq_management</span></span>
<span class="line"><span style="color:#a6accd">ï¼ˆæ³¨ï¼šå¦‚æœä¸»æœºåä¸èƒ½è§£æï¼ŒrabbitMQå°†æ— æ³•å¯åŠ¨ã€‚åœ¨ç”Ÿäº§åº”ç”¨æ—¶å»ºè®®è®¾ç½®ä¸ºé›†ç¾¤æ¨¡å¼ï¼Œå»ºè®®ä¸‰ä¸ªèŠ‚ç‚¹ã€‚1ä¸ªç¡¬ç›˜èŠ‚ç‚¹ã€ä¸¤ä¸ªå†…å­˜èŠ‚ç‚¹ã€‚ï¼‰</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# lsof -i:15672</span></span>
<span class="line"><span style="color:#a6accd">COMMAND  PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span>
<span class="line"><span style="color:#a6accd">beam    2620 rabbitmq   15u  IPv4  16805      0t0  TCP *:15672 (LISTEN)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹RabbitMQæœåŠ¡ä½¿ç”¨5672ç«¯å£ï¼Œè€ŒWebç®¡ç†æ’ä»¶ç›‘å¬15672ç«¯å£ï¼Œç›´æ¥åœ¨æµè§ˆå™¨è¾“å…¥<a href="http://192.168.56.11:15672/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://192.168.56.11:15672<!--]--></a></p><blockquote><p>RabbitMQé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç å‡ä¸ºguestã€‚ä¹‹å‰åˆ›å»ºçš„openstackçš„ç”¨æˆ·æ˜¯æ— æ³•é€šè¿‡Webç•Œé¢ç™»å½•çš„ã€‚</p></blockquote><p>ï¼ˆå›¾2.2.2ï¼‰</p><blockquote><p>å®è·µç»éªŒï¼šæ¶ˆæ¯é˜Ÿåˆ—æ”¶å‘æ¶ˆæ¯çš„æ€§èƒ½å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„HAèƒ½åŠ›ç›´æ¥å½±å“OpenStackçš„æ€§èƒ½å’Œé«˜å¯ç”¨ã€‚å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—Downæœºï¼ŒOpenStackå°†æ— æ³•åˆ›å»ºæ–°çš„äº‘ä¸»æœºï¼Œä»¥åŠè¿›è¡Œå…¶å®ƒçš„ç®¡ç†å·¥ä½œã€‚æ‰€ä»¥åœ¨ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€è¦ä½¿ç”¨RabbitMQçš„é›†ç¾¤æ¥ä¿è¯å¯ç”¨æ€§ã€‚åŒæ—¶åšå¥½ç›‘æ§å·¥ä½œï¼ŒRabbitMQè‡ªå¸¦HTTPçš„APIï¼Œä¾¿äºé›†æˆåˆ°ä¼ä¸šçš„ç›‘æ§å¹³å°ä¸Šã€‚</p></blockquote><h1 id="_1-3-openstackéªŒè¯æœåŠ¡keystone" tabindex="-1">1.3 OpenStackéªŒè¯æœåŠ¡KeyStone <a aria-current="page" href="#_1-3-openstackéªŒè¯æœåŠ¡keystone" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>Keystoneï¼ˆOpenStack Identity Serviceï¼‰æ˜¯OpenStackæ¡†æ¶ä¸­ï¼Œè´Ÿè´£èº«ä»½éªŒè¯ã€æœåŠ¡è§„åˆ™å’ŒæœåŠ¡ä»¤ç‰Œçš„åŠŸèƒ½ï¼Œå®ƒå®ç°äº†OpenStackçš„Identity APIã€‚</p><p>Keystoneç±»ä¼¼ä¸€ä¸ªæœåŠ¡æ€»çº¿ï¼Œ æˆ–è€…è¯´æ˜¯æ•´ä¸ªOpenStackæ¡†æ¶çš„æ³¨å†Œä¸­å¿ƒï¼Œå…¶ä»–æœåŠ¡é€šè¿‡keystoneæ¥æ³¨å†Œå…¶æœåŠ¡çš„Endpointï¼ˆæœåŠ¡è®¿é—®çš„URLï¼‰ï¼Œä»»ä½•æœåŠ¡ä¹‹é—´ç›¸äº’çš„è°ƒç”¨ï¼Œéœ€è¦ç»è¿‡Keystoneçš„èº«ä»½éªŒè¯ï¼Œæ¥è·å¾—ç›®æ ‡æœåŠ¡çš„Endpointæ¥æ‰¾åˆ°ç›®æ ‡æœåŠ¡ã€‚</p><h3 id="keystoneæ¦‚è¿°" tabindex="-1">Keystoneæ¦‚è¿° <a aria-current="page" href="#keystoneæ¦‚è¿°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Keystoneæä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼š</p><ul><li>ç”¨æˆ·ä¸è®¤è¯:ç”¨æˆ·æƒé™ä¸ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªï¼›</li><li>æœåŠ¡ç›®å½•:æä¾›ä¸€ä¸ªæœåŠ¡ç›®å½•ï¼ŒåŒ…æ‹¬æ‰€æœ‰æœåŠ¡é¡¹ä¸ç›¸å…³Apiçš„ç«¯ç‚¹ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬ä»è¿™ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ¥äº†è§£Keystoneçš„æ¦‚å¿µï¼Œå’ŒKeystoneåœ¨Openstackä¸­çš„ä½œç”¨ã€‚</p><ol><li><p>Keystoneç”¨æˆ·ä¸è®¤è¯</p><p>Keystoneä¸ºå„ä¸ªOpenstackç»„ä»¶æä¾›ç”¨æˆ·å’Œè®¤è¯æœåŠ¡ï¼Œå„ä¸ªç»„ä»¶éƒ½å¿…é¡»ä¸Keystoneè¿›è¡Œäº¤äº’ã€‚æ¯”å¦‚ç™»é™†è®¤è¯æ˜¯ç”¨æˆ·åœ¨è®¿é—®Openstackå„ä¸ªç»„ä»¶ä¸­çš„APIæ—¶ï¼Œå¿…é¡»é€šè¿‡Keystoneçš„ç”¨æˆ·åå’Œå¯†ç éªŒè¯ï¼Œæœ€ç»ˆé€šè¿‡KyestoneéªŒè¯è·å–tokenï¼Œå®Œæˆå¯¹ç”¨æˆ·çš„ç™»é™†è®¤è¯ã€‚å¦‚æœè®¤è¯å¤±è´¥ï¼Œè¯¥ç”¨æˆ·å°†ä¸èƒ½è®¿é—®è¯¥APIã€‚</p></li></ol><p><strong>User</strong></p><p>Userå³ç”¨æˆ·ï¼Œå®ƒæ˜¯ç”¨ä¸€ä¸ªæ•°å­—ä»£è¡¨ä½¿ç”¨OpenStackäº‘æœåŠ¡çš„ä¸€ä¸ªäººã€ç³»ç»Ÿã€æˆ–æœåŠ¡ã€‚èº«ä»½éªŒè¯æœåŠ¡å°†ä¼šéªŒè¯ä¼ å…¥çš„ç”±ç”¨æˆ·å£°æ˜å°†è°ƒç”¨çš„è¯·æ±‚ã€‚ç”¨æˆ·å¦‚æœå·²ç»ç™»å½•ï¼Œå¯å°±èƒ½åˆ†é…ä»¤ç‰Œï¼ˆtokensï¼‰è®¿é—®èµ„æºã€‚ ç”¨æˆ·å¯èƒ½è¢«ç›´æ¥åˆ†é…ç»™ç‰¹å®šçš„ç§Ÿæˆ·ï¼Œç”¨æˆ·è¡Œä¸ºè¢«åŒ…å«åœ¨ç§Ÿæˆ·ï¼ˆtenantï¼‰ï¼ŒUsersé€šè¿‡è®¤è¯ä¿¡æ¯ï¼ˆcredentialsï¼Œå¦‚å¯†ç ã€API Keysç­‰ï¼‰è¿›è¡ŒéªŒè¯ã€‚</p><p><strong>Credentials</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">Credentialså³è¯ä¹¦ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡èº«ä»½éªŒè¯ï¼Œä¿è¯æ•°æ®é€šå¸¸åªè¢«ä¸€ä¸ªç”¨æˆ·å±äºæˆ–æ‹¥æœ‰(å› ä¸ºæ²¡æœ‰å…¶ä»–äººåº”è¯¥çŸ¥é“æ•°æ®)ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä»¥ä¸‹ä¸ºè¯ä¹¦çš„ä¾‹å­: ï¬ä¸€ä¸ªåŒ¹é…çš„ç”¨æˆ·åå’Œå¯†ç  ï¬ä¸€ä¸ªåŒ¹é…çš„ç”¨æˆ·åå’ŒAPIé”® ï¬ä¸€ä¸ªèº«ä»½è®¤è¯ä»¤ç‰Œ</p><p><strong>Authentication</strong></p><p>Authenticationå³è®¤è¯ï¼Œè®¤è¯æ˜¯ç¡®è®¤èº«ä»½æˆ–è¯†åˆ«çœŸå®æ€§çš„è¡Œä¸ºã€‚èº«ä»½æœåŠ¡é€šè¿‡ä¸ç”¨æˆ·çš„ä¸€ç»„å£°æ˜éªŒè¯ä»¥ç¡®è®¤ä¼ å…¥çš„è¯·æ±‚æ˜¯ç”±è¯¥ç”¨æˆ·å£°æ˜è¿‡çš„ã€‚è¿™äº›å£°æ˜è¢«åˆå§‹åŒ–ä¸ºä¸€ç»„è¯ä¹¦ (username&amp;password, or username and API key)ã€‚åˆå§‹ç¡®è®¤åï¼Œèº«ä»½æœåŠ¡å°†ä¼šç»™ç”¨æˆ·å‘å¸ƒä¸€ä¸ªç¡®è®¤èº«ä»½çš„ä»¤ç‰Œ(Token)ï¼Œåœ¨ç”¨æˆ·éšåçš„è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œæˆæƒè®¿é—®ã€‚</p><p><strong>Tokenï¼š</strong></p><p>Tokenå³ä»¤ç‰Œï¼Œæ˜¯ä¸€ä¸ªç”¨æˆ·è®¿é—®èµ„æºçš„ä»»æ„æ–‡æœ¬ï¼Œæ¯ä¸€ä¸ªä»¤ç‰Œéƒ½æœ‰ä¸€ä¸ªèŒƒå›´ï¼Œæè¿°äº†å¯ä»¥è®¿é—®å“ªäº›èµ„æºã€‚ä»¤ç‰Œå¯èƒ½éšæ—¶æ’¤æ¶ˆï¼Œæ˜¯æœ‰æœ‰æ•ˆæœŸçš„ã€‚èº«ä»½è®¤è¯æ˜¯æ”¯æŒä»¤ç‰Œè®¤è¯çš„ï¼Œå®ƒçš„ç›®çš„ä¸ºåœ¨æœªæ¥æ”¯æŒé¢å¤–çš„åè®®ã€‚å…¶ç›®çš„æ˜¯ä¸ºäº†è®©å®ƒé¦–å…ˆæˆä¸ºä¸€ç§é›†æˆæœåŠ¡ï¼Œè€Œä¸æ˜¯ä¸€ç§æ¸´æœ›æˆä¸ºä¸°å¯Œçš„èº«ä»½å­˜å‚¨å’Œç®¡ç†çš„è§£å†³æ–¹æ¡ˆã€‚ T <strong>Tenantï¼š</strong></p><p>Tenantå³ç§Ÿæˆ·ï¼Œå®ƒæ˜¯å„ä¸ªæœåŠ¡ä¸­çš„ä¸€äº›å¯ä»¥è®¿é—®çš„èµ„æºé›†åˆã€‚å®ƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºç»„ç»‡å’Œéš”ç¦»èµ„æºï¼Œæˆ–æ ‡è¯†å¯¹è±¡ã€‚ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥ä¸€ä¸ªå®¢æˆ·ã€è´¦æˆ·ã€ç»„ç»‡ã€é¡¹ç›®çš„æ˜ å°„ã€‚ä¾‹å¦‚ï¼Œåœ¨Novaä¸­ä¸€ä¸ªtenantå¯ä»¥æ˜¯ä¸€äº›æœºå™¨ï¼Œåœ¨Swiftå’ŒGlanceä¸­ä¸€ä¸ªtenantå¯ä»¥æ˜¯ä¸€äº›é•œåƒå­˜å‚¨ï¼Œåœ¨Neutronä¸­ä¸€ä¸ªtenantå¯ä»¥æ˜¯ä¸€äº›ç½‘ç»œèµ„æºã€‚Usersé»˜è®¤çš„æ€»æ˜¯ç»‘å®šåˆ°æŸäº›tenantä¸Šã€‚</p><p><strong>Roleï¼š</strong></p><p>Roleå³è§’è‰²ï¼ŒRolesä»£è¡¨ä¸€ç»„ç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æºæƒé™ï¼Œä¾‹å¦‚Novaä¸­çš„è™šæ‹Ÿæœºã€Glanceä¸­çš„é•œåƒã€‚Userså¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„ä¸€ä¸ªå…¨å±€çš„æˆ–ç§Ÿæˆ·å†…çš„è§’è‰²ä¸­ã€‚åœ¨å…¨å±€çš„roleä¸­ï¼Œç”¨æˆ·çš„roleæƒé™ä½œç”¨äºæ‰€æœ‰çš„ç§Ÿæˆ·ï¼Œå³å¯ä»¥å¯¹æ‰€æœ‰çš„ç§Ÿæˆ·æ‰§è¡Œroleè§„å®šçš„æƒé™ï¼›åœ¨ç§Ÿæˆ·å†…çš„roleä¸­ï¼Œç”¨æˆ·ä»…èƒ½åœ¨å½“å‰ç§Ÿæˆ·å†…æ‰§è¡Œroleè§„å®šçš„æƒé™ã€‚</p><p><strong>Domainï¼š</strong></p><p>åœ¨KeyStone V3ç‰ˆæœ¬å°† Tenant æ”¹ä¸º Project å¹¶åœ¨å…¶ä¸Šæ·»åŠ  Domain çš„æ¦‚å¿µï¼Œè¿™æ›´åŠ ç¬¦åˆç°å®ä¸–ç•Œå’Œäº‘æœåŠ¡çš„æ˜ å°„ã€‚åˆ©ç”¨ Domain å®ç°çœŸæ­£çš„å¤šç§Ÿæˆ·ï¼ˆmulti-tenancyï¼‰æ¶æ„ï¼ŒDomain æ‹…ä»» Project çš„é«˜å±‚å®¹å™¨ã€‚äº‘æœåŠ¡çš„å®¢æˆ·æ˜¯ Domain çš„æ‰€æœ‰è€…ï¼Œä»–ä»¬å¯ä»¥åœ¨è‡ªå·±çš„ Domain ä¸­åˆ›å»ºå¤šä¸ª Projectsã€Usersã€Groups å’Œ Rolesã€‚é€šè¿‡å¼•å…¥ Domainï¼Œäº‘æœåŠ¡å®¢æˆ·å¯ä»¥å¯¹å…¶æ‹¥æœ‰çš„å¤šä¸ª Project è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œè€Œä¸å¿…å†å‘è¿‡å»é‚£æ ·å¯¹æ¯ä¸€ä¸ª Project è¿›è¡Œå•ç‹¬ç®¡ç†ã€‚</p><p><strong>Groupï¼š</strong></p><p>Group æ˜¯ä¸€ç»„ Users çš„å®¹å™¨ï¼Œå¯ä»¥å‘ Group ä¸­æ·»åŠ ç”¨æˆ·ï¼Œå¹¶ç›´æ¥ç»™ Group åˆ†é…è§’è‰²ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ª Group ä¸­çš„æ‰€æœ‰ç”¨æˆ·å°±éƒ½æ‹¥æœ‰äº† Group æ‰€æ‹¥æœ‰çš„è§’è‰²æƒé™ã€‚é€šè¿‡å¼•å…¥ Group çš„æ¦‚å¿µï¼ŒKeystone V3 å®ç°äº†å¯¹ç”¨æˆ·ç»„çš„ç®¡ç†ï¼Œè¾¾åˆ°äº†åŒæ—¶ç®¡ç†ä¸€ç»„ç”¨æˆ·æƒé™çš„ç›®çš„ã€‚è¿™ä¸ V2 ä¸­ç›´æ¥å‘ User/Project æŒ‡å®š Role ä¸åŒï¼Œä½¿å¾—å¯¹äº‘æœåŠ¡è¿›è¡Œç®¡ç†æ›´åŠ ä¾¿æ·ã€‚ Domainã€Groupã€Projectã€User å’Œ Role çš„å…³ç³»å›¾</p><p>å¦‚å›¾ 2 æ‰€ç¤ºï¼Œåœ¨ä¸€ä¸ª Domain ä¸­åŒ…å« 3 ä¸ª Projects,å¯ä»¥é€šè¿‡ Group1 å°† Role Sysadminç›´æ¥èµ‹äºˆ Domain,é‚£ä¹ˆ Group1 ä¸­çš„æ‰€æœ‰ç”¨æˆ·å°†ä¼šå¯¹ Domain ä¸­çš„æ‰€æœ‰ Projects éƒ½æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ Group2 å°† Role Engineer åªèµ‹äºˆ Project3,è¿™æ · Group2 ä¸­çš„ User å°±åªæ‹¥æœ‰å¯¹ Project3 ç›¸åº”çš„æƒé™ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒ Projectsã€‚</p><ol><li><p>KeystoneæœåŠ¡ç›®å½•</p><p>ä¸Šæ–‡è¯´è¿‡ï¼ŒKeystoneé™¤äº†ç”¨æˆ·ç®¡ç†ç›¸å…³çš„æ”¯æ’‘ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨æ˜¯ä¸€ä¸ªæœåŠ¡ç›®å½•ã€‚KeyStoneä¸ºOpenstackå„ä¸ªæœåŠ¡æä¾›äº†ä¸€ä¸ªREST APIç«¯ç‚¹åˆ—è¡¨ã€‚</p></li><li><p>Service Serviceå³æœåŠ¡ï¼Œå¦‚Novaã€Glanceã€Swiftã€‚æ ¹æ®å‰ä¸‰ä¸ªæ¦‚å¿µï¼ˆUserï¼ŒTenantå’ŒRoleï¼‰ä¸€ä¸ªæœåŠ¡å¯ä»¥ç¡®è®¤å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®å…¶èµ„æºçš„æƒé™ã€‚ä½†æ˜¯å½“ä¸€ä¸ªuserå°è¯•ç€è®¿é—®å…¶ç§Ÿæˆ·å†…çš„serviceæ—¶ï¼Œä»–å¿…é¡»çŸ¥é“è¿™ä¸ªserviceæ˜¯å¦å­˜åœ¨ä»¥åŠå¦‚ä½•è®¿é—®è¿™ä¸ªserviceï¼Œè¿™é‡Œé€šå¸¸ä½¿ç”¨ä¸€äº›ä¸åŒçš„åç§°è¡¨ç¤ºä¸åŒçš„æœåŠ¡ã€‚åœ¨ä¸Šæ–‡ä¸­è°ˆåˆ°çš„Roleï¼Œå®é™…ä¸Šä¹Ÿæ˜¯å¯ä»¥ç»‘å®šåˆ°æŸä¸ªserviceçš„ã€‚</p></li><li><p>Endpoint Endpointï¼Œç¿»è¯‘ä¸ºâ€œç«¯ç‚¹â€ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£å®ƒæ˜¯ä¸€ä¸ªæœåŠ¡æš´éœ²å‡ºæ¥çš„è®¿é—®ç‚¹ï¼Œå¦‚æœéœ€è¦è®¿é—®ä¸€ä¸ªæœåŠ¡ï¼Œåˆ™å¿…é¡»çŸ¥é“ä»–çš„endpointã€‚å› æ­¤ï¼Œåœ¨keystoneä¸­åŒ…å«ä¸€ä¸ªendpointæ¨¡æ¿ï¼ˆendpoint templateï¼Œåœ¨å®‰è£…keystoneçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨confæ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¨¡æ¿æä¾›äº†æ‰€æœ‰å­˜åœ¨çš„æœåŠ¡endpointsä¿¡æ¯ã€‚ä¸€ä¸ªendpoint templateåŒ…å«ä¸€ä¸ªURLsåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªURLéƒ½å¯¹åº”ä¸€ä¸ªæœåŠ¡å®ä¾‹çš„è®¿é—®åœ°å€ï¼Œå¹¶ä¸”å…·æœ‰publicã€privateå’Œadminè¿™ä¸‰ç§æƒé™ã€‚public urlå¯ä»¥è¢«å…¨å±€è®¿é—®ï¼ˆå¦‚<a href="http://compute.example.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://compute.example.comï¼‰ï¼Œprivate<!--]--></a>%2Cprivate/) urlåªèƒ½è¢«å±€åŸŸç½‘è®¿é—®ï¼ˆå¦‚<a href="http://compute.example.local" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://compute.example.localï¼‰ï¼Œadmin<!--]--></a>%2Cadmin/) urlè¢«ä»å¸¸è§„çš„è®¿é—®ä¸­åˆ†ç¦»ã€‚</p></li></ol><h3 id="keystoneéƒ¨ç½²" tabindex="-1">KeyStoneéƒ¨ç½² <a aria-current="page" href="#keystoneéƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>OpenStackä¸­æ‰€æœ‰æœåŠ¡çš„å®‰è£…å¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„ã€‚å¤æ‚çš„å°±åœ¨äºæœ¬èº«çš„é…ç½®æ–‡ä»¶çš„ä¿®æ”¹å’Œä¸Keystoneç›¸å…³çš„é…ç½®ã€‚è¿˜è®°å¾—ä¸Šé¢è¯´çš„ï¼ŒOpenStackçš„æ¯ä¸ªç»„ä»¶å¦‚æœèƒ½å¤Ÿä½¿ç”¨éƒ½å¿…é¡»åœ¨Keystoneåˆ›å»ºServiceå’ŒEndpointå—ï¼Ÿå¥½çš„ï¼Œæˆ‘ä»¬å¼€å§‹ã€‚</p><ol><li>å®‰è£…keystone</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-keystone httpd mod_wsgi memcached python-memcached</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è®¾ç½®Memcacheå¼€å¯å¯åŠ¨å¹¶å¯åŠ¨Memcached</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">#keystoneä½¿ç”¨Memcachedæ¥ç¼“å­˜éªŒè¯åç”Ÿæˆçš„tokenã€‚</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable memcached.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/memcached</span></span>
<span class="line"><span style="color:#a6accd">PORT="11211"</span></span>
<span class="line"><span style="color:#a6accd">USER="memcached"</span></span>
<span class="line"><span style="color:#a6accd">MAXCONN="1024"</span></span>
<span class="line"><span style="color:#a6accd">CACHESIZE="64"</span></span>
<span class="line"><span style="color:#a6accd">OPTIONS="-l 192.168.56.11,::1"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start memcached.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Keystoneé…ç½®</li></ol><p>KeyStoneçš„é…ç½®åªéœ€è¦ä¿®æ”¹/etc/keystone/keystone.confå³å¯ï¼Œæ¶‰åŠAdmin Tokenå’ŒMysqlè¿æ¥ï¼Œå…¶å®ƒå‡ä½¿ç”¨é»˜è®¤é…ç½®å³å¯ã€‚æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½å­˜æ”¾åˆ°/etc/keystoneï¼ˆé¡¹ç›®åï¼‰ç›®å½•ä¸‹ã€‚æ—¥å¿—éƒ½å­˜æ”¾åœ¨/var/log/keystoneï¼ˆé¡¹ç›®åï¼‰ç›®å½•ä¸‹ï¼Œå…¶å®ƒé¡¹ç›®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ å¥½çš„ï¼Œæˆ‘ä»¬æš‚åœä¸€ä¸‹ï¼Œåœ¨åé¢çš„éƒ¨ç½²ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è¿™æ ·çš„æ–¹å¼åˆ—å‡ºé…ç½®ï¼Œæœªåˆ—å‡ºçš„é…ç½®ï¼Œä¿æŒé»˜è®¤ä¸è¿›è¡Œä¿®æ”¹ï¼Œé™¤éç‰¹åˆ«æç¤ºåˆ°ã€‚å¦å¤–è¦æ³¨æ„é…ç½®çš„ä½ç½®ï¼ŒOpenStackæ‰€æœ‰æœåŠ¡éƒ½ä¼šæœ‰[DEFAULT] [dtabase] è¿™æ ·çš„é…ç½®éƒ¨åˆ†ï¼Œè¯·åœ¨æ–‡ä¸­åˆ—å‡ºçš„é…ç½®éƒ¨åˆ†é‡Œé¢è¿›è¡Œé…ç½®ï¼Œåˆ‡è®°ï¼ã€‚å› ä¸ºç¡®å®æœ‰ç›¸åŒçš„é…ç½®å­˜åœ¨åœ¨ä¸åŒçš„é…ç½®ç«¯çš„æƒ…å†µï¼Œè¿™æ ·ä¾‹å¤–æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰æŒ‰è¦æ±‚é…ç½®ï¼Œå¯èƒ½å°±æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><ul><li><p>é…ç½®KeyStoneæ•°æ®åº“</p><p>OpenStackä¸­æ‰€æœ‰æœåŠ¡çš„æ•°æ®åº“åŒæ­¥éƒ½éœ€è¦ä¾èµ–ä¸é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥çš„é…ç½®ï¼Œæ‰€ä»¥å¿…é¡»å…ˆä¿®æ”¹å®Œæ¯•é…ç½®æ–‡ä»¶åï¼Œå†è¿›è¡Œæ•°æ®åº“çš„åˆå§‹åŒ–æ“ä½œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/keystone/keystone.conf</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>è®¾ç½®Tokenå’ŒMemcached</p></li></ul><p>åœ¨ä¹‹å‰çš„KeyStoneç‰ˆæœ¬ç”±äºæ‰€æœ‰çš„APIé€šä¿¡éƒ½è¦è¯·æ±‚Keystoneæ¥ç”Ÿäº§Tokenï¼Œä¹‹å‰æ˜¯å­˜æ”¾åœ¨MySQLè¡¨é‡Œï¼Œå¯¼è‡´è¡¨ç‰¹åˆ«å¤§ï¼Œç»å¸¸éœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œè€Œä¸”æ€§èƒ½ä¸‹é™ï¼Œç°åœ¨æ–°çš„ç‰ˆæœ¬æˆ‘ä»¬å¯ä»¥å­˜æ”¾åœ¨memcacheé‡Œé¢äº†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[token]</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>åŒæ­¥æ•°æ®åº“ï¼š</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "keystone-manage db_sync" keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>å°æç¤ºï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨keystoneç”¨æˆ·æ¥åŒæ­¥æ•°æ®å‘¢ï¼Œå› ä¸ºåŒæ­¥æ“ä½œä¼šç”Ÿäº§æ—¥å¿—/var/log/keystone/keystone.logï¼Œå¦‚æœä½¿ç”¨rootç”¨æˆ·ï¼Œé‚£ä¹ˆç”Ÿæˆçš„æ–‡ä»¶æƒé™ä¸ºrootç”¨æˆ·ï¼Œkeystoneå¯åŠ¨çš„æ—¶å€™æ²¡æœ‰æƒé™è¯»å–è¯¥æ–‡ä»¶ï¼Œä¼šæ— æ³•å¯åŠ¨ã€‚å¦‚æœä½ çš„åŒæ­¥æ‰§è¡Œæœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚</p></blockquote><ul><li>éªŒè¯æ•°æ®åº“åˆ›å»ºæ˜¯å¦æ­£å¸¸ï¼š</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -ukeystone -pkeystone -e "use keystone;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>åˆå§‹åŒ–fernet keys</p><p>ç”Ÿæˆå®Œæ¯•ä¹‹åï¼Œä¼šåˆ›å»º/etc/keystone/fernet-keysç›®å½•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆå§‹åŒ–keystone</p></li></ol><p>è¿˜è®°å¾—ä¸Šé¢è¯´çš„Openstackçš„æ¯ä¸ªç»„ä»¶éƒ½å¿…é¡»åœ¨Keystoneä¸Šè¿›è¡Œæ³¨å†Œã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬Keystoneæœ¬èº«ã€‚èº«ä»½è®¤è¯æœåŠ¡ç®¡ç†äº†ä¸€ä¸ªä¸æ‚¨ç¯å¢ƒç›¸å…³çš„ API ç«¯ç‚¹çš„ç›®å½•ã€‚æœåŠ¡ä½¿ç”¨è¿™ä¸ªç›®å½•æ¥å†³å®šå¦‚ä½•ä¸æ‚¨ç¯å¢ƒä¸­çš„å…¶ä»–æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚ OpenStackä½¿ç”¨ä¸‰ä¸ªAPIç«¯ç‚¹å˜ç§ä»£è¡¨æ¯ç§æœåŠ¡ï¼šadminï¼Œinternalå’Œpublicã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡ç†APIç«¯ç‚¹å…è®¸ä¿®æ”¹ç”¨æˆ·å’Œç§Ÿæˆ·è€Œå…¬å…±å’Œå†…éƒ¨APIsä¸å…è®¸è¿™äº›æ“ä½œã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¤„äºå®‰å…¨åŸå› ï¼Œå˜ç§ä¸ºäº†æœåŠ¡ä¸åŒç±»å‹çš„ç”¨æˆ·å¯èƒ½é©»ç•™åœ¨å•ç‹¬çš„ç½‘ç»œä¸Šã€‚ å¯¹å®ä¾‹è€Œè¨€ï¼Œå…¬å…±APIç½‘ç»œä¸ºäº†è®©é¡¾å®¢ç®¡ç†ä»–ä»¬è‡ªå·±çš„äº‘åœ¨äº’è”ç½‘ä¸Šæ˜¯å¯è§çš„ã€‚ç®¡ç†APIç½‘ç»œåœ¨ç®¡ç†äº‘åŸºç¡€è®¾æ–½çš„ç»„ç»‡ä¸­æ“ä½œä¹Ÿæ˜¯æœ‰æ‰€é™åˆ¶çš„ã€‚å†…éƒ¨APIç½‘ç»œå¯èƒ½ä¼šè¢«é™åˆ¶åœ¨åŒ…å«OpenStackæœåŠ¡çš„ä¸»æœºä¸Šã€‚æ­¤å¤–ï¼ŒOpenStackæ”¯æŒå¯ä¼¸ç¼©æ€§çš„å¤šåŒºåŸŸã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œå‡ä½¿ç”¨ä¸€ä¸ªIPåœ°å€ã€‚192.168.56.11ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage bootstrap --bootstrap-password admin \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-admin-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-internal-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-public-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-region-id RegionOne</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>éªŒè¯Keystoneé…ç½®</li></ol><p>ä¸‹é¢æˆ‘å°†ä¸Šé¢è¿›è¡Œçš„é…ç½®åˆ—å‡ºæ¥ï¼Œä¾›è¯»è€…è¿›è¡Œæ¯”å¯¹ï¼Œé…ç½®åº”è¯¥å’Œæœ¬æ–‡ä¿æŒä¸€è‡´ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# grep "^[a-z]" /etc/keystone/keystone.conf </span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>KeyStoneå¯åŠ¨</li></ol><p>OpenStack Keystoneä½¿ç”¨Apacheæ¥è¿›è¡Œå¯åŠ¨ï¼Œæé«˜äº†æ€§èƒ½ã€‚ é…ç½®ServerNameï¼Œæ³¨æ„ä¸€å®šè¦é…ç½®ï¼Œä¸ç„¶ä¼šæœ‰å¥‡æ€ªçš„é—®é¢˜å‡ºç°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#a6accd">ServerName 192.168.56.11:80</span></span>
<span class="line"><span style="color:#a6accd">åˆ›å»ºé…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯åŠ¨keystoneï¼Œå¹¶æŸ¥çœ‹ç«¯å£ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::5000                 :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::80                   :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">ç°åœ¨ï¼Œå¦‚æœä½ çš„Keystoneæ²¡æœ‰æ­£å¸¸çš„ç›‘å¬ç«¯å£ï¼Œé‚£ä¹ˆè¯·æŸ¥çœ‹æ—¥å¿—ï¼ŒåæœŸæˆ‘ä»¬ä¼šä¸åœçš„å¼ºè°ƒè¯»è€…é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ¥æ’æŸ¥é—®é¢˜ï¼ŒOpenStackçš„æ—¥å¿—æ˜¯å€¼å¾—ä¿¡èµ–çš„ã€‚å¦‚æœä½ æƒ³è®©æœ‹å‹å¸®åŠ©è§£å†³é—®é¢˜ï¼Œè¯·ä¸è¦ä½¿ç”¨æ—¥å¿—æˆªå›¾çš„æ–¹å¼ï¼Œè¯·å‘é€å®Œæ•´çš„æ—¥å¿—ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="keystoneæƒé™ç®¡ç†" tabindex="-1">Keystoneæƒé™ç®¡ç† <a aria-current="page" href="#keystoneæƒé™ç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æˆ‘ä»¬å·²ç»æˆåŠŸçš„è¿è¡Œäº†KeystoneæœåŠ¡ï¼Œè¦æä¾›èº«ä»½è®¤è¯æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨åŸŸã€é¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²çš„ç»„åˆã€‚ é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜ç”¨æˆ·ã€è§’è‰²å’Œé¡¹ç›®ã€‚é»˜è®¤æƒ…å†µä¸‹ã€‚åœ¨åˆ›å»ºç”¨æˆ·ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿æ¥åˆ°Keystoneã€‚é—®é¢˜æ¥äº†ï¼Œç°åœ¨æˆ‘ä»¬æ²¡æœ‰ä»»ä½•ç”¨æˆ·ï¼Œæˆ‘ä»¬å¦‚ä½•ç™»å½•KeyStoneå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ADMIN_TOKENå°±å¯ä»¥å¸®å¿™äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¶…çº§å¯†ç ç›´æ¥ç™»å½•åˆ°KeyStoneä¸Šï¼Œæ‰€ä»¥è¯´ï¼Œä¸€å®šè¦ä¿æŠ¤å¥½ä½ çš„ADMIN_TOKENã€‚ å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬è¦è¿æ¥åˆ°Keystoneä¸Šï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨--os-tokenç­‰å‚æ•°çš„æ–¹å¼ï¼ˆå°±æ˜¯é€šè¿‡å‚æ•°çš„æ–¹å¼ï¼‰</li><li>ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆå°†å‚æ•°è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œkeystoneç›´æ¥è¯»å–ç¯å¢ƒå˜é‡ï¼‰</li><li>è®¾ç½®ç¯å¢ƒå˜é‡</li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªç¯å¢ƒå˜é‡ç”¨æ¥è¿æ¥keystoneã€‚adminç”¨æˆ·å’Œå¯†ç å°±æ˜¯æˆ‘ä»¬å‰é¢ä½¿ç”¨keystone-manage bootstrapåˆå§‹åŒ–çš„ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# </span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¯·æ³¨æ„ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œä¸è¦æ‰“å¼€æ–°çš„ä¼šè¯è¿›è¡Œæ“ä½œã€‚</p><ol><li>åˆ›å»ºå®éªŒç”¨çš„demoé¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²</li></ol><p>ä¸‹é¢æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·å’Œç§Ÿæˆ·ï¼Œæˆ‘ä»¬ä¸‹é¢çš„å®éªŒå‡ä½¿ç”¨è¿™ä¸ªæ™®é€šç”¨æˆ·è¿›è¡ŒOpenstackçš„ç®¡ç†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack domain create --description "An Example Domain" example</span></span>
<span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Demo Project" myproject</span></span>
<span class="line"><span style="color:#a6accd"># openstack user create --domain default --password-prompt myuser</span></span>
<span class="line"><span style="color:#a6accd"># openstack role create myrole</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project myproject --user myuser myrole</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>åœ¨åˆ›å»ºç”¨æˆ·çš„æ—¶å€™å¯ä»¥ä½¿ç”¨--password-promptï¼Œç„¶åæ ¹æ®æç¤ºè¾“å…¥å¯†ç </p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªæœåŠ¡çš„é¡¹ç›®</p><p>OpenStackæœåŠ¡ä¹Ÿéœ€è¦ä½¿ç”¨ç”¨æˆ·åã€ç§Ÿæˆ·å’Œè§’è‰²ï¼Œç”¨æ¥è®¿é—®OpenStackçš„å„ä¸ªæœåŠ¡ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Service Project" service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºå„ä¸ªæœåŠ¡è¿æ¥Keystoneçš„è´¦æˆ· åé¢æˆ‘ä»¬éƒ¨ç½²çš„å…¶å®ƒæœåŠ¡éƒ½éœ€è¦åˆ°Keystoneä¸Šè¿›è¡Œè®¤è¯ï¼Œæ‰€ä»¥ç°åœ¨å°±å¯ä»¥æå‰å°†å„ä¸ªæœåŠ¡çš„è´¦å·åˆ›å»ºä¸Šã€‚å¹¶å…¨éƒ¨åŠ å…¥serviceé¡¹ç›®ã€‚</p><ul><li><p>åˆ›å»ºglanceç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password glance glance</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user glance admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºnovaç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password nova nova</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user nova admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºplacementç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password placement placement</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user placement admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºNeutronç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password neutron neutron</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user neutron admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºcinderç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password cinder cinder</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user cinder admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul></li></ol><h3 id="éªŒè¯keystoneå®‰è£…" tabindex="-1">éªŒè¯Keystoneå®‰è£… <a aria-current="page" href="#éªŒè¯keystoneå®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å–æ¶ˆOS_TOKENå’ŒOS_URLè¿™ä¸¤ä¸ªå˜é‡ã€‚è¿™ä¸¤ä¸ªå˜é‡æ˜¯ç”¨äºå¼•å¯¼æˆ‘ä»¬åˆ›å»ºAdminç”¨æˆ·å’ŒKeystoneæœåŠ¡è‡ªèº«Serviceå’ŒEndpointæ³¨å†Œæ—¶å€™çš„ç”¨çš„ï¼Œç°åœ¨å·²ç»ä¸éœ€è¦äº†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# unset OS_AUTH_URL OS_PASSWORD</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æµ‹è¯•adminç”¨æˆ·</strong></p><p>å¯†ç ä¸ºadminï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡ï¼Œå¦‚æœèƒ½æ­£å¸¸è·å–tokenè¯´æ˜é…ç½®æˆåŠŸã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name admin --os-username admin token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd">#å¯†ç ä¸ºadminï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡ï¼Œå¦‚æœèƒ½æ­£å¸¸è·å–tokenè¯´æ˜é…ç½®æˆåŠŸã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æµ‹è¯•myuserç”¨æˆ·</strong></p><p>å¯†ç ä¸ºä½ è®¾ç½®çš„ï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡ï¼Œå¦‚æœèƒ½æ­£å¸¸è·å–tokenè¯´æ˜é…ç½®æˆåŠŸã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name myproject --os-username myuser token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ç¯å¢ƒå˜é‡è„šæœ¬é…ç½®" tabindex="-1">ç¯å¢ƒå˜é‡è„šæœ¬é…ç½® <a aria-current="page" href="#ç¯å¢ƒå˜é‡è„šæœ¬é…ç½®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä½¿ç”¨Keystoneå‘½ä»¤æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§å°±åƒä¸Šé¢ã€‚æˆ‘ä»¬ä½¿ç”¨æŒ‡å®š--os-usernameã€--os-passwordå’Œ--os-passwordè¿™æ ·çš„é€‰é¡¹æ¥è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯è¿™æ ·åœ¨æˆ‘ä»¬æ—¥å¸¸æ“ä½œä¸­ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ç¬¬äºŒç§æ–¹å¼å°±æ˜¯ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡ä½¿ç”¨éƒ½è¦åˆ¶å®šå˜é‡ã€‚æˆ‘ä»¬å°†è¿™äº›å¸¸ç”¨çš„å˜é‡è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚ ä¸‹é¢å»ºç«‹ç¯å¢ƒå˜é‡ä¸ºå…¶å®ƒæœåŠ¡éƒ¨ç½²å’Œé…ç½®ä½¿ç”¨</p><ol><li>è®¾ç½®adminç¯å¢ƒå˜é‡è„šæœ¬</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åˆ›å»ºæ™®é€šç”¨æˆ·çš„ç¯å¢ƒå˜é‡è„šæœ¬</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=myproject</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=myuser</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=123.com</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ›å»ºå®Œæ¯•å˜é‡åï¼Œåœ¨åæœŸä½¿ç”¨æŸä¸ªè´¦æˆ·çš„æƒé™ï¼Œåªéœ€è¦sourceä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æµ‹è¯•demoç”¨æˆ·ï¼Œæ˜¯å¦èƒ½å¤Ÿè·å–token</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/demo-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-3-openstackéªŒè¯æœåŠ¡keystone-1" tabindex="-1">1.3 OpenStackéªŒè¯æœåŠ¡KeyStone <a aria-current="page" href="#_1-3-openstackéªŒè¯æœåŠ¡keystone-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>Keystoneï¼ˆOpenStack Identity Serviceï¼‰æ˜¯OpenStackæ¡†æ¶ä¸­ï¼Œè´Ÿè´£èº«ä»½éªŒè¯ã€æœåŠ¡è§„åˆ™å’ŒæœåŠ¡ä»¤ç‰Œçš„åŠŸèƒ½ï¼Œå®ƒå®ç°äº†OpenStackçš„Identity APIã€‚</p><p>Keystoneç±»ä¼¼ä¸€ä¸ªæœåŠ¡æ€»çº¿ï¼Œ æˆ–è€…è¯´æ˜¯æ•´ä¸ªOpenStackæ¡†æ¶çš„æ³¨å†Œä¸­å¿ƒï¼Œå…¶ä»–æœåŠ¡é€šè¿‡keystoneæ¥æ³¨å†Œå…¶æœåŠ¡çš„Endpointï¼ˆæœåŠ¡è®¿é—®çš„URLï¼‰ï¼Œä»»ä½•æœåŠ¡ä¹‹é—´ç›¸äº’çš„è°ƒç”¨ï¼Œéœ€è¦ç»è¿‡Keystoneçš„èº«ä»½éªŒè¯ï¼Œæ¥è·å¾—ç›®æ ‡æœåŠ¡çš„Endpointæ¥æ‰¾åˆ°ç›®æ ‡æœåŠ¡ã€‚</p><h3 id="keystoneæ¦‚è¿°-1" tabindex="-1">Keystoneæ¦‚è¿° <a aria-current="page" href="#keystoneæ¦‚è¿°-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Keystoneæä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼š</p><ul><li>ç”¨æˆ·ä¸è®¤è¯:ç”¨æˆ·æƒé™ä¸ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªï¼›</li><li>æœåŠ¡ç›®å½•:æä¾›ä¸€ä¸ªæœåŠ¡ç›®å½•ï¼ŒåŒ…æ‹¬æ‰€æœ‰æœåŠ¡é¡¹ä¸ç›¸å…³Apiçš„ç«¯ç‚¹ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬ä»è¿™ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ¥äº†è§£Keystoneçš„æ¦‚å¿µï¼Œå’ŒKeystoneåœ¨Openstackä¸­çš„ä½œç”¨ã€‚</p><ol><li><p>Keystoneç”¨æˆ·ä¸è®¤è¯</p><p>Keystoneä¸ºå„ä¸ªOpenstackç»„ä»¶æä¾›ç”¨æˆ·å’Œè®¤è¯æœåŠ¡ï¼Œå„ä¸ªç»„ä»¶éƒ½å¿…é¡»ä¸Keystoneè¿›è¡Œäº¤äº’ã€‚æ¯”å¦‚ç™»é™†è®¤è¯æ˜¯ç”¨æˆ·åœ¨è®¿é—®Openstackå„ä¸ªç»„ä»¶ä¸­çš„APIæ—¶ï¼Œå¿…é¡»é€šè¿‡Keystoneçš„ç”¨æˆ·åå’Œå¯†ç éªŒè¯ï¼Œæœ€ç»ˆé€šè¿‡KyestoneéªŒè¯è·å–tokenï¼Œå®Œæˆå¯¹ç”¨æˆ·çš„ç™»é™†è®¤è¯ã€‚å¦‚æœè®¤è¯å¤±è´¥ï¼Œè¯¥ç”¨æˆ·å°†ä¸èƒ½è®¿é—®è¯¥APIã€‚</p></li></ol><p><strong>User</strong></p><p>Userå³ç”¨æˆ·ï¼Œå®ƒæ˜¯ç”¨ä¸€ä¸ªæ•°å­—ä»£è¡¨ä½¿ç”¨OpenStackäº‘æœåŠ¡çš„ä¸€ä¸ªäººã€ç³»ç»Ÿã€æˆ–æœåŠ¡ã€‚èº«ä»½éªŒè¯æœåŠ¡å°†ä¼šéªŒè¯ä¼ å…¥çš„ç”±ç”¨æˆ·å£°æ˜å°†è°ƒç”¨çš„è¯·æ±‚ã€‚ç”¨æˆ·å¦‚æœå·²ç»ç™»å½•ï¼Œå¯å°±èƒ½åˆ†é…ä»¤ç‰Œï¼ˆtokensï¼‰è®¿é—®èµ„æºã€‚ ç”¨æˆ·å¯èƒ½è¢«ç›´æ¥åˆ†é…ç»™ç‰¹å®šçš„ç§Ÿæˆ·ï¼Œç”¨æˆ·è¡Œä¸ºè¢«åŒ…å«åœ¨ç§Ÿæˆ·ï¼ˆtenantï¼‰ï¼ŒUsersé€šè¿‡è®¤è¯ä¿¡æ¯ï¼ˆcredentialsï¼Œå¦‚å¯†ç ã€API Keysç­‰ï¼‰è¿›è¡ŒéªŒè¯ã€‚</p><p><strong>Credentials</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">Credentialså³è¯ä¹¦ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡èº«ä»½éªŒè¯ï¼Œä¿è¯æ•°æ®é€šå¸¸åªè¢«ä¸€ä¸ªç”¨æˆ·å±äºæˆ–æ‹¥æœ‰(å› ä¸ºæ²¡æœ‰å…¶ä»–äººåº”è¯¥çŸ¥é“æ•°æ®)ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä»¥ä¸‹ä¸ºè¯ä¹¦çš„ä¾‹å­: ï¬ä¸€ä¸ªåŒ¹é…çš„ç”¨æˆ·åå’Œå¯†ç  ï¬ä¸€ä¸ªåŒ¹é…çš„ç”¨æˆ·åå’ŒAPIé”® ï¬ä¸€ä¸ªèº«ä»½è®¤è¯ä»¤ç‰Œ</p><p><strong>Authentication</strong></p><p>Authenticationå³è®¤è¯ï¼Œè®¤è¯æ˜¯ç¡®è®¤èº«ä»½æˆ–è¯†åˆ«çœŸå®æ€§çš„è¡Œä¸ºã€‚èº«ä»½æœåŠ¡é€šè¿‡ä¸ç”¨æˆ·çš„ä¸€ç»„å£°æ˜éªŒè¯ä»¥ç¡®è®¤ä¼ å…¥çš„è¯·æ±‚æ˜¯ç”±è¯¥ç”¨æˆ·å£°æ˜è¿‡çš„ã€‚è¿™äº›å£°æ˜è¢«åˆå§‹åŒ–ä¸ºä¸€ç»„è¯ä¹¦ (username&amp;password, or username and API key)ã€‚åˆå§‹ç¡®è®¤åï¼Œèº«ä»½æœåŠ¡å°†ä¼šç»™ç”¨æˆ·å‘å¸ƒä¸€ä¸ªç¡®è®¤èº«ä»½çš„ä»¤ç‰Œ(Token)ï¼Œåœ¨ç”¨æˆ·éšåçš„è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œæˆæƒè®¿é—®ã€‚</p><p><strong>Tokenï¼š</strong></p><p>Tokenå³ä»¤ç‰Œï¼Œæ˜¯ä¸€ä¸ªç”¨æˆ·è®¿é—®èµ„æºçš„ä»»æ„æ–‡æœ¬ï¼Œæ¯ä¸€ä¸ªä»¤ç‰Œéƒ½æœ‰ä¸€ä¸ªèŒƒå›´ï¼Œæè¿°äº†å¯ä»¥è®¿é—®å“ªäº›èµ„æºã€‚ä»¤ç‰Œå¯èƒ½éšæ—¶æ’¤æ¶ˆï¼Œæ˜¯æœ‰æœ‰æ•ˆæœŸçš„ã€‚èº«ä»½è®¤è¯æ˜¯æ”¯æŒä»¤ç‰Œè®¤è¯çš„ï¼Œå®ƒçš„ç›®çš„ä¸ºåœ¨æœªæ¥æ”¯æŒé¢å¤–çš„åè®®ã€‚å…¶ç›®çš„æ˜¯ä¸ºäº†è®©å®ƒé¦–å…ˆæˆä¸ºä¸€ç§é›†æˆæœåŠ¡ï¼Œè€Œä¸æ˜¯ä¸€ç§æ¸´æœ›æˆä¸ºä¸°å¯Œçš„èº«ä»½å­˜å‚¨å’Œç®¡ç†çš„è§£å†³æ–¹æ¡ˆã€‚ T <strong>Tenantï¼š</strong></p><p>Tenantå³ç§Ÿæˆ·ï¼Œå®ƒæ˜¯å„ä¸ªæœåŠ¡ä¸­çš„ä¸€äº›å¯ä»¥è®¿é—®çš„èµ„æºé›†åˆã€‚å®ƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºç»„ç»‡å’Œéš”ç¦»èµ„æºï¼Œæˆ–æ ‡è¯†å¯¹è±¡ã€‚ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥ä¸€ä¸ªå®¢æˆ·ã€è´¦æˆ·ã€ç»„ç»‡ã€é¡¹ç›®çš„æ˜ å°„ã€‚ä¾‹å¦‚ï¼Œåœ¨Novaä¸­ä¸€ä¸ªtenantå¯ä»¥æ˜¯ä¸€äº›æœºå™¨ï¼Œåœ¨Swiftå’ŒGlanceä¸­ä¸€ä¸ªtenantå¯ä»¥æ˜¯ä¸€äº›é•œåƒå­˜å‚¨ï¼Œåœ¨Neutronä¸­ä¸€ä¸ªtenantå¯ä»¥æ˜¯ä¸€äº›ç½‘ç»œèµ„æºã€‚Usersé»˜è®¤çš„æ€»æ˜¯ç»‘å®šåˆ°æŸäº›tenantä¸Šã€‚</p><p><strong>Roleï¼š</strong></p><p>Roleå³è§’è‰²ï¼ŒRolesä»£è¡¨ä¸€ç»„ç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æºæƒé™ï¼Œä¾‹å¦‚Novaä¸­çš„è™šæ‹Ÿæœºã€Glanceä¸­çš„é•œåƒã€‚Userså¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„ä¸€ä¸ªå…¨å±€çš„æˆ–ç§Ÿæˆ·å†…çš„è§’è‰²ä¸­ã€‚åœ¨å…¨å±€çš„roleä¸­ï¼Œç”¨æˆ·çš„roleæƒé™ä½œç”¨äºæ‰€æœ‰çš„ç§Ÿæˆ·ï¼Œå³å¯ä»¥å¯¹æ‰€æœ‰çš„ç§Ÿæˆ·æ‰§è¡Œroleè§„å®šçš„æƒé™ï¼›åœ¨ç§Ÿæˆ·å†…çš„roleä¸­ï¼Œç”¨æˆ·ä»…èƒ½åœ¨å½“å‰ç§Ÿæˆ·å†…æ‰§è¡Œroleè§„å®šçš„æƒé™ã€‚</p><p><strong>Domainï¼š</strong></p><p>åœ¨KeyStone V3ç‰ˆæœ¬å°† Tenant æ”¹ä¸º Project å¹¶åœ¨å…¶ä¸Šæ·»åŠ  Domain çš„æ¦‚å¿µï¼Œè¿™æ›´åŠ ç¬¦åˆç°å®ä¸–ç•Œå’Œäº‘æœåŠ¡çš„æ˜ å°„ã€‚åˆ©ç”¨ Domain å®ç°çœŸæ­£çš„å¤šç§Ÿæˆ·ï¼ˆmulti-tenancyï¼‰æ¶æ„ï¼ŒDomain æ‹…ä»» Project çš„é«˜å±‚å®¹å™¨ã€‚äº‘æœåŠ¡çš„å®¢æˆ·æ˜¯ Domain çš„æ‰€æœ‰è€…ï¼Œä»–ä»¬å¯ä»¥åœ¨è‡ªå·±çš„ Domain ä¸­åˆ›å»ºå¤šä¸ª Projectsã€Usersã€Groups å’Œ Rolesã€‚é€šè¿‡å¼•å…¥ Domainï¼Œäº‘æœåŠ¡å®¢æˆ·å¯ä»¥å¯¹å…¶æ‹¥æœ‰çš„å¤šä¸ª Project è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œè€Œä¸å¿…å†å‘è¿‡å»é‚£æ ·å¯¹æ¯ä¸€ä¸ª Project è¿›è¡Œå•ç‹¬ç®¡ç†ã€‚</p><p><strong>Groupï¼š</strong></p><p>Group æ˜¯ä¸€ç»„ Users çš„å®¹å™¨ï¼Œå¯ä»¥å‘ Group ä¸­æ·»åŠ ç”¨æˆ·ï¼Œå¹¶ç›´æ¥ç»™ Group åˆ†é…è§’è‰²ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ª Group ä¸­çš„æ‰€æœ‰ç”¨æˆ·å°±éƒ½æ‹¥æœ‰äº† Group æ‰€æ‹¥æœ‰çš„è§’è‰²æƒé™ã€‚é€šè¿‡å¼•å…¥ Group çš„æ¦‚å¿µï¼ŒKeystone V3 å®ç°äº†å¯¹ç”¨æˆ·ç»„çš„ç®¡ç†ï¼Œè¾¾åˆ°äº†åŒæ—¶ç®¡ç†ä¸€ç»„ç”¨æˆ·æƒé™çš„ç›®çš„ã€‚è¿™ä¸ V2 ä¸­ç›´æ¥å‘ User/Project æŒ‡å®š Role ä¸åŒï¼Œä½¿å¾—å¯¹äº‘æœåŠ¡è¿›è¡Œç®¡ç†æ›´åŠ ä¾¿æ·ã€‚ Domainã€Groupã€Projectã€User å’Œ Role çš„å…³ç³»å›¾</p><p>å¦‚å›¾ 2 æ‰€ç¤ºï¼Œåœ¨ä¸€ä¸ª Domain ä¸­åŒ…å« 3 ä¸ª Projects,å¯ä»¥é€šè¿‡ Group1 å°† Role Sysadminç›´æ¥èµ‹äºˆ Domain,é‚£ä¹ˆ Group1 ä¸­çš„æ‰€æœ‰ç”¨æˆ·å°†ä¼šå¯¹ Domain ä¸­çš„æ‰€æœ‰ Projects éƒ½æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ Group2 å°† Role Engineer åªèµ‹äºˆ Project3,è¿™æ · Group2 ä¸­çš„ User å°±åªæ‹¥æœ‰å¯¹ Project3 ç›¸åº”çš„æƒé™ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒ Projectsã€‚</p><ol><li><p>KeystoneæœåŠ¡ç›®å½•</p><p>ä¸Šæ–‡è¯´è¿‡ï¼ŒKeystoneé™¤äº†ç”¨æˆ·ç®¡ç†ç›¸å…³çš„æ”¯æ’‘ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨æ˜¯ä¸€ä¸ªæœåŠ¡ç›®å½•ã€‚KeyStoneä¸ºOpenstackå„ä¸ªæœåŠ¡æä¾›äº†ä¸€ä¸ªREST APIç«¯ç‚¹åˆ—è¡¨ã€‚</p></li><li><p>Service Serviceå³æœåŠ¡ï¼Œå¦‚Novaã€Glanceã€Swiftã€‚æ ¹æ®å‰ä¸‰ä¸ªæ¦‚å¿µï¼ˆUserï¼ŒTenantå’ŒRoleï¼‰ä¸€ä¸ªæœåŠ¡å¯ä»¥ç¡®è®¤å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®å…¶èµ„æºçš„æƒé™ã€‚ä½†æ˜¯å½“ä¸€ä¸ªuserå°è¯•ç€è®¿é—®å…¶ç§Ÿæˆ·å†…çš„serviceæ—¶ï¼Œä»–å¿…é¡»çŸ¥é“è¿™ä¸ªserviceæ˜¯å¦å­˜åœ¨ä»¥åŠå¦‚ä½•è®¿é—®è¿™ä¸ªserviceï¼Œè¿™é‡Œé€šå¸¸ä½¿ç”¨ä¸€äº›ä¸åŒçš„åç§°è¡¨ç¤ºä¸åŒçš„æœåŠ¡ã€‚åœ¨ä¸Šæ–‡ä¸­è°ˆåˆ°çš„Roleï¼Œå®é™…ä¸Šä¹Ÿæ˜¯å¯ä»¥ç»‘å®šåˆ°æŸä¸ªserviceçš„ã€‚</p></li><li><p>Endpoint Endpointï¼Œç¿»è¯‘ä¸ºâ€œç«¯ç‚¹â€ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£å®ƒæ˜¯ä¸€ä¸ªæœåŠ¡æš´éœ²å‡ºæ¥çš„è®¿é—®ç‚¹ï¼Œå¦‚æœéœ€è¦è®¿é—®ä¸€ä¸ªæœåŠ¡ï¼Œåˆ™å¿…é¡»çŸ¥é“ä»–çš„endpointã€‚å› æ­¤ï¼Œåœ¨keystoneä¸­åŒ…å«ä¸€ä¸ªendpointæ¨¡æ¿ï¼ˆendpoint templateï¼Œåœ¨å®‰è£…keystoneçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨confæ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªæ¨¡æ¿æä¾›äº†æ‰€æœ‰å­˜åœ¨çš„æœåŠ¡endpointsä¿¡æ¯ã€‚ä¸€ä¸ªendpoint templateåŒ…å«ä¸€ä¸ªURLsåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªURLéƒ½å¯¹åº”ä¸€ä¸ªæœåŠ¡å®ä¾‹çš„è®¿é—®åœ°å€ï¼Œå¹¶ä¸”å…·æœ‰publicã€privateå’Œadminè¿™ä¸‰ç§æƒé™ã€‚public urlå¯ä»¥è¢«å…¨å±€è®¿é—®ï¼ˆå¦‚<a href="http://compute.example.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://compute.example.comï¼‰ï¼Œprivate<!--]--></a>%2Cprivate/) urlåªèƒ½è¢«å±€åŸŸç½‘è®¿é—®ï¼ˆå¦‚<a href="http://compute.example.local" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://compute.example.localï¼‰ï¼Œadmin<!--]--></a>%2Cadmin/) urlè¢«ä»å¸¸è§„çš„è®¿é—®ä¸­åˆ†ç¦»ã€‚</p></li></ol><h3 id="keystoneéƒ¨ç½²-1" tabindex="-1">KeyStoneéƒ¨ç½² <a aria-current="page" href="#keystoneéƒ¨ç½²-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>OpenStackä¸­æ‰€æœ‰æœåŠ¡çš„å®‰è£…å¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„ã€‚å¤æ‚çš„å°±åœ¨äºæœ¬èº«çš„é…ç½®æ–‡ä»¶çš„ä¿®æ”¹å’Œä¸Keystoneç›¸å…³çš„é…ç½®ã€‚è¿˜è®°å¾—ä¸Šé¢è¯´çš„ï¼ŒOpenStackçš„æ¯ä¸ªç»„ä»¶å¦‚æœèƒ½å¤Ÿä½¿ç”¨éƒ½å¿…é¡»åœ¨Keystoneåˆ›å»ºServiceå’ŒEndpointå—ï¼Ÿå¥½çš„ï¼Œæˆ‘ä»¬å¼€å§‹ã€‚</p><ol><li>å®‰è£…keystone</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-keystone httpd mod_wsgi memcached python-memcached</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è®¾ç½®Memcacheå¼€å¯å¯åŠ¨å¹¶å¯åŠ¨Memcached</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">#keystoneä½¿ç”¨Memcachedæ¥ç¼“å­˜éªŒè¯åç”Ÿæˆçš„tokenã€‚</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable memcached.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/memcached</span></span>
<span class="line"><span style="color:#a6accd">PORT="11211"</span></span>
<span class="line"><span style="color:#a6accd">USER="memcached"</span></span>
<span class="line"><span style="color:#a6accd">MAXCONN="1024"</span></span>
<span class="line"><span style="color:#a6accd">CACHESIZE="64"</span></span>
<span class="line"><span style="color:#a6accd">OPTIONS="-l 192.168.56.11,::1"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start memcached.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Keystoneé…ç½®</li></ol><p>KeyStoneçš„é…ç½®åªéœ€è¦ä¿®æ”¹/etc/keystone/keystone.confå³å¯ï¼Œæ¶‰åŠAdmin Tokenå’ŒMysqlè¿æ¥ï¼Œå…¶å®ƒå‡ä½¿ç”¨é»˜è®¤é…ç½®å³å¯ã€‚æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½å­˜æ”¾åˆ°/etc/keystoneï¼ˆé¡¹ç›®åï¼‰ç›®å½•ä¸‹ã€‚æ—¥å¿—éƒ½å­˜æ”¾åœ¨/var/log/keystoneï¼ˆé¡¹ç›®åï¼‰ç›®å½•ä¸‹ï¼Œå…¶å®ƒé¡¹ç›®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ å¥½çš„ï¼Œæˆ‘ä»¬æš‚åœä¸€ä¸‹ï¼Œåœ¨åé¢çš„éƒ¨ç½²ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è¿™æ ·çš„æ–¹å¼åˆ—å‡ºé…ç½®ï¼Œæœªåˆ—å‡ºçš„é…ç½®ï¼Œä¿æŒé»˜è®¤ä¸è¿›è¡Œä¿®æ”¹ï¼Œé™¤éç‰¹åˆ«æç¤ºåˆ°ã€‚å¦å¤–è¦æ³¨æ„é…ç½®çš„ä½ç½®ï¼ŒOpenStackæ‰€æœ‰æœåŠ¡éƒ½ä¼šæœ‰[DEFAULT] [dtabase] è¿™æ ·çš„é…ç½®éƒ¨åˆ†ï¼Œè¯·åœ¨æ–‡ä¸­åˆ—å‡ºçš„é…ç½®éƒ¨åˆ†é‡Œé¢è¿›è¡Œé…ç½®ï¼Œåˆ‡è®°ï¼ã€‚å› ä¸ºç¡®å®æœ‰ç›¸åŒçš„é…ç½®å­˜åœ¨åœ¨ä¸åŒçš„é…ç½®ç«¯çš„æƒ…å†µï¼Œè¿™æ ·ä¾‹å¤–æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰æŒ‰è¦æ±‚é…ç½®ï¼Œå¯èƒ½å°±æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><ul><li><p>é…ç½®KeyStoneæ•°æ®åº“</p><p>OpenStackä¸­æ‰€æœ‰æœåŠ¡çš„æ•°æ®åº“åŒæ­¥éƒ½éœ€è¦ä¾èµ–ä¸é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥çš„é…ç½®ï¼Œæ‰€ä»¥å¿…é¡»å…ˆä¿®æ”¹å®Œæ¯•é…ç½®æ–‡ä»¶åï¼Œå†è¿›è¡Œæ•°æ®åº“çš„åˆå§‹åŒ–æ“ä½œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/keystone/keystone.conf</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>è®¾ç½®Tokenå’ŒMemcached</p></li></ul><p>åœ¨ä¹‹å‰çš„KeyStoneç‰ˆæœ¬ç”±äºæ‰€æœ‰çš„APIé€šä¿¡éƒ½è¦è¯·æ±‚Keystoneæ¥ç”Ÿäº§Tokenï¼Œä¹‹å‰æ˜¯å­˜æ”¾åœ¨MySQLè¡¨é‡Œï¼Œå¯¼è‡´è¡¨ç‰¹åˆ«å¤§ï¼Œç»å¸¸éœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œè€Œä¸”æ€§èƒ½ä¸‹é™ï¼Œç°åœ¨æ–°çš„ç‰ˆæœ¬æˆ‘ä»¬å¯ä»¥å­˜æ”¾åœ¨memcacheé‡Œé¢äº†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[token]</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>åŒæ­¥æ•°æ®åº“ï¼š</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "keystone-manage db_sync" keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>å°æç¤ºï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨keystoneç”¨æˆ·æ¥åŒæ­¥æ•°æ®å‘¢ï¼Œå› ä¸ºåŒæ­¥æ“ä½œä¼šç”Ÿäº§æ—¥å¿—/var/log/keystone/keystone.logï¼Œå¦‚æœä½¿ç”¨rootç”¨æˆ·ï¼Œé‚£ä¹ˆç”Ÿæˆçš„æ–‡ä»¶æƒé™ä¸ºrootç”¨æˆ·ï¼Œkeystoneå¯åŠ¨çš„æ—¶å€™æ²¡æœ‰æƒé™è¯»å–è¯¥æ–‡ä»¶ï¼Œä¼šæ— æ³•å¯åŠ¨ã€‚å¦‚æœä½ çš„åŒæ­¥æ‰§è¡Œæœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚</p></blockquote><ul><li>éªŒè¯æ•°æ®åº“åˆ›å»ºæ˜¯å¦æ­£å¸¸ï¼š</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -ukeystone -pkeystone -e "use keystone;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>åˆå§‹åŒ–fernet keys</p><p>ç”Ÿæˆå®Œæ¯•ä¹‹åï¼Œä¼šåˆ›å»º/etc/keystone/fernet-keysç›®å½•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆå§‹åŒ–keystone</p></li></ol><p>è¿˜è®°å¾—ä¸Šé¢è¯´çš„Openstackçš„æ¯ä¸ªç»„ä»¶éƒ½å¿…é¡»åœ¨Keystoneä¸Šè¿›è¡Œæ³¨å†Œã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬Keystoneæœ¬èº«ã€‚èº«ä»½è®¤è¯æœåŠ¡ç®¡ç†äº†ä¸€ä¸ªä¸æ‚¨ç¯å¢ƒç›¸å…³çš„ API ç«¯ç‚¹çš„ç›®å½•ã€‚æœåŠ¡ä½¿ç”¨è¿™ä¸ªç›®å½•æ¥å†³å®šå¦‚ä½•ä¸æ‚¨ç¯å¢ƒä¸­çš„å…¶ä»–æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚ OpenStackä½¿ç”¨ä¸‰ä¸ªAPIç«¯ç‚¹å˜ç§ä»£è¡¨æ¯ç§æœåŠ¡ï¼šadminï¼Œinternalå’Œpublicã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡ç†APIç«¯ç‚¹å…è®¸ä¿®æ”¹ç”¨æˆ·å’Œç§Ÿæˆ·è€Œå…¬å…±å’Œå†…éƒ¨APIsä¸å…è®¸è¿™äº›æ“ä½œã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¤„äºå®‰å…¨åŸå› ï¼Œå˜ç§ä¸ºäº†æœåŠ¡ä¸åŒç±»å‹çš„ç”¨æˆ·å¯èƒ½é©»ç•™åœ¨å•ç‹¬çš„ç½‘ç»œä¸Šã€‚ å¯¹å®ä¾‹è€Œè¨€ï¼Œå…¬å…±APIç½‘ç»œä¸ºäº†è®©é¡¾å®¢ç®¡ç†ä»–ä»¬è‡ªå·±çš„äº‘åœ¨äº’è”ç½‘ä¸Šæ˜¯å¯è§çš„ã€‚ç®¡ç†APIç½‘ç»œåœ¨ç®¡ç†äº‘åŸºç¡€è®¾æ–½çš„ç»„ç»‡ä¸­æ“ä½œä¹Ÿæ˜¯æœ‰æ‰€é™åˆ¶çš„ã€‚å†…éƒ¨APIç½‘ç»œå¯èƒ½ä¼šè¢«é™åˆ¶åœ¨åŒ…å«OpenStackæœåŠ¡çš„ä¸»æœºä¸Šã€‚æ­¤å¤–ï¼ŒOpenStackæ”¯æŒå¯ä¼¸ç¼©æ€§çš„å¤šåŒºåŸŸã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œå‡ä½¿ç”¨ä¸€ä¸ªIPåœ°å€ã€‚192.168.56.11ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# keystone-manage bootstrap --bootstrap-password admin \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-admin-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-internal-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-public-url http://192.168.56.11:5000/v3/ \</span></span>
<span class="line"><span style="color:#a6accd"> --bootstrap-region-id RegionOne</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>éªŒè¯Keystoneé…ç½®</li></ol><p>ä¸‹é¢æˆ‘å°†ä¸Šé¢è¿›è¡Œçš„é…ç½®åˆ—å‡ºæ¥ï¼Œä¾›è¯»è€…è¿›è¡Œæ¯”å¯¹ï¼Œé…ç½®åº”è¯¥å’Œæœ¬æ–‡ä¿æŒä¸€è‡´ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# grep "^[a-z]" /etc/keystone/keystone.conf </span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://keystone:keystone@192.168.56.11/keystone</span></span>
<span class="line"><span style="color:#a6accd">provider = fernet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>KeyStoneå¯åŠ¨</li></ol><p>OpenStack Keystoneä½¿ç”¨Apacheæ¥è¿›è¡Œå¯åŠ¨ï¼Œæé«˜äº†æ€§èƒ½ã€‚ é…ç½®ServerNameï¼Œæ³¨æ„ä¸€å®šè¦é…ç½®ï¼Œä¸ç„¶ä¼šæœ‰å¥‡æ€ªçš„é—®é¢˜å‡ºç°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#a6accd">ServerName 192.168.56.11:80</span></span>
<span class="line"><span style="color:#a6accd">åˆ›å»ºé…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯åŠ¨keystoneï¼Œå¹¶æŸ¥çœ‹ç«¯å£ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::5000                 :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">tcp6       0      0 :::80                   :::*              LISTEN      3408/httpd</span></span>
<span class="line"><span style="color:#a6accd">ç°åœ¨ï¼Œå¦‚æœä½ çš„Keystoneæ²¡æœ‰æ­£å¸¸çš„ç›‘å¬ç«¯å£ï¼Œé‚£ä¹ˆè¯·æŸ¥çœ‹æ—¥å¿—ï¼ŒåæœŸæˆ‘ä»¬ä¼šä¸åœçš„å¼ºè°ƒè¯»è€…é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ¥æ’æŸ¥é—®é¢˜ï¼ŒOpenStackçš„æ—¥å¿—æ˜¯å€¼å¾—ä¿¡èµ–çš„ã€‚å¦‚æœä½ æƒ³è®©æœ‹å‹å¸®åŠ©è§£å†³é—®é¢˜ï¼Œè¯·ä¸è¦ä½¿ç”¨æ—¥å¿—æˆªå›¾çš„æ–¹å¼ï¼Œè¯·å‘é€å®Œæ•´çš„æ—¥å¿—ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="keystoneæƒé™ç®¡ç†-1" tabindex="-1">Keystoneæƒé™ç®¡ç† <a aria-current="page" href="#keystoneæƒé™ç®¡ç†-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æˆ‘ä»¬å·²ç»æˆåŠŸçš„è¿è¡Œäº†KeystoneæœåŠ¡ï¼Œè¦æä¾›èº«ä»½è®¤è¯æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨åŸŸã€é¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²çš„ç»„åˆã€‚ é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜ç”¨æˆ·ã€è§’è‰²å’Œé¡¹ç›®ã€‚é»˜è®¤æƒ…å†µä¸‹ã€‚åœ¨åˆ›å»ºç”¨æˆ·ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿æ¥åˆ°Keystoneã€‚é—®é¢˜æ¥äº†ï¼Œç°åœ¨æˆ‘ä»¬æ²¡æœ‰ä»»ä½•ç”¨æˆ·ï¼Œæˆ‘ä»¬å¦‚ä½•ç™»å½•KeyStoneå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ADMIN_TOKENå°±å¯ä»¥å¸®å¿™äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¶…çº§å¯†ç ç›´æ¥ç™»å½•åˆ°KeyStoneä¸Šï¼Œæ‰€ä»¥è¯´ï¼Œä¸€å®šè¦ä¿æŠ¤å¥½ä½ çš„ADMIN_TOKENã€‚ å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬è¦è¿æ¥åˆ°Keystoneä¸Šï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨--os-tokenç­‰å‚æ•°çš„æ–¹å¼ï¼ˆå°±æ˜¯é€šè¿‡å‚æ•°çš„æ–¹å¼ï¼‰</li><li>ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆå°†å‚æ•°è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œkeystoneç›´æ¥è¯»å–ç¯å¢ƒå˜é‡ï¼‰</li><li>è®¾ç½®ç¯å¢ƒå˜é‡</li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªç¯å¢ƒå˜é‡ç”¨æ¥è¿æ¥keystoneã€‚adminç”¨æˆ·å’Œå¯†ç å°±æ˜¯æˆ‘ä»¬å‰é¢ä½¿ç”¨keystone-manage bootstrapåˆå§‹åŒ–çš„ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# </span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¯·æ³¨æ„ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œä¸è¦æ‰“å¼€æ–°çš„ä¼šè¯è¿›è¡Œæ“ä½œã€‚</p><ol><li>åˆ›å»ºå®éªŒç”¨çš„demoé¡¹ç›®ã€ç”¨æˆ·å’Œè§’è‰²</li></ol><p>ä¸‹é¢æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·å’Œç§Ÿæˆ·ï¼Œæˆ‘ä»¬ä¸‹é¢çš„å®éªŒå‡ä½¿ç”¨è¿™ä¸ªæ™®é€šç”¨æˆ·è¿›è¡ŒOpenstackçš„ç®¡ç†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack domain create --description "An Example Domain" example</span></span>
<span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Demo Project" myproject</span></span>
<span class="line"><span style="color:#a6accd"># openstack user create --domain default --password-prompt myuser</span></span>
<span class="line"><span style="color:#a6accd"># openstack role create myrole</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project myproject --user myuser myrole</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>åœ¨åˆ›å»ºç”¨æˆ·çš„æ—¶å€™å¯ä»¥ä½¿ç”¨--password-promptï¼Œç„¶åæ ¹æ®æç¤ºè¾“å…¥å¯†ç </p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªæœåŠ¡çš„é¡¹ç›®</p><p>OpenStackæœåŠ¡ä¹Ÿéœ€è¦ä½¿ç”¨ç”¨æˆ·åã€ç§Ÿæˆ·å’Œè§’è‰²ï¼Œç”¨æ¥è®¿é—®OpenStackçš„å„ä¸ªæœåŠ¡ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack project create --domain default --description "Service Project" service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºå„ä¸ªæœåŠ¡è¿æ¥Keystoneçš„è´¦æˆ· åé¢æˆ‘ä»¬éƒ¨ç½²çš„å…¶å®ƒæœåŠ¡éƒ½éœ€è¦åˆ°Keystoneä¸Šè¿›è¡Œè®¤è¯ï¼Œæ‰€ä»¥ç°åœ¨å°±å¯ä»¥æå‰å°†å„ä¸ªæœåŠ¡çš„è´¦å·åˆ›å»ºä¸Šã€‚å¹¶å…¨éƒ¨åŠ å…¥serviceé¡¹ç›®ã€‚</p><ul><li><p>åˆ›å»ºglanceç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password glance glance</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user glance admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºnovaç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password nova nova</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user nova admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºplacementç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password placement placement</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user placement admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºNeutronç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password neutron neutron</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user neutron admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>åˆ›å»ºcinderç”¨æˆ·</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack user create --domain default --password cinder cinder</span></span>
<span class="line"><span style="color:#a6accd"># openstack role add --project service --user cinder admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul></li></ol><h3 id="éªŒè¯keystoneå®‰è£…-1" tabindex="-1">éªŒè¯Keystoneå®‰è£… <a aria-current="page" href="#éªŒè¯keystoneå®‰è£…-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å–æ¶ˆOS_TOKENå’ŒOS_URLè¿™ä¸¤ä¸ªå˜é‡ã€‚è¿™ä¸¤ä¸ªå˜é‡æ˜¯ç”¨äºå¼•å¯¼æˆ‘ä»¬åˆ›å»ºAdminç”¨æˆ·å’ŒKeystoneæœåŠ¡è‡ªèº«Serviceå’ŒEndpointæ³¨å†Œæ—¶å€™çš„ç”¨çš„ï¼Œç°åœ¨å·²ç»ä¸éœ€è¦äº†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# unset OS_AUTH_URL OS_PASSWORD</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æµ‹è¯•adminç”¨æˆ·</strong></p><p>å¯†ç ä¸ºadminï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡ï¼Œå¦‚æœèƒ½æ­£å¸¸è·å–tokenè¯´æ˜é…ç½®æˆåŠŸã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name admin --os-username admin token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd">#å¯†ç ä¸ºadminï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡ï¼Œå¦‚æœèƒ½æ­£å¸¸è·å–tokenè¯´æ˜é…ç½®æˆåŠŸã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æµ‹è¯•myuserç”¨æˆ·</strong></p><p>å¯†ç ä¸ºä½ è®¾ç½®çš„ï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡ï¼Œå¦‚æœèƒ½æ­£å¸¸è·å–tokenè¯´æ˜é…ç½®æˆåŠŸã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack --os-auth-url http://192.168.56.11:5000/v3 \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-domain-name Default --os-user-domain-name Default \</span></span>
<span class="line"><span style="color:#a6accd">--os-project-name myproject --os-username myuser token issue</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ç¯å¢ƒå˜é‡è„šæœ¬é…ç½®-1" tabindex="-1">ç¯å¢ƒå˜é‡è„šæœ¬é…ç½® <a aria-current="page" href="#ç¯å¢ƒå˜é‡è„šæœ¬é…ç½®-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä½¿ç”¨Keystoneå‘½ä»¤æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§å°±åƒä¸Šé¢ã€‚æˆ‘ä»¬ä½¿ç”¨æŒ‡å®š--os-usernameã€--os-passwordå’Œ--os-passwordè¿™æ ·çš„é€‰é¡¹æ¥è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯è¿™æ ·åœ¨æˆ‘ä»¬æ—¥å¸¸æ“ä½œä¸­ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ç¬¬äºŒç§æ–¹å¼å°±æ˜¯ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡ä½¿ç”¨éƒ½è¦åˆ¶å®šå˜é‡ã€‚æˆ‘ä»¬å°†è¿™äº›å¸¸ç”¨çš„å˜é‡è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚ ä¸‹é¢å»ºç«‹ç¯å¢ƒå˜é‡ä¸ºå…¶å®ƒæœåŠ¡éƒ¨ç½²å’Œé…ç½®ä½¿ç”¨</p><ol><li>è®¾ç½®adminç¯å¢ƒå˜é‡è„šæœ¬</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=admin</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åˆ›å»ºæ™®é€šç”¨æˆ·çš„ç¯å¢ƒå˜é‡è„šæœ¬</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /root/demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_USER_DOMAIN_NAME=Default</span></span>
<span class="line"><span style="color:#a6accd">export OS_PROJECT_NAME=myproject</span></span>
<span class="line"><span style="color:#a6accd">export OS_USERNAME=myuser</span></span>
<span class="line"><span style="color:#a6accd">export OS_PASSWORD=123.com</span></span>
<span class="line"><span style="color:#a6accd">export OS_AUTH_URL=http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IDENTITY_API_VERSION=3</span></span>
<span class="line"><span style="color:#a6accd">export OS_IMAGE_API_VERSION=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ›å»ºå®Œæ¯•å˜é‡åï¼Œåœ¨åæœŸä½¿ç”¨æŸä¸ªè´¦æˆ·çš„æƒé™ï¼Œåªéœ€è¦sourceä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æµ‹è¯•demoç”¨æˆ·ï¼Œæ˜¯å¦èƒ½å¤Ÿè·å–token</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/demo-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack token issue</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-4-openstacké•œåƒæœåŠ¡glance" tabindex="-1">1.4 OpenStacké•œåƒæœåŠ¡Glance <a aria-current="page" href="#_1-4-openstacké•œåƒæœåŠ¡glance" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="glanceæ¦‚è¿°" tabindex="-1">Glanceæ¦‚è¿° <a aria-current="page" href="#glanceæ¦‚è¿°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>OpenStackä¸­çš„Glanceæ˜¯é•œåƒæœåŠ¡ï¼Œèƒ½å¤Ÿæä¾›å‘ç°ã€æ³¨å†Œå¹¶æŸ¥è¯¢è™šæ‹Ÿæœºé•œåƒï¼Œä¹Ÿæ˜¯Openstackçš„ä¸€ä¸ªç»„ä»¶æˆ–è€…è¯´é¡¹ç›®ä¹‹ä¸€ã€‚é•œåƒæœåŠ¡æä¾›äº†ä¸€ä¸ªRest APIçš„æ–¹å¼ã€‚ OpenStackçš„Glanceé•œåƒå¯ä»¥å­˜æ”¾åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥å­˜æ”¾åœ¨OpenStackçš„å¯¹è±¡å­˜å‚¨ä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨/var/lib/glance/images/ç›®å½•ä¸‹ã€‚ Glanceè¿˜ç®¡ç†ç€å¿«ç…§ï¼Œå¿«ç…§ä¹Ÿæ˜¯ä¸€ç§é•œåƒï¼Œå¯ä»¥åŸºäºå¿«ç…§åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºã€‚</p><p>Glanceä¸»è¦æœ‰ä¸¤ä¸ªç»„ä»¶</p><p>ï¼ˆå›¾2.5.2ï¼‰</p><ul><li>Glance-apiæ¥æ”¶REST APIè¯·æ±‚ï¼Œç„¶åé€šè¿‡å…¶ä»–æ¨¡å—ï¼ˆglance-registryåŠimage storeï¼‰æ¥å®Œæˆè¯¸å¦‚é•œåƒçš„æŸ¥æ‰¾ã€è·å–ã€ä¸Šä¼ ã€åˆ é™¤ç­‰æ“ä½œï¼Œapié»˜è®¤ç›‘å¬ç«¯å£9292ã€‚</li><li>glance-registryç”¨äºä¸MySQLæ•°æ®åº“äº¤äº’ï¼Œç”¨äºå­˜å‚¨æˆ–è·å–é•œåƒçš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼›æä¾›é•œåƒå…ƒæ•°æ®ç›¸å…³çš„RESTæ¥å£ï¼Œé€šè¿‡glance-registryï¼Œå¯ä»¥å‘æ•°æ®åº“ä¸­å†™å…¥æˆ–è·å–é•œåƒçš„å„ç§æ•°æ®ï¼Œglance-registryç›‘å¬ç«¯å£9191ã€‚Glanceçš„æ•°æ®åº“ä¸­æœ‰ä¸¤å¼ è¡¨ï¼Œä¸€å¼ æ˜¯imageè¡¨ï¼Œå¦ä¸€å¼ æ˜¯image propertyè¡¨ã€‚Imageè¡¨ä¿å­˜äº†é•œåƒæ ¼å¼ã€å¤§å°ç­‰ä¿¡æ¯ï¼›image propertyè¡¨åˆ™ä¸»è¦ä¿å­˜é•œåƒçš„å®šåˆ¶åŒ–ä¿¡æ¯ã€‚</li><li>database ç”¨æˆ·å­˜æ”¾é•œåƒçš„å…ƒæ•°æ®ã€‚</li><li>image storeæ˜¯ä¸€ä¸ªå­˜å‚¨çš„æ¥å£å±‚ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œglanceå¯ä»¥è·å–é•œåƒï¼Œimage storeæ”¯æŒçš„å­˜å‚¨æœ‰Amazonçš„S3ã€OpenStackæœ¬èº«çš„Swiftï¼Œè¿˜æœ‰è¯¸å¦‚cephï¼Œsheepdogï¼ŒGlusterFSç­‰åˆ†å¸ƒå¼å­˜å‚¨ã€‚ Image storeæ˜¯é•œåƒä¿å­˜ä¸è·å–çš„æ¥å£ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªæ¥å£å±‚ï¼Œå…·ä½“çš„å®ç°éœ€è¦å¤–éƒ¨çš„å­˜å‚¨æ”¯æŒï¼Œ</li></ul><h3 id="glanceéƒ¨ç½²" tabindex="-1">Glanceéƒ¨ç½² <a aria-current="page" href="#glanceéƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li><p>å®‰è£…Glance</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>é…ç½®Glance</p></li></ol><p>Glanceçš„é…ç½®æ˜¯é€šè¿‡ä¿®æ”¹ä¸¤ä¸ªç»„ä»¶çš„é…ç½®æ–‡ä»¶æ¥å®Œæˆã€‚Glanceä½¿ç”¨äº†MySQLå’ŒKeystoneã€‚</p><ul><li>Glanceæ•°æ®åº“é…ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/glance/glance-api.conf </span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection= mysql+pymysql://glance:glance@192.168.56.11/glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>è®¾ç½®Keystone</li></ul><p>å°±åƒåœ¨Keystoneç« èŠ‚æåˆ°äº†ã€‚OpenStackå…¶å®ƒç»„ä»¶éƒ½éœ€è¦å’ŒKeystoneè¿›è¡Œäº¤äº’ï¼Œæ¥è¿›è¡Œç”¨æˆ·è®¤è¯å’ŒæœåŠ¡ç›®å½•çš„ç®¡ç†ã€‚å¯¹äºGlanceæ¥è¯´ï¼ŒKeystoneçš„é…ç½®åœ¨glance-api.confå’Œglance-registry.conféƒ½éœ€è¦è®¾ç½®ï¼Œè€Œä¸”é…ç½®ç›¸åŒã€‚ glance-api.confé…ç½®</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/glance/glance-api.conf</span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri  = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = glance</span></span>
<span class="line"><span style="color:#a6accd">password = glance</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[paste_deploy]</span></span>
<span class="line"><span style="color:#a6accd">flavor=keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>è®¾ç½®Glanceé•œåƒå­˜å‚¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/glance/glance-api.conf</span></span>
<span class="line"><span style="color:#a6accd">#é»˜è®¤çš„å­˜å‚¨æ–¹å¼æ˜¯æ–‡ä»¶ï¼Œå¯ä»¥æŒ‡å®šé•œåƒå­˜å‚¨çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#a6accd">[glance_store]</span></span>
<span class="line"><span style="color:#a6accd">stores = file,http</span></span>
<span class="line"><span style="color:#a6accd">default_store=file</span></span>
<span class="line"><span style="color:#a6accd">filesystem_store_datadir=/var/lib/glance/images/</span></span>
<span class="line"><span style="color:#a6accd">#ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åé¢ä¸Šä¼ çš„é•œåƒéƒ½ä¿å­˜åœ¨/var/lib/glance/imagesç›®å½•ä¸‹ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul><ol><li><p>åŒæ­¥æ•°æ®åº“</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "glance-manage db_sync" glance</span></span>
<span class="line"><span style="color:#a6accd">æµ‹è¯•æ•°æ®åº“åŒæ­¥æƒ…å†µ</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -uglance -pglance -e "use glance;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>å¯åŠ¨GlanceæœåŠ¡</p></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable openstack-glance-api.service </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start openstack-glance-api.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>GlanceæœåŠ¡æ³¨å†Œ</p><p>æƒ³è¦è®©åˆ«çš„æœåŠ¡å¯ä»¥ä½¿ç”¨Glanceï¼Œå°±éœ€è¦åœ¨Keystoneä¸Šå®ŒæˆæœåŠ¡çš„æ³¨å†Œã€‚æ³¨æ„éœ€è¦å…ˆsourceä¸€ä¸‹adminçš„ç¯å¢ƒå˜é‡ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd"># openstack service create --name glance --description "OpenStack Image" image</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne image public http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne image internal http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne image admin http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ol><h3 id="éªŒè¯glanceå®‰è£…" tabindex="-1">éªŒè¯Glanceå®‰è£… <a aria-current="page" href="#éªŒè¯glanceå®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li><p>æµ‹è¯•GlanceçŠ¶æ€</p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨glanceå‘½ä»¤åˆ—å‡ºç°åœ¨çš„æ‰€æœ‰é•œåƒï¼Œå¦‚æœå‡ºç°ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œè¯´æ˜Glanceå¯åŠ¨å¹¶é…ç½®å®Œæˆã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /root/admin-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack image list</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœæœªå‡ºç°æŠ¥é”™ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®éƒ¨ç½²æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ä¸Šä¼ é•œåƒè¿›è¡Œæµ‹è¯•ã€‚</p></li><li><p>Glanceé•œåƒä¸Šä¼ æµ‹è¯•</p></li></ol><p>åœ¨åˆšå¼€å§‹å®æ–½OpenStackå¹³å°é˜¶æ®µï¼Œå¦‚æœæ²¡æœ‰åˆ¶ä½œé•œåƒã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®éªŒçš„é•œåƒè¿›è¡Œæµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªå°çš„Linuxç³»ç»Ÿã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#ä¸Šä¼ å¹¶æ³¨å†Œä¸€ä¸ªé•œåƒã€‚æ³¨æ„ä»¥ååªè¦çœ‹åˆ°ä½¿ç”¨openstackå‘½ä»¤ï¼Œéƒ½éœ€è¦ä¿è¯ï¼Œå·²ç»ä½¿ç”¨sourceå‘½ä»¤å¯¼å…¥äº†ç¯å¢ƒå˜é‡ã€‚å› ä¸ºè¿™äº›æ“ä½œéƒ½éœ€è¦ç¯å¢ƒå˜é‡é‡Œé¢çš„è´¦å·è¿›è¡Œè®¤è¯æˆæƒã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# openstack image create "cirros" --disk-format qcow2 \</span></span>
<span class="line"><span style="color:#a6accd">--container-format bare --file cirros-0.4.0-x86_64-disk.img --public</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="ä¸Šä¼ å®Œæ¯•åå¯ä»¥é€šè¿‡openstack-image-listå†æ¬¡æŸ¥çœ‹ä¸Šä¼ çš„é•œåƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œglanceä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥ä¿å­˜ä¸Šä¼ çš„é•œåƒã€‚é»˜è®¤å­˜æ”¾åœ¨-var-lib-glance-images-ç›®å½•ä¸‹ï¼Œä¼šå°†é•œåƒä»¥image-idæ¥è¿›è¡Œå‘½åã€‚" tabindex="-1">ä¸Šä¼ å®Œæ¯•åå¯ä»¥é€šè¿‡openstack image listå†æ¬¡æŸ¥çœ‹ä¸Šä¼ çš„é•œåƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒGlanceä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥ä¿å­˜ä¸Šä¼ çš„é•œåƒã€‚é»˜è®¤å­˜æ”¾åœ¨/var/lib/glance/images/ç›®å½•ä¸‹ï¼Œä¼šå°†é•œåƒä»¥image idæ¥è¿›è¡Œå‘½åã€‚ <a aria-current="page" href="#ä¸Šä¼ å®Œæ¯•åå¯ä»¥é€šè¿‡openstack-image-listå†æ¬¡æŸ¥çœ‹ä¸Šä¼ çš„é•œåƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œglanceä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥ä¿å­˜ä¸Šä¼ çš„é•œåƒã€‚é»˜è®¤å­˜æ”¾åœ¨-var-lib-glance-images-ç›®å½•ä¸‹ï¼Œä¼šå°†é•œåƒä»¥image-idæ¥è¿›è¡Œå‘½åã€‚" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 src]# openstack image list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name   | Status |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| cf154a84-a73a-451b-bcb3-83c98e7c0d3e | cirros | active |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="åŒæ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°é…ç½®æ–‡ä»¶è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œå¹¶ä»¥idå‘½åã€‚" tabindex="-1">åŒæ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°é…ç½®æ–‡ä»¶è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œå¹¶ä»¥IDå‘½åã€‚ <a aria-current="page" href="#åŒæ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°é…ç½®æ–‡ä»¶è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œå¹¶ä»¥idå‘½åã€‚" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ls -l /var/lib/glance/images/</span></span>
<span class="line"><span style="color:#a6accd">total 12980</span></span>
<span class="line"><span style="color:#a6accd">-rw-r----- 1 glance glance 13287936 Dec  1 14:11 65f9826a-5ccb-47d9-8a1a-75e31fb88a4a</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Glanceåœ¨OpenStackç»„ä»¶ä¸­ï¼Œå±äºæ¯”è¾ƒç®€å•çš„ä¸€ä¸ªã€‚æˆ‘å»ºè®®è¯»è€…å¦‚æœä¸€ç›´è·Ÿç€åšå®éªŒçš„è¯ï¼Œç°åœ¨æ˜¯æ—¶å€™åœä¸‹æ¥æ€»ç»“ä¸€ä¸‹äº†ã€‚å› ä¸ºåé¢çš„æœåŠ¡çš„éƒ¨ç½²æµç¨‹å’Œglanceéƒ½å¤§åŒå°å¼‚ã€‚</p><h1 id="_3-5-placementæœåŠ¡å®‰è£…" tabindex="-1">3.5 PlacementæœåŠ¡å®‰è£… <a aria-current="page" href="#_3-5-placementæœåŠ¡å®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="_3-5-1-placementæ¦‚è¿°" tabindex="-1">3.5.1 Placementæ¦‚è¿° <a aria-current="page" href="#_3-5-1-placementæ¦‚è¿°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><h3 id="_3-5-2-placementéƒ¨ç½²" tabindex="-1">3.5.2 Placementéƒ¨ç½² <a aria-current="page" href="#_3-5-2-placementéƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>PlacementæœåŠ¡æ³¨å†Œ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># openstack service create --name placement   --description "Placement API" placement</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne   placement public http://192.168.56.11:8778</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne   placement internal http://192.168.56.11:8778</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne   placement admin http://192.168.56.11:8778</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>å®‰è£…Placement</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-placement-api</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li><li><p>é…ç½®Palacement</p></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/placement/placement.conf</span></span>
<span class="line"><span style="color:#a6accd">[placement_database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://placement:placement@192.168.56.11/placement</span></span>
<span class="line"><span style="color:#a6accd">[api]</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy = keystone</span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = placement</span></span>
<span class="line"><span style="color:#a6accd">password = placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/httpd/conf.d/00-placement-api.conf </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#å¢åŠ ä¸‹é¢é…ç½®</span></span>
<span class="line"><span style="color:#a6accd">&lt;Directory /usr/bin&gt;</span></span>
<span class="line"><span style="color:#a6accd">Require all granted</span></span>
<span class="line"><span style="color:#a6accd">&lt;/Directory&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">å¢åŠ åå¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Listen 8778</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">&lt;VirtualHost *:8778&gt;</span></span>
<span class="line"><span style="color:#a6accd">  &lt;Directory /usr/bin&gt;</span></span>
<span class="line"><span style="color:#a6accd">Require all granted</span></span>
<span class="line"><span style="color:#a6accd">&lt;/Directory&gt;</span></span>
<span class="line"><span style="color:#a6accd">  WSGIProcessGroup placement-api</span></span>
<span class="line"><span style="color:#a6accd">  WSGIApplicationGroup %{GLOBAL}</span></span>
<span class="line"><span style="color:#a6accd">  WSGIPassAuthorization On</span></span>
<span class="line"><span style="color:#a6accd">  WSGIDaemonProcess placement-api processes=3 threads=1 user=placement group=placement</span></span>
<span class="line"><span style="color:#a6accd">  WSGIScriptAlias / /usr/bin/placement-api</span></span>
<span class="line"><span style="color:#a6accd">  &lt;IfVersion &gt;= 2.4&gt;</span></span>
<span class="line"><span style="color:#a6accd">    ErrorLogFormat "%M"</span></span>
<span class="line"><span style="color:#a6accd">  &lt;/IfVersion&gt;</span></span>
<span class="line"><span style="color:#a6accd">  ErrorLog /var/log/placement/placement-api.log</span></span>
<span class="line"><span style="color:#a6accd">  #SSLEngine On</span></span>
<span class="line"><span style="color:#a6accd">  #SSLCertificateFile ...</span></span>
<span class="line"><span style="color:#a6accd">  #SSLCertificateKeyFile ...</span></span>
<span class="line"><span style="color:#a6accd">&lt;/VirtualHost&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Alias /placement-api /usr/bin/placement-api</span></span>
<span class="line"><span style="color:#a6accd">&lt;Location /placement-api&gt;</span></span>
<span class="line"><span style="color:#a6accd">  SetHandler wsgi-script</span></span>
<span class="line"><span style="color:#a6accd">  Options +ExecCGI</span></span>
<span class="line"><span style="color:#a6accd">  WSGIProcessGroup placement-api</span></span>
<span class="line"><span style="color:#a6accd">  WSGIApplicationGroup %{GLOBAL}</span></span>
<span class="line"><span style="color:#a6accd">  WSGIPassAuthorization On</span></span>
<span class="line"><span style="color:#a6accd">&lt;/Location&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åŒæ­¥æ•°æ®åº“</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "placement-manage db sync" placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é‡å¯httpd</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart httpd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-6-openstackè®¡ç®—æœåŠ¡nova" tabindex="-1">1.6 OpenStackè®¡ç®—æœåŠ¡Nova <a aria-current="page" href="#_1-6-openstackè®¡ç®—æœåŠ¡nova" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>Novaæ˜¯OpenStackæœ€æ—©çš„ä¸¤ä¸ªæ¨¡å—ä¹‹ä¸€ï¼ˆå¦ä¸€ä¸ªæ˜¯å¯¹è±¡å­˜å‚¨ï¼‰ã€‚åœ¨OpenStackä½“ç³»ä¸­æ˜¯è®¡ç®—èµ„æºè™šæ‹ŸåŒ–çš„é¡¹ç›®ã€‚åŒæ—¶Novaä¹Ÿæ˜¯OpenStacké¡¹ç›®ä¸­ç»„ä»¶æœ€å¤šçš„ä¸€ä¸ªé¡¹ç›®ã€‚åœ¨ä¸­å°å‹éƒ¨ç½²ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸æŠŠé™¤nova-computeä¹‹å¤–çš„å…¶å®ƒç»„ä»¶éƒ¨ç½²åˆ°ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç§°ä¹‹ä¸ºæ§åˆ¶èŠ‚ç‚¹ã€‚å°†nova-computeéƒ¨ç½²åˆ°å•ç‹¬çš„ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç§°ä¹‹ä¸ºè®¡ç®—èŠ‚ç‚¹ã€‚</p><h3 id="novaæœåŠ¡ç»„ä»¶" tabindex="-1">NovaæœåŠ¡ç»„ä»¶ <a aria-current="page" href="#novaæœåŠ¡ç»„ä»¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ul><li><p>Nova-ApiæœåŠ¡</p><p>ä¸»è¦ç”¨äºæ¥æ”¶å’Œå“åº”å¤–éƒ¨è¯·æ±‚ï¼Œå®ƒæ”¯æŒOpenStack APIã€Amazon EC2 ç­‰API</p><ul><li>nova-apiç»„ä»¶å®ç°äº†RESTful APIåŠŸèƒ½ï¼Œæ˜¯å¤–éƒ¨è®¿é—®Novaçš„å”¯ä¸€é€”å¾„ã€‚</li><li>æ¥æ”¶å¤–éƒ¨çš„è¯·æ±‚å¹¶é€šè¿‡Message Queueå°†è¯·æ±‚å‘é€ç»™å…¶ä»–çš„æœåŠ¡ç»„ä»¶ï¼ŒåŒæ—¶ä¹Ÿå…¼å®¹EC2 APIï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨EC2çš„ç®¡ç†å·¥å…·å¯¹novaè¿›è¡Œæ—¥å¸¸ç®¡ç†ã€‚</li></ul></li><li><p>Nova-CertæœåŠ¡</p><p>æ˜¯Novaçš„è¯ä¹¦ç®¡ç†æœåŠ¡ï¼Œç”¨æ¥ä¸ºEC2æœåŠ¡æä¾›èº«ä»½éªŒè¯ï¼Œä»…ä»…æ˜¯åœ¨EC2 APIçš„è¯·æ±‚ä¸­ä½¿ç”¨ã€‚</p></li><li><p>Nova-ScheduleræœåŠ¡</p><p>ç”¨äºNovaçš„è°ƒåº¦å·¥ä½œï¼Œåœ¨åˆ›å»ºè™šæ‹Ÿæœºæ—¶ï¼Œç”±å®ƒé€‰æ‹©å°†è™šæ‹Ÿæœºåˆ›å»ºåœ¨å“ªå°è®¡ç®—èŠ‚ç‚¹ä¸Šã€‚</p></li><li><p>Nova-ConductoræœåŠ¡</p><p>è¿™ä¸ªæ˜¯æœåŠ¡æ˜¯è®¡ç®—èŠ‚ç‚¹è®¿é—®æ•°æ®åº“æ—¶çš„ä¸€ä¸ªä¸­é—´å±‚ï¼Œå®ƒå‡ºç°çš„ä½œç”¨æ˜¯é˜²æ­¢è®¡ç®—èŠ‚ç‚¹çš„Nova-ComputeæœåŠ¡ç›´æ¥è®¿é—®æ•°æ®åº“ã€‚åŒæ—¶è¿™ä¸ªä¸­é—´å±‚å¯ä»¥è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚</p></li><li><p>Nova-ConsoleæœåŠ¡</p><p>Novaå¢å¼ºäº†å®ƒçš„æ§åˆ¶å°æœåŠ¡ã€‚æ§åˆ¶å°æœåŠ¡å…è®¸ç”¨æˆ·å¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®è™šæ‹ŸåŒ–å®ä¾‹ã€‚è¿™å°±æ¶‰åŠäº†ä¸€å¯¹æ–°çš„å®ˆæŠ¤è¿›ç¨‹ï¼ˆnova-consoleå’Œnova-consoleauth).</p></li><li><p>Nova-ConsoleauthæœåŠ¡</p><p>ä¸»è¦ç”¨äºæ§åˆ¶å°çš„ç”¨æˆ·è®¿é—®æˆæƒ</p></li><li><p>Nova-NovncproxyæœåŠ¡</p><p>ç”¨äºä¸ºç”¨æˆ·è®¿é—®è™šæ‹Ÿæœºæä¾›äº†ä¸€ä¸ªVNCçš„ä»£ç†ã€‚é€šè¿‡VNCåè®®ï¼Œå¯ä»¥æ”¯æŒåŸºäºæµè§ˆå™¨çš„novncå®¢æˆ·ç«¯ï¼Œåé¢ä½ åœ¨ç½‘é¡µæ‰“å¼€çš„consoleç•Œé¢å°±æ˜¯ä¾é è¿™ä¸ªæœåŠ¡æä¾›çš„ã€‚</p></li><li><p>Nova-Compute</p><p>Nova-computeæ˜¯Novaæœ€é‡è¦çš„ç»„ä»¶ä¹‹ä¸€ã€‚</p><ul><li>nova-compute ä¸€èˆ¬è¿è¡Œåœ¨è®¡ç®—èŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡Message Queueæ¥æ”¶å¹¶ç®¡ç†VMçš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li>Nova-compute é€šè¿‡Libvirtç®¡ç†KVMï¼Œé€šè¿‡XenAPIç®¡ç†Xenç­‰ã€‚</li></ul></li></ul><h3 id="novaæ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²" tabindex="-1">Novaæ§åˆ¶èŠ‚ç‚¹éƒ¨ç½² <a aria-current="page" href="#novaæ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆåœ¨æ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²é™¤nova-computeä¹‹å¤–çš„å…¶å®ƒå¿…å¤‡çš„æœåŠ¡ã€‚</p><ol><li>æ§åˆ¶èŠ‚ç‚¹å®‰è£…</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-nova-api \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-conductor \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-novncproxy openstack-nova-scheduler</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>nova.confæ˜¯é…ç½®Novaçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ŒNovaçš„é…ç½®ä¸»è¦å›´ç»•è¯¥é…ç½®æ–‡ä»¶ã€‚</p><ul><li>æ•°æ®åº“é…ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[api_database]</span></span>
<span class="line"><span style="color:#a6accd">connection= mysql+pymysql://nova:nova@192.168.56.11/nova_api</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection= mysql+pymysql://nova:nova@192.168.56.11/nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>RabbitMQé…ç½®</p><p>Novaå’Œå…¶å®ƒç»„ä»¶ä¹‹é—´ï¼Œä»¥åŠNovaå„ä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡éƒ½è¦é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œï¼Œæ‰€ä»¥éœ€è¦é…ç½®RabbmitMQçš„è¿æ¥ã€‚æ³¨æ„æ˜¯DEFAULTé…ç½®æ ç›®ä¸‹é¢ã€‚</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">transport_url = rabbit://openstack:openstack@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>Keystoneç›¸å…³é…ç½®</p><p>Novaéœ€è¦è¿æ¥åˆ°Keystoneè¿›è¡Œè®¤è¯å’ŒæœåŠ¡ç®¡ç†ã€‚</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[api]</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy=keystone</span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri = http://192.168.56.11:5000/</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000/</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = nova</span></span>
<span class="line"><span style="color:#a6accd">password = nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>å…³é—­Novaçš„é˜²ç«å¢™åŠŸèƒ½</p><p>å› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨Neutronçš„é˜²ç«å¢™åŠŸèƒ½ï¼Œæ‰€ä»¥å…³é—­Novaè‡ªå·±çš„é˜²ç«å¢™é©±åŠ¨ã€‚</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">use_neutron=true</span></span>
<span class="line"><span style="color:#a6accd">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>VNCé…ç½®</p><p>vncçš„é…ç½®ç”¨äºè™šæ‹ŸæœºVNCç«¯å£çš„ç›‘å¬å’Œnovncproxyçš„é…ç½®ï¼Œè¿™æ ·åé¢æˆ‘ä»¬é€šè¿‡DashBoardçš„novncç•Œé¢å°±å¯ä»¥æŸ¥çœ‹è™šæ‹Ÿæœºçš„ç•Œé¢ã€‚</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[vnc]</span></span>
<span class="line"><span style="color:#a6accd">enabled=true</span></span>
<span class="line"><span style="color:#a6accd">server_listen = 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">server_proxyclient_address = 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>è®¾ç½®glance</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[glance]</span></span>
<span class="line"><span style="color:#a6accd">api_servers = http://192.168.56.11:9292</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„ï¼š</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[oslo_concurrency]</span></span>
<span class="line"><span style="color:#a6accd">lock_path=/var/lib/nova/tmp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>è®¾ç½®å¯ç”¨çš„api</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">enabled_apis=osapi_compute,metadata</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>è®¾ç½®placement</li></ul><h1 id="æ–°å¢åˆ°é…ç½®æ–‡ä»¶æœ«å°¾" tabindex="-1">æ–°å¢åˆ°é…ç½®æ–‡ä»¶æœ«å°¾ <a aria-current="page" href="#æ–°å¢åˆ°é…ç½®æ–‡ä»¶æœ«å°¾" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[placement]</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = Default</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000/v3</span></span>
<span class="line"><span style="color:#a6accd">username = placement</span></span>
<span class="line"><span style="color:#a6accd">password = placement</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åŒæ­¥æ•°æ®åº“</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage api_db sync" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æ³¨å†Œcell0æ•°æ®åº“</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>åˆ›å»ºcell1çš„cell</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>åŒæ­¥novaæ•°æ®åº“</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage db sync" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>éªŒè¯cell0å’Œcell1çš„æ³¨å†Œæ˜¯å¦æ­£ç¡®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 list_cells" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æµ‹è¯•æ•°æ®åº“åŒæ­¥æƒ…å†µ</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -unova -pnova -e "use nova;show tables;"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mysql -h 192.168.56.11 -unova -pnova -e "use nova_api;show tables;"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨Nova Service<ul><li>è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</li></ul></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable openstack-nova-api.service \</span></span>
<span class="line"><span style="color:#a6accd">openstack-nova-scheduler.service \</span></span>
<span class="line"><span style="color:#a6accd">openstack-nova-conductor.service \</span></span>
<span class="line"><span style="color:#a6accd">openstack-nova-novncproxy.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹æœåŠ¡</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start openstack-nova-api.service \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-scheduler.service openstack-nova-conductor.service \</span></span>
<span class="line"><span style="color:#a6accd">  openstack-nova-novncproxy.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li><p>NovaæœåŠ¡æ³¨å†Œ</p><p>å’ŒKeystoneã€Glanceä¸€æ ·ï¼ŒNovaæœåŠ¡ä¹Ÿéœ€è¦åœ¨Keystoneä¸Šåšæ³¨å†Œï¼Œå¹¶å‘Šè¯‰Keystoneå®ƒæ‰€æš´æ¼çš„APIã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># source admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd"># openstack service create --name nova --description "OpenStack Compute" compute</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne compute public http://192.168.56.11:8774/v2.1</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne compute internal http://192.168.56.11:8774/v2.1</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne compute admin http://192.168.56.11:8774/v2.1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>éªŒè¯æ§åˆ¶èŠ‚ç‚¹æœåŠ¡</li></ul></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@openstack-node1 ~]# openstack compute service list</span></span>
<span class="line"><span style="color:#a6accd">+----+----------------+-----------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID | Binary         | Host                        | Zone     | Status  | State | Updated At                 |</span></span>
<span class="line"><span style="color:#a6accd">+----+----------------+-----------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">|  4 | nova-scheduler | linux-node1.example.com | internal | enabled | up    | 2020-02-04T04:48:47.000000 |</span></span>
<span class="line"><span style="color:#a6accd">| 11 | nova-conductor | linux-node1.example.com | internal | enabled | up    | 2020-02-04T04:48:47.000000 |</span></span>
<span class="line"><span style="color:#a6accd">+----+----------------+-----------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="novaè®¡ç®—èŠ‚ç‚¹éƒ¨ç½²" tabindex="-1">Novaè®¡ç®—èŠ‚ç‚¹éƒ¨ç½² <a aria-current="page" href="#novaè®¡ç®—èŠ‚ç‚¹éƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æ ¹æ®æˆ‘ä»¬å¼€å§‹å®éªŒè§„åˆ’ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæ§åˆ¶èŠ‚ç‚¹å’Œä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹ã€‚è®¡ç®—èŠ‚ç‚¹æ˜¯çœŸæ­£è¿è¡Œè™šæ‹Ÿæœºçš„æœåŠ¡å™¨ï¼Œå¯¹CPUã€å†…å­˜å’Œç¡¬ç›˜è¦æ±‚éƒ½æ¯”è¾ƒé«˜ï¼Œé€šå¸¸æ˜¯é…ç½®æ¯”è¾ƒå¼ºåŠ²çš„æœåŠ¡å™¨å……å½“ã€‚å½“ç„¶åœ¨å®éªŒçš„è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨å¯ä»¥å’Œæ§åˆ¶èŠ‚ç‚¹åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚å¥½çš„ï¼Œç°åœ¨è¯·ä½ æ‰“å¼€ç¬¬äºŒå°è™šæ‹Ÿæœºå¹¶ä¸”ç™»é™†ã€‚</p><ol><li>è®¡ç®—èŠ‚ç‚¹å®‰è£…</li></ol><p>è®¡ç®—èŠ‚ç‚¹éœ€è¦ä¾èµ–ä¸è™šæ‹ŸåŒ–æŠ€æœ¯æ¥è¿è¡Œè™šæ‹Ÿæœºå®ä¾‹ï¼Œè¿˜è®°å¾—å‰é¢æˆ‘ä»¬è®¨è®ºOpenStackä¸è™šæ‹ŸåŒ–ä¹‹é—´çš„å…³ç³»å—ï¼ŸOpenStacké»˜è®¤ä½¿ç”¨KVMä½œä¸ºHypervisorï¼Œæ‰€ä»¥åœ¨è®¡ç®—èŠ‚ç‚¹ä¸Šéœ€è¦å®‰è£…KVMå’Œlibvirtã€‚è¿™æ ·OpenStackçš„æ§åˆ¶èŠ‚ç‚¹ä¸Šçš„novaæœåŠ¡å°±å¯ä»¥è°ƒç”¨Nova-computeè¿›è¡Œè™šæ‹Ÿæœºçš„åˆ›å»ºå’Œç®¡ç†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# yum install -y openstack-nova-compute</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>å¤åˆ¶é…ç½®æ–‡ä»¶</p><p>è®¡ç®—èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶å’Œæ§åˆ¶èŠ‚ç‚¹çš„åŸºæœ¬ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶èŠ‚ç‚¹nova.confçš„åŸºç¡€ä¸Šè¿›è¡Œå¢åŠ å³å¯ï¼Œæ‰€ä»¥é¦–å…ˆè¯·å°†æ§åˆ¶èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ç›´æ¥å¤åˆ¶è¿‡æ¥å§ã€‚</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# scp /etc/nova/nova.conf 192.168.56.12:/etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# chown root:nova /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>åˆ é™¤å¤šä½™çš„æ•°æ®é…ç½®</p><p>åˆ é™¤æ•°æ®åº“é…ç½® ç›¸å¯¹äºæ§åˆ¶èŠ‚ç‚¹çš„é…ç½®ï¼Œè®¡ç®—èŠ‚ç‚¹éœ€è¦å˜æ›´VNCçš„é…ç½®ã€‚</p></li><li><p>ä¿®æ”¹VNCé…ç½®</p><p>è®¡ç®—èŠ‚ç‚¹éœ€è¦ç›‘å¬æ‰€æœ‰IPï¼ŒåŒæ—¶è®¾ç½®novncproxyçš„è®¿é—®åœ°å€</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[vnc]</span></span>
<span class="line"><span style="color:#a6accd">enabled=true</span></span>
<span class="line"><span style="color:#a6accd">server_listen = 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">server_proxyclient_address = 192.168.56.12</span></span>
<span class="line"><span style="color:#a6accd">novncproxy_base_url = http://192.168.56.11:6080/vnc_auto.html</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><p>è™šæ‹ŸåŒ–é€‚é…</p><p>æŸ¥çœ‹è®¡ç®—èŠ‚ç‚¹çš„æœåŠ¡å™¨æ˜¯å¦æ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–ã€‚</p></li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# egrep -c '(vmx|svm)' /proc/cpuinfo</span></span>
<span class="line"><span style="color:#a6accd">å¦‚æœè¿”å›çš„æ˜¯0ï¼Œè¡¨ç¤ºä¸æ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œéœ€è¦åœ¨nova.confé‡Œé¢è®¾ç½®</span></span>
<span class="line"><span style="color:#a6accd">[libvirt]</span></span>
<span class="line"><span style="color:#a6accd">virt_type=qemu</span></span>
<span class="line"><span style="color:#a6accd">å¦‚æœè¿”å›çš„æ˜¯é0çš„å€¼ï¼Œé‚£ä¹ˆè¡¨ç¤ºè®¡ç®—èŠ‚ç‚¹æœåŠ¡å™¨æ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œéœ€è¦åœ¨nova.confé‡Œé¢è®¾ç½®</span></span>
<span class="line"><span style="color:#a6accd">[libvirt]</span></span>
<span class="line"><span style="color:#a6accd">virt_type=kvm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨nova-compute</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># systemctl enable libvirtd.service openstack-nova-compute.service</span></span>
<span class="line"><span style="color:#a6accd"># systemctl start libvirtd.service openstack-nova-compute.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è®¡ç®—èŠ‚ç‚¹åŠ å…¥æ§åˆ¶èŠ‚ç‚¹</li></ol><p>å½“æ·»åŠ æ–°çš„è®¡ç®—èŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»åœ¨æ§åˆ¶å™¨èŠ‚ç‚¹ä¸Šè¿è¡Œnova-manage cell_v2 discover_hostsæ¥æ³¨å†Œè¿™äº›æ–°çš„è®¡ç®—èŠ‚ç‚¹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨/etc/nova/nova.confä¸­è®¾ç½®é€‚å½“çš„é—´éš”:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[scheduler]</span></span>
<span class="line"><span style="color:#a6accd">discover_hosts_in_cells_interval = 300</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>éªŒè¯è®¡ç®—èŠ‚ç‚¹</li></ol><p>åœ¨æ§åˆ¶èŠ‚ç‚¹å†æ¬¡æ‰§è¡Œhost listï¼Œå¯ä»¥å‘ç°nova-computeå·²ç»æˆåŠŸæ³¨å†Œã€‚ å†æ¬¡æ‰§è¡Œhost listå¯ä»¥çœ‹åˆ°ã€‚è®¡ç®—èŠ‚ç‚¹å·²ç»æ³¨å†ŒæˆåŠŸã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack host list</span></span>
<span class="line"><span style="color:#a6accd">+------------------------+-------------+----------+</span></span>
<span class="line"><span style="color:#a6accd">| Host Name              | Service     | Zone     |</span></span>
<span class="line"><span style="color:#a6accd">+------------------------+-------------+----------+</span></span>
<span class="line"><span style="color:#a6accd">| linux-node1.example.com | conductor   | internal |</span></span>
<span class="line"><span style="color:#a6accd">| linux-node1.example.com | consoleauth | internal |</span></span>
<span class="line"><span style="color:#a6accd">| linux-node1.example.com | scheduler   | internal |</span></span>
<span class="line"><span style="color:#a6accd">| linux-node2.example.com | compute     | nova     |</span></span>
<span class="line"><span style="color:#a6accd">+------------------------+-------------+----------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="éªŒè¯novaå®‰è£…" tabindex="-1">éªŒè¯Novaå®‰è£… <a aria-current="page" href="#éªŒè¯novaå®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack compute service list</span></span>
<span class="line"><span style="color:#a6accd">+----+------------------+-------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID | Binary           | Host                    | Zone     | Status  | State | Updated At                 |</span></span>
<span class="line"><span style="color:#a6accd">+----+------------------+-------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd">|  1 | nova-consoleauth | linux-node1.example.com | internal | enabled | up    | 2018-02-03T10:38:30.000000 |</span></span>
<span class="line"><span style="color:#a6accd">|  2 | nova-conductor   | linux-node1.example.com | internal | enabled | up    | 2018-02-03T10:38:30.000000 |</span></span>
<span class="line"><span style="color:#a6accd">|  3 | nova-scheduler   | linux-node1.example.com | internal | enabled | up    | 2018-02-03T10:38:30.000000 |</span></span>
<span class="line"><span style="color:#a6accd">|  6 | nova-compute     | linux-node2.example.com | nova     | enabled | up    | None                       |</span></span>
<span class="line"><span style="color:#a6accd">+----+------------------+-------------------------+----------+---------+-------+----------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>éªŒè¯æ‰€æœ‰çš„Endpoint APIæ˜¯å¦æ­£ç¡®</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack catalog list</span></span>
<span class="line"><span style="color:#a6accd">+-----------+-----------+--------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Name      | Type      | Endpoints                                  |</span></span>
<span class="line"><span style="color:#a6accd">+-----------+-----------+--------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| placement | placement | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:8778        |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   internal: http://192.168.56.11:8778      |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:8778         |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">| keystone  | identity  | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:5000/v3/    |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:35357/v3/    |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   internal: http://192.168.56.11:35357/v3/ |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">| glance    | image     | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:9292        |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:9292         |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">| nova      | compute   | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   admin: http://192.168.56.11:8774/v2.1    |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   public: http://192.168.56.11:8774/v2.1   |</span></span>
<span class="line"><span style="color:#a6accd">|           |           | RegionOne                                  |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |   internal: http://192.168.56.11:8774/v2.1 |</span></span>
<span class="line"><span style="color:#a6accd">|           |           |                                            |</span></span>
<span class="line"><span style="color:#a6accd">+-----------+-----------+--------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ£€æŸ¥cellså’Œplacement APIçŠ¶æ€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# nova-status upgrade check</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Upgrade Check Results     |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Check: Cells v2           |</span></span>
<span class="line"><span style="color:#a6accd">| Result: Success           |</span></span>
<span class="line"><span style="color:#a6accd">| Details: None             |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Check: Placement API      |</span></span>
<span class="line"><span style="color:#a6accd">| Result: Success           |</span></span>
<span class="line"><span style="color:#a6accd">| Details: None             |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Check: Resource Providers |</span></span>
<span class="line"><span style="color:#a6accd">| Result: Success           |</span></span>
<span class="line"><span style="color:#a6accd">| Details: None             |</span></span>
<span class="line"><span style="color:#a6accd">+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-7-openstackç½‘ç»œæœåŠ¡neutron" tabindex="-1">1.7 OpenStackç½‘ç»œæœåŠ¡Neutron <a aria-current="page" href="#_1-7-openstackç½‘ç»œæœåŠ¡neutron" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>ä¸Šä¸€ç« æˆ‘ä»¬è®²åˆ°NovaæœåŠ¡æä¾›äº†OpenStackå¹³å°è®¡ç®—èµ„æºæ± ï¼Œå®ç°äº†è®¡ç®—å³æœåŠ¡ã€‚é‚£ä¹ˆä»…ä»…æœ‰ä¸€å°å­¤ç«‹çš„äº‘ä¸»æœºæ˜¯æ— æ³•æ­£å¸¸ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæ¥å…¥ç½‘ç»œï¼Œæ‰èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h3 id="neutronæ¦‚è¿°" tabindex="-1">Neutronæ¦‚è¿° <a aria-current="page" href="#neutronæ¦‚è¿°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>OpenStack Networking Servicesï¼ˆNeutronï¼‰ï¼ŒOpenStack ç½‘ç»œæœåŠ¡ï¼ŒOpenStackæ ¸å¿ƒé¡¹ç›®ä¹‹ä¸€ï¼Œç”±æ—©æœŸçš„nova-networkç‹¬ç«‹æˆä¸€ä¸ªå­é¡¹ç›®åæ¼”å˜è€Œæ¥ï¼Œå®ƒä¸ºOpenStackæä¾›äº†äº‘è®¡ç®—ç¯å¢ƒä¸‹çš„è™šæ‹Ÿç½‘ç»œåŠŸèƒ½ã€‚</p><p>åœ¨OpenStackä¸–ç•Œä¸­ï¼Œç½‘ç»œç»„ä»¶æœ€åˆå«nova-networkï¼Œnova-networkå®ç°ç®€å•ï¼Œç›´æ¥é‡‡ç”¨åŸºäºLinuxå†…æ ¸çš„Linuxç½‘æ¡¥ã€‚ç”±äºå°‘äº†å¾ˆå¤šå±‚æŠ½è±¡ï¼Œæ‰€ä»¥æ¯”è¾ƒç®€å•ç¨³å®šç®—ã€‚ä½†æ˜¯å®ƒçš„ä¸è¶³ä¹‹å¤„æ˜¯æ”¯æŒçš„æ’ä»¶å°‘ï¼ˆåªæ”¯æŒLinuxç½‘æ¡¥ï¼‰ï¼Œæ”¯æŒçš„ç½‘ç»œæ‹“æ‰‘å°‘ï¼ˆåªæ”¯æŒflat, vlan)ã€‚</p><p>ä¸ºäº†æ”¯æŒæ›´å¤šçš„æ’ä»¶ï¼Œæ”¯æŒæ›´å¤šçš„ç½‘ç»œæ‹“æ‰‘ï¼Œäºæ˜¯æœ‰äº†quantumå·¥ç¨‹ã€‚quantumæ’ä»¶ä¸ä»…æ”¯æŒLinuxç½‘æ¡¥ï¼Œä¹Ÿæ”¯æŒOpenvSwitchï¼Œä»¥åŠä¸€äº›SDNçš„æ’ä»¶å’Œå…¶ä»–å•†ä¸šå…¬å¸çš„æ’ä»¶ã€‚åœ¨ç½‘ç»œæ‹“æ‰‘ä¸Šï¼Œé™¤äº†æ”¯æŒflatï¼Œvlanå¤–ï¼Œè¿˜æ”¯æŒgre, vxlanã€‚quantumå› ä¸ºå’Œä¸€å®¶å…¬å¸çš„åç§°å†²çªï¼Œäºæ˜¯ï¼Œæ”¹åä¸ºneutronã€‚</p><ol><li>Neutron Server</li></ol><p>è¿™ä¸€éƒ¨åˆ†åŒ…å«å®ˆæŠ¤è¿›ç¨‹neutron-serverå’Œå„ç§æ’ä»¶neutron-*-pluginã€‚neutron-serveræä¾›APIæ¥å£ï¼Œå¹¶æŠŠå¯¹APIçš„è°ƒç”¨è¯·æ±‚ä¼ ç»™å·²ç»é…ç½®å¥½çš„æ’ä»¶è¿›è¡Œåç»­å¤„ç†ã€‚æ’ä»¶éœ€è¦è®¿é—®æ•°æ®åº“æ¥ç»´æŠ¤å„ç§é…ç½®æ•°æ®å’Œå¯¹åº”å…³ç³»ï¼Œä¾‹å¦‚è·¯ç”±å™¨ã€ç½‘ç»œã€å­ç½‘ã€ç«¯å£ã€æµ®åŠ¨IPã€å®‰å…¨ç»„ç­‰ç­‰ã€‚</p><ol><li>ML2(Module Layer2)plugin</li></ol><p>ä¸Šè¿°æ•´ä½“æ¡†æ¶ä¸­æåˆ°Neutronç»„ä»¶å†…éƒ¨æœ‰å¾ˆå¤šä¸ªä¸åŒçš„æ’ä»¶ï¼ˆpluginï¼‰ï¼Œè€Œåœ¨Neutronä¸­ï¼Œå®ç°ä¸€ä¸ªæ’ä»¶åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†çš„å†…å®¹ï¼šä¸€éƒ¨åˆ†ä¸æ•°æ®åº“dbæ‰“äº¤é“ç§°ä¹‹ä¸ºpluginï¼ˆè™½ç„¶éƒ½æ˜¯pluginï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯å…·ä½“å®ç°ä¸­çš„pluginï¼‰ï¼Œä¸€éƒ¨åˆ†æ˜¯è°ƒç”¨å…·ä½“çš„ç½‘ç»œè®¾å¤‡çœŸæ­£å¹²æ´»çš„ç§°ä¹‹ä¸ºagentã€‚ ä¸dbè¿›è¡Œäº¤äº’çš„pluginåœ¨åŠŸèƒ½ä¸Šæœ‰å¾ˆå¤šé‡å¤ï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸Šæœ‰å¾ˆå¤šé‡å¤ï¼Œå› æ­¤åœ¨Neutronä¸­æä¾›äº†ä¸€ä¸ªå…¬å…±çš„pluginå«ML2(ModuleLayer2) pluginã€‚æ‰€ä»¥ML2 pluginçš„ç¬¬ä¸€ä¸ªä½œç”¨å°±æ˜¯ï¼šæä¾›ä¸æ•°æ®åº“äº¤äº’çš„å…¬å…±pluginã€‚ ML2çš„ç¬¬äºŒä¸ªä½œç”¨å°±æ˜¯å®ç°æ”¯æŒå¤šç§pulginï¼ˆåŸå…ˆä½¿ç”¨linux bridgeï¼Œå°±ä¸èƒ½ç”¨openvswitchï¼‰ï¼ŒML2é€šè¿‡MechanismDriverå®ç°ã€‚MechanismDriverçš„ä½œç”¨æ˜¯å°†agentçš„ç±»å‹agent_typeå’Œvif_typeå…³è”ï¼Œè¿™æ ·vif_typeå°±å¯ä»¥ç›´æ¥é€šè¿‡æ‰©å±•apiè®¾ç½®äº†ã€‚ ML2çš„ç¬¬ä¸‰ä¸ªä½œç”¨å°±æ˜¯æ”¯æŒä¸åŒçš„ç½‘ç»œæ‹“æ‰‘ï¼Œå¦‚flat, vlan, gre, vxlanï¼Œç›´æ¥åœ¨ml2_conf.iniè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œéƒ½é…ä¸Šå³å¯ã€‚</p><ol><li><p>L3-Agent</p><p>ä¸Šé¢çš„ml2è§£å†³çš„åªæ˜¯ç½‘ç»œä¸­L2å±‚çš„é—®é¢˜ï¼Œå¯¹äºL3å±‚çš„è·¯ç”±åŠŸèƒ½ï¼Œneturonå•ç‹¬ç”¨l3-agentå®ç°ï¼Œä¸ºå®¢æˆ·æœºè®¿é—®å¤–éƒ¨ç½‘ç»œæä¾›3å±‚è½¬å‘æœåŠ¡ã€‚ L3 å±‚çš„è·¯ç”±åˆ†é™æ€è·¯ç”±å’ŒåŠ¨æ€è·¯ç”±ä¸¤ç§ï¼š åœ¨ Linux ä¸­ï¼Œé€šè¿‡æ‰“å¼€ ipv4 forward ç‰¹æ€§å¯ä»¥è®©æ•°æ®åŒ…ä»ä¸€å—ç½‘å¡è·¯ç”±åˆ°å¦å¤–ä¸€å—ç½‘å¡ä¸Šã€‚ åŠ¨æ€è·¯ç”±ï¼Œå¦‚å†…éƒ¨ç½‘å…³åè®® RIPï¼ŒOSPFï¼›å¦‚å¤–éƒ¨ç½‘å…³åè®® BGPã€‚èƒ½å¤Ÿè‡ªåŠ¨åœ°å­¦ä¹ å»ºç«‹è·¯ç”±è¡¨ã€‚</p></li></ol><p>ç›®å‰ Neutron åªæ”¯æŒé™æ€è·¯ç”±ï¼Œè¦ç‚¹å¦‚ä¸‹ï¼š å¯¹äºä¸åŒ tenant å­ç½‘é€šè¿‡ namespace åŠŸèƒ½è¿›è¡Œéš”ç¦»ï¼Œåœ¨ Linux ä¸­ï¼Œä¸€ä¸ªå‘½åç©ºé—´ namespace æ‚¨å¯ä»¥ç®€å•ç†è§£æˆ linux åˆå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„ TCP/IP æ ˆçš„è¿›ç¨‹ã€‚å¤šä¸ª tenant æ„å‘³ç€å¤šä¸ª namespaceï¼Œä¹Ÿæ„å‘³ç€å¤šä¸ª TCP/IP æ ˆã€‚ å¯¹äºåŒä¸€tenant ä¸­çš„ä¸åŒå­ç½‘çš„éš”ç¦»é€šè¿‡ iptables æ¥åšï¼Œä¹Ÿæ„å‘³ç€ï¼ŒåŒä¸€tenantä¸­çš„ç›¸åŒå­ç½‘çš„ä¸¤ä¸ªè™šæœºä¸ç”¨èµ° L3 å±‚ï¼Œç›´æ¥èµ° L2 å±‚èƒ½é€šï¼Œæ²¡é—®é¢˜ï¼›ä½†å¦‚æœåŒä¸€tenantä¸­çš„ä¸åŒå­ç½‘çš„ä¸¤ä¸ªè™šæœºè¦é€šè®¯çš„è¯ï¼Œå¿…é¡»å¾—ç»•é“ L3-agent ç½‘ç»œèŠ‚ç‚¹ï¼Œè¿™æ˜¯å½±å“æ€§èƒ½çš„ã€‚</p><ol><li>dhcp-agent</li></ol><p>Dhcp-agentä¸»è¦è´Ÿè´£ä¸ºå„ä¸ªç§Ÿæˆ·ç½‘ç»œæä¾›DHCPæœåŠ¡ã€‚ L4-L7çš„Agent è‡³äºå†ä¹‹ä¸Šçš„L4-L7å±‚çš„FwaaS,VPNaaS, DNATaaS, DNSaaSçš„å†…å®¹ï¼Œåœ¨neutronåˆå‡ºæ¥ä¸€ä¸ªæ–°çš„æœåŠ¡æ¡†æ¶ç”¨äºå°†æ‰€æœ‰è¿™äº›é™¤L2å±‚ä»¥å¤–çš„ç½‘ç»œæœåŠ¡ç±»ä¼¼äºä¸Šè¿°ml2çš„æ€æƒ³åœ¨æ•°æ®åº“è¿™å—ä¸€ç½‘æ‰“å°½ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå•ä¸€æ‰å¹³çš„æä¾›è€…ç½‘ç»œFLATæ¥éƒ¨ç½²neutronã€‚ä¸ºè™šæ‹Ÿæœºæä¾›ç½‘ç»œèµ„æºã€‚</p><h3 id="neutronæ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²" tabindex="-1">Neutronæ§åˆ¶èŠ‚ç‚¹éƒ¨ç½² <a aria-current="page" href="#neutronæ§åˆ¶èŠ‚ç‚¹éƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>Neutronå®‰è£…</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y openstack-neutron openstack-neutron-ml2 \</span></span>
<span class="line"><span style="color:#a6accd">openstack-neutron-linuxbridge ebtables</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutroné…ç½®<ul><li>Neutronæ•°æ®åº“é…ç½®</li></ul></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[database]</span></span>
<span class="line"><span style="color:#a6accd">connection = mysql+pymysql://neutron:neutron@192.168.56.11:3306/neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Keystoneè¿æ¥é…ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd">#æ³¨æ„ï¼šè¯¥é…ç½®é»˜è®¤ä¸å­˜åœ¨ï¼Œéœ€è¦æ·»åŠ </span></span>
<span class="line"><span style="color:#a6accd">auth_strategy = keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>RabbitMQç›¸å…³è®¾ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">transport_url = rabbit://openstack:openstack@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">#è¯·æ³¨æ„æ˜¯åœ¨DEFAULTé…ç½®æ ç›®ä¸‹ï¼Œå› ä¸ºè¯¥é…ç½®æ–‡ä»¶æœ‰å¤šä¸ªtransport_urlçš„é…ç½®</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Neutronç½‘ç»œåŸºç¡€é…ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">#æ³¨æ„ï¼šè¯¥é…ç½®é»˜è®¤ä¸å­˜åœ¨ï¼Œéœ€è¦æ·»åŠ </span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">core_plugin = ml2</span></span>
<span class="line"><span style="color:#a6accd"># è¿™ä¸ªé…ç½®æ²¡æœ‰é”™ï¼Œå°±æ˜¯è®¾ç½®ä¸ºç©º</span></span>
<span class="line"><span style="color:#a6accd">service_plugins =</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>ç½‘ç»œæ‹“æ‰‘å˜åŒ–Novaé€šçŸ¥é…ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd"># è¿™ä¸¤è¡Œé…ç½®éœ€è¦æ–°å¢</span></span>
<span class="line"><span style="color:#a6accd">notify_nova_on_port_status_changes = True</span></span>
<span class="line"><span style="color:#a6accd">notify_nova_on_port_data_changes = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># åœ¨é…ç½®æ–‡ä»¶æœ€åå¢åŠ ä»¥ä¸‹é…ç½®æ®µ</span></span>
<span class="line"><span style="color:#a6accd">[nova]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = nova</span></span>
<span class="line"><span style="color:#a6accd">password = nova</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>åœ¨ [oslo_concurrency] éƒ¨åˆ†ï¼Œé…ç½®é”è·¯å¾„ï¼š</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[oslo_concurrency]</span></span>
<span class="line"><span style="color:#a6accd">lock_path = /var/lib/neutron/tmp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron ML2é…ç½®</li></ol><p>è¿˜æ˜¯åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦é…ç½®Neutron ML2ã€‚ML2ä½¿ç”¨Linuxæ¡¥æ¥æœºåˆ¶ä¸ºå®ä¾‹åˆ›å»ºLayer-2çš„è™šæ‹Ÿç½‘ç»œåŸºç¡€è®¾æ–½ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/plugins/ml2/ml2_conf.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#ä»¥ä¸‹æ‰€æœ‰é…ç½®ç›®å‰å‡éœ€è¦æ–°å¢ï¼Œé»˜è®¤é…ç½®æ–‡ä»¶å·²ç»ç§»é™¤ï¼Œæ³¨æ„åˆ é™¤æ³¨é‡Šã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[ml2]</span></span>
<span class="line"><span style="color:#a6accd">type_drivers = flat,vlan,gre,vxlan,geneve #æ”¯æŒå¤šé€‰ï¼Œæ‰€ä»¥æŠŠæ‰€æœ‰çš„é©±åŠ¨éƒ½é€‰æ‹©ä¸Šã€‚</span></span>
<span class="line"><span style="color:#a6accd">tenant_network_types = flat,vlan,gre,vxlan,geneve #æ”¯æŒå¤šé¡¹ï¼Œæ‰€ä»¥æŠŠæ‰€æœ‰çš„ç½‘ç»œç±»å‹éƒ½é€‰æ‹©ä¸Šã€‚</span></span>
<span class="line"><span style="color:#a6accd">mechanism_drivers = linuxbridge,openvswitch,l2population #é€‰æ‹©æ’ä»¶é©±åŠ¨ï¼Œæ”¯æŒå¤šé€‰ï¼Œå¼€æºçš„æœ‰linuxbridgeå’Œopenvswitch</span></span>
<span class="line"><span style="color:#a6accd">#å¯ç”¨ç«¯å£å®‰å…¨æ‰©å±•é©±åŠ¨</span></span>
<span class="line"><span style="color:#a6accd">extension_drivers = port_security,qos </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[ml2_type_flat]</span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®ç½‘ç»œæä¾›</span></span>
<span class="line"><span style="color:#a6accd">flat_networks = provider</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[securitygroup]</span></span>
<span class="line"><span style="color:#a6accd">#å¯ç”¨ipset</span></span>
<span class="line"><span style="color:#a6accd">enable_ipset = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron Linuxbridgeé…ç½®</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span>
<span class="line"><span style="color:#a6accd">#ä»¥ä¸‹æ‰€æœ‰é…ç½®ç›®å‰å‡éœ€è¦æ–°å¢ï¼Œé»˜è®¤é…ç½®æ–‡ä»¶å·²ç»ç§»é™¤ï¼Œæ³¨æ„åˆ é™¤æ³¨é‡Šã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[linux_bridge]</span></span>
<span class="line"><span style="color:#a6accd">#æ˜ å°„è™šæ‹Ÿç½‘ç»œæ¥å£å’Œå®é™…ç½‘ç»œæ¥å£çš„å¯¹åº”</span></span>
<span class="line"><span style="color:#a6accd">physical_interface_mappings = provider:eth0 </span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[vxlan]</span></span>
<span class="line"><span style="color:#a6accd">#ç¦æ­¢vxlanç½‘ç»œ</span></span>
<span class="line"><span style="color:#a6accd">enable_vxlan = False</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[securitygroup]</span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®ä½¿ç”¨Linux Bridgeæ¡¥æ¥çš„é˜²ç«å¢™é©±åŠ¨å’Œå®‰å…¨ç»„</span></span>
<span class="line"><span style="color:#a6accd">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span>
<span class="line"><span style="color:#a6accd">enable_security_group = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron DHCP-Agenté…ç½®</li></ol><p>Neutronä¸­çš„dhcp-agentç”¨æ¥ä¸ºäº‘ä¸»æœºåŠ¨æ€åˆ†é…IPåœ°å€ï¼ŒDHCP Agenté»˜è®¤æ˜¯é€šè¿‡è°ƒç”¨dnsmasqæ¥å®ç°DHCPçš„åˆ†é…å·¥ä½œã€‚é»˜è®¤æƒ…å†µä¸‹dhcp-agentå’Œåé¢è¦ä»‹ç»çš„Lbaas-agentéƒ½éœ€è¦ä¾èµ–namespace,æ‰€ä»¥å¼€å§‹ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆä»‹ç»ä¸‹linuxçš„namespacheã€‚</p><p><strong>ä»€ä¹ˆæ˜¯namespace</strong> Namespace(å‘½åç©ºé—´)ï¼Œç®€å•çš„è¯´å°±æ˜¯ä¸åŒçš„åå­—ç©ºé—´ï¼Œæ‰“ä¸ªç®€å•çš„æ¯”æ–¹ï¼Œè¿›ç¨‹åœ¨aç©ºé—´æ˜¯å«aè¿›ç¨‹ï¼Œåœ¨bç©ºé—´ä¹Ÿå°±å¯èƒ½å«bè¿›ç¨‹ã€‚ä¸ºä»€ä¹ˆè¦æœ‰å‘½åç©ºé—´å‘¢ï¼Ÿä¸»è¦æ˜¯æ»¡è¶³è™šæ‹ŸåŒ–çš„ä¸€äº›éœ€æ±‚ã€‚è¯•æƒ³ï¼Œå¦‚æœæœ‰ä¸€å°æœºå™¨ï¼Œä¸ç®¡å®ƒæ˜¯ä¸ªäººpcè¿˜æ˜¯æœåŠ¡å™¨ï¼Œæˆ–æ˜¯ ç½‘ç»œäº¤æ¢æœºï¼Œè·¯ç”±å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿå°±è¢«ä¸€ä¸ªç”¨æˆ·ä½¿ç”¨ã€‚ä½†æ˜¯å¦‚æœæŸä¸€å¤©ï¼Œå¦å¤–ä¸€ä¸ªç”¨æˆ·ä¹Ÿè¦ä½¿ç”¨åŒæ ·çš„æœºå™¨ï¼Œä¸€ç§æ–¹æ³•æ˜¯å†ä¹°ä¸€ä¸ªæœºå™¨ï¼Œè£…ä¸ŠåŒæ ·çš„ linuxç³»ç»Ÿï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨å®¹å™¨ï¼ˆcontainerï¼‰ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰å±äºè‡ªå·±çš„å®¹å™¨ï¼Œè€Œä¸”å®¹å™¨ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œè€Œnamespace å°±æ˜¯å®ç°å®¹å™¨çš„ä¸€ç§æ‰‹æ®µã€‚Namespaceå¯ä»¥å®ç°pidã€netã€ipcã€mntã€utsã€userç­‰namespaceå°†å®¹å™¨çš„è¿›ç¨‹ã€ç½‘ç»œã€æ¶ˆæ¯ã€æ–‡ä»¶ç³»ç»Ÿã€UTS("UNIX Time-sharing System")å’Œç”¨æˆ·ç©ºé—´éš”ç¦»å¼€ã€‚åœ¨Dockerä¸­ï¼Œæˆ‘ä»¬ä¼šè¯¦è§£è®²è§£namespaceã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/dhcp_agent.ini</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">interface_driver = linuxbridge</span></span>
<span class="line"><span style="color:#a6accd">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span></span>
<span class="line"><span style="color:#a6accd">enable_isolated_metadata = True</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutron metadataé…ç½®</li></ol><p>metadata agentä¸ºå®ä¾‹æä¾›è¯¸å¦‚å‡­è¯çš„é…ç½®ä¿¡æ¯ã€‚éœ€è¦è®¾ç½®Keystoneçš„é“¾æ¥å’Œnovaçš„è¿æ¥å‚æ•°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/metadata_agent.ini</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">nova_metadata_host = 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">#æ³¨æ„è¿™ä¸ªæ˜¯ä¸ºå…ƒæ•°æ®ä»£ç†è®¾ç½®çš„å¯†ç ï¼Œéœ€è¦å’Œnovaçš„é…ç½®ç›¸å¯¹åº”ã€‚</span></span>
<span class="line"><span style="color:#a6accd">metadata_proxy_shared_secret = unixhot.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Neutronç›¸å…³é…ç½®åœ¨nova.conf</li></ol><p>Neutronçš„é…ç½®ï¼Œéœ€è¦ä¿®æ”¹novaçš„é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºé»˜è®¤å¤§å¤šæ•°OpenStackå‘è¡Œç‰ˆé‡Œnova.confé‡Œé¢çš„ç½‘ç»œç›¸å…³çš„é…ç½®éƒ½æ˜¯æ¯”è¾ƒè€çš„ï¼Œä½¿ç”¨çš„æœ€æ—©çš„nova-networkçš„é…ç½®ã€‚æ‰€ä»¥éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/nova/nova.conf </span></span>
<span class="line"><span style="color:#a6accd">[neutron]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd">service_metadata_proxy = true</span></span>
<span class="line"><span style="color:#a6accd">metadata_proxy_shared_secret = unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">#æ³¨æ„è¿™é‡Œè®¾ç½®çš„å…±äº«ç§˜é’¥éœ€è¦å’Œä¹‹å‰çš„å¯¹åº”ä¸Šã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é…ç½®å®Œæ¯•åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªè½¯è¿æ¥ï¼Œå› ä¸ºé»˜è®¤æœåŠ¡ä¼šè¯»å–plugin.iniã€‚</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åŒæ­¥æ•°æ®åº“</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \</span></span>
<span class="line"><span style="color:#a6accd">--config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é‡å¯è®¡ç®—API æœåŠ¡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart openstack-nova-api.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨ç½‘ç»œæœåŠ¡å¹¶é…ç½®ä»–ä»¬å¼€æœºè‡ªå¯åŠ¨ã€‚</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># systemctl enable neutron-server.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-metadata-agent.service</span></span>
<span class="line"><span style="color:#a6accd"># systemctl start neutron-server.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span></span>
<span class="line"><span style="color:#a6accd">  neutron-metadata-agent.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>NeutronæœåŠ¡æ³¨å†Œ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">åˆ›å»ºservice</span></span>
<span class="line"><span style="color:#a6accd"># openstack service create --name neutron --description "OpenStack Networking" network</span></span>
<span class="line"><span style="color:#a6accd">åˆ›å»ºendpoint</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne network public http://192.168.56.11:9696</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne network internal http://192.168.56.11:9696</span></span>
<span class="line"><span style="color:#a6accd"># openstack endpoint create --region RegionOne network admin http://192.168.56.11:9696</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æµ‹è¯•Neutronå®‰è£…**</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node1 neutron]# openstack network agent list</span></span>
<span class="line"><span style="color:#a6accd">WARNING: Failed to import plugin orchestration.</span></span>
<span class="line"><span style="color:#a6accd">WARNING: Failed to import plugin data_processing.</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-------------------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Agent Type         | Host                                | Availability Zone | Alive | State | Binary                    |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-------------------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| c4a78188-a3ad-4cda-8c47-41f854aad375 | Linux bridge agent | openstack-compute-node1.dianjoy.com | None              | :-)   | UP    | neutron-linuxbridge-agent |</span></span>
<span class="line"><span style="color:#a6accd">| e2325b10-281b-447c-b46f-7875c0eda1fc | Metadata agent     | openstack-compute-node1.dianjoy.com | None              | :-)   | UP    | neutron-metadata-agent    |</span></span>
<span class="line"><span style="color:#a6accd">| fb73fabc-2825-42c4-ae24-ea50bb1d37b8 | DHCP agent         | openstack-compute-node1.dianjoy.com | nova              | :-)   | UP    | neutron-dhcp-agent        |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-------------------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœå¯ä»¥æ­£å¸¸è¾“å‡ºï¼ŒåŸºæœ¬ä¸ŠNeutronçš„å®‰è£…å°±æ²¡æœ‰é—®é¢˜ã€‚</p><h3 id="neutronè®¡ç®—èŠ‚ç‚¹éƒ¨ç½²" tabindex="-1">Neutronè®¡ç®—èŠ‚ç‚¹éƒ¨ç½² <a aria-current="page" href="#neutronè®¡ç®—èŠ‚ç‚¹éƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>å®‰è£…è½¯ä»¶åŒ…</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"> [root@linux-node2 ~]# yum install -y openstack-neutron openstack-neutron-linuxbridge ebtables</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é…ç½®è®¡ç®—èŠ‚ç‚¹Neutron<ul><li>Keystoneè¿æ¥é…ç½®</li></ul></li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">auth_strategy = keystone</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[keystone_authtoken]</span></span>
<span class="line"><span style="color:#a6accd">www_authenticate_uri = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">memcached_servers = 192.168.56.11:11211</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>RabbitMQç›¸å…³è®¾ç½®</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/neutron/neutron.conf</span></span>
<span class="line"><span style="color:#a6accd">[DEFAULT]</span></span>
<span class="line"><span style="color:#a6accd">transport_url = rabbit://openstack:openstack@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">#è¯·æ³¨æ„æ˜¯åœ¨DEFAULTé…ç½®æ ç›®ä¸‹ï¼Œå› ä¸ºè¯¥é…ç½®æ–‡ä»¶æœ‰å¤šä¸ªtransport_urlçš„é…ç½®</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>é”è·¯å¾„</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[oslo_concurrency]</span></span>
<span class="line"><span style="color:#a6accd">lock_path = /var/lib/neutron/tmp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é…ç½®LinuxBridgeé…ç½®</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# scp /etc/neutron/plugins/ml2/linuxbridge_agent.ini 192.168.56.12:/etc/neutron/plugins/ml2/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>è®¾ç½®è®¡ç®—èŠ‚ç‚¹çš„nova.conf</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/nova/nova.conf</span></span>
<span class="line"><span style="color:#a6accd">[neutron]</span></span>
<span class="line"><span style="color:#a6accd">auth_url = http://192.168.56.11:5000</span></span>
<span class="line"><span style="color:#a6accd">auth_type = password</span></span>
<span class="line"><span style="color:#a6accd">project_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">user_domain_name = default</span></span>
<span class="line"><span style="color:#a6accd">region_name = RegionOne</span></span>
<span class="line"><span style="color:#a6accd">project_name = service</span></span>
<span class="line"><span style="color:#a6accd">username = neutron</span></span>
<span class="line"><span style="color:#a6accd">password = neutron</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é‡å¯è®¡ç®—æœåŠ¡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl restart openstack-nova-compute.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨è®¡ç®—èŠ‚ç‚¹linuxbridge-agent</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl enable neutron-linuxbridge-agent.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl start neutron-linuxbridge-agent.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šæµ‹è¯•Neutronå®‰è£…</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source admin-openstack.sh </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network agent list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-----------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Agent Type         | Host                        | Availability Zone | Alive | State | Binary                    |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-----------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 11f1de57-836f-412f-b9b4-51dcdc9ae931 | Metadata agent     | linux-node1.example.com | None              | :-)   | UP    | neutron-metadata-agent    |</span></span>
<span class="line"><span style="color:#a6accd">| 197b84cd-7d6e-4ed2-9fa0-46499fe7cdb7 | Linux bridge agent | linux-node2.example.com | None              | :-)   | UP    | neutron-linuxbridge-agent |</span></span>
<span class="line"><span style="color:#a6accd">| 531afd6d-ee81-4b64-a0f4-ec5fd523eff8 | DHCP agent         | linux-node1.example.com | nova              | :-)   | UP    | neutron-dhcp-agent        |</span></span>
<span class="line"><span style="color:#a6accd">| dfc431ff-dede-4a54-8371-653c6e72ffd9 | Linux bridge agent | linux-node1.example.com | None              | :-)   | UP    | neutron-linuxbridge-agent |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------------------+-----------------------------+-------------------+-------+-------+---------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>çœ‹æ˜¯å¦æœ‰linux-node2.example.comçš„Linux bridge agent</p><h3 id="bugè§£å†³" tabindex="-1">Bugè§£å†³ <a aria-current="page" href="#bugè§£å†³" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent [req-68a7936c-2bbc-454e-bee4-6785cd3dce7b - - - - -] Error in agent loop. Devices info: {'current': set(['tap07dc4c9c-f3']), 'timestamps': {'tap07dc4c9c-f3': 7}, 'removed': set([]), 'added': set(['tap07dc4c9c-f3']), 'updated': set([])}: KeyError: 'gateway'</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent Traceback (most recent call last):</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 465, in daemon_loop</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     sync = self.process_network_devices(device_info)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/osprofiler/profiler.py", line 160, in wrapper</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     result = f(*args, **kwargs)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 214, in process_network_devices</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     resync_a = self.treat_devices_added_updated(devices_added_updated)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/osprofiler/profiler.py", line 160, in wrapper</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     result = f(*args, **kwargs)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 231, in treat_devices_added_updated</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     self._process_device_if_exists(device_details)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/agent/_common_agent.py", line 258, in _process_device_if_exists</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     device, device_details['device_owner'])</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 585, in plug_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     network_segment.mtu)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 521, in add_tap_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     return False</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/oslo_utils/excutils.py", line 220, in __exit__</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     self.force_reraise()</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/oslo_utils/excutils.py", line 196, in force_reraise</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     six.reraise(self.type_, self.value, self.tb)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 513, in add_tap_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     tap_device_name, device_owner, mtu)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 546, in _add_tap_interface</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     mtu):</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 497, in ensure_physical_in_bridge</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     physical_interface)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 286, in ensure_flat_bridge</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     if self.ensure_bridge(bridge_name, physical_interface):</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 455, in ensure_bridge</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     self.update_interface_ip_details(bridge_name, interface)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 417, in update_interface_ip_details</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     gateway)</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent   File "/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py", line 401, in _update_interface_ip_details</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent     dst_device.route.add_gateway(gateway=gateway['gateway'],</span></span>
<span class="line"><span style="color:#a6accd">2020-01-29 14:09:22.599 6346 ERROR neutron.plugins.ml2.drivers.agent._common_agent KeyError: 'gateway'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ†åˆ«ä¿®æ”¹æ§åˆ¶èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹ä¸Šçš„Neutronæºç ï¼Œå¹¶é‡å¯æœåŠ¡</p><ol><li>å°†priorityä¿®æ”¹ä¸ºmetric</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node3 ~]# vim +1503 /usr/lib/python2.7/site-packages/neutron/agent/linux/ip_lib.py</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#'priority': get_attr(route, 'RTA_PRIORITY'),</span></span>
<span class="line"><span style="color:#a6accd">'metric': get_attr(route, 'RTA_PRIORITY'),</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å°†gatewayä¿®æ”¹ä¸ºvia</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node3 ~]# vim +402 /usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/linuxbridge/agent/linuxbridge_neutron_agent.py</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#dst_device.route.add_gateway(gateway=gateway['gateway'],</span></span>
<span class="line"><span style="color:#a6accd">            dst_device.route.add_gateway(gateway=gateway['via'],</span></span>
<span class="line"><span style="color:#a6accd">                                         metric=metric)</span></span>
<span class="line"><span style="color:#a6accd">            #src_device.route.delete_gateway(gateway=gateway['gateway'])</span></span>
<span class="line"><span style="color:#a6accd">            src_device.route.delete_gateway(gateway=gateway['via'])</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è®¡ç®—èŠ‚ç‚¹é‡å¯æœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node3 ~]# systemctl restart neutron-linuxbridge-agent</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ§åˆ¶èŠ‚ç‚¹é‡å¯æœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@openstack-compute-node1 ~]# systemctl restart neutron-server.service   neutron-linuxbridge-agent.s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_1-8-åˆ›å»ºç¬¬ä¸€å°openstackäº‘ä¸»æœº" tabindex="-1">1.8 åˆ›å»ºç¬¬ä¸€å°OpenStackäº‘ä¸»æœº <a aria-current="page" href="#_1-8-åˆ›å»ºç¬¬ä¸€å°openstackäº‘ä¸»æœº" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>å¥½çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»å®Œæˆäº†å¯åŠ¨ä¸€å°è™šæ‹Ÿæœºæ‰€æœ‰çš„å¿…å¤‡æ¡ä»¶ã€‚</p><ul><li>MySQLï¼šä¸ºå„ä¸ªæœåŠ¡æä¾›æ•°æ®å­˜å‚¨</li><li>RabbitMQï¼šä¸ºå„ä¸ªæœåŠ¡ä¹‹é—´é€šä¿¡æä¾›äº¤é€šæ¢çº½</li><li>KeyStoneï¼šä¸ºå„ä¸ªæœåŠ¡å™¨ä¹‹é—´é€šä¿¡æä¾›è®¤è¯å’ŒæœåŠ¡æ³¨å†Œ</li><li>Glanceï¼šä¸ºè™šæ‹Ÿæœºæä¾›é•œåƒç®¡ç†</li><li>Novaï¼šä¸ºè™šæ‹Ÿæœºæä¾›è®¡ç®—èµ„æº</li><li>Neutronï¼šä¸ºè™šæ‹Ÿæœºæä¾›ç½‘ç»œèµ„æºã€‚</li></ul><p>ç°åœ¨ä½ å¯ä»¥ç€æ‰‹å¯åŠ¨ä¸€å°è™šæ‹Ÿæœºï¼Œå‰©ä¸‹çš„OpenStackæœåŠ¡éƒ½å¯ä»¥è®¤ä¸ºæ˜¯å¯é€‰çš„ï¼Œä¸è¿‡é€šå¸¸æˆ‘ä»¬ä¼šç”¨åˆ°Dashboardæ¥é€šè¿‡Webç•Œé¢æ¥ç®¡ç†ï¼Œåé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šè®²åˆ°ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤æ¥åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€å°è™šæ‹Ÿæœºã€‚</p><h3 id="åˆ›å»ºflatç½‘ç»œ" tabindex="-1">åˆ›å»ºFLATç½‘ç»œ <a aria-current="page" href="#åˆ›å»ºflatç½‘ç»œ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç½‘ç»œã€‚æˆ‘ä»¬ç°åœ¨ä¸ºdemoç§Ÿæˆ·ï¼Œåˆ›å»ºä¸€ä¸ªFLATç±»å‹çš„ç½‘ç»œã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><ol><li>åˆ›å»ºFlantç½‘ç»œ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source admin-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network create  --share --external \</span></span>
<span class="line"><span style="color:#a6accd">  --provider-physical-network provider \</span></span>
<span class="line"><span style="color:#a6accd">  --provider-network-type flat provider</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æŸ¥çœ‹ç½‘ç»œ</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network list</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åˆ›å»ºå­ç½‘</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack subnet create --network provider \</span></span>
<span class="line"><span style="color:#a6accd">  --allocation-pool start=192.168.56.100,end=192.168.56.200 \</span></span>
<span class="line"><span style="color:#a6accd">  --dns-nameserver 223.5.5.5  --gateway 192.168.56.2 \</span></span>
<span class="line"><span style="color:#a6accd">  --subnet-range 192.168.56.0/24 provider-subnet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æŸ¥çœ‹å­ç½‘</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack subnet list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+----------+--------------------------------------+-----------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name     | Network                              | Subnet          |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+----------+--------------------------------------+-----------------+</span></span>
<span class="line"><span style="color:#a6accd">| 297530f8-62b6-4954-ad33-c8a4ba922a3e | provider | 6cf562b4-0537-4232-a2b9-ce5481e6a505 | 192.168.56.0/24 |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+----------+--------------------------------------+-----------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="åˆ›å»ºäº‘ä¸»æœº" tabindex="-1">åˆ›å»ºäº‘ä¸»æœº <a aria-current="page" href="#åˆ›å»ºäº‘ä¸»æœº" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>åˆ›å»ºäº‘ä¸»æœºç±»å‹</li></ol><p>ç”±äºé»˜è®¤çš„äº‘ä¸»æœºå¤§å°å†…å­˜æœ€å°æ˜¯512Mï¼Œè€ƒè™‘åˆ°å¤šæ•°äººè‡ªå·±PCçš„å®éªŒç¯å¢ƒå†…å­˜æœ‰é™ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå°çš„äº‘ä¸»æœºç±»å‹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åˆ›å»ºå¯†é’¥å¯¹</li></ol><p>å¯†é’¥å¯¹ç”¨æ¥ä½¿ç”¨ç™»å½•åˆ›å»ºåçš„è™šæ‹Ÿæœºï¼ŒOpenStackåœ¨åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ä¼šæŠŠå…¬é’¥æ”¾åˆ°è™šæ‹Ÿæœºé‡Œé¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ä½¿ç”¨å¯†ç è¿æ¥ã€‚ æ³¨æ„ç°åœ¨åˆ‡æ¢åˆ°demoç”¨æˆ·ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨demoç”¨æˆ·æ¥åˆ›å»ºç¬¬ä¸€å°äº‘ä¸»æœº</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh-keygen -q -N ""</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack keypair list</span></span>
<span class="line"><span style="color:#a6accd">+-------+-------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Name  | Fingerprint                                     |</span></span>
<span class="line"><span style="color:#a6accd">+-------+-------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| mykey | d2:e0:bc:3e:35:58:5f:7b:fd:c1:0a:93:5e:bf:8f:2d |</span></span>
<span class="line"><span style="color:#a6accd">+-------+-------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æ·»åŠ å®‰å…¨ç»„è§„åˆ™</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªdefaultå®‰å…¨ç»„ï¼Œè¿™ä¸ªå®‰å…¨ç»„ä¼šæ‹’ç»æ‰€æœ‰è®¿é—®ï¼Œæ‰€ä»¥ä¸ºäº†åˆ›å»ºè™šæ‹Ÿæœºèƒ½å¤Ÿè¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®è¿è¡ŒICMPå’Œ22ç«¯å£è®¿é—®ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack security group rule create --proto icmp default</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack security group rule create --proto tcp --dst-port 22 default</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨å®ä¾‹å‰å‡†å¤‡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source demo-openstack.sh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æŸ¥çœ‹å¯ç”¨çš„äº‘ä¸»æœºç±»å‹</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack flavor list</span></span>
<span class="line"><span style="color:#a6accd">+----+---------+-----+------+-----------+-------+-----------+</span></span>
<span class="line"><span style="color:#a6accd">| ID | Name    | RAM | Disk | Ephemeral | VCPUs | Is Public |</span></span>
<span class="line"><span style="color:#a6accd">+----+---------+-----+------+-----------+-------+-----------+</span></span>
<span class="line"><span style="color:#a6accd">| 0  | m1.nano |  64 |    1 |         0 |     1 | True      |</span></span>
<span class="line"><span style="color:#a6accd">+----+---------+-----+------+-----------+-------+-----------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æŸ¥çœ‹å¯ç”¨çš„é•œåƒ</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack image list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name   | Status | Server |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd">| 68615b2c-d10e-422f-9acb-c724808657ab | cirros | ACTIVE |        |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------+--------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æŸ¥çœ‹å¯ç”¨çš„ç½‘ç»œ</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack network list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name   | Subnets                              |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 557a00fa-f61d-4244-b350-29ffe0a03125 | public | c003b4b5-23d1-4211-ad2d-a62ec07d8853 |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+--------+--------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>æŸ¥çœ‹å¯ç”¨çš„å®‰å…¨ç»„</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack security group list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+---------+------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name    | Description            | Project                          |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+---------+------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 74d74309-0660-4eb9-abba-e89fb6fd23ae | default | Default security group | aec911c3ae68464ba989213e5f6060b1 |</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>åˆ›å»ºè™šæ‹Ÿæœº</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack server create --flavor m1.nano --image cirros \</span></span>
<span class="line"><span style="color:#a6accd">--nic net-id=5c4d0706-24cd-4d42-ba78-36a05b6c81c8 --security-group default \</span></span>
<span class="line"><span style="color:#a6accd">--key-name mykey demo-instance</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="æ³¨æ„æŒ‡å®šç½‘ç»œçš„æ—¶å€™éœ€è¦ä½¿ç”¨idï¼Œè€Œä¸æ˜¯åç§°ã€‚" tabindex="-1">æ³¨æ„æŒ‡å®šç½‘ç»œçš„æ—¶å€™éœ€è¦ä½¿ç”¨IDï¼Œè€Œä¸æ˜¯åç§°ã€‚ <a aria-current="page" href="#æ³¨æ„æŒ‡å®šç½‘ç»œçš„æ—¶å€™éœ€è¦ä½¿ç”¨idï¼Œè€Œä¸æ˜¯åç§°ã€‚" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="æµ‹è¯•äº‘ä¸»æœº" tabindex="-1">æµ‹è¯•äº‘ä¸»æœº <a aria-current="page" href="#æµ‹è¯•äº‘ä¸»æœº" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><ol><li>æŸ¥çœ‹äº‘ä¸»æœºçŠ¶æ€</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack server list</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+-----------------+--------+------------+-------------+-----------------------+</span></span>
<span class="line"><span style="color:#a6accd">| ID                                   | Name            | Status | Task State | Power State | Networks              |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+-----------------+--------+------------+-------------+-----------------------+</span></span>
<span class="line"><span style="color:#a6accd">| 7f94df9a-e547-4f56-9887-bbc52c4e0fff | public-instance | ACTIVE | -          | Running     | public=192.168.56.101 |</span></span>
<span class="line"><span style="color:#a6accd">+--------------------------------------+-----------------+--------+------------+-------------+-----------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>æµ‹è¯•è™šæ‹Ÿæœºè¿æ¥</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ping -c 2 192.168.56.101</span></span>
<span class="line"><span style="color:#a6accd">PING 192.168.56.101 (192.168.56.101) 56(84) bytes of data.</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 192.168.56.101: icmp_seq=1 ttl=64 time=5.90 ms</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 192.168.56.101: icmp_seq=2 ttl=64 time=0.484 ms</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">è¿æ¥è™šæ‹Ÿæœº</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh cirros@192.168.56.101</span></span>
<span class="line"><span style="color:#a6accd">The authenticity of host '192.168.56.101 (192.168.56.101)' can't be established.</span></span>
<span class="line"><span style="color:#a6accd">RSA key fingerprint is 29:4d:76:17:05:1a:4e:e6:f9:81:a5:1d:8c:27:ff:2c.</span></span>
<span class="line"><span style="color:#a6accd">Are you sure you want to continue connecting (yes/no)? yes</span></span>
<span class="line"><span style="color:#a6accd">Warning: Permanently added '192.168.56.101' (RSA) to the list of known hosts.</span></span>
<span class="line"><span style="color:#a6accd">$ ifconfig eth0</span></span>
<span class="line"><span style="color:#a6accd">eth0      Link encap:Ethernet  HWaddr FA:16:3E:E8:B9:C1  </span></span>
<span class="line"><span style="color:#a6accd">          inet addr:192.168.56.101  Bcast:192.168.56.255  Mask:255.255.255.0</span></span>
<span class="line"><span style="color:#a6accd">          inet6 addr: fe80::f816:3eff:fee8:b9c1/64 Scope:Link</span></span>
<span class="line"><span style="color:#a6accd">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></span>
<span class="line"><span style="color:#a6accd">          RX packets:150 errors:0 dropped:0 overruns:0 frame:0</span></span>
<span class="line"><span style="color:#a6accd">          TX packets:162 errors:0 dropped:0 overruns:0 carrier:0</span></span>
<span class="line"><span style="color:#a6accd">          collisions:0 txqueuelen:1000 </span></span>
<span class="line"><span style="color:#a6accd">          RX bytes:18634 (18.1 KiB)  TX bytes:17264 (16.8 KiB)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœæ— æ³•pingé€šè™šæ‹Ÿæœºï¼Œè¿˜å¯ä»¥ç™»é™†è™šæ‹ŸæœºWebé¡µé¢æŸ¥çœ‹ï¼Œæ˜¯å¦å¯åŠ¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openstack console url show demo-instance</span></span>
<span class="line"><span style="color:#a6accd">+-------+------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| Type  | Url                                                                                |</span></span>
<span class="line"><span style="color:#a6accd">+-------+------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd">| novnc | http://192.168.56.11:6080/vnc_auto.html?token=e97cffb8-cf0c-4c22-8dbc-fa88ff61f453 |</span></span>
<span class="line"><span style="color:#a6accd">+-------+------------------------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ­å–œï¼ä½ æˆåŠŸçš„ä½¿ç”¨OpenStackåˆ›å»ºäº†ç¬¬ä¸€å°è™šæ‹Ÿæœºï¼Œå¯èƒ½è¿™ä¸€è·¯èµ°æ¥æœ‰ç‚¹åå·ï¼Œä½†æ˜¯ä½ æˆåŠŸäº†ã€‚ä¸è¿‡è¿™åªæ˜¯ä½ åœ¨OpenStackä¸–ç•Œé‡Œå®Œæˆçš„ç¬¬ä¸€æ­¥ï¼</p><h1 id="openstack-dashboard" tabindex="-1">OpenStack Dashboard <a aria-current="page" href="#openstack-dashboard" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>ç›®å‰æˆ‘ä»¬å·²ç»è®²è§£å¹¶å®‰è£…äº†OpenStackçš„Keystoneã€Glanceã€Novaã€Neutronã€‚è€Œä¸”æˆ‘ä»¬å·²ç»ä½¿ç”¨å‘½ä»¤æˆåŠŸçš„åˆ›å»ºäº†ä¸€å°è™šæ‹Ÿæœºï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œè¿æ¥å’Œè®¿é—®ã€‚æˆ‘ç›¸ä¿¡å¤§å®¶å·²ç»è¿«ä¸åŠå¾…çš„æƒ³çœ‹åˆ°OpenStackçš„DashBoardäº†ã€‚ é‚£ä¹ˆOpenStackçš„æœ‰ä¸‰ç§ç®¡ç†æ–¹æ³•Horizonã€CLIå’ŒAPIã€‚æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å°±æ¥éƒ¨ç½²Horizonã€‚ Horizonæ˜¯OpenStackçš„Dashboardï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥è®©äº‘ç®¡ç†å‘˜å’Œç”¨æˆ·ç®¡ç†OpenStackå„ç§èµ„æºå’ŒæœåŠ¡çš„webæ¥å£ã€‚Horizoné€šè¿‡OpenStack APIå’Œå„ä¸ªç»„ä»¶è¿›è¡Œäº¤äº’ã€‚ Dashboardä¼šæ ¹æ®Keystoneä¸­æ³¨å†Œçš„Serviceå»æ˜¾ç¤ºç›¸åº”çš„åŠŸèƒ½ã€‚æ‰€ä»¥å¦‚æœä½ æ²¡æœ‰å®‰è£…ç›¸åº”çš„æœåŠ¡ï¼Œå´å†Keystoneä¸­åšäº†æ³¨å†Œï¼Œç™»é™†Dashboardæ˜¯ä¼šæŠ¥é”™çš„ã€‚</p><h3 id="horizonéƒ¨ç½²" tabindex="-1">Horizonéƒ¨ç½² <a aria-current="page" href="#horizonéƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><blockquote><p>éœ€è¦å°†Keystoneå’ŒHoarizonåˆ†å¼€éƒ¨ç½²ï¼Œå½¼æ­¤ä¹‹é—´æœ‰å†²çªã€‚éƒ¨ç½²åˆ°linux-node2èŠ‚ç‚¹ä¸Šã€‚</p></blockquote><ol><li>å®‰è£…Horizon</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# yum install -y openstack-dashboard</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Horizoné…ç½®</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# vim /etc/openstack-dashboard/local_settings</span></span>
<span class="line"><span style="color:#a6accd">#å…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®</span></span>
<span class="line"><span style="color:#a6accd">ALLOWED_HOSTS = ['*', ]</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®Keystoneåœ°å€</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_HOST = "192.168.56.11"</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_URL = "http://%s:5000/v3" % OPENSTACK_HOST</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®APIç‰ˆæœ¬ï¼Œéœ€è¦æ–°å¢</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_API_VERSIONS = {</span></span>
<span class="line"><span style="color:#a6accd">    "identity": 3,</span></span>
<span class="line"><span style="color:#a6accd">    "volume": 2,</span></span>
<span class="line"><span style="color:#a6accd">    "compute": 2,</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">#ä¸ºé€šè¿‡ä»ªè¡¨ç›˜åˆ›å»ºçš„ç”¨æˆ·é…ç½®é»˜è®¤çš„ user è§’è‰²</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_DEFAULT_ROLE = "user"</span></span>
<span class="line"><span style="color:#a6accd">å¼€å¯å¤šåŸŸæ”¯æŒ</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span></span>
<span class="line"><span style="color:#a6accd">è®¾ç½®é»˜è®¤çš„åŸŸ</span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = 'Default'</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®Sessionå­˜å‚¨åˆ°Memcached</span></span>
<span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">    'default': {</span></span>
<span class="line"><span style="color:#a6accd">        'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',</span></span>
<span class="line"><span style="color:#a6accd">        'LOCATION': '192.168.56.11:11211',</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#å¯ç”¨Webç•Œé¢ä¸Šä¿®æ”¹å¯†ç </span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_HYPERVISOR_FEATURES = {</span></span>
<span class="line"><span style="color:#a6accd">    'can_set_mount_point': True,</span></span>
<span class="line"><span style="color:#a6accd">    'can_set_password': True,</span></span>
<span class="line"><span style="color:#a6accd">    'requires_keypair': False,</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">#è®¾ç½®æ—¶åŒº</span></span>
<span class="line"><span style="color:#a6accd">TIME_ZONE = "Asia/Shanghai"</span></span>
<span class="line"><span style="color:#a6accd">#ç¦ç”¨è‡ªæœåŠ¡ç½‘ç»œçš„ä¸€äº›é«˜çº§ç‰¹æ€§</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">OPENSTACK_NEUTRON_NETWORK = {</span></span>
<span class="line"><span style="color:#a6accd">    ...</span></span>
<span class="line"><span style="color:#a6accd">    'enable_router': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_quotas': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_distributed_router': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_ha_router': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_lb': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_firewall': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_vpn': False,</span></span>
<span class="line"><span style="color:#a6accd">    'enable_fip_topology_check': False,</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>é‡æ–°ç”Ÿäº§Horizoné…ç½®æ–‡ä»¶</li></ol><p>å¦‚æœæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œå’Œé»˜è®¤å®‰è£…çš„é…ç½®ï¼Œè®¿é—®/dashboardåè·³è½¬åˆ°/auth/loginå¹¶ä¸”ä¼šæç¤º404 Not Foundï¼Œéœ€è¦é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# cd /usr/share/openstack-dashboard</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# python manage.py make_web_conf --apache &gt; /etc/httpd/conf.d/openstack-dashboard.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>å¯åŠ¨æœåŠ¡</li></ol><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl enable httpd.service</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# systemctl restart httpd.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¥½çš„ï¼Œç°åœ¨ä½ å°±å¯ä»¥ä½¿ç”¨<a href="http://192.168.56.11/%E6%9D%A5%E8%AE%BF%E9%97%AE%E4%BB%AA%E8%A1%A8%E7%9B%98%E4%BA%86%E3%80%82%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8admin%E6%88%96%E8%80%85demo%E3%80%82%E9%9C%80%E8%A6%81%E4%BD%A0%E4%BA%B2%E8%87%AA%E6%9D%A5%E4%BD%93%E9%AA%8C%E4%BB%96%E4%BB%AC%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%E3%80%82" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://192.168.56.11/æ¥è®¿é—®ä»ªè¡¨ç›˜äº†ã€‚ç”¨æˆ·åå’Œå¯†ç å¯ä»¥ä½¿ç”¨adminæˆ–è€…demoã€‚éœ€è¦ä½ äº²è‡ªæ¥ä½“éªŒä»–ä»¬åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒã€‚<!--]--></a></p><h3 id="horizonçš„sessionå­˜å‚¨" tabindex="-1">Horizonçš„Sessionå­˜å‚¨ <a aria-current="page" href="#horizonçš„sessionå­˜å‚¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æˆ‘ä»¬ç»å¸¸åœ¨è´Ÿè½½å‡è¡¡çš„ç¯å¢ƒä¸‹ï¼Œä¼šé‡åˆ°Sessionçš„é—®é¢˜ï¼Œä¸€èˆ¬çš„è§£å†³åŠæ³•æœ‰ä¸‰ç§ï¼š</p><ul><li>Sessionä¿æŒ</li><li>Sessionå¤åˆ¶</li><li>Sessionå…±äº«</li></ul><p>Horizonä½œä¸ºä¸€ä¸ªå…¸å‹çš„Djangoåº”ç”¨ï¼Œæ˜¯ä½¿ç”¨ Django sessionæ¶æ„æ¥å¤„ç†ç”¨æˆ·çš„sessionæ•°æ®ï¼Œç›®å‰sessionæ”¯æŒä»¥ä¸‹å‡ ç§å­˜å‚¨æ–¹å¼ï¼š</p><ul><li>æœ¬åœ°å†…å­˜ç¼“å­˜</li><li>é”®å€¼å¯¹å­˜å‚¨ï¼ˆMemcachedæˆ–è€…Redisï¼‰</li><li>æ•°æ®åº“å­˜å‚¨</li><li>cookies</li></ul><p>é€šè¿‡ä¿®æ”¹ local_settings æ–‡ä»¶çš„ SESSION_ENGINE çš„é…ç½®å€¼æ¥è‡ªå®šåˆ¶sessionåç«¯</p><p><strong>æœ¬åœ°å†…å­˜ç¼“å­˜</strong></p><p>æœ¬åœ°å†…å­˜ç¼“å­˜æ˜¯æœ€å¿«é€Ÿå’Œæœ€ç®€å•çš„sessionåç«¯é…ç½®æ–¹æ³•ï¼Œå› ä¸ºä»–ä¸éœ€è¦å¤„ç†ä»»ä½•çš„ä¾èµ–å…³ç³»ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä»–ä¹Ÿæ‹¥æœ‰ä»¥ä¸‹æ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p><ul><li><p>å­˜å‚¨ä¸ºéå…±äº«çš„ï¼Œä¸èƒ½è·¨è¿›ç¨‹</p></li><li><p>è¿›ç¨‹ç»ˆæ­¢åæ²¡æœ‰æŒç»­æ€§ã€‚ å•ä¸€çš„Horizonå®‰è£…çš„é»˜è®¤ä¸ºæœ¬åœ°å†…å­˜åç«¯ï¼Œå› ä¸ºä»–æ²¡æœ‰ä¾èµ–æ€§é—®é¢˜ã€‚ç”Ÿäº§ç¯å¢ƒæ˜¯ä¸æ¨èä½¿ç”¨è¿™ä¸ªåç«¯çš„ï¼Œç”šè‡³åœ¨ä¸¥è‚ƒçš„å¼€å‘å·¥ä½œä¸­ä¹Ÿä¸æ¨èã€‚ä½ ä»æ—§å¯ä»¥è¿™æ ·å¯ç”¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">  'BACKEND': 'django.core.cache.backends.locmem.LocMemCache'</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div></li></ul><p><strong>é”®å€¼å¯¹å­˜å‚¨</strong></p><p>ä½ å¯ä»¥ä½¿ç”¨Memcached æˆ– Redis ç­‰åº”ç”¨ç¨‹åºä½œä¸ºsessionçš„å¤–éƒ¨ç¼“å­˜æœºåˆ¶ã€‚è¿™äº›åº”ç”¨ç¨‹åºä¸ºsessionæä¾›äº†æŒä¹…å¹¶å¯ä»¥å…±äº«çš„å­˜å‚¨ï¼Œè¿™åœ¨å°è§„æ¨¡æˆ–å¼€å‘ç¯å¢ƒä¸­çš„éƒ¨ç½²ä¸­ååˆ†æœ‰ç”¨ã€‚</p><ol><li>Memcached</li></ol><p>Memcached æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½å’Œåˆ†å¸ƒå¼çš„å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œä¸ºå°å—çš„ä»»æ„æ•°æ®æä¾›è¿›é©»å†…å­˜çš„é”®å€¼å¯¹çš„å­˜å‚¨ã€‚ éœ€æ±‚ï¼š MemcachedæœåŠ¡è¿è¡Œå¹¶å¯ä»¥è®¿é—®ã€‚ å®‰è£…äº†python-memcached çš„ Python æ¨¡å— é€šè¿‡ä¸‹é¢çš„æ–¹æ³•å¯ç”¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">    'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache'</span></span>
<span class="line"><span style="color:#a6accd">    'LOCATION': 'my_memcached_host:11211',</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ol><li>Redis</li></ol><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒBSDè®¸å¯çš„ï¼Œé«˜çº§é”®å€¼å¯¹å­˜å‚¨ã€‚ä»–é€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ã€‚ éœ€æ±‚ï¼š RedisæœåŠ¡è¿è¡Œå¹¶å¯ä»¥è®¿é—® å®‰è£…äº† redis ä»¥åŠ django-redis çš„pythonæ¨¡å— é€šè¿‡ä»¥ä¸‹é…ç½®æ–¹æ³•å¯ç”¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">SESSION_ENGINE = 'django.contrib.sessions.backends.cache'</span></span>
<span class="line"><span style="color:#a6accd">CACHES = {</span></span>
<span class="line"><span style="color:#a6accd">    "default": {</span></span>
<span class="line"><span style="color:#a6accd">        "BACKEND": "redis_cache.cache.RedisCache",</span></span>
<span class="line"><span style="color:#a6accd">        "LOCATION": "127.0.0.1:6379:1",</span></span>
<span class="line"><span style="color:#a6accd">        "OPTIONS": {</span></span>
<span class="line"><span style="color:#a6accd">            "CLIENT_CLASS": "redis_cache.client.DefaultClient",</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="ç¬¬ä¸‰éƒ¨åˆ†-openstackè¿›é˜¶æŒ‡å—" tabindex="-1">ç¬¬ä¸‰éƒ¨åˆ† OpenStackè¿›é˜¶æŒ‡å— <a aria-current="page" href="#ç¬¬ä¸‰éƒ¨åˆ†-openstackè¿›é˜¶æŒ‡å—" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>è”ç³»ä½œè€…----------------------------------------------------------------------</p><h1 id="ç¬¬å››éƒ¨åˆ†-dockerå’ŒkubernetesåŸºç¡€" tabindex="-1">ç¬¬å››éƒ¨åˆ† Dockerå’ŒKubernetesåŸºç¡€ <a aria-current="page" href="#ç¬¬å››éƒ¨åˆ†-dockerå’ŒkubernetesåŸºç¡€" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>1.dockeråŸºç¡€å…¥é—¨</p><p>åœ¨å…¨é“¾è·¯è‡ªåŠ¨åŒ–è¿ç»´ä½“ç³»ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œæˆè‡ªåŠ¨åŒ–ç³»ç»Ÿå®‰è£…ã€è‡ªåŠ¨åŒ–ç›‘æ§ã€é…ç½®ç®¡ç†ã€ä»£ç éƒ¨ç½²ã€‚é€šè¿‡SaltStackçš„é…ç½®ç®¡ç†å¯ä»¥ä¿è¯å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§ï¼›è‡ªåŠ¨åŒ–ä»£ç éƒ¨ç½²å¯ä»¥å®ç°ä¸€é”®éƒ¨ç½²ã€ç§’çº§å›æ»šï¼›ä½†æ˜¯ï¼Œä½ æœ‰æ²¡æœ‰è€ƒè™‘è¿‡ï¼ŒSaltStacké…ç½®çš„ç¯å¢ƒæ˜¯å¾ˆéš¾å›æ»šçš„ï¼Œå°±åƒä½ å®‰è£…äº†ä¸€ä¸ªè½¯ä»¶åŒ…æ›´æ–°äº†å…¶å®ƒçš„è½¯ä»¶åŒ…ã€‚æƒ³å›æ»šåˆ°ä½ å®‰è£…è½¯ä»¶ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™ä¸ªå¯èƒ½æœ‰ç‚¹éš¾ã€‚å†æˆ–è€…ä½ çš„ä»£ç å’Œç¯å¢ƒéœ€è¦ä¸€èµ·å›æ»šï¼</p><p><img src="http://k8s.unixhot.com/docker/media/6b19e69aac9d176124a719ad038e3bb2.png" alt="img"></p><p>é‚£ä¹ˆè®©æˆ‘ä»¬é©¬ä¸Šè¿›å…¥å®¹å™¨çš„ä¸–ç•Œï¼Œè™½ç„¶å®¹å™¨ä¸ä»…ä»…æ˜¯è§£å†³è¿™äº›é—®é¢˜ï¼Œä½†æ˜¯è‡³å°‘æˆ‘ä»¬é‡åˆ°äº†è¿ç»´ç—›ç‚¹ï¼Ÿå¼•å…¥ä¸€ä¸ªæ–°çš„è§£å†³æ–¹æ¡ˆä¸€å®šæ˜¯ä¸ºäº†è§£å†³ç—›ç‚¹ã€‚ä½œä¸ºè¿ç»´ï¼Œæˆ‘ä»¬ä¸èƒ½å±€é™äºçœ¼å‰çš„è‹Ÿä¸”ï¼Œä¸€å®šè¦é«˜ç»è¿œç©ï¼ŒåŠæ—¶çš„è·Ÿä¸Šæ½®æµã€‚ä½†æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å¿…é¡»è¦æ…é‡çš„å¯¹å¾…ã€‚</p><h2 id="dockerä»‹ç»" tabindex="-1">Dockerä»‹ç» <a aria-current="page" href="#dockerä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Dockeræ˜¯Docker.Incå…¬å¸å¼€æºçš„ä¸€ä¸ªåŸºäºLXCæŠ€æœ¯ä¹‹ä¸Šæ„å»ºçš„Containerå®¹å™¨å¼•æ“ï¼Œæºä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š,åŸºäºGoè¯­è¨€å¹¶éµä»Apache2.0åè®®å¼€æºã€‚</p><p>Dockeræ˜¯é€šè¿‡å†…æ ¸è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆnamespacesåŠcgroupsç­‰ï¼‰æ¥æä¾›å®¹å™¨çš„èµ„æºéš”ç¦»ä¸å®‰å…¨ä¿éšœç­‰ã€‚ç”±äºDockeråœ¨æ“ä½œç³»ç»Ÿå±‚å®ç°éš”ç¦»ï¼Œæ‰€ä»¥Dockerå®¹å™¨åœ¨è¿è¡Œæ—¶ï¼Œä¸éœ€è¦ç±»ä¼¼è™šæ‹Ÿæœºï¼ˆVMï¼‰é¢å¤–çš„æ“ä½œç³»ç»Ÿå¼€é”€ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚</p><p><strong>Dockerè¿è¡Œç»“æ„</strong></p><p><img src="http://k8s.unixhot.com/docker/media/3185f40a56d6a22b714b444d515be3f0.png" alt="è¯´æ˜: Docker Engine Components Flow"></p><p>Dockeræ˜¯ä¸€ä¸ªC/Sç»“æ„çš„é¡¹ç›®ï¼Œæœ‰Docker Clientã€RESTAPIã€Docker Serverç»„æˆã€‚</p><ul><li>Docker Clientï¼šDockerå®¢æˆ·ç«¯å‘½ä»¤å·¥å…·ã€‚</li><li>REST APIï¼šæä¾›æ ‡å‡†çš„RESTfulæ¥å£ã€‚</li><li>Docker Server:ï¼šDocker daemonçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œæ¥æ”¶ç”¨æˆ·ä»Docker Clientè°ƒç”¨REST APIå‘é€è¿‡æ¥çš„è¯·æ±‚ã€‚</li></ul><p><strong>Docker åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</strong></p><ul><li>é•œåƒï¼ˆImageï¼‰</li><li>å®¹å™¨ï¼ˆContainerï¼‰</li><li>ä»“åº“ï¼ˆRepositoryï¼‰</li></ul><p><strong>Dockeré•œåƒ</strong></p><p>Docker é•œåƒå°±æ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ã€‚ä½ å¯ä»¥æ‹¿KVMè™šæ‹Ÿæœºé•œåƒæ¥å¯¹æ¯”ç†è§£ã€‚</p><p>ä¾‹å¦‚ï¼šä¸€ä¸ªé•œåƒå¯ä»¥åŒ…å«ä¸€ä¸ªå®Œæ•´çš„CentOSæ“ä½œç³»ç»Ÿè¿è¡Œï¼ˆæ³¨æ„ä¸åŒ…å«å†…æ ¸ï¼‰ï¼Œé‡Œé¢ä»…å®‰è£…äº†Nginxæˆ–ç”¨æˆ·éœ€è¦çš„å…¶å®ƒåº”ç”¨ç¨‹åºã€‚</p><p>é•œåƒå¯ä»¥ç”¨æ¥åˆ›å»ºDockerå®¹å™¨ã€‚å°±åƒä½ ä½¿ç”¨åˆ›å»ºå¥½çš„é•œåƒç›´æ¥å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¸€æ ·ã€‚</p><p>Docker æä¾›äº†ä¸€ä¸ªå¾ˆç®€å•çš„æœºåˆ¶æ¥åˆ›å»ºé•œåƒæˆ–è€…æ›´æ–°ç°æœ‰çš„é•œåƒï¼Œç”¨æˆ·ç”šè‡³å¯ä»¥ç›´æ¥ä»å…¶ä»–äººé‚£é‡Œä¸‹è½½ä¸€ä¸ªå·²ç»åšå¥½çš„é•œåƒæ¥ç›´æ¥ä½¿ç”¨ã€‚</p><p><strong>å°æç¤ºï¼šä¸ºä»€ä¹ˆåœ¨CentOSçš„å®¿ä¸»æœºä¸Šå¯ä»¥è¿è¡Œä¸€ä¸ªUbuntuçš„Dockerå®¹å™¨ï¼Ÿå› ä¸ºDockeré•œåƒé‡Œé¢åªæ˜¯åŒ…å«äº†å®¹å™¨è¿è¡Œæ—¶çš„æ–‡ä»¶ã€åº“æ–‡ä»¶ç­‰ï¼Œå¹¶ä¸åŒ…å«Kernelï¼Œç»Ÿä¸€ä½¿ç”¨å®¿ä¸»æœºçš„Linuxå†…æ ¸ã€‚</strong></p><p><strong>Dockerå®¹å™¨</strong></p><p>Dockeråˆ©ç”¨å®¹å™¨æ¥è¿è¡Œåº”ç”¨ï¼Œå°±åƒä½ è¿è¡Œä¸€ä¸ªKVMè™šæ‹Ÿæœºä¸€æ ·ã€‚å®¹å™¨å°±æ˜¯ä»é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ï¼Œå°±åƒæˆ‘ä»¬ä¸Šé¢æåˆ°äº†è™šæ‹Ÿæœºå®ä¾‹ä¸€æ ·ã€‚å®ƒå¯ä»¥è¢«å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ã€‚æ¯ä¸ªå®¹å™¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€éš”ç¦»çš„ä¸ªä½“ã€‚ä½†å…¶å®æ²¡æœ‰è™šæ‹Ÿæœºéš”ç¦»çš„é‚£ä¹ˆå½»åº•ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†è¯´ã€‚</p><p>ä½ å¯ä»¥æŠŠå®¹å™¨çœ‹åšæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„Linux ç¯å¢ƒï¼ˆåŒ…æ‹¬rootç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰å’Œè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚</p><p><strong>Dockerä»“åº“</strong></p><p>Dockerä»“åº“æ˜¯é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€ã€‚å°±åƒOpenStackçš„GlanceæœåŠ¡ï¼Œä»“åº“åˆ†ä¸ºå…¬å¼€ä»“åº“ï¼ˆPublicï¼‰å’Œç§æœ‰ä»“åº“ï¼ˆPrivateï¼‰ä¸¤ç§å½¢å¼ã€‚è¿™ä¸ªæœ‰ç‚¹åƒGitä»£ç æ‰˜ç®¡ï¼Œä½ å¯ä»¥æŠŠä»£ç æ”¾åœ¨GitHubä¸Šå¹¶å…¬å¼€ï¼Œä¹Ÿå¯æ˜¯ä½¿ç”¨Gitlabåˆ›å»ºä¸€ä¸ªç§æœ‰çš„ä»£ç æ‰˜ç®¡å¹³å°ã€‚</p><p>Dockeræœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯Docker Hubï¼Œå­˜æ”¾äº†æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½ï¼Œåé¢ä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„é•œåƒåˆ†äº«åˆ°Docker Hubä¸­ã€‚</p><p>åŒæ—¶ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„é•œåƒæ‰˜ç®¡å¹³å°ï¼ŒDockeræœ‰ä¸€ä¸ªå«åšRegistryçš„ç»„ä»¶ï¼Œä½¿ç”¨Docker Registryå¯ä»¥å¯åŠ¨ä¸€ä¸ªç§æœ‰çš„é•œåƒæ‰˜ç®¡å¹³å°ï¼Œè¿™ä¸ªå¹³å°å¯ä»¥å­˜æ”¾å¤šä¸ªä»“åº“ï¼Œæ¯ä¸ªä»“åº“ä¸­åˆåŒ…å«äº†å¤šä¸ªé•œåƒï¼Œæ¯ä¸ªé•œåƒæœ‰ä¸åŒçš„æ ‡ç­¾ï¼ˆtagï¼‰ã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæŠŠä»“åº“å’Œä»“åº“æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰æ··ä¸ºä¸€è°ˆï¼Œå¹¶ä¸ä¸¥æ ¼åŒºåˆ†ï¼Œå®é™…ä¸Šä¸ä¸¥è°¨çš„ï¼Œä¸è¿‡ä¹Ÿä¸ç”¨å¤ªçº ç»“è¿™äº›åè¯ï¼Œå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡æ¥ç†è§£ã€‚</p><p>å½“ç”¨æˆ·åˆ›å»ºäº†è‡ªå·±çš„é•œåƒä¹‹åå°±å¯ä»¥ä½¿ç”¨docker pushå‘½ä»¤å°†å®ƒä¸Šä¼ åˆ°å…¬æœ‰æˆ–è€…ç§æœ‰ä»“åº“ï¼Œè¿™æ ·ä¸‹æ¬¡åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šä½¿ç”¨è¿™ä¸ªé•œåƒæ—¶å€™ï¼Œåªéœ€è¦ä»ä»“åº“ä¸Šdocker pullä¸‹æ¥å°±å¯ä»¥äº†ã€‚æ˜¯çš„ï¼Œæ²¡é”™ï¼Œå°±åƒä½ æ“ä½œGité‚£æ ·ã€‚</p><h3 id="dockerä¸è™šæ‹ŸåŒ–" tabindex="-1">Dockerä¸è™šæ‹ŸåŒ– <a aria-current="page" href="#dockerä¸è™šæ‹ŸåŒ–" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Dockeræ˜¯ä¸€ç§å®¹å™¨æŠ€æœ¯ï¼Œå®ƒå’Œè™šæ‹ŸåŒ–æ˜¯æœ‰åŒºåˆ«ï¼Œå°±åƒä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://k8s.unixhot.com/docker/media/50b4ac39d02c080a7e3284e9b078e0c2.jpg" alt="0731013"></p><p>å¯ä»¥çœ‹åˆ°Dockerçš„å®¹å™¨å¹¶ä¸éœ€è¦è¿è¡Œä¸€ä¸ªHypervisorã€‚ç›´æ¥æ˜¯Docker Engineæ¥ç®¡ç†å®¹å™¨ï¼Œå‡å°‘äº†Hypervisorçš„å¼€é”€ï¼Œä½†æ˜¯ç”±äºDockerå®¹å™¨å¹¶ä¸æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•æä¾›åƒè™šæ‹Ÿæœºä¸€æ ·çš„å®Œå…¨çš„èµ„æºéš”ç¦»ï¼Œè¿˜æœ‰å¾ˆå¤šéš”ç¦»å±‚é¢çš„é—®é¢˜ã€‚æ‰€ä»¥å¦‚æœä½ çš„ä¸šåŠ¡è¦æ±‚å®Œå…¨çš„èµ„æºéš”ç¦»ï¼Œå¯èƒ½Dockerå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚ä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰æ”¯ä»˜ä¸šåŠ¡ï¼Œéœ€è¦åœ¨ç‰©ç†æœºä¸Šæ’å…¥U Keyï¼Œåœ¨è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡USBé‡å®šå‘æ¥å®ç°ï¼Œä½†æ˜¯Dockerå´å¹¶ä¸æ”¯æŒã€‚</p><p>æ‰€æœ‰çš„æŠ€æœ¯éƒ½æœ‰å®ƒé€‚ç”¨çš„åœºæ™¯ï¼Œåªæœ‰æ·±å…¥äº†è§£Dockerï¼Œæˆ‘ä»¬æ‰èƒ½å‘æŒ¥å®ƒçš„ä½œç”¨ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</p><h3 id="dockerä¸openstackå¯¹æ¯”" tabindex="-1">Dockerä¸OpenStackå¯¹æ¯” <a aria-current="page" href="#dockerä¸openstackå¯¹æ¯”" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨Dockerè¿˜æ²¡æœ‰æ™®åŠä¹‹å‰ï¼Œäº‘è®¡ç®—ã€OpenStackç­‰æµè¡Œçš„æŠ€æœ¯é“ºé¢è€Œæ¥ã€‚ä¸¥æ ¼æ¥è¯´Dockerä¸åº”è¯¥å’ŒOpenStackåšå¯¹æ¯”ï¼Œä»–ä»¬æ²¡æœ‰åœ¨ä¸€ä¸ªå±‚çº§ä¸Šï¼Œå’ŒKVMæ¯”ä¼šæ›´å¥½ä¸€äº›ã€‚</p><table><thead><tr><th>ç±»åˆ«</th><th>Docker</th><th>OpenStack/KVM</th></tr></thead><tbody><tr><td>éƒ¨ç½²éš¾åº¦</td><td>éå¸¸ç®€å•</td><td>ç»„ä»¶å¤šï¼Œéƒ¨ç½²å¤æ‚</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ç§’çº§</td><td>åˆ†é’Ÿçº§</td></tr><tr><td>æ‰§è¡Œæ€§èƒ½</td><td>å’Œç‰©ç†ç³»ç»Ÿå‡ ä¹ä¸€è‡´</td><td>VMä¼šå ç”¨ä¸€äº›èµ„æº</td></tr><tr><td>é•œåƒä½“ç§¯</td><td>é•œåƒæ˜¯MBçº§åˆ«</td><td>è™šæ‹Ÿæœºé•œåƒGBçº§åˆ«</td></tr><tr><td>ç®¡ç†æ•ˆç‡</td><td>ç®¡ç†ç®€å•</td><td>ç»„ä»¶ç›¸äº’ä¾èµ–ï¼Œç®¡ç†å¤æ‚</td></tr><tr><td>éš”ç¦»æ€§</td><td>éš”ç¦»æ€§é«˜</td><td>å½»åº•éš”ç¦»</td></tr><tr><td>å¯ç®¡ç†æ€§</td><td>å•è¿›ç¨‹ã€ä¸å»ºè®®å¯åŠ¨SSH</td><td>å®Œæ•´çš„ç³»ç»Ÿç®¡ç†</td></tr><tr><td>ç½‘ç»œè¿æ¥</td><td>æ¯”è¾ƒå¼±</td><td>å€ŸåŠ©Neutronå¯ä»¥çµæ´»ç»„ä»¶å„ç±»ç½‘ç»œæ¶æ„</td></tr></tbody></table><h3 id="dockeræ”¹å˜äº†ä»€ä¹ˆï¼Ÿ" tabindex="-1">Dockeræ”¹å˜äº†ä»€ä¹ˆï¼Ÿ <a aria-current="page" href="#dockeræ”¹å˜äº†ä»€ä¹ˆï¼Ÿ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æˆ‘è§‰å¾—Dockeråœ¨ä¸åŒçš„å±‚é¢éƒ½æ”¹å˜äº†æˆ‘çš„å·¥ä½œæ–¹å¼ï¼š</p><p><strong>é¢å‘äº§å“</strong></p><p>å¢åŠ äº†äº§å“äº¤ä»˜æ¨¡å¼ã€‚åœ¨äº§å“äº¤ä»˜æ–¹é¢ï¼Œä¹‹å‰åšäº§å“äº¤ä»˜æˆ‘ä»¬éƒ½æ˜¯äº¤ä»˜çš„è½¯ä»¶åŒ…ã€å®‰è£…æ“ä½œæ–‡æ¡£ç­‰ï¼Œéœ€è¦ç”¨æˆ·è¿›è¡Œéƒ¨ç½²ã€‚è€Œç°åœ¨å¯ä»¥ç›´æ¥äº¤ä»˜Dockeré•œåƒï¼Œç›´æ¥å¯åŠ¨å°±å¯ä»¥è®¿é—®ã€‚ä¾‹å¦‚ç°åœ¨å¾ˆå¤šå¼€æºçš„é¡¹ç›®éƒ½æä¾›äº†Dockeré•œåƒæˆ–è€…Dockerfileï¼Œå¯¹äºåªæƒ³å°è¯•ä¸€ä¸‹çš„äººå‘˜æ¥è¯´ï¼Œå†ä¹Ÿä¸ç”¨è¿›è¡Œç¹ççš„å®‰è£…æ­¥éª¤äº†ï¼Œè€Œä¸”å¾€å¾€éƒ¨ç½²æˆåŠŸåï¼Œå‘ç°å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚</p><p><strong>é¢å‘å¼€å‘</strong></p><p>ç®€åŒ–äº†å¼€å‘ç¯å¢ƒé…ç½®ã€‚å…¬å¸æ¯æ¬¡æœ‰å¼€å‘å…¥èŒï¼Œå½“å¤©é™¤äº†åŠæ‰‹ç»­å°±æ˜¯å‡†å¤‡å¼€å‘ç¯å¢ƒäº†ã€‚å¦‚æœä½¿ç”¨Dockerï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸åŒé¡¹ç›®ï¼Œæ„å»ºä¸åŒçš„Dockeré•œåƒã€‚å¼€å‘å…¥èŒåï¼Œå°±å¯ä»¥å¿«é€Ÿçš„è¿›å…¥å¼€å‘å·¥ä½œã€‚è€Œä¸”è¿™ä¸ªé•œåƒä¸€æ¬¡æ„å»ºï¼Œå¯ä»¥åœ¨å¼€å‘ã€æµ‹è¯•ã€é¢„ç”Ÿäº§ã€ç”Ÿäº§éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p><p><strong>é¢å‘æµ‹è¯•</strong></p><p>Dockerå®ç°äº†å¤šç‰ˆæœ¬æµ‹è¯•ã€‚ä¹‹å‰æˆ‘å…¬å¸æµ‹è¯•å›¢é˜Ÿï¼Œå¦‚æœæƒ³æµ‹è¯•ä¸€ä¸ªé¡¹ç›®çš„ä¸åŒåˆ†æ”¯ï¼Œç”±äºæµ‹è¯•ç¯å¢ƒçš„å±€é™æ€§å¤§å®¶è¦æ’é˜Ÿï¼Œä¸²è¡Œçš„è¿›è¡Œæµ‹è¯•ã€‚æµ‹è¯•äººå‘˜Aå†ä½¿ç”¨æŸä¸ªé¡¹ç›®çš„æµ‹è¯•ç¯å¢ƒæ—¶ï¼Œå…¶å®ƒäººè¦æ’é˜Ÿã€‚ç°åœ¨æ¯ä¸ªæµ‹è¯•äººå‘˜éƒ½å¯ä»¥åˆ›å»ºä¸åŒåˆ†æ”¯çš„Dockerå®¹å™¨ã€‚è®©æµ‹è¯•å›¢é˜Ÿå¯ä»¥å¹¶è¡Œæµ‹è¯•ã€‚</p><p><strong>é¢å‘è¿ç»´</strong></p><p>è§£å†³ç¯å¢ƒä¸€è‡´æ€§ã€å®ç°è¿è¡Œç¯å¢ƒå›æ»šã€‚æˆ‘ä»¬ä¹Ÿä¸éœ€è¦ä½¿ç”¨SaltStackè¿›è¡Œé…ç½®ç®¡ç†äº†ã€‚åšå¥½ä¸€ä¸ªDockeré•œåƒä¹‹åï¼Œå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§éƒ½ç”¨ä¸€å¥—è¿è¡Œç¯å¢ƒï¼Œåªæ˜¯ä¸Šé¢çš„ä»£ç ä¸åŒã€‚å½“ç„¶è¿™ä¸ªè™šæ‹Ÿæœºä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯ä¸å¤Ÿæ•æ·ã€‚è€Œä¸”åœ¨ç”Ÿäº§ä»£ç éƒ¨ç½²çš„æ—¶å€™ï¼Œä»¥Dockerå®¹å™¨ä¸ºå•ä½è¿›è¡Œå‘å¸ƒã€‚å¦‚æœè¦è¿›è¡Œå›æ»šï¼Œç›´æ¥æŠŠä¸Šä¸€ä¸ªç‰ˆæœ¬çš„Dockerå®¹å™¨å¯åŠ¨å³å¯ã€‚</p><p><strong>é¢å‘æ¶æ„</strong></p><p>SOAæœåŠ¡éƒ¨ç½²ã€å¾®æœåŠ¡éƒ¨ç½²ã€è‡ªåŠ¨åŒ–æ‰©å®¹ã€‚ä¹‹å‰æˆ‘ä»¬åšSOAã€å¾®æœåŠ¡çš„æ—¶å€™æœ€å¤šä»¥è™šæ‹Ÿæœºä¸ºå•ä½è¿›è¡Œç®¡ç†ã€‚ä½†æ˜¯ç°åœ¨å¯åŠ¨ä¸€ä¸ªDockerå®¹å™¨è¦è¿œè¿œå¿«é€Ÿå¯åŠ¨ä¸€ä¸ªKVMè™šæ‹Ÿæœºã€‚è€Œä¸”ä¸éœ€è¦å¤ªå¤æ‚çš„æ“ä½œæ­¥éª¤ï¼Œä½ å°±å¯ä»¥åœ¨ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ä¸Šå®‰è£…ä¸ŠDockerï¼Œå¹¶ä¸‹è½½é•œåƒï¼Œå¯åŠ¨å®¹å™¨ã€‚</p><h2 id="dockeréƒ¨ç½²" tabindex="-1">Dockeréƒ¨ç½² <a aria-current="page" href="#dockeréƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ç›®å‰Dockerä»…æ”¯æŒLinuxå’ŒUnixç¯å¢ƒï¼Œåœ¨Windows Server 2016ç‰ˆæœ¬æ”¯æŒWindowså®¹å™¨ã€‚</p><h3 id="docker-for-centosï¼š" tabindex="-1">Docker for CentOSï¼š <a aria-current="page" href="#docker-for-centosï¼š" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨å®˜æ–¹yumä»“åº“</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y yum-utils</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿ç”¨å›½å†…Yumæº</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /etc/yum.repos.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 yum.repos.d]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç¬¬äºŒæ­¥ï¼šDockerå®‰è£…ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y docker-ce</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨åå°è¿›ç¨‹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start docker</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 yum.repos.d]# docker --version</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Docker version 18.09.2, build 6247962</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="docker-for-windows" tabindex="-1">Docker for windows: <a aria-current="page" href="#docker-for-windows" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç¬¬ä¸€æ­¥ï¼šä¸‹è½½boot2dockerï¼š<a href="https://github.com/boot2docker/windows-installer/releases/latest" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://github.com/boot2docker/windows-installer/releases/latest<!--]--></a></p><p>ç¬¬äºŒæ­¥ï¼šè¿è¡Œå®‰è£…ç¨‹åºï¼Œ</p><p><img src="http://k8s.unixhot.com/docker/media/ee82a72fe806ac1ae99ab7fa0aac210c.png" alt="img"></p><p>é€‰æ‹©éœ€è¦å®‰è£…çš„ç»„ä»¶ï¼Œå¦‚æœåˆæ¬¡å®‰è£…è¯·é€‰æ‹©Full installationã€‚</p><p><img src="http://k8s.unixhot.com/docker/media/920a1b8c46b133f431f0255197ddb3f8.png" alt="img"></p><p><img src="http://k8s.unixhot.com/docker/media/bbe62c1244b68a92383658af3a72b3a0.png" alt="img"></p><p>å®‰è£…å®Œæ¯•ï¼Œæ‰“å¼€Dockerï¼Œé»˜è®¤ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¼šåˆ›å»ºä¸€ä¸ªvirtualboxçš„è™šæ‹Ÿæœºã€‚</p><h3 id="docker-hub" tabindex="-1">Docker Hub <a aria-current="page" href="#docker-hub" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Dockerä¹‹æ‰€ä»¥èƒ½è¿™ä¹ˆå¿«çš„ç«èµ·æ¥ï¼Œå’ŒDocker Hubçš„ä½œç”¨æ˜¯åˆ†ä¸å¼€çš„ã€‚Dockeræ„å»ºäº†åƒGitHubä¸€æ ·çš„ä»“åº“ï¼Œç”¨æ¥å­˜æ”¾å¤§å®¶æ„å»ºå¥½çš„Dockeré•œåƒï¼Œå…¶ä¸­å·²ç»åŒ…æ‹¬äº†è¶…è¿‡15,000çš„é•œåƒã€‚å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œéƒ½å¯ä»¥é€šè¿‡åœ¨ Docker Hub ä¸­ç›´æ¥ä¸‹è½½é•œåƒæ¥å®ç°ã€‚</p><p><strong>æœç´¢é•œåƒ</strong></p><p>æœç´¢ï¼Œä½ æ‡‚çš„ï¼Œæƒ³å¯»æ‰¾ä½ éœ€è¦çš„Dockeré•œåƒï¼Œå…ˆæœç´¢å§ï¼Œå› ä¸ºå¯èƒ½å·²ç»æœ‰äººåšå¥½äº†ï¼Œåˆå¹¶é‡å¤é€ è½®å­å‘¢ï¼Œå°¤å…¶æ˜¯å¾ˆå¤šæ˜¯å®˜æ–¹æä¾›çš„ï¼Œå¯ä»¥éå¸¸æ”¾å¿ƒçš„ä½¿ç”¨ã€‚</p><p><img src="http://k8s.unixhot.com/docker/media/bd38bd717fa1a2f84aa5f62a965a7ecd.png" alt="img"></p><p>è¾“å‡ºä¾æ¬¡ä¸ºé•œåƒåå­—ã€æè¿°ã€æ˜Ÿçº§ï¼ˆè¡¨ç¤ºè¯¥é•œåƒçš„å—æ¬¢è¿ç¨‹åº¦ï¼‰ã€æ˜¯å¦å®˜æ–¹åˆ›å»ºã€æ˜¯å¦è‡ªåŠ¨åˆ›å»ºã€‚OFFICIALä¸ºOKçš„å°±æ˜¯å®˜æ–¹é•œåƒã€‚</p><p>æœ¬ç« å¿«é€Ÿçš„å¸¦é¢†è¯»è€…ä½¿ç”¨ä¸ŠDockerï¼Œäº†è§£Dockerçš„åŸºæœ¬æ“ä½œå’Œç®¡ç†å·¥ä½œã€‚è®°ä½ï¼Œå”¯æœ‰å®è·µæ‰ä¼šæŒæ¡ã€‚</p><h2 id="dockeré•œåƒç®¡ç†" tabindex="-1">Dockeré•œåƒç®¡ç† <a aria-current="page" href="#dockeré•œåƒç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>é•œåƒæ˜¯Dockerå®¹å™¨çš„åŸºç¡€ï¼Œæƒ³è¿è¡Œä¸€ä¸ªDockerå®¹å™¨å°±éœ€è¦æœ‰é•œåƒã€‚æˆ‘ä»¬ä¸Šé¢å·²ç»å­¦ä¼šäº†ä½¿ç”¨searchæœç´¢é•œåƒã€‚é‚£ä¹ˆè¿™ä¸ªé•œåƒæ˜¯æ€ä¹ˆåˆ›å»ºçš„å‘¢ï¼Ÿ</p><h3 id="åˆ›å»ºé•œåƒ" tabindex="-1">åˆ›å»ºé•œåƒ <a aria-current="page" href="#åˆ›å»ºé•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é•œåƒçš„åˆ›å»ºæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><p>**ä½¿ç”¨ISOé•œåƒï¼š**å›é¡¾ä¸‹OpenStackï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œé¦–å…ˆä½¿ç”¨isoå®‰è£…å®šåˆ¶äº†é•œåƒä¸Šä¼ åˆ°Glanceä¸Šé¢ï¼Œå¯¹äºDockeræ¥è¯´ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨ISOé•œåƒæ¥åˆ¶ä½œåŸºæœ¬é•œåƒã€‚</p><p>**ä½¿ç”¨å·¥å…·åˆ¶ä½œé•œåƒï¼š**ä¸åŒçš„æ“ä½œç³»ç»Ÿéƒ½æä¾›äº†ç›¸åº”çš„å·¥å…·æ¥è®©ç”¨æˆ·åˆ›å»ºDockeré•œåƒï¼Œæ¯”å¦‚Centoså¯ä»¥ä½¿ç”¨febootstrapã€‚debian/ubuntuä½¿ç”¨debootstrapã€‚</p><p>**åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥ï¼š**Dockeræ”¯æŒä»ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ¨¡æ¿æ–‡ä»¶å¯¼å…¥ä¸€ä¸ªé•œåƒã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ä¸€äº›å…¬å…±çš„åŸºç¡€é•œåƒï¼Œç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†æ ¹æ®è‡ªèº«éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚æ¯”å¦‚åé¢è¦è®²åˆ°çš„Docker Fileçš„æ–¹å¼ï¼Œæ¥åˆ›å»ºé•œåƒã€‚</p><h3 id="è·å–é•œåƒ" tabindex="-1">è·å–é•œåƒ <a aria-current="page" href="#è·å–é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æ—¢ç„¶æœ‰äº†Docker Hubï¼Œæˆ‘ä»¬å°±ä¸è¦é‡å¤é€ è½®å­äº†ï¼Œç›´æ¥ä¸‹è½½ä¸€ä¸ªå®˜æ–¹æä¾›çš„centosé•œåƒå§ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull centos</span></span>
<span class="line"><span style="color:#a6accd">Using default tag: latest</span></span>
<span class="line"><span style="color:#a6accd">latest: Pulling from library/centos</span></span>
<span class="line"><span style="color:#a6accd">a02a4930cb5d: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">Digest: sha256:184e5f35598e333bfa7de10d8fb1cebb5ee4df5bc0f970bf2b1e7c7345136426</span></span>
<span class="line"><span style="color:#a6accd">Status: Downloaded newer image for centos:latest</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Dockeré•œåƒæ–‡ä»¶æ˜¯æœ‰è‹¥å¹²å±‚ç»„æˆçš„ï¼Œè¡Œé¦–çš„åç§°å°±æ˜¯å„å±‚çš„IDã€‚è¿™å°±æ˜¯Dockeré•œåƒçš„ä¸€ä¸ªç‰¹ç‚¹ã€‚å…¶å®åˆ†å±‚è®¾è®¡æ˜¯å¾ˆå¤šè®¾è®¡çš„æœ€ä½³å®è·µä¹‹ä¸€ã€‚ç”±äºç½‘ç»œåŸå› ï¼Œå›½å†…ç”¨æˆ·å¯èƒ½éœ€è¦ç­‰å¾…å¾ˆä¹…ã€‚å¦‚æœä¸‹è½½ä¸­æ–­å¯ä»¥å†æ¬¡æ‰§è¡Œdocker pull centosã€‚</p><p>é•œåƒå¯ä»¥æœ‰ä¸åŒçš„æ ‡ç­¾ï¼Œä¾‹å¦‚v1.0ã€v1.1è¿™æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä¸å†centosåé¢å¢åŠ ä»»ä½•çš„æ ‡ç­¾ä¼šä¸‹è½½æ ‡ç­¾ä¸ºlatestçš„é•œåƒï¼Œä¹Ÿå°±æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸”é»˜è®¤æ˜¯ä»docker hubä¸Šè¿›è¡Œä¸‹è½½ã€‚</p><h3 id="æŸ¥çœ‹é•œåƒ" tabindex="-1">æŸ¥çœ‹é•œåƒ <a aria-current="page" href="#æŸ¥çœ‹é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä½¿ç”¨docker imageså¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­éƒ½æœ‰å“ªäº›é•œåƒã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images</span></span>
<span class="line"><span style="color:#a6accd">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#a6accd">centos latest 1e1148e4cc2c 2 months ago 202MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿ç”¨docker imageså¯ä»¥åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šå·²ç»å­˜åœ¨çš„é•œåƒï¼Œæ¯ä¸ªé•œåƒéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„é•œåƒIDï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹å‡ ä¸ªæ ç›®ï¼š</p><ul><li>REPOSITORYï¼šé•œåƒæ¥è‡ªäºå“ªä¸ªä»“åº“</li><li>TAGï¼šé•œåƒçš„æ ‡ç­¾ã€‚ç”¨æ¥æ ‡è®°é•œåƒçš„ä¸åŒç‰ˆæœ¬ç­‰ã€‚</li><li>IMAGE IDï¼šé•œåƒçš„å”¯ä¸€IDã€‚</li><li>CREATEDï¼šé•œåƒåˆ›å»ºæ—¶é—´ã€‚</li><li>VIRTUAL SIZEï¼šé•œåƒçš„å¤§å°ã€‚</li></ul><h3 id="é•œåƒçš„å¯¼å…¥å¯¼å‡º" tabindex="-1">é•œåƒçš„å¯¼å…¥å¯¼å‡º <a aria-current="page" href="#é•œåƒçš„å¯¼å…¥å¯¼å‡º" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å¦‚æœä½ æƒ³æŠŠè‡ªå·±çš„é•œåƒä¼ ç»™åˆ«äººæ€ä¹ˆåŠï¼ŒDockeræä¾›äº†å¯¼å…¥å’Œå¯¼å‡ºçš„å‘½ä»¤ï¼š</p><p><strong>å¯¼å‡ºé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker save -o centos.tar centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>å¯¼å…¥é•œåƒ</strong></p><p>å°†å¯¼å‡ºçš„é•œåƒscpåˆ°å¦å¤–çš„ä¸€å°æœºå™¨ä¸Šååšå¯¼å…¥ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# docker load --input centos.tar</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ–è€…ä½¿ç”¨é‡å®šå‘è¿›è¡Œå¯¼å…¥</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# docker load &lt; centos.tar</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Dockeré•œåƒè¿™ç§å¯¼å…¥å’Œå¯¼å‡ºæ˜¯å®Œæ•´ï¼Œå¯ä»¥çœ‹åˆ°é•œåƒIDç­‰éƒ½æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# docker images</span></span>
<span class="line"><span style="color:#a6accd">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#a6accd">centos latest 1e1148e4cc2c 2 months ago 202MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="åˆ é™¤é•œåƒ" tabindex="-1">åˆ é™¤é•œåƒ <a aria-current="page" href="#åˆ é™¤é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä½¿ç”¨docker rmiå‘½ä»¤å¯ä»¥åˆ é™¤æœ¬åœ°çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨é•œåƒçš„æ ‡ç­¾æˆ–è€…é•œåƒçš„IDã€‚ä»–ä»¬ä¸¤è€…ä¹‹é—´æ˜¯ä¸åŒçš„ã€‚</p><p>docker rmi æ ‡ç­¾ï¼šä¼šåˆ é™¤æŒ‡å®šæ ‡ç­¾çš„é•œåƒï¼Œä½†æ˜¯é•œåƒæœ¬èº«ä¸ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºä¸€ä¸ªé•œåƒå¯¹è±¡å¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œå°±åƒLinuxæ–‡ä»¶çš„ç¡¬é“¾æ¥ï¼Œå½“é•œåƒåªå‰©ä¸‹ä¸€ä¸ªæ ‡ç­¾çš„æ—¶å€™ï¼Œä½¿ç”¨æ ‡ç­¾åˆ é™¤é•œåƒï¼Œæ‰ä¼šåˆ é™¤é•œåƒæœ¬èº«ã€‚</p><p>docker rmi IDï¼šä½¿ç”¨é•œåƒçš„IDåˆ é™¤é•œåƒï¼Œä¼šå…ˆåˆ é™¤è¯¥é•œåƒçš„æ‰€æœ‰æ ‡ç­¾ï¼Œç„¶åå†åˆ é™¤é•œåƒæ–‡ä»¶æœ¬èº«ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœé•œåƒåˆ›å»ºçš„å®¹å™¨å­˜åœ¨æ—¶ï¼Œé•œåƒæ˜¯æ— æ³•è¢«åˆ é™¤çš„ã€‚ä¸è¿‡ä½ å¯ä»¥ä½¿ç”¨-fçš„å‚æ•°å¼ºåˆ¶åˆ é™¤é•œåƒï¼Œå¹¶ä¸å»ºè®®è¿™ä¹ˆåšã€‚</p><p>çœ‹èµ·æ¥Dockerçš„é•œåƒæ“ä½œæ˜¯æ¯”è™šæ‹Ÿæœºè¦ä¾¿æ·çš„å¤šï¼Œç›®å‰æ¥è¯´ä½¿ç”¨å‡ ä¸ªç®€å•çš„å‘½ä»¤ï¼Œå°±å¯ä»¥å®Œæˆé•œåƒçš„ç®¡ç†å·¥ä½œï¼Œä¸è¿‡è¿™è¿˜åªæ˜¯åŸºç¡€ã€‚</p><h2 id="dockerå®¹å™¨ç®¡ç†" tabindex="-1">Dockerå®¹å™¨ç®¡ç† <a aria-current="page" href="#dockerå®¹å™¨ç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Dockerå®¹å™¨ç›¸å¯¹äºOpenStackçš„äº‘ä¸»æœºå®ä¾‹ï¼Œè™½ç„¶ä»–ä»¬æœ¬è´¨ä¸Šä¸åŒã€‚æˆ‘ä»¬éœ€è¦åŸºäºé•œåƒæ¥åˆ›å»ºå®¹å™¨ã€‚å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬çš„è¿è¡Œç¯å¢ƒã€‚å¯¹åº”çš„ï¼Œè™šæ‹Ÿæœºå¯ä»¥ç†è§£ä¸ºæ¨¡æ‹Ÿè¿è¡Œçš„ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿå’Œè·‘åœ¨ä¸Šé¢çš„åº”ç”¨ã€‚</p><h3 id="å¯åŠ¨å®¹å™¨" tabindex="-1">å¯åŠ¨å®¹å™¨ <a aria-current="page" href="#å¯åŠ¨å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å¯åŠ¨å®¹å™¨å…¶å®å°±æ˜¯åˆ›å»ºé•œåƒå¹¶å¯åŠ¨ï¼Œå¯åŠ¨é•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å°†å·²ç»å­˜åœ¨ï¼Œä½†æ˜¯æ˜¯stoppedçŠ¶æ€çš„é•œåƒå¯åŠ¨ï¼Œä¸€ç§å°±æ˜¯åŸºäºä¸€ä¸ªé•œåƒæ–°å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶å¯åŠ¨ã€‚</p><p><strong>æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨</strong></p><p>è®©æˆ‘ä»¬å…ˆè€ç”Ÿå¸¸è°ˆï¼Œè¾“å‡ºä¸€ä¸ªHello Worldå§ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run centos /bin/echo 'Hello world'</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Hello world</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¾ˆç¥å¥‡ï¼Œå¯ä»¥åœ¨ç²¾é€šå„ç§è¯­è¨€çš„Hello Worldè®¡æ•°å™¨+1äº†ï¼Œè¿™ä¸ªå’Œä½ åœ¨æœ¬åœ°ç³»ç»Ÿè¿è¡Œ/bin/echo â€˜Hello worldâ€™ å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯å®ƒæ˜¯Dockerå®¹å™¨è¾“å‡ºçš„ï¼Œè€Œä¸”è¾“å‡ºåï¼Œå®ƒå°±å®Œæˆä½¿å‘½ï¼Œè‡ªåŠ¨é€€å‡ºäº†ã€‚</p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œå°±æ˜¯æˆ‘ä»¬å­¦ä¹ Dockerè¦é¢ä¸´çš„ç¬¬ä¸€ä¸ªç–‘æƒ‘ï¼Œå°±æ˜¯å®¹å™¨åªä¼šåœ¨å‰å°è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä»»åŠ¡ç»“æŸï¼Œå®¹å™¨å°±ç»ˆæ­¢äº†ã€‚</p></blockquote><p>ä½¿ç”¨docker ps â€“aå¯ä»¥æŸ¥çœ‹å½“å‰å¯åŠ¨çš„å®¹å™¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -a</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">789de67bb454 centos "/bin/echo 'Hello wor" 30 seconds ago Exited (0) 29 seconds</span></span>
<span class="line"><span style="color:#a6accd">ago pedantic_kare</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆšæ¥è§¦Dockeråˆ°è¿™é‡Œè¿˜ä¼šæœ‰ç¬¬äºŒä¸ªç–‘æƒ‘ï¼š</p><p>Dockerè‡ªåŠ¨å¸®ä½ ç”Ÿæˆäº†ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚æœ¬ä¾‹ä¸­æ˜¯pedantic_kareã€‚</p><p>å¾ˆå›°æƒ‘ï¼Ÿå¥½å§ï¼Œè®©æˆ‘ä»¬æ¥å¯åŠ¨ä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰åç§°ï¼ŒåŒæ—¶å¯ä»¥æœ‰ç»ˆç«¯çš„å®¹å™¨ï¼Œå°±åƒå¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸è¿‡åªæ˜¯åƒè€Œå·²ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šå®Œå…¨ä¸åŒã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --name mydocker -t -i centos /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]#</span></span>
<span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]# ls /</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">anaconda-post.log bin dev etc home lib lib64 lost+found media mnt opt proc root</span></span>
<span class="line"><span style="color:#a6accd">run sbin srv sys tmp usr var</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªé€‰é¡¹ï¼Œ-t é€‰é¡¹è®©Dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Šï¼Œ -i åˆ™è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ã€‚</p><p>åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰€åˆ›å»ºçš„ç»ˆç«¯æ¥è¾“å…¥å‘½ä»¤ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼Œåªæœ‰/bin/bashå’Œä½ è¿è¡Œçš„å‘½ä»¤ï¼Œæ³¨æ„çœ‹/bin/bashçš„PIDä¸º1ï¼Œæœ‰æ„æ€ã€‚å…ˆè®°ç€è¿™ä¸ªç‰¹æ®Šçš„åœ°æ–¹ï¼Œéšç€æˆ‘ä»¬æ·±å…¥å­¦ä¹ ï¼Œå†å›è¿‡å¤´æ¥ç ”ç©¶å®ƒã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.1 0.1 11776 1872 ? Ss 15:30 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 18 0.0 0.0 47424 1660 ? R+ 15:31 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å½“åˆ©ç”¨ docker run æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬å…±ä»“åº“ä¸‹è½½ï¼›</li><li>åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼›</li><li>åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚ï¼›</li><li>ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»ï¼›</li><li>ä»åœ°å€æ± é…ç½®ä¸€ä¸ªipåœ°å€ç»™å®¹å™¨ï¼›</li><li>æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åºï¼›</li><li>æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢ã€‚</li></ul><p>è®©æˆ‘ä»¬è¾“å…¥exitæ¥é€€å‡ºè¿™ä¸ªå®¹å™¨ï¼Œé€€å‡ºåï¼Œå®¹å™¨ä¼šè‡ªåŠ¨ç»ˆæ­¢è¿è¡Œã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¯·å‚è€ƒæˆ‘ä»¬ç¬¬ä¸€ä¸ªç–‘æƒ‘ï¼ŒDockerå®¹å™¨åœ¨å‰å°è¿è¡Œä¸€ä¸ªå•ä»»åŠ¡ï¼Œä»»åŠ¡ç»“æŸï¼Œå®¹å™¨å°±ç»ˆæ­¢ã€‚è¿™å°±æ˜¯Dockerå®¹å™¨çš„ç‰¹æ€§ï¼åŒæ—¶ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸€ä¸ªå°ç»†èŠ‚ï¼Œé»˜è®¤dockerå®¹å™¨çš„ä¸»æœºåå°±æ˜¯CONTAINER IDã€‚</p><p><strong>è®©å®¹å™¨å®¹å™¨åå°è¿è¡Œ</strong></p><p>åœ¨ä½¿ç”¨docker runè¿è¡Œå®¹å™¨æ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å®¹å™¨åœ¨åå°è¿è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯ä»¥å®ˆæŠ¤æ€å½¢å¼è¿è¡Œã€‚å¯ä»¥é€šè¿‡-då‚æ•°æ¥å®ç°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name mydocker2 centos /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">38e42accfa2226bb6c7da2e28e12dc95f6b6d6717326442131887a24bb321cdd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å®¹å™¨å¯åŠ¨åå°±ä¼šåœ¨åå°è¿è¡Œï¼Œç„¶åè¿”å›ä¸€ä¸ªå®¹å™¨IDåˆ°æ§åˆ¶å°ï¼Œè€Œä¸”ä¸Šé¢è¿™ä¸ªå®¹å™¨ä¹Ÿç»ˆæ­¢äº†ï¼Œå¸¦ç€é—®é¢˜ç»§ç»­å‰è¿›ã€‚</p><h3 id="ç»ˆæ­¢å®¹å™¨" tabindex="-1">ç»ˆæ­¢å®¹å™¨ <a aria-current="page" href="#ç»ˆæ­¢å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨å‰é¢çš„è¾“å‡ºHello Worldçš„æ“ä½œä¸­æˆ‘ä»¬çœ‹åˆ°äº†ï¼Œå½“Dockerå®¹å™¨ä¸­æŒ‡å®šçš„åº”ç”¨ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œå®¹å™¨ä¹Ÿå°±è‡ªåŠ¨ç»ˆæ­¢äº†ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨exitå‘½ä»¤é€€å‡ºè¿è¡Œ/bin/bashçš„ç»ˆç«¯ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Ctrl+dæ¥å®ç°åŒæ ·çš„æ•ˆæœã€‚</p><p>ä½¿ç”¨docker stopæ¥åœæ­¢ä¸€ä¸ªå®¹å™¨ï¼Œé»˜è®¤æ˜¯å…ˆç»™å®¹å™¨å‘é€SIGTERMä¿¡å·ï¼Œç„¶å10ç§’åå‘ç”ŸSIGKILLä¿¡å·ç»ˆæ­¢å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨-tæˆ–è€…â€”timeæ¥è®¾ç½®ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</p><p>docker stop å®¹å™¨åç§°ã€å®¹å™¨ID</p><p>å¯¹äºç»ˆæ­¢çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨docker startæ¥å¯åŠ¨ï¼Œæˆ–è€…ä½¿ç”¨docker restartæ¥é‡å¯ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@bc419cd0b8fa /]# exit</span></span>
<span class="line"><span style="color:#a6accd">Exit</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨docker ps â€“aæ¥æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ï¼Œå‘ç°å·²ç»æ˜¯åœæ­¢æ¨¡å¼ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -a</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">38e42accfa22 centos "/bin/bash" 17 seconds ago Exited (0) 16 seconds ago</span></span>
<span class="line"><span style="color:#a6accd">mydocker2</span></span>
<span class="line"><span style="color:#a6accd">a5ef57e8783f centos "/bin/bash" 3 minutes ago Exited (0) About a minute ago</span></span>
<span class="line"><span style="color:#a6accd">mydocker</span></span>
<span class="line"><span style="color:#a6accd">d132d6e645ad centos "/bin/echo 'Hello woâ€¦" 3 minutes ago Exited (0) 3 minutes</span></span>
<span class="line"><span style="color:#a6accd">ago serene_dijkstra</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨</strong></p><p>å¯ä»¥ä½¿ç”¨docker startæ¥å¼€å¯å·²ç»ç»ˆæ­¢çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥å®¹å™¨çš„CONTAINER IDï¼Œæˆ–è€…NAMESæ¥è¿›è¡Œå¯åŠ¨ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker start mydocker</span></span>
<span class="line"><span style="color:#a6accd">mydocker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¥½çš„ï¼Œæˆ‘ä»¬åˆä¸€æ¬¡å¯åŠ¨äº†è¿è¡Œ/bin/bashçš„å®¹å™¨ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆè¿›å»å‘¢ã€‚</p><h3 id="è¿›å…¥å®¹å™¨" tabindex="-1">è¿›å…¥å®¹å™¨ <a aria-current="page" href="#è¿›å…¥å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>Docker attach</strong></p><p>Dockeræä¾›äº†docker attachçš„å‘½ä»¤ï¼Œç”¨æ¥è®©æˆ‘ä»¬è¿›å…¥å·²ç»å¯åŠ¨çš„å®¹å™¨ï¼ˆå¦‚æœå®¹å™¨å·²ç»ç»ˆæ­¢ï¼Œä½ éœ€è¦ä½¿ç”¨docker startå°†å®ƒå¯åŠ¨ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker attach mydocker</span></span>
<span class="line"><span style="color:#a6accd">[root@a5ef57e8783f /]#</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½ å¯ä»¥ç»§ç»­æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œæ²¡é”™ï¼Œå¾ˆå¤šå‘½ä»¤éƒ½æ²¡æœ‰ã€‚</p><p>æ³¨æ„ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨ attach è¿›å…¥å®¹å™¨çš„æ—¶å€™ï¼Œå¦‚æœåŒæ—¶æœ‰å¤šä¸ªçª—å£ attach åˆ°åŒä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œæ‰€æœ‰çª—å£éƒ½ä¼šåŒæ­¥æ˜¾ç¤ºã€‚å½“æŸä¸ªçª—å£å› å‘½ä»¤é˜»å¡æ—¶,å…¶ä»–çª—å£ä¹Ÿæ— æ³•æ‰§è¡Œæ“ä½œäº†ã€‚è¿™å¯æ€ä¹ˆåŠï¼Œå¦‚æœæˆ‘ä»¬æ˜¯å›¢é˜Ÿä½œæˆ˜ï¼Œå¯èƒ½å¤šä¸ªåŒäº‹éœ€è¦åŒæ—¶è¿›å…¥å®¹å™¨æ“ä½œå‘¢?è¿˜æœ‰ä¸€ä¸ªæœ€å…³é”®çš„é—®é¢˜ã€‚ä½ è¾“å…¥exitä»¥åå‘¢ï¼Ÿä¹‹å‰è¿è¡Œçš„å®¹å™¨é€€å‡ºäº†ã€‚</p><p><strong>nsenterè¿›å…¥å®¹å™¨</strong></p><p>nsenterå‘½ä»¤è¢«åŒ…å«åœ¨util-linuxè½¯ä»¶åŒ…é‡Œé¢ï¼Œä½¿ç”¨nsenterå¯ä»¥è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„åå­—ç©ºé—´,å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆé»˜è®¤åŒ…å«äº†è¯¥è½¯ä»¶ï¼ŒCentOSé»˜è®¤æ˜¯æœ‰çš„ã€‚å¦‚æœä½ çš„ç³»ç»Ÿé‡Œé¢æ²¡æœ‰å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><blockquote><p><strong>Yumå®‰è£…ï¼š</strong></p></blockquote><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@docker ~]# yum install -y util-linux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸ºäº†è¿æ¥åˆ°å®¹å™¨ï¼Œä½ è¿˜éœ€è¦æ‰¾åˆ°å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„ PIDï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è·å–ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># docker inspect --format "{{ .State.Pid }}" &lt;container ID or NAMES&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é€šè¿‡è¿™ä¸ª PIDï¼Œå°±å¯ä»¥è¿æ¥åˆ°è¿™ä¸ªå®¹å™¨ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># nsenter --target $PID --mount --uts --ipc --net â€“pid</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœä½ åˆšæ‰åœæ­¢äº†å®¹å™¨ï¼Œè¯·å¯åŠ¨ã€‚</p><p>è¿æ¥æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# PID=$(docker inspect --format "{{ .State.Pid }}"</span></span>
<span class="line"><span style="color:#a6accd">mydocker)</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# echo $PID</span></span>
<span class="line"><span style="color:#a6accd">8029</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ³¨æ„å¦‚æœä½ çš„PIDå˜é‡ä¸º0ï¼Œè¯´æ˜mydockerå®¹å™¨æ²¡æœ‰å¯åŠ¨ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# nsenter --target $PID --mount --uts --ipc --net --pid</span></span>
<span class="line"><span style="color:#a6accd">[root@a5ef57e8783f /]# ps -ef</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">UID PID PPID C STIME TTY TIME CMD</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">root 1 0 0 21:11 pts/0 00:00:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">root 14 0 0 21:12 pts/0 00:00:00 -bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">root 27 14 0 21:12 pts/0 00:00:00 ps -ef</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ç¼–å†™ä¸€ä¸ªè„šæœ¬ç”¨æˆ·è¿›å…¥å®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim docker_in.sh</span></span>
<span class="line"><span style="color:#a6accd">#!/bin/bash</span></span>
<span class="line"><span style="color:#a6accd"># Use nsenter to access docker</span></span>
<span class="line"><span style="color:#a6accd">docker_in(){</span></span>
<span class="line"><span style="color:#a6accd">NAME_ID=$1</span></span>
<span class="line"><span style="color:#a6accd">PID=$(docker inspect --format "{{ .State.Pid }}" $NAME_ID)</span></span>
<span class="line"><span style="color:#a6accd">nsenter --target $PID --mount --uts --ipc --net --pid</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">docker_in $1</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chmod +x docker_in.sh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¹ˆåé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨docker_in.shè¿™ä¸ªè„šæœ¬æ¥è¿›å…¥Dockerå®¹å™¨ï¼Œåªè¦ä¼ ç»™å®ƒåç§°æˆ–è€…å®¹å™¨IDå³å¯ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh mydocker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ä¸è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤" tabindex="-1">ä¸è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤ <a aria-current="page" href="#ä¸è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æˆ–è®¸ä½ çš„æœ¬æ„ä¸æ˜¯æƒ³è¿›å»å®¹å™¨ï¼Œè€Œæ˜¯æƒ³è®©å®¹å™¨æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œdockeræä¾›äº†execï¼Œä½¿ç”¨execå¯ä»¥åœ¨å®¹å™¨å†…è¿è¡Œå‘½ä»¤ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker exec mydocker whoami</span></span>
<span class="line"><span style="color:#a6accd">root</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿ç”¨execè¿›å…¥å®¹å™¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker exec -it mydocker /bin/bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ³¨æ„ï¼Œç°åœ¨ä½ è¿›å…¥å®¹å™¨å’Œå…¶å®ƒæ–¹æ³•éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…¶å®æ˜¯ä½ æ‰§è¡Œäº†ä¸€ä¸ª/bin/bashçš„å‘½ä»¤ï¼Œæ‰€ä»¥ä½ ç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªshellï¼Œä½ ç°åœ¨æ‰€åœ¨çš„shellåº”è¯¥æ˜¯ä¸‹å›¾ä¸­PIDä¸º33çš„è¿›ç¨‹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@1b0cae722fa0 /]# ps -ef</span></span>
<span class="line"><span style="color:#a6accd">UID PID PPID C STIME TTY TIME CMD</span></span>
<span class="line"><span style="color:#a6accd">root 1 0 0 15:37 ? 00:00:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 33 0 0 15:41 ? 00:00:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 46 33 0 15:41 ? 00:00:00 ps -ef</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ–è®¸ä½ ä¹Ÿå‘ç°ä½¿ç”¨docker execã€nsenterè¿›å…¥å®¹å™¨åï¼Œæ‰§è¡Œexité€€å‡ºå®¹å™¨ï¼Œå®¹å™¨å¹¶ä¸ä¼šå…³é—­ã€‚ä½†æ˜¯ä½¿ç”¨docker attachè¿›å…¥å®¹å™¨ï¼Œè¾“å…¥exité€€å‡ºå®¹å™¨åï¼Œå®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚ä½ å¯ä»¥æƒ³æƒ³ä¸ºä»€ä¹ˆã€‚å› ä¸ºé™¤äº†attachï¼Œnsenterå’Œexecå®é™…ä¸­éƒ½æ˜¯å¼€äº†ä¸€ä¸ªæ–°çš„shellåœ¨æ‰§è¡Œã€‚è€Œattachæ˜¯ä½¿ç”¨å®¹å™¨æœ¬èº«å¯åŠ¨çš„/bin/bashï¼Œè¿™ä¸ªshellç¯å¢ƒé€€å‡ºäº†ã€‚é‚£ä¹ˆå®¹å™¨å°±è‡ªåŠ¨é€€å‡ºäº†ã€‚æ‰€ä»¥Dockerçš„é­”å’’æ¥äº†ï¼šdockerå®¹å™¨åªèƒ½è€Œä¸”å¿…é¡»åœ¨å‰å°è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœè¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å…³é—­ã€‚å½“ç„¶å¦‚æœä½ æƒ³åœ¨Dockerå®¹å™¨ä¸­å¯åŠ¨å¤šè¿›ç¨‹ä¹Ÿæ˜¯æœ‰åŠæ³•çš„ï¼Œæˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚</p><h3 id="åˆ é™¤å®¹å™¨" tabindex="-1">åˆ é™¤å®¹å™¨ <a aria-current="page" href="#åˆ é™¤å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å¯ä»¥ä½¿ç”¨ docker rm æ¥åˆ é™¤ä¸€ä¸ªå¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ ä¾‹å¦‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@docker ~]# docker rm mydocker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœè¦åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥æ·»åŠ -få‚æ•°ã€‚Dockerä¼šå‘é€ SIGKILLä¿¡å·ç»™å®¹å™¨ã€‚</p><h3 id="å­¦ä¹ ä¸­çš„å°æŠ€å·§" tabindex="-1">å­¦ä¹ ä¸­çš„å°æŠ€å·§ <a aria-current="page" href="#å­¦ä¹ ä¸­çš„å°æŠ€å·§" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å¦‚æœä½ åœ¨å­¦ä¹ å’Œæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸å› ä¸ºå¯åŠ¨éå¸¸å¤šçš„å®¹æ˜“æƒ³åˆ é™¤ä¹Ÿå¾ˆéš¾ï¼Œä¸‹é¢åˆ—ä¸¾äº†å‡ ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥å¿«é€Ÿçš„å¸®æˆ‘ä»¬è¿›è¡Œå®¹å™¨çš„æ¸…ç†ã€‚</p><h4 id="å®¹å™¨åœæ­¢åå°±è‡ªåŠ¨åˆ é™¤ï¼š" tabindex="-1">å®¹å™¨åœæ­¢åå°±è‡ªåŠ¨åˆ é™¤ï¼š <a aria-current="page" href="#å®¹å™¨åœæ­¢åå°±è‡ªåŠ¨åˆ é™¤ï¼š" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">docker run --rm centos /bin/echo "One"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="æ€æ­»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š" tabindex="-1">æ€æ­»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š <a aria-current="page" href="#æ€æ­»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">docker kill $(docker ps -a -q)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨ï¼š" tabindex="-1">åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨ï¼š <a aria-current="page" href="#åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨ï¼š" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">docker rm $(docker ps -a -q)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="åˆ é™¤æ‰€æœ‰æœªæ‰“-dangling-æ ‡ç­¾çš„é•œåƒ" tabindex="-1">åˆ é™¤æ‰€æœ‰æœªæ‰“ dangling æ ‡ç­¾çš„é•œåƒ <a aria-current="page" href="#åˆ é™¤æ‰€æœ‰æœªæ‰“-dangling-æ ‡ç­¾çš„é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">docker rmi $(docker images -q -f dangling=true)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="åˆ é™¤æ‰€æœ‰é•œåƒ" tabindex="-1">åˆ é™¤æ‰€æœ‰é•œåƒ <a aria-current="page" href="#åˆ é™¤æ‰€æœ‰é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">docker rmi $(docker images -q)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœä½ è§‰å¾—åç§°å¾ˆé•¿ï¼Œä¸å®¹æ˜“è®°ï¼Œè¿˜å¯ä»¥ä¸ºè¿™äº›å‘½ä»¤åˆ›å»ºåˆ«åã€‚</p><h4 id="æ€æ­»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨" tabindex="-1">æ€æ­»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨. <a aria-current="page" href="#æ€æ­»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">alias dockerkill='docker kill $(docker ps -a -q)'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨" tabindex="-1">åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨. <a aria-current="page" href="#åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">alias dockerclean='docker rm $(docker ps -a -q)'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="åˆ é™¤æ‰€æœ‰æœªæ‰“æ ‡ç­¾çš„é•œåƒ" tabindex="-1">åˆ é™¤æ‰€æœ‰æœªæ‰“æ ‡ç­¾çš„é•œåƒ. <a aria-current="page" href="#åˆ é™¤æ‰€æœ‰æœªæ‰“æ ‡ç­¾çš„é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">alias dockercleani='docker rmi $(docker images -q -f dangling=true)'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h4 id="åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨å’Œæœªæ‰“æ ‡ç­¾çš„é•œåƒ" tabindex="-1">åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨å’Œæœªæ‰“æ ‡ç­¾çš„é•œåƒ. <a aria-current="page" href="#åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨å’Œæœªæ‰“æ ‡ç­¾çš„é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h4><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">alias dockerclean='dockercleanc || true &amp;&amp; dockercleani'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒä¸€å®šè¦æ…ç”¨ï¼ï¼ï¼</p></blockquote><h2 id="dockerç½‘ç»œè®¿é—®" tabindex="-1">Dockerç½‘ç»œè®¿é—® <a aria-current="page" href="#dockerç½‘ç»œè®¿é—®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»å¯ä»¥ç†Ÿç»ƒçš„ä½¿ç”¨dockerå‘½ä»¤æ“ä½œé•œåƒå’Œå®¹å™¨ï¼Œå¹¶å­¦ä¼šäº†å¦‚ä½•è¿›å…¥åˆ°å®¹å™¨ä¸­å»ï¼Œé‚£ä¹ˆå®é™…çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯åœ¨Dockerä¸­éƒ¨ç½²æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤–éƒ¨é€šè¿‡IPå’Œç«¯å£è¿›è¡Œè®¿é—®çš„ï¼Œé‚£ä¹ˆå¦‚ä½•è®¿é—®åˆ°Dockerçš„å†…éƒ¨æœåŠ¡å‘¢ï¼Ÿ</p><p>åœ¨åé¢æˆ‘ä»¬ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚æ¥è®²è§£Dockerçš„ç½‘ç»œé…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå­¦ä¹ ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„é€šè¿‡ç½‘ç»œè®¿é—®å®¹å™¨çš„æ–¹æ³•ï¼Œå°±æ˜¯ç«¯å£æ˜ å°„ã€‚</p><p>å®¹å™¨ä¸­å¯ä»¥è¿è¡Œä¸€äº›ç½‘ç»œåº”ç”¨ï¼Œè¦è®©å¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®è¿™äº›åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ -P æˆ– -p å‚æ•°æ¥æŒ‡å®šç«¯å£æ˜ å°„ã€‚</p><h3 id="éšæœºæ˜ å°„" tabindex="-1">éšæœºæ˜ å°„ <a aria-current="page" href="#éšæœºæ˜ å°„" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å½“ä½¿ç”¨ -P æ ‡è®°æ—¶ï¼ŒDocker ä¼šéšæœºæ˜ å°„ä¸€ä¸ª 49000~49900 çš„ç«¯å£åˆ°å†…éƒ¨å®¹å™¨å¼€æ”¾çš„ç½‘ç»œç«¯å£ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ªnginxçš„å®¹å™¨ä¸ºä¾‹å­æ¥æµ‹è¯•ä¸€ä¸‹-Pçš„åŠŸèƒ½ï¼Œå¤§å®¶å¯ä»¥ä½¿ç”¨searchæœç´¢ä¸‹nginxé•œåƒï¼Œæˆ‘ä»¬ä½¿ç”¨å®˜æ–¹çš„nginxé•œåƒæ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker search nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™æ¬¡æˆ‘ä»¬ä¸æ‰§è¡Œdocker pullã€‚ç›´æ¥æ¥å¯åŠ¨å®¹å™¨ï¼Œä½ ä¼šå‘ç°dockerä¼šå…ˆæŸ¥æ‰¾ä½ æœ¬åœ°æ˜¯å¦æœ‰è¯¥é•œåƒï¼Œå¦‚æœæ²¡æœ‰å®ƒä¼šè‡ªåŠ¨ä¸‹è½½åï¼Œç„¶åå¯åŠ¨å®¹å™¨ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -P nginx</span></span>
<span class="line"><span style="color:#a6accd">Unable to find image 'nginx:latest' locally</span></span>
<span class="line"><span style="color:#a6accd">latest: Pulling from library/nginx</span></span>
<span class="line"><span style="color:#a6accd">6ae821421a7d: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">da4474e5966c: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">eb2aec2b9c9f: Pull complete</span></span>
<span class="line"><span style="color:#a6accd">Digest: sha256:dd2d0ac3fff2f007d99e033b64854be0941e19a2ad51f174d9240dda20d9f534</span></span>
<span class="line"><span style="color:#a6accd">Status: Downloaded newer image for nginx:latest</span></span>
<span class="line"><span style="color:#a6accd">ecf14adb9dec09555ae31673753093e03941c41d917669dd1f254b51fdec7b51</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ‘ä»¬åˆå­¦ä¹ äº†ä¸€ä¸ªæ–°çš„å‚æ•°-då¯ä»¥è®©å®¹å™¨ç›´æ¥åœ¨åå°è¿è¡Œ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">6819734a680c nginx "nginx -g 'daemon off" About an hour ago Up About an hour</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:32769-&gt;80/tcp, 0.0.0.0:32768-&gt;443/tcp hungry_mayer</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œéšæœºæ˜ å°„äº†ä¸€ä¸ª32769ç«¯å£åˆ°å®¹å™¨çš„80ç«¯å£ã€‚ä¸‹é¢å°±å¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head http://192.168.56.11:32769/</span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.11.3</span></span>
<span class="line"><span style="color:#a6accd">Date: Fri, 02 Sep 2016 17:44:14 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Tue, 26 Jul 2016 14:54:48 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "579779b8-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åŒæ ·çš„ï¼Œå¯ä»¥é€šè¿‡ docker logs å‘½ä»¤æ¥æŸ¥çœ‹åº”ç”¨çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker logs hungry_mayer</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 - - [02/Sep/2016:17:44:01 +0000] "HEAD / HTTP/1.1" 200 0 "-"</span></span>
<span class="line"><span style="color:#a6accd">"curl/7.29.0" "-"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 - - [02/Sep/2016:17:44:06 +0000] "GET / HTTP/1.1" 200 612 "-"</span></span>
<span class="line"><span style="color:#a6accd">"curl/7.29.0" "-"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11 - - [02/Sep/2016:17:44:14 +0000] "HEAD / HTTP/1.1" 200 0 "-"</span></span>
<span class="line"><span style="color:#a6accd">"curl/7.29.0" "-"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ˜¯ä¸æ˜¯è€ä½¿ç”¨éšæœºçš„åå­—å’ŒIDæ“ä½œå®¹å™¨å¾ˆä¸æ–¹é¢ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å†åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œä¸€å®šè¦ç»™å®ƒå®šä¹‰ä¸€ä¸ªå¯è¯»çš„åå­—ã€‚</p><h3 id="æŒ‡å®šç«¯å£æ˜ å°„" tabindex="-1">æŒ‡å®šç«¯å£æ˜ å°„ <a aria-current="page" href="#æŒ‡å®šç«¯å£æ˜ å°„" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>-pï¼ˆå°å†™çš„ï¼‰åˆ™å¯ä»¥æŒ‡å®šè¦æ˜ å°„çš„ç«¯å£ï¼Œå¹¶ä¸”ï¼Œåœ¨ä¸€ä¸ªæŒ‡å®šç«¯å£ä¸Šåªå¯ä»¥ç»‘å®šä¸€ä¸ªå®¹å™¨ã€‚æ”¯æŒçš„æ ¼å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>hostPort:containerPortã€‚</li><li>ip:hostPort:containerPort</li><li>ip::containerPort</li></ul><p><strong>æ˜ å°„æ‰€æœ‰IPåœ°å€çš„æŒ‡å®šç«¯å£</strong></p><p>ä½¿ç”¨ hostPort:containerPortï¼Œå°†æœ¬åœ°çš„ 80 ç«¯å£æ˜ å°„åˆ°Nginxå®¹å™¨çš„ 80 ç«¯å£</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 80:80 --name nginx-demo1 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ­¤æ—¶é»˜è®¤ä¼šç»‘å®šæœ¬åœ°æ‰€æœ‰æ¥å£ä¸Šçš„æ‰€æœ‰åœ°å€ã€‚æ³¨æ„é•œåƒåç§°éœ€è¦æ”¾åˆ°æœ€åã€‚</p><p><strong>æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„æŒ‡å®šç«¯å£</strong></p><p>å¦‚æœä½ å®¿ä¸»æœºæ‹¥æœ‰å¤šä¸ªIPåœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ ip:hostPort:containerPort æ ¼å¼æŒ‡å®šæ˜ å°„ä½¿ç”¨ä¸€ä¸ªç‰¹å®šåœ°å€ï¼Œæ¯”å¦‚å°†Nginxçš„80ç«¯å£ç»‘å®šåˆ°æœ¬åœ°IPåœ°å€çš„81ç«¯å£ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 192.168.56.11:81:80 --name nginx-demo2</span></span>
<span class="line"><span style="color:#a6accd">nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„ä»»æ„ç«¯å£</strong></p><p>ä½¿ç”¨ ip::containerPort ç»‘å®šNginx80ç«¯å£åˆ°æœ¬åœ°192.168.56.11çš„ä»»æ„ç«¯å£ï¼Œæœ¬åœ°ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 192.168.56.11::80 --name nginx-demo3 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ä½¿ç”¨ udp æ ‡è®°æ¥æŒ‡å®š udp ç«¯å£</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 192.168.56.11:53:53/udp â€“name dns-udp</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ç»‘å®šå¤šä¸ªç«¯å£</strong></p><p>å¦‚æœä½ æƒ³ç»‘å®šDockerå®¹å™¨é‡Œé¢çš„å¤šä¸ªç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¬¡ä½¿ç”¨-p æ ‡è®°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 80:80 -p 443:443 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹æ˜ å°„ç«¯å£é…ç½®</strong></p><p>ä½¿ç”¨ docker port æ¥æŸ¥çœ‹å½“å‰æ˜ å°„çš„ç«¯å£é…ç½®ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°ç»‘å®šçš„åœ°å€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker port nginx-demo1</span></span>
<span class="line"><span style="color:#a6accd">80/tcp -&gt; 0.0.0.0:80 </span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="dockeræ•°æ®ç®¡ç†" tabindex="-1">Dockeræ•°æ®ç®¡ç† <a aria-current="page" href="#dockeræ•°æ®ç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä¸ºäº†èƒ½å¤Ÿå­˜å‚¨æŒä¹…åŒ–æ•°æ®ä»¥åŠå…±äº«å®¹å™¨é—´çš„æ•°æ®ï¼ŒDockeræå‡ºäº†Volumeçš„æ¦‚å¿µã€‚è®©æˆ‘ä»¬é€šè¿‡ç±»ä¼¼mountçš„æ–¹å¼å°†å®¿ä¸»æœºçš„æ–‡ä»¶æˆ–è€…ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚</p><p>åœ¨å®¹å™¨ä¸­ç®¡ç†æ•°æ®ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ•°æ®å·ï¼ˆData volumesï¼‰</li><li>æ•°æ®å·å®¹å™¨ï¼ˆData volume containersï¼‰</li></ul><h3 id="æ•°æ®å·" tabindex="-1">æ•°æ®å· <a aria-current="page" href="#æ•°æ®å·" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>åˆ›å»ºä¸€ä¸ªæ•°æ®å·</strong></p><p>åœ¨ä½¿ç”¨docker runå‘½ä»¤çš„æ—¶å€™ï¼Œä½¿ç”¨-vé€‰é¡¹åˆ›å»ºä¸€ä¸ªæ•°æ®å·å¹¶æŒ‚è½½åˆ°å®¹å™¨é‡Œã€‚</p><p>ä¸‹é¢åˆ›å»ºä¸€ä¸ªæµ‹è¯•å®¹å™¨nginxï¼Œå¹¶åŠ è½½ä¸€ä¸ªæ•°æ®å·åˆ°å®¹å™¨çš„/dataç›®å½•ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test1 -v /data nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å®¹å™¨å¯åŠ¨åï¼Œç™»å½•åˆ°å®¹å™¨ä¼šå‘ç°/dataç›®å½•æ˜¯ç©ºçš„ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh nginx-volume-test1</span></span>
<span class="line"><span style="color:#a6accd">root@00741a2a44ad:/# ls -l /data</span></span>
<span class="line"><span style="color:#a6accd">total 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸Šé¢çš„å‘½ä»¤ä¼šæŒ‚è½½ä¸€ä¸ªdataç›®å½•åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ç»•è¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»æœºä¸Šç›´æ¥æ“ä½œè¯¥ç›®å½•ã€‚ä»»ä½•åœ¨è¯¥é•œåƒ/data è·¯å¾„çš„æ–‡ä»¶ä¼šå°†è¢«å¤åˆ¶åˆ°Volumeã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬å®¿ä¸»æœºä¸Šï¼Œè¿™ä¸ªç›®å½•åˆ°åº•åœ¨å“ªé‡Œå‘¢ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ docker inspect å‘½ä»¤æ‰¾åˆ°Volumeåœ¨ä¸»æœºä¸Šçš„å­˜å‚¨ä½ç½®ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker inspect -f {{.Mounts}} nginx-volume-test1</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[{861cbee5b650461490633fc60bd94a0df0f8b01e4a4dcc4adff4825dff509159</span></span>
<span class="line"><span style="color:#a6accd">/var/lib/docker/volumes/861cbee5b650461490633fc60bd94a0df0f8b01e4a4dcc4adff4825dff509159/_data</span></span>
<span class="line"><span style="color:#a6accd">/data local true }]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½ ä¼šå‘ç°ï¼Œå®¹å™¨ä¸­çš„/dataç›®å½•å®é™…ä¸ŠæŒ‚è½½åˆ°äº†/var/lib/docker/volumes/å®¹å™¨ID/_dataçš„ç›®å½•ä¸‹ã€‚</p><p>æˆ‘ä»¬ç°åœ¨åœ¨å®¿ä¸»æœºè¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 _data]# touch mount-test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ‘ä»¬å†æ¬¡åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ï¼Œå‘ç°å·²ç»æœ‰äº†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh nginx-volume-test1</span></span>
<span class="line"><span style="color:#a6accd">root@00741a2a44ad:/# ls -l /data</span></span>
<span class="line"><span style="color:#a6accd">total 0</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 0 Sep 2 18:58 mount-test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŒ‡å®šä¸€ä¸ªå®¿ä¸»æœºç›®å½•ä½œä¸ºæ•°æ®å·</strong></p><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†å®¿ä¸»æœºçš„æŸä¸ªç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­æ¥è¿›è¡Œè®¿é—®ï¼Œå¯ä»¥é€šè¿‡-v æºè·¯å¾„ï¼šç›®æ ‡ç›®å½•çš„æ–¹å¼è¿›è¡Œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p /data/docker-volume-nginx</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test2 \</span></span>
<span class="line"><span style="color:#a6accd">-v /data/docker-volume-nginx:/data nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½ ä¼šå‘ç°ï¼Œç›®å‰å®¹å™¨ä¸­çš„/dataç›®å½•å’Œå®¿ä¸»æœºä¸­çš„/data/ docker-volume-nginxç›®å½•æ˜¯ç›¸åŒçš„ã€‚</p><p><strong>æ–‡ä»¶æŒ‚è½½</strong></p><p>æ•°æ®å·ä¹Ÿå¯ä»¥æŒ‚è½½ä¸€ä¸ªå®¿ä¸»æœºçš„æ–‡ä»¶ä½œåˆ°å®¹å™¨ä¸­ä½œä¸ºæ•°æ®å·ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test3 \</span></span>
<span class="line"><span style="color:#a6accd">-v /$HOME/.bash_history:/root/.bash_history nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸Šé¢æ¡ˆä¾‹å°†å®¿ä¸»æœºçš„.bash_historyæŒ‚è½½åˆ°äº†å®¹å™¨ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥è®°å½•å®¹å™¨ä¸­çš„å‘½ä»¤å†å²è®°å½•ã€‚</p><p><strong>åªè¯»æŒ‚è½½</strong></p><p>Docker æŒ‚è½½æ•°æ®å·çš„é»˜è®¤æƒé™æ˜¯è¯»å†™ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ :ro æŒ‡å®šä¸ºåªè¯»ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test \</span></span>
<span class="line"><span style="color:#a6accd">-v /data/docker-volume-nginx:/data:ro nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="æ•°æ®å·ç”Ÿäº§å®è·µ" tabindex="-1">æ•°æ®å·ç”Ÿäº§å®è·µ <a aria-current="page" href="#æ•°æ®å·ç”Ÿäº§å®è·µ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é‚£ä¹ˆè¿™ç§å°†æœ¬åœ°çš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„æ–¹æ³•ï¼Œåœ¨ç”Ÿäº§ä¸­æœ‰å“ªäº›åº”ç”¨åœºæ™¯å‘¢ï¼Ÿ</p><p><strong>åœ¨å¼€å‘ç¯å¢ƒä¸­</strong></p><p>åœ¨åŸºäºDockerçš„å¼€å‘ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚æˆ‘ä»¬å°†æœ¬åœ°çš„/home/codeç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„/data/webrootï¼Œç„¶åå®¹å™¨çš„åº”ç”¨çš„webrootåŒæ ·è®¾ç½®ä¸º/data/webrootï¼Œé‚£ä¹ˆå®¹å™¨å¯åŠ¨åï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªç”±çš„æœ¬åœ°è¿›è¡Œä»£ç çš„ç¼–å†™å’Œè°ƒè¯•ï¼Œå¯¹äºè§£é‡Šæ€§çš„è¯­è¨€ï¼Œå°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚å¦‚æœä½ çš„Dockerè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­ï¼Œå¯ä»¥å…ˆå°†æœ¬åœ°ä¾‹å¦‚D:codeç›®å½•é€šè¿‡è™šæ‹Ÿæœºè½¯ä»¶å…±äº«åˆ°è™šæ‹Ÿæœºé‡Œï¼Œç›®å‰VirtualBoxå’ŒVmware workstationéƒ½æ”¯æŒç›®å½•æ˜ å°„ã€‚åœ¨Vmwareä¸­éœ€è¦åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…Vmware Toolsã€‚</p><p><img src="http://k8s.unixhot.com/docker/media/03822b520894cafdde1dbbc64b8b99e6.png" alt="img"></p><p><strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­</strong></p><p>å¦‚æœæˆ‘ä»¬çš„å®¹å™¨é‡Œé¢è¿è¡Œçš„ç¨‹åºéœ€è¦å†™ä¸€äº›æŒä¹…åŒ–çš„æ•°æ®åˆ°ç¡¬ç›˜ï¼Œæˆ–è€…å…±äº«å®¿ä¸»æœºçš„ä¸€äº›æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œæ˜¾ç„¶è¿™ç§æ•°æ®å·çš„æŒ‚è½½éå¸¸çš„æ–¹ä¾¿ã€‚</p><p>ä¸è¿‡æ•°æ®å·æœ€å¤§çš„ç¼ºé™·åº”è¯¥æ˜¯ä¸çµæ´»äº†ï¼Œå› ä¸ºDockerçš„ç†å¿µæ˜¯Buildã€Shipã€Runã€‚å› ä¸ºæœ‰è¿™ä¸ªæŒ‚è½½ç›®å½•çš„ä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªDockeré•œåƒåœ¨æ–°çš„å®¿ä¸»æœºä¸Šè¿è¡Œå°±éœ€è¦è€ƒè™‘æŒ‚è½½çš„ç›®å½•æ˜¯å¦å­˜åœ¨ç­‰é—®é¢˜ã€‚</p><h3 id="æ•°æ®å·å®¹å™¨" tabindex="-1">æ•°æ®å·å®¹å™¨ <a aria-current="page" href="#æ•°æ®å·å®¹å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Dockerè¿˜æ”¯æŒè®©ä¸€ä¸ªå®¹å™¨è®¿é—®å¦ä¸€ä¸ªå®¹å™¨çš„Volumeï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -volumes-from å‚æ•°æŒ‚è½½å…¶å®ƒå®¹å™¨çš„å·ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name nginx-volume-test4 \</span></span>
<span class="line"><span style="color:#a6accd">--volumes-from nginx-volume-test1 nginx</span></span>
<span class="line"><span style="color:#a6accd">7d650d332e3d9bf4086be35ae5a04b618f9d8e1df03fa2fef5f5766318a4ca12</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh nginx-volume-test4</span></span>
<span class="line"><span style="color:#a6accd">root@7d650d332e3d:~# ls /data</span></span>
<span class="line"><span style="color:#a6accd">mount-test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ³¨æ„ï¼šä¸ç®¡æ•°æ®å·å®¹å™¨nginx-volume-test1æ˜¯å¦è¿è¡Œï¼Œnginx-volume-test4éƒ½å¯ä»¥è®¿é—®åˆ°nginx-volume-test1é‡Œé¢æŒ‚è½½çš„æ•°æ®å·ã€‚æ‰€ä»¥è¯´æ•°æ®å·å®¹å™¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å®¹å™¨ï¼Œåªä¸è¿‡æ˜¯ä¸“é—¨ç”¨æ¥æä¾›æ•°æ®å·ä¾›å…¶å®ƒå®¹å™¨æŒ‚è½½ä½¿ç”¨çš„ã€‚</p><h3 id="æ•°æ®å·å®¹å™¨ç”Ÿäº§å®è·µ" tabindex="-1">æ•°æ®å·å®¹å™¨ç”Ÿäº§å®è·µ <a aria-current="page" href="#æ•°æ®å·å®¹å™¨ç”Ÿäº§å®è·µ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æ•°æ®å·å®¹å™¨çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä¸€ä¸ªéå¸¸å…¸å‹çš„å°±æ˜¯åœ¨è¿›è¡Œæ—¥å¿—æ”¶é›†çš„æ—¶å€™ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªlogstashæˆ–è€…filebeatçš„å®¹å™¨log-volumeï¼Œç„¶åå…¶å®ƒæ‰€æœ‰åº”ç”¨å®¹å™¨å¯åŠ¨éƒ½ä½¿ç”¨--volumes-from log-volumeï¼Œå°†æ—¥å¿—å†™å…¥å¯¹åº”è·¯å¾„ï¼Œç„¶åä½¿ç”¨ç»Ÿä¸€æ”¶é›†ï¼Œè¿™æ ·å°±é¿å…åœ¨æ‰€æœ‰éœ€è¦è¿›è¡Œæ—¥å¿—æ”¶é›†çš„å®¹å™¨ä¸­å»éƒ¨ç½²logstashã€‚ç›¸å¯¹äºç›´æ¥æŒ‚è½½æœ¬åœ°ç›®å½•ä¹Ÿæ›´åŠ çš„æ–¹ä¾¿ã€‚</p><h1 id="dockeré•œåƒç”Ÿäº§æ„å»º" tabindex="-1">Dockeré•œåƒç”Ÿäº§æ„å»º <a aria-current="page" href="#dockeré•œåƒç”Ÿäº§æ„å»º" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>æˆ‘ä»¬å·²ç»äº†è§£äº†Dockerçš„åŸºæœ¬æ¦‚å¿µå’Œç®¡ç†ï¼Œä¸‹é¢å°±å¼€å§‹ç€æ‰‹åˆ›å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ªDockeré•œåƒï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ç”¨æœ€æ—©pullä¸‹æ¥çš„centosä½œä¸ºåŸºç¡€é•œåƒï¼Œç„¶ååœ¨ä¸Šé¢éƒ¨ç½²Nginxæ¥åšæ¡ˆä¾‹è®²è§£ã€‚</p><h2 id="æ‰‹åŠ¨æ„å»ºé•œåƒ" tabindex="-1">æ‰‹åŠ¨æ„å»ºé•œåƒ <a aria-current="page" href="#æ‰‹åŠ¨æ„å»ºé•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æ‰‹åŠ¨æ„å»ºé•œåƒï¼Œç®€å•çš„è¯´å°±æ˜¯æˆ‘ä»¬åŸºäºä¸€ä¸ªåŸºç¡€é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œç„¶åå¯¹è¿™ä¸ªå®¹å™¨è¿›è¡Œæ›´æ”¹ï¼Œæ›´æ”¹å®Œæ¯•åï¼Œè¿›è¡Œæäº¤ã€‚</p><h3 id="å¯åŠ¨å®¹å™¨-1" tabindex="-1">å¯åŠ¨å®¹å™¨ <a aria-current="page" href="#å¯åŠ¨å®¹å™¨-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>è¿è¡Œä¸€ä¸ªCentOSå®¹å™¨ï¼Œå‘½åä¸ºmynginx</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull centos</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --name mynginx -it centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨å®¹å™¨é‡Œé¢å®‰è£…Nginx</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# yum install -y nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æƒ³è¦Dockerå®¹å™¨ä¿æŒæ´»è·ƒçš„çŠ¶æ€ï¼Œéœ€è¦å…¶ä¸­è¿è¡Œçš„è¿›ç¨‹ä¸èƒ½ä¸­æ–­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxä¼šä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ï¼Œè¿™ä¼šå¯¼è‡´å®¹å™¨åªæ˜¯çŸ­æš‚è¿è¡Œï¼Œåœ¨å®ˆæŠ¤è¿›ç¨‹è¢«forkå¯åŠ¨åï¼Œå‘èµ·å®ˆæŠ¤è¿›ç¨‹çš„åŸå§‹è¿›ç¨‹å°±ä¼šé€€å‡ºï¼Œè¿™æ—¶å®¹å™¨å°±ä¼šåœæ­¢è¿è¡Œäº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†Nginxæ”¾åœ¨å‰ç«¯è¿è¡Œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# vi /etc/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#a6accd">#åœ¨é…ç½®æ–‡ä»¶æœ€ä¸Šé¢å¢åŠ ä¸‹é¢é…ç½®</span></span>
<span class="line"><span style="color:#a6accd">daemon off;</span></span>
<span class="line"><span style="color:#a6accd">[root@2e110e00eef4 /]# exit</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="æäº¤é•œåƒ" tabindex="-1">æäº¤é•œåƒ <a aria-current="page" href="#æäº¤é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>è·å–å®¹å™¨ID</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -a | grep mynginx</span></span>
<span class="line"><span style="color:#a6accd">2e110e00eef4 centos "/bin/bash" 8 minutes ago Exited (0) 2 minutes ago mynginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æäº¤ä¿®æ”¹åçš„å®¹å™¨ä¸ºé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker commit -m "My Nginx" 2e110e00eef4 test/mynginx:v1</span></span>
<span class="line"><span style="color:#a6accd">sha256:cfd25da2c9c5dd2bcce9e5d2ef4e316b46b5f03617176b97b60a34f2958a6d70</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>-mï¼šæŒ‡å®šæäº¤çš„è¯´æ˜ä¿¡æ¯ï¼Œç±»ä¼¼SVNå’ŒGitã€‚</li><li>ä¹‹åæ˜¯ç”¨æ¥åˆ›å»ºé•œåƒçš„å®¹å™¨çš„ IDï¼›</li><li>æœ€åæŒ‡å®šç›®æ ‡é•œåƒçš„ä»“åº“åå’Œæ ‡ç­¾ä¿¡æ¯ã€‚</li></ul><p><strong>æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images</span></span>
<span class="line"><span style="color:#a6accd">REPOSITORY TAG IMAGE ID CREATED SIZE</span></span>
<span class="line"><span style="color:#a6accd">test/mynginx v1 cfd25da2c9c5 49 seconds ago 373MB</span></span>
<span class="line"><span style="color:#a6accd">nginx latest f09fe80eb0e7 2 weeks ago 109MB</span></span>
<span class="line"><span style="color:#a6accd">centos latest 1e1148e4cc2c 2 months ago 202MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ä»æˆ‘ä»¬åˆ›å»ºçš„é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 91:80 test/mynginx:v1 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç°åœ¨ä½ çš„æ‰‹åŠ¨æ„å»ºçš„ç¬¬ä¸€ä¸ªé•œåƒå°±å®Œæˆäº†ã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼å®‰è£…ä»»æ„ä½ éœ€è¦çš„è½¯ä»¶åˆ°é•œåƒé‡Œé¢ï¼Œç„¶åä½¿ç”¨é•œåƒæ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œåªè¦è®°ä½å®¹å™¨å¯åŠ¨å¿…é¡»è¦æœ‰ä¸€ä¸ªä¸ä¼šé€€å‡ºçš„è¿›ç¨‹åœ¨æ‰§è¡Œå³å¯ã€‚</p><h2 id="dockerfileæ„å»º" tabindex="-1">Dockerfileæ„å»º <a aria-current="page" href="#dockerfileæ„å»º" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Dockerfileæ˜¯ä¸ºå¿«é€Ÿæ„å»ºdocker imageè€Œè®¾è®¡çš„ï¼Œå½“ä½ ä½¿ç”¨docker buildå‘½ä»¤çš„æ—¶å€™ï¼Œdocker ä¼šè¯»å–å½“å‰ç›®å½•ä¸‹çš„å‘½åä¸ºDockerfile(é¦–å­—æ¯å¤§å†™)çš„çº¯æ–‡æœ¬æ–‡ä»¶å¹¶æ‰§è¡Œé‡Œé¢çš„æŒ‡ä»¤æ„å»ºå‡ºä¸€ä¸ªdocker imageã€‚è¿™æ¯”SaltStackçš„é…ç½®ç®¡ç†è¦ç®€å•çš„å¤šï¼Œä¸è¿‡è¿˜æ˜¯è¦æŒæ¡ä¸€äº›ç®€å•çš„æŒ‡ä»¤ã€‚</p><p>Dockerfile ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ç»„æˆï¼Œå¹¶ä¸”æ”¯æŒä»¥#å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚æŒ‡ä»¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†æ˜¯é€šå¸¸æˆ‘ä»¬éƒ½å¤§å†™ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡æ„å»ºä¸€ä¸ªNginxçš„é•œåƒæ¥å­¦ä¹ Dockerfileçš„ç¼–å†™ã€‚</p><h3 id="nginx-dockerfileå®æˆ˜" tabindex="-1">Nginx Dockerfileå®æˆ˜ <a aria-current="page" href="#nginx-dockerfileå®æˆ˜" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>æ³¨æ„ï¼šç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯FROMã€‚</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p /opt/dockerfile/mynginx</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/mynginx/</span></span>
<span class="line"><span style="color:#a6accd">[root@test-node1 nginx]# vim Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># This docker file uses the centos image</span></span>
<span class="line"><span style="color:#a6accd"># VERSION 1</span></span>
<span class="line"><span style="color:#a6accd"># Author: Jason Zhao</span></span>
<span class="line"><span style="color:#a6accd"># Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM centos</span></span>
<span class="line"><span style="color:#a6accd"># Maintainer</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER shundong.zhao zhaoshundong@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Commands to update the image</span></span>
<span class="line"><span style="color:#a6accd">RUN rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y nginx --enablerepo=epel</span></span>
<span class="line"><span style="color:#a6accd">ADD index.html /usr/share/nginx/html/index.html</span></span>
<span class="line"><span style="color:#a6accd">RUN echo "daemon off;" &gt;&gt; /etc/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 80</span></span>
<span class="line"><span style="color:#a6accd">CMD ["nginx"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸ºäº†å¤§å®¶æ›´å®¹æ˜“å­¦ä¹ ï¼Œæˆ‘è¿™é‡Œæ€»ç»“ä¸€ä¸ªå‘½ä»¤çš„ä»‹ç»ï¼š</p><p>ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬å°†Dockerfile åˆ†ä¸ºå››éƒ¨åˆ†ï¼š</p><ul><li>åŸºç¡€é•œåƒä¿¡æ¯</li><li>ç»´æŠ¤è€…ä¿¡æ¯</li><li>é•œåƒæ“ä½œæŒ‡ä»¤</li><li>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤</li></ul><h3 id="å¸¸ç”¨æŒ‡ä»¤çš„ä»‹ç»" tabindex="-1">å¸¸ç”¨æŒ‡ä»¤çš„ä»‹ç» <a aria-current="page" href="#å¸¸ç”¨æŒ‡ä»¤çš„ä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><img src="http://k8s.unixhot.com/docker/media/74da151d98647093a4d1ade4f222fbe7.png" alt="img"></p><p><strong>æ„å»ºDockerfile</strong></p><p>æ³¨æ„ï¼šADD index.htmlå°±æ˜¯æ”¾ä¸€ä¸ªæ–‡ä»¶è¿›å»ï¼Œè¿™ä¸ªæ–‡ä»¶éœ€è¦å¤§å®¶è‡ªå·±å‡†å¤‡ä¸€ä¸‹ã€‚ä¾‹å¦‚ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 mynginx]# echo "nginx in docker test" &gt; index.html</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿ç”¨dokcer buildå‘½ä»¤æ„å»ºé•œåƒï¼Œæœ€åçš„.è¡¨ç¤ºå½“å‰è·¯å¾„</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 mynginx]# docker build -t mynginx:v2 .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ„å»ºå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥Runèµ·æ¥ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d -p 92:80 mynginx:v2 nginx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æµ‹è¯•è®¿é—®</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 mynginx]# curl http://192.168.56.11:92</span></span>
<span class="line"><span style="color:#a6accd">nginx in docker test</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç°åœ¨ä½ åº”è¯¥å‘ç°ç¼–å†™Dockerfileæœ‰å¤šä¹ˆçš„ç®€å•äº†å§ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯è¦ç³»ç»Ÿçš„å†æ¥å­¦ä¹ ä¸€éã€‚</p><h3 id="dockerfileå‘½ä»¤è¯¦è§£" tabindex="-1">Dockerfileå‘½ä»¤è¯¦è§£ <a aria-current="page" href="#dockerfileå‘½ä»¤è¯¦è§£" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†åˆ«ä»‹ç»ä¸‹ä¸Šé¢ä½¿ç”¨åˆ°çš„å‘½ä»¤ï¼š</p><p><strong>FROM</strong></p><p>æ ¼å¼ï¼šFROM <img src="" alt="img">æˆ–FROM <img src="" alt="img">:ã€‚ è§£é‡Šï¼šFROMå¿…é¡»æ˜¯Dockerfileé‡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼ˆæ³¨è§†é™¤å¤–ï¼‰ï¼Œåé¢è·Ÿæœ‰æ•ˆçš„é•œåƒåï¼ˆå¦‚æœè¯¥é•œåƒä½ çš„æœ¬åœ°ä»“åº“æ²¡æœ‰åˆ™ä¼šä»è¿œç¨‹ä»“åº“Pullå–ï¼‰ã€‚ç„¶ååé¢çš„å…¶å®ƒæŒ‡ä»¤FROMçš„é•œåƒä¸­æ‰§è¡Œã€‚</p><p><strong>MAINTAINER</strong></p><p>æ ¼å¼ï¼šMAINTAINER è§£é‡Šï¼šæŒ‡å®šç»´æŠ¤è€…çš„ä¿¡æ¯ã€‚</p><p><strong>RUN</strong></p><p>æ ¼å¼ï¼šRUN æˆ– RUN ["executable", "param1", "param2"]ã€‚ è§£é‡Šï¼šè¿è¡Œå‘½ä»¤ï¼Œå‘½ä»¤è¾ƒé•¿ä½¿å¯ä»¥ä½¿ç”¨æ¥æ¢è¡Œã€‚æ¨èä½¿ç”¨ä¸Šé¢æ•°ç»„çš„æ ¼å¼</p><p><strong>CMD</strong></p><p>æ ¼å¼ï¼š</p><p>CMD ["executable","param1","param2"] ä½¿ç”¨ exec æ‰§è¡Œï¼Œæ¨èæ–¹å¼ï¼› CMD command param1 param2 åœ¨ /bin/sh ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ï¼› CMD ["param1","param2"] æä¾›ç»™ENTRYPOINTçš„é»˜è®¤å‚æ•°ï¼›</p><p>è§£é‡Šï¼š</p><p>CMDæŒ‡å®šå®¹å™¨å¯åŠ¨æ˜¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ªDockerfileåªèƒ½æœ‰ä¸€æ¡CMDå‘½ä»¤ï¼Œå¦‚æœæŒ‡å®šäº†å¤šæ¡ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœä½ åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ä¹ŸæŒ‡å®šçš„å‘½ä»¤ï¼Œé‚£ä¹ˆä¼šè¦†ç›–Dockerfileæ„å»ºçš„é•œåƒé‡Œé¢çš„CMDå‘½ä»¤ã€‚</p><p><strong>ENTRYPOINT</strong></p><p>æ ¼å¼ï¼š</p><p>ENTRYPOINT ["executable", "param1", "param2"] ENTRYPOINT command param1 param2ï¼ˆshellä¸­æ‰§è¡Œï¼‰ã€‚ è§£é‡Šï¼šå’ŒCMDç±»ä¼¼éƒ½æ˜¯é…ç½®å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« docker runæä¾›çš„å‚æ•°è¦†ç›–ã€‚</p><p>æ¯ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ªENTRYPOINTï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªèµ·æ•ˆã€‚ENTRYPOINTæ²¡æœ‰CMDçš„å¯æ›¿æ¢ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯ä½ å¯åŠ¨å®¹å™¨çš„æ—¶å€™å¢åŠ è¿è¡Œçš„å‘½ä»¤ä¸ä¼šè¦†ç›–ENTRYPOINTæŒ‡å®šçš„å‘½ä»¤ã€‚</p><p>æ‰€ä»¥ç”Ÿäº§å®è·µä¸­æˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨ENTRYPOINTå’ŒCMDï¼Œä¾‹å¦‚ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">ENTRYPOINT ["/usr/bin/rethinkdb"]</span></span>
<span class="line"><span style="color:#a6accd">CMD ["--help"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>USER</strong></p><p>æ ¼å¼ï¼šUSER daemon è§£é‡Šï¼šæŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åå’ŒUIDï¼Œåç»­çš„RUNæŒ‡ä»¤ä¹Ÿä¼šä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„ç”¨æˆ·ã€‚</p><p><strong>EXPOSE</strong></p><p>æ ¼å¼ï¼šEXPOSE [...] è§£é‡Šï¼šè®¾ç½®Dockerå®¹å™¨å†…éƒ¨æš´éœ²çš„ç«¯å£å·ï¼Œå¦‚æœéœ€è¦å¤–éƒ¨è®¿é—®ï¼Œè¿˜éœ€è¦å¯åŠ¨å®¹å™¨æ—¶å¢åŠ -pæˆ–è€…-På‚æ•°è¿›è¡Œåˆ†é…ã€‚</p><p><strong>ENV</strong></p><p>æ ¼å¼ï¼šENV ENV = ... è§£é‡Šï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨RUNä¹‹å‰ä½¿ç”¨ï¼Œç„¶åRUNå‘½ä»¤æ—¶è°ƒç”¨ï¼Œå®¹å™¨å¯åŠ¨æ—¶è¿™äº›ç¯å¢ƒå˜é‡éƒ½ä¼šè¢«æŒ‡å®š</p><p><strong>ADD</strong></p><p>æ ¼å¼ï¼š ADD ... ADD ["",... ""] è§£é‡Šï¼šå°†æŒ‡å®šçš„å¤åˆ¶åˆ°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„</p><p>æ‰€æœ‰æ‹·è´åˆ°containerä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æƒé™ä¸º0755,uidå’Œgidä¸º0 å¦‚æœæ–‡ä»¶æ˜¯å¯è¯†åˆ«çš„å‹ç¼©æ ¼å¼ï¼Œåˆ™dockerä¼šå¸®å¿™è§£å‹ç¼©</p><p><strong>VOLUME</strong></p><p>æ ¼å¼ï¼šVOLUME ["/data"] è§£é‡Šï¼šå¯ä»¥å°†æœ¬åœ°æ–‡ä»¶å¤¹æˆ–è€…å…¶ä»–containerçš„æ–‡ä»¶å¤¹æŒ‚è½½åˆ°containerä¸­ã€‚</p><p><strong>WORKDIR</strong></p><p>æ ¼å¼ï¼šWORKDIR /path/to/workdir è§£é‡Šï¼šåˆ‡æ¢ç›®å½•ï¼Œä¸ºåç»­çš„ RUNã€CMDã€ENTRYPOINT æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•ã€‚å¯ä»¥å¤šæ¬¡åˆ‡æ¢(ç›¸å½“äºcdå‘½ä»¤)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ª WORKDIRæŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„ã€‚ ä¾‹å¦‚ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">WORKDIR /a</span></span>
<span class="line"><span style="color:#a6accd">WORKDIR b</span></span>
<span class="line"><span style="color:#a6accd">WORKDIR c</span></span>
<span class="line"><span style="color:#a6accd">RUN pwd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ™æœ€ç»ˆè·¯å¾„ä¸º /a/b/cã€‚</p><p><strong>ONBUILD</strong></p><p>ONBUILD æŒ‡å®šçš„å‘½ä»¤åœ¨æ„å»ºé•œåƒæ—¶å¹¶ä¸æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨å®ƒçš„å­é•œåƒä¸­æ‰§è¡Œ</p><p><strong>ARG</strong></p><p>æ ¼å¼ï¼šARG [=] è§£é‡Šï¼šARGæŒ‡å®šäº†ä¸€ä¸ªå˜é‡åœ¨docker buildçš„æ—¶å€™ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨--build-arg =æ¥æŒ‡å®šå‚æ•°çš„å€¼ï¼Œä¸è¿‡å¦‚æœæ„å»ºçš„æ—¶å€™ä¸æŒ‡å®šå°±ä¼šæŠ¥é”™ã€‚</p><h2 id="dockeré•œåƒç”Ÿäº§è§„åˆ’å®è·µ" tabindex="-1">Dockeré•œåƒç”Ÿäº§è§„åˆ’å®è·µ <a aria-current="page" href="#dockeré•œåƒç”Ÿäº§è§„åˆ’å®è·µ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ç°åœ¨æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨Dockerfileæ¥æ„å»ºé•œåƒï¼Œæ²¡é”™ï¼ŒçœŸæ­£ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬ä¹Ÿæ˜¯å¤§è§„æ¨¡çš„ä½¿ç”¨Dockerfileã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•å…¥æ‰‹å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å‚è€ƒä¸€äº›åˆ«äººç¼–å†™çš„Dockerfileï¼Œå­¦ä¹ ä¸€äº›è§„èŒƒå’ŒæŠ€å·§ï¼Œå¯ä»¥æ¥è¿™é‡Œæ‰¾æ‰¾ç­”æ¡ˆï¼š<a href="https://github.com/dockerfile%E3%80%82" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://github.com/dockerfileã€‚<!--]--></a></p><p>å¯ä»¥å‚è€ƒç½‘å‹ç¼–å†™çš„Dockerfileçš„æŠ€å·§å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆçœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒï¼Œè‚¯å®šè¦æ ¹æ®è‡ªå·±å…¬å¸æˆ–è€…å›¢é˜Ÿçš„æŠ€æœ¯æ ˆæ¥æ„å»ºä¸åŒçš„Dockeré•œåƒï¼Œæ ¹æ®Dockeré•œåƒçš„åˆ†å±‚è§‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šå¯¹æˆ‘ä»¬çš„é•œåƒè¿›è¡Œåˆ†å±‚ã€‚</p><ul><li>ç³»ç»Ÿå±‚</li><li>è¿è¡Œç¯å¢ƒå±‚</li><li>åº”ç”¨æœåŠ¡å±‚</li></ul><p>æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /opt/dockerfile</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 dockerfile]# mkdir system runtime app</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 dockerfile]# tree</span></span>
<span class="line"><span style="color:#a6accd">.</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ app</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ runtime</span></span>
<span class="line"><span style="color:#a6accd">â””â”€â”€ system</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="åŸºç¡€ç³»ç»Ÿé•œåƒ" tabindex="-1">åŸºç¡€ç³»ç»Ÿé•œåƒ <a aria-current="page" href="#åŸºç¡€ç³»ç»Ÿé•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="centosç³»ç»Ÿé•œåƒ" tabindex="-1">CentOSç³»ç»Ÿé•œåƒ <a aria-current="page" href="#centosç³»ç»Ÿé•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é»˜è®¤çš„å®˜æ–¹CentOSé•œåƒæœ‰å¾ˆå¤šå¸¸ç”¨çš„å‘½ä»¤å¹¶ä¸æä¾›ï¼Œå¯ä»¥æ ¹æ®ä¼ä¸šéœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨yumå®‰è£…å®Œæ¯•åï¼Œè®°å¾—æ‰§è¡Œyum clean allã€‚</p><p>å› ä¸ºyumä¼šæŠŠä¸‹è½½çš„è½¯ä»¶åŒ…å’Œheaderå­˜å‚¨åœ¨cacheä¸­ï¼Œè€Œä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚å¦‚æœæˆ‘ä»¬è§‰å¾—å®ƒä»¬å ç”¨äº†ç£ç›˜ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨yum clean allæŒ‡ä»¤è¿›è¡Œæ¸…é™¤ï¼Œå¯ä»¥å‡å°‘é•œåƒçš„å¤§å°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/system/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 system]# mkdir centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>1.ç¼–å†™Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# vim centos/Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">**FROM** centos</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">**MAINTAINER** Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">**RUN** rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">**RUN** yum install -y wget mysql-devel supervisor git redis tree net-tools sudo</span></span>
<span class="line"><span style="color:#a6accd">psmisc &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.æ„å»ºé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker build -t unixhot/centos ./centos/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 24 seconds ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.ä½¿ç”¨é•œåƒåˆ›å»ºå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker run --name mycentos -it unixhot/centos</span></span>
<span class="line"><span style="color:#a6accd">/bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@b137b1cdd3ac /]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.3 0.0 11776 1872 ? Ss 03:56 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 15 0.0 0.0 47424 1668 ? R+ 03:56 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="centosç³»ç»Ÿé•œåƒåŒ…å«ssh" tabindex="-1">CentOSç³»ç»Ÿé•œåƒåŒ…å«SSH <a aria-current="page" href="#centosç³»ç»Ÿé•œåƒåŒ…å«ssh" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨å¾ˆå¤šæ—¶å€™å¦‚æœä½ éœ€è¦åœ¨CentOSé‡Œé¢å¯åŠ¨sshdæœåŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦å®‰è£…openssh-serverå¹¶ä¸”é‡æ–°ç”ŸæˆSSHçš„ä¸»æœºå¯†é’¥ã€‚åŒæ—¶å¦‚æœï¼Œä½ éœ€è¦ç»™é•œåƒè®¾ç½®ä¸€ä¸ªå¯†ç ï¼Œå¯ä»¥ä½¿ç”¨chpasswdéäº¤äº’çš„æ–¹å¼æ¥è¿›è¡Œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/system/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 system]# mkdir centos-ssh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>1.ç¼–å†™Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# vim centos-ssh/Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM centos</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#EPEL</span></span>
<span class="line"><span style="color:#a6accd">RUN rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y openssh-clients openssl-devel openssh-server wget mysql-devel</span></span>
<span class="line"><span style="color:#a6accd">supervisor git redis tree net-tools sudo psmisc &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># For SSHD</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -A -t dsa -f /etc/ssh/ssh_host_dsa_key</span></span>
<span class="line"><span style="color:#a6accd"># Set root password</span></span>
<span class="line"><span style="color:#a6accd">RUN echo "root:unixhot.com" | chpasswd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.æ„å»ºé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker build -t unixhot/centos-ssh:v1 ./centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd">Sending build context to Docker daemon 2.048 kB</span></span>
<span class="line"><span style="color:#a6accd">Step 1 : FROM centos</span></span>
<span class="line"><span style="color:#a6accd">---&gt; 980e0e4c79ec</span></span>
<span class="line"><span style="color:#a6accd">Step 2 : MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">---&gt; **Using cache**</span></span>
<span class="line"><span style="color:#a6accd">---&gt; d08da8648d91</span></span>
<span class="line"><span style="color:#a6accd">Step 3 : RUN rpm -ivh</span></span>
<span class="line"><span style="color:#a6accd">http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">---&gt; **Using cache**</span></span>
<span class="line"><span style="color:#a6accd">---&gt; ad9a05bcfb78</span></span>
<span class="line"><span style="color:#a6accd">â€¦ï¼ˆçœç•¥åé¢è¾“å‡ºï¼‰</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œä¸ºäº†åŠ å¿«æ„å»ºçš„é€Ÿåº¦ï¼Œæ³¨æ„åˆ°ä¸Šé¢å‰ä¸‰æ­¥çš„è¾“å‡ºUsing cacheï¼Œå› ä¸ºDockeré•œåƒçš„åˆ†å±‚åŸç†ï¼Œå·²ç»æ„å»ºè¿‡çš„layerä¸ä¼šé‡å¤æ„å»ºã€‚</p></blockquote><p><strong>3.æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 19 seconds ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 2 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.ä½¿ç”¨é•œåƒåˆ›å»ºå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker run -d --name centos-ssh-demo -p 8022:22</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh:v1 /usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">5f5bbe98a17c620f91a7d3e68a605a4bcbd48621f32aaa095245e59a8691e229</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">5f5bbe98a17c unixhot/centos-ssh:v1 "/usr/sbin/sshd -D" 5 seconds ago Up 2</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:8022-&gt;22/tcp centos-ssh-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.ä½¿ç”¨sshè¿æ¥å®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh -p 8022 root@192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">root@192.168.56.11's password:</span></span>
<span class="line"><span style="color:#a6accd">[root@5f5bbe98a17c ~]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.0 0.0 82560 3600 ? Ss 05:46 0:00 /usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">root 7 0.0 0.0 11636 1116 ? Ss 05:47 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 13 0.0 0.0 11636 1116 ? Ss 05:48 0:00 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">root 63 0.7 0.0 139272 5424 ? Ss 05:51 0:00 sshd: root@pts/0</span></span>
<span class="line"><span style="color:#a6accd">root 65 0.5 0.0 13376 1988 pts/0 Ss 05:51 0:00 -bash</span></span>
<span class="line"><span style="color:#a6accd">root 78 0.0 0.0 49024 1808 pts/0 R+ 05:51 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Good Jobï¼Œä½ ç°åœ¨å¯ä»¥é€šè¿‡sshè¿æ¥åˆ°è‡ªå·±åˆ›å»ºçš„Dockerå®¹å™¨ä¸Šäº†ã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªé—®é¢˜ï¼ŒDockeråªå…è®¸åœ¨å‰å°è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£å·²ç»è¿è¡Œäº†sshdã€‚é‚£ä¹ˆå¦‚ä½•è¿è¡Œåˆ«çš„è¿›ç¨‹å‘¢ã€‚æ˜¾ç„¶æˆ‘ä»¬åšä¸€ä¸ªèƒ½sshçš„é•œåƒï¼Œç›®çš„å°±æ˜¯ä¸ºäº†åœ¨ä¸Šé¢è¿è¡Œå„ç§æœåŠ¡ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆã€‚<a href="http://xn--start-fg1hyjn9fbll9onm0app1b175dr5f.sh" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->ä¾‹å¦‚ä½ ç¼–å†™ä¸€ä¸ªè„šæœ¬start.sh<!--]--></a>ã€‚å¯ä»¥åœ¨é‡Œé¢å†™å¤šä¸ªæœåŠ¡çš„å¯åŠ¨å‘½ä»¤ï¼Œåªè¦start.shä¸æ‰§è¡Œå®Œæ¯•ï¼Œå³å¯ã€‚å½“ç„¶çœŸæ­£ç”Ÿäº§æ¨èçš„æ˜¯ä½¿ç”¨Supervisorã€‚</p><h3 id="ä½¿ç”¨supervisorç®¡ç†è¿›ç¨‹" tabindex="-1">ä½¿ç”¨Supervisorç®¡ç†è¿›ç¨‹ <a aria-current="page" href="#ä½¿ç”¨supervisorç®¡ç†è¿›ç¨‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Supervisor (<a href="http://supervisord.org/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://supervisord.org<!--]--></a>) æ˜¯ä¸€ä¸ªç”¨ Python å†™çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”¨æ¥å¯åŠ¨ã€é‡å¯ã€å…³é—­è¿›ç¨‹ï¼ˆä¸ä»…ä»…æ˜¯ Python è¿›ç¨‹ï¼‰ã€‚é™¤äº†å¯¹å•ä¸ªè¿›ç¨‹çš„æ§åˆ¶ï¼Œè¿˜å¯ä»¥åŒæ—¶å¯åŠ¨ã€å…³é—­å¤šä¸ªè¿›ç¨‹ã€‚</p><p>Supervisor å¯ä»¥è¿è¡Œåœ¨ Linuxã€Mac OS X ä¸Šã€‚å¦‚å‰æ‰€è¿°ï¼Œsupervisor æ˜¯ Python ç¼–å†™çš„ï¼Œæ‰€ä»¥å®‰è£…èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥ç”¨ pip :</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">pip install supervisor</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç°åœ¨è®©æˆ‘ä»¬é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯åŠ¨sshçš„å®¹å™¨ï¼Œæ¥å®éªŒä¸‹supervisorçš„å®‰è£…å’Œç›¸å…³é…ç½®ã€‚ä»¥ä¾¿äºï¼Œæˆ‘ä»¬ç¼–å†™Dockerfileã€‚</p><p><strong>1.å¯åŠ¨æµ‹è¯•supervisorçš„dockerå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 system]# docker run --rm -it unixhot/centos-ssh:v1 /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 /]# ls -l /etc/supervisord*</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 7953 Aug 20 2015 /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">/etc/supervisord.d:</span></span>
<span class="line"><span style="color:#a6accd">total 0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ³¨æ„ï¼Œåœ¨ä¸Šä¸€å°èŠ‚çš„é•œåƒæ„å»ºä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨yumå®‰è£…äº†supervisordã€‚supervisorçš„é…ç½®æ–‡ä»¶ä¸º/etc/supervisord.confã€‚</p><p><strong>2.Supervisoré…ç½®</strong></p><p>Supervisor ç›¸å½“å¼ºå¤§ï¼Œæä¾›äº†å¾ˆä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¸è¿‡æˆ‘ä»¬å¯èƒ½åªéœ€è¦ç”¨åˆ°å…¶ä¸­ä¸€å°éƒ¨åˆ†ã€‚å®‰è£…å®Œæˆä¹‹åï¼Œå¯ä»¥ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œæ¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠé…ç½®åˆ†æˆä¸¤éƒ¨åˆ†ï¼šsupervisordï¼ˆsupervisor æ˜¯ä¸€ä¸ª C/S æ¨¡å‹çš„ç¨‹åºï¼Œè¿™æ˜¯ server ç«¯ï¼Œå¯¹åº”çš„æœ‰ client ç«¯ï¼šsupervisorctlï¼‰å’Œåº”ç”¨ç¨‹åºï¼ˆå³æˆ‘ä»¬è¦ç®¡ç†çš„ç¨‹åºï¼‰ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@98aced104917 /]# vi /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#ä¸‹é¢å¹¶æ²¡æœ‰åˆ—å‡ºå®Œæ•´çš„supervisord.confçš„é…ç½®ï¼Œé»˜è®¤æ³¨é‡Šæ‰çš„å†…å®¹ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**[unix_http_server]**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># file=/var/run/supervisor/supervisor.sock #UNIX socket æ–‡ä»¶ï¼Œsupervisorctl</span></span>
<span class="line"><span style="color:#a6accd">ä¼šä½¿ç”¨</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**[supervisord]**</span></span>
<span class="line"><span style="color:#a6accd">logfile=/var/log/supervisor/supervisord.log #ä¸»è¦æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä½ç½®æ˜¯</span></span>
<span class="line"><span style="color:#a6accd">$CWD/supervisord.log</span></span>
<span class="line"><span style="color:#a6accd">logfile_maxbytes=50MB #æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºä¼š rotateï¼Œé»˜è®¤ 50MB</span></span>
<span class="line"><span style="color:#a6accd">logfile_backups=10 #æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤‡ä»½æ•°é‡é»˜è®¤ 10</span></span>
<span class="line"><span style="color:#a6accd">loglevel=info #æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ infoï¼Œå…¶å®ƒ: debug,warn,trace</span></span>
<span class="line"><span style="color:#a6accd">pidfile=/var/run/supervisord.pid #pidæ–‡ä»¶ä½ç½®</span></span>
<span class="line"><span style="color:#a6accd">**nodaemon=true #æ³¨æ„éœ€è¦ä¿®æ”¹çš„ä¸ºæ­¤å¤„ï¼Œå°†supervisoræ”¾åœ¨å‰å°è¿è¡Œã€‚**</span></span>
<span class="line"><span style="color:#a6accd">minfds=1024 #å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°å€¼ï¼Œé»˜è®¤ 1024</span></span>
<span class="line"><span style="color:#a6accd">minprocs=200 #å¯ä»¥æ‰“å¼€çš„è¿›ç¨‹æ•°çš„æœ€å°å€¼ï¼Œé»˜è®¤ 200</span></span>
<span class="line"><span style="color:#a6accd">**[supervisorctl]**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#é€šè¿‡ UNIX socket è¿æ¥ supervisordï¼Œè·¯å¾„ä¸ unix_http_server éƒ¨åˆ†çš„ file ä¸€è‡´</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">serverurl=unix:///var/run/supervisor/supervisor.sock ; use a unix:// URL for a</span></span>
<span class="line"><span style="color:#a6accd">unix socket</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**[include]**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">#åŒ…å«supervisord.dç›®å½•ä¸‹*.iniæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†éœ€è¦å¯åŠ¨åº”ç”¨ç¨‹åºçš„é…ç½®æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œè¿™å°±æ˜¯è¿ç»´æ ‡å‡†åŒ–ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">files = supervisord.d/*.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3. program é…ç½®</strong></p><p>supervisorä¸»é…ç½®æ–‡ä»¶çš„å˜æ›´åªéœ€è¦ä¿®æ”¹nodaemon=trueï¼Œå¯ä»¥çœ‹åˆ°å…³äºç¨‹åºçš„é…ç½®åœ¨ä¸»é…ç½®æ–‡ä»¶é‡Œé¢éƒ½æ˜¯æ³¨é‡Šæ‰çš„ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">;[program:theprogramname]</span></span>
<span class="line"><span style="color:#a6accd">;command=/bin/cat ; the program (relative uses PATH, can take args)</span></span>
<span class="line"><span style="color:#a6accd">;process_name=%(program_name)s ; process_name expr (default %(program_name)s)</span></span>
<span class="line"><span style="color:#a6accd">;numprocs=1 ; number of processes copies to start (def 1)</span></span>
<span class="line"><span style="color:#a6accd">;directory=/tmp ; directory to cwd to before exec (def no cwd)</span></span>
<span class="line"><span style="color:#a6accd">;umask=022 ; umask for process (default None)</span></span>
<span class="line"><span style="color:#a6accd">;priority=999 ; the relative start priority (default 999)</span></span>
<span class="line"><span style="color:#a6accd">;autostart=true ; start at supervisord start (default: true)</span></span>
<span class="line"><span style="color:#a6accd">;autorestart=true ; retstart at unexpected quit (default: true)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">ï¼ˆçœç•¥éƒ¨åˆ†è¾“å‡ºï¼‰</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ‘ä»¬ç°åœ¨è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯ç¼–å†™ä¸€ä¸ªsshdçš„ç¨‹åºç®¡ç†é…ç½®ï¼Œæ”¾ç½®åˆ°/etc/supervisord.dç›®å½•ä¸‹ï¼Œæ³¨æ„æ–‡ä»¶åç¼€æ˜¯.iniï¼Œä½ å¯ä»¥å¤åˆ¶ä¸Šé¢æ³¨é‡Šæ‰çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@98aced104917 /]# vi /etc/supervisord.d/sshd.ini</span></span>
<span class="line"><span style="color:#a6accd">[program:sshd]</span></span>
<span class="line"><span style="color:#a6accd">command=/usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">process_name=%(program_name)s</span></span>
<span class="line"><span style="color:#a6accd">autostart=true</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_maxbytes=100MB</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_backups=10</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.å¯åŠ¨supervisord</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# /usr/bin/supervisord -c /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# netstat -ntlp</span></span>
<span class="line"><span style="color:#a6accd">Active Internet connections (only servers)</span></span>
<span class="line"><span style="color:#a6accd">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</span></span>
<span class="line"><span style="color:#a6accd">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 31/sshd</span></span>
<span class="line"><span style="color:#a6accd">tcp6 0 0 :::22 :::* LISTEN 31/sshd</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°sshdå·²ç»å¯åŠ¨äº†ã€‚æ˜¯ç”±supervisorè¿›è¡Œå¯åŠ¨çš„ã€‚</p><p><strong>5. ä½¿ç”¨ supervisorctl</strong></p><p>Supervisorctl æ˜¯ supervisord çš„ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†supervisordå¯åŠ¨çš„è¿›ç¨‹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd RUNNING pid 31, uptime 0:02:35</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>åœæ­¢ä¸å¯åŠ¨sshd</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl stop sshd</span></span>
<span class="line"><span style="color:#a6accd">sshd: stopped</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd STOPPED Oct 14 06:45 AM</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl start sshd</span></span>
<span class="line"><span style="color:#a6accd">sshd: started</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd RUNNING pid 42, uptime 0:00:03</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6..å°†supervisord.confé…ç½®æ–‡ä»¶scpåˆ°å®¿ä¸»æœºç›®å½•ä¸‹ï¼Œå’ŒDockerfileåŒç›®å½•</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@98aced104917 /]# scp /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11:/opt/dockerfile/system/centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@98aced104917 ~]# scp /etc/supervisord.d/sshd.ini</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11:/opt/dockerfile/system/centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¥½çš„ï¼Œå¯ä»¥é€€å‡ºå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</p><h3 id="æ ‡å‡†åŒ–centosç³»ç»Ÿé•œåƒ" tabindex="-1">æ ‡å‡†åŒ–CentOSç³»ç»Ÿé•œåƒ <a aria-current="page" href="#æ ‡å‡†åŒ–centosç³»ç»Ÿé•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç°åœ¨æˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ªå…¨æ–°çš„åŒ…å«sshçš„centosç³»ç»Ÿé•œåƒã€‚åŒæ—¶å¦‚æœä½ ä¸éœ€è¦sshã€‚ä½ ä¾ç„¶å¯ä»¥ä½¿ç”¨supervisorè¿è¿›è¡Œè¿›ç¨‹ç®¡ç†ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/system/centos-ssh/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 16</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 554 Oct 14 01:40 Dockerfile</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 142 Oct 14 02:53 sshd.ini</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 7953 Oct 14 02:30 supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>1.é‡æ–°ç¼–å†™Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# vim Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM centos</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#EPEL</span></span>
<span class="line"><span style="color:#a6accd">RUN rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y openssh-clients openssl-devel openssh-server wget mysql-devel</span></span>
<span class="line"><span style="color:#a6accd">supervisor git redis tree net-tools sudo psmisc &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># For SSHD</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key</span></span>
<span class="line"><span style="color:#a6accd">RUN ssh-keygen -A -t dsa -f /etc/ssh/ssh_host_dsa_key</span></span>
<span class="line"><span style="color:#a6accd"># Set root password</span></span>
<span class="line"><span style="color:#a6accd">RUN echo "root:unixhot.com" | chpasswd</span></span>
<span class="line"><span style="color:#a6accd">#Supervisord config</span></span>
<span class="line"><span style="color:#a6accd">ADD supervisord.conf /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">ADD sshd.ini /etc/supervisord.d/sshd.ini</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.æ„å»ºé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# docker build -t unixhot/centos-ssh:latest .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 centos-ssh]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest 0d4b39f9100e 31 seconds ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 About an hour ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 3 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.æ„å»ºå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name centos-ssh-supervisor -p 2222:22</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh</span></span>
<span class="line"><span style="color:#a6accd">9ebf53b3cacd093c11a9b5773c5fc62875626061f3f3fe0b5380013c78f2f15b</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">9ebf53b3cacd unixhot/centos-ssh "/usr/bin/supervisord" 6 seconds ago Up 3</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:2222-&gt;22/tcp centos-ssh-supervisor</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.ä½¿ç”¨sshè¿æ¥å®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ssh root@192.168.56.11 -p 2222</span></span>
<span class="line"><span style="color:#a6accd">root@192.168.56.11's password:</span></span>
<span class="line"><span style="color:#a6accd">[root@9ebf53b3cacd ~]# ps aux</span></span>
<span class="line"><span style="color:#a6accd">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span></span>
<span class="line"><span style="color:#a6accd">root 1 0.3 0.0 117248 14668 ? Ss 07:25 0:00 /usr/bin/python /usr/bin/supervisord</span></span>
<span class="line"><span style="color:#a6accd">-c /etc/supervisord.conf</span></span>
<span class="line"><span style="color:#a6accd">root 9 0.0 0.0 82560 3608 ? S 07:25 0:00 /usr/sbin/sshd -D</span></span>
<span class="line"><span style="color:#a6accd">root 25 1.2 0.0 139272 5428 ? Ss 07:26 0:00 sshd: root@pts/0</span></span>
<span class="line"><span style="color:#a6accd">root 27 0.0 0.0 13376 1984 pts/0 Ss 07:27 0:00 -bash</span></span>
<span class="line"><span style="color:#a6accd">root 40 0.0 0.0 49024 1808 pts/0 R+ 07:27 0:00 ps aux</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æ“ä½œç³»ç»Ÿæ ‡å‡†åŒ–çº¦å®šï¼š</strong></p><p>ç»Ÿä¸€ä½¿ç”¨supervisorè¿›è¡Œè¿›ç¨‹çš„ç®¡ç†</p><p>æ‰€æœ‰Dockerå®¹å™¨ï¼Œä½¿ç”¨centos-sshé•œåƒæ—¶æä¾›supervisorçš„inié…ç½®æ–‡ä»¶ã€‚</p><h2 id="è¿è¡Œç¯å¢ƒé•œåƒ" tabindex="-1">è¿è¡Œç¯å¢ƒé•œåƒ <a aria-current="page" href="#è¿è¡Œç¯å¢ƒé•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ç°åœ¨æœ‰äº†ç³»ç»Ÿé•œåƒï¼Œå½“ç„¶æ–‡ä¸­çš„çŸ¥è¯†æ¡ˆä¾‹ï¼Œå…·ä½“çš„æƒ…å†µå¯ä»¥æ ¹æ®ä½ æ‰€åœ¨ä¼ä¸šçš„å…·ä½“æƒ…å†µè¿›è¡Œç›¸å…³çš„é…ç½®ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿé•œåƒçš„åŸºç¡€ä¸Šæ¥æ„å»ºè¿è¡Œç¯å¢ƒã€‚</p><h3 id="java-è¿è¡Œç¯å¢ƒ" tabindex="-1">Java è¿è¡Œç¯å¢ƒ <a aria-current="page" href="#java-è¿è¡Œç¯å¢ƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Javaç¯å¢ƒåœ¨ç”Ÿäº§ä¸­éå¸¸å¸¸è§ï¼Œä¾‹å¦‚ä¼šå¯åŠ¨ä¸€ä¸ªå•ä¸€çš„Javaå°è¿›ç¨‹å¤„ç†é˜Ÿåˆ—é‡Œé¢çš„å†…å®¹ï¼Œåªéœ€è¦æœ‰JDKå³å¯ã€‚é‚£é¦–å…ˆæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªåªåŒ…å«JDKçš„è¿è¡Œç¯å¢ƒï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/runtime/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# mkdir java</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Javaè¿è¡Œç¯å¢ƒè¦åŸºäºcentos-sshçš„é•œåƒæ¥æ“ä½œï¼Œæ‰€ä»¥å…ˆè¿è¡Œä¸€ä¸ªä¸´æ—¶å®¹å™¨æ¥æ„å»ºJavaè¿è¡Œç¯å¢ƒï¼Œç„¶åæŠŠæ“ä½œæ­¥éª¤è½¬æ¢ä¸ºDockerfileã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --rm -it unixhot/centos-ssh /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@ec2696c0f9f4 /]# yum install -y java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd">java-1.8.0-openjdk-devel</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿ç”¨yumå®‰è£…çš„openjdkï¼Œé»˜è®¤å¯ä»¥ä¸è®¾ç½®JAVA_HOMEï¼Œå³å¯æ‰§è¡Œç›¸å…³çš„javaç¨‹åºã€‚</p><p><strong>1.ç¼–å†™Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# vim java/Dockerfile</span></span>
<span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM unixhot/centos-ssh</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># JAVA_HOME</span></span>
<span class="line"><span style="color:#a6accd">ENV JAVA_HOME /usr/lib/jvm/java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.æ„å»ºé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# docker build -t unixhot/runtime-java ./java/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-java latest ff3a2bb0b2a9 2 minutes ago 505.1 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest 02d375a33cd1 38 minutes ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 2 hours ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 4 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å½“ç„¶ååˆ†å¯ä»¥ä½¿ç”¨ï¼Œéœ€è¦å¤§å®¶å»è¿è¡Œä¸€ä¸ªå°ç¨‹åºè¿›è¡Œæµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚</p><h3 id="tomcatè¿è¡Œç¯å¢ƒ" tabindex="-1">Tomcatè¿è¡Œç¯å¢ƒ <a aria-current="page" href="#tomcatè¿è¡Œç¯å¢ƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>ç›¸å¯¹äºå•ä¸€ä½¿ç”¨Javaå‘½ä»¤å¯åŠ¨JavaæœåŠ¡ï¼ŒTomcat</strong></p><p><strong>1.å¯åŠ¨centos-sshé•œåƒçš„å®ä¾‹</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run --rm -it unixhot/centos-ssh /bin/bash</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef /]# yum install -y java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd">java-1.8.0-openjdk-devel</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨Javaçš„è¿è¡Œç¯å¢ƒæ„å»ºTomcatï¼Ÿ</strong></p><p>é¦–å…ˆï¼Œç¡®å®å¯ä»¥ç›´æ¥ä½¿ç”¨Javaçš„è¿è¡Œç¯å¢ƒæ¥è¿›è¡ŒTomcatçš„æ„å»ºï¼Œä½†æ˜¯ä¼šç ´åæˆ‘ä»¬ç³»ç»Ÿå±‚ã€è¿è¡Œç¯å¢ƒå±‚ã€ä¸šåŠ¡å±‚çš„æ¶æ„ï¼Œä¹Ÿå°±æ˜¯å°†ä¾èµ–å…³ç³»å¤æ‚è¯äº†ï¼Œè¿™è¦æ ¹æ®ä¼ä¸šè‡ªèº«æƒ…å†µæ¥åšã€‚æˆ‘å…ˆè¯´è¯´æˆ‘çš„ç†ç”±ï¼š</p><p>å¦‚æœTomcatä½¿ç”¨çš„Javaç‰ˆæœ¬è¦å‡çº§åˆ°JDK 1.8ç‰ˆæœ¬ï¼Œè€ŒJavaè¿è¡Œç¯å¢ƒçš„ç‰ˆæœ¬æ˜¯1.7ï¼Œä¸èƒ½å‡çº§ï¼Œå› ä¸ºæœ‰å¾ˆå¤šæœåŠ¡å°±æ˜¯åœ¨JDK 1.7çš„ç¯å¢ƒä¸‹å¼€å‘çš„ï¼Œæœªè¿›è¡Œè¿ç§»ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœTomcatæ˜¯åŸºäºJava 1.7çš„è¿è¡Œç¯å¢ƒæ„å»ºçš„ï¼Œå°±å‡ºç°ä¾èµ–å…³ç³»äº†ã€‚æ‰€ä»¥ï¼Œä»…ä»…æ˜¯ä¸ªäººçš„å»ºè®®ï¼šè®©é—®é¢˜ç®€å•åŒ–ï¼</p><p><strong>2.å®‰è£…éƒ¨ç½²Tomcat 8</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@80f529b965ef /]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# wget http://mirrors.cnnic.cn/apache/tomcat/tomcat-8/v8.5.6/bin/apache-tomcat-8.5.6.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# tar zxf apache-tomcat-8.5.6.tar</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# mv apache-tomcat-8.5.6 /usr/local/</span></span>
<span class="line"><span style="color:#a6accd">[root@80f529b965ef src]# ln -s /usr/local/apache-tomcat-8.5.6/</span></span>
<span class="line"><span style="color:#a6accd">/usr/local/tomcat</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.ä½¿ç”¨supervisorå¯åŠ¨tomcat</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@897cc10b8adf ~]# cd /etc/supervisord.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@897cc10b8adf supervisord.d]# vi tomcat.ini</span></span>
<span class="line"><span style="color:#a6accd">[program:tomcat]</span></span>
<span class="line"><span style="color:#a6accd">command=/usr/local/tomcat/bin/catalina.sh run</span></span>
<span class="line"><span style="color:#a6accd">process_name=%(program_name)s</span></span>
<span class="line"><span style="color:#a6accd">autostart=true</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_maxbytes=100MB</span></span>
<span class="line"><span style="color:#a6accd">stdout_logfile_backups=10</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æ›´æ–°supervisorå¹¶æŸ¥çœ‹tomcatçŠ¶æ€</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@897cc10b8adf supervisord.d]# supervisorctl update</span></span>
<span class="line"><span style="color:#a6accd">tomcat: stopped</span></span>
<span class="line"><span style="color:#a6accd">tomcat: updated process group</span></span>
<span class="line"><span style="color:#a6accd">[root@897cc10b8adf supervisord.d]# supervisorctl status</span></span>
<span class="line"><span style="color:#a6accd">sshd RUNNING pid 408, uptime 0:06:00</span></span>
<span class="line"><span style="color:#a6accd">tomcat RUNNING pid 704, uptime 0:00:03</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.å‡†å¤‡Dockerfileçš„æ„å»ºç¯å¢ƒ</strong></p><p>ç°åœ¨æˆ‘ä»¬å¼€å§‹ç¼–å†™Dockerfileï¼Œåœ¨ç¼–å†™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå†³å®šä¸€ä»¶äº‹æƒ…ï¼Œapache-tomcatçš„åŒ…ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯åƒå®éªŒä¸­ä½¿ç”¨wgetè¿›è¡Œä¸‹è½½å¹¶è§£å‹å‘¢ï¼Œè¿˜æ˜¯åº”è¯¥æå‰å°†åŒ…æ”¾åœ¨å®¿ä¸»æœºï¼Œæ„å»ºçš„æ—¶å€™ä½¿ç”¨Dockerfile ADDè¿›è¡Œå‘¢ã€‚</p><p>æˆ‘å»ºè®®é€‰æ‹©åè€…ï¼Œå› ä¸ºå®é™…çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¦å¯¹Tomcatè¿›è¡Œå¾ˆå¤šå®šåˆ¶åŒ–çš„é…ç½®ï¼Œä¾‹å¦‚è¿›è¡Œå®‰å…¨è§„èŒƒçš„è°ƒæ•´ç­‰ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬èƒ½æ¼”ç¤ºçš„å°±æ˜¯ç›´æ¥ä¸‹è½½ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œè¿™ä¸ªå·²ç»æ˜¯ä½ ä¿®æ”¹è¿‡çš„è½¯ä»¶åŒ…ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/runtime/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# mkdir tomcat</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 runtime]# cd tomcat/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# wget http://mirrors.cnnic.cn/apache/tomcat/tomcat-8/v8.5.6/bin/apache-tomcat-8.5.6.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.ç¼–å†™Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM unixhot/centos-ssh</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd">#Base pkg</span></span>
<span class="line"><span style="color:#a6accd">RUN yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#a6accd"># JAVA_HOME</span></span>
<span class="line"><span style="color:#a6accd">ENV JAVA_HOME /usr/lib/jvm/java-1.8.0-openjdk</span></span>
<span class="line"><span style="color:#a6accd"># Tomcat</span></span>
<span class="line"><span style="color:#a6accd">ADD apache-tomcat-8.5.6.tar.gz /usr/local/</span></span>
<span class="line"><span style="color:#a6accd">RUN ln -s /usr/local/apache-tomcat-8.5.6 /usr/local/tomcat</span></span>
<span class="line"><span style="color:#a6accd">ADD tomcat.ini /etc/supervisord.d/tomcat.ini</span></span>
<span class="line"><span style="color:#a6accd">ENV TOMCAT_HOME /usr/local/tomcat</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22 8080</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.æ„å»ºtomcaté•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 9096</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 9304958 Oct 6 16:39 apache-tomcat-8.5.6.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 546 Oct 14 05:51 Dockerfile</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 165 Oct 14 06:33 tomcat.ini</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker build -t unixhot/runtime-tomcat .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>7.æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-tomcat latest ef8372a88ad4 6 minutes ago 518.2 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-java latest ff3a2bb0b2a9 2 hours ago 505.1 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest 02d375a33cd1 3 hours ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 ff1ab7d7e7f4 4 hours ago 304 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 4edcb790dacf 6 hours ago 303 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>8.æ„å»ºtomcat-demoå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker run -d --name tomcat-demo -p 88:8080 -p</span></span>
<span class="line"><span style="color:#a6accd">89:22 unixhot/runtime-tomcat</span></span>
<span class="line"><span style="color:#a6accd">8cea3ef85634210eb0cfab0f65a63b0ebd6961b5a67fc765b762785c01cd2c18</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 tomcat]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">8cea3ef85634 unixhot/runtime-tomcat "/usr/bin/supervisord" 5 seconds ago Up 2</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:89-&gt;22/tcp, 0.0.0.0:88-&gt;8080/tcp tomcat-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>9.è®¿é—®tomcat</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">http://192.168.56.11:88/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="åº”ç”¨é•œåƒ" tabindex="-1">åº”ç”¨é•œåƒ <a aria-current="page" href="#åº”ç”¨é•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æœ€ä¸Šå±‚çš„ä¸šåŠ¡é•œåƒå°±æ˜¯åœ¨è¿è¡Œç¯å¢ƒçš„åŸºç¡€ä¸Šï¼Œç›´æ¥ä½¿ç”¨æˆ–è€…æ ¹æ®ä¸šåŠ¡æƒ…å†µå†æ¬¡è¿›è¡ŒäºŒæ¬¡å®šåˆ¶ã€‚ä¾‹å¦‚å¯¹äºPHPè¿è¡Œç¯å¢ƒï¼Œé»˜è®¤åªå®‰è£…åŸºç¡€é€šç”¨çš„æ¨¡å—ï¼Œå¯¹äºä¸šåŠ¡éœ€è¦çš„æ—¶å€™å†æ¬¡è¿›è¡ŒäºŒæ¬¡æ„å»ºã€‚è¿™é‡Œæˆ‘ä»¬æ‹¿ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„Jenkinsæ¥æ¨¡æ‹Ÿã€‚</p><h3 id="jenkinsé•œåƒæ„å»º" tabindex="-1">Jenkinsé•œåƒæ„å»º <a aria-current="page" href="#jenkinsé•œåƒæ„å»º" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>JenkinsJenkinsæ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·ï¼Œå®ƒæœ‰è‡ªå·±çš„yumå®‰è£…æ–¹å¼ï¼Œä½†æ˜¯æœ€ç›´æ¥çš„è¿˜æ˜¯ç›´æ¥ä¸‹è½½waråŒ…å­˜æ”¾åˆ°tomcatç›®å½•ä¸‹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /opt/dockerfile/app/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 app]# mkdir jenkins</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 app]# cd jenkins/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# wget http://mirrors.jenkins-ci.org/war/latest/jenkins.war</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.ç¼–å†™Dockerfile</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># Docker for CentOS</span></span>
<span class="line"><span style="color:#a6accd">#Base image</span></span>
<span class="line"><span style="color:#a6accd">FROM unixhot/runtime-tomcat</span></span>
<span class="line"><span style="color:#a6accd">#Who</span></span>
<span class="line"><span style="color:#a6accd">MAINTAINER Jason.Zhao xxx@gmail.com</span></span>
<span class="line"><span style="color:#a6accd"># Jenkins</span></span>
<span class="line"><span style="color:#a6accd">ADD jenkins.war /usr/local/tomcat/webapps/</span></span>
<span class="line"><span style="color:#a6accd"># Outside Port</span></span>
<span class="line"><span style="color:#a6accd">EXPOSE 22 8080</span></span>
<span class="line"><span style="color:#a6accd">#supervisord start</span></span>
<span class="line"><span style="color:#a6accd">CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.æ„å»ºjenkinsé•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker build -t unixhot/jenkins .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.æŸ¥çœ‹é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker images | grep unixhot</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins latest a7b16bc093ed 40 seconds ago 588.7 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-tomcat latest 3b596c9a7696 2 hours ago 518.8 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/runtime-java latest 476a6a2fc074 2 hours ago 505.8 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh latest d85aa8a9dfd4 3 hours ago 304.6 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos-ssh v1 3309208ed679 4 hours ago 300.9 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/centos latest 83f0491a30e1 4 hours ago 282.3 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.åˆ›å»ºjenkins-demoå®¹å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker run -d --name jenkins-demo -p 91:22 -p</span></span>
<span class="line"><span style="color:#a6accd">92:8080 unixhot/jenkins</span></span>
<span class="line"><span style="color:#a6accd">6d88ba756befc84ef1820818994be028c12ac13825c2b439d680358d101e922e</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">6d88ba756bef unixhot/jenkins "/usr/bin/supervisord" 7 seconds ago Up 2 seconds</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:91-&gt;22/tcp, 0.0.0.0:92-&gt;8080/tcp jenkins-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.è®¿é—®jenkinså¹¶è¿›è¡Œåˆå§‹åŒ–å®‰è£…</strong></p><p><img src="http://k8s.unixhot.com/docker/media/e59722d6316d2cc9702c1989e1c9f3f1.png" alt="img"></p><p>å½“ç„¶å¦‚æœä½ æƒ³æ„å»ºä¸€ä¸ªå¯åŠ¨åç›´æ¥å°±å¯ä»¥ä½¿ç”¨çš„Jenkinsï¼Œå¯ä»¥åœ¨å®‰è£…å®Œæ¯•åï¼ŒæŠŠåˆšæ‰çš„å®¹å™¨é‡æ–°æäº¤æˆä¸ºé•œåƒã€‚</p><p><strong>7.å®‰è£…Jenkinså¹¶æäº¤æˆä¸ºjenkins-loginé•œåƒã€‚</strong></p><p>è¿›å…¥é•œåƒæˆ–è€…å®‰è£…çš„å¯†ç ï¼Œå¡«å…¥å¯†ç æ¡†å¹¶ç»§ç»­ã€‚åé¢æ­¥éª¤çœç•¥ã€‚å…¨éƒ¨å®‰è£…é»˜è®¤å³å¯ã€‚æ³¨æ„å®‰è£…æ’ä»¶æ—¶æ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ./docker_in.sh jenkins-demo</span></span>
<span class="line"><span style="color:#a6accd">[root@b3bbada66693 /]# cat /root/.jenkins/secrets/initialAdminPassword</span></span>
<span class="line"><span style="color:#a6accd">b5257b8891464ebf890b38c00d24de71</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>è·å–Container IDï¼š</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">b3bbada66693 unixhot/jenkins "/usr/bin/supervisord" 9 minutes ago Up 9 minutes</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:91-&gt;22/tcp, 0.0.0.0:92-&gt;8080/tcp jenkins-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æäº¤æ–°çš„é•œåƒ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker commit -m "jenkins login" b3bbada66693</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins-login</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker images | grep jenkins</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins-login latest c453363bb9f7 22 seconds ago 776.6 MB</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins latest a7b16bc093ed 13 minutes ago 588.7 MB</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>8.ä½¿ç”¨jenkins-loginé•œåƒæ„å»ºå®¹å™¨</strong></p><p>ç°åœ¨å¯ä»¥ä½¿ç”¨çš„Jenkinså®¹å™¨è¯ç”Ÿäº†ï¼Œèµ¶ç´§åˆ›å»ºä¸€ä¸ªå®¹å™¨æ¥è¿›è¡Œä½¿ç”¨å§ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name jenkins-login -p 93:22 -p 94:8080</span></span>
<span class="line"><span style="color:#a6accd">unixhot/jenkins-login</span></span>
<span class="line"><span style="color:#a6accd">af421b4d5b076c756ab58ed8cc95c615a321f9517d30b755667d5d80d1336a63</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker ps -l</span></span>
<span class="line"><span style="color:#a6accd">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span></span>
<span class="line"><span style="color:#a6accd">af421b4d5b07 unixhot/jenkins-login "/usr/bin/supervisord" 4 seconds ago Up 2</span></span>
<span class="line"><span style="color:#a6accd">seconds 0.0.0.0:93-&gt;22/tcp, 0.0.0.0:94-&gt;8080/tcp jenkins-login</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>9.è®¿é—®Jenkinså®¹å™¨ï¼Œå¼€å§‹æŒç»­é›†æˆä¹‹è·¯</strong></p><p><img src="http://k8s.unixhot.com/docker/media/04b8b149d6c7ce1e18f67796998be9b5.png" alt="img"></p><h1 id="_3-dockerç§æœ‰ä»“åº“å®è·µ" tabindex="-1">3 Dockerç§æœ‰ä»“åº“å®è·µ <a aria-current="page" href="#_3-dockerç§æœ‰ä»“åº“å®è·µ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h2 id="docker-registry" tabindex="-1">Docker Registry <a aria-current="page" href="#docker-registry" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="åˆ›å»ºdocker-registry" tabindex="-1">åˆ›å»ºDocker Registry <a aria-current="page" href="#åˆ›å»ºdocker-registry" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨å®‰è£…äº† Docker åï¼Œå¯ä»¥é€šè¿‡è·å–å®˜æ–¹ registry é•œåƒæ¥è¿è¡Œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --name docker-registry -p 5000:5000 registry</span></span>
<span class="line"><span style="color:#a6accd">b822d0a3e77e6a3144408119ccc2e7344f60f7404651adc025ce84561245b2d2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="é…ç½®dockerä¿¡ä»»ä»“åº“" tabindex="-1">é…ç½®Dockerä¿¡ä»»ä»“åº“ <a aria-current="page" href="#é…ç½®dockerä¿¡ä»»ä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">"registry-mirrors": ["https://tdimi5q1.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">"insecure-registries" : ["http://192.168.56.11:5000"]</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="pushé•œåƒåˆ°docker-registry" tabindex="-1">Pushé•œåƒåˆ°Docker Registry <a aria-current="page" href="#pushé•œåƒåˆ°docker-registry" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker tag system/centos 192.168.56.11:5000/system/centos</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker push 192.168.56.11:5000/system/centos</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="registryé¡¹ç›®harbor" tabindex="-1">Registryé¡¹ç›®Harbor <a aria-current="page" href="#registryé¡¹ç›®harbor" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä¸Šé¢æˆ‘ä»¬ç®€å•çš„ä»‹ç»äº†Docker Registryçš„ä½¿ç”¨ï¼Œä½†æ˜¯çœŸæ­£ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬æ— æ³•æœ‰æ•ˆçš„ç®¡ç†Docker Regisryã€‚å®˜æ–¹æä¾›äº†æ”¶è´¹ç‰ˆçš„Registryï¼Œç¤¾åŒºæœ‰å¼€æºç‰ˆæœ¬çš„Harborã€‚</p><p><strong>Harborç®€ä»‹</strong></p><p>Harboræ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„ä¼ä¸šçº§RegistryæœåŠ¡å™¨ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¾‹å¦‚å®‰å…¨ã€æ ‡è¯†å’Œç®¡ç†ç­‰ï¼Œæ‰©å±•äº†å¼€æºDocker Distributionã€‚ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§ç§æœ‰RegistryæœåŠ¡å™¨ï¼ŒHarboræä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ã€‚æå‡ç”¨æˆ·ä½¿ç”¨Registryæ„å»ºå’Œè¿è¡Œç¯å¢ƒä¼ è¾“é•œåƒçš„æ•ˆç‡ã€‚Harboræ”¯æŒå®‰è£…åœ¨å¤šä¸ªRegistryèŠ‚ç‚¹çš„é•œåƒèµ„æºå¤åˆ¶ï¼Œé•œåƒå…¨éƒ¨ä¿å­˜åœ¨ç§æœ‰Registryä¸­ï¼Œ ç¡®ä¿æ•°æ®å’ŒçŸ¥è¯†äº§æƒåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œä¸­ç®¡æ§ã€‚å¦å¤–ï¼ŒHarborä¹Ÿæä¾›äº†é«˜çº§çš„å®‰å…¨ç‰¹æ€§ï¼Œè¯¸å¦‚ç”¨æˆ·ç®¡ç†ï¼Œè®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡è®¡ç­‰ã€‚</p><p>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ - ç”¨æˆ·ä¸Dockeré•œåƒä»“åº“é€šè¿‡â€œé¡¹ç›®â€è¿›è¡Œç»„ç»‡ç®¡ç†ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥å¯¹å¤šä¸ªé•œåƒä»“åº“åœ¨åŒä¸€å‘½åç©ºé—´ï¼ˆprojectï¼‰é‡Œæœ‰ä¸åŒçš„æƒé™ã€‚</p><p>é•œåƒå¤åˆ¶ - é•œåƒå¯ä»¥åœ¨å¤šä¸ªRegistryå®ä¾‹ä¸­å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰ã€‚å°¤å…¶é€‚åˆäºè´Ÿè½½å‡è¡¡ï¼Œé«˜å¯ç”¨ï¼Œæ··åˆäº‘å’Œå¤šäº‘çš„åœºæ™¯ã€‚</p><p>å›¾å½¢åŒ–ç”¨æˆ·ç•Œé¢ - ç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æµè§ˆï¼Œæ£€ç´¢å½“å‰Dockeré•œåƒä»“åº“ï¼Œç®¡ç†é¡¹ç›®å’Œå‘½åç©ºé—´ã€‚</p><p>AD/LDAP æ”¯æŒ - Harborå¯ä»¥é›†æˆä¼ä¸šå†…éƒ¨å·²æœ‰çš„AD/LDAPï¼Œç”¨äºé‰´æƒè®¤è¯ç®¡ç†ã€‚</p><p>å®¡è®¡ç®¡ç† - æ‰€æœ‰é’ˆå¯¹é•œåƒä»“åº“çš„æ“ä½œéƒ½å¯ä»¥è¢«è®°å½•è¿½æº¯ï¼Œç”¨äºå®¡è®¡ç®¡ç†ã€‚</p><p>å›½é™…åŒ– - å·²æ‹¥æœ‰è‹±æ–‡ã€ä¸­æ–‡ã€å¾·æ–‡ã€æ—¥æ–‡å’Œä¿„æ–‡çš„æœ¬åœ°åŒ–ç‰ˆæœ¬ã€‚æ›´å¤šçš„è¯­è¨€å°†ä¼šæ·»åŠ è¿›æ¥ã€‚</p><p>RESTful API - RESTful API æä¾›ç»™ç®¡ç†å‘˜å¯¹äºHarboræ›´å¤šçš„æ“æ§, ä½¿å¾—ä¸å…¶å®ƒç®¡ç†è½¯ä»¶é›†æˆå˜å¾—æ›´å®¹æ˜“ã€‚</p><p>éƒ¨ç½²ç®€å• - æä¾›åœ¨çº¿å’Œç¦»çº¿ä¸¤ç§å®‰è£…å·¥å…·ï¼Œ ä¹Ÿå¯ä»¥å®‰è£…åˆ°vSphereå¹³å°(OVAæ–¹å¼)è™šæ‹Ÿè®¾å¤‡ã€‚</p><h3 id="harboréƒ¨ç½²" tabindex="-1">Harboréƒ¨ç½² <a aria-current="page" href="#harboréƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Harborä¸ºè¿ç»´æä¾›äº†å¤šç§éƒ¨ç½²æ–¹æ³•ï¼Œä½ å¯ä»¥ç›´æ¥cloneæœ€æ–°ä»£ç ï¼Œä¹Ÿå¯ä»¥æ”¯æŒofflineçš„éƒ¨ç½²æ–¹æ³•ï¼Œç›´æ¥ä¸‹è½½å®˜æ–¹æ„å»ºå¥½çš„é•œåƒæ¥è¿›è¡Œä½¿ç”¨ã€‚å¯ä»¥åœ¨githubçš„releasesæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ï¼Œæœ¬æ–‡æ˜¯1.7.1ç‰ˆæœ¬ã€‚<em><a href="https://github.com/vmware/harbor/releases" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://github.com/vmware/harbor/releases<!--]--></a></em></p><p>å»ºè®®ä¸‹è½½offlineçš„å‹ç¼©åŒ…ï¼Œé‡Œé¢åŒ…å«äº†harborå¯åŠ¨æ‰€ç”¨çš„æ‰€æœ‰dockeré•œåƒï¼Œå¯ä»¥å¿«é€Ÿçš„éƒ¨ç½²harborã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"># wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.1.tgz</span></span>
<span class="line"><span style="color:#a6accd"># tar zxf harbor-offline-installer-v1.7.1.tgz</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Harborçš„æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä»¥Dockerå®¹å™¨çš„å½¢å¼æ„å»ºçš„ï¼Œä½¿ç”¨Docker Composeæ¥å¯¹å®ƒè¿›è¡Œéƒ¨ç½²ï¼Œä½ å¯ä»¥æŸ¥çœ‹docker-compose.ymlæ–‡ä»¶ã€‚</p><h3 id="harboré…ç½®" tabindex="-1">Harboré…ç½® <a aria-current="page" href="#harboré…ç½®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>ä¸ºHarboré…ç½®HTTPè®¿é—®</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd harbor</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 harbor]# vim harbor.cfg</span></span>
<span class="line"><span style="color:#a6accd">hostname = 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>é…ç½®Dockerä¿¡ä»»ä»“åº“</strong></p><p>å¦‚æœä½¿ç”¨httpçš„æ–¹å¼é…ç½®harboréœ€è¦ä¸ºæ‰€æœ‰Dockeræ·»åŠ ä¿¡ä»»é…ç½®ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">"registry-mirrors": ["https://tdimi5q1.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">"insecure-registries" : ["http://192.168.56.11"]</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ä¸ºHarboré…ç½®httpsè®¿é—®</strong></p><p>é»˜è®¤æƒ…å†µä¸‹Harboræ˜¯ä½¿ç”¨httpè¿›è¡Œè®¿é—®ï¼Œå®˜æ–¹æä¾›äº†è‡ªç­¾åè¯ä¹¦çš„æ–¹æ³•ï¼Œä¸è¿‡ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯å»ºè®®è´­ä¹°SSLè¯ä¹¦ã€‚</p><p><strong>1.ç”³è¯·è¯ä¹¦</strong></p><p>å¦‚æœä½ æ²¡æœ‰SSLè¯ä¹¦ï¼Œé‚£ä¹ˆä¹Ÿä¸è¦ä½¿ç”¨ç½‘ä¸Šå¤æ‚çš„è‡ªç­¾åè¯ä¹¦çš„æ­¥éª¤äº†ã€‚ç›®å‰é˜¿é‡Œäº‘æä¾›Symantec å…è´¹å‹DV SSLè¯ä¹¦ã€‚ç”³è¯·æˆåŠŸåï¼Œä¸‹è½½Nginxç‰ˆæœ¬çš„è¯ä¹¦æ–‡ä»¶ã€‚</p><p><strong>2.Harboré…ç½®</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@docker-node1 harbor]# cd /usr/local/src/harbor/</span></span>
<span class="line"><span style="color:#a6accd">[root@docker-node1 harbor]# vim harbor.cfg</span></span>
<span class="line"><span style="color:#a6accd">hostname = reg.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">ui_url_protocol = https</span></span>
<span class="line"><span style="color:#a6accd">ssl_cert = /usr/local/src/harbor/1_registry.linuxhot.com_bundle.crt</span></span>
<span class="line"><span style="color:#a6accd">ssl_cert_key = /usr/local/src/harbor/2_registry.linuxhot.com.key</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¯·å°†è¯ä¹¦æ”¾ç½®åœ¨å®¿ä¸»æœºä¸Šï¼Œå¹¶é…ç½®æ­£ç¡®çš„è¯ä¹¦è·¯å¾„ã€‚</p><p><strong>Docker Composeå®‰è£…</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]#yum install -y docker-compose</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker-compose --version</span></span>
<span class="line"><span style="color:#a6accd">docker-compose version 1.8.0, build 94f7016</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>å®‰è£…Harbor</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-harbor-1 ~]# cd /usr/local/src/harbor/</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-harbor-1 harbor]# ./install.sh</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹HarborçŠ¶æ€</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-harbor-1 harbor]# docker-compose ps</span></span>
<span class="line"><span style="color:#a6accd">Name Command State Ports</span></span>
<span class="line"><span style="color:#a6accd">------------------------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">harbor-adminserver /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd">harbor-core /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd">harbor-db /entrypoint.sh postgres Up 5432/tcp</span></span>
<span class="line"><span style="color:#a6accd">harbor-jobservice /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd">harbor-log /bin/sh -c /usr/local/bin/ ... Up 127.0.0.1:1514-&gt;10514/tcp</span></span>
<span class="line"><span style="color:#a6accd">harbor-portal nginx -g daemon off; Up 80/tcp</span></span>
<span class="line"><span style="color:#a6accd">nginx nginx -g daemon off; Up 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp,</span></span>
<span class="line"><span style="color:#a6accd">0.0.0.0:80-&gt;80/tcp</span></span>
<span class="line"><span style="color:#a6accd">redis docker-entrypoint.sh redis ... Up 6379/tcp</span></span>
<span class="line"><span style="color:#a6accd">registry /entrypoint.sh /etc/regist ... Up 5000/tcp</span></span>
<span class="line"><span style="color:#a6accd">registryctl /harbor/start.sh Up</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ä½¿ç”¨harborç®¡ç†registry" tabindex="-1">ä½¿ç”¨Harborç®¡ç†Registry <a aria-current="page" href="#ä½¿ç”¨harborç®¡ç†registry" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç°åœ¨ä½ å°±å¯ä»¥è®¿é—®ä½ çš„åŸŸå<a href="http://reg.linuxhot.xn--com-vj3fu53h4lw8bl.xn--admin%2Charbor12345-8l75a8z3f3f3fwrmtj9hrk9d./" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://reg.linuxhot.comè¿›è¡Œç™»å½•ã€‚é»˜è®¤ç”¨æˆ·adminï¼Œå¯†ç Harbor12345ã€‚<!--]--></a></p><p><img src="http://k8s.unixhot.com/docker/media/366c20c68d5e6467434fb8108baa6081.png" alt="img"></p><p>ç™»å½•åçš„ç¬¬ä¸€ä»¶äº‹æƒ…æ°¸è¿œéƒ½æ˜¯ä¿®æ”¹é»˜è®¤å¯†ç ã€‚ç„¶åä½ å°±å¯ä»¥åœ¨é¡¹ç›®ç®¡ç†ä¸­ï¼Œæ–°å»ºå’Œç®¡ç†é¡¹ç›®äº†ã€‚ä¸è¿‡é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„é¡¹ç›®libraryæ˜¯å…¬å¼€çš„ï¼Œå¦‚æœä½ è¦ä½¿ç”¨è¿™ä¸ªé¡¹ç›®ï¼Œè€Œä¸”åŸŸåæ”¾åœ¨å…¬ç½‘ä¸Šï¼Œè¯·å–æ¶ˆå…¬å¼€ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker login reg.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">Username: admin</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span>
<span class="line"><span style="color:#a6accd">Configure a credential helper to remove this warning. See</span></span>
<span class="line"><span style="color:#a6accd">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span>
<span class="line"><span style="color:#a6accd">Login Succeeded</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æäº¤é•œåƒåˆ°Registry</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># docker tag centos:latest reg.linuxhot.com/system/centos:latest</span></span>
<span class="line"><span style="color:#a6accd"># docker push reg.linuxhot.com/system/centos:latest</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="kuberneteså¿«é€Ÿå…¥é—¨" tabindex="-1">Kuberneteså¿«é€Ÿå…¥é—¨ <a aria-current="page" href="#kuberneteså¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>å­¦ä¹ Kubernetesæœ€æƒå¨çš„çŸ¥è¯†æ¥æºå°±æ˜¯Kuberneteså®˜æ–¹æ–‡æ¡£ï¼Œè€Œä¸”å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå®˜æ–¹æ–‡æ¡£å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚æœ¬ç« å°†å¸¦ä½ å¾ªå¾ªåºæ¸è¿›çš„å­¦ä¹ Kubernetesï¼Œåé¢ç« èŠ‚ä¼šé€šè¿‡å¤§é‡çš„å®è·µæ¡ˆä¾‹æ¥ç†è§£å’ŒæŒæ¡Kubernetesçš„çŸ¥è¯†ã€‚</p><ul><li>Kuberneteså®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/docs/home/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://kubernetes.io/docs/home/<!--]--></a></li><li>Kuernetes Githubï¼š<a href="https://github.com/kubernetes/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://github.com/kubernetes/<!--]--></a></li></ul><h2 id="kubernetesæ¶æ„ä»‹ç»" tabindex="-1">Kubernetesæ¶æ„ä»‹ç» <a aria-current="page" href="#kubernetesæ¶æ„ä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Kubernetes æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸º â€œèˆµæ‰‹â€ æˆ– â€œé£è¡Œå‘˜â€ï¼Œæ˜¯ç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼Œæ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¼€æºç³»ç»Ÿï¼Œç”±äºKå’ŒSä¹‹é—´æœ‰8ä¸ªå­—æ¯ï¼Œè¢«ç®€ç§°ä¸ºK8Sã€‚Kubernetes æ„å»ºåœ¨ Google 15 å¹´ç”Ÿäº§ç¯å¢ƒç»éªŒåŸºç¡€ä¹‹ä¸Šï¼Œå¯ä»¥å°†Kubernetesçœ‹ä½œä¸ºGoogleå†…éƒ¨çš„å®¹å™¨ç®¡ç†å¹³å°Brogçš„å¼€æºç‰ˆæœ¬ï¼Œå½“ç„¶ä»–ä»¬ä¹‹é—´æ˜¯æœ‰ä¸€äº›å·®å¼‚çš„ã€‚</p><h3 id="kubernetesç³»ç»Ÿæ¶æ„" tabindex="-1">Kubernetesç³»ç»Ÿæ¶æ„ <a aria-current="page" href="#kubernetesç³»ç»Ÿæ¶æ„" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Kubernetesè¢«è®¾è®¡ä¸ºMasterå’ŒNodeä¸¤ä¸ªè§’è‰²ï¼Œè¿™ç±»ä¼¼äºOpenStackçš„æ¶æ„ç†å¿µï¼ŒMasterä¸ºæ§åˆ¶èŠ‚ç‚¹ï¼ŒNodeä¸ºè®¡ç®—èŠ‚ç‚¹æˆ–è€…å«å·¥ä½œèŠ‚ç‚¹ï¼Œåœ¨MasterèŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªAPI ServeræœåŠ¡ï¼Œå¯¹å¤–æä¾›æ ‡å‡†çš„RestAPIï¼Œè¿™ä¹Ÿæ˜¯Kubernetesé›†ç¾¤çš„å…¥å£ï¼Œæ„å¤–ç€åªè¦å’Œé›†ç¾¤è¿›è¡Œäº¤äº’å¿…é¡»è¿æ¥åˆ°API Serverä¸Šã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/4f93fc22b605a967fa54a2491557c04e.png" alt="img"></p><p><strong>MasterèŠ‚ç‚¹ä»‹ç»</strong></p><p>Kubernetes MasterèŠ‚ç‚¹ä¸»è¦æœ‰4ä¸ªç»„ä»¶ï¼ŒAPI Serverã€Schedulerã€Controllerã€etcdã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://k8s.unixhot.com/kubernetes/media/0786901c59be2f756d7b979619a048b2.png" alt="img"></p><ul><li><strong>API Server</strong>ï¼šæä¾›Kubernetes APIæ¥å£ï¼Œä¸»è¦å¤„ç† Restæ“ä½œä»¥åŠæ›´æ–°Etcdä¸­çš„å¯¹è±¡ã€‚æ˜¯æ‰€æœ‰èµ„æºå¢åˆ æ”¹æŸ¥çš„å”¯ä¸€å…¥å£ã€‚</li><li><strong>Scheduler</strong>ï¼šç»‘å®šPodåˆ°Nodeä¸Šï¼Œä¸»è¦åšèµ„æºè°ƒåº¦ã€‚</li><li><strong>Controller Manager</strong>ï¼šæ‰€æœ‰å…¶ä»–ç¾¤é›†çº§åˆ«çš„åŠŸèƒ½ï¼Œç›®å‰ç”±æ§åˆ¶å™¨Manageræ‰§è¡Œã€‚èµ„æºå¯¹è±¡çš„è‡ªåŠ¨åŒ–æ§åˆ¶ä¸­å¿ƒï¼ŒKubernetesé›†ç¾¤æœ‰å¾ˆå¤šæ§åˆ¶å™¨ã€‚</li><li><strong>Etcd</strong>ï¼šæ‰€æœ‰æŒä¹…åŒ–çš„çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨Etcdä¸­ï¼Œè¿™ä¸ªæ˜¯Kubernetesé›†ç¾¤çš„æ•°æ®åº“ã€‚</li></ul><p><strong>NodeèŠ‚ç‚¹ä»‹ç»</strong></p><p>NodeèŠ‚ç‚¹æ˜¯Kubernetesé›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ï¼Œåœ¨NodeèŠ‚ç‚¹ä¸Šä¸»è¦è¿è¡Œäº†Dockerã€Kubeletã€kube-proxyä¸‰ä¸ªæœåŠ¡ï¼ˆFluentdè¯·å…ˆå¿½ç•¥ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://k8s.unixhot.com/kubernetes/media/ff26ae9ea18c1a93e50b8226abfa2fa7.png" alt="img"></p><ul><li><strong>Docker Engine</strong>ï¼šè´Ÿè´£èŠ‚ç‚¹çš„å®¹å™¨çš„ç®¡ç†å·¥ä½œï¼Œæœ€ç»ˆåˆ›å»ºå‡ºæ¥çš„æ˜¯ä¸€ä¸ªDockerå®¹å™¨ã€‚</li><li><strong>Kubelet</strong>ï¼šå®‰è£…åœ¨Nodeä¸Šçš„ä»£ç†æœåŠ¡ï¼Œç”¨æ¥ç®¡ç†Podsä»¥åŠå®¹å™¨ã€é•œåƒã€Volumeç­‰ï¼Œå®ç°å¯¹é›†ç¾¤å¯¹èŠ‚ç‚¹çš„ç®¡ç†ã€‚</li><li><strong>Kube-proxy</strong>ï¼šå®‰è£…åœ¨Nodeä¸Šçš„ç½‘ç»œä»£ç†æœåŠ¡ï¼Œæä¾›ç½‘ç»œä»£ç†ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œå®ç°ä¸Serviceé€šè®¯ã€‚</li></ul><h3 id="kubernetesé€»è¾‘æ¶æ„" tabindex="-1">Kubernetesé€»è¾‘æ¶æ„ <a aria-current="page" href="#kubernetesé€»è¾‘æ¶æ„" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨ä¸Šé¢çš„ä»‹ç»ä¸­æåˆ°åƒPodã€Serviceè¿™äº›æ¦‚å¿µï¼Œåœ¨Kubernetesçš„ç³»ç»Ÿæ¶æ„å›¾ä¸­å¹¶æ²¡æœ‰ä½“ç°å‡ºæ¥ï¼Œè¿™äº›å¯ä»¥ç†è§£ä¸ºKubernetesé€»è¾‘æ¶æ„ä¸­çš„ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯åœ¨Masterå’ŒNodeä¸Šå¹¶ä¸å…·ä½“å­˜åœ¨çš„ä¸€ä¸ªæœåŠ¡æˆ–è€…è¿›ç¨‹ï¼Œä½†å´æ˜¯Kubernetesçš„ç»„ä»¶ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„ç®¡ç†å¯¹è±¡ã€‚ä¸»è¦æœ‰Podã€Serviceå’Œå„ç§æ§åˆ¶å™¨ç­‰ã€‚</p><p><strong>Pod</strong></p><p>Podæ˜¯Kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œä¸€ä¸ªPodå¯ä»¥åŒ…å«ä¸€ç»„å®¹å™¨å’Œå·ã€‚è™½ç„¶ä¸€ä¸ªPodé‡Œé¢å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œä½†æ˜¯Podåªæœ‰ä¸€ä¸ªIPåœ°å€ï¼Œè€Œä¸”Podé‡å¯åï¼ŒIPåœ°å€ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/e2a89d5ac819b578808e62d8fee0e960.png" alt="img"></p><p><strong>Controller</strong></p><p>ä¸€ä¸ªåº”ç”¨å¦‚æœå¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªPodï¼Œå°±åƒä½ ç»™æŸä¸€ä¸ªåº”ç”¨åšé›†ç¾¤ï¼Œé›†ç¾¤ä¸­çš„æ‰€æœ‰Podæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚Kubernetesä¸­æœ‰å¾ˆå¤šæ§åˆ¶å™¨å¯ä»¥æ¥ç®¡ç†Podï¼Œä¾‹å¦‚ä¸‹å›¾çš„Replication Controllerå¯ä»¥æ§åˆ¶Podçš„å‰¯æœ¬æ•°é‡ï¼Œä»è€Œå®ç°æ¨ªå‘æ‰©å±•ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/c4ae2886ff4fdb51b9a0dd20a14c8e50.png" alt="img"></p><p>Kubernetesä¸­æœ‰å¾ˆå¤šæ§åˆ¶å™¨ï¼Œåé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šä¸€ä¸€è®²åˆ°ï¼Œå¸¸ç”¨çš„æ§åˆ¶å™¨å¦‚ä¸‹ï¼š</p><ul><li>Replication Controllerï¼ˆæ–°ç‰ˆæœ¬å·²ç»è¢«ReplicaSetæ‰€æ›¿ä»£ï¼‰</li><li>ReplicaSetï¼ˆæ–°ç‰ˆæœ¬è¢«å°è£…åœ¨Deploymentä¸­ï¼‰</li><li>Deploymentï¼šå°è£…äº†Podçš„å‰¯æœ¬ç®¡ç†ã€éƒ¨ç½²æ›´æ–°ã€å›æ»šã€æ‰©å®¹ã€ç¼©å®¹ç­‰åŠŸèƒ½ã€‚</li><li>DaemonSetï¼šä¿è¯æ‰€æœ‰çš„Nodeä¸Šæœ‰ä¸”åªæœ‰ä¸€ä¸ªPodåœ¨è¿è¡Œã€‚</li><li>StatefulSetï¼šæœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œä¸º Pod æä¾›å”¯ä¸€çš„æ ‡è¯†ï¼Œå®ƒå¯ä»¥ä¿è¯éƒ¨ç½²å’Œ scale çš„é¡ºåºã€‚</li><li>Jobï¼šä½¿ç”¨Kubernetesè¿è¡Œå•ä¸€ä»»åŠ¡ã€‚</li><li>CronJobï¼šä½¿ç”¨Kubernetesè¿è¡Œå®šæ—¶ä»»åŠ¡ã€‚</li></ul><p><strong>Service</strong></p><p>ç”±äºPodçš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œè€Œä¸”æ¯æ¬¡é‡å¯Podçš„IPåœ°å€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè€Œä¸”ä¸€ä¸ªPodæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé›†ç¾¤ä¸­æœ‰äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±éœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚Kubernetesä½¿ç”¨Serviceæ¥å®ç°Podçš„è®¿é—®ï¼Œè€Œä¸”Serviceæœ‰ä¸€ä¸ªCluster IPï¼Œé€šå¸¸ä¹Ÿç§°ä¹‹ä¸ºVIPï¼Œæ˜¯å›ºå®šä¸å˜çš„ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/2e61328894d1eaf548ad6ff06d85a6a3.png" alt="img"></p><h3 id="kubernetesç½‘ç»œä»‹ç»" tabindex="-1">Kubernetesç½‘ç»œä»‹ç» <a aria-current="page" href="#kubernetesç½‘ç»œä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨Kubernetesé›†ç¾¤ä¸­å­˜åœ¨ç€ä¸‰ç§ç½‘ç»œï¼Œåˆ†åˆ«æ˜¯Nodeç½‘ç»œã€Podç½‘ç»œå’ŒServiceç½‘ç»œï¼Œè¿™å‡ ç§ç½‘ç»œä¹‹é—´çš„é€šä¿¡éœ€è¦ä¾é ç½‘ç»œæ’ä»¶ï¼ŒKubernetesæœ¬èº«å¹¶æ²¡æœ‰æä¾›ï¼Œç¤¾åŒºæä¾›äº†åƒFlannelã€Calicoã€Cannalç­‰ï¼Œåé¢ç« èŠ‚ä¼šè¯¦è¿°ã€‚</p><p><strong>Nodeç½‘ç»œ</strong></p><p>Nodeç½‘ç»œæŒ‡çš„æ˜¯Kubernetes NodeèŠ‚ç‚¹æœ¬åœ°çš„ç½‘ç»œï¼Œåœ¨æœ¬å®éªŒç¯å¢ƒä¸­ä½¿ç”¨çš„æ˜¯192.168.56.0/24è¿™ä¸ªç½‘æ®µï¼Œæ‰€æœ‰çš„Nodeå’ŒMasteråœ¨è¯¥ç½‘æ®µéƒ½å¯ä»¥æ­£å¸¸é€šä¿¡ã€‚</p><p><strong>Podç½‘ç»œ</strong></p><p>åé¢åˆ›å»ºçš„Podï¼Œæ¯ä¸€ä¸ªPodéƒ½ä¼šæœ‰ä¸€ä¸ªIPåœ°å€ï¼Œè¿™ä¸ªIPåœ°å€ç½‘ç»œæ®µè¢«ç§°ä¹‹ä¸ºPodç½‘ç»œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-hpn68 1/1 Running 0 9m7s 10.2.1.2 linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">&lt;none&gt; &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-r4mfq 1/1 Running 0 7m46s 10.2.1.3 linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">&lt;none&gt; &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Serviceç½‘ç»œ</strong></p><p>Serviceæ˜¯ä¸ºPodæä¾›è®¿é—®å’Œè´Ÿè½½å‡è¡¡çš„ç½‘ç»œåœ°å€æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">kubernetes ClusterIP 10.1.0.1 &lt;none&gt; 443/TCP 64m</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx NodePort 10.1.216.23 &lt;none&gt; 80:30893/TCP 8m3s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Kubernetesçš„ç»„ä»¶å’ŒçŸ¥è¯†ç»éå¦‚æ­¤ï¼Œå¿«é€Ÿå…¥é—¨å¯ä»¥å…ˆäº†è§£è¿™ä¹ˆå¤šï¼Œä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å…ˆå¿«é€Ÿçš„éƒ¨ç½²ä¸€ä¸ªKubernetesé›†ç¾¤ã€‚</p><h2 id="ä½¿ç”¨kubeadméƒ¨ç½²kubernetes-v1-16-4" tabindex="-1">ä½¿ç”¨kubeadméƒ¨ç½²Kubernetes v1.16.4 <a aria-current="page" href="#ä½¿ç”¨kubeadméƒ¨ç½²kubernetes-v1-16-4" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æƒ³è¦å¿«é€Ÿçš„ä½“éªŒKubernetesçš„åŠŸèƒ½ï¼Œå®˜æ–¹æä¾›äº†éå¸¸å¤šçš„éƒ¨ç½²æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„kubeadmä»¥å®¹å™¨çš„æ–¹å¼è¿è¡ŒKubernetesé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²æ›´æœ‰åˆ©äºç†è§£Kubernetesçš„æ¶æ„ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨kubeadmå¿«é€Ÿçš„éƒ¨ç½²ä¸€ä¸ªKubernetesé›†ç¾¤åï¼Œå­¦ä¹ Kubernetesçš„ä½¿ç”¨ï¼Œç„¶ååŠ¨æ‰‹ä½¿ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼æ¥æ·±å…¥ç†è§£Kubernetesæ¶æ„ã€‚</p><blockquote><p>æ³¨æ„ï¼šè¯·ä¸è¦æŠŠç›®å…‰ä»…ä»…æ”¾åœ¨éƒ¨ç½²ä¸Šï¼Œè¦æ…¢æ…¢çš„äº†è§£å…¶æœ¬è´¨ã€‚</p></blockquote><p>Kubernetesv1.13ç‰ˆæœ¬å‘å¸ƒåï¼Œkubeadmæ‰æ­£å¼è¿›å…¥GAï¼Œå¯ä»¥ç”Ÿäº§ä½¿ç”¨ã€‚ç›®å‰Kubernetesçš„å¯¹åº”é•œåƒä»“åº“ï¼Œåœ¨å›½å†…é˜¿é‡Œäº‘ä¹Ÿæœ‰äº†é•œåƒç«™ç‚¹ï¼Œä½¿ç”¨kubeadméƒ¨ç½²Kubernetesé›†ç¾¤å˜å¾—ç®€å•å¹¶ä¸”å®¹æ˜“äº†å¾ˆå¤šï¼Œæœ¬æ–‡ä½¿ç”¨kubeadmå¸¦é¢†å¤§å®¶å¿«é€Ÿéƒ¨ç½²Kubernetes v1.16.2ç‰ˆæœ¬ã€‚</p><p><strong>å®éªŒç¯å¢ƒå‡†å¤‡</strong></p><p>åœ¨æœ¬ä¹¦çš„å®éªŒç¯å¢ƒçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¦‚ä¸‹æ¥åˆ†é…è§’è‰²ï¼š</p><table><thead><tr><th>ä¸»æœºå</th><th>IPåœ°å€ï¼ˆNATï¼‰</th><th>æœ€ä½é…ç½®</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="http://linux-node1.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node1.linuxhot.com<!--]--></a></td><td>eth0:192.168.56.11</td><td>1CPU/1Gå†…å­˜</td><td>Kubernets Master/EtcdèŠ‚ç‚¹</td></tr><tr><td><a href="http://linux-node2.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node2.linuxhot.com<!--]--></a></td><td>eth0:192.168.56.12</td><td>1CPU/1Gå†…å­˜</td><td>Kubernets NodeèŠ‚ç‚¹</td></tr><tr><td><a href="http://linux-node3.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node3.linuxhot.com<!--]--></a></td><td>eth0:192.168.56.13</td><td>1CPU/1Gå†…å­˜</td><td>Kubernets NodeèŠ‚ç‚¹</td></tr><tr><td>Serviceç½‘æ®µ</td><td>10.1.0.0/16</td><td></td><td></td></tr><tr><td>Podç½‘æ®µ</td><td>10.2.0.0/16</td><td></td><td></td></tr><tr><td>å¤‡æ³¨</td><td>å¦‚æœæœ‰æ¡ä»¶å¯ä»¥éƒ¨ç½²å¤šä¸ªKubernets nodeï¼Œå®éªŒæ•ˆæœæ›´ä½³ã€‚</td><td></td><td></td></tr></tbody></table><h3 id="éƒ¨ç½²docker" tabindex="-1">éƒ¨ç½²Docker <a aria-current="page" href="#éƒ¨ç½²docker" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>é¦–å…ˆéœ€è¦åœ¨æ‰€æœ‰Kubernetesé›†ç¾¤çš„èŠ‚ç‚¹ä¸­å®‰è£…Dockerå’Œkubeadmã€‚</p><p><strong>1.è®¾ç½®ä½¿ç”¨å›½å†…Yumæº</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /etc/yum.repos.d/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 yum.repos.d]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.å®‰è£…æŒ‡å®šçš„Dockerç‰ˆæœ¬</strong></p><p>ç”±äºkubeadmå¯¹Dockerçš„ç‰ˆæœ¬æ˜¯æœ‰è¦æ±‚çš„ï¼Œéœ€è¦å®‰è£…ä¸KubernetesåŒ¹é…çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªå¯¹åº”å…³ç³»ä¸€èˆ¬åœ¨æ¯æ¬¡å‘å¸ƒçš„Changlogä¸­å¯ä»¥æ‰¾åˆ°ï¼Œä¾‹å¦‚1.16.2çš„CHANGELOGå¦‚ä¸‹ï¼š<a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.16.md" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->CHANGELOG<!--]--></a></p><p>å½“å‰v1.16.2æ”¯æŒçš„Dockerç‰ˆæœ¬æœ‰v1.13.1, 17.03, 17.06, 17.09, 18.06, 18.09,å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum list docker-ce.x86_64 --showduplicates | sort -r</span></span>
<span class="line"><span style="color:#a6accd"> * updates: mirror.jdcloud.com</span></span>
<span class="line"><span style="color:#a6accd">Loading mirror speeds from cached hostfile</span></span>
<span class="line"><span style="color:#a6accd">Loaded plugins: fastestmirror</span></span>
<span class="line"><span style="color:#a6accd"> * extras: mirror.jdcloud.com</span></span>
<span class="line"><span style="color:#a6accd"> * epel: mirrors.njupt.edu.cn</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.4-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.3-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.2-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.1-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:19.03.0-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.9-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.8-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.7-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.6-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.5-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.4-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.3-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.2-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.1-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            3:18.09.0-3.el7                     docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.3.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.2.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.1.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.06.0.ce-3.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.03.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            18.03.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.12.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.12.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.09.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.09.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.06.2.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.06.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.06.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.3.ce-1.el7                    docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.2.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.1.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd">docker-ce.x86_64            17.03.0.ce-1.el7.centos             docker-ce-stable</span></span>
<span class="line"><span style="color:#a6accd"> * base: mirrors.neusoft.edu.cn</span></span>
<span class="line"><span style="color:#a6accd">Available Packages</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.å®‰è£…Docker18.09ç‰ˆæœ¬</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum -y install docker-ce-18.09.9-3.el7 docker-ce-cli-18.09.9-3.el7</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.è®¾ç½®cgroupé©±åŠ¨ä½¿ç”¨systemd</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /etc/docker</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">      "registry-mirrors": ["https://dx5z2hy7.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">      "exec-opts": ["native.cgroupdriver=systemd"]</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">EOF</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.å¯åŠ¨åå°è¿›ç¨‹</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable docker &amp;&amp; systemctl start docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.æŸ¥çœ‹Dockerç‰ˆæœ¬</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker --version</span></span>
<span class="line"><span style="color:#a6accd">Docker version 18.09.9, build 039a7df9ba</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="éƒ¨ç½²kubadmå’Œkubelet" tabindex="-1">éƒ¨ç½²kubadmå’Œkubelet <a aria-current="page" href="#éƒ¨ç½²kubadmå’Œkubelet" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨Kubernetesé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ¨ç½²å®Œæ¯•Dockeråï¼Œè¿˜éœ€è¦å…¨éƒ¨éƒ¨ç½²kubeadmå’Œkubeletï¼Œå…¶ä¸­kubeadmæ˜¯ç®¡ç†å·¥å…·ï¼Œkubeletæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œç”¨äºå¯åŠ¨Kuberneteså¯¹åº”çš„æœåŠ¡ã€‚</p><p><strong>1.è®¾ç½®kubernetes YUMä»“åº“</strong></p><p>è¿™é‡Œåœ¨å®˜æ–¹æ–‡æ¡£çš„åŸºç¡€ä¸Šä¿®æ”¹ä¸ºäº†å›½å†…é˜¿é‡Œäº‘çš„yumä»“åº“ï¼Œ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#a6accd">[kubernetes]</span></span>
<span class="line"><span style="color:#a6accd">name=Kubernetes</span></span>
<span class="line"><span style="color:#a6accd">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">repo_gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šæœ€ä¸‹é¢ä¸€è¡Œgpgkeyçš„ä¸¤ä¸ªURLåœ°å€ä¹‹é—´æ˜¯ç©ºæ ¼ï¼Œå› ä¸ºæ’ç‰ˆé—®é¢˜å¯èƒ½å¯¼è‡´æ¢è¡Œã€‚</p></blockquote><p><strong>2.å®‰è£…è½¯ä»¶åŒ…</strong></p><p>ç”±äºç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œè¯·æŒ‡å®šå¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œæœ¬æ–‡é‡‡ç”¨1.16.2ç‰ˆæœ¬ï¼Œå…¶å®ƒç‰ˆæœ¬æœªç»æµ‹è¯•ï¼Œå¦‚æœä¸æŒ‡å®šç‰ˆæœ¬é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y kubelet-1.16.2 kubeadm-1.16.2 kubectl-1.16.2 ipvsadm</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.é…ç½®kubelet</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubeletä¸å…è®¸æ‰€åœ¨çš„ä¸»æœºå­˜åœ¨äº¤æ¢åˆ†åŒºï¼ŒåæœŸè§„åˆ’çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘åœ¨ç³»ç»Ÿå®‰è£…çš„æ—¶å€™ä¸åˆ›å»ºäº¤æ¢åˆ†åŒºï¼Œé’ˆå¯¹å·²ç»å­˜åœ¨äº¤æ¢åˆ†åŒºçš„å¯ä»¥è®¾ç½®å¿½ç•¥ç¦æ­¢ä½¿ç”¨Swapçš„é™åˆ¶ï¼Œä¸ç„¶æ— æ³•å¯åŠ¨Kubeletã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/kubelet</span></span>
<span class="line"><span style="color:#a6accd">KUBELET_CGROUP_ARGS="--cgroup-driver=systemd"</span></span>
<span class="line"><span style="color:#a6accd">KUBELET_EXTRA_ARGS="--fail-swap-on=false"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå…³é—­SWAP</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# swapoff -a</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.è®¾ç½®å†…æ ¸å‚æ•°</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="color:#a6accd">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="color:#a6accd">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="color:#a6accd">net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="color:#a6accd">EOF</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½¿é…ç½®ç”Ÿæ•ˆ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# sysctl --system</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>5.å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</strong></p><p>æ³¨æ„ï¼Œæ­¤æ—¶kubeletæ˜¯æ— æ³•æ­£å¸¸å¯åŠ¨çš„ï¼Œå¯ä»¥æŸ¥çœ‹/var/log/messagesæœ‰æŠ¥é”™ä¿¡æ¯ï¼Œç­‰å¾…æ‰§è¡Œåˆå§‹åŒ–ä¹‹åå³å¯æ­£å¸¸ï¼Œä¸ºæ­£å¸¸ç°è±¡ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable kubelet &amp;&amp; systemctl start kubelet</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>6.ä½¿ç”¨IPVSè¿›è¡Œè´Ÿè½½å‡è¡¡</strong></p><p>åœ¨Kubernetesé›†ç¾¤ä¸­Kube-Proxyç»„ä»¶è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œé»˜è®¤ä½¿ç”¨iptablesï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ipvsè¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚åœ¨æ‰€æœ‰èŠ‚ç‚¹å¯ç”¨ipvsæ¨¡å—</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#a6accd">#!/bin/bash</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs_rr</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs_wrr</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- ip_vs_sh</span></span>
<span class="line"><span style="color:#a6accd">modprobe -- nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chmod +x /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# source /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹æ¨¡å—æ˜¯å¦åŠ è½½æ­£å¸¸</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">ip_vs_sh               12688  0 </span></span>
<span class="line"><span style="color:#a6accd">ip_vs_wrr              12697  0 </span></span>
<span class="line"><span style="color:#a6accd">ip_vs_rr               12600  0 </span></span>
<span class="line"><span style="color:#a6accd">ip_vs                 145497  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr</span></span>
<span class="line"><span style="color:#a6accd">nf_conntrack_ipv4      15053  15 </span></span>
<span class="line"><span style="color:#a6accd">nf_defrag_ipv4         12729  1 nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">nf_conntrack          133095  7 ip_vs,nf_nat,nf_nat_ipv4,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_netlink,nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#a6accd">libcrc32c              12644  4 xfs,ip_vs,nf_nat,nf_conntrack</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>ä»¥ä¸Šæ­¥éª¤è¯·åœ¨Kubernetesçš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œæœ¬å®éªŒç¯å¢ƒæ˜¯éœ€è¦åœ¨linux-node1ã€linux-node2ã€linux-node3è¿™ä¸‰å°æœºå™¨ä¸Šå‡å®‰è£…Dockerã€kubeadmã€kubeletï¼Œå¯¹äºä»¥ä¸Šæ“ä½œéœ€è¦è‡ªåŠ¨åŒ–å¯ä»¥å‚è€ƒæˆ‘ä½¿ç”¨SaltStackå®Œæˆçš„salt-kubeadmé¡¹ç›®ï¼š<a href="https://github.com/unixhot/salt-kubeadm" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://github.com/unixhot/salt-kubeadm<!--]--></a></li></ul><h3 id="åˆå§‹åŒ–é›†ç¾¤éƒ¨ç½²master" tabindex="-1">åˆå§‹åŒ–é›†ç¾¤éƒ¨ç½²Master <a aria-current="page" href="#åˆå§‹åŒ–é›†ç¾¤éƒ¨ç½²master" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…å®Œæ¯•åï¼Œåœ¨linux-node1è¿™å°MasterèŠ‚ç‚¹ä¸Šè¿›è¡Œé›†ç¾¤çš„åˆå§‹åŒ–å·¥ä½œã€‚</p><p><strong>1.å¯¼å‡ºæ‰€æœ‰é»˜è®¤çš„é…ç½®</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm config print init-defaults &gt; kubeadm.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸Šé¢çš„å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªé»˜è®¤é…ç½®çš„kubeadmé…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å³å¯ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat kubeadm.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span style="color:#a6accd">bootstrapTokens:</span></span>
<span class="line"><span style="color:#a6accd">- groups:</span></span>
<span class="line"><span style="color:#a6accd">  - system:bootstrappers:kubeadm:default-node-token</span></span>
<span class="line"><span style="color:#a6accd">  token: abcdef.0123456789abcdef</span></span>
<span class="line"><span style="color:#a6accd">  ttl: 24h0m0s</span></span>
<span class="line"><span style="color:#a6accd">  usages:</span></span>
<span class="line"><span style="color:#a6accd">  - signing</span></span>
<span class="line"><span style="color:#a6accd">  - authentication</span></span>
<span class="line"><span style="color:#a6accd">kind: InitConfiguration</span></span>
<span class="line"><span style="color:#a6accd">localAPIEndpoint:</span></span>
<span class="line"><span style="color:#a6accd">  advertiseAddress: 192.168.56.11  #ä¿®æ”¹ä¸ºAPI Serverçš„åœ°å€</span></span>
<span class="line"><span style="color:#a6accd">  bindPort: 6443</span></span>
<span class="line"><span style="color:#a6accd">nodeRegistration:</span></span>
<span class="line"><span style="color:#a6accd">  criSocket: /var/run/dockershim.sock</span></span>
<span class="line"><span style="color:#a6accd">  name: linux-node1.example.com</span></span>
<span class="line"><span style="color:#a6accd">  taints:</span></span>
<span class="line"><span style="color:#a6accd">  - effect: NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">    key: node-role.kubernetes.io/master</span></span>
<span class="line"><span style="color:#a6accd">---</span></span>
<span class="line"><span style="color:#a6accd">apiServer:</span></span>
<span class="line"><span style="color:#a6accd">  timeoutForControlPlane: 4m0s</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span style="color:#a6accd">certificatesDir: /etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#a6accd">clusterName: kubernetes</span></span>
<span class="line"><span style="color:#a6accd">controllerManager: {}</span></span>
<span class="line"><span style="color:#a6accd">dns:</span></span>
<span class="line"><span style="color:#a6accd">  type: CoreDNS</span></span>
<span class="line"><span style="color:#a6accd">etcd:</span></span>
<span class="line"><span style="color:#a6accd">  local:</span></span>
<span class="line"><span style="color:#a6accd">    dataDir: /var/lib/etcd</span></span>
<span class="line"><span style="color:#a6accd">imageRepository: registry.aliyuncs.com/google_containers  #ä¿®æ”¹ä¸ºé˜¿é‡Œäº‘é•œåƒä»“åº“</span></span>
<span class="line"><span style="color:#a6accd">kind: ClusterConfiguration</span></span>
<span class="line"><span style="color:#a6accd">kubernetesVersion: v1.16.2  #ä¿®æ”¹ä¸ºå…·ä½“çš„ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#a6accd">networking:</span></span>
<span class="line"><span style="color:#a6accd">  dnsDomain: cluster.local</span></span>
<span class="line"><span style="color:#a6accd">  serviceSubnet: 10.1.0.0/16   #ä¿®æ”¹Serviceçš„ç½‘ç»œ</span></span>
<span class="line"><span style="color:#a6accd">  podSubnet: 10.2.0.0/16      #æ–°å¢Podçš„ç½‘ç»œ</span></span>
<span class="line"><span style="color:#a6accd">scheduler: {}</span></span>
<span class="line"><span style="color:#a6accd">---   #ä¸‹é¢æœ‰å¢åŠ çš„ä¸‰è¡Œé…ç½®ï¼Œç”¨äºè®¾ç½®Kubeproxyä½¿ç”¨LVS</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span></span>
<span class="line"><span style="color:#a6accd">kind: KubeProxyConfiguration</span></span>
<span class="line"><span style="color:#a6accd">mode: ipvs</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2. æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm init --config kubeadm.yaml</span></span>
<span class="line"><span style="color:#a6accd">[init] Using Kubernetes version: v1.16.2</span></span>
<span class="line"><span style="color:#a6accd">[preflight] Running pre-flight checks</span></span>
<span class="line"><span style="color:#a6accd">error execution phase preflight: [preflight] Some fatal errors occurred:</span></span>
<span class="line"><span style="color:#a6accd">        [ERROR NumCPU]: the number of available CPUs 1 is less than the required 2</span></span>
<span class="line"><span style="color:#a6accd">        [ERROR Swap]: running with swap on is not supported. Please disable swa</span></span>
<span class="line"><span style="color:#a6accd">[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`</span></span>
<span class="line"><span style="color:#a6accd">To see the stack trace of this error execute with --v=5 or higher</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœé‡åˆ°ä¸Šé¢è¿™æ ·çš„æŠ¥é”™ï¼Œæ˜¯å› ä¸ºåœ¨å®éªŒç¯å¢ƒå¼€å¯äº†äº¤æ¢åˆ†åŒºï¼Œä»¥åŠCPUçš„æ ¸æ•°å°äº2é€ æˆçš„ï¼Œå¯ä»¥ä½¿ç”¨--ignore-preflight-errors=è¿›è¡Œå¿½ç•¥ã€‚ --ignore-preflight-errors=ï¼šå¿½ç•¥è¿è¡Œæ—¶çš„é”™è¯¯ï¼Œä¾‹å¦‚ä¸Šé¢ç›®å‰å­˜åœ¨[ERROR NumCPU]å’Œ[ERROR Swap]ï¼Œå¿½ç•¥è¿™ä¸¤ä¸ªæŠ¥é”™å°±æ˜¯å¢åŠ --ignore-preflight-errors=NumCPU å’Œ--ignore-preflight-errors=Swapçš„é…ç½®å³å¯ã€‚</p><p>å†æ¬¡æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm init --config kubeadm.yaml \</span></span>
<span class="line"><span style="color:#a6accd">  --ignore-preflight-errors=Swap,NumCPU </span></span>
<span class="line"><span style="color:#a6accd">[init] Using Kubernetes version: v1.16.2</span></span>
<span class="line"><span style="color:#a6accd">[preflight] Running pre-flight checks</span></span>
<span class="line"><span style="color:#a6accd">        [WARNING NumCPU]: the number of available CPUs 1 is less than the required 2</span></span>
<span class="line"><span style="color:#a6accd">        [WARNING Swap]: running with swap on is not supported. Please disable swap</span></span>
<span class="line"><span style="color:#a6accd">[preflight] Pulling images required for setting up a Kubernetes cluster</span></span>
<span class="line"><span style="color:#a6accd">[preflight] This might take a minute or two, depending on the speed of your internet connection</span></span>
<span class="line"><span style="color:#a6accd">[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ‰§è¡Œå®Œæ¯•åï¼Œä¼šåœ¨å½“å‰è¾“å‡ºä¸‹åœç•™ï¼Œç­‰å¾…ä¸‹è½½Kubernetesç»„ä»¶çš„Dockeré•œåƒã€‚æ ¹æ®ä½ çš„ç½‘ç»œæƒ…å†µï¼Œå¯ä»¥æŒç»­1-5åˆ†é’Ÿï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨docker imagesæŸ¥çœ‹ä¸‹è½½çš„é•œåƒã€‚é•œåƒä¸‹è½½å®Œæ¯•ä¹‹åï¼Œå°±ä¼šè¿›è¡Œåˆå§‹æ“ä½œï¼š</p><p>è¿™é‡Œçœç•¥äº†æ‰€æœ‰è¾“å‡ºï¼Œåˆå§‹åŒ–æ“ä½œä¸»è¦ç»å†äº†ä¸‹é¢15ä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªé˜¶æ®µå‡è¾“å‡ºå‡ä½¿ç”¨[æ­¥éª¤åç§°]ä½œä¸ºå¼€å¤´ï¼š</p><ol><li>[init]ï¼šæŒ‡å®šç‰ˆæœ¬è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</li><li>[preflight] ï¼šåˆå§‹åŒ–å‰çš„æ£€æŸ¥å’Œä¸‹è½½æ‰€éœ€è¦çš„Dockeré•œåƒæ–‡ä»¶ã€‚</li><li>[kubelet-start]ï¼šç”Ÿæˆkubeletçš„é…ç½®æ–‡ä»¶â€/var/lib/kubelet/config.yamlâ€ï¼Œæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶kubeletæ— æ³•å¯åŠ¨ï¼Œæ‰€ä»¥åˆå§‹åŒ–ä¹‹å‰çš„kubeletå®é™…ä¸Šå¯åŠ¨å¤±è´¥ã€‚</li><li>[certificates]ï¼šç”ŸæˆKubernetesä½¿ç”¨çš„è¯ä¹¦ï¼Œå­˜æ”¾åœ¨/etc/kubernetes/pkiç›®å½•ä¸­ã€‚</li><li>[kubeconfig] ï¼šç”Ÿæˆ KubeConfigæ–‡ä»¶ï¼Œå­˜æ”¾åœ¨/etc/kubernetesç›®å½•ä¸­ï¼Œç»„ä»¶ä¹‹é—´é€šä¿¡éœ€è¦ä½¿ç”¨å¯¹åº”æ–‡ä»¶ã€‚</li><li>[control-plane]ï¼šä½¿ç”¨/etc/kubernetes/manifestç›®å½•ä¸‹çš„YAMLæ–‡ä»¶ï¼Œå®‰è£… Masterç»„ä»¶ã€‚</li><li>[etcd]ï¼šä½¿ç”¨/etc/kubernetes/manifest/etcd.yamlå®‰è£…EtcdæœåŠ¡ã€‚</li><li>[wait-control-plane]ï¼šç­‰å¾…control-planéƒ¨ç½²çš„Masterç»„ä»¶å¯åŠ¨ã€‚</li><li>[apiclient]ï¼šæ£€æŸ¥Masterç»„ä»¶æœåŠ¡çŠ¶æ€ã€‚</li><li>[uploadconfig]ï¼šæ›´æ–°é…ç½®</li><li>[kubelet]ï¼šä½¿ç”¨configMapé…ç½®kubeletã€‚</li><li>[patchnode]ï¼šæ›´æ–°CNIä¿¡æ¯åˆ°Nodeä¸Šï¼Œé€šè¿‡æ³¨é‡Šçš„æ–¹å¼è®°å½•ã€‚</li><li>[mark-control-plane]ï¼šä¸ºå½“å‰èŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼Œæ‰“äº†è§’è‰²Masterï¼Œå’Œä¸å¯è°ƒåº¦æ ‡ç­¾ï¼Œè¿™æ ·é»˜è®¤å°±ä¸ä¼šä½¿ç”¨MasterèŠ‚ç‚¹æ¥è¿è¡ŒPodã€‚</li><li>[bootstrap-token]ï¼šç”Ÿæˆtokenè®°å½•ä¸‹æ¥ï¼Œåè¾¹ä½¿ç”¨kubeadm joinå¾€é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹æ—¶ä¼šç”¨åˆ°</li><li>[addons]ï¼šå®‰è£…é™„åŠ ç»„ä»¶CoreDNSå’Œkube-proxy</li></ol><p>æˆåŠŸæ‰§è¡Œä¹‹åï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">Your Kubernetes master has initialized successfully!</span></span>
<span class="line"><span style="color:#a6accd">To start using your cluster, you need to run the following as a regular user:</span></span>
<span class="line"><span style="color:#a6accd">mkdir -p $HOME/.kube</span></span>
<span class="line"><span style="color:#a6accd">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd">You should now deploy a pod network to the cluster.</span></span>
<span class="line"><span style="color:#a6accd">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span></span>
<span class="line"><span style="color:#a6accd">https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"><span style="color:#a6accd">You can now join any number of machines by running the following on each node</span></span>
<span class="line"><span style="color:#a6accd">as root:</span></span>
<span class="line"><span style="color:#a6accd">kubeadm join 192.168.56.11:6443 --token 19fhhl.3mzkyk16tcgp6vga --discovery-token-ca-cert-hash sha256:76a88c38b673d3b2ac73e33127a809688cb3e58c533512ac6d92ecb66aa57a45</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œé‚£æ„å‘³ç€ä¹‹å‰çš„æ“ä½œå­˜åœ¨é—®é¢˜ï¼Œæ£€æŸ¥é¡ºåºå¦‚ä¸‹ï¼š</p><ul><li>åŸºç¡€ç¯å¢ƒ</li><li>ä¸»æœºåæ˜¯å¦å¯ä»¥è§£æï¼ŒSELinuxï¼Œiptablesæ˜¯å¦å…³é—­ã€‚</li><li>äº¤æ¢åˆ†åŒºæ˜¯å¦å­˜åœ¨free -mæŸ¥çœ‹</li><li>å†…æ ¸å‚æ•°æ˜¯å¦ä¿®æ”¹ã€IPVSæ˜¯å¦ä¿®æ”¹ï¼ˆç›®å‰é˜¶æ®µä¸ä¼šé€ æˆå¤±è´¥ï¼‰</li><li>åŸºç¡€è½¯ä»¶</li><li>Dockeræ˜¯å¦å®‰è£…å¹¶å¯åŠ¨</li><li>Kubeletæ˜¯å¦å®‰è£…å¹¶å¯åŠ¨</li><li>æ‰§è¡Œkubeadmæ˜¯å¦æœ‰åˆ«çš„æŠ¥é”™æ˜¯å¦å¿½ç•¥</li><li>systemctl status kubeletæŸ¥çœ‹kubeletæ˜¯å¦å¯åŠ¨</li><li>å¦‚æœkubeletæ— æ³•å¯åŠ¨ï¼ŒæŸ¥çœ‹æ—¥å¿—æœ‰ä»€ä¹ˆæŠ¥é”™ï¼Œå¹¶è§£å†³æŠ¥é”™ã€‚</li><li>ä»¥ä¸Šéƒ½è§£å†³å®Œæ¯•ï¼Œéœ€è¦é‡æ–°åˆå§‹åŒ–</li><li>kubeadm reset è¿›è¡Œé‡ç½®ï¼ˆç”Ÿäº§åƒä¸‡ä¸è¦æ‰§è¡Œï¼Œä¼šç›´æ¥åˆ é™¤é›†ç¾¤ï¼‰</li><li>æ ¹æ®kubeadm reset æå‡ï¼Œæ¸…æ¥šiptableså’ŒLVSã€‚</li></ul><p>è¯·æ ¹æ®ä¸Šé¢è¾“å‡ºçš„è¦æ±‚é…ç½®kubectlå‘½ä»¤æ¥è®¿é—®é›†ç¾¤ã€‚</p><p><strong>3.ä¸ºkubectlå‡†å¤‡Kubeconfigæ–‡ä»¶ã€‚</strong></p><p>kubectlé»˜è®¤ä¼šåœ¨æ‰§è¡Œçš„ç”¨æˆ·å®¶ç›®å½•ä¸‹é¢çš„.kubeç›®å½•ä¸‹å¯»æ‰¾configæ–‡ä»¶ã€‚è¿™é‡Œæ˜¯å°†åœ¨åˆå§‹åŒ–æ—¶[kubeconfig]æ­¥éª¤ç”Ÿæˆçš„admin.confæ‹·è´åˆ°.kube/configã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p $HOME/.kube</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# chown $(id -u):$(id -g) $HOME/.kube/config</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­ï¼Œè®°å½•äº†API Serverçš„è®¿é—®åœ°å€ï¼Œæ‰€ä»¥åé¢ç›´æ¥æ‰§è¡Œkubectlå‘½ä»¤å°±å¯ä»¥æ­£å¸¸è¿æ¥åˆ°API Serverä¸­ã€‚</p><p><strong>4.ä½¿ç”¨kubectlå‘½ä»¤æŸ¥çœ‹ç»„ä»¶çŠ¶æ€</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get cs</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS MESSAGE ERROR</span></span>
<span class="line"><span style="color:#a6accd">scheduler Healthy ok</span></span>
<span class="line"><span style="color:#a6accd">controller-manager Healthy ok</span></span>
<span class="line"><span style="color:#a6accd">etcd-0 Healthy {"health": "true"}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>**çŸ¥è¯†å›é¡¾ï¼šä¸ºä»€ä¹ˆä¸Šé¢çš„è¾“å‡ºæ²¡æœ‰æ˜¾ç¤ºAPI Serverç»„ä»¶çš„çŠ¶æ€</p><p>å› ä¸ºAPI Serveræ˜¯Kubernetesé›†ç¾¤çš„å…¥å£ï¼Œæ‰€æœ‰å’ŒKubernetesé›†ç¾¤çš„äº¤äº’éƒ½å¿…é¡»ç»è¿‡APIServerï¼Œkubectlå‘½ä»¤ä¹Ÿæ˜¯è¿æ¥åˆ°API Serverä¸Šè¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥å¦‚æœèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨kubectlæ‰§è¡Œå‘½ä»¤ï¼Œæ„å‘³ç€API Serverè¿è¡Œæ­£å¸¸ã€‚</p><p><strong>5.ä½¿ç”¨kubectlè·å–Nodeä¿¡æ¯</strong></p><p>ç›®å‰åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè§’è‰²æ˜¯Masterï¼ŒçŠ¶æ€æ˜¯NotReadyã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get node</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.unixhot.com NotReady master 14m v1.16.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="éƒ¨ç½²ç½‘ç»œæ’ä»¶" tabindex="-1">éƒ¨ç½²ç½‘ç»œæ’ä»¶ <a aria-current="page" href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>MasterèŠ‚ç‚¹NotReadyçš„åŸå› å°±æ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„ç½‘ç»œæ’ä»¶ï¼Œæ­¤æ—¶Nodeå’ŒMasterçš„è¿æ¥è¿˜ä¸æ­£å¸¸ã€‚ç›®å‰æœ€æµè¡Œçš„Kubernetesç½‘ç»œæ’ä»¶æœ‰Flannelã€Calicoã€Canalï¼Œè¿™é‡Œåˆ†åˆ«åˆ—ä¸¾äº†Canalå’ŒFlannelï¼Œä½ å¯ä»¥é€‰æ‹©å…¶ä¸­ä¹‹ä¸€è¿›è¡Œéƒ¨ç½²ã€‚ å› ä¸ºåŸºç¡€çš„Kubernetesé›†ç¾¤å·²ç»é…ç½®å®Œæ¯•ï¼Œåé¢çš„å¢åŠ ç»„ä»¶ç­‰æ“ä½œï¼Œå‡ ä¹éƒ½å¯ä»¥ä½¿ç”¨kubectlå’Œä¸€ä¸ªYAMLé…ç½®æ–‡ä»¶æ¥å®Œæˆã€‚</p><p>ã€éƒ¨ç½²canalç½‘ç»œæ’ä»¶ã€‘</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl apply -f https://docs.projectcalico.org/v3.3/getting-started/kubernetes/installation/hosted/canal/rbac.yaml</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl apply -f https://docs.projectcalico.org/v3.3/getting-started/kubernetes/installation/hosted/canal/canal.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ã€éƒ¨ç½²Flannelç½‘ç»œæ’ä»¶ã€‘ï¼ˆæ¨èï¼‰ éƒ¨ç½²Flannelç½‘ç»œæ’ä»¶éœ€è¦ä¿®æ”¹Podçš„IPåœ°å€æ®µï¼Œä¿®æ”¹ä¸ºå’Œä½ åˆå§‹åŒ–ä¸€ç›´çš„ç½‘æ®µï¼Œå¯ä»¥å…ˆä¸‹è½½Flannelçš„YAMLæ–‡ä»¶ä¿®æ”¹åï¼Œå†æ‰§è¡Œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# git clone --depth 1 https://github.com/coreos/flannel.git</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd flannel/Documentation/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 Documentation]# vim kube-flannel.yml</span></span>
<span class="line"><span style="color:#a6accd"># ä¿®æ”¹"Network": "10.244.0.0/16"ä¸º"Network": "10.2.0.0/16",</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">74   net-conf.json: |</span></span>
<span class="line"><span style="color:#a6accd">75     {</span></span>
<span class="line"><span style="color:#a6accd">76       "Network": "10.2.0.0/16",</span></span>
<span class="line"><span style="color:#a6accd">77       "Backend": {</span></span>
<span class="line"><span style="color:#a6accd">78         "Type": "vxlan"</span></span>
<span class="line"><span style="color:#a6accd">79       }</span></span>
<span class="line"><span style="color:#a6accd">80     }</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># è¯·æ³¨æ„ï¼ŒFlannelçš„é•œåƒæ‹‰å–é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œå¯ä»¥æ›¿æ¢ä¸ºå›½å†…é•œåƒ</span></span>
<span class="line"><span style="color:#a6accd"># image: quay.io/coreos/flannel:v0.10.0-amd64</span></span>
<span class="line"><span style="color:#a6accd">image: quay-mirror.qiniu.com/coreos/flannel:v0.11.0-amd64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># å¦‚æœNodeä¸­æœ‰å¤šä¸ªç½‘å¡ï¼Œå¯ä»¥ä½¿ç”¨--ifaceæ¥æŒ‡å®šå¯¹åº”çš„ç½‘å¡å‚æ•°ã€‚</span></span>
<span class="line"><span style="color:#a6accd">containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: kube-flannel</span></span>
<span class="line"><span style="color:#a6accd">        image: quay-mirror.qiniu.com/coreos/flannel:v0.11.0-amd64</span></span>
<span class="line"><span style="color:#a6accd">        command:</span></span>
<span class="line"><span style="color:#a6accd">        - /opt/bin/flanneld</span></span>
<span class="line"><span style="color:#a6accd">        args:</span></span>
<span class="line"><span style="color:#a6accd">        - --ip-masq</span></span>
<span class="line"><span style="color:#a6accd">        - --kube-subnet-mgr</span></span>
<span class="line"><span style="color:#a6accd">        - --iface=eth0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>éƒ¨ç½²Flannel</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 Documentation]# kubectl create -f kube-flannel.yml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹PodçŠ¶æ€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 Documentation]# kubectl get pod -n kube-system</span></span>
<span class="line"><span style="color:#a6accd">NAME                                              READY   STATUS     RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">coredns-58cc8c89f4-cjhdv                          0/1     Pending    0          41m</span></span>
<span class="line"><span style="color:#a6accd">coredns-58cc8c89f4-vdfn2                          0/1     Pending    0          41m</span></span>
<span class="line"><span style="color:#a6accd">etcd-linux-node1.unixhot.com                      1/1     Running    0          41m</span></span>
<span class="line"><span style="color:#a6accd">kube-apiserver-linux-node1.unixhot.com            1/1     Running    0          40m</span></span>
<span class="line"><span style="color:#a6accd">kube-controller-manager-linux-node1.unixhot.com   1/1     Running    1          40m</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-bwsxl                       0/1     Init:0/1   0          20s</span></span>
<span class="line"><span style="color:#a6accd">kube-proxy-5qrmh                                  1/1     Running    0          41m</span></span>
<span class="line"><span style="color:#a6accd">kube-scheduler-linux-node1.unixhot.com            1/1     Running    1          41m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶CoreDNSå¤„äºPendingçŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…ç½‘ç»œæ’ä»¶canalæˆ–è€…Flannelçš„PodçŠ¶æ€å˜æˆRunningä¹‹åCoreDNSä¹Ÿä¼šæ­£å¸¸ã€‚æ‰€æœ‰Podçš„çŠ¶æ€éƒ½å˜æˆRunningä¹‹åï¼Œè¿™ä¸ªæ—¶å€™å†æ¬¡è·å–Nodeï¼Œä¼šå‘ç°èŠ‚ç‚¹å˜æˆäº†ReadyçŠ¶æ€ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get node</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.unixhot.com Ready master 29m v1.16.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><em>kubeadmå…¶å®ä½¿ç”¨Kuberneteséƒ¨ç½²Kubernetesï¼Œè¿™æ ·å°±å­˜åœ¨å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰‹åŠ¨éƒ¨ç½²äº†Dockerå’Œkubeletï¼Œç„¶åkubeadmè°ƒç”¨kubeletä»¥é™æ€Podçš„æ–¹å¼éƒ¨ç½²äº†Kubernetesé›†ç¾¤ä¸­çš„å…¶å®ƒç»„ä»¶ã€‚é™æ€Podåœ¨åé¢çš„ç« èŠ‚ä¼šè®²åˆ°ã€‚</em></p><h3 id="éƒ¨ç½²nodeèŠ‚ç‚¹" tabindex="-1">éƒ¨ç½²NodeèŠ‚ç‚¹ <a aria-current="page" href="#éƒ¨ç½²nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>MasterèŠ‚ç‚¹éƒ¨ç½²å®Œæ¯•ä¹‹åï¼Œå°±å¯ä»¥éƒ¨ç½²NodeèŠ‚ç‚¹ï¼Œé¦–å…ˆè¯·éµå¾ªéƒ¨ç½²Dockerå’Œkubeadmç« èŠ‚ä¸ºNodeèŠ‚ç‚¹éƒ¨ç½²å®‰è£…å¥½dockerã€kubeadmå’Œkubeletï¼Œæ­¤è¿‡ç¨‹è¿™é‡Œä¸å†é‡å¤åˆ—å‡ºã€‚</p><p><strong>1.åœ¨MasterèŠ‚ç‚¹è¾“å‡ºå¢åŠ èŠ‚ç‚¹çš„å‘½ä»¤</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubeadm token create --print-join-command</span></span>
<span class="line"><span style="color:#a6accd">kubeadm join 192.168.56.11:6443 --token isggqa.xjwsm3i6nex91d2x --discovery-token-ca-cert-hash sha256:718827895a9a5e63dfa9ff54e16ad6dc0c493139c9c573b67ad66968036cd569</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.åœ¨NodeèŠ‚ç‚¹æ‰§è¡Œ</strong></p><p>æ³¨æ„å¦‚æœèŠ‚ç‚¹æœ‰äº¤æ¢åˆ†åŒºï¼Œéœ€è¦å¢åŠ --ignore-preflight-errors=Swapã€‚</p><p>éƒ¨ç½²linux-node2</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node2 ~]# kubeadm join 192.168.56.11:6443 --token isggqa.xjwsm3i6nex91d2x --discovery-token-ca-cert-hash sha256:718827895a9a5e63dfa9ff54e16ad6dc0c493139c9c573b67ad66968036cd569 --ignore-preflight-errors=Swap</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>éƒ¨ç½²linux-node3</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node3 ~]# kubeadm join 192.168.56.11:6443 --tokenisggqa.xjwsm3i6nex91d2x --discovery-token-ca-cert-hash sha256:718827895a9a5e63dfa9ff54e16ad6dc0c493139c9c573b67ad66968036cd569 --ignore-preflight-errors=Swap</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¸ªæ—¶å€™kubernetesä¼šä½¿ç”¨DaemonSetåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½²canal/flannelå’Œkube-proxyã€‚éƒ¨ç½²å®Œæ¯•ä¹‹åèŠ‚ç‚¹å³éƒ¨ç½²å®Œæ¯•ã€‚DaemonSetçš„å†…å®¹åé¢ä¼šè®²è§£ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">    [root@linux-node1 ~]# kubectl get daemonset --all-namespaces</span></span>
<span class="line"><span style="color:#a6accd">    NAMESPACE NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE</span></span>
<span class="line"><span style="color:#a6accd">    kube-system canal 2 2 1 2 1 beta.kubernetes.io/os=linux 17m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-proxy 2 2 2 2 2 &lt;none&gt; 47m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¾…æ‰€æœ‰Podå…¨éƒ¨å¯åŠ¨å®Œæ¯•ä¹‹åï¼ŒèŠ‚ç‚¹å°±æ¢å¤ReadyçŠ¶æ€ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">    [root@linux-node1 ~]# kubectl get pod --all-namespaces</span></span>
<span class="line"><span style="color:#a6accd">    NAMESPACE NAME READY STATUS RESTARTS AGE</span></span>
<span class="line"><span style="color:#a6accd">    kube-system canal-lv92w 3/3 Running 0 8m45s</span></span>
<span class="line"><span style="color:#a6accd">    kube-system canal-rq5n5 3/3 Running 0 23m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system coredns-78d4cf999f-5k4sg 1/1 Running 0 53m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system coredns-78d4cf999f-bnbgf 1/1 Running 0 53m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system etcd-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-apiserver-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-controller-manager-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-proxy-sddlp 1/1 Running 0 53m</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-proxy-tw96b 1/1 Running 0 8m45s</span></span>
<span class="line"><span style="color:#a6accd">    kube-system kube-scheduler-linux-node1.linuxhot.com 1/1 Running 0 52m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹</strong> `` [root@linux-node1 ~]# kubectl get node NAME STATUS ROLES AGE VERSION <a href="http://linux-node1.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node1.linuxhot.com<!--]--></a> Ready master 49m v1.13.2 <a href="http://linux-node2.linuxhot.com" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->linux-node2.linuxhot.com<!--]--></a> Ready 4m48s v1.13.2</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">**å¦‚ä½•ç»™NodeåŠ ä¸ŠRolesæ ‡ç­¾**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">ä½¿ç”¨kubectl get nodeèƒ½å¤Ÿçœ‹åˆ°linux-node1.linuxhot.comçš„ROLESæ˜¯masterè¿™ä¸ªæ˜¯åœ¨è¿›è¡Œé›†ç¾¤åˆå§‹åŒ–çš„æ—¶å€™[mark-control-plane]è¿›è¡Œæ ‡è®°çš„ã€‚</span></span>
<span class="line"><span style="color:#a6accd">[mark-control-plane] Marking the node linux-node1.linuxhot.com as control-plane</span></span>
<span class="line"><span style="color:#a6accd">by adding the label "node-role.kubernetes.io/master=''"</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[mark-control-plane] Marking the node linux-node1.linuxhot.com as control-plane</span></span>
<span class="line"><span style="color:#a6accd">by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span></span>
<span class="line"><span style="color:#a6accd">1.æŸ¥çœ‹èŠ‚ç‚¹çš„æ ‡ç­¾</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get nodes --show-labels</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION LABELS</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">linux-node1.linuxhot.com Ready master 48m v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=linux-node1.linuxhot.com,node-role.kubernetes.io/master=</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">linux-node2.linuxhot.com Ready &lt;none&gt; 7m13s v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">2.å¢åŠ æ ‡ç­¾</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl label nodes linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">node-role.kubernetes.io/node=</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">node/linux-node2.linuxhot.com labeled</span></span>
<span class="line"><span style="color:#a6accd">3.æŸ¥çœ‹æ•ˆæœ</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get nodes</span></span>
<span class="line"><span style="color:#a6accd">NAME STATUS ROLES AGE VERSION</span></span>
<span class="line"><span style="color:#a6accd">linux-node1.linuxhot.com Ready master 50m v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">linux-node2.linuxhot.com Ready node 8m41s v1.13.3</span></span>
<span class="line"><span style="color:#a6accd">### æµ‹è¯•Kubernetesé›†ç¾¤ {#test}</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªKubernetesé›†ç¾¤ï¼Œ1ä¸ªMasterå’Œ2ä¸ªNodeèŠ‚ç‚¹ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦è€ƒè™‘Masterçš„é«˜å¯ç”¨ï¼Œè¿™é‡Œå…ˆä¸ç”¨è€ƒè™‘ï¼Œåé¢ä¼šè®²åˆ°ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">**1.åˆ›å»ºä¸€ä¸ªå•Podçš„Nginxåº”ç”¨**</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create deployment nginx --image=nginx:alpine</span></span>
<span class="line"><span style="color:#a6accd">deployment.apps/nginx created</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE</span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-9j7ql 0/1 ContainerCreating 0 10s</span></span>
<span class="line"><span style="color:#a6accd">**2.æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">å¾…Podçš„çŠ¶æ€ä¸ºRunningåï¼Œå¯ä»¥è·å–Podçš„IPåœ°å€ï¼Œè¿™ä¸ªIPåœ°å€æ˜¯ä»MasterèŠ‚ç‚¹åˆå§‹åŒ–çš„--pod-network-cidr=10.2.0.0/16åœ°å€æ®µä¸­åˆ†é…çš„ã€‚</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-9j7ql 1/1 Running 0 59s 10.2.1.2 linux-node2.linuxhot.com</span></span>
<span class="line"><span style="color:#a6accd">&lt;none&gt; &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">**3.æµ‹è¯•Nginxè®¿é—®**</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head http://10.2.1.2</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.15.8</span></span>
<span class="line"><span style="color:#a6accd">Date: Sun, 13 Jan 2019 01:16:36 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Wed, 26 Dec 2018 23:21:49 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "5c240d0d-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd">**4.æµ‹è¯•æ‰©å®¹**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">ç°åœ¨å°†Nginxåº”ç”¨çš„Podå‰¯æœ¬æ•°é‡æ‹“å±•åˆ°2ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl scale deployment nginx --replicas=2</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">deployment.extensions/nginx scaled</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME READY STATUS RESTARTS AGE</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-9j7ql 1/1 Running 0 2m13s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">nginx-54458cd494-vnm4f 1/1 Running 0 5s</span></span>
<span class="line"><span style="color:#a6accd">**5.ä¸ºNginxå¢åŠ Service**</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">ä¸ºNginxå¢åŠ Serviceï¼Œä¼šåˆ›å»ºä¸€ä¸ªCluster</span></span>
<span class="line"><span style="color:#a6accd">IPï¼Œä»Masteråˆå§‹åŒ–çš„--service-cidr=10.1.0.0/16åœ°å€æ®µä¸­è¿›è¡Œåˆ†é…ï¼Œ</span></span>
<span class="line"><span style="color:#a6accd">å¹¶å¼€å¯NodePortæ˜¯åœ¨NodeèŠ‚ç‚¹ä¸Šè¿›è¡Œç«¯å£æ˜ å°„ï¼Œè¿›è¡Œå¤–éƒ¨è®¿é—®ã€‚</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl expose deployment nginx --port=80</span></span>
<span class="line"><span style="color:#a6accd">--type=NodePort</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">service/nginx exposed</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span></span>
<span class="line"><span style="color:#a6accd">kubernetes ClusterIP 10.1.0.1 &lt;none&gt; 443/TCP 88m</span></span>
<span class="line"><span style="color:#a6accd">nginx NodePort 10.1.147.204 &lt;none&gt; 80:30599/TCP 67m</span></span>
<span class="line"><span style="color:#a6accd">**6.æµ‹è¯•Serviceçš„VIP**</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head http://10.1.147.204/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK </span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.15.8</span></span>
<span class="line"><span style="color:#a6accd">Date: Sun, 13 Jan 2019 01:26:21 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Wed, 26 Dec 2018 23:21:49 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "5c240d0d-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>``` <strong>7.æµ‹è¯•NodePortï¼Œå¤–éƒ¨è®¿é—®ã€‚</strong></p><p><img src="http://k8s.unixhot.com/kubernetes/media/1f9d523f359ce6d49515d04703d8e941.png" alt="img"></p><p>è¿™ä¸€åˆ‡çœ‹èµ·æ¥ä¼¼ä¹ä¸æ˜¯ååˆ†å®Œç¾ï¼Œä½†æ˜¯ç°åœ¨ä½ å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªKubernetesé›†ç¾¤ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç»§ç»­æ¢ç´¢Kubernetesçš„ä¸–ç•Œäº†ã€‚</p><h2 id="å…¬æœ‰äº‘ä¸­çš„kubernetes" tabindex="-1">å…¬æœ‰äº‘ä¸­çš„Kubernetes <a aria-current="page" href="#å…¬æœ‰äº‘ä¸­çš„kubernetes" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æˆªæ­¢2019å¹´2æœˆï¼Œå¤§å¤šæ•°å…¬æœ‰äº‘å·²ç»æä¾›äº†å®¹å™¨Kubernetesçš„äº§å“æœåŠ¡ï¼Œå¯¹äºä½¿ç”¨å…¬æœ‰äº‘çš„ç”¨æˆ·æ¥è¯´ï¼Œæœ€ä½³å®è·µæ˜¯ç›´æ¥è´­ä¹°å…¬æœ‰äº‘äº§å“ï¼Œè€Œéè‡ªå·±éƒ¨ç½²Kubernetesé›†ç¾¤ï¼Œä¸»è¦æ˜¯å› ä¸ºå…¬æœ‰äº‘å·²ç»å°†ç½‘ç»œå’Œå­˜å‚¨ä¸Kubernetesé›†æˆå¥½äº†ï¼Œè§£å†³äº†ç”Ÿäº§åº”ç”¨çš„éš¾é¢˜ã€‚</p><h3 id="é˜¿é‡Œäº‘ä¸­çš„kubernetes" tabindex="-1">é˜¿é‡Œäº‘ä¸­çš„Kubernetes <a aria-current="page" href="#é˜¿é‡Œäº‘ä¸­çš„kubernetes" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å›½å†…é˜¿é‡Œäº‘æä¾›äº†å®¹å™¨æœåŠ¡ Kubernetes ç‰ˆï¼ˆç®€ç§° ACKï¼‰æä¾›é«˜æ€§èƒ½å¯ä¼¸ç¼©çš„å®¹å™¨åº”ç”¨ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒä¼ä¸šçº§ Kubernetes å®¹å™¨åŒ–åº”ç”¨çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å®¹å™¨æœåŠ¡ Kubernetes ç‰ˆç®€åŒ–é›†ç¾¤çš„æ­å»ºå’Œæ‰©å®¹ç­‰å·¥ä½œï¼Œæ•´åˆé˜¿é‡Œäº‘è™šæ‹ŸåŒ–ã€å­˜å‚¨ã€ç½‘ç»œå’Œå®‰å…¨èƒ½åŠ›ï¼Œæ‰“é€ äº‘ç«¯æœ€ä½³çš„ Kubernetes å®¹å™¨åŒ–åº”ç”¨è¿è¡Œç¯å¢ƒã€‚</p><p><strong>é˜¿é‡Œäº‘Kubernetesæ¨¡å¼</strong></p><p>å®¹å™¨æœåŠ¡Kubernetesç‰ˆåŒ…å«äº†ç»å…¸Dedicated Kubernetesä»¥åŠServerlessä¸¤ç§å½¢æ€ï¼Œæ–¹ä¾¿æ‚¨æŒ‰éœ€é€‰æ‹©ã€‚</p><ul><li>ç»å…¸Dedicated Kubernetesæ¨¡å¼ï¼šæ‚¨å¯ä»¥å¯¹é›†ç¾¤åŸºç¡€è®¾æ–½å’Œå®¹å™¨åº”ç”¨è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ¯”å¦‚é€‰æ‹©å®¿ä¸»æœºå®ä¾‹è§„æ ¼å’Œæ“ä½œç³»ç»Ÿï¼ŒæŒ‡å®šKubernetes ç‰ˆæœ¬ã€è‡ªå®šä¹‰ Kubernetes ç‰¹æ€§å¼€å…³è®¾ç½®ç­‰ã€‚é˜¿é‡Œäº‘ Kubernetes æœåŠ¡è´Ÿè´£ä¸ºé›†ç¾¤åˆ›å»ºåº•å±‚äº‘èµ„æºï¼Œå‡çº§ç­‰è‡ªåŠ¨åŒ–è¿ç»´æ“ä½œã€‚è€Œæ‚¨éœ€è¦è§„åˆ’ã€ç»´æŠ¤ã€å‡çº§æœåŠ¡å™¨é›†ç¾¤ï¼Œæ‰‹åŠ¨æˆ–è‡ªåŠ¨åœ¨é›†ç¾¤ä¸­æ·»åŠ æˆ–åˆ é™¤æœåŠ¡å™¨ã€‚</li><li>Serverless æ¨¡å¼ï¼šæ‚¨æ— éœ€åˆ›å»ºåº•å±‚è™šæ‹ŸåŒ–èµ„æºï¼Œå¯ä»¥åˆ©ç”¨ Kubernetes å‘½ä»¤æŒ‡æ˜åº”ç”¨å®¹å™¨é•œåƒã€CPU å’Œå†…å­˜è¦æ±‚ä»¥åŠå¯¹å¤–æœåŠ¡æ–¹å¼ï¼Œç›´æ¥å¯åŠ¨ã€‚</li></ul><p><strong>é˜¿é‡Œäº‘Kubernetesäº§å“æ¶æ„</strong></p><p><img src="http://k8s.unixhot.com/kubernetes/media/43688d33a81f2bd6af354d0715b6b297.png" alt="C:UsersjasonDesktop15447553537457_zh-CN.png"></p><p><strong>é˜¿é‡Œäº‘Kubernetesåˆ›å»º</strong></p><p>é»˜è®¤æƒ…å†µä¸‹å¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸­è‡ªè¡Œåˆ›å»º5ä¸ªé›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤æœ€å¤šå¯ä»¥æ·»åŠ  40 ä¸ªèŠ‚ç‚¹ã€‚å¦‚éœ€æ›´é«˜é…é¢ï¼Œéœ€è¦æäº¤å·¥å•ç”³è¯·ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/4c165d0ebc842862595f9fd0f4650d43.png" alt="img"></p><p>é˜¿é‡Œäº‘å°†ç½‘ç»œã€å­˜å‚¨ã€å®‰å…¨ç­‰æ–¹é¢å·²ç»è¿›è¡Œäº†æ·±åº¦é›†æˆï¼Œåœ¨åˆ›å»ºKubernetesé›†ç¾¤æ—¶ï¼Œé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æä¾›ä¸¤ç§ç½‘ç»œæ’ä»¶ï¼šTerwayå’ŒFlannelï¼š</p><ul><li>Flannelï¼šä½¿ç”¨çš„æ˜¯ç®€å•ç¨³å®šçš„ç¤¾åŒºçš„Flannel CNIæ’ä»¶ï¼Œé…åˆé˜¿é‡Œäº‘çš„VPCçš„é«˜é€Ÿç½‘ç»œï¼Œèƒ½ç»™é›†ç¾¤é«˜æ€§èƒ½å’Œç¨³å®šçš„å®¹å™¨ç½‘ç»œä½“éªŒï¼Œä½†åŠŸèƒ½åç®€å•ï¼Œæ”¯æŒçš„ç‰¹æ€§å°‘ï¼Œä¾‹å¦‚ï¼šä¸æ”¯æŒåŸºäºKubernetesæ ‡å‡†çš„Network Policyã€‚</li><li>Terwayï¼šæ˜¯é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡è‡ªç ”çš„ç½‘ç»œæ’ä»¶ï¼ŒåŠŸèƒ½ä¸Šå®Œå…¨å…¼å®¹Flannelï¼Œæ”¯æŒå°†é˜¿é‡Œäº‘çš„å¼¹æ€§ç½‘å¡åˆ†é…ç»™å®¹å™¨ï¼Œæ”¯æŒåŸºäºKubernetesæ ‡å‡†çš„NetworkPolicyæ¥å®šä¹‰å®¹å™¨é—´çš„è®¿é—®ç­–ç•¥ï¼Œæ”¯æŒå¯¹å•ä¸ªå®¹å™¨åšå¸¦å®½çš„é™æµã€‚å¯¹äºä¸éœ€è¦ä½¿ç”¨Network Policyçš„ç”¨æˆ·ï¼Œå¯ä»¥é€‰æ‹©Flannelï¼Œå…¶ä»–æƒ…å†µå»ºè®®é€‰æ‹©Terwayã€‚äº†è§£æ›´å¤šTerwayç½‘ç»œæ’ä»¶çš„ç›¸å…³å†…å®¹ï¼Œè¯·å‚è§Terwayç½‘ç»œæ’ä»¶ã€‚</li></ul><p>æœ€ç»ˆé˜¿é‡Œäº‘ä¼šä½¿ç”¨kubeadmå¸®ä½ åˆ›å»ºä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„Kubernetesé›†ç¾¤ã€‚</p><h3 id="ç§æœ‰äº‘ä¸­çš„kubernetes" tabindex="-1">ç§æœ‰äº‘ä¸­çš„Kubernetes <a aria-current="page" href="#ç§æœ‰äº‘ä¸­çš„kubernetes" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>å†…ç½‘éƒ¨ç½²Kubernetes</strong></p><p>å¾ˆå¤šä¼ä¸šéœ€è¦å†…ç½‘éƒ¨ç½²Kubernetesä½†æ˜¯å†…ç½‘åˆæ— æ³•è®¿é—®å¤–ç½‘ï¼Œå°±éœ€è¦æœ¬åœ°åŒ–éƒ¨ç½²ï¼Œæ— å¿˜äº†æœ¬åœ°è¯éƒ¨ç½²ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯è½¯ä»¶ä»“åº“çš„å‡†å¤‡ï¼Œä¸€ä¸ªæ˜¯Kubernetesé•œåƒçš„å‡†å¤‡ã€‚</p><ol><li>å‡†å¤‡å†…ç½‘YUMä»“åº“ï¼ˆç•¥ï¼‰</li><li>å‡†å¤‡Docker Registryï¼ˆè¯·å‚è€ƒHarborç« èŠ‚ï¼‰</li><li>ä¸‹è½½å¹¶æäº¤é•œåƒåˆ°Harborä¸­ï¼Œç„¶åå°†Harborçš„é•œåƒéƒ¨ç½²ç›´æ¥COPYåˆ°ç”Ÿäº§ç¯å¢ƒä¸­</li></ol><p>ä¸‹è½½è„šæœ¬å¦‚ä¸‹ï¼Œè¯·æ ¹æ®éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim k8s-images.sh</span></span>
<span class="line"><span style="color:#a6accd">#!/bin/bash</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># EVN</span></span>
<span class="line"><span style="color:#a6accd">ALIYUN_REG="registry.aliyuncs.com/google_containers"</span></span>
<span class="line"><span style="color:#a6accd">FLANNEL_REG="quay-mirror.qiniu.com/coreos"</span></span>
<span class="line"><span style="color:#a6accd">LOCAL_REG="192.168.56.11/kubernetes"</span></span>
<span class="line"><span style="color:#a6accd">K8S_VER=v1.15.5</span></span>
<span class="line"><span style="color:#a6accd">PAUSE_VER=3.1</span></span>
<span class="line"><span style="color:#a6accd">ETCD_VER=3.3.10</span></span>
<span class="line"><span style="color:#a6accd">COREDNS_VER=1.3.1</span></span>
<span class="line"><span style="color:#a6accd">FLANNEL_VER=v0.11.0-amd64</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># Kubernetes Docker Images</span></span>
<span class="line"><span style="color:#a6accd">IMAGES=(</span></span>
<span class="line"><span style="color:#a6accd">  kube-proxy:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  kube-scheduler:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  kube-controller-manager:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  kube-apiserver:${K8S_VER}</span></span>
<span class="line"><span style="color:#a6accd">  pause:${PAUSE_VER}</span></span>
<span class="line"><span style="color:#a6accd">  etcd-amd64:${ETCD_VER}</span></span>
<span class="line"><span style="color:#a6accd">  coredns:${COREDNS_VER}</span></span>
<span class="line"><span style="color:#a6accd">)</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">for IMAGE in ${IMAGES[@]}</span></span>
<span class="line"><span style="color:#a6accd">do</span></span>
<span class="line"><span style="color:#a6accd">  docker pull ${ALIYUN_REG}/${IMAGE}</span></span>
<span class="line"><span style="color:#a6accd">  docker tag ${ALIYUN_REG}/${IMAGE} ${LOCAL_REG}/${IMAGE}</span></span>
<span class="line"><span style="color:#a6accd">  #docker push ${LOCAL_REG}/${IMAGES}</span></span>
<span class="line"><span style="color:#a6accd">done</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># Flannel</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">docker pull ${FLANNEL_REG}/flannel:${FLANNEL_VER}</span></span>
<span class="line"><span style="color:#a6accd">docker tag ${FLANNEL_REG}/flannel:${FLANNEL_VER} ${LOCAL_REG}/flannel:${FLANNEL_VER}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="ç¬¬äº”éƒ¨åˆ†-å°†åº”ç”¨è¿ç§»è‡³kubernetes" tabindex="-1">ç¬¬äº”éƒ¨åˆ† å°†åº”ç”¨è¿ç§»è‡³Kubernetes <a aria-current="page" href="#ç¬¬äº”éƒ¨åˆ†-å°†åº”ç”¨è¿ç§»è‡³kubernetes" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_6-ç¬¬ä¸€æ­¥ï¼šå°†åº”ç”¨å°è£…è¿›å®¹å™¨ä¸­" tabindex="-1">6 ç¬¬ä¸€æ­¥ï¼šå°†åº”ç”¨å°è£…è¿›å®¹å™¨ä¸­ <a aria-current="page" href="#_6-ç¬¬ä¸€æ­¥ï¼šå°†åº”ç”¨å°è£…è¿›å®¹å™¨ä¸­" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h2 id="ç¬¬ä¸€æ­¥ï¼šå°†åº”ç”¨å°è£…è¿›å®¹å™¨ä¸­" tabindex="-1">ç¬¬ä¸€æ­¥ï¼šå°†åº”ç”¨å°è£…è¿›å®¹å™¨ä¸­ <a aria-current="page" href="#ç¬¬ä¸€æ­¥ï¼šå°†åº”ç”¨å°è£…è¿›å®¹å™¨ä¸­" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>åœ¨ä¹‹å‰çš„å®¹å™¨é•œåƒå®æˆ˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•å°†åº”ç”¨å®¹å™¨åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä¸‹è½½ä½¿ç”¨ä¸¤ä¸ªå®˜æ–¹çš„Nginxé•œåƒæ¥å®Œæˆæ¥ä¸‹æ¥çš„å®éªŒã€‚</p><h3 id="éƒ¨ç½²harboré•œåƒä»“åº“" tabindex="-1">éƒ¨ç½²Harboré•œåƒä»“åº“ <a aria-current="page" href="#éƒ¨ç½²harboré•œåƒä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥ä½¿ç”¨Harboræ¥ç®¡ç†Dockeré•œåƒï¼Œè¯·å‚è€ƒä¹‹å‰ç« èŠ‚çš„å†…å®¹å®ŒæˆHarboré•œåƒä»“åº“çš„éƒ¨ç½²å·¥ä½œï¼Œå¹¶åœ¨Harborä¸­åˆ›å»ºä¸€ä¸ªdevopseduçš„é¡¹ç›®ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/093b4b731c05b54a1b8426e924f93d45.png" alt="img"></p><h3 id="åˆ¶ä½œå®éªŒç”¨çš„dockeré•œåƒ" tabindex="-1">åˆ¶ä½œå®éªŒç”¨çš„Dockeré•œåƒ <a aria-current="page" href="#åˆ¶ä½œå®éªŒç”¨çš„dockeré•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>è¿™é‡Œä¸å†æ¼”ç¤ºDockeré•œåƒçš„æ„å»ºï¼Œç›´æ¥ä¸‹è½½ä¸¤ä¸ªå®˜æ–¹é•œåƒä½œä¸ºæ¡ˆä¾‹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker pull nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="é…ç½®dockerä»“åº“" tabindex="-1">é…ç½®Dockerä»“åº“ <a aria-current="page" href="#é…ç½®dockerä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root\@linux-node1 ~]# vim /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">    "registry-mirrors": ["https://tdimi5q1.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="color:#a6accd">    "insecure-registries" : ["http://192.168.56.11"]</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart docker</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ç™»å½•harboré•œåƒä»“åº“" tabindex="-1">ç™»å½•Harboré•œåƒä»“åº“ <a aria-current="page" href="#ç™»å½•harboré•œåƒä»“åº“" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker login 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">Username: admin</span></span>
<span class="line"><span style="color:#a6accd">Password:</span></span>
<span class="line"><span style="color:#a6accd">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span>
<span class="line"><span style="color:#a6accd">    Configure a credential helper to remove this warning. See</span></span>
<span class="line"><span style="color:#a6accd">    https://docs.docker.com/engine/reference/commandline/login/\#credentials-store</span></span>
<span class="line"><span style="color:#a6accd">    Login Succeeded</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="æäº¤é•œåƒåˆ°registry" tabindex="-1">æäº¤é•œåƒåˆ°Registry <a aria-current="page" href="#æäº¤é•œåƒåˆ°registry" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker tag nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11/devopsedu/nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker tag nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd">192.168.56.11/devopsedu/nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker push 192.168.56.11/devopsedu/nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker push 192.168.56.11/devopsedu/nginx:1.14.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæ¨¡æ‹Ÿäº†ç”Ÿäº§ç¯å¢ƒå¦‚ä½•æ„å»ºå’Œæäº¤é•œåƒï¼Œå¦‚æœå¯¹äºæ„å»ºå’Œæäº¤é•œåƒæœ‰ç–‘é—®å¯ä»¥å¤ä¹ ç¬¬3ç« çš„å†…å®¹ã€‚</p><h1 id="_7-ç¬¬äºŒæ­¥ï¼šå°†å®¹å™¨å°è£…åˆ°podä¸­" tabindex="-1">7 ç¬¬äºŒæ­¥ï¼šå°†å®¹å™¨å°è£…åˆ°Podä¸­ <a aria-current="page" href="#_7-ç¬¬äºŒæ­¥ï¼šå°†å®¹å™¨å°è£…åˆ°podä¸­" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>Podæ˜¯Kubernetesæœ€å°çš„ç®¡ç†å•å…ƒï¼Œä¸€ä¸ªPodå¯ä»¥ä»£è¡¨ä¸€ä¸ªè¿è¡Œåœ¨é›†ç¾¤é‡Œçš„è¿›ç¨‹ã€‚ä¹‹å‰æ˜¯åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œä¸åŒçš„è¿›ç¨‹ï¼Œç°åœ¨æ˜¯è¿è¡Œä¸åŒçš„Podã€‚å‰é¢ä»‹ç»è¿‡Podæ˜¯ä¸€ä¸ªé€»è¾‘æ¶æ„çš„ç»„ä»¶ï¼ŒPodé‡Œå°è£…äº†ä¸€ä¸ªï¼ˆæˆ–è€…å¤šä¸ªï¼‰åº”ç”¨å®¹å™¨ï¼Œå­˜å‚¨èµ„æºå’ŒIPåœ°å€ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦é€ ä¸€ä¸ªPodå‡ºæ¥ï¼Ÿ</strong> å­¦ä¹ Kubernetesé‡åˆ°çš„æœ€å¤šçš„åç§°å¯èƒ½å°±æ˜¯Podäº†ï¼Œå…¶å®ƒå¼€æºçš„å®¹å™¨ç®¡ç†å¹³å°ä¾‹å¦‚Mesosç›´æ¥ç®¡ç†å’Œè°ƒåº¦çš„æ˜¯å®¹å™¨ï¼Œä½†æ˜¯Kubernetesç¡®æ˜¯Podï¼Œå®ƒåœ¨å®¹å™¨ä¸Šé¢åšäº†ä¸€å±‚å°è£…ï¼Œæ–¹ä¾¿ç”¨æˆ·å°†ä¸€ç»„ç´§è€¦åˆçš„å®¹å™¨ï¼Œæ”¾ç½®åœ¨ä¸€ä¸ªå…±äº«èµ„æºçš„å•å…ƒä¸­ã€‚å¯¹äºå¾ˆå¤šæ²¡æœ‰æ­¤ç±»åœºæ™¯çš„åˆå­¦è€…ï¼Œå¯ä»¥æš‚æ—¶å°†Podçœ‹åšæ˜¯å®¹å™¨çš„ä¸€ä¸ªå£³ï¼Œä½ ä¹Ÿå®Œå…¨å¯ä»¥åªåœ¨Podä¸­è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œéšç€å­¦ä¹ çš„æ·±å…¥å†æ…¢æ…¢ç†è§£ã€‚ Kubernetesè¿è¡ŒPodçš„ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>Podé‡Œåªè¿è¡Œä¸€ä¸ªå•ç‹¬å®¹å™¨ï¼Œæ˜¯Kubernetesæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æŠŠPodçœ‹åšæ˜¯ä¸€ä¸ªå•ç‹¬å®¹å™¨çš„è¿æ¥å™¨ï¼ŒKubernetesé€šè¿‡Podå»ç®¡ç†å®¹å™¨ï¼Œä½œä¸ºä½¿ç”¨è€…å‡ ä¹ä¸ç”¨å…³å¿ƒå®¹å™¨ã€‚</li><li>Podé‡Œè¿è¡Œå¤šä¸ªæœ‰å…³ç³»å®¹å™¨ã€‚ä¾‹å¦‚å¦‚æœä½¿ç”¨Nginx+Tomcatè¿è¡ŒJavaåº”ç”¨ï¼Œå¯ä»¥åˆ¶ä½œä¸€ä¸ªé•œåƒé‡Œé¢åŒ…å«äº†Nginx+Tomcatï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åˆ¶ä½œä¸¤ä¸ªé•œåƒNginxé•œåƒå’ŒTomcaté•œåƒï¼Œå¦‚æœä½¿ç”¨Kuberneteså°±éœ€è¦ä½¿ç”¨Podï¼Œå¦‚æœå°†Nginxå’ŒTomcatå•ç‹¬æ”¾åœ¨ä¸¤ä¸ªPodé‡Œé¢æ¥ç®¡ç†ï¼Œå°±ä¼šé¢ä¸´å¾ˆå¤šå¾ˆå¤šé—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸¤ä¸ªå®¹å™¨æ”¾ç½®åœ¨ä¸€ä¸ªPodä¸­ã€‚</li></ul><h2 id="podç®¡ç†" tabindex="-1">Podç®¡ç† <a aria-current="page" href="#podç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>åœ¨Kubernetesä¸­ä½¿ç”¨YAMLæ ¼å¼æ¥æè¿°ä¸€ä¸ªPodã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nginx-pod.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Pod</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-pod</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  containers:</span></span>
<span class="line"><span style="color:#a6accd">  - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">    image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">    ports:</span></span>
<span class="line"><span style="color:#a6accd">- containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Podçš„YAMLæè¿°å†…å®¹è¿˜æœ‰å¾ˆå¤šï¼Œåœ¨ä½¿ç”¨kubeadméƒ¨ç½²Kubernetesçš„æ—¶å€™ï¼Œå°±æ˜¯ä½¿ç”¨é™æ€Podçš„æ–¹å¼è¿è¡Œçš„ç›¸å…³æœåŠ¡ï¼ŒYAMLæ–‡ä»¶å­˜æ”¾åœ¨ï¼Œå½“ç„¶ç°åœ¨å¾ˆå¤šé…ç½®è¿˜æ˜¯çœ‹ä¸æ‡‚çš„ï¼Œå¸¦ç€é—®é¢˜ç»§ç»­å­¦ä¹ ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# ls -l /etc/kubernetes/manifests/</span></span>
<span class="line"><span style="color:#a6accd">total 16</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 2041 Feb 11 20:33 etcd.yaml</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 2700 Feb 11 20:33 kube-apiserver.yaml</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 2345 Feb 11 20:33 kube-controller-manager.yaml</span></span>
<span class="line"><span style="color:#a6accd">-rw------- 1 root root 1080 Feb 11 20:33 kube-scheduler.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ›å»ºPod</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nginx-pod.yaml </span></span>
<span class="line"><span style="color:#a6accd">pod "nginx-pod" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Pod</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd">NAME                                READY     STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">nginx-pod                           1/1       Running   0          49s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Podæ›´å¤šä¿¡æ¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd">NAME                                READY     STATUS    RESTARTS   AGE       IP           NODE</span></span>
<span class="line"><span style="color:#a6accd">nginx-pod  1/1       Running   0          1m        10.2.53.18   192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Podè¯¦æƒ…</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe pod nginx-pod</span></span>
<span class="line"><span style="color:#a6accd">Name:         nginx-pod</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Node:         192.168.56.13/192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd">Start Time:   Sat, 02 Jun 2018 06:42:53 +0800</span></span>
<span class="line"><span style="color:#a6accd">Labels:       app=nginx</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Status:       Running</span></span>
<span class="line"><span style="color:#a6accd">IP:           10.2.53.18</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Podæ—¥å¿—</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl logs pod/nginx-pod</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Podä¸­çš„é•œåƒæ‹‰å–ç­–ç•¥</strong> å½“kubeletå°è¯•æ‹‰å–æŒ‡å®šçš„é•œåƒæ—¶ï¼Œ[imagePullPolicy]å’Œé•œåƒçš„æ ‡ç­¾ä¼šç”Ÿæ•ˆã€‚</p><ul><li>imagePullPolicy: IfNotPresentï¼šä»…å½“é•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨æ—¶é•œåƒæ‰è¢«æ‹‰å–ã€‚</li><li>imagePullPolicy: Alwaysï¼šæ¯æ¬¡å¯åŠ¨ pod çš„æ—¶å€™éƒ½ä¼šæ‹‰å–é•œåƒã€‚</li></ul><p>çœç•¥imagePullPolicyï¼Œé•œåƒæ ‡ç­¾ä¸º:latestæˆ–è¢«çœç•¥ï¼ŒAlwaysè¢«åº”ç”¨ã€‚ imagePullPolicyè¢«çœç•¥ï¼Œå¹¶ä¸”é•œåƒçš„æ ‡ç­¾è¢«æŒ‡å®šä¸”ä¸æ˜¯:latestï¼ŒIfNotPresentè¢«åº”ç”¨ã€‚ imagePullPolicy: Neverï¼šé•œåƒè¢«å‡è®¾å­˜åœ¨äºæœ¬åœ°ã€‚ æ²¡æœ‰å°è¯•æ‹‰å–é•œåƒã€‚</p><h1 id="_7-3-ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨controllersç®¡ç†pod" tabindex="-1">7.3 ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨Controllersç®¡ç†Pod <a aria-current="page" href="#_7-3-ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨controllersç®¡ç†pod" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å…¶å®å¾ˆå°‘å•ç‹¬åˆ›å»ºPodï¼Œè€Œæ˜¯é€šè¿‡æ§åˆ¶å™¨æ¥è¿›è¡ŒPodçš„ç®¡ç†ï¼ŒKubernetesæä¾›äº†å¾ˆå¤šçš„æ§åˆ¶å™¨ï¼Œä¸€ä¸ª Controllers å¯ä»¥åˆ›å»ºå’Œç®¡ç†å¾ˆå¤šä¸ª Pod, ä¹Ÿæä¾›å¤åˆ¶ã€åˆå§‹åŒ–ï¼Œä»¥åŠæä¾›é›†ç¾¤èŒƒå›´çš„è‡ªæˆ‘æ¢å¤çš„åŠŸèƒ½ã€‚æ¯”å¦‚è¯´ï¼š å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼ŒController å°†è°ƒåº¦ä¸€ä¸ªåœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šå®Œå…¨ç›¸åŒçš„ pod æ¥è‡ªåŠ¨å–ä»£å½“å‰çš„ podã€‚</p><h1 id="_8-1-replication-controlleræ§åˆ¶å™¨" tabindex="-1">8.1 Replication Controlleræ§åˆ¶å™¨ <a aria-current="page" href="#_8-1-replication-controlleræ§åˆ¶å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_8-2-replica-setsæ§åˆ¶å™¨" tabindex="-1">8.2 Replica Setsæ§åˆ¶å™¨ <a aria-current="page" href="#_8-2-replica-setsæ§åˆ¶å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_8-3-deploymentæ§åˆ¶å™¨" tabindex="-1">8.3 Deploymentæ§åˆ¶å™¨ <a aria-current="page" href="#_8-3-deploymentæ§åˆ¶å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_8-4-daemonsetæ§åˆ¶å™¨" tabindex="-1">8.4 DaemonSetæ§åˆ¶å™¨ <a aria-current="page" href="#_8-4-daemonsetæ§åˆ¶å™¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…ä¸€äº›ï¼‰Node ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å½“æœ‰ Node åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Pod ã€‚å½“æœ‰ Node ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Podã€‚ ä½¿ç”¨ DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š</p><ul><li>è¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œ glusterdã€cephã€‚</li><li>åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›† daemonï¼Œä¾‹å¦‚filebeatã€logstashã€‚</li><li>åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œç›‘æ§ daemonï¼Œä¾‹å¦‚ Prometheus Node Exporterã€collectdã€Datadog ä»£ç†ã€Zabbix Agentã€‚</li></ul><p><strong>åˆ›å»ºDaemonSet</strong></p><p>DaemonSetçš„æè¿°æ–‡ä»¶å’ŒDeploymentéå¸¸ç›¸ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹Kindï¼Œå¹¶å»æ‰å‰¯æœ¬æ•°é‡çš„é…ç½®å³å¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 example]# vim nginx-daemonset.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: DaemonSet</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-daemonset</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    matchLabels:</span></span>
<span class="line"><span style="color:#a6accd">      app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  template:</span></span>
<span class="line"><span style="color:#a6accd">    metadata:</span></span>
<span class="line"><span style="color:#a6accd">      labels:</span></span>
<span class="line"><span style="color:#a6accd">        app: nginx</span></span>
<span class="line"><span style="color:#a6accd">    spec:</span></span>
<span class="line"><span style="color:#a6accd">      containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">        image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">        ports:</span></span>
<span class="line"><span style="color:#a6accd">        - containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Podåœ¨Nodeä¸Šçš„åˆ†å¸ƒ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod -o wide</span></span>
<span class="line"><span style="color:#a6accd">NAME                    READY     STATUS    RESTARTS   AGE       IP           NODE</span></span>
<span class="line"><span style="color:#a6accd">nginx-daemonset-hk28q   1/1       Running   0          1m        10.2.56.10   192.168.56.12</span></span>
<span class="line"><span style="color:#a6accd">nginx-daemonset-wtt68   1/1       Running   0          1m        10.2.53.10   192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get daemonset</span></span>
<span class="line"><span style="color:#a6accd">NAME              DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span></span>
<span class="line"><span style="color:#a6accd">nginx-daemonset   2         2         2         2            2           &lt;none&gt;          1m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_7-4-ç¬¬å››æ­¥ï¼šä½¿ç”¨serviceç®¡ç†podè®¿é—®" tabindex="-1">7.4 ç¬¬å››æ­¥ï¼šä½¿ç”¨Serviceç®¡ç†Podè®¿é—® <a aria-current="page" href="#_7-4-ç¬¬å››æ­¥ï¼šä½¿ç”¨serviceç®¡ç†podè®¿é—®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨ä¸Šé¢çš„å°èŠ‚ï¼Œæˆ‘ä»¬é€šè¿‡Deploymentå¯ä»¥ä¸ºä¸€ä¸ªåº”ç”¨åˆ›å»ºå¤šä¸ªPodï¼Œè€Œä¸”å¯ä»¥åŠ¨æ€çš„è¿›è¡Œå¢åŠ ã€æˆ–è€…åˆ é™¤å¤šä½™çš„Podï¼ŒKubernetes Pod æ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒä»¬å¯ä»¥è¢«åˆ›å»ºï¼Œä¹Ÿå¯ä»¥è¢«é”€æ¯ï¼Œä½†æ˜¯æ¯æ¬¡Podçš„IPåœ°å€å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¤–é¢å¦‚ä½•è®¿é—®åˆ°è¯¥Podå‘¢ï¼Ÿæ€»ä¸èƒ½æ¯æ¬¡Podé‡å¯å°±ä¿®æ”¹è®¿é—®çš„IPåœ°å€å§ã€‚ æ¯ä¸ª Pod éƒ½ä¼šè·å–å®ƒè‡ªå·±çš„ IP åœ°å€ï¼Œä½†æ˜¯æ¯æ¬¡å³ä½¿è¿™äº› IP åœ°å€ä¸æ€»æ˜¯ç¨³å®šå¯ä¾èµ–çš„ã€‚ è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œå¦‚æœä¸€ç»„ Podï¼ˆç§°ä¸º backendï¼‰ä¸ºå…¶å®ƒ Pod ï¼ˆç§°ä¸º frontendï¼‰æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆé‚£äº› frontend è¯¥å¦‚ä½•å‘ç°ï¼Œå¹¶è¿æ¥åˆ°è¿™ç»„ Pod ä¸­çš„å“ªäº› backend å‘¢ï¼Ÿ</p><h1 id="_9-1-serviceä»‹ç»å’Œç®¡ç†" tabindex="-1">9.1 Serviceä»‹ç»å’Œç®¡ç† <a aria-current="page" href="#_9-1-serviceä»‹ç»å’Œç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="åˆ›å»ºservice" tabindex="-1">åˆ›å»ºService <a aria-current="page" href="#åˆ›å»ºservice" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç»§ç»­æˆ‘ä»¬Nginxçš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¸ºä¹‹å‰çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªService</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat nginx-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">kind: Service</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-service</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  ports:</span></span>
<span class="line"><span style="color:#a6accd">  - protocol: TCP</span></span>
<span class="line"><span style="color:#a6accd">    port: 80</span></span>
<span class="line"><span style="color:#a6accd">    targetPort: 80</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>ç¬¬1è¡Œï¼šå®šä¹‰èµ„æºç±»å‹ä¸ºService</li><li>ç¬¬2è¡Œï¼šå®šä¹‰å½“å‰Service APIçš„ç‰ˆæœ¬</li><li>ç¬¬3è¡Œï¼šmetadataè®¾ç½®</li><li>ç¬¬4è¡Œï¼šè®¾ç½®Serviceçš„åç§°ä¸ºnginx-service</li><li>ç¬¬5è¡Œï¼šspec: å¼€å§‹è®¾ç½®Serviceçš„å†…å®¹</li><li>ç¬¬6è¡Œï¼šselector: ä¸ºè¯¥ServiceæŒ‡å®šä¸€ä¸ªåŒ¹é…çš„æ ‡ç­¾</li><li>ç¬¬7è¡Œï¼šapp: nginx æ‰€æœ‰å¸¦æœ‰æ ‡ç­¾app ï¼šnginxçš„Podå°†ä½¿ç”¨è¯¥Service</li><li>ç¬¬8è¡Œï¼šports: æŒ‡å®šServiceéœ€è¦å¯¹å¤–çš„ç«¯å£</li><li>ç¬¬9è¡Œï¼šè®¾ç½®ç«¯å£åè®®ï¼šæ”¯æŒTCPå’ŒUDP</li><li>ç¬¬10è¡Œï¼šè®¾ç½®Serviceçš„ç«¯å£</li><li>ç¬¬11è¡Œï¼šè®¾ç½®Podçš„ç«¯å£ï¼ŒKubernetesä¼šå°†å‘é€ç»™Serviceç«¯å£çš„è¿æ¥ï¼Œè½¬å‘åˆ°Podçš„ç«¯å£ä¸Šã€‚</li></ul><p>åˆ›å»ºNginx Service</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nginx-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">service "nginx-service" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Nginx Service</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd">NAME            TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span></span>
<span class="line"><span style="color:#a6accd">kubernetes      ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP   7h</span></span>
<span class="line"><span style="color:#a6accd">nginx-service   ClusterIP   10.1.184.53   &lt;none&gt;        80/TCP    25s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è®¿é—®Servce IP</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# curl --head 10.1.181.45</span></span>
<span class="line"><span style="color:#a6accd">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#a6accd">Server: nginx/1.11.10</span></span>
<span class="line"><span style="color:#a6accd">Date: Tue, 21 Feb 2017 08:20:42 GMT</span></span>
<span class="line"><span style="color:#a6accd">Content-Type: text/html</span></span>
<span class="line"><span style="color:#a6accd">Content-Length: 612</span></span>
<span class="line"><span style="color:#a6accd">Last-Modified: Tue, 14 Feb 2017 15:36:04 GMT</span></span>
<span class="line"><span style="color:#a6accd">Connection: keep-alive</span></span>
<span class="line"><span style="color:#a6accd">ETag: "58a323e4-264"</span></span>
<span class="line"><span style="color:#a6accd">Accept-Ranges: bytes</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_9-2-serviceå’Œendpoint" tabindex="-1">9.2 Serviceå’ŒEndpoint <a aria-current="page" href="#_9-2-serviceå’Œendpoint" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>Serviceä½œä¸ºKubernetesä¸­ä¸ºPodå®ç°è´Ÿè½½å‡è¡¡çš„ç»„ä»¶ï¼Œå‡ ä¹åœ¨æ‰€æœ‰çš„æ–‡ç« ä¸­ä¸ºäº†æ–¹ä¾¿åˆå­¦è€…ç†è§£ï¼ŒåŸºæœ¬ä¸Šè¯´çš„æ˜¯Serviceä¼šæ¥ç›‘å¬Podçš„å˜åŒ–ï¼Œç„¶åæ¥æ›´æ–°Podçš„IPåœ°å€ã€‚å…¶å®è¿™ä¸ªäº‹æƒ…ä¸æ˜¯Serviceå¹²çš„ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªå¹•åè‹±é›„ï¼šEndpoint Endpointsè¡¨ç¤ºäº†ä¸€ä¸ªServiceå¯¹åº”çš„æ‰€æœ‰Podå‰¯æœ¬çš„è®¿é—®åœ°å€ï¼Œè€ŒEndpoints Controllerè´Ÿè´£ç”Ÿæˆå’Œç»´æŠ¤æ‰€æœ‰Endpointså¯¹è±¡çš„æ§åˆ¶å™¨ã€‚å®ƒè´Ÿè´£ç›‘å¬Serviceå’Œå¯¹åº”çš„Podå‰¯æœ¬çš„å˜åŒ–ã€‚</p><ul><li>å¦‚æœç›‘æµ‹åˆ°Serviceè¢«åˆ é™¤ï¼Œåˆ™åˆ é™¤å’Œè¯¥ServiceåŒåçš„Endpointså¯¹è±¡ï¼›</li><li>å¦‚æœç›‘æµ‹åˆ°æ–°çš„Serviceè¢«åˆ›å»ºæˆ–ä¿®æ”¹ï¼Œåˆ™æ ¹æ®è¯¥Serviceä¿¡æ¯è·å¾—ç›¸å…³çš„Podåˆ—è¡¨ï¼Œç„¶ååˆ›å»ºæˆ–æ›´æ–°Serviceå¯¹åº”çš„Endpointså¯¹è±¡ã€‚</li><li>å¦‚æœç›‘æµ‹åˆ°Podçš„äº‹ä»¶ï¼Œåˆ™æ›´æ–°å®ƒå¯¹åº”çš„Serviceçš„Endpointså¯¹è±¡ã€‚</li></ul><p>kube-proxyè¿›ç¨‹è·å–æ¯ä¸ªServiceçš„Endpointsï¼Œå®ç°Serviceçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ªheadless-service" tabindex="-1">åˆ›å»ºä¸€ä¸ªHeadless Service <a aria-current="page" href="#åˆ›å»ºä¸€ä¸ªheadless-service" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç¼–å†™ä¸€ä¸ªServiceä¸ä½¿ç”¨clusterip</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat mysql-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">kind: Service</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: mysql-service</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  ports:</span></span>
<span class="line"><span style="color:#a6accd">  - protocol: TCP</span></span>
<span class="line"><span style="color:#a6accd">    port: 3306</span></span>
<span class="line"><span style="color:#a6accd">    targetPort: 3306</span></span>
<span class="line"><span style="color:#a6accd">  clusterIP: None</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f mysql-service.yaml </span></span>
<span class="line"><span style="color:#a6accd">service "mysql-service" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Serviceï¼Œå¯ä»¥æ”¾å¿ƒCLUSTER-IPä¸ºNone</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get service mysql-service</span></span>
<span class="line"><span style="color:#a6accd">NAME            TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span></span>
<span class="line"><span style="color:#a6accd">mysql-service   ClusterIP   None         &lt;none&gt;        3306/TCP   17s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.åˆ›å»ºä¸€ä¸ªEndpoint</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim mysql-endpoint.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Endpoints</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd"> name: mysql-service</span></span>
<span class="line"><span style="color:#a6accd">subsets:</span></span>
<span class="line"><span style="color:#a6accd">- addresses:</span></span>
<span class="line"><span style="color:#a6accd">  - ip: 192.168.56.13</span></span>
<span class="line"><span style="color:#a6accd">  ports:</span></span>
<span class="line"><span style="color:#a6accd">  - port: 3306</span></span>
<span class="line"><span style="color:#a6accd">    protocol: TCP</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f mysql-endpoint.yaml </span></span>
<span class="line"><span style="color:#a6accd">endpoints "mysql-service" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.æŸ¥çœ‹Serviceå’ŒEndpointçš„å…³è”</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get ep mysql-service</span></span>
<span class="line"><span style="color:#a6accd">NAME            ENDPOINTS            AGE</span></span>
<span class="line"><span style="color:#a6accd">mysql-service   192.168.56.13:3306   42s</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe svc mysql-service</span></span>
<span class="line"><span style="color:#a6accd">Name:              mysql-service</span></span>
<span class="line"><span style="color:#a6accd">Namespace:         default</span></span>
<span class="line"><span style="color:#a6accd">Labels:            &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Selector:          &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Type:              ClusterIP</span></span>
<span class="line"><span style="color:#a6accd">IP:                None</span></span>
<span class="line"><span style="color:#a6accd">Port:              &lt;unset&gt;  3306/TCP</span></span>
<span class="line"><span style="color:#a6accd">TargetPort:        3306/TCP</span></span>
<span class="line"><span style="color:#a6accd">Endpoints:         192.168.56.13:3306</span></span>
<span class="line"><span style="color:#a6accd">Session Affinity:  None</span></span>
<span class="line"><span style="color:#a6accd">Events:            &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_7-5-ç¬¬äº”æ­¥ï¼šä½¿ç”¨ingressæä¾›å¤–éƒ¨è®¿é—®" tabindex="-1">7.5 ç¬¬äº”æ­¥ï¼šä½¿ç”¨Ingressæä¾›å¤–éƒ¨è®¿é—® <a aria-current="page" href="#_7-5-ç¬¬äº”æ­¥ï¼šä½¿ç”¨ingressæä¾›å¤–éƒ¨è®¿é—®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>é€šè¿‡Serviceå¯ä»¥å°†Kubernetesé›†ç¾¤ä¸­çš„æœåŠ¡ä»¥IPï¼šPortçš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º4å±‚çš„è´Ÿè½½å‡è¡¡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯OSIä¸ƒå±‚æ¨¡å‹ä¸­ä¼ è¾“å±‚çš„åŠŸèƒ½ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®ç°ä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡å‘¢ï¼Œä¾‹å¦‚åƒNginxé‚£æ ·ï¼Œå¯ä»¥çµæ´»çš„è¿›è¡Œåå‘ä»£ç†çš„è®¾ç½®ï¼Œæ ¹æ®ä¸åŒçš„URLè¿›è¡Œè½¬å‘ç­‰ï¼Œéš¾é“æˆ‘éœ€è¦è‡ªå·±éƒ¨ç½²ä¸€ä¸ªNginxæ¥åšè¿™ä¸ªäº‹æƒ…å—ï¼Ÿé¦–å…ˆï¼Œå¦‚æœä½ æœ‰è¿™ä¸ªæƒ³æ³•ï¼Œå¹¶æ²¡æœ‰é”™ï¼Œç”šè‡³ä½ å®Œå…¨å¯ä»¥è‡ªå·±ç‹¬ç«‹éƒ¨ç½²ä¸€ä¸ªNginxæ¥å®Œæˆï¼Œä½†æ˜¯Kubernetesæä¾›äº†æ›´å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯Ingressã€‚ Ingresså°±æ˜¯ä»kubernetesé›†ç¾¤å¤–è®¿é—®é›†ç¾¤çš„å…¥å£ï¼Œå°†ç”¨æˆ·çš„URLè¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„serviceä¸Šã€‚ingressç›¸å½“äºnginxåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒåŒ…æ‹¬çš„è§„åˆ™å®šä¹‰å°±æ˜¯URLçš„è·¯ç”±ä¿¡æ¯ã€‚</p><h2 id="_10-1-ingress-controller" tabindex="-1">10.1 Ingress Controller <a aria-current="page" href="#_10-1-ingress-controller" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>åœ¨å­¦ä¹ Serviceçš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“æœ€ç»ˆçš„è´Ÿè½½å‡è¡¡ç”±kube-proxyå’ŒLVSæ¥å®Œæˆï¼Œé‚£ä¹ˆIngressé ä»€ä¹ˆæ¥å®ç°7å±‚çš„è·¯ç”±æœºåˆ¶å‘¢ï¼Ÿç­”æ¡ˆæ˜¯Ingress Controllerã€‚</p><p>Ingress Controller å®è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸ªç›‘è§†å™¨ï¼ŒIngress Controller é€šè¿‡ä¸æ–­åœ°è·Ÿ kubernetes API æ‰“äº¤é“ï¼Œå®æ—¶çš„æ„ŸçŸ¥åç«¯ serviceã€pod ç­‰å˜åŒ–ï¼Œæ¯”å¦‚æ–°å¢å’Œå‡å°‘ podï¼Œservice å¢åŠ ä¸å‡å°‘ç­‰ï¼›å½“å¾—åˆ°è¿™äº›å˜åŒ–ä¿¡æ¯åï¼ŒIngress Controller å†ç»“åˆä¸‹æ–‡çš„ Ingress ç”Ÿæˆé…ç½®ï¼Œç„¶åæ›´æ–°åå‘ä»£ç†è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶åˆ·æ–°å…¶é…ç½®ï¼Œè¾¾åˆ°æœåŠ¡å‘ç°çš„ä½œç”¨ã€‚</p><p>Ingress Controllerç›®å‰æœ‰ä¸¤å¤§å¼€æºé¡¹ç›®ï¼Œä¸€ä¸ªæ˜¯Nginx Controllerï¼Œä¸€ä¸ªæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„Traefikï¼ŒTraefikæ˜¯ä¸€æ¬¾å¼€æºçš„åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿä¸å¸¸è§çš„å¾®æœåŠ¡ç³»ç»Ÿç›´æ¥æ•´åˆï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠ¨æ€é…ç½®ã€‚ç›®å‰æ”¯æŒDocker, Swarm, Mesos/Marathon, Mesos, Kubernetes, Consul, Etcd, Zookeeper, BoltDB, Rest APIç­‰ç­‰åç«¯æ¨¡å‹ã€‚</p><h2 id="ingress-controller-traefik" tabindex="-1">Ingress Controller Traefik <a aria-current="page" href="#ingress-controller-traefik" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="éƒ¨ç½²treafik" tabindex="-1">éƒ¨ç½²Treafik <a aria-current="page" href="#éƒ¨ç½²treafik" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl label nodes 192.168.56.12 edgenode=true</span></span>
<span class="line"><span style="color:#a6accd">node "192.168.56.12" labeled</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f /srv/addons/ingress/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_11-ç¬¬å…­æ­¥ï¼šä½¿ç”¨pvå’Œpvcç®¡ç†æ•°æ®å­˜å‚¨" tabindex="-1">11 ç¬¬å…­æ­¥ï¼šä½¿ç”¨PVå’ŒPVCç®¡ç†æ•°æ®å­˜å‚¨ <a aria-current="page" href="#_11-ç¬¬å…­æ­¥ï¼šä½¿ç”¨pvå’Œpvcç®¡ç†æ•°æ®å­˜å‚¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>æˆªæ­¢ç›®å‰æˆ‘ä»¬æ‰€å¯åŠ¨Podçš„å®¹å™¨ä¸­çš„æ•°æ®å­˜å‚¨éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œå› æ­¤Podé‡å¯æˆ–è€…è¢«åˆ é™¤çš„æ—¶å€™ï¼Œäº§ç”Ÿåœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¼šå‘ç”Ÿä¸¢å¤±ã€‚å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æœ‰äº›åº”ç”¨æ˜¯æ— çŠ¶æ€ï¼Œæœ‰äº›åº”ç”¨åˆ™éœ€è¦ä¿æŒçŠ¶æ€æ•°æ®ï¼Œç¡®ä¿Podé‡å¯ä¹‹åèƒ½å¤Ÿè¯»å–åˆ°ä¹‹å‰çš„çŠ¶æ€æ•°æ®ï¼Œæœ‰äº›åº”ç”¨åˆ™ä½œä¸ºé›†ç¾¤æä¾›æœåŠ¡ã€‚è¿™ä¸‰ç§æœåŠ¡å½’çº³ä¸ºæ— çŠ¶æ€æœåŠ¡ã€æœ‰çŠ¶æ€æœåŠ¡ä»¥åŠæœ‰çŠ¶æ€çš„é›†ç¾¤æœåŠ¡ï¼Œå…¶ä¸­åé¢ä¸¤ä¸ªå­˜åœ¨æ•°æ®ä¿å­˜ä¸å…±äº«çš„éœ€æ±‚ï¼Œå› æ­¤å°±è¦é‡‡ç”¨å®¹å™¨å¤–çš„å­˜å‚¨æ–¹æ¡ˆã€‚ Kubernetesä¸­å­˜å‚¨ä¸­æœ‰å››ä¸ªé‡è¦çš„æ¦‚å¿µï¼šVolumeã€PersistentVolumeï¼ˆPVï¼‰ã€PersistentVolumeClaim ï¼ˆPVCï¼‰ã€StorageClassã€‚æŒæ¡äº†è¿™å››ä¸ªæ¦‚å¿µï¼Œå°±æŒæ¡äº†Kubernetesä¸­å­˜å‚¨ç³»ç»Ÿçš„æ ¸å¿ƒã€‚</p><h1 id="_11-1-kubernetes-volume" tabindex="-1">11.1 Kubernetes Volume <a aria-current="page" href="#_11-1-kubernetes-volume" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_11-2-persistentvolumeï¼ˆpvï¼‰" tabindex="-1">11.2 PersistentVolumeï¼ˆPVï¼‰ <a aria-current="page" href="#_11-2-persistentvolumeï¼ˆpvï¼‰" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>PersistentVolumeï¼ˆPVï¼‰æ˜¯ç”±ç®¡ç†å‘˜è®¾ç½®çš„å­˜å‚¨ï¼Œå®ƒæ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ã€‚å°±åƒèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„èµ„æºä¸€æ ·ï¼ŒPV ä¹Ÿæ˜¯é›†ç¾¤ä¸­çš„èµ„æºã€‚ PV æ˜¯ Volume ä¹‹ç±»çš„å·æ’ä»¶ï¼Œä½†å…·æœ‰ç‹¬ç«‹äºä½¿ç”¨ PV çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚æ­¤ API å¯¹è±¡åŒ…å«å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œå³ NFSã€iSCSI æˆ–ç‰¹å®šäºäº‘ä¾›åº”å•†çš„å­˜å‚¨ç³»ç»Ÿã€‚</p><p><strong>1.å®‰è£…å¹¶é…ç½®NFS</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y nfs-utils rpcbind</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir -p /data/k8s-nfs</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/exports</span></span>
<span class="line"><span style="color:#a6accd">/data/k8s-nfs *(rw,sync,no_root_squash)</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯åŠ¨NFS</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable rpcbind nfs</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start rpcbind nfs</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.åˆ›å»ºå¹¶æŸ¥çœ‹PV</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nfs-pv.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: PersistentVolume</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: pv-demo</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  capacity:</span></span>
<span class="line"><span style="color:#a6accd">storage: 1Gi</span></span>
<span class="line"><span style="color:#a6accd">  volumeMode: Filesystem</span></span>
<span class="line"><span style="color:#a6accd">  accessModes:</span></span>
<span class="line"><span style="color:#a6accd">    - ReadWriteOnce</span></span>
<span class="line"><span style="color:#a6accd">  persistentVolumeReclaimPolicy: Recycle</span></span>
<span class="line"><span style="color:#a6accd">  storageClassName: nfs</span></span>
<span class="line"><span style="color:#a6accd">  nfs:</span></span>
<span class="line"><span style="color:#a6accd">    path: /data/k8s-nfs/pv-demo</span></span>
<span class="line"><span style="color:#a6accd">    server: 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nfs-pv.yaml </span></span>
<span class="line"><span style="color:#a6accd">persistentvolume "pv-demo" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹åˆ›å»ºçš„PV</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pv</span></span>
<span class="line"><span style="color:#a6accd">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM     STORAGECLASS   REASON    AGE</span></span>
<span class="line"><span style="color:#a6accd">pv-demo   1Gi        RWO            Recycle          Available             nfs                      15s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_11-3-persistentvolumeclaimï¼ˆpvcï¼‰" tabindex="-1">11.3 PersistentVolumeClaimï¼ˆPVCï¼‰ <a aria-current="page" href="#_11-3-persistentvolumeclaimï¼ˆpvcï¼‰" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>PersistentVolumeClaimï¼ˆPVCï¼‰æ˜¯ç”¨æˆ·å­˜å‚¨çš„è¯·æ±‚ã€‚å®ƒä¸ Pod ç›¸ä¼¼ã€‚Pod æ¶ˆè€—èŠ‚ç‚¹èµ„æºï¼ŒPVC æ¶ˆè€— PV èµ„æºã€‚Pod å¯ä»¥è¯·æ±‚ç‰¹å®šçº§åˆ«çš„èµ„æºï¼ˆCPU å’Œå†…å­˜ï¼‰ã€‚å£°æ˜å¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥ä»¥è¯»/å†™ä¸€æ¬¡æˆ– åªè¯»å¤šæ¬¡æ¨¡å¼æŒ‚è½½ï¼‰ã€‚</p><p>1.åˆ›å»ºPVC</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nfs-pvc.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  accessModes:</span></span>
<span class="line"><span style="color:#a6accd">    - ReadWriteOnce</span></span>
<span class="line"><span style="color:#a6accd">  resources:</span></span>
<span class="line"><span style="color:#a6accd">    requests:</span></span>
<span class="line"><span style="color:#a6accd">      storage: 1Gi</span></span>
<span class="line"><span style="color:#a6accd">  storageClassName: nfs</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ›å»ºå¹¶æŸ¥çœ‹PVC</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl create -f nfs-pvc.yaml </span></span>
<span class="line"><span style="color:#a6accd">persistentvolumeclaim "pvc-demo" created</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pvc</span></span>
<span class="line"><span style="color:#a6accd">NAME       STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span style="color:#a6accd">pvc-demo   Bound     pv-demo   1Gi        RWO            nfs            6s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.ä½¿ç”¨PVC</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim nginx-deployment-pvc.yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Deployment</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-deployment</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  replicas: 3</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    matchLabels:</span></span>
<span class="line"><span style="color:#a6accd">      app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  template:</span></span>
<span class="line"><span style="color:#a6accd">    metadata:</span></span>
<span class="line"><span style="color:#a6accd">      labels:</span></span>
<span class="line"><span style="color:#a6accd">        app: nginx</span></span>
<span class="line"><span style="color:#a6accd">    spec:</span></span>
<span class="line"><span style="color:#a6accd">      containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">        image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">        ports:</span></span>
<span class="line"><span style="color:#a6accd">        - containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd">        volumeMounts:</span></span>
<span class="line"><span style="color:#a6accd">        - mountPath: "/usr/share/nginx/html"</span></span>
<span class="line"><span style="color:#a6accd">          name: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd">      volumes:</span></span>
<span class="line"><span style="color:#a6accd">      - name: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd">        persistentVolumeClaim:</span></span>
<span class="line"><span style="color:#a6accd">          claimName: pvc-demo</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_11-4-storageclass" tabindex="-1">11.4 StorageClass <a aria-current="page" href="#_11-4-storageclass" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_7-ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨rancherç®¡ç†kubernetesé›†ç¾¤" tabindex="-1">7 ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨Rancherç®¡ç†Kubernetesé›†ç¾¤ <a aria-current="page" href="#_7-ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨rancherç®¡ç†kubernetesé›†ç¾¤" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>ç°åœ¨æˆ‘ä»¬å·²ç»å…·å¤‡æŠŠåº”ç”¨è¿ç§»åˆ°Kubernetesä¸­æ¥çš„èƒ½åŠ›ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œè¿ç§»åï¼Œæ—¥å¸¸çš„è¿ç»´å·¥ä½œå°±å‘ç”Ÿçš„å˜åŒ–ï¼Œæˆªæ­¢ç›®å‰ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨å®˜æ–¹è‡ªå¸¦çš„Dashbaordæ¥å®Œæˆæ—¥å¸¸çš„è¿ç»´å·¥ä½œï¼Œè€Œæ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„è¿ç»´å·¥å…·Rancherã€‚</p><h2 id="_7-1-rancherå¿«é€Ÿå…¥é—¨" tabindex="-1">7.1 Rancherå¿«é€Ÿå…¥é—¨ <a aria-current="page" href="#_7-1-rancherå¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>å¿«é€Ÿéƒ¨ç½²å•æœºç‰ˆRancher</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# mkdir /opt/rancher</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker run -d --restart=unless-stopped -v /opt/rancher:/var/lib/rancher/ -p 80:80 -p 443:443 rancher/rancher</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="_7-2-ä½¿ç”¨rancherè¿›è¡Œæ—¥å¸¸ç®¡ç†" tabindex="-1">7.2 ä½¿ç”¨Rancherè¿›è¡Œæ—¥å¸¸ç®¡ç† <a aria-current="page" href="#_7-2-ä½¿ç”¨rancherè¿›è¡Œæ—¥å¸¸ç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h2 id="_7-3-rancherç”Ÿäº§é›†ç¾¤éƒ¨ç½²" tabindex="-1">7.3 Rancherç”Ÿäº§é›†ç¾¤éƒ¨ç½² <a aria-current="page" href="#_7-3-rancherç”Ÿäº§é›†ç¾¤éƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h1 id="ç¬¬å…­éƒ¨åˆ†-ç®¡ç†kubernetesä¸­çš„åº”ç”¨" tabindex="-1">ç¬¬å…­éƒ¨åˆ† ç®¡ç†Kubernetesä¸­çš„åº”ç”¨ <a aria-current="page" href="#ç¬¬å…­éƒ¨åˆ†-ç®¡ç†kubernetesä¸­çš„åº”ç”¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_13-åº”ç”¨çš„èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥" tabindex="-1">13 åº”ç”¨çš„èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥ <a aria-current="page" href="#_13-åº”ç”¨çš„èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_13-1-åº”ç”¨çš„èµ„æºé™åˆ¶" tabindex="-1">13.1 åº”ç”¨çš„èµ„æºé™åˆ¶ <a aria-current="page" href="#_13-1-åº”ç”¨çš„èµ„æºé™åˆ¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="_13-2-åº”ç”¨çš„å¥åº·æ£€æŸ¥" tabindex="-1">13.2 åº”ç”¨çš„å¥åº·æ£€æŸ¥ <a aria-current="page" href="#_13-2-åº”ç”¨çš„å¥åº·æ£€æŸ¥" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="livenessæ¢æµ‹" tabindex="-1">Livenessæ¢æµ‹ <a aria-current="page" href="#livenessæ¢æµ‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Kubernetesæœ‰ä¸¤ç§æ¢æµ‹æœºåˆ¶ï¼ŒLivenesså’ŒReadinessï¼Œé…ç½®éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œåªæ˜¯å®ç°çš„åŠŸèƒ½ä¸åŒã€‚ Livenessæ¢æµ‹æ˜¯é’ˆå¯¹Podå¥åº·çŠ¶æ€çš„æ¢æµ‹ï¼Œç±»ä¼¼äºé›†ç¾¤ä¸­çš„å¥åº·æ£€æŸ¥ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªå¥åº·æ£€æŸ¥çš„æ¡ä»¶ï¼Œå¦‚æœæ¢æµ‹å¤±è´¥ï¼ŒKuberneteså°†ä¼šé‡å¯å®¹å™¨ã€‚ å¦‚æœæ‚¨å¸Œæœ›å®¹å™¨åœ¨æ¢æµ‹å¤±è´¥æ—¶è¢«æ€æ­»å¹¶é‡æ–°å¯åŠ¨ï¼Œé‚£ä¹ˆè¯·æŒ‡å®šä¸€ä¸ªLivenessé…ç½®ï¼Œå¹¶æŒ‡å®šrestartPolicy ä¸º Always æˆ– OnFailureã€‚ é…ç½®æ¡ˆä¾‹</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">livenessProbe:</span></span>
<span class="line"><span style="color:#a6accd">exec:</span></span>
<span class="line"><span style="color:#a6accd">    command:</span></span>
<span class="line"><span style="color:#a6accd">    - ps aux | grep nginx</span></span>
<span class="line"><span style="color:#a6accd">initialDelaySeconds: 10</span></span>
<span class="line"><span style="color:#a6accd">periodSeconds: 5</span></span>
<span class="line"><span style="color:#a6accd">timeoutSeconds: 3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="readinessæ¢æµ‹" tabindex="-1">Readinessæ¢æµ‹ <a aria-current="page" href="#readinessæ¢æµ‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Readinessæ¢æµ‹æ˜¯æ¢æµ‹Podæ˜¯å¦å‡†å¤‡å¥½å¯¹å¤–æä¾›è®¿é—®ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨Podé‡Œé¢è¿è¡Œä¸€ä¸ªTomcatçš„å®¹å™¨ï¼Œé‡Œé¢è¿è¡Œäº†ä¸€ä¸ªJenkinsçš„åº”ç”¨ï¼Œé‚£ä¹ˆç­‰Jenkinså®Œå…¨å¯åŠ¨èƒ½æä¾›æœåŠ¡å¯èƒ½éœ€è¦1åˆ†é’Ÿï¼Œæ‰€ä»¥åœ¨åœ¨1åˆ†é’Ÿä¹‹å‰æ˜¯ä¸èƒ½æä¾›ç»™ç”¨æˆ·è®¿é—®çš„ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½åŠ å…¥Serviceçš„è´Ÿè½½å‡è¡¡ä¸­ï¼Œè¿™ä¸ªå°±é Readinessæ¢æµ‹æ¥æ§åˆ¶ã€‚ Readinessç”¨æ¥æ§åˆ¶å‘Šè¯‰Kubernetesä»€ä¹ˆæ—¶é—´å¯ä»¥å°†å®¹å™¨åŠ å…¥åˆ°Serviceçš„è´Ÿè½½å‡è¡¡ä¸­ï¼Œé…ç½®æ–¹æ³•å’ŒLivenessä¸€æ ·ï¼Œåªéœ€è¦ä¿®æ”¹livennessProbeæ›¿æ¢ä¸ºreadinessProbeå³å¯ã€‚</p><h2 id="å¥åº·æ£€æŸ¥çš„æ–¹æ³•" tabindex="-1">å¥åº·æ£€æŸ¥çš„æ–¹æ³• <a aria-current="page" href="#å¥åº·æ£€æŸ¥çš„æ–¹æ³•" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Kubernetesçš„å¥åº·æ£€æŸ¥æ˜¯ç”±è¿è¡Œåœ¨å„ä¸ªNodeä¸Šçš„kubeletæ¥å®Œæˆçš„ï¼Œkubeletç›®å‰æ”¯æŒä»¥ä¸‹ä¸‰ç§å¥åº·æ£€æŸ¥çš„æ–¹æ³•ï¼š</p><ul><li>ExecActionï¼šåœ¨å®¹å™¨ä¸­æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶çŠ¶æ€ç ä¸º0ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚</li><li>TCPSocketAction:å¯¹æŒ‡å®šç«¯å£ä¸Šå®¹å™¨çš„IPåœ°å€æ‰§è¡ŒTCPæ£€æŸ¥ã€‚å¦‚æœç«¯å£æ˜¯æ‰“å¼€çš„ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æ˜¯æˆåŠŸçš„ã€‚</li><li>HTTPGetAction:å¯¹æŒ‡å®šç«¯å£å’Œè·¯å¾„ä¸Šå®¹å™¨çš„IPåœ°å€æ‰§è¡ŒHTTP Getè¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºæˆ–ç­‰äº200ï¼Œå°äº400ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æ˜¯æˆåŠŸçš„ã€‚</li></ul><p>ä»¥ä¸Šä¸‰ç§å¥åº·æ£€æŸ¥çš„æ–¹æ³•ä¼šæœ‰ä¸‰ç§è¿”å›ç»“æœï¼š</p><ul><li><p>Successï¼šæˆåŠŸï¼Œå®¹å™¨é€šè¿‡è¯Šæ–­ã€‚</p></li><li><p>Failureï¼šå¤±è´¥ï¼Œå®¹å™¨è¯Šæ–­å¤±è´¥ã€‚</p></li><li><p>Unknownï¼šæ¢æµ‹å¤±è´¥ï¼Œæ— æ³•æ‰§è¡Œæ¢æµ‹ï¼Œæ‰€ä»¥ä¸åº”è¯¥é‡‡å–ä»»ä½•è¡ŒåŠ¨ã€‚</p><p>é’ˆå¯¹äºæ¢é’ˆæœ‰ä»¥ä¸‹é…ç½®å‚æ•°ï¼Œéœ€è¦æ³¨æ„ä¸ç®¡æ˜¯Livenessè¿˜æ˜¯Readinessæ¢æµ‹ï¼Œæ¢é’ˆçš„ä½¿ç”¨éƒ½æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯æ¢æµ‹å®Œæ¯•åï¼Œæ‰§è¡Œæ“ä½œçš„ä¸åŒã€‚</p></li><li><p>initialDelaySeconds: æ¢æµ‹çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨å®¹å™¨å¯åŠ¨å¤šå°‘ç§’ä¹‹åå¼€å§‹è¿›è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹ï¼Œä¾‹å¦‚ä½ å¯åŠ¨ä¸€ä¸ªJavaçš„åº”ç”¨éœ€è¦50ç§’ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±éœ€è¦å¤§äº50sã€‚æ‰€ä»¥è¿™ä¸ªå€¼æ˜¯éœ€è¦æ ¹æ®åº”ç”¨çš„å…·ä½“æƒ…å†µæ¥è®¾ç½®ã€‚</p></li><li><p>periodSecondsï¼šæ¢æµ‹æ‰§è¡Œçš„å‘¨æœŸæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚æ˜¯æŒ‡æ¯éš”å¤šé•¿æ—¶é—´æ‰§è¡Œä¸€æ¬¡æ¢æµ‹ï¼Œé¢‘ç‡è¶Šé«˜ï¼Œå‘ç°æ•…éšœçš„æ—¶é—´ä¹Ÿå°±è¶ŠçŸ­ï¼Œå¹¶ä¸æ˜¯è¶ŠçŸ­è¶Šå¥½ã€‚å¦‚æœåº”ç”¨æœåŠ¡ä¸å¤Ÿç¨³å®šï¼Œå¤ªé«˜çš„é¢‘ç‡åè€Œä¼šå¯¼è‡´å¾ˆå¤šä½ è®¤ä¸ºçš„â€œè¯¯æŠ¥â€ã€‚é»˜è®¤æ˜¯10ç§’ï¼Œæœ€å°å€¼æ˜¯1ç§’ã€‚</p></li><li><p>timeoutSeconds: æ¢æµ‹è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œæ‰§è¡Œæ¢æµ‹å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´æ²¡æœ‰è¿”å›ç»“æœï¼Œå˜æ„å‘³ç€æ¢æµ‹çš„ç»“æœæ˜¯å¤±è´¥ã€‚é»˜è®¤ä¸º1ç§’ã€‚æœ€å°å€¼æ˜¯1ç§’ã€‚</p></li><li><p>failureThresholdï¼šæ¢æµ‹æˆåŠŸåï¼Œæœ€å°‘è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚è¿™ä¸ªæ˜¯Kuberneteså°†åœ¨æ”¾å¼ƒä¹‹å‰å°è¯•å¤±è´¥é˜ˆå€¼æ—¶é—´ã€‚æ”¾å¼ƒç”Ÿå‘½æ¢æµ‹æ„å‘³ç€é‡æ–°å¯åŠ¨Podã€‚ä¸€æ—¦å‡†å¤‡å°±ç»ªï¼ŒPodå°†è¢«æ ‡è®°ä¸ºæœªå‡†å¤‡å°±ç»ªã€‚é»˜è®¤ä¸º3ã€‚æœ€å°å€¼æ˜¯1ã€‚</p></li><li><p>successThreshold: åœ¨æ¢æµ‹å¤±è´¥åï¼Œæœ€å°‘è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤ä¸º1ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»æ¢æµ‹æˆåŠŸ1æ¬¡ï¼Œæ‰èƒ½è®¤ä¸ºçŠ¶æ€æ¢å¤ï¼Œæœ€å°å€¼æ˜¯1ã€‚</p><h1 id="ç®¡ç†åº”ç”¨çš„dnsè®¿é—®" tabindex="-1">ç®¡ç†åº”ç”¨çš„DNSè®¿é—® <a aria-current="page" href="#ç®¡ç†åº”ç”¨çš„dnsè®¿é—®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1></li></ul><h1 id="_14-1-kubernetesä¸­çš„dns" tabindex="-1"><a href="http://k8s.unixhot.com/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->14.1 Kubernetesä¸­çš„DNS<!--]--></a> <a aria-current="page" href="#_14-1-kubernetesä¸­çš„dns" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="åº”ç”¨çš„dnsç®¡ç†" tabindex="-1">åº”ç”¨çš„DNSç®¡ç† <a aria-current="page" href="#åº”ç”¨çš„dnsç®¡ç†" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="podçš„åŸŸåè§£æç­–ç•¥" tabindex="-1">Podçš„åŸŸåè§£æç­–ç•¥ <a aria-current="page" href="#podçš„åŸŸåè§£æç­–ç•¥" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl run dns-test --generator=run-pod/v1 --image=alpine --replicas=1 sleep 360000</span></span>
<span class="line"><span style="color:#a6accd">pod/dns-test created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹Pod</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod dns-test</span></span>
<span class="line"><span style="color:#a6accd">NAME       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">dns-test   1/1     Running   0          79s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Podé»˜è®¤çš„DNSé…ç½®</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl exec -it dns-test /bin/sh</span></span>
<span class="line"><span style="color:#a6accd">/ # cat /etc/resolv.conf </span></span>
<span class="line"><span style="color:#a6accd">nameserver 10.1.0.10</span></span>
<span class="line"><span style="color:#a6accd">search default.svc.cluster.local svc.cluster.local cluster.local</span></span>
<span class="line"><span style="color:#a6accd">options ndots:5</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚ä½•è®¿é—®Serviceåç§°</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/ # ping -c 3 wordpress-service.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#a6accd">PING wordpress-service.default.svc.cluster.local (10.1.92.244): 56 data bytes</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 10.1.92.244: seq=0 ttl=64 time=0.074 ms</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 10.1.92.244: seq=1 ttl=64 time=0.141 ms</span></span>
<span class="line"><span style="color:#a6accd">64 bytes from 10.1.92.244: seq=2 ttl=64 time=0.187 ms</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">--- wordpress-service.default.svc.cluster.local ping statistics ---</span></span>
<span class="line"><span style="color:#a6accd">3 packets transmitted, 3 packets received, 0% packet loss</span></span>
<span class="line"><span style="color:#a6accd">round-trip min/avg/max = 0.074/0.134/0.187 ms</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>DNSæŸ¥è¯¢ç­–ç•¥</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod dns-test -o yaml | grep dnsPolicy</span></span>
<span class="line"><span style="color:#a6accd">  dnsPolicy: ClusterFirst</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li>Default: Podä»å…¶è¿è¡Œçš„èŠ‚ç‚¹ä¸­ç»§æ‰¿åç§°è§£æé…ç½®ã€‚</li><li>ClusterFirst:ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰ä¸é…ç½®çš„ç¾¤é›†åŸŸååç¼€ä¸åŒ¹é…çš„ä»»ä½•DNSæŸ¥è¯¢éƒ½å°†è½¬å‘åˆ°ä»èŠ‚ç‚¹ç»§æ‰¿çš„ä¸Šæ¸¸åç§°æœåŠ¡å™¨ã€‚</li><li>ClusterFirstWithHostNet: å¦‚æœPodä½¿ç”¨äº†hostNetworkï¼ˆä¾‹å¦‚Ingress Controller Treafikå°±æ˜¯ä½¿ç”¨äº†hostNetwokï¼‰ï¼Œåº”æ˜¾å¼è®¾ç½®å…¶DNSç­–ç•¥ä¸ºâ€œClusterFirstWithHostNetâ€ã€‚</li><li>None: å®ƒå…è®¸Podå¿½ç•¥Kubernetesç¯å¢ƒä¸­çš„DNSè®¾ç½®ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨Pod Specä¸­çš„dnsConfigå­—æ®µæä¾›çš„DNSè®¾ç½®ã€‚</li></ul><h2 id="åº”ç”¨çš„dnsç®¡ç†-1" tabindex="-1">åº”ç”¨çš„DNSç®¡ç† <a aria-current="page" href="#åº”ç”¨çš„dnsç®¡ç†-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h2 id="_15-1-ä½¿ç”¨configmapç®¡ç†åº”ç”¨é…ç½®" tabindex="-1">15.1 ä½¿ç”¨ConfigMapç®¡ç†åº”ç”¨é…ç½® <a aria-current="page" href="#_15-1-ä½¿ç”¨configmapç®¡ç†åº”ç”¨é…ç½®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="é€šè¿‡kubectlå‘½ä»¤åˆ›å»ºconfigmap" tabindex="-1">é€šè¿‡kubectlå‘½ä»¤åˆ›å»ºConfigMap <a aria-current="page" href="#é€šè¿‡kubectlå‘½ä»¤åˆ›å»ºconfigmap" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>åˆ›å»ºä¸€ä¸ªåç§°ä¸ºcmd-configçš„ConfigMap</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap cmd-config --from-literal=host=www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">configmap/cmd-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹ConfigMap</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap</span></span>
<span class="line"><span style="color:#a6accd">NAME         DATA   AGE</span></span>
<span class="line"><span style="color:#a6accd">cmd-config   1      63s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹ConfigMapå†…å®¹</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe configmap cmd-config</span></span>
<span class="line"><span style="color:#a6accd">Name:         cmd-config</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Labels:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Data</span></span>
<span class="line"><span style="color:#a6accd">====</span></span>
<span class="line"><span style="color:#a6accd">host:</span></span>
<span class="line"><span style="color:#a6accd">----</span></span>
<span class="line"><span style="color:#a6accd">www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">Events:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>ConfigMapä¸­åŒ…å«å¤šä¸ªé”®å€¼å¯¹</strong> å¯ä»¥å¤šæ¬¡ä½¿ç”¨--from-literalä¸ºä¸€ä¸ªConfigMapåˆ›å»ºå¤šä¸ªé”®å€¼å¯¹ï¼Œä¸­é—´ç”¨ç©ºæ ¼åˆ†éš”</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap mcmd-config --from-literal=host=www.unixhot.com --from-literal=port=443 --from-literal=ssl=on</span></span>
<span class="line"><span style="color:#a6accd">configmap/mcmd-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="é€šè¿‡yamlæ–‡ä»¶åˆ›å»ºconfigmap" tabindex="-1">é€šè¿‡YAMLæ–‡ä»¶åˆ›å»ºConfigMap <a aria-current="page" href="#é€šè¿‡yamlæ–‡ä»¶åˆ›å»ºconfigmap" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>æŸ¥çœ‹å·²åˆ›å»ºçš„ConfigMapç”Ÿæˆçš„YAMLæ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap mcmd-config -o yaml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">data:</span></span>
<span class="line"><span style="color:#a6accd">  host: www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">  port: "443"</span></span>
<span class="line"><span style="color:#a6accd">  ssl: "on"</span></span>
<span class="line"><span style="color:#a6accd">kind: ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  creationTimestamp: "2019-11-05T01:45:13Z"</span></span>
<span class="line"><span style="color:#a6accd">  name: mcmd-config</span></span>
<span class="line"><span style="color:#a6accd">  namespace: default</span></span>
<span class="line"><span style="color:#a6accd">  resourceVersion: "5394993"</span></span>
<span class="line"><span style="color:#a6accd">  selfLink: /api/v1/namespaces/default/configmaps/mcmd-config</span></span>
<span class="line"><span style="color:#a6accd">  uid: 02012d69-e324-4e9d-ba04-7132e9f6ecd8</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åªéœ€è¦å°†metadataä¸­æ— éœ€æŒ‡å®šçš„å­—æ®µå»æ‰å³å¯ç”Ÿæˆä¸€ä¸ªYAMLæ–‡ä»¶ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap mcmd-config -o yaml &gt; mcmd-config-v2.yaml</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# vim mcmd-config-v2.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">data:</span></span>
<span class="line"><span style="color:#a6accd">  host: www.unixhot.com</span></span>
<span class="line"><span style="color:#a6accd">  port: "443"</span></span>
<span class="line"><span style="color:#a6accd">  ssl: "on"</span></span>
<span class="line"><span style="color:#a6accd">kind: ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: mcmd-config-v2</span></span>
<span class="line"><span style="color:#a6accd">  namespace: default</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><a href="http://xn--metadata-0n3mp82lcujlhxj58f8qvb.name" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->æ³¨æ„éœ€è¦ä¿®æ”¹metadata.name<!--]--></a>,ä¿®æ”¹å®Œæ¯•åç›´æ¥åˆ›å»ºå³å¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create -f mcmd-config-v2.yaml </span></span>
<span class="line"><span style="color:#a6accd">configmap/mcmd-config-v2 created</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get configmap</span></span>
<span class="line"><span style="color:#a6accd">NAME             DATA   AGE</span></span>
<span class="line"><span style="color:#a6accd">cmd-config       1      24m</span></span>
<span class="line"><span style="color:#a6accd">mcmd-config      3      16m</span></span>
<span class="line"><span style="color:#a6accd">mcmd-config-v2   3      9s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="é€šè¿‡æ–‡ä»¶åˆ›å»ºconfigmap" tabindex="-1">é€šè¿‡æ–‡ä»¶åˆ›å»ºConfigMap <a aria-current="page" href="#é€šè¿‡æ–‡ä»¶åˆ›å»ºconfigmap" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ConfigMapé™¤äº†å¯ä»¥å­˜å‚¨å•ä¸ªæˆ–è€…å¤šä¸ªé”®å€¼å¯¹ä¹‹å¤–ï¼Œå¯ä»¥å­˜å‚¨å®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼Œå°†å•ä¸ªé…ç½®æ–‡ä»¶ç›´æ¥è½¬æ¢ä¸ºConfigMapåœ¨ç”Ÿäº§ä¸­ååˆ†å¸¸ç”¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap file-config --from-file=/etc/hosts</span></span>
<span class="line"><span style="color:#a6accd">configmap/file-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ConfigMapç›´æ¥å­˜å‚¨äº†æ–‡ä»¶çš„å†…å®¹ï¼ŒKeyåç§°ä¸ºæ–‡ä»¶åhostsï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šKeyçš„åç§°ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe configmap file-config</span></span>
<span class="line"><span style="color:#a6accd">Name:         file-config</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Labels:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Data</span></span>
<span class="line"><span style="color:#a6accd">====</span></span>
<span class="line"><span style="color:#a6accd">hosts:</span></span>
<span class="line"><span style="color:#a6accd">----</span></span>
<span class="line"><span style="color:#a6accd">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#a6accd">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.27 k8s-master1 k8s-master1.dianjoy.com </span></span>
<span class="line"><span style="color:#a6accd">192.168.99.28 k8s-master2 k8s-master2.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.29 k8s-master3 k8s-master3.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Events:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å°†Keyæ‰‹åŠ¨æŒ‡å®šä¸ºhost-hosts</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap file-config-v2 --from-file=host-hosts=/etc/hosts</span></span>
<span class="line"><span style="color:#a6accd">configmap/file-config-v2 created</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe configmap file-config-v2</span></span>
<span class="line"><span style="color:#a6accd">Name:         file-config-v2</span></span>
<span class="line"><span style="color:#a6accd">Namespace:    default</span></span>
<span class="line"><span style="color:#a6accd">Labels:       &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">Annotations:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Data</span></span>
<span class="line"><span style="color:#a6accd">====</span></span>
<span class="line"><span style="color:#a6accd">host-hosts:</span></span>
<span class="line"><span style="color:#a6accd">----</span></span>
<span class="line"><span style="color:#a6accd">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#a6accd">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.27 k8s-master1 k8s-master1.dianjoy.com </span></span>
<span class="line"><span style="color:#a6accd">192.168.99.28 k8s-master2 k8s-master2.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd">192.168.99.29 k8s-master3 k8s-master3.dianjoy.com</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Events:  &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ä»ç›®å½•åˆ›å»ºconfigmap" tabindex="-1">ä»ç›®å½•åˆ›å»ºConfigMap <a aria-current="page" href="#ä»ç›®å½•åˆ›å»ºconfigmap" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ConfigMapè¿˜æ”¯æŒé€šè¿‡ç›®å½•åˆ›å»ºï¼Œkubectlä¼šä¸ºç›®å½•ä¸­çš„æ¯ä¸ªæ–‡ä»¶å•ç‹¬åˆ›å»ºæ¡ç›®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœç›®å½•ä¸‹é¢åŒ…å«å­ç›®å½•ï¼Œä¼šå¿½ç•¥è¿™äº›å­ç›®å½•å’Œå­ç›®å½•é‡Œé¢çš„å†…å®¹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap dir-config --from-file=/etc/kubernetes</span></span>
<span class="line"><span style="color:#a6accd">configmap/dir-config created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="æ··åˆé€‰é¡¹åˆ›å»ºconfigmap" tabindex="-1">æ··åˆé€‰é¡¹åˆ›å»ºConfigMap <a aria-current="page" href="#æ··åˆé€‰é¡¹åˆ›å»ºconfigmap" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åŒæ—¶ä½¿ç”¨å‘½ä»¤è¡Œã€æ–‡ä»¶ã€ç›®å½•åˆ›å»ºConfigMapä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œåªéœ€è¦ä½¿ç”¨ä¸åŒçš„é€‰é¡¹å³å¯ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl create configmap mycp --from-literal=env=test \</span></span>
<span class="line"><span style="color:#a6accd"> --from-file=/etc/hosts \</span></span>
<span class="line"><span style="color:#a6accd"> --from-file=myhosts=/etc/hosts \</span></span>
<span class="line"><span style="color:#a6accd"> --from-file=/etc/kubernetes</span></span>
<span class="line"><span style="color:#a6accd">configmap/mycp created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ConfigMapçš„å†…å®¹å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡çš„å½¢æˆä¼ é€’ç»™å®¹å™¨ï¼Œä¹Ÿå¯é€šè¿‡å’ŒVolumeçš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚</p><h3 id="é€šè¿‡ç¯å¢ƒå˜é‡ç»™å®¹å™¨ä¼ é€’configmap" tabindex="-1">é€šè¿‡ç¯å¢ƒå˜é‡ç»™å®¹å™¨ä¼ é€’ConfigMap <a aria-current="page" href="#é€šè¿‡ç¯å¢ƒå˜é‡ç»™å®¹å™¨ä¼ é€’configmap" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å¯ä»¥å°†ConfigMapä¸­çš„é”®å€¼å¯¹æ•°æ®é€šè¿‡ç¯å¢ƒå˜é‡çš„å½¢å¼ä¼ é€’åˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·åœ¨é…ç½®å®¹å™¨çš„æ—¶å€™æœ‰ä¸€äº›æ•°æ®å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç„¶åä½¿ç”¨ConfigMapè¿›è¡Œå¡«å……ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°é…ç½®å’ŒPodçš„åˆ†ç¦»ã€‚</p><h2 id="_15-2-ä½¿ç”¨secretç®¡ç†æ•æ„Ÿæ•°æ®" tabindex="-1">15.2 ä½¿ç”¨Secretç®¡ç†æ•æ„Ÿæ•°æ® <a aria-current="page" href="#_15-2-ä½¿ç”¨secretç®¡ç†æ•æ„Ÿæ•°æ®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">åœ¨åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ç»å¸¸ä¼šæœ‰ä¸€äº›æ•æ„Ÿä¿¡æ¯éœ€è¦å­˜å‚¨ï¼Œä¾‹å¦‚ç”¨æˆ·åå’Œå¯†ç ç­‰ï¼Œå¦‚æœç›´æ¥æ˜æ–‡çš„æ–¹å¼ä¿å­˜ä¼šæœ‰å®‰å…¨é£é™©ã€‚åœ¨Kubernetesä¸­Secretè¿™ä¸ªèµ„æºå¯¹è±¡ç±»å‹ç”¨æ¥ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€å¯†é’¥ã€è®¿é—®ä»¤ç‰Œã€SSH Keyç­‰ä½ è®¤ä¸ºéœ€è¦ä¿å¯†çš„æ•æ„Ÿä¿¡æ¯ã€‚ç›¸å¯¹äºå°†è¿™äº›å†…å®¹ä¿å­˜åˆ°å®¹å™¨é•œåƒæˆ–è€…Podçš„å®šä¹‰æ–‡ä»¶ä¸­ï¼Œæ›´åŠ çš„çµæ´»å’Œå®‰å…¨ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="é…ç½®podä½¿ç”¨harboré•œåƒ" tabindex="-1">é…ç½®Podä½¿ç”¨Harboré•œåƒ <a aria-current="page" href="#é…ç½®podä½¿ç”¨harboré•œåƒ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>1ï¼docker loginå¾—åˆ° dockerå¯†ç æ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# docker login 192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.å¯¹å¯†ç æ–‡ä»¶è¿›è¡ŒåŠ å¯†</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cat /root/.docker/config.json |base64</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.åˆ›å»ºharborä½¿ç”¨çš„Secret YAMLæ–‡ä»¶ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim harbor-secret.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Secret</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: harbor-secret</span></span>
<span class="line"><span style="color:#a6accd">  namespace: default</span></span>
<span class="line"><span style="color:#a6accd">data:</span></span>
<span class="line"><span style="color:#a6accd">  .dockerconfigjson: 'ewoJImF1dGhzIjogewoJCSJyZWcuZ3JlYXRvcHMubmV0IjogewoJCQkiYXV0aCI6ICJZV1J0YVc0Nk1YRmhlbmh6ZHpJPSIKCQl9Cgl9Cn0='</span></span>
<span class="line"><span style="color:#a6accd">type: kubernetes.io/dockerconfigjson</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4.åˆ›å»ºSecret</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@jenkins k8s-deploy]# kubectl create -f reg-harbor.yaml </span></span>
<span class="line"><span style="color:#a6accd">secret "reg-harbor" created</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>5.åˆ›å»ºpodå¹¶æŒ‚è½½èµ„æº</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Pod</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: sectest</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  containers:</span></span>
<span class="line"><span style="color:#a6accd">  - name: sectest</span></span>
<span class="line"><span style="color:#a6accd">    image: 123.207.154.16/base/redis:alpine</span></span>
<span class="line"><span style="color:#a6accd">    ports:</span></span>
<span class="line"><span style="color:#a6accd">    - containerPort: 6379</span></span>
<span class="line"><span style="color:#a6accd">  imagePullSecrets:</span></span>
<span class="line"><span style="color:#a6accd">    - name: harbor-secret</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="ä½¿ç”¨helmç®¡ç†kubernetesåº”ç”¨" tabindex="-1">ä½¿ç”¨Helmç®¡ç†Kubernetesåº”ç”¨ <a aria-current="page" href="#ä½¿ç”¨helmç®¡ç†kubernetesåº”ç”¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼ŒæŒæ¡äº†å°†åº”ç”¨è¿ç§»è‡³Kubernetesçš„æ­¥éª¤å’ŒæŠ€å·§ï¼Œè¿‡ç¨‹æ¯”è¾ƒè‰°è¾›ã€‚ä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œæ¶‰åŠåˆ°Deploymentã€Serviceã€Ingressã€PVã€PVCï¼Œå¦‚ä½•æœ‰æ•ˆçš„ç®¡ç†è¿™äº›èµ„æºå‘¢ï¼ŒKubernetesç»™å‡ºäº†ä¸€ä¸ªæœ€ä½³å®è·µå°±æ˜¯Helmã€‚ Helmæ˜¯ä¸€ä¸ªkubernetesåº”ç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œç”¨æ¥ç®¡ç†chartsâ€”â€”é¢„å…ˆé…ç½®å¥½çš„å®‰è£…åŒ…èµ„æºï¼Œæœ‰ç‚¹ç±»ä¼¼äºUbuntuçš„APTå’ŒCentOSä¸­çš„yumã€‚ Helm chartæ˜¯ç”¨æ¥å°è£…kubernetesåŸç”Ÿåº”ç”¨ç¨‹åºçš„yamlæ–‡ä»¶ï¼Œå¯ä»¥åœ¨ä½ éƒ¨ç½²åº”ç”¨çš„æ—¶å€™è‡ªå®šä¹‰åº”ç”¨ç¨‹åºçš„ä¸€äº›metadataï¼Œä¾¿ä¸åº”ç”¨ç¨‹åºçš„åˆ†å‘ã€‚</p><p>Helmå’Œchartsçš„ä¸»è¦ä½œç”¨ï¼š</p><ul><li>åº”ç”¨ç¨‹åºå°è£…</li><li>ç‰ˆæœ¬ç®¡ç†</li><li>ä¾èµ–æ£€æŸ¥</li><li>ä¾¿äºåº”ç”¨ç¨‹åºåˆ†å‘</li></ul><h2 id="helméƒ¨ç½²" tabindex="-1">Helméƒ¨ç½² <a aria-current="page" href="#helméƒ¨ç½²" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="å®‰è£…helm" tabindex="-1">å®‰è£…Helm <a aria-current="page" href="#å®‰è£…helm" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>1.éƒ¨ç½²Helmå®¢æˆ·ç«¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# tar zxf helm-v3.0.2-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# mv linux-amd64/helm /usr/local/bin/</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm version</span></span>
<span class="line"><span style="color:#a6accd">version.BuildInfo{Version:"v3.0.2", GitCommit:"19e47ee3283ae98139d98460de796c1be1e3975f", GitTreeState:"clean", GoVersion:"go1.13.5"}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ä½¿ç”¨helméƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨" tabindex="-1">ä½¿ç”¨Helméƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨ <a aria-current="page" href="#ä½¿ç”¨helméƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>4.æœç´¢Helmåº”ç”¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm search jenkins</span></span>
<span class="line"><span style="color:#a6accd">NAME              CHART VERSION    APP VERSION    DESCRIPTION                                       </span></span>
<span class="line"><span style="color:#a6accd">stable/jenkins    0.13.5           2.73           Open source continuous integration server. It s...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>5.æŸ¥çœ‹ä»“åº“</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm repo list</span></span>
<span class="line"><span style="color:#a6accd">NAME      URL                                                   </span></span>
<span class="line"><span style="color:#a6accd">stable    https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span>
<span class="line"><span style="color:#a6accd">local     http://127.0.0.1:8879/charts</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>6.å®‰è£…ç¬¬ä¸€ä¸ªåº”ç”¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm install stable/jenkins</span></span>
<span class="line"><span style="color:#a6accd">NAME:   viable-seal</span></span>
<span class="line"><span style="color:#a6accd">LAST DEPLOYED: Thu Jul 26 19:21:07 2018</span></span>
<span class="line"><span style="color:#a6accd">NAMESPACE: default</span></span>
<span class="line"><span style="color:#a6accd">STATUS: DEPLOYED</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">RESOURCES:</span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">NAME                       DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins        3     1s</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins-tests  1     1s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#a6accd">NAME                 STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins  Pending  1s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Service</span></span>
<span class="line"><span style="color:#a6accd">NAME                       TYPE          CLUSTER-IP   EXTERNAL-IP  PORT(S)         AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins-agent  ClusterIP     10.1.154.54  &lt;none&gt;       50000/TCP       1s</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins        LoadBalancer  10.1.63.24   &lt;pending&gt;    8080:20031/TCP  0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1beta1/Deployment</span></span>
<span class="line"><span style="color:#a6accd">NAME                 DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins  1        1        1           0          0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Pod(related)</span></span>
<span class="line"><span style="color:#a6accd">NAME                                  READY  STATUS   RESTARTS  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins-7f5c7bd8d4-gc5hv  0/1    Pending  0         0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Secret</span></span>
<span class="line"><span style="color:#a6accd">NAME                 TYPE    DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal-jenkins  Opaque  2     1s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NOTES:</span></span>
<span class="line"><span style="color:#a6accd">1. Get your 'admin' user password by running:</span></span>
<span class="line"><span style="color:#a6accd">  printf $(kubectl get secret --namespace default viable-seal-jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo</span></span>
<span class="line"><span style="color:#a6accd">2. Get the Jenkins URL to visit by running these commands in the same shell:</span></span>
<span class="line"><span style="color:#a6accd">  NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span></span>
<span class="line"><span style="color:#a6accd">        You can watch the status of by running 'kubectl get svc --namespace default -w viable-seal-jenkins'</span></span>
<span class="line"><span style="color:#a6accd">  export SERVICE_IP=$(kubectl get svc --namespace default viable-seal-jenkins --template "{{ range (index .status.loadBalancer.ingress 0) }}{{ . }}{{ end }}")</span></span>
<span class="line"><span style="color:#a6accd">  echo http://$SERVICE_IP:8080/login</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">3. Login with the password from step 1 and the username: admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">For more information on running Jenkins on Kubernetes, visit:</span></span>
<span class="line"><span style="color:#a6accd">https://cloud.google.com/solutions/jenkins-on-container-engine</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_15-2-æ·±å…¥ç†è§£helm" tabindex="-1">15.2 æ·±å…¥ç†è§£Helm <a aria-current="page" href="#_15-2-æ·±å…¥ç†è§£helm" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h3 id="helmç»„ä»¶" tabindex="-1">Helmç»„ä»¶ <a aria-current="page" href="#helmç»„ä»¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# tree ~/.helm/</span></span>
<span class="line"><span style="color:#a6accd">/root/.helm/</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ cache</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â””â”€â”€ archive</span></span>
<span class="line"><span style="color:#a6accd">â”‚       â””â”€â”€ jenkins-0.13.5.tgz</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ plugins</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ repository</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ cache</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”‚   â”œâ”€â”€ local-index.yaml -&gt; /root/.helm/repository/local/index.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”‚   â””â”€â”€ stable-index.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ local</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”‚   â””â”€â”€ index.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â””â”€â”€ repositories.yaml</span></span>
<span class="line"><span style="color:#a6accd">â””â”€â”€ starters</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">7 directories, 5 files</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é»˜è®¤ç¼“å­˜çš„æ–‡ä»¶</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd .helm/cache/archive/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 archive]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 16</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 12650 Jul 26 19:21 jenkins-0.13.5.tgz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 archive]# tar zxf jenkins-0.13.5.tgz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 archive]# mv jenkins ~/.helm/repository/local/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd ~/.helm/repository/local/jenkins/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# tree</span></span>
<span class="line"><span style="color:#a6accd">.</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ Chart.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ OWNERS</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ README.md</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ templates</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ config.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ _helpers.tpl</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ home-pvc.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jenkins-agent-svc.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jenkins-master-deployment.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jenkins-master-ingress.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jenkins-master-networkpolicy.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jenkins-master-svc.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jenkins-test.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ jobs.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ NOTES.txt</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ rbac.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ secret.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ service-account.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â””â”€â”€ test-config.yaml</span></span>
<span class="line"><span style="color:#a6accd">â””â”€â”€ values.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1 directory, 19 files</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="è‡ªå®šä¹‰jenkinsçš„chart" tabindex="-1">è‡ªå®šä¹‰Jenkinsçš„Chart <a aria-current="page" href="#è‡ªå®šä¹‰jenkinsçš„chart" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ä¿®æ”¹ä¸ºNodePort</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 jenkins]# vim values.yaml</span></span>
<span class="line"><span style="color:#a6accd">ServiceType: NodePort</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ£€æŸ¥</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm lint ~/.helm/repository/local/jenkins/</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Linting /root/.helm/repository/local/jenkins/</span></span>
<span class="line"><span style="color:#a6accd">Lint OK</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">1 chart(s) linted, no failures</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹æœ‰å“ªäº›åº”ç”¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm list</span></span>
<span class="line"><span style="color:#a6accd">NAME           REVISION    UPDATED                     STATUS      CHART          NAMESPACE</span></span>
<span class="line"><span style="color:#a6accd">viable-seal    1           Thu Jul 26 19:21:07 2018    DEPLOYED    jenkins-0.13.5 default</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm delete --purge viable-seal</span></span>
<span class="line"><span style="color:#a6accd">release "viable-seal" deleted</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm install ~/.helm/repository/local/jenkins/ --name devops-jenkins </span></span>
<span class="line"><span style="color:#a6accd">NAME:   devops-jenkins</span></span>
<span class="line"><span style="color:#a6accd">LAST DEPLOYED: Thu Jul 26 19:36:10 2018</span></span>
<span class="line"><span style="color:#a6accd">NAMESPACE: default</span></span>
<span class="line"><span style="color:#a6accd">STATUS: DEPLOYED</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">RESOURCES:</span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Secret</span></span>
<span class="line"><span style="color:#a6accd">NAME            TYPE    DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins  Opaque  2     0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/ConfigMap</span></span>
<span class="line"><span style="color:#a6accd">NAME                  DATA  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins        3     0s</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins-tests  1     0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#a6accd">NAME            STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins  Pending  0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Service</span></span>
<span class="line"><span style="color:#a6accd">NAME                  TYPE       CLUSTER-IP   EXTERNAL-IP  PORT(S)         AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins-agent  ClusterIP  10.1.74.175  &lt;none&gt;       50000/TCP       0s</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins        NodePort   10.1.3.112   &lt;none&gt;       8080:23558/TCP  0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1beta1/Deployment</span></span>
<span class="line"><span style="color:#a6accd">NAME            DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins  1        1        1           0          0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">==&gt; v1/Pod(related)</span></span>
<span class="line"><span style="color:#a6accd">NAME                            READY  STATUS   RESTARTS  AGE</span></span>
<span class="line"><span style="color:#a6accd">devops-jenkins-64d54b79c-pwjfb  0/1    Pending  0         0s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">NOTES:</span></span>
<span class="line"><span style="color:#a6accd">1. Get your 'admin' user password by running:</span></span>
<span class="line"><span style="color:#a6accd">  printf $(kubectl get secret --namespace default devops-jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo</span></span>
<span class="line"><span style="color:#a6accd">2. Get the Jenkins URL to visit by running these commands in the same shell:</span></span>
<span class="line"><span style="color:#a6accd">  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services devops-jenkins)</span></span>
<span class="line"><span style="color:#a6accd">  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")</span></span>
<span class="line"><span style="color:#a6accd">  echo http://$NODE_IP:$NODE_PORT/login</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">3. Login with the password from step 1 and the username: admin</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">For more information on running Jenkins on Kubernetes, visit:</span></span>
<span class="line"><span style="color:#a6accd">https://cloud.google.com/solutions/jenkins-on-container-engine</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹çŠ¶æ€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm status devops-jenkins</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="åˆ›å»ºè‡ªå·±çš„chart" tabindex="-1">åˆ›å»ºè‡ªå·±çš„Chart <a aria-current="page" href="#åˆ›å»ºè‡ªå·±çš„chart" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="åˆ›å»ºè‡ªå®šä¹‰nginxçš„chart" tabindex="-1">åˆ›å»ºè‡ªå®šä¹‰Nginxçš„Chart <a aria-current="page" href="#åˆ›å»ºè‡ªå®šä¹‰nginxçš„chart" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>1.åˆ›å»ºè‡ªå®šä¹‰Chart Nginxçš„ç»“æ„</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm create helm-nginx</span></span>
<span class="line"><span style="color:#a6accd">Creating helm-nginx</span></span>
<span class="line"><span style="color:#a6accd"> [root@linux-node1 ~]# tree helm-nginx/</span></span>
<span class="line"><span style="color:#a6accd">opencmdb/</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ charts       #ä¾èµ–çš„chart</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ Chart.yaml   #æœ¬chartçš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">â”œâ”€â”€ templates    #æ¨¡æ¿ç›®å½•</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ deployment.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ _helpers.tpl</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ ingress.yaml</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â”œâ”€â”€ NOTES.txt</span></span>
<span class="line"><span style="color:#a6accd">â”‚   â””â”€â”€ service.yaml</span></span>
<span class="line"><span style="color:#a6accd">â””â”€â”€ values.yaml   #æ¨¡æ¿èµ‹å€¼</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2.ç¼–è¾‘Charté…ç½®</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd helm-nginx/</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 helm-nginx]# vim values.yaml</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3.éªŒè¯Charté…ç½®ï¼Œæœ€åé¢çš„ç‚¹è¡¨ç¤ºå½“å‰ç›®å½•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 helm-nginx]# helm install --dry-run --debug --name helm-nginx .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4.å®‰è£…è‡ªå®šä¹‰Chartï¼Œæœ€åé¢çš„ç‚¹è¡¨ç¤ºå½“å‰ç›®å½•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 helm-nginx]# helm install --name helm-nginx .</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="æŸ¥çœ‹helmå®ä¾‹" tabindex="-1">æŸ¥çœ‹Helmå®ä¾‹ <a aria-current="page" href="#æŸ¥çœ‹helmå®ä¾‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# helm list</span></span>
<span class="line"><span style="color:#a6accd">NAME          REVISION    UPDATED                     STATUS      CHART                 NAMESPACE</span></span>
<span class="line"><span style="color:#a6accd">helm-nginx    1           Sun Sep 16 19:32:19 2018    DEPLOYED    helm-nginx-0.1.0      default  </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod</span></span>
<span class="line"><span style="color:#a6accd">NAME                          READY     STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#a6accd">helm-nginx-6975f8dbcd-htvtd   1/1       Running   0          51s</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get ingress</span></span>
<span class="line"><span style="color:#a6accd">NAME         HOSTS                ADDRESS   PORTS     AGE</span></span>
<span class="line"><span style="color:#a6accd">helm-nginx   www.helm-nginx.com             80        1m</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_17-åº”ç”¨çš„æ—¥å¿—é‡‡é›†ä¸åˆ†æ" tabindex="-1">17 åº”ç”¨çš„æ—¥å¿—é‡‡é›†ä¸åˆ†æ <a aria-current="page" href="#_17-åº”ç”¨çš„æ—¥å¿—é‡‡é›†ä¸åˆ†æ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h2 id="prometheuså¿«é€Ÿå…¥é—¨" tabindex="-1">Prometheuså¿«é€Ÿå…¥é—¨ <a aria-current="page" href="#prometheuså¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h3 id="prometheusæ¶æ„ä»‹ç»" tabindex="-1">Prometheusæ¶æ„ä»‹ç» <a aria-current="page" href="#prometheusæ¶æ„ä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>åœ¨å­¦ä¹ Prometheusä¹‹å‰æˆ‘ä»¬éœ€è¦æ¸…æ™°çš„æŒæ¡å…¶æ¶æ„ï¼ŒPrometheusæ˜¯ç”±å¤šä¸ªç»„ä»¶ç»„æˆçš„çš„ç›‘æ§ç³»ç»Ÿï¼Œä¸»è¦æœ‰ï¼šPrometheus Serverã€Alertmanagerã€Pushgatewayç»„æˆï¼Œè¿™ä¸‰ä¸ªç»„ä»¶å‡ä¸ºç‹¬ç«‹çš„åº”ç”¨æœåŠ¡ï¼Œç‹¬ç«‹éƒ¨ç½²å’Œè¿è¡Œï¼Œå…¶ä¸­Prometheus Serverä¸­å†…ç½®äº†Prometheus web UIã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/2ada1ece66fcc81d704c2ba46f9dd7d3.png" alt="architecture"></p><p><strong>Prometheus Serverï¼š</strong></p><p>Promethedus Serveræ˜¯æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ•°æ®çš„è·å–ã€å­˜å‚¨ã€æŸ¥è¯¢ã€‚Prometheusé€šè¿‡Pullçš„æ–¹å¼å®šæœŸçš„ä»Jobs/Exportersä¸­è·å–æ•°æ®ï¼Œå¹¶ä¿å­˜åœ¨å†…ç½®çš„TSDBä¸­ï¼›å†…ç½®çš„Prometheus web UIå¯ä»¥è®©ç”¨æˆ·é€šè¿‡PromQLçš„æ–¹å¼è¿›è¡Œæ•°æ®çš„æ£€ç´¢ã€‚</p><p><strong>Exportersï¼š</strong></p><p>Exportersä¹Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œæœ‰å®˜æ–¹æä¾›çš„Exportersä¹Ÿæœ‰ç¤¾åŒºè´¡çŒ®çš„Exportesï¼Œå®ƒå°†ç›‘æ§é‡‡é›†çš„æ•°æ®é€šè¿‡HTTPçš„æ–¹å¼æš´éœ²ç»™Prometheus Serverï¼ŒServerå®šæœŸè·å–æ•°æ®ã€‚ä¾‹å¦‚æœ‰ä¸€ä¸ªExporterså«åšNode Exporterï¼Œå®ƒå®‰è£…åœ¨å—é‡‡é›†çš„ä¸»æœºä¸Šï¼Œä¸ºServeræä¾›æ•°æ®ï¼Œæœ‰ç‚¹ç±»ä¼¼äºZabbixç›‘æ§ç³»ç»Ÿä¸­çš„Zabbix Agentã€‚</p><p><strong>Prometheus web UIï¼š</strong></p><p>Prometheus web UIæ˜¯Serverå¯åŠ¨åå†…ç½®çš„ä¸€ä¸ªWebç•Œé¢ï¼Œé€šè¿‡è¯¥Webç•Œé¢æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ•°æ®æŸ¥è¯¢å·¥ä½œï¼Œä¸åŒ…å«è®¾ç½®çš„ç›¸å…³åŠŸèƒ½ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/cc11e0cf02ff729fb905ac3648af18f7.png" alt="img"></p><p><strong>PromQLï¼š</strong></p><p>PromQLæ˜¯Prometheuså†…ç½®çš„è‡ªå®šä¹‰çš„æŸ¥è¯¢è¯­è¨€ï¼Œæä¾›å¯¹Prometheus Serverä¸­çš„TSDBè¿™ä¸ªæ—¶é—´åºåˆ—æ•°æ®åº“è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œæ”¯æŒæ•°æ®èšåˆå’Œä¸€äº›é€»è¾‘è¿ç®—ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„æŸ¥è¯¢è¯­è¨€ï¼Œè€Œä¸”PromQLä¹Ÿæä¾›äº†ä¸€äº›å†…ç½®å‡½æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ•°æ®å¤„ç†ã€‚</p><p><strong>Alertmanagerï¼š</strong></p><p>Alertmanageræ˜¯Promethedusçš„å‘Šè­¦ç®¡ç†ç»„ä»¶ï¼Œå®ƒæ”¯æŒåŸºäºPromQLæ¥åˆ›å»ºå‘Šè­¦è§„åˆ™ï¼Œç±»ä¼¼äºZabbixä¸­çš„å‘Šè­¦è¡¨è¾¾å¼ï¼Œå¯¹è·å–åˆ°çš„æ•°æ®è¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒï¼Œå¦‚æœæ»¡è¶³PromQLå®šä¹‰çš„è§„åˆ™æ¡ä»¶ï¼Œå°±ä¼šäº§ç”ŸæŠ¥è­¦ã€‚</p><p><strong>Pushgatewayï¼š</strong></p><p>Pushgatewayå¯ä»¥ç†è§£ä¸ºæ•°æ®çš„ä¸€ä¸ªä¸­è½¬ç«™ï¼Œä¾‹å¦‚å½“Prometheus Serverä¸èƒ½ç›´æ¥å’ŒExportersè¿›è¡Œé€šä¿¡çš„åœºæ™¯ä¸‹ã€‚</p><h3 id="å®‰è£…prometheus" tabindex="-1">å®‰è£…Prometheus <a aria-current="page" href="#å®‰è£…prometheus" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>å­¦ä¹ Prometheusçš„ç¬¬ä¸€æ­¥å°±æ˜¯å…ˆéƒ¨ç½²ä¸€ä¸ªå®éªŒç¯å¢ƒï¼Œå®˜æ–¹æä¾›äº†å¤šç§æ–¹å¼è¿›è¡ŒPrometheuså®‰è£…ï¼š</p><ul><li>æºç ç¼–è¯‘å®‰è£…</li><li>ä¸‹è½½é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶</li><li>ä½¿ç”¨Dockeréƒ¨ç½²</li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼šAnsibleã€SaltStackã€Puppetã€Chefã€‚</li></ul><p>ä¸ºäº†æ–¹ä¾¿å­¦ä¹ ï¼Œé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²ï¼Œå¯ä»¥åœ¨è¿™é‡Œ<a href="https://prometheus.io/download/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E3%80%82" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://prometheus.io/download/ä¸‹è½½å¯¹åº”çš„é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚<!--]--></a></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget</span></span>
<span class="line"><span style="color:#a6accd">https://github.com/prometheus/prometheus/releases/download/v2.7.1/prometheus-2.7.1.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# tar zxf prometheus-2.7.1.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# mv prometheus-2.7.1.linux-amd64 /usr/local/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# ln -s /usr/local/prometheus-2.7.1.linux-amd64/</span></span>
<span class="line"><span style="color:#a6accd">/usr/local/prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>Prometheusé…ç½®</strong></p><p>Prometheusçš„é…ç½®æ–‡ä»¶åœ¨prometheus.ymlä¸­ï¼Œç›´æ¥å¯åŠ¨ä¹Ÿä¼šåˆ°å‘½ä»¤çš„å½“å‰ç›®å½•ä¸‹å¯»æ‰¾è¯¥æ–‡ä»¶ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 prometheus]# vim prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd"># my global config</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">global:</span></span>
<span class="line"><span style="color:#a6accd">scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span>
<span class="line"><span style="color:#a6accd">evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.</span></span>
<span class="line"><span style="color:#a6accd"># scrape_timeout is set to the global default (10s).</span></span>
<span class="line"><span style="color:#a6accd"># Alertmanager configuration</span></span>
<span class="line"><span style="color:#a6accd">alerting:</span></span>
<span class="line"><span style="color:#a6accd">alertmanagers:</span></span>
<span class="line"><span style="color:#a6accd">- static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets:</span></span>
<span class="line"><span style="color:#a6accd"># - alertmanager:9093</span></span>
<span class="line"><span style="color:#a6accd"># Load rules once and periodically evaluate them according to the global</span></span>
<span class="line"><span style="color:#a6accd">'evaluation_interval'.</span></span>
<span class="line"><span style="color:#a6accd">rule_files:</span></span>
<span class="line"><span style="color:#a6accd"># - "first_rules.yml"</span></span>
<span class="line"><span style="color:#a6accd"># - "second_rules.yml"</span></span>
<span class="line"><span style="color:#a6accd"># A scrape configuration containing exactly one endpoint to scrape:</span></span>
<span class="line"><span style="color:#a6accd"># Here it's Prometheus itself.</span></span>
<span class="line"><span style="color:#a6accd">scrape_configs:</span></span>
<span class="line"><span style="color:#a6accd"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries</span></span>
<span class="line"><span style="color:#a6accd">scraped from this config.</span></span>
<span class="line"><span style="color:#a6accd">- job_name: 'prometheus'</span></span>
<span class="line"><span style="color:#a6accd"># metrics_path defaults to '/metrics'</span></span>
<span class="line"><span style="color:#a6accd"># scheme defaults to 'http'.</span></span>
<span class="line"><span style="color:#a6accd">static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets: ['localhost:9090']</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>å¯åŠ¨Prometheus</strong></p><p>é»˜è®¤æƒ…å†µä¸‹Prometheusä¼šæŠŠæ•°æ®å†™åœ¨å¯åŠ¨ç›®å½•çš„./dataç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°æŒ‡å®šç›®å½•ï¼š--storage.tsdb.path="data/"ï¼Œæ›´å¤šå‚æ•°å¯ä»¥é€šè¿‡â€”helpæŸ¥çœ‹</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 prometheus]# ./prometheus â€“help</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 prometheus]# ./prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">â€¦</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.799169159Z caller=main.go:620 msg="Starting</span></span>
<span class="line"><span style="color:#a6accd">TSDB ..."</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.835497463Z caller=main.go:635 msg="TSDB</span></span>
<span class="line"><span style="color:#a6accd">started"</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.835598421Z caller=main.go:695 msg="Loading</span></span>
<span class="line"><span style="color:#a6accd">configuration file" filename=prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.83756508Z caller=main.go:722 msg="Completed</span></span>
<span class="line"><span style="color:#a6accd">loading of configuration file" filename=prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.83760078Z caller=main.go:589 msg="Server is</span></span>
<span class="line"><span style="color:#a6accd">ready to receive web requests."</span></span>
<span class="line"><span style="color:#a6accd">level=info ts=2019-02-12T08:04:03.837641772Z caller=web.go:416 component=web</span></span>
<span class="line"><span style="color:#a6accd">msg="Start listening for connections" address=0.0.0.0:9090</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é»˜è®¤ä¼šåœ¨å‰å°å¯åŠ¨ï¼Œå¹¶ç›‘å¬9090ç«¯å£ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºdataç›®å½•ï¼Œå¹¶å­˜æ”¾æ•°æ®ã€‚æ³¨æ„å¦‚ä½•æœåŠ¡å™¨æ—¶é—´ä¸æ­£ç¡®ä¼šæœ‰è­¦å‘Šæç¤ºï¼Œè¯·ä¿è¯æœåŠ¡å™¨æ—¶é—´åŒæ­¥ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/266a101825cbabc2782820895e161f59.png" alt="img"></p><p><strong>æ”¾ç½®åœ¨åå°è¿è¡Œ</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# groupadd prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# useradd -g prometheus -d /var/lib/prometheus -s</span></span>
<span class="line"><span style="color:#a6accd">/sbin/nologin prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /usr/lib/systemd/system/prometheus.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[Unit]</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">Description=prometheus</span></span>
<span class="line"><span style="color:#a6accd">After=network.target</span></span>
<span class="line"><span style="color:#a6accd">[Service]</span></span>
<span class="line"><span style="color:#a6accd">Type=simple</span></span>
<span class="line"><span style="color:#a6accd">User=prometheus</span></span>
<span class="line"><span style="color:#a6accd">ExecStart=/usr/local/prometheus/prometheus</span></span>
<span class="line"><span style="color:#a6accd">--config.file=/usr/local/prometheus/prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd">--storage.tsdb.path=/var/lib/prometheus</span></span>
<span class="line"><span style="color:#a6accd">Restart=on-failure</span></span>
<span class="line"><span style="color:#a6accd">[Install]</span></span>
<span class="line"><span style="color:#a6accd">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åå°å¯åŠ¨</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep 9090</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">tcp6 0 0 :::9090 :::* LISTEN 61333/prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ä½¿ç”¨node-exporteré‡‡é›†ä¸»æœºæ•°æ®" tabindex="-1">ä½¿ç”¨Node Exporteré‡‡é›†ä¸»æœºæ•°æ® <a aria-current="page" href="#ä½¿ç”¨node-exporteré‡‡é›†ä¸»æœºæ•°æ®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# cd /usr/local/src</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# wget</span></span>
<span class="line"><span style="color:#a6accd">&lt;https://github.com/prometheus/node_exporter/releases/download/v0.17.0/node_exporter-0.17.0.linux-amd64.tar.gz&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# tar zxf node_exporter-0.17.0.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# mv node_exporter-0.17.0.linux-amd64 /usr/local/</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 src]# ln -s /usr/local/node_exporter-0.17.0.linux-amd64/</span></span>
<span class="line"><span style="color:#a6accd">/usr/local/node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /usr/lib/systemd/system/node_exporter.service</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[Unit]</span></span>
<span class="line"><span style="color:#a6accd">Description=node_exporter</span></span>
<span class="line"><span style="color:#a6accd">After=network.target</span></span>
<span class="line"><span style="color:#a6accd">[Service]</span></span>
<span class="line"><span style="color:#a6accd">Type=simple</span></span>
<span class="line"><span style="color:#a6accd">User=prometheus</span></span>
<span class="line"><span style="color:#a6accd">ExecStart=/usr/local/prometheus/node_exporter/node_exporter</span></span>
<span class="line"><span style="color:#a6accd">Restart=on-failure</span></span>
<span class="line"><span style="color:#a6accd">[Install]</span></span>
<span class="line"><span style="color:#a6accd">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯åŠ¨Node Exporter</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹çŠ¶æ€ [root@linux-node1 ~]# netstat -ntlp | grep 9100</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">tcp6 0 0 :::9100 :::* LISTEN 66239/node_exporter</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹Node Exporterç›‘å¬9100ç«¯å£ï¼Œé€šè¿‡/metricsæš´éœ²é‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®ï¼ŒPrometheusé»˜è®¤ä¹Ÿä»è¯¥åœ°å€è·å–æ•°æ®ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/1004a69a33423c72a2989005be5a790e.png" alt="img"></p><p><strong>é…ç½®Prometheusè¯»å–Node Exporteræ•°æ®</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /usr/local/prometheus/prometheus.yml</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">scrape_configs:</span></span>
<span class="line"><span style="color:#a6accd"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries</span></span>
<span class="line"><span style="color:#a6accd">scraped from this config.</span></span>
<span class="line"><span style="color:#a6accd">- job_name: 'prometheus'</span></span>
<span class="line"><span style="color:#a6accd"># metrics_path defaults to '/metrics'</span></span>
<span class="line"><span style="color:#a6accd"># scheme defaults to 'http'.</span></span>
<span class="line"><span style="color:#a6accd">static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets: ['localhost:9090']</span></span>
<span class="line"><span style="color:#a6accd">- job_name: 'linux-node1'</span></span>
<span class="line"><span style="color:#a6accd">static_configs:</span></span>
<span class="line"><span style="color:#a6accd">- targets: ['192.168.56.11:9100']</span></span>
<span class="line"><span style="color:#a6accd">labels:</span></span>
<span class="line"><span style="color:#a6accd">instance: linux-node1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>é‡å¯prometheus</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl restart prometheus</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹ç›‘æ§çŠ¶æ€</strong></p><p>ç™»å½•Prometheusçš„Webæ§åˆ¶å°ï¼ŒStatusTargetså¦‚æœå¯ä»¥linux-node1å¹¶ä¸”çŠ¶æ€æ˜¯UPçš„çŠ¶æ€å³ä¸ºé…ç½®æˆåŠŸã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/8c3da60dbf5558dc649de1fd6ce43bf0.png" alt="img"></p><h3 id="ä½¿ç”¨prometheus-uiæŸ¥çœ‹æ•°æ®" tabindex="-1">ä½¿ç”¨Prometheus UIæŸ¥çœ‹æ•°æ® <a aria-current="page" href="#ä½¿ç”¨prometheus-uiæŸ¥çœ‹æ•°æ®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>ç°åœ¨Prometheusä¼šå®šæœŸçš„ä»<a href="http://192.168.56.11:9100/metrics%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%AD%98%E5%82%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8Prometheus" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://192.168.56.11:9100/metricsè·å–æ•°æ®ï¼Œå¹¶å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Prometheus<!--]--></a> UIæ¥æŸ¥çœ‹ç›‘æ§æ•°æ®ã€‚</p><h3 id="ä½¿ç”¨grafanaè¿›è¡Œæ•°æ®å¯è§†åŒ–" tabindex="-1">ä½¿ç”¨Grafanaè¿›è¡Œæ•°æ®å¯è§†åŒ– <a aria-current="page" href="#ä½¿ç”¨grafanaè¿›è¡Œæ•°æ®å¯è§†åŒ–" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p><strong>1.å®‰è£…Grafana</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/yum.repos.d/grafana.repo</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[grafana]</span></span>
<span class="line"><span style="color:#a6accd">name=grafana</span></span>
<span class="line"><span style="color:#a6accd">baseurl=https://packages.grafana.com/oss/rpm</span></span>
<span class="line"><span style="color:#a6accd">repo_gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">enabled=1</span></span>
<span class="line"><span style="color:#a6accd">gpgcheck=1</span></span>
<span class="line"><span style="color:#a6accd">gpgkey=https://packages.grafana.com/gpg.key</span></span>
<span class="line"><span style="color:#a6accd">sslverify=1</span></span>
<span class="line"><span style="color:#a6accd">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# yum install -y grafana</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>2.é…ç½®Grafana</strong></p><p>Grafanaçš„é…ç½®æ–‡ä»¶åœ¨/etc/grafana/grafana.iniï¼Œé»˜è®¤æƒ…å†µä¸‹Grafanaç›‘å¬3000ç«¯å£</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim /etc/grafana/grafana.ini</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>3.å¯åŠ¨Grafana</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl enable grafana-server</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# systemctl start grafana-server</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# netstat -ntlp | grep 3000</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">tcp6 0 0 :::3000 :::* LISTEN 81427/grafana-serve</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>4.è®¿é—®Grafana</strong></p><p>è®¿é—®<a href="http://192.168.56.11:3000/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://192.168.56.11:3000<!--]--></a>ï¼Œç”¨æˆ·åå’Œå¯†ç é»˜è®¤ä¸ºadmin/adminï¼Œç¬¬ä¸€æ¬¡ç™»é™†ä¼šè¦æ±‚ä¿®æ”¹å¯†ç ï¼Œè¯·ä½¿ç”¨å®‰å…¨å¯†ç ã€‚</p><p><strong>5.å¢åŠ Prometheusæ•°æ®æº</strong></p><p>ç‚¹å‡»</p><p><img src="http://k8s.unixhot.com/kubernetes/media/b681a9b528d2ff21ba66666ce2452e51.png" alt="img"></p><p>ï¼Œç„¶åé€‰æ‹©</p><p><img src="http://k8s.unixhot.com/kubernetes/media/d3e83ac4f090a51c5b5e0c341b99dda5.png" alt="img"></p><p>ã€‚</p><p>é…ç½®URLä¸ºï¼š<a href="http://192.168.56.11:9090/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://192.168.56.11:9090<!--]--></a>ï¼Œå¹¶ç‚¹å‡»Save&amp;Testã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/e35d8aaebedd7e168ebd1b29b65b30bb.png" alt="img"></p><p><strong>6.è®¾ç½®Dashboard</strong></p><p>æ•°æ®æºè®¾ç½®å®Œæ¯•åï¼Œå°±å¯ä»¥è®¾ç½®Dashboardå›¾å½¢å±•ç¤ºï¼Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½åˆ«äººé…ç½®å¥½ä¿æŒçš„Jsonæ–‡ä»¶ç›´æ¥å¯¼å…¥å³å¯ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://grafana.com/dashboards/405%EF%BC%8C%E5%9C%A8%E5%8F%B3%E4%BE%A7%E6%9C%89Download" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://grafana.com/dashboards/405ï¼Œåœ¨å³ä¾§æœ‰Download<!--]--></a> JsonæŒ‰é’®ï¼Œä¸‹è½½è¯¥Jsonæ–‡ä»¶ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/d9ab69b29a964a12df52512a7b128b5b.png" alt="img"></p><p>ç‚¹å‡»Homeä¸‹çš„Import Dashboard</p><p><img src="http://k8s.unixhot.com/kubernetes/media/53ffc0e739ca7b9421f9568ae4cbf117.png" alt="img"></p><p>ç„¶åç›´æ¥ä¸Šä¼ åˆšæ‰ä¸‹è½½çš„JSONæ–‡ä»¶ã€‚</p><p><img src="http://k8s.unixhot.com/kubernetes/media/500958891a82067b0c987d514239ffb0.png" alt="img"></p><p>å¯¼å…¥å®Œæ¯•åï¼Œå°±å¯ä»¥åœ¨Grafanaä¸ŠæŸ¥çœ‹å¯¹åº”èŠ‚ç‚¹çš„ç›‘æ§æ•°æ®å›¾è¡¨ã€‚ä½ å¯ä»¥é€šè¿‡é¼ æ ‡æ‹–æ‹½è¿›è¡Œå›¾è¡¨çš„è‡ªå®šä¹‰å¤§å°å’Œä½ç½®çš„ä¿®æ”¹ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="http://k8s.unixhot.com/kubernetes/media/698a6241faa0adc1af6c09cc369b259b.png" alt="img"></p><h1 id="ç¬¬ä¸ƒéƒ¨åˆ†-kubernetesé«˜çº§è¿›é˜¶" tabindex="-1">ç¬¬ä¸ƒéƒ¨åˆ† Kubernetesé«˜çº§è¿›é˜¶ <a aria-current="page" href="#ç¬¬ä¸ƒéƒ¨åˆ†-kubernetesé«˜çº§è¿›é˜¶" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="kubernetesçš„æƒé™æ§åˆ¶rbac" tabindex="-1">Kubernetesçš„æƒé™æ§åˆ¶RBAC <a aria-current="page" href="#kubernetesçš„æƒé™æ§åˆ¶rbac" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p><strong>è§’è‰²</strong></p><ul><li><p>Role: è§’è‰²ï¼Œå‘½åç©ºé—´èŒƒå›´å†…çš„ä¸€ä¸ªæƒé™é›†åˆã€‚</p></li><li><p>ClusterRoleï¼šé›†ç¾¤è§’è‰²ï¼Œé›†ç¾¤èŒƒå›´å†…çš„ä¸€ä¸ªæƒé™çš„é›†åˆï¼Œ</p><p>Roleå’ŒClusterROleåœ¨Kubernetesä¸­éƒ½è¢«å®šä¹‰ä¸ºé›†ç¾¤å†…éƒ¨çš„ API èµ„æºï¼Œå’Œæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„ Podã€ConfigMap è¿™äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯æˆ‘ä»¬é›†ç¾¤çš„èµ„æºå¯¹è±¡ï¼Œæ‰€ä»¥åŒæ ·çš„å¯ä»¥ä½¿ç”¨æˆ‘ä»¬å‰é¢çš„kubectlç›¸å…³çš„å‘½ä»¤æ¥è¿›è¡Œæ“ä½œ Subjectï¼šä¸»é¢˜ï¼Œå¯¹åº”åœ¨é›†ç¾¤ä¸­å°è¯•æ“ä½œçš„å¯¹è±¡ï¼Œé›†ç¾¤ä¸­å®šä¹‰äº†3ç§ç±»å‹çš„ä¸»é¢˜èµ„æºï¼š</p></li></ul><p>User Accountï¼šç”¨æˆ·ï¼Œè¿™æ˜¯æœ‰å¤–éƒ¨ç‹¬ç«‹æœåŠ¡è¿›è¡Œç®¡ç†çš„ï¼Œç®¡ç†å‘˜è¿›è¡Œç§é’¥çš„åˆ†é…ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ KeyStoneæˆ–è€… Goolge å¸å·ï¼Œç”šè‡³ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶åˆ—è¡¨ä¹Ÿå¯ä»¥ã€‚å¯¹äºç”¨æˆ·çš„ç®¡ç†é›†ç¾¤å†…éƒ¨æ²¡æœ‰ä¸€ä¸ªå…³è”çš„èµ„æºå¯¹è±¡ï¼Œæ‰€ä»¥ç”¨æˆ·ä¸èƒ½é€šè¿‡é›†ç¾¤å†…éƒ¨çš„ API æ¥è¿›è¡Œç®¡ç† Groupï¼šç»„ï¼Œè¿™æ˜¯ç”¨æ¥å…³è”å¤šä¸ªè´¦æˆ·çš„ï¼Œé›†ç¾¤ä¸­æœ‰ä¸€äº›é»˜è®¤åˆ›å»ºçš„ç»„ï¼Œæ¯”å¦‚cluster-admin Service Accountï¼šæœåŠ¡å¸å·ï¼Œé€šè¿‡Kubernetes API æ¥ç®¡ç†çš„ä¸€äº›ç”¨æˆ·å¸å·ï¼Œå’Œ namespace è¿›è¡Œå…³è”çš„ï¼Œé€‚ç”¨äºé›†ç¾¤å†…éƒ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œéœ€è¦é€šè¿‡ API æ¥å®Œæˆæƒé™è®¤è¯ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤å†…éƒ¨è¿›è¡Œæƒé™æ“ä½œï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä½¿ç”¨åˆ° ServiceAccountï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾çš„é‡ç‚¹ RoleBinding å’Œ ClusterRoleBindingï¼šè§’è‰²ç»‘å®šå’Œé›†ç¾¤è§’è‰²ç»‘å®šï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠå£°æ˜çš„ Subject å’Œæˆ‘ä»¬çš„ Role è¿›è¡Œç»‘å®šçš„è¿‡ç¨‹(ç»™æŸä¸ªç”¨æˆ·ç»‘å®šä¸Šæ“ä½œçš„æƒé™)ï¼ŒäºŒè€…çš„åŒºåˆ«ä¹Ÿæ˜¯ä½œç”¨èŒƒå›´çš„åŒºåˆ«ï¼šRoleBinding åªä¼šå½±å“åˆ°å½“å‰ namespace ä¸‹é¢çš„èµ„æºæ“ä½œæƒé™ï¼Œè€Œ ClusterRoleBinding ä¼šå½±å“åˆ°æ‰€æœ‰çš„ namespaceã€‚</p><p><strong>åˆ›å»ºç”¨æˆ·å‡­è¯</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl genrsa -out jenkins.key 2048</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl req -new -key jenkins.key -out jenkins.csr -subj "/CN=jenkins/O=vmware"</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# openssl x509 -req -in jenkins.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out jenkins.crt -days 365</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl config set-credentials jenkins --client-certificate=jenkins.crt  --client-key=jenkins.key</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl config set-context jenkins-context --cluster=kubernetes --namespace=jenkins --user=jenkins  </span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pods --context=jenkins-context</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>åˆ›å»ºè§’è‰²</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim jenkins-role.yml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Role</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins-role</span></span>
<span class="line"><span style="color:#a6accd">  namespace: jenkins</span></span>
<span class="line"><span style="color:#a6accd">rules:</span></span>
<span class="line"><span style="color:#a6accd">- apiGroups: ["", "extensions", "apps"]</span></span>
<span class="line"><span style="color:#a6accd">  resources: ["deployments", "replicasets", "pods"]</span></span>
<span class="line"><span style="color:#a6accd">  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>åˆ›å»ºè§’è‰²ç»‘å®š</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# vim jenkins-role-binding.yml</span></span>
<span class="line"><span style="color:#a6accd">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: RoleBinding</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins-rolebinding</span></span>
<span class="line"><span style="color:#a6accd">  namespace: jenkins</span></span>
<span class="line"><span style="color:#a6accd">subjects:</span></span>
<span class="line"><span style="color:#a6accd">- kind: User</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins</span></span>
<span class="line"><span style="color:#a6accd">  apiGroup: ""</span></span>
<span class="line"><span style="color:#a6accd">roleRef:</span></span>
<span class="line"><span style="color:#a6accd">  kind: Role</span></span>
<span class="line"><span style="color:#a6accd">  name: jenkins-role</span></span>
<span class="line"><span style="color:#a6accd">  apiGroup: ""</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="_22-æ·±å…¥ç†è§£podè°ƒåº¦" tabindex="-1">22 æ·±å…¥ç†è§£Podè°ƒåº¦ <a aria-current="page" href="#_22-æ·±å…¥ç†è§£podè°ƒåº¦" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h1 id="æ·±å…¥ç†è§£podè°ƒåº¦" tabindex="-1">æ·±å…¥ç†è§£Podè°ƒåº¦ <a aria-current="page" href="#æ·±å…¥ç†è§£podè°ƒåº¦" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨å‰é¢çš„ç« èŠ‚æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨Kubernetesä¸­ä½¿ç”¨kube-schedulerè¿›è¡ŒPodè°ƒåº¦ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å°†Podç»‘å®šåˆ°å¯¹åº”çš„Nodeä¸Šï¼Œç»è¿‡ä¸€ç³»åˆ—çš„æ¡ä»¶å’Œç®—æ³•å°½å¯èƒ½çš„è®©æ¯ä¸ªPodéƒ½æ»¡æ„ã€‚kube-scheduleræ˜¯Kubernetesé»˜è®¤çš„è°ƒåº¦å™¨ã€‚</p><p>kube-schedulerçš„ä»£ç ä½äº<a href="https://github.com/kubernetes/kubernetes/tree/master/pkg/scheduler" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->GitHub<!--]--></a></p><p>å¯ä»¥å°†ä»£ç å…‹éš†åˆ°æœ¬åœ°æ–¹ä¾¿æŸ¥çœ‹</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# git clone --depth 1 https://github.com/kubernetes/kubernetes.git</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨algorithmä¸‹æœ‰è°ƒåº¦ç®—æ³•ï¼Œè°ƒåº¦ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šPredicateså’Œprioritiesï¼Œé¦–å…ˆå¯¹Nodeè¿›è¡Œè¿‡æ»¤çœ‹å“ªäº›Nodeç¬¦åˆè°ƒåº¦è¦æ±‚ï¼Œç„¶ååœ¨ç¬¦åˆè°ƒåº¦è¦æ±‚çš„Nodeä¸Šè¿›è¡Œä¼˜å…ˆçº§è®¡ç®—ï¼Œåˆ¤æ–­è°ƒåº¦åˆ°å“ªä¸ªNodeæœ€åˆé€‚ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 algorithm]# pwd</span></span>
<span class="line"><span style="color:#a6accd">/root/kubernetes/pkg/scheduler/algorithm</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 algorithm]# ls -l</span></span>
<span class="line"><span style="color:#a6accd">total 20</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 1256 Dec 17 22:52 BUILD</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root  735 Dec 17 22:52 doc.go</span></span>
<span class="line"><span style="color:#a6accd">drwxr-xr-x 2 root root  276 Dec 17 22:52 predicates</span></span>
<span class="line"><span style="color:#a6accd">drwxr-xr-x 3 root root 4096 Dec 17 22:52 priorities</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 3278 Dec 17 22:52 scheduler_interface.go</span></span>
<span class="line"><span style="color:#a6accd">-rw-r--r-- 1 root root 3383 Dec 17 22:52 types.go</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å®˜æ–¹æ–‡æ¡£è¯¦ç»†çš„ä»‹ç»äº†æ‰€æœ‰çš„æ­¥éª¤ï¼š<a href="https://kubernetes.io/docs/concepts/scheduling/kube-scheduler/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://kubernetes.io/docs/concepts/scheduling/kube-scheduler/<!--]--></a></p><p><strong>è®¾ç½®è°ƒåº¦å™¨</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get pod kube-proxy-5wbtf -n kube-system -o yaml | grep schedulerName</span></span>
<span class="line"><span style="color:#a6accd">  schedulerName: default-scheduler</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="taintsï¼ˆæ±¡ç‚¹ï¼‰" tabindex="-1">Taintsï¼ˆæ±¡ç‚¹ï¼‰ <a aria-current="page" href="#taintsï¼ˆæ±¡ç‚¹ï¼‰" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe node linux-node1.unixhot.com | grep Taints</span></span>
<span class="line"><span style="color:#a6accd">Taints:             node-role.kubernetes.io/master:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Taintsçš„è¡¨ç°å½¢å¼ä¸º</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">&lt;key&gt;=&lt;value&gt;:&lt;effect&gt;</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>effectçš„ä¸‰ç§ç±»å‹ï¼š</p><ul><li>NoSchedule: å¦‚æœPodæ²¡æœ‰å®¹å¿è¯¥æ±¡ç‚¹ï¼Œä¸è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šã€‚</li><li>PreferNoScheduleï¼šå°½é‡é˜»æ­¢Podè¢«è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å…¶å®ƒèŠ‚ç‚¹èƒ½å¤Ÿè°ƒåº¦ï¼Œå¯ä»¥è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ã€‚</li><li>NoExecuteï¼š NoSchedulerå’ŒPreferNoScheduleåªæ˜¯åœ¨è°ƒåº¦é˜¶æ®µèµ·ä½œç”¨ï¼Œä½†æ˜¯NoExecuteä¼šå½±å“æ­£å¸¸è¿è¡Œçš„Podï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹è¢«æ‰“äº†NoExecuteçš„æ±¡ç‚¹ï¼Œè€Œè¿è¡Œåœ¨è¯¥èŠ‚ç‚¹çš„Podæ²¡æœ‰å®¹å¿ä¼šç›´æ¥è¢«è¿™ä¸ªèŠ‚ç‚¹ç§»é™¤ã€‚</li></ul><p>æŸ¥çœ‹Flannelä¸ºä½•èƒ½è°ƒåº¦åˆ°MasterèŠ‚ç‚¹</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl get po -n kube-system | grep flannel</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-f2jrk                       1/1     Running   2          22h</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-mh75v                       1/1     Running   2          22h</span></span>
<span class="line"><span style="color:#a6accd">kube-flannel-ds-amd64-n52zm                       1/1     Running   4          22h</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl describe pod kube-flannel-ds-amd64-f2jrk -n kube-system</span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd">Tolerations:     :NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/disk-pressure:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/memory-pressure:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/network-unavailable:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/not-ready:NoExecute</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/pid-pressure:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/unreachable:NoExecute</span></span>
<span class="line"><span style="color:#a6accd">                 node.kubernetes.io/unschedulable:NoSchedule</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="è‡ªå®šä¹‰æ±¡ç‚¹" tabindex="-1">è‡ªå®šä¹‰æ±¡ç‚¹ <a aria-current="page" href="#è‡ªå®šä¹‰æ±¡ç‚¹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@linux-node1 ~]# kubectl taint node linux-node2.example.com node-ytpe=gpu:NoSchedule       </span></span>
<span class="line"><span style="color:#a6accd">node/linux-node2.example.com tainted</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 example]# cat nginx-deployment-taint.yaml    </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: apps/v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Deployment</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  name: nginx-deployment</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    app: nginx</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  replicas: 3</span></span>
<span class="line"><span style="color:#a6accd">  selector:</span></span>
<span class="line"><span style="color:#a6accd">    matchLabels:</span></span>
<span class="line"><span style="color:#a6accd">      app: nginx</span></span>
<span class="line"><span style="color:#a6accd">  template:</span></span>
<span class="line"><span style="color:#a6accd">    metadata:</span></span>
<span class="line"><span style="color:#a6accd">      labels:</span></span>
<span class="line"><span style="color:#a6accd">        app: nginx</span></span>
<span class="line"><span style="color:#a6accd">    spec:</span></span>
<span class="line"><span style="color:#a6accd">      containers:</span></span>
<span class="line"><span style="color:#a6accd">      - name: nginx</span></span>
<span class="line"><span style="color:#a6accd">        image: nginx:1.13.12</span></span>
<span class="line"><span style="color:#a6accd">        ports:</span></span>
<span class="line"><span style="color:#a6accd">        - containerPort: 80</span></span>
<span class="line"><span style="color:#a6accd">      tolerations:</span></span>
<span class="line"><span style="color:#a6accd">      - key: node-type</span></span>
<span class="line"><span style="color:#a6accd">        operator: Equal</span></span>
<span class="line"><span style="color:#a6accd">        value: gpu</span></span>
<span class="line"><span style="color:#a6accd">        effect: Noschedule</span></span>
<span class="line"><span style="color:#a6accd">[root@linux-node1 example]# kubectl get po -o wide</span></span>
<span class="line"><span style="color:#a6accd">NAME                                READY   STATUS    RESTARTS   AGE     IP          NODE                      NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#a6accd">dns-test                            1/1     Running   1          6h15m   10.2.2.23   linux-node3.example.com   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">nginx-deployment-77564d4546-2jkw9   1/1     Running   0          13s     10.2.2.26   linux-node3.example.com   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">nginx-deployment-77564d4546-4hrbf   1/1     Running   0          13s     10.2.2.24   linux-node3.example.com   &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#a6accd">nginx-deployment-77564d4546-s2r4h   1/1     Running   0          13s     10.2.2.25   linux-node3.example</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="äº²ç¼˜æ€§è°ƒåº¦" tabindex="-1">äº²ç¼˜æ€§è°ƒåº¦ <a aria-current="page" href="#äº²ç¼˜æ€§è°ƒåº¦" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><h1 id="_23-kubernetes-apiä»‹ç»" tabindex="-1">23 Kubernetes APIä»‹ç» <a aria-current="page" href="#_23-kubernetes-apiä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl cluster-info</span></span>
<span class="line"><span style="color:#a6accd">Kubernetes master is running at https://192.168.56.11:6443</span></span>
<span class="line"><span style="color:#a6accd">KubeDNS is running at https://192.168.56.11:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç›´æ¥è®¿é—®Kubernetes APIéœ€è¦éªŒè¯ï¼Œæ— æ³•ç›´æ¥è®¿é—®ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# curl -k https://192.168.56.11:6443</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">  "kind": "Status",</span></span>
<span class="line"><span style="color:#a6accd">  "apiVersion": "v1",</span></span>
<span class="line"><span style="color:#a6accd">  "metadata": {</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">  },</span></span>
<span class="line"><span style="color:#a6accd">  "status": "Failure",</span></span>
<span class="line"><span style="color:#a6accd">  "message": "forbidden: User \"system:anonymous\" cannot get path \"/\"",</span></span>
<span class="line"><span style="color:#a6accd">  "reason": "Forbidden",</span></span>
<span class="line"><span style="color:#a6accd">  "details": {</span></span>
<span class="line"><span style="color:#a6accd"></span></span>
<span class="line"><span style="color:#a6accd">  },</span></span>
<span class="line"><span style="color:#a6accd">  "code": 403</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>é€šè¿‡Proxyè®¿é—®Kubernetes API</strong></p><p>ä½¿ç”¨kubectl proxyå¯ä»¥åœ¨Masteræœ¬åœ°å¯åŠ¨ä¸€ä¸ªä»£ç†</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl proxy</span></span>
<span class="line"><span style="color:#a6accd">Starting to serve on 127.0.0.1:8001</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥é€šè¿‡127.0.0.1:8001ä¸API Serverè¿›è¡Œäº¤äº’</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# curl http://127.0.0.1:8001</span></span>
<span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">  "paths": [</span></span>
<span class="line"><span style="color:#a6accd">    "/api",</span></span>
<span class="line"><span style="color:#a6accd">    "/api/v1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/admissionregistration.k8s.io",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/admissionregistration.k8s.io/v1beta1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiextensions.k8s.io",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiextensions.k8s.io/v1beta1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiregistration.k8s.io",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiregistration.k8s.io/v1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apiregistration.k8s.io/v1beta1",</span></span>
<span class="line"><span style="color:#a6accd">    "/apis/apps",</span></span>
<span class="line"><span style="color:#a6accd">...ï¼ˆçœç•¥å…¶å®ƒè¾“å‡ºï¼‰</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥é€šè¿‡ä¿®æ”¹ç›‘å¬åœ°å€ï¼Œå¹¶å…³é—­è¿‡æ»¤ï¼Œå®ç°åœ¨å…¶å®ƒåœ°æ–¹ç™»å½•å’ŒæŸ¥çœ‹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—®APIã€‚åˆ‡è®°ä¸è¦å†ç”Ÿäº§ç¯å¢ƒå°†ä»£ç†åœ°å€æš´éœ²åœ¨å¤–ç½‘ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl proxy --address=0.0.0.0 --disable-filter=true</span></span>
<span class="line"><span style="color:#a6accd">W1105 16:18:45.669591   16730 proxy.go:142] Request filter disabled, your proxy is vulnerable to XSRF attacks, please be cautious</span></span>
<span class="line"><span style="color:#a6accd">Starting to serve on [::]:8001</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h3 id="ä½¿ç”¨swagger-uiè¿›è¡Œapiäº¤äº’" tabindex="-1">ä½¿ç”¨Swagger UIè¿›è¡ŒAPIäº¤äº’ <a aria-current="page" href="#ä½¿ç”¨swagger-uiè¿›è¡Œapiäº¤äº’" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h3><p>Kubernetesæ”¯æŒSwagger UIè®¿é—®APIï¼Œéœ€è¦åœ¨API Serverå¼€å¯ï¼Œå¦‚æœå·²ç»æ ¹æ®æœ¬ä¹¦ä½¿ç”¨kubeadméƒ¨ç½²çš„é›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹Podçš„YAMLæ–‡ä»¶ï¼Œé‡å»ºPodæ¥å¼€å¯</p><p><strong>ä¿®æ”¹API Serverçš„Podå®šä¹‰æ–‡ä»¶</strong></p><p>åœ¨- kube-apiserverä¸‹é¢ä¸€è¡Œå¢åŠ --enable-swagger-ui=true</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# vim /etc/kubernetes/manifests/kube-apiserver.yaml </span></span>
<span class="line"><span style="color:#a6accd">apiVersion: v1</span></span>
<span class="line"><span style="color:#a6accd">kind: Pod</span></span>
<span class="line"><span style="color:#a6accd">metadata:</span></span>
<span class="line"><span style="color:#a6accd">  creationTimestamp: null</span></span>
<span class="line"><span style="color:#a6accd">  labels:</span></span>
<span class="line"><span style="color:#a6accd">    component: kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">    tier: control-plane</span></span>
<span class="line"><span style="color:#a6accd">  name: kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">  namespace: kube-system</span></span>
<span class="line"><span style="color:#a6accd">spec:</span></span>
<span class="line"><span style="color:#a6accd">  containers:</span></span>
<span class="line"><span style="color:#a6accd">  - command:</span></span>
<span class="line"><span style="color:#a6accd">    - kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">    - --enable-swagger-ui=true</span></span>
<span class="line"><span style="color:#a6accd">    - --advertise-address=192.168.56.11</span></span>
<span class="line"><span style="color:#a6accd">    - --allow-privileged=true</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ é™¤Podï¼Œkubeletä¼šé€šè¿‡è¯¥YAMLé‡å»ºPod</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get pod -n kube-system | grep api</span></span>
<span class="line"><span style="color:#a6accd">kube-apiserver-linux-node1.unixhot.com            1/1     Running   0          55m</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl delete pod kube-apiserver-linux-node1.unixhot.com -n kube-system</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°é…ç½®å·²ç»ç”Ÿæ•ˆ</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl describe pod kube-apiserver-linux-node1.unixhot.com -n kube-system </span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd">    Command:</span></span>
<span class="line"><span style="color:#a6accd">      kube-apiserver</span></span>
<span class="line"><span style="color:#a6accd">      --enable-swagger-ui=true</span></span>
<span class="line"><span style="color:#a6accd">      --advertise-address=192.168.99.27</span></span>
<span class="line"><span style="color:#a6accd">....</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>éƒ¨ç½²ä¸€ä¸ªSwagger UIæœåŠ¡æŸ¥çœ‹API</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl run swagger-ui --image=swaggerapi/swagger-ui:latest</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl expose deployment swagger-ui --port=8080 --type=NodePort</span></span>
<span class="line"><span style="color:#a6accd">[root@k8s-master1 ~]# kubectl get service</span></span>
<span class="line"><span style="color:#a6accd">NAME         TYPE        CLUSTER-IP    EXTERNAL-IP     PORT(S)          AGE</span></span>
<span class="line"><span style="color:#a6accd">kubernetes   ClusterIP   10.1.0.1      &lt;none&gt;          443/TCP          43d</span></span>
<span class="line"><span style="color:#a6accd">swagger-ui   NodePort    10.1.205.94   &lt;none&gt;   8080:30410/TCP   34s</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å› ä¸ºæˆ‘ä»¬éƒ¨ç½²çš„Swagger UIå’ŒAPI Serverä¸åœ¨ä¸€ä¸ªåŸŸåä¸‹ï¼Œæ‰€ä»¥ä¼šæœ‰è·¨åŸŸçš„é—®é¢˜ï¼ŒChromeæµè§ˆå™¨éœ€è¦æå‰å®‰è£…Allow CROSæ’ä»¶è§£å†³</p><hr><hr><p>æ‘˜å½•è‡ªèµµç­é•¿--------</p><!--]--><!--[--><!--]--><!--]--><div text="center"><!----></div><!----></article><!--]--><!--[--><!--[--><!--[--><div class="yun-sponsor-container flex justify-center items-center flex-col" m="t-6"><button class="sponsor-button yun-icon-btn shadow hover:shadow-md" title="Donate" text="red-400"><div i-ri-heart-line=""></div></button><div m="y-4" class="qrcode-container qrcode flex justify-around"><!--[--><!--]--></div></div><ul class="post-copyright" m="y-4"><li class="post-copyright-author"><strong>Post author: </strong><span>VALAXY Developer</span></li><li class="post-copyright-link"><strong>Post link: </strong><a href="false/posts/docker+k8s%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97">false/posts/docker+k8s%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong><span>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 ">CC BY-NC-SA</a> unless otherwise stated.</span></li></ul><!--]--><!--]--><!--]--></div><!--]--><!----></div><!--[--><!--]--><!--[--><div class="post-nav"><div class="post-nav-item"><a href="/posts/k8s(kubernetes)%E5%AE%9E%E8%B7%B5%E8%AE%A4%E7%9F%A5" class="post-nav-prev" title="K8S(kubernetes)å®è·µè®¤çŸ¥"><div class="icon" i-ri-arrow-left-s-line=""></div><span class="title truncate" text="sm">K8S(kubernetes)å®è·µè®¤çŸ¥</span></a></div><div class="post-nav-item"><a href="/posts/linux%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96" class="post-nav-next" title="Linuxç¯å¢ƒåˆå§‹åŒ–"><span class="title truncate" text="sm">Linuxç¯å¢ƒåˆå§‹åŒ–</span><div class="icon" i-ri-arrow-right-s-line=""></div></a></div></div><!--]--><!--[--><!--]--><!----><!--[--><!--]--><footer class="va-footer p-4 text-$va-c-text-light" text="center sm"><div class="beian" m="y-2"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">è±«ICPå¤‡20001100å·-3</a></div><div class="copyright flex justify-center items-center gap-2" p="1"><span>Â©<!--[--> 2016 -<!--]--> 2023</span><a class="inline-flex animate-pulse" href="https://sponsors.yunyoujun.cn" target="_blank" title="Sponsor YunYouJun"><div class="i-ri-cloud-line"></div></a><span>VALAXY Developer</span></div><div class="powered" m="2"><span>Powered by <a href="https://github.com/YunYouJun/valaxy" target="_blank" rel="noopener">Valaxy</a> v0.14.0</span> | <span>Theme - <a href="https://github.com/YunYouJun/valaxy/tree/main/packages/valaxy-theme-yun" title="valaxy-theme-yun" target="_blank">Yun</a> v0.14.0</span></div><!--[--> ç”± <a href="https://www.netdun.net" target="_blank" title="ç½‘ç›¾æ˜Ÿçƒ">ç½‘ç›¾æ˜Ÿçƒ</a> æä¾› CDN æ”¯æŒ<!--]--></footer><!--[--><!--]--></div><!--]--><!--[--><!--[--><button class="xl:hidden toc-btn shadow fixed yun-icon-btn z-350" opacity="75" right="2" bottom="19"><div i-ri-file-list-line=""></div></button><!----><!--  --><aside class="va-card aside" m="l-4" text="center"><div class="aside-container" flex="~ col" overflow="auto"><h2 m="t-6 b-2" font="serif black">Table of Contents</h2><div style="display:none" data-v-f0c1ef64=""><div class="content" data-v-f0c1ef64=""><div class="outline-title" data-v-f0c1ef64="">On this page</div><div class="outline-marker" data-v-f0c1ef64=""></div><nav aria-labelledby="doc-outline-aria-label" data-v-f0c1ef64=""><span id="doc-outline-aria-label" class="visually-hidden" data-v-f0c1ef64="">Table of Contents for current page</span><ul class="root va-toc relative z-1" data-v-f0c1ef64="" data-v-df39fddf=""><!--[--><!--]--></ul></nav></div></div><div class="flex-grow"></div><div class="custom-container"><!--[--><!--]--></div></div></aside><!--]--><!--]--></div></main><a href="#" class="back-to-top yun-icon-btn"><div w="8" h="8" i-ri-arrow-up-s-line=""></div><svg class="progress-circle-container" viewBox="0 0 100 100"><circle stroke-dasharray="301.59289474462014 301.59289474462014" stroke-dashoffset="301.59289474462014" class="progress-circle" cx="50" cy="50" r="48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></circle></svg></a><!--]--><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"app":{"isSidebarOpen":false,"isRightSidebarOpen":false},"site":{}}}'</script><link rel="stylesheet" href="/assets/post-1d1be697.css"><link rel="stylesheet" href="/assets/index-4070d21c.css"><link rel="stylesheet" href="/assets/ValaxyMain-5904cb61.css"></body></html>