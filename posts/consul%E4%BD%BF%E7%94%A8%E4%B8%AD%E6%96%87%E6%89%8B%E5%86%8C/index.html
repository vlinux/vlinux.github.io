<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg"><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script>!function(){var e=localStorage.getItem("valaxy-locale")||"en";document.documentElement.setAttribute("lang",e)}()</script><script type="module" async="" crossorigin="" src="/assets/app-c05f80d3.js"></script><style>@charset "UTF-8";.back-to-top{position:fixed;right:-1.5rem;bottom:1rem;z-index:var(--yun-z-go-up-btn);opacity:0;pointer-events:none;color:var(--va-c-primary);transform:translate(0) rotate(270deg);transition:transform var(--va-transition-duration),opacity var(--va-transition-duration-fast)!important}.progress-circle{transition:.3s stroke-dashoffset;transform:rotate(-90deg);transform-origin:50% 50%}.progress-circle-container{position:absolute}.menu-btn{display:inline-flex;position:fixed;left:.8rem;top:.6rem;line-height:1;z-index:var(--yun-z-menu-btn);cursor:pointer}.sidebar .links{display:flex;justify-content:center}.sidebar .link-item{display:inline-flex}.sidebar .link-item .icon{width:2rem;height:2rem}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.site-nav{display:flex;justify-content:center;overflow:hidden;line-height:1.5;white-space:nowrap;text-align:center;margin-top:1rem}.site-link-item{display:flex;padding:0 15px;align-items:center;border-left:1px solid var(--va-c-gray);flex-direction:column;color:var(--va-c-text)}.site-link-item:first-child,.site-link-item:last-child{line-height:1;padding:0}.site-link-item:first-child{border-left:none;border-right:1px solid var(--va-c-gray)}.site-link-item:last-child{border-left:1px solid var(--va-c-gray)}.site-link-item:nth-child(2){border:none}.site-link-item .count{color:var(--va-c-text);font-family:var(--va-font-sans);display:block;text-align:center;font-size:1rem}.site-link-item .icon{width:1.5rem;height:1.5rem}.site-link-item .icon:hover{color:var(--va-c-primary-light)}.sidebar-panel{padding:.5rem}.site-author-avatar{display:inline-block;line-height:0;position:relative}.site-author-avatar img{height:96px;width:96px;max-width:100%;margin:0;padding:4px;background-color:#fff;box-shadow:0 0 10px #0003;transition:.4s}.site-author-avatar img:hover{box-shadow:0 0 30px rgba(var(--va-c-primary-rgb),.2)}.site-author-name{margin-top:0;margin-bottom:1rem;line-height:1.5}.site-author-status{position:absolute;height:1.8rem;width:1.8rem;bottom:0;right:0;line-height:1.8rem;border-radius:50%;box-shadow:0 1px 2px #0003;background-color:var(--va-c-bg-light);border:1px solid rgba(255,255,255,.1)}.site-name{color:var(--va-c-text);font-family:var(--va-font-serif);font-weight:900}.site-subtitle{color:var(--va-c-gray);display:block}.site-description{color:var(--va-c-text);font-size:.8rem}.va-bg{position:fixed;width:100%;height:100%;z-index:-1;background-image:var(--va-bg-img);background-size:cover;background-position:center;background-repeat:no-repeat;background-attachment:fixed;animation-name:bgFadeIn;animation-duration:2s;opacity:var(--va-bg-img-opacity,1)}@supports (-webkit-touch-callout:none){.va-bg{background-attachment:scroll}}@keyframes bgFadeIn{0%{opacity:0}to{opacity:var(--va-bg-img-opacity,1)}}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}h1,h2,h4{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}button{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=button],button{-webkit-appearance:button;background-color:transparent;background-image:none}h1,h2,h4,hr,p,pre{margin:0}ul{list-style:none;margin:0;padding:0}button{cursor:pointer}img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}body{counter-reset:katexEqnNo mmlEqnNo}html{-webkit-tap-highlight-color:transparent}a{color:var(--va-c-link);font-weight:500}*{outline:0}hr{opacity:.2;margin:1rem}.va-card{background-color:var(--va-c-bg-light)}.inline-flex-center{display:inline-flex;justify-content:center;align-items:center}#app,body,html{margin:0;padding:0;line-height:2}body{background-color:var(--va-c-bg)}a{cursor:pointer}@media screen and (max-width:640px){.markdown-body div[class*=language-]{margin:0 var(--va-code-mobile-margin-x,-1rem)}}@media (min-width:640px){.markdown-body div[class*=language-]{border-radius:6px;margin:16px 0}}.markdown-body code{font-size:.85em}.markdown-body div[class*=language-]{position:relative;background-color:var(--va-code-block-bg);overflow-x:auto}.markdown-body div[class*=language-] code{padding:0 24px;line-height:var(--va-code-line-height);font-size:var(--va-code-font-size);color:var(--va-code-block-color);transition:color .5s;width:fit-content;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}.markdown-body div[class*=language-] pre{position:relative;z-index:1;margin:0;padding:1rem 0;background:0 0;overflow-x:auto}.markdown-body div[class*=language-] pre code{display:block}.markdown-body [class*=language-]>span.copy{position:absolute;top:8px;right:8px;z-index:2;display:block;justify-content:center;align-items:center;border-radius:4px;width:40px;height:40px;background-color:var(--va-code-block-bg);opacity:0;cursor:pointer;background-image:var(--va-icon-copy);background-position:50%;background-size:20px;background-repeat:no-repeat;transition:opacity .25s}.markdown-body [class*=language-]:hover>span.copy{opacity:1}.markdown-body [class*=language-]>span.copy:hover{background-color:var(--va-code-copy-code-hover-bg)}.markdown-body [class*=language-]:before{position:absolute;top:6px;right:12px;z-index:2;font-size:12px;font-weight:500;color:var(--va-c-text-dark-3);transition:color .5s,opacity .5s}.markdown-body [class*=language-]:hover:before{opacity:0}:root{--va-c-text-warning:#544500}.vt-hamburger{display:flex;justify-content:center;align-items:center}.vt-hamburger:hover .vt-hamburger-top{transform:translate(-5.5px)}.vt-hamburger:hover .vt-hamburger-middle{transform:translate(0)}.vt-hamburger:hover .vt-hamburger-bottom{transform:translate(-11px)}.vt-hamburger-container{position:relative;width:22px;height:20px;overflow:hidden}.vt-hamburger-bottom,.vt-hamburger-middle,.vt-hamburger-top{left:0;position:absolute;width:22px;height:2px;background-color:var(--va-c-primary);transition:top .25s,background-color .5s,transform .25s}.vt-hamburger-top{top:0;transform:translate(0)}.vt-hamburger-middle{top:9px;transform:translate(-11px)}.vt-hamburger-bottom{top:18px;transform:translate(-5.5px)}.sidebar{position:fixed;overflow-y:auto;top:0;bottom:0;left:0;width:calc(100vw - 64px);max-width:var(--va-sidebar-width);background-image:var(--yun-sidebar-bg-img);background-color:var(--yun-sidebar-bg-color);background-size:contain;background-repeat:no-repeat;background-position:bottom 1rem center;text-align:center;z-index:var(--yun-z-sidebar);transform:translate(-100%);transition:box-shadow var(--va-transition-duration),background-color var(--va-transition-duration),opacity .25s,transform var(--va-transition-duration) cubic-bezier(.19,1,.22,1)!important}h1:focus .header-anchor,h1:hover .header-anchor,h2:focus .header-anchor,h2:hover .header-anchor{visibility:visible;opacity:1}a.header-anchor{float:left;margin-top:.125em;margin-left:-.87em;padding-right:.23em;font-size:.85em;visibility:hidden;opacity:0;transition:opacity var(--va-transition-duration)}a.header-anchor:before{content:none}a.header-anchor:focus,a.header-anchor:hover{text-decoration:none}:root{--va-aside-width:256px;--va-sidebar-width:300px;--va-border-width:1px;--va-font-serif:"Noto Serif SC",STZhongsong,Roboto,serif;--va-font-sans:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;--va-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace;--va-transition-duration-fast:.2s;--va-transition-duration:.4s;--va-transition-duration-slow:.6s;--va-transition:all var(--va-transition-duration-fast) ease-in-out}:root{--va-c-white:#ffffff;--va-c-black:#1a1a1a;--va-c-gray:#8e8e8e;--va-c-danger:#db2828;--va-c-warning:#f2711c;--va-c-text-light-1:#213547;--va-c-text-light-2:rgba(60, 60, 60, .7);--va-c-text-light-3:rgba(60, 60, 60, .33);--va-c-text-light-4:rgba(60, 60, 60, .18);--va-c-text-dark-1:rgba(255, 255, 255, .87);--va-c-text-dark-2:rgba(235, 235, 235, .6);--va-c-text-dark-3:rgba(235, 235, 235, .38);--va-c-text-dark-4:rgba(235, 235, 235, .18);--va-c-primary-light:#359eff;--va-c-primary-lighter:#81c2ff;--va-c-primary-dark:#006bce;--va-c-primary:#0078E7}:root{color-scheme:light;--va-c-brand:#0078E7;--va-border-color:#222;--va-c-bg:white;--va-c-bg-light:white;--va-c-bg-dark:#fafafa;--va-c-bg-opacity:rgba(255, 255, 255, .8);--va-c-bg-soft:#f9f9f9;--va-c-bg-alt:#f9f9f9;--va-c-bg-mute:#f1f1f1;--va-c-text:#333;--va-c-text-light:#555;--va-c-text-lighter:#666;--va-c-text-dark:#111;--va-c-primary-rgb:0,120,231;--va-c-link:var(--va-c-primary-dark);--va-c-divider:rgba(60, 60, 60, .2)}:root{--va-code-line-height:1.7;--va-code-font-size:.875em;--va-code-block-color:var(--va-c-text-dark-1);--va-code-block-bg:#282c34;--va-code-line-highlight-color:rgba(0, 0, 0, .5);--va-code-line-number-color:var(--va-c-text-dark-3);--va-code-copy-code-hover-bg:rgba(255, 255, 255, .05);--va-code-copy-code-active-text:var(--va-c-text-dark-2)}:root{--va-icon-copy:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2'/%3E%3C/svg%3E");--va-icon-copied:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2m-6 9 2 2 4-4'/%3E%3C/svg%3E")}.post-title{display:flex;justify-content:center;align-items:center}.post-tag{white-space:nowrap;color:var(--yun-tag-color)}.post-tag:hover{color:var(--va-c-primary)}.yun-main{padding-left:var(--va-sidebar-width);transition:padding-left var(--va-transition-duration);box-sizing:border-box}.yun-icon-btn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border:none;width:3rem;height:3rem;border-radius:50%;transition:background-color var(--va-transition-duration)}.yun-icon-btn div{font-size:1.2rem}.yun-icon-btn:hover{background-color:rgba(var(--va-c-primary-rgb),.08)}.yun-icon-btn:active{background-color:rgba(var(--va-c-primary-rgb),.16)}:root{--smc-font-sans:Raleway,-apple-system,"PingFang SC","Microsoft YaHei",Arial,sans-serif;--smc-font-serif:"Songti SC","Noto Serif SC",STZhongsong,STKaiti,KaiTi,Roboto,serif;--smc-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace}:root{--smc-c-primary-light:#4eaaff;--smc-c-primary-lighter:#9bcfff;--smc-c-primary:#0078E7;--smc-theme-name:yun;--smc-line-height:1.8;--smc-c-primary-rgb:0,120,231;--smc-c-text:#24292e;--smc-c-text-light:#555;--smc-c-text-lighter:#666;--smc-header-bottom-color:#eaecef;--smc-border-color:var(--smc-c-primary-light);--smc-code-bg-color:#f6f8fa;--smc-link-color:#005eb4}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--smc-bg-color);color:var(--smc-c-text);font-family:var(--smc-font-sans);font-size:1rem;line-height:var(--smc-line-height);overflow-wrap:break-word}.markdown-body *{box-sizing:border-box}.markdown-body a{background-color:transparent}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body code,.markdown-body pre{font-family:Source Code Pro,Consolas,Monaco,SFMono-Regular,Ubuntu Mono,Menlo,monospace}.markdown-body code{padding:3px 6px;font-size:.85rem;color:var(--smc-c-text-light);background:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre{margin-top:0;margin-bottom:0;overflow-wrap:normal;padding:1rem;overflow:auto;background-color:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre>code{font-size:.85rem;white-space:pre}.markdown-body pre code{display:block;padding:0;margin:0;overflow:visible;line-height:inherit;word-break:normal;background-color:transparent;border:0}.markdown-body img{display:block;margin:1rem auto;max-width:92%;max-height:600px;border-radius:.2rem;transition:.4s;--tw-shadow:0 1px 3px 0 rgb(0 0 0/.1),0 1px 2px -1px rgb(0 0 0/.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color);-webkit-box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow);box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.markdown-body img:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0/.1),0 2px 4px -2px rgb(0 0 0/.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.markdown-body img:before{content:"\300c  LOADING ERROR \300d"}@media screen and (min-width:1600px){.markdown-body img{max-width:800px}}.markdown-body a{color:var(--smc-c-primary);text-decoration:none;border-bottom-color:transparent;transition:all .2s ease-in-out}.markdown-body a:hover{color:var(--smc-link-color);border-bottom:1px solid var(--smc-link-color)}.markdown-body ul{padding-left:2em}.markdown-body li{overflow-wrap:break-all;margin-top:.25em}.markdown-body strong{font-family:var(--smc-font-serif);font-weight:900}.markdown-body p{margin-top:1rem;margin-bottom:1rem;overflow-x:auto;overflow-y:hidden}.markdown-body h1,.markdown-body h2{margin-top:1.5rem;margin-bottom:1rem;font-weight:300;line-height:1.5}.markdown-body h1{font-size:2.5rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h2{font-size:2.2rem;border-bottom:1px solid var(--smc-header-bottom-color)}@media screen and (max-width:768px){.markdown-body h1{font-size:2rem}.markdown-body h2{font-size:1.8rem}}.markdown-body{--smc-font-family:var(--va-font-sans);--c-toc-link:var(--va-c-text-light)}.markdown-body{word-wrap:break-word}.markdown-body h1,.markdown-body h2{font-family:var(--va-font-serif);font-weight:900}.markdown-body ul{list-style:initial}.markdown-body img{margin:auto}.markdown-body p{overflow:unset}:root{--yun-post-card-max-width:900px;--yun-c-cloud:white;--yun-z-toc-btn:7;--yun-z-cloud:7;--yun-z-go-down:9;--yun-z-backdrop:9;--yun-z-sidebar:10;--yun-z-fireworks:11;--yun-z-menu-btn:20;--yun-z-go-up-btn:20;--yun-z-search-popup:30;--yun-z-search-btn:31;--va-z-overlay:var(--yun-z-backdrop)}:root{--yun-bg-img:url(https://cdn.yunyoujun.cn/img/bg/stars-timing-0-blur-30px.jpg);--yun-sidebar-bg-color:var(--va-c-bg-light);--yun-sidebar-bg-img:url(https://cdn.yunyoujun.cn/img/bg/alpha-stars-timing-1.webp)}*,::after,::before{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-scroll-snap-strictness:proximity;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow:0 0 rgba(0,0,0,0);--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,0.5)}[i-ri-archive-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M3 10H2V4.003C2 3.449 2.455 3 2.992 3h18.016A.99.99 0 0 1 22 4.003V10h-1v10.001a.996.996 0 0 1-.993.999H3.993A.996.996 0 0 1 3 20.001V10zm16 0H5v9h14v-9zM4 5v3h16V5H4zm5 7h6v2H9v-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-left-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m10.828 12l4.95 4.95l-1.414 1.414L8 12l6.364-6.364l1.414 1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-right-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m13.172 12l-4.95-4.95l1.414-1.414L16 12l-6.364 6.364l-1.414-1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-arrow-up-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m12 10.828l-4.95 4.95l-1.414-1.414L12 8l6.364 6.364l-1.414 1.414z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-calendar-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M17 3h4a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h4V1h2v2h6V1h2v2zm-2 2H9v2H7V5H4v4h16V5h-3v2h-2V5zm5 6H4v8h16v-8z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-clipboard-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M7 4V2h10v2h3.007c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 21.007V4.993C3 4.445 3.445 4 3.993 4H7zm0 2H5v14h14V6h-2v2H7V6zm2-2v2h6V4H9z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-cloud-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M17 21H7A6 6 0 0 1 5.008 9.339a7 7 0 1 1 13.984 0A6 6 0 0 1 17 21zm0-12a5 5 0 1 0-9.994.243l.07 1.488l-1.404.494A4.002 4.002 0 0 0 7 19h10a4 4 0 1 0-3.796-5.265l-1.898-.633A6.003 6.003 0 0 1 17 9z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-file-list-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1zm-1-2V4H5v16h14zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h8v2H8v-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-folder-2-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.414 5H21a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414l2 2zM20 11H4v8h16v-8zm0-2V7h-8.414l-2-2H4v4h16z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-genderless-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M13 7.066A7.501 7.501 0 0 1 12 22a7.5 7.5 0 0 1-1-14.934V1h2v6.066zM12 20a5.5 5.5 0 1 0 0-11a5.5 5.5 0 0 0 0 11z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-heart-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.001 4.529a5.998 5.998 0 0 1 8.242.228a6 6 0 0 1 .236 8.236l-8.48 8.492l-8.478-8.492a6 6 0 0 1 8.48-8.464zm6.826 1.641a3.998 3.998 0 0 0-5.49-.153l-1.335 1.198l-1.336-1.197a3.999 3.999 0 0 0-5.494.154a4 4 0 0 0-.192 5.451L12 18.654l7.02-7.03a4 4 0 0 0-.193-5.454z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-home-4-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M19 21H5a1 1 0 0 1-1-1v-9H1l10.327-9.388a1 1 0 0 1 1.346 0L23 11h-3v9a1 1 0 0 1-1 1zm-6-2h5V9.157l-6-5.454l-6 5.454V19h5v-6h2v6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-money-cny-circle-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16zm1-7h3v2h-3v2h-2v-2H8v-2h3v-1H8v-2h2.586L8.464 7.879L9.88 6.464L12 8.586l2.121-2.122l1.415 1.415L13.414 10H16v2h-3v1z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-price-tag-3-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m10.9 2.1l9.899 1.415l1.414 9.9l-9.192 9.192a1 1 0 0 1-1.414 0l-9.9-9.9a1 1 0 0 1 0-1.414L10.9 2.1zm.707 2.122L3.828 12l8.486 8.485l7.778-7.778l-1.06-7.425l-7.425-1.06zm2.12 6.364a2 2 0 1 1 2.83-2.829a2 2 0 0 1-2.83 2.829z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ri-translate=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M5 15v2a2 2 0 0 0 1.85 1.995L7 19h3v2H7a4 4 0 0 1-4-4v-2h2zm13-5l4.4 11h-2.155l-1.201-3h-4.09l-1.199 3h-2.154L16 10h2zm-1 2.885L15.753 16h2.492L17 12.885zM8 2v2h4v7H8v3H6v-3H2V4h4V2h2zm9 1a4 4 0 0 1 4 4v2h-2V7a2 2 0 0 0-2-2h-3V3h3zM6 6H4v3h2V6zm4 0H8v3h2V6z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.i-ri-women-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M11 15.934A7.501 7.501 0 0 1 12 1a7.5 7.5 0 0 1 1 14.934V18h5v2h-5v4h-2v-4H6v-2h5v-2.066zM12 14a5.5 5.5 0 1 0 0-11a5.5 5.5 0 0 0 0 11z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i~=ri-sun-line]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.yun-card{margin:auto;--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow);transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms;transition-duration:var(--va-transition-duration)}.va-card{--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.va-card:hover,.yun-card:hover{--un-shadow:var(--un-shadow-inset) 0 10px 15px -3px var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 4px 6px -4px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}@media (max-width:767.9px){.yun-main{padding-left:0}}.fixed{position:fixed}.relative{position:relative}[bottom~="\31 9"]{bottom:4.75rem}[right~="\32 "]{right:.5rem}.z-1{z-index:1}.z-350{z-index:350}[m~="\30 "]{margin:0}[m~="\32 "]{margin:.5rem}[m~=y-4]{margin-top:1rem;margin-bottom:1rem}.my-1{margin-top:.25rem;margin-bottom:.25rem}[m~=x-1]{margin-left:.25rem;margin-right:.25rem}[mx~="\32 "]{margin-left:.5rem;margin-right:.5rem}[m~=y-2]{margin-top:.5rem;margin-bottom:.5rem}[m~=l-1]{margin-left:.25rem}[m~=t-4]{margin-top:1rem}[mt-6=""],[m~=t-6]{margin-top:1.5rem}[m~=b-2]{margin-bottom:.5rem}[m~=l-4]{margin-left:1rem}[m~=r-1]{margin-right:.25rem}.block{display:block}.inline-block{display:inline-block}[h~="\38 "]{height:2rem}[w~="\38 "]{width:2rem}[w~=full]{width:100%}.flex,[flex~="\~"]{display:flex}.inline-flex{display:inline-flex}.flex-grow,[flex~=grow]{flex-grow:1}.flex-col,[flex~=col]{flex-direction:column}.rotate-y-180{--un-rotate:0;--un-rotate-y:180deg;transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}.transform{transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}.items-center{align-items:center}.justify-center{justify-content:center}.justify-around{justify-content:space-around}.gap-2{grid-gap:.5rem;gap:.5rem}[overflow~=auto]{overflow:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded-full{border-radius:9999px}[fill~=none]{fill:none}[stroke-width~="\32 "]{stroke-width:2px}.p-4{padding:1rem}[p~="\31 "]{padding:.25rem}[p~="\32 "]{padding:.5rem}[p~=x-4]{padding-left:1rem;padding-right:1rem}[py~="\31 "]{padding-top:.25rem;padding-bottom:.25rem}[p~=b-8]{padding-bottom:2rem}[p~=l-4]{padding-left:1rem}[text~=center]{text-align:center}[text~="\32 xl"]{font-size:1.5rem;line-height:2rem}[text-xl=""]{font-size:1.25rem;line-height:1.75rem}[text~=xs]{font-size:.75rem;line-height:1rem}[text~=sm]{font-size:.875rem;line-height:1.25rem}[font~=black]{font-weight:900}.text-\$va-c-text-light{color:var(--va-c-text-light)}[text~=red-400]{--un-text-opacity:1;color:rgba(248,113,113,var(--un-text-opacity))}[opacity~="\37 5"]{opacity:.75}.hover\:shadow-md:hover{--un-shadow:var(--un-shadow-inset) 0 4px 6px -1px var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 2px 4px -2px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.shadow{--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,0.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,0.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms}[font~=serif]{font-family:var(--va-font-serif)}@media (max-width:767.9px){.lt-md\:ml-0{margin-left:0}[p~="lt-md\:0"]{padding:0}}@media (min-width:640px){.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}}@media (min-width:768px){.md\:hidden{display:none}.md\:translate-x-0{--un-translate-x:0rem;transform:translateX(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotateZ(var(--un-rotate-z)) skewX(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z))}}@media (min-width:1024px){.lg\:px-12{padding-left:3rem;padding-right:3rem}}@media (min-width:1280px){.xl\:hidden{display:none}.xl\:px-16{padding-left:4rem;padding-right:4rem}}.post-copyright{font-size:.9rem;padding:.5rem 1rem;border-left:4px solid #ff5252;background-color:var(--va-c-bg-dark);list-style:none;word-break:break-all;position:relative;overflow:hidden}.post-copyright:after{pointer-events:none;position:absolute;color:#fff;background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'%3E%3Cpath fill='gray' d='M245.8 214.9l-33.2 17.3c-9.4-19.6-25.2-20-27.4-20-22.2 0-33.3 14.6-33.3 43.9 0 23.5 9.2 43.8 33.3 43.8 14.4 0 24.6-7 30.5-21.3l30.6 15.5a73.2 73.2 0 01-65.1 39c-22.6 0-74-10.3-74-77 0-58.7 43-77 72.6-77 30.8-.1 52.7 11.9 66 35.8zm143 0l-32.7 17.3c-9.5-19.8-25.7-20-27.9-20-22.1 0-33.2 14.6-33.2 43.9 0 23.5 9.2 43.8 33.2 43.8 14.5 0 24.7-7 30.5-21.3l31 15.5c-2 3.8-21.3 39-65 39-22.7 0-74-9.9-74-77 0-58.7 43-77 72.6-77C354 179 376 191 389 214.8zM247.7 8C104.7 8 0 123 0 256c0 138.4 113.6 248 247.6 248C377.5 504 496 403 496 256 496 118 389.4 8 247.6 8zm.8 450.8c-112.5 0-203.7-93-203.7-202.8 0-105.5 85.5-203.3 203.8-203.3A201.7 201.7 0 01451.3 256c0 121.7-99.7 202.9-202.9 202.9z'/%3E%3C/svg%3E");content:" ";height:10rem;width:10rem;right:-2rem;top:-2rem;opacity:.1}.sponsor-button{background-color:#ffffff1a}.sponsor-button div{transform:scale(1.1);transition:transform var(--va-transition-duration) ease-in-out}.sponsor-button:hover{background-color:#ffffffe6}.sponsor-button:hover div{transform:scale(1.2)}.qrcode-container{overflow:hidden;height:0;transition:height var(--va-transition-duration) ease-in-out}.va-toc[data-v-f0c1ef64]{text-align:left}.content[data-v-f0c1ef64]{position:relative;padding-left:16px;font-size:14px;text-align:left}.outline-marker[data-v-f0c1ef64]{position:absolute;top:32px;left:-2px;z-index:0;opacity:0;width:4px;height:18px;background-color:var(--va-c-brand);transition:top .25s cubic-bezier(0,1,.5,1),background-color .5s,opacity .25s;border-top-right-radius:2px;border-bottom-right-radius:2px}.outline-title[data-v-f0c1ef64]{letter-spacing:.4px;line-height:28px;font-size:14px;font-weight:600}.visually-hidden[data-v-f0c1ef64]{position:absolute;width:1px;height:1px;white-space:nowrap;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden}.aside{position:fixed;right:0;top:0;bottom:0;width:var(--va-sidebar-width,300px);transform:translate(100%);transition:box-shadow var(--va-transition-duration),background-color var(--va-transition-duration),opacity .25s,transform var(--va-transition-duration) cubic-bezier(.19,1,.22,1)}.aside-container{position:sticky;top:0;height:100vh}@media screen and (min-width:1280px){.aside{transform:translate(0)}}.toc-btn{color:var(--va-c-primary);background-color:#fff;z-index:var(--yun-z-toc-btn)}.post-nav{display:flex;justify-content:space-between;align-items:center}.post-nav-item{display:inline-flex;justify-content:center;align-items:center;color:var(--va-c-primary);outline:0;font-size:1.5rem;font-weight:700;text-transform:uppercase;height:3rem;transition:.4s}.post-nav-item:hover{background-color:rgba(var(--va-c-primary-rgb),.1);box-shadow:0 0 15px #0000001a}.post-nav-prev{padding:0 .6rem 0 .1rem}.post-nav-next{padding:0 .1rem 0 .6rem}.post-nav-next,.post-nav-prev{display:inline-flex;align-items:center;height:3rem;font-size:1rem}.post-nav-next .title,.post-nav-prev .title{overflow:hidden;max-width:10rem}.post-nav-next .icon,.post-nav-prev .icon{width:1.2rem;height:1.2rem}@media screen and (min-width:1024px){.post-nav-next .title,.post-nav-prev .title{max-width:18rem}}@media screen and (min-width:1280px){.content{max-width:calc(100vw - 2 * var(--va-sidebar-width) - 1rem - 8px)}}</style><link rel="preload" href="/assets/index-4070d21c.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/post-f950f327.js"><link rel="preload" href="/assets/post-1d1be697.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/Consulä½¿ç”¨ä¸­æ–‡æ‰‹å†Œ-1e50109a.js"><link rel="modulepreload" crossorigin="" href="/assets/ValaxyMain.vue_vue_type_style_index_0_lang-f9369a8c.js"><link rel="preload" href="/assets/ValaxyMain-5904cb61.css" as="style"><title>Consulä½¿ç”¨ä¸­æ–‡æ‰‹å†Œ - Valaxy Blog</title><link rel="icon" href="/favicon.svg" type="image/svg+xml"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#ffffff"><meta name="generator" content="Valaxy 0.14.0"><meta name="description" content="A blog generated by Valaxy."><meta property="og:description" content="A blog generated by Valaxy."><meta property="og:locale" content="en"><meta property="og:site:name" content="Valaxy Blog"><meta property="og:title" content="Consulä½¿ç”¨ä¸­æ–‡æ‰‹å†Œ"><meta property="og:image" content="/favicon.svg"><meta property="og:url" content="/"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_AMS-Regular-0cdd387c.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Bold-de7701e4.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Regular-5d53e70a.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Bold-74444efd.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Regular-51814d27.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Bold-0f60d1b8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-BoldItalic-99cd42a3.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Italic-97479ca6.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Regular-c2342cd8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-BoldItalic-dc47344d.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-Italic-7af58c5e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Bold-e99ae511.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Italic-00b26ac8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Regular-68e8c73e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Script-Regular-036d4e95.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size1-Regular-6b47c401.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size2-Regular-d04c5421.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="data:font/woff2;base64,d09GMgABAAAAAA4oAA4AAAAAHbQAAA3TAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgRQIDgmcDBEICo1oijYBNgIkA14LMgAEIAWJAAeBHAyBHBvbGiMRdnO0IkRRkiYDgr9KsJ1NUAf2kILNxgUmgqIgq1P89vcbIcmsQbRps3vCcXdYOKSWEPEKgZgQkprQQsxIXUgq0DqpGKmIvrgkeVGtEQD9DzAO29fM9jYhxZEsL2FeURH2JN4MIcTdO049NCVdxQ/w9NrSYFEBKTDKpLKfNkCGDc1RwjZLQcm3vqJ2UW9Xfa3tgAHz6ivp6vgC2yD4/6352ndnN0X0TL7seypkjZlMsjmZnf0Mm5Q+JykRWQBKCVCVPbARPXWyQtb5VgLB6Biq7/Uixcj2WGqdI8tGSgkuRG+t910GKP2D7AQH0DB9FMDW/obJZ8giFI3Wg8Cvevz0M+5m0rTh7XDBlvo9Y4vm13EXmfttwI4mBo1EG15fxJhUiCLbiiyCf/ZA6MFAhg3pGIZGdGIVjtPn6UcMk9A/UUr9PhoNsCENw1APAq0gpH73e+M+0ueyHbabc3vkbcdtzcf/fiy+NxQEjf9ud/ELBHAXJ0nk4z+MXH2Ev/kWyV4k7SkvpPc9Qr38F6RPWnM9cN6DJ0AdD1BhtgABtmoRoFCvPsBAumNm6soZG2Gk5GyVTo2sJncSyp0jQTYoR6WDvTwaaEcHsxHfvuWhHA3a6bN7twRKtcGok6NsCi7jYRrM2jExsUFMxMQYuJbMhuWNOumEJy9hi29Dmg5zMp/A5+hhPG19j1vBrq8JTLr8ki5VLPmG/PynJHVul440bxg5xuymHUFPBshC+nA9I1FmwbRBTNHAcik3Oae0cxKoI3MOriM42UrPe51nsaGxJ+WfXubAsP84aabUlQSJ1IiE0iPETLUU4CATgfXSCSpuRFRmCGbO+wSpAnzaeaCYW1VNEysRtuXCEL1kUFUbbtMv3Tilt/1c11jt3Q5bbMa84cpWipp8Elw3MZhOHsOlwwVUQM3lAR35JiFQbaYCRnMF2lxAWoOg2gyoIV4PouX8HytNIfLhqpJtXB4vjiViUI8IJ7bkC4ikkQvKksnOTKICwnqWSZ9YS5f0WCxmpgjbIq7EJcM4aI2nmhLNY2JIUgOjXZFWBHb+x5oh6cwb0Tv1ackHdKi0I9OO2wE9aogIOn540CCCziyhN+IaejtgAONKznHlHyutPrHGwCx9S6B8kfS4Mfi4Eyv7OU730bT1SCBjt834cXsf43zVjPUqqJjgrjeGnBxSG4aYAKFuVbeCfkDIjAqMb6yLNIbCuvXhMH2/+k2vkNpkORhR59N1CkzoOENvneIosjYmuTxlhUzaGEJQ/iWqx4dmwpmKjrwTiTGTCVozNAYqk/zXOndWxuWSmJkQpJw3pK5KX6QrLt5LATMqpmPAQhkhK6PUjzHUn7E0gHE0kPE0iKkolgkUx9SZmVAdDgpffdyJKg3k7VmzYGCwVXGz/tXmkOIp+vcWs+EMuhhvN0h9uhfzWJziBQmCREGSIFmQIkgVpAnSBRmC//6hkLZwaVhwxlrJSOdqlFtOYxlau9F2QN5Y98xmIAsiM1HVp2VFX+DHHGg6Ecjh3vmqtidX3qHI2qycTk/iwxSt5UzTmEP92ZBnEWTk4Mx8Mpl78ZDokxg/KWb+Q0QkvdKVmq3TMW+RXEgrsziSAfNXFMhDc60N5N9jQzjfO0kBKpUZl0ZmwJ41j/B9Hz6wmRaJB84niNmQrzp9eSlQCDDzazGDdVi3P36VZQ+Jy4f9UBNp+3zTjqI4abaFAm+GShVaXlsGdF3FYzZcDI6cori4kMxUECl9IjJZpzkvitAoxKue+90pDMvcKRxLl53TmOKCmV/xRolNKSqqUxc6LStOETmFOiLZZptlZepcKiAzteG8PEdpnQpbOMNcMsR4RR2Bs0cKFEvSmIjAFcnarqwUL4lDhHmnVkwu1IwshbiCcgvOheZuYyOteufZZwlcTlLgnZ3o/WcYdzZHW/WGaqaVfmTZ1aWCceJjkbZqsfbkOtcFlUZM/jy+hXHDbaUobWqqXaeWobbLO99yG5N3U4wxco0rQGGcOLASFMXeJoham8M+/x6O2WywK2l4HGbq1CoUyC/IZikQhdq3SiuNrvAEj0AVu9x2x3lp/xWzahaxidezFVtdcb5uEnzyl0ZmYiuKI0exvCd4Xc9CV1KB0db00z92wDPde0kukbvZIWN6jUWFTmPIC/Y4UPCm8UfDTFZpZNon1qLFTkBhxzB+FjQRA2Q/YRJT8pQigslMaUpFyAG8TMlXigiqmAZX4xgijKjRlGpLE0GdplRfCaJo0JQaSxNBk6ZmMzcya0FmrcisDdn0Q3HI2sWSppYigmlM1XT/kLQZSNpMJG0WkjYbSZuDpM1F0uYhFc1HxU4m1QJjDK6iL0S5uSj5rgXc3RejEigtcRBtqYPQsiTskmO5vosV+q4VGIKbOkDg0jtRrq+Em1YloaTFar3EGr1EUC8R0kus1Uus00usL97ABr2BjXoDm/QGNhuWtMVBKOwg/i78lT7hBsAvDmwHc/ao3vmUbBmhjeYySZNWvGkfZAgISDSaDo1SVpzGDsAEkF8B+gEapViUoZgUWXcRIGFZNm6gWbAKk0bp0k1MHG9fLYtV4iS2SmLEQFARzRcnf9PUS0LVn05/J9MiRRBU3v2IrvW974v4N00L7ZMk0wXP1409CHo/an8zTRHD3eSJ6m8D4YMkZNl3M79sqeuAsr/m3f+8/yl7A50aiAEJgeBeMWzu7ui9UfUBCe2TIqZIoOd/3/udRBOQidQZUERzb2/VwZN1H/Sju82ew2H2Wfr6qvfVf3hqwDvAIpkQVFy4B9Pe9e4/XvPeceu7h3dvO56iJPf0+A6cqA2ip18ER+iFgggiuOkvj24bby0N9j2UHIkgqIt+sVgfodC4YghLSMjSZbH0VR/6dMDrYJeKHilKTemt6v6kvzvn3/RrdWtr0GoN/xL+Sex/cPYLUpepx9cz/D46UPU5KXgAQa+NDps1v6J3xP1i2HtaDB0M9aX2deA7SYff//+gUCovMmIK/qfsFcOk+4Y5ZN97XlG6zebqtMbKgeRFi51vnxTQYBUik2rS/Cn6PC8ADR8FGxsRPB82dzfND90gIcshOcYUkfjherBz53odpm6TP8txlwOZ71xmfHHOvq053qFF/MRlS3jP0ELudrf2OeN8DHvp6ZceLe8qKYvWz/7yp0u4dKPfli3CYq0O13Ih71mylJ80tOi10On8wi+F4+LWgDPeJ30msSQt9/vkmHq9/Lvo2b461mP801v3W4xTcs6CbvF9UDdrSt+A8OUbpSh55qAUFXWznBBfdeJ8a4d7ugT5tvxUza3h9m4H7ptTqiG4z0g5dc0X29OcGlhpGFMpQo9ytTS+NViZpNdvU4kWx+LKxNY10kQ1yqGXrhe4/1nvP7E+nd5A92TtaRplbHSqoIdOqtRWti+fkB5/n1+/VvCmz12pG1kpQWsfi1ftlBobm0bpngs16CHkbIwdLnParxtTV3QYRlfJ0KFskH7pdN/YDn+yRuSd7sNH3aO0DYPggk6uWuXrfOc+fa3VTxFVvKaNxHsiHmsXyCLIE5yuOeN3/Jdf8HBL/5M6shjyhxHx9BjB1O0+4NLOnjLLSxwO7ukN4jMbOIcD879KLSi6Pk61Oqm2377n8079PXEEQ7cy7OKEC9nbpet118fxweTafpt69x/Bt8UqGzNQt7aelpc44dn5cqhwf71+qKp/Zf/+a0zcizOUWpl/iBcSXip0pplkatCchoH5c5aUM8I7/dWxAej8WicPL1URFZ9BDJelUwEwTkGqUhgSlydVes95YdXvhh9Gfz/aeFWvgVb4tuLbcv4+wLdutVZv/cUonwBD/6eDlE0aSiKK/uoH3+J1wDE/jMVqY2ysGufN84oIXB0sPzy8ollX/LegY74DgJXJR57sn+VGza0x3DnuIgABFM15LmajjjsNlYj+JEZGbuRYcAMOWxFkPN2w6Wd46xo4gVWQR/X4lyI/R6K/YK0110GzudPRW7Y+UOBGTfNNzHeYT0fiH0taunBpq9HEW8OKSaBGj21L0MqenEmNRWBAWDWAk4CpNoEZJ2tTaPFgbQYj8HxtFilErs3BTRwT8uO1NXQaWfIotchmPkAF5mMBAliEmZiOGVgCG9LgRzpscMAOOwowlT3JhusdazXGSC/hxR3UlmWVwWHpOIKheqONvjyhSiTHIkVUco5bnji8m//zL7PKaT1Vl5I6UE609f+gkr6MZKVyKc7zJRmCahLsdlyA5fdQkRSan9LgnnLEyGSkaKJCJog0wAgvepWBt80+1yKln1bMVtCljfNWDueKLsWwaEbBSfSPTEmVRsUcYYMnEjcjeyCZzBXK9E9BYBXLKjOSpUDR+nEV3TFSUdQaz+ot98QxgXwx0GQ+EEUAKB2qZPkQQ0GqFD8UPFMqyaCHM24BZmSGic9EYMagKizOw9Hz50DMrDLrqqLkTAhplMictiCAx5S3BIUQdeJeLnBy2CNtMfz6cV4u8XKoFZQesbf9YZiIERiHjaNodDW6LgcirX/mPnJIkBGDUpTBhSa0EIr38D5hCIszhCM8URGBqImoWjpvpt1ebu/v3Gl3qJfMnNM+9V+kiRFyROTPHQWOcs1dNW94/ukKMPZBvDi55i5CttdeJz84DLngLqjcdwEZ87bFFR8CIG35OAkDVN6VRDZ7aq67NteYqZ2lpT8oYB2CytoBd6VuAx4WgiAsnuj3WohG+LugzXiQRDeM3XYXlULv4dp5VFYC"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size4-Regular-a4af7d41.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Typewriter-Regular-71d517d6.woff2"></head><body><div id="app" data-server-rendered="true"><!--[--><!--[--><!--[--><div class="va-bg"></div><!--]--><!----><!--]--><!--[--><!--]--><!----><!--[--><!--[--><!----><button type="button" class="vt-hamburger menu-btn sidebar-toggle yun-icon-btn md:hidden" aria-label="mobile navigation" aria-expanded="false"><span class="vt-hamburger-container"><span class="vt-hamburger-top"></span><span class="vt-hamburger-middle"></span><span class="vt-hamburger-bottom"></span></span></button><aside class="md:translate-x-0 va-card transition sidebar"><!--[--><!--[--><!--[--><!----><div class=""><!--[--><div class="sidebar-panel"><div class="site-info" m="t-6"><a href="/about" class="site-author-avatar"><img class="rounded-full" src="https://www.yunyoujun.cn/images/avatar.jpg" alt="avatar"><span class="site-author-status">ğŸŒŒ</span></a><div class="site-author-name"><a href="/about" class="">VALAXY Developer</a></div><a href="/about/site" class="site-name">Valaxy Blog</a><h4 class="site-subtitle block" text="xs">Next Generation Static Blog Framework.</h4><div class="site-description my-1">A blog generated by Valaxy.</div></div><nav class="site-nav" text-xl="" mt-6=""><a href="/" class="site-link-item yun-icon-btn" title="Home"><div i-ri-home-4-line=""></div></a><a href="/archives/" class="site-link-item" title="Archives"><div class="icon" i-ri-archive-line=""></div><span class="count">85</span></a><a href="/categories/" class="site-link-item" title="Categories"><div class="icon" i-ri-folder-2-line=""></div><span class="count">16</span></a><a href="/tags/" class="site-link-item" title="Tags"><div class="icon" i-ri-price-tag-3-line=""></div><span class="count">118</span></a><a class="site-link-item yun-icon-btn" showexternalicon="false" title="About"><!--[--><div class="i-ri-clipboard-line"></div><!--]--></a></nav><hr m="t-4 b-2"><div class="links-of-author"><!--[--><!--]--></div><hr m="y-2"><div class="links"><!--[--><a class="link-item yun-icon-btn" showexternalicon="false" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:#1e90ff"><!--[--><div class="i-ri-genderless-line icon"></div><!--]--></a><a class="link-item yun-icon-btn" showexternalicon="false" title="æˆ‘çš„å°è´¦å•" style="color:gold"><!--[--><div class="i-ri-money-cny-circle-line icon"></div><!--]--></a><a class="link-item yun-icon-btn" showexternalicon="false" title="å–œæ¬¢çš„å¥³å­©å­" style="color:#ff69b4"><!--[--><div class="i-ri-women-line icon"></div><!--]--></a><!--]--></div><br></div><div><button class="yun-icon-btn" title="Switch to dark mode" style="color:#f1cb64"><div i="ri-sun-line dark:ri-moon-line"></div></button><button class="yun-icon-btn" title="Change languages" style="color:var(--va-c-text)"><div i-ri-translate="" class="rotate-y-180 transition transform"></div></button></div><!--]--></div><!--]--><!--]--><!--]--></aside><!--]--><main class="yun-main lt-md:ml-0" flex="~"><div w="full" flex="~"><!--[--><div class="content" flex="~ col grow" w="full" p="l-4 lt-md:0"><div class="yun-card relative" m="0" style=""><!----><!----><!--[--><!--[--><header class="post-header" m="t-4"><h1 class="post-title" p="2" text="2xl center" font="serif black" style=""><!----><span>Consulä½¿ç”¨ä¸­æ–‡æ‰‹å†Œ</span></h1></header><!--]--><!--[--><!--[--><!--[--><!--[--><!----><!----><!----><div class="post-meta justify-center" flex="~" text="sm" py="1"><div class="post-time flex items-center"><span class="inline-flex-center" title="Posted on"><div class="inline-block" i-ri-calendar-line=""></div><time m="l-1">2021-01-28</time></span><!----></div></div><!--[--><!--]--><!--]--><div flex="~" text="sm" py="1"><!----><!----></div><div class="inline-flex" text="sm" py="1"><a href="/categories/?category=%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C" class="post-categories inline-flex justify-center items-center"><div m="x-1" i-ri-folder-2-line=""></div>è‡ªåŠ¨æ³¨å†Œ</a><span mx="2">-</span><!--[--><a href="/tags/?tag=Consul" class="post-tag inline-flex-center" m="x-1"><div m="r-1" i-ri-price-tag-3-line=""></div>Consul</a><!--]--></div><!--]--><!--]--><!--]--><div p="x-4 b-8" class="sm:px-6 lg:px-12 xl:px-16" w="full"><!--[--><article class="markdown-body"><!--[--><!--[--><h1 id="ä½¿ç”¨consul" tabindex="-1">ä½¿ç”¨consul <a aria-current="page" href="#ä½¿ç”¨consul" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><h2 id="ä»‹ç»" tabindex="-1">ä»‹ç» <a aria-current="page" href="#ä»‹ç»" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ConsulåŒ…å«å¤šä¸ªç»„ä»¶,ä½†æ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“,ä¸ºä½ çš„åŸºç¡€è®¾æ–½æä¾›æœåŠ¡å‘ç°å’ŒæœåŠ¡é…ç½®çš„å·¥å…·.ä»–æä¾›ä»¥ä¸‹å…³é”®ç‰¹æ€§:</p><p><strong>æœåŠ¡å‘ç°</strong> Consulçš„å®¢æˆ·ç«¯å¯ç”¨æä¾›ä¸€ä¸ªæœåŠ¡,æ¯”å¦‚ api æˆ–è€…mysql ,å¦å¤–ä¸€äº›å®¢æˆ·ç«¯å¯ç”¨ä½¿ç”¨Consulå»å‘ç°ä¸€ä¸ªæŒ‡å®šæœåŠ¡çš„æä¾›è€….é€šè¿‡DNSæˆ–è€…HTTPåº”ç”¨ç¨‹åºå¯ç”¨å¾ˆå®¹æ˜“çš„æ‰¾åˆ°ä»–æ‰€ä¾èµ–çš„æœåŠ¡. <strong>å¥åº·æ£€æŸ¥</strong> Consulå®¢æˆ·ç«¯å¯ç”¨æä¾›ä»»æ„æ•°é‡çš„å¥åº·æ£€æŸ¥,æŒ‡å®šä¸€ä¸ªæœåŠ¡(æ¯”å¦‚:webserveræ˜¯å¦è¿”å›äº†200 OK çŠ¶æ€ç )æˆ–è€…ä½¿ç”¨æœ¬åœ°èŠ‚ç‚¹(æ¯”å¦‚:å†…å­˜ä½¿ç”¨æ˜¯å¦å¤§äº90%). è¿™ä¸ªä¿¡æ¯å¯ç”±operatorç”¨æ¥ç›‘è§†é›†ç¾¤çš„å¥åº·.è¢«æœåŠ¡å‘ç°ç»„ä»¶ç”¨æ¥é¿å…å°†æµé‡å‘é€åˆ°ä¸å¥åº·çš„ä¸»æœº. <strong>Key/Valueå­˜å‚¨</strong> åº”ç”¨ç¨‹åºå¯ç”¨æ ¹æ®è‡ªå·±çš„éœ€è¦ä½¿ç”¨Consulçš„å±‚çº§çš„Key/Valueå­˜å‚¨.æ¯”å¦‚åŠ¨æ€é…ç½®,åŠŸèƒ½æ ‡è®°,åè°ƒ,é¢†è¢–é€‰ä¸¾ç­‰ç­‰,ç®€å•çš„HTTP APIè®©ä»–æ›´æ˜“äºä½¿ç”¨. <strong>å¤šæ•°æ®ä¸­å¿ƒ</strong> Consulæ”¯æŒå¼€ç®±å³ç”¨çš„å¤šæ•°æ®ä¸­å¿ƒ.è¿™æ„å‘³ç€ç”¨æˆ·ä¸éœ€è¦æ‹…å¿ƒéœ€è¦å»ºç«‹é¢å¤–çš„æŠ½è±¡å±‚è®©ä¸šåŠ¡æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ. Consulé¢å‘DevOpså’Œåº”ç”¨å¼€å‘è€…å‹å¥½.æ˜¯ä»–é€‚åˆç°ä»£çš„å¼¹æ€§çš„åŸºç¡€è®¾æ–½. <img src="https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/cluster.png" alt="consul-cluster"></p><h2 id="åŸºç¡€æ¶æ„" tabindex="-1">åŸºç¡€æ¶æ„ <a aria-current="page" href="#åŸºç¡€æ¶æ„" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Consulæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é«˜å¯ç”¨çš„ç³»ç»Ÿ. è¿™èŠ‚å°†åŒ…å«ä¸€äº›åŸºç¡€,æˆ‘ä»¬å¿½ç•¥æ‰ä¸€äº›ç»†èŠ‚è¿™æ ·ä½ å¯ä»¥å¿«é€Ÿäº†è§£Consulæ˜¯å¦‚ä½•å·¥ä½œçš„.å¦‚æœè¦äº†è§£æ›´å¤šç»†èŠ‚,è¯·å‚è€ƒæ·±å…¥çš„æ¶æ„æè¿°.</p><p>æ¯ä¸ªæä¾›æœåŠ¡ç»™Consulçš„é˜¶æ®µéƒ½è¿è¡Œäº†ä¸€ä¸ªConsul agent . å‘ç°æœåŠ¡æˆ–è€…è®¾ç½®å’Œè·å– key/valueå­˜å‚¨çš„æ•°æ®ä¸æ˜¯å¿…é¡»è¿è¡Œagent.è¿™ä¸ªagentæ˜¯è´Ÿè´£å¯¹èŠ‚ç‚¹è‡ªèº«å’ŒèŠ‚ç‚¹ä¸Šçš„æœåŠ¡è¿›è¡Œå¥åº·æ£€æŸ¥çš„.</p><p>Agentä¸ä¸€ä¸ªå’Œå¤šä¸ªConsul Server è¿›è¡Œäº¤äº’.Consul Server ç”¨äºå­˜æ”¾å’Œå¤åˆ¶æ•°æ®.serverè‡ªè¡Œé€‰ä¸¾ä¸€ä¸ªé¢†è¢–.è™½ç„¶Consulå¯ä»¥è¿è¡Œåœ¨ä¸€å°server , ä½†æ˜¯å»ºè®®ä½¿ç”¨3åˆ°5å°æ¥é¿å…å¤±è´¥æƒ…å†µä¸‹æ•°æ®çš„ä¸¢å¤±.æ¯ä¸ªæ•°æ®ä¸­å¿ƒå»ºè®®é…ç½®ä¸€ä¸ªserveré›†ç¾¤.</p><p>ä½ åŸºç¡€è®¾æ–½ä¸­éœ€è¦å‘ç°å…¶ä»–æœåŠ¡çš„ç»„ä»¶å¯ä»¥æŸ¥è¯¢ä»»ä½•ä¸€ä¸ªConsul çš„serveræˆ–è€… agent.Agentä¼šè‡ªåŠ¨è½¬å‘è¯·æ±‚åˆ°server .</p><p>æ¯ä¸ªæ•°æ®ä¸­è¿è¡Œäº†ä¸€ä¸ªConsul serveré›†ç¾¤.å½“ä¸€ä¸ªè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å‘ç°å’Œé…ç½®è¯·æ±‚åˆ›å»ºæ—¶.æœ¬åœ°Consul Serverè½¬å‘è¯·æ±‚åˆ°è¿œç¨‹çš„æ•°æ®ä¸­å¿ƒå¹¶è¿”å›ç»“æœ.</p><p>æ›´å¤šä»‹ç»æŸ¥çœ‹å®˜ç½‘<a href="https://www.consul.io/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->ç‚¹å‡»å‰å¾€<!--]--></a></p><h2 id="å®‰è£…consul" tabindex="-1">å®‰è£…Consul <a aria-current="page" href="#å®‰è£…consul" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>å®‰è£…Consul,æ‰¾åˆ°é€‚åˆä½ ç³»ç»Ÿçš„åŒ…ä¸‹è½½ä»–.Consulæ‰“åŒ…ä¸ºä¸€ä¸ªâ€™Zipâ€™æ–‡ä»¶.<a href="https://www.consul.io/downloads.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->å‰å¾€ä¸‹è½½<!--]--></a></p><p>ä¸‹è½½åè§£å¼€å‹ç¼©åŒ….æ‹·è´Consulåˆ°ä½ çš„PATHè·¯å¾„ä¸­,åœ¨Unixç³»ç»Ÿä¸­<code>~/bin</code>å’Œ<code>/usr/local/bin</code>æ˜¯é€šå¸¸çš„å®‰è£…ç›®å½•.æ ¹æ®ä½ æ˜¯æƒ³ä¸ºå•ä¸ªç”¨æˆ·å®‰è£…è¿˜æ˜¯ç»™æ•´ä¸ªç³»ç»Ÿå®‰è£…æ¥é€‰æ‹©.åœ¨Windowsç³»ç»Ÿä¸­æœ‰å¯ä»¥å®‰è£…åˆ°<code>%PATH%</code>çš„è·¯å¾„ä¸­.</p><h2 id="éªŒè¯å®‰è£…" tabindex="-1">éªŒè¯å®‰è£… <a aria-current="page" href="#éªŒè¯å®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>å®Œæˆå®‰è£…å,é€šè¿‡æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯çª—å£æ£€æŸ¥<code>consul</code>å®‰è£…æ˜¯å¦æˆåŠŸ.é€šè¿‡æ‰§è¡Œ <code>consul</code>ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡º</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-248 ~]# consul</span></span>
<span class="line"><span style="color:#a6accd">usage: consul [--version] [--help] &lt;command&gt; [&lt;args&gt;]</span></span>
<span class="line"><span style="color:#a6accd">Available commands are:</span></span>
<span class="line"><span style="color:#a6accd">    agent          Runs a Consul agent</span></span>
<span class="line"><span style="color:#a6accd">    configtest     Validate config file</span></span>
<span class="line"><span style="color:#a6accd">    event          Fire a new event</span></span>
<span class="line"><span style="color:#a6accd">    exec           Executes a command on Consul nodes</span></span>
<span class="line"><span style="color:#a6accd">    force-leave    Forces a member of the cluster to enter the "left" state</span></span>
<span class="line"><span style="color:#a6accd">    info           Provides debugging information for operators</span></span>
<span class="line"><span style="color:#a6accd">    join           Tell Consul agent to join cluster</span></span>
<span class="line"><span style="color:#a6accd">    keygen         Generates a new encryption key</span></span>
<span class="line"><span style="color:#a6accd">    keyring        Manages gossip layer encryption keys</span></span>
<span class="line"><span style="color:#a6accd">    kv             Interact with the key-value store</span></span>
<span class="line"><span style="color:#a6accd">    leave          Gracefully leaves the Consul cluster and shuts down</span></span>
<span class="line"><span style="color:#a6accd">    lock           Execute a command holding a lock</span></span>
<span class="line"><span style="color:#a6accd">    maint          Controls node or service maintenance mode</span></span>
<span class="line"><span style="color:#a6accd">    members        Lists the members of a Consul cluster</span></span>
<span class="line"><span style="color:#a6accd">    monitor        Stream logs from a Consul agent</span></span>
<span class="line"><span style="color:#a6accd">    operator       Provides cluster-level tools for Consul operators</span></span>
<span class="line"><span style="color:#a6accd">    reload         Triggers the agent to reload configuration files</span></span>
<span class="line"><span style="color:#a6accd">    rtt            Estimates network round trip time between nodes</span></span>
<span class="line"><span style="color:#a6accd">    snapshot       Saves, restores and inspects snapshots of Consul server state</span></span>
<span class="line"><span style="color:#a6accd">    version        Prints the Consul version</span></span>
<span class="line"><span style="color:#a6accd">    watch          Watch for changes in Consul</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœä½ å¾—åˆ°ä¸€ä¸ª<code>consul not be found</code>çš„é”™è¯¯,ä½ çš„<code>PATH</code>å¯èƒ½æ²¡æœ‰æ­£ç¡®è®¾ç½®.è¯·è¿”å›æ£€æŸ¥ä½ çš„consulçš„å®‰è£…è·¯å¾„æ˜¯å¦åŒ…å«åœ¨<code>PATH</code>ä¸­.</p><h2 id="è¿è¡Œagent" tabindex="-1">è¿è¡ŒAgent <a aria-current="page" href="#è¿è¡Œagent" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>å®ŒæˆConsulçš„å®‰è£…å,å¿…é¡»è¿è¡Œagent. agentå¯ä»¥è¿è¡Œä¸º<code>server</code>æˆ–<code>client</code>æ¨¡å¼.æ¯ä¸ªæ•°æ®ä¸­å¿ƒè‡³å°‘å¿…é¡»æ‹¥æœ‰ä¸€å°server . å»ºè®®åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­æœ‰3æˆ–è€…5ä¸ªserver.éƒ¨ç½²å•ä¸€çš„server,åœ¨å‡ºç°å¤±è´¥æ—¶ä¼šä¸å¯é¿å…çš„é€ æˆæ•°æ®ä¸¢å¤±.</p><p>å…¶ä»–çš„agentè¿è¡Œä¸ºclientæ¨¡å¼.ä¸€ä¸ªclientæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„è¿›ç¨‹.ç”¨äºæ³¨å†ŒæœåŠ¡,è¿è¡Œå¥åº·æ£€æŸ¥å’Œè½¬å‘å¯¹serverçš„æŸ¥è¯¢.agentå¿…é¡»åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»æœºä¸Šè¿è¡Œ.</p><p>æŸ¥çœ‹å¯åŠ¨æ•°æ®ä¸­å¿ƒçš„ç»†èŠ‚è¯·æŸ¥çœ‹<a href="https://www.consul.io/docs/guides/bootstrapping.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->è¿™é‡Œ<!--]--></a>.</p><h2 id="å¯åŠ¨-consul-server" tabindex="-1">å¯åŠ¨ Consul Server <a aria-current="page" href="#å¯åŠ¨-consul-server" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul agent -server -bootstrap-expect 3 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -ui-dir ./consul_ui/ -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿è¡Œcosnul agentä»¥<code>server</code>æ¨¡å¼ï¼Œ</p><ul><li><code>-server</code> ï¼š å®šä¹‰agentè¿è¡Œåœ¨serveræ¨¡å¼</li><li><code>-bootstrap-expect</code> ï¼šåœ¨ä¸€ä¸ªdatacenterä¸­æœŸæœ›æä¾›çš„serverèŠ‚ç‚¹æ•°ç›®ï¼Œå½“è¯¥å€¼æä¾›çš„æ—¶å€™ï¼Œconsulä¸€ç›´ç­‰åˆ°è¾¾åˆ°æŒ‡å®šseveræ•°ç›®çš„æ—¶å€™æ‰ä¼šå¼•å¯¼æ•´ä¸ªé›†ç¾¤ï¼Œè¯¥æ ‡è®°ä¸èƒ½å’Œbootstrapå…±ç”¨</li><li><code>-bind</code>ï¼šè¯¥åœ°å€ç”¨æ¥åœ¨é›†ç¾¤å†…éƒ¨çš„é€šè®¯ï¼Œé›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹åˆ°åœ°å€éƒ½å¿…é¡»æ˜¯å¯è¾¾çš„ï¼Œé»˜è®¤æ˜¯0.0.0.0</li><li><code>-node</code>ï¼šèŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­çš„åç§°ï¼Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œé»˜è®¤æ˜¯è¯¥èŠ‚ç‚¹çš„ä¸»æœºå</li><li><code>-ui-dir</code>ï¼š æä¾›å­˜æ”¾web uièµ„æºçš„è·¯å¾„ï¼Œè¯¥ç›®å½•å¿…é¡»æ˜¯å¯è¯»çš„</li><li><code>-rejoin</code>ï¼šä½¿consulå¿½ç•¥å…ˆå‰çš„ç¦»å¼€ï¼Œåœ¨å†æ¬¡å¯åŠ¨åä»æ—§å°è¯•åŠ å…¥é›†ç¾¤ä¸­ã€‚</li><li><code>-config-dir</code>ï¼šé…ç½®æ–‡ä»¶ç›®å½•ï¼Œé‡Œé¢æ‰€æœ‰ä»¥.jsonç»“å°¾çš„æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½</li><li><code>-client</code>ï¼šconsulæœåŠ¡ä¾¦å¬åœ°å€ï¼Œè¿™ä¸ªåœ°å€æä¾›HTTPã€DNSã€RPCç­‰æœåŠ¡ï¼Œé»˜è®¤æ˜¯127.0.0.1æ‰€ä»¥ä¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¦‚æœä½ è¦å¯¹å¤–æä¾›æœåŠ¡æ”¹æˆ0.0.0.0</li></ul><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 consul]# consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -ui-dir ./consul_ui/ -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">==&gt; WARNING: Expect Mode enabled, expecting 3 servers</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Starting Consul agent...</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Starting Consul agent RPC...</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Consul agent running!</span></span>
<span class="line"><span style="color:#a6accd">           Version: 'v0.7.4'</span></span>
<span class="line"><span style="color:#a6accd">           Node ID: '422ec677-74ef-8f29-2f22-01effeed6334'</span></span>
<span class="line"><span style="color:#a6accd">         Node name: 's1'</span></span>
<span class="line"><span style="color:#a6accd">        Datacenter: 'dc1'</span></span>
<span class="line"><span style="color:#a6accd">            Server: true (bootstrap: false)</span></span>
<span class="line"><span style="color:#a6accd">       Client Addr: 0.0.0.0 (HTTP: 8500, HTTPS: -1, DNS: 8600, RPC: 8400)</span></span>
<span class="line"><span style="color:#a6accd">      Cluster Addr: 10.201.102.198 (LAN: 8301, WAN: 8302)</span></span>
<span class="line"><span style="color:#a6accd">    Gossip encrypt: false, RPC-TLS: false, TLS-Incoming: false</span></span>
<span class="line"><span style="color:#a6accd">             Atlas: &lt;disabled&gt;</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Log data will now stream in as it occurs:</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] raft: Restored from snapshot 139-352267-1489707086023</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] raft: Initial configuration (index=6982): [{Suffrage:Voter ID:10.201.102.199:8300 Address:10.201.102.199:8300} {Suffrage:Voter ID:10.201.102.200:8300 Address:10.201.102.200:8300} {Suffrage:Voter ID:10.201.102.198:8300 Address:10.201.102.198:8300}]</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] raft: Node at 10.201.102.198:8300 [Follower] entering Follower state (Leader: "")</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s1 10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] serf: Attempting re-join to previously known node: s2: 10.201.102.199:8301</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] consul: Adding LAN server s1 (Addr: tcp/10.201.102.198:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] consul: Raft data found, disabling bootstrap mode</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s2 10.201.102.199</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s3 10.201.102.200</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] serf: Re-joined to previously known node: s2: 10.201.102.199:8301</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] consul: Adding LAN server s2 (Addr: tcp/10.201.102.199:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] consul: Adding LAN server s3 (Addr: tcp/10.201.102.200:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s1.dc1 10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [INFO] consul: Adding WAN server s1.dc1 (Addr: tcp/10.201.102.198:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:08 [WARN] serf: Failed to re-join any previously known node</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:14 [INFO] agent: Synced service 'consul'</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:14 [INFO] agent: Deregistered service 'consul01'</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:14 [INFO] agent: Deregistered service 'consul02'</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 18:03:14 [INFO] agent: Deregistered service 'consul03'</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹é›†ç¾¤æˆå‘˜</strong> æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œ<code>consul members</code>, ä½ å¯ä»¥çœ‹åˆ°Consulé›†ç¾¤çš„æˆå‘˜.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# consul members</span></span>
<span class="line"><span style="color:#a6accd">Node  Address              Status  Type    Build  Protocol  DC</span></span>
<span class="line"><span style="color:#a6accd">s1    10.201.102.198:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s2    10.201.102.199:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s3    10.201.102.200:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="å¯åŠ¨-consul-client" tabindex="-1">å¯åŠ¨ Consul Client <a aria-current="page" href="#å¯åŠ¨-consul-client" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul agent -data-dir /tmp/consul -node=c1 -bind=10.201.102.248 -config-dir=/etc/consul.d/ -join 10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿è¡Œcosnul agentä»¥clientæ¨¡å¼ï¼Œ<code>-join</code> åŠ å…¥åˆ°å·²æœ‰çš„é›†ç¾¤ä¸­å»ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-248 ~]# consul agent -data-dir /tmp/consul -node=c1 -bind=10.201.102.248 -config-dir=/etc/consul.d/ -join 10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Starting Consul agent...</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Starting Consul agent RPC...</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Joining cluster...</span></span>
<span class="line"><span style="color:#a6accd">    Join completed. Synced with 1 initial agents</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Consul agent running!</span></span>
<span class="line"><span style="color:#a6accd">           Version: 'v0.7.4'</span></span>
<span class="line"><span style="color:#a6accd">           Node ID: '564dc0c7-7f4f-7402-a301-cebe7f024294'</span></span>
<span class="line"><span style="color:#a6accd">         Node name: 'c1'</span></span>
<span class="line"><span style="color:#a6accd">        Datacenter: 'dc1'</span></span>
<span class="line"><span style="color:#a6accd">            Server: false (bootstrap: false)</span></span>
<span class="line"><span style="color:#a6accd">       Client Addr: 127.0.0.1 (HTTP: 8500, HTTPS: -1, DNS: 8600, RPC: 8400)</span></span>
<span class="line"><span style="color:#a6accd">      Cluster Addr: 10.201.102.248 (LAN: 8301, WAN: 8302)</span></span>
<span class="line"><span style="color:#a6accd">    Gossip encrypt: false, RPC-TLS: false, TLS-Incoming: false</span></span>
<span class="line"><span style="color:#a6accd">             Atlas: &lt;disabled&gt;</span></span>
<span class="line"><span style="color:#a6accd">==&gt; Log data will now stream in as it occurs:</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: c1 10.201.102.248</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] agent: (LAN) joining: [10.201.102.198]</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: s2 10.201.102.199</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: s3 10.201.102.200</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: s1 10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] agent: (LAN) joined: 1 Err: &lt;nil&gt;</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] consul: adding server s2 (Addr: tcp/10.201.102.199:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] consul: adding server s3 (Addr: tcp/10.201.102.200:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] consul: adding server s1 (Addr: tcp/10.201.102.198:8300) (DC: dc1)</span></span>
<span class="line"><span style="color:#a6accd">    2017/03/17 15:35:16 [INFO] agent: Synced node info</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æŸ¥çœ‹é›†ç¾¤æˆå‘˜</strong> æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œ<code>consul members</code>, ä½ å¯ä»¥çœ‹åˆ°Consulé›†ç¾¤çš„æˆå‘˜.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-248 ~]# consul members</span></span>
<span class="line"><span style="color:#a6accd">Node  Address              Status  Type    Build  Protocol  DC</span></span>
<span class="line"><span style="color:#a6accd">c1    10.201.102.248:8301  alive   client  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s1    10.201.102.198:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s2    10.201.102.199:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s3    10.201.102.200:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>åŠ å…¥é›†ç¾¤</strong></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-248 ~]# consul join 10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">Node  Address              Status  Type    Build  Protocol  DC</span></span>
<span class="line"><span style="color:#a6accd">c1    10.201.102.248:8301  alive   client  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s1    10.201.102.198:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s2    10.201.102.199:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd">s3    10.201.102.200:8301  alive   server  0.7.4  2         dc1</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="åœæ­¢agent" tabindex="-1">åœæ­¢Agent <a aria-current="page" href="#åœæ­¢agent" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä½ å¯ä»¥ä½¿ç”¨<code>Ctrl-C</code> ä¼˜é›…çš„å…³é—­Agent. ä¸­æ–­Agentä¹‹åä½ å¯ä»¥çœ‹åˆ°ä»–ç¦»å¼€äº†é›†ç¾¤å¹¶å…³é—­.</p><p>åœ¨é€€å‡ºä¸­,Consulæé†’å…¶ä»–é›†ç¾¤æˆå‘˜,è¿™ä¸ªèŠ‚ç‚¹ç¦»å¼€äº†.å¦‚æœä½ å¼ºè¡Œæ€æ‰è¿›ç¨‹.é›†ç¾¤çš„å…¶ä»–æˆå‘˜åº”è¯¥èƒ½æ£€æµ‹åˆ°è¿™ä¸ªèŠ‚ç‚¹å¤±æ•ˆäº†.å½“ä¸€ä¸ªæˆå‘˜ç¦»å¼€,ä»–çš„æœåŠ¡å’Œæ£€æµ‹ä¹Ÿä¼šä»ç›®å½•ä¸­ç§»é™¤.å½“ä¸€ä¸ªæˆå‘˜å¤±æ•ˆäº†,ä»–çš„å¥åº·çŠ¶å†µè¢«ç®€å•çš„æ ‡è®°ä¸ºå±é™©,ä½†æ˜¯ä¸ä¼šä»ç›®å½•ä¸­ç§»é™¤.Consulä¼šè‡ªåŠ¨å°è¯•å¯¹å¤±æ•ˆçš„èŠ‚ç‚¹è¿›è¡Œé‡è¿.å…è®¸ä»–ä»æŸäº›ç½‘ç»œæ¡ä»¶ä¸‹æ¢å¤è¿‡æ¥.ç¦»å¼€çš„èŠ‚ç‚¹åˆ™ä¸ä¼šå†ç»§ç»­è”ç³».</p><p>æ­¤å¤–,å¦‚æœä¸€ä¸ªagentä½œä¸ºä¸€ä¸ªæœåŠ¡å™¨,ä¸€ä¸ªä¼˜é›…çš„ç¦»å¼€æ˜¯å¾ˆé‡è¦çš„,å¯ä»¥é¿å…å¼•èµ·æ½œåœ¨çš„å¯ç”¨æ€§æ•…éšœå½±å“è¾¾æˆ<a href="https://www.consul.io/docs/internals/consensus.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->ä¸€è‡´æ€§åè®®<!--]--></a>.</p><p>æŸ¥çœ‹<a href="https://www.consul.io/docs/internals/consensus.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->è¿™é‡Œ<!--]--></a>äº†è§£æ·»åŠ å’Œç§»é™¤server.</p><h2 id="æ›´æ–°æœåŠ¡" tabindex="-1">æ›´æ–°æœåŠ¡ <a aria-current="page" href="#æ›´æ–°æœåŠ¡" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æœåŠ¡å®šä¹‰å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¹¶å‘é€<code>SIGHUP</code>ç»™agentæ¥è¿›è¡Œæ›´æ–°.è¿™æ ·ä½ å¯ä»¥è®©ä½ åœ¨ä¸å…³é—­æœåŠ¡æˆ–è€…ä¿æŒæœåŠ¡è¯·æ±‚å¯ç”¨çš„æƒ…å†µä¸‹è¿›è¡Œæ›´æ–°.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul reload</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦å¤– HTTP APIå¯ä»¥ç”¨æ¥åŠ¨æ€çš„æ·»åŠ ,ç§»é™¤å’Œä¿®æ”¹æœåŠ¡.</p><p>æ³¨å†ŒæœåŠ¡ æ­å»ºå¥½conuslé›†ç¾¤åï¼Œç”¨æˆ·æˆ–è€…ç¨‹åºå°±èƒ½åˆ°consulä¸­å»æŸ¥è¯¢æˆ–è€…æ³¨å†ŒæœåŠ¡ã€‚å¯ä»¥é€šè¿‡æä¾›æœåŠ¡å®šä¹‰æ–‡ä»¶æˆ–è€…è°ƒç”¨HTTP APIæ¥æ³¨å†Œä¸€ä¸ªæœåŠ¡.</p><p>é¦–å…ˆ,ä¸ºConsulé…ç½®åˆ›å»ºä¸€ä¸ªç›®å½•.Consulä¼šè½½å…¥é…ç½®æ–‡ä»¶å¤¹é‡Œçš„æ‰€æœ‰é…ç½®æ–‡ä»¶.åœ¨Unixç³»ç»Ÿä¸­é€šå¸¸ç±»ä¼¼ <code>/etc/consul.d</code> (.d åç¼€æ„æ€æ˜¯è¿™ä¸ªè·¯å¾„åŒ…å«äº†ä¸€ç»„é…ç½®æ–‡ä»¶).</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">mkdir /etc/consul.d</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç„¶å,æˆ‘ä»¬å°†ç¼–å†™æœåŠ¡å®šä¹‰é…ç½®æ–‡ä»¶.å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåå«webçš„æœåŠ¡è¿è¡Œåœ¨ 80ç«¯å£.å¦å¤–,æˆ‘ä»¬å°†ç»™ä»–è®¾ç½®ä¸€ä¸ªæ ‡ç­¾.è¿™æ ·æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»–ä½œä¸ºé¢å¤–çš„æŸ¥è¯¢æ–¹å¼:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">echo '{"service": {"name": "web", "tags": ["rails"], "port": 80}}' &gt;/etc/consul.d/web.json</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç°åœ¨é‡å¯agent , è®¾ç½®é…ç½®ç›®å½•:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">$ consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd">    [INFO] agent: Synced service 'web'</span></span>
<span class="line"><span style="color:#a6accd">...</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><code>-data-dir</code>ï¼šæä¾›ä¸€ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾agentçš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„agentå…è®¸éƒ½éœ€è¦è¯¥ç›®å½•ï¼Œè¯¥ç›®å½•å¿…é¡»æ˜¯ç¨³å®šçš„ï¼Œç³»ç»Ÿé‡å¯åéƒ½ç»§ç»­å­˜åœ¨ ä½ å¯èƒ½æ³¨æ„åˆ°äº†è¾“å‡ºäº† â€œsyncedâ€ äº† webè¿™ä¸ªæœåŠ¡.æ„æ€æ˜¯è¿™ä¸ªagentä»é…ç½®æ–‡ä»¶ä¸­è½½å…¥äº†æœåŠ¡å®šä¹‰,å¹¶ä¸”æˆåŠŸæ³¨å†Œåˆ°æœåŠ¡ç›®å½•.</li></ul><p>å¦‚æœä½ æƒ³æ³¨å†Œå¤šä¸ªæœåŠ¡,ä½ åº”è¯¥åœ¨Consulé…ç½®ç›®å½•åˆ›å»ºå¤šä¸ªæœåŠ¡å®šä¹‰æ–‡ä»¶.</p><p>HTTP APIæ³¨å†ŒæœåŠ¡,curlå‘½ä»¤æˆ–è€…postman ä»¥<code>PUT</code>æ–¹å¼è¯·æ±‚consul HTTP APIæ›´å¤šç»†èŠ‚<a href="https://www.consul.io/docs/agent/http/catalog.html#catalog_register" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->ç‚¹å‡»æŸ¥çœ‹<!--]--></a></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">curl -X PUT -d '{"Datacenter": "dc1", "Node": "c2", "Address": "10.155.0.106", "Service": {"Service": "MAC", "tags": ["lianglian", "Mac"], "Port": 22}}' http://127.0.0.1:8500/v1/catalog/register</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="æŸ¥è¯¢æœåŠ¡" tabindex="-1">æŸ¥è¯¢æœåŠ¡ <a aria-current="page" href="#æŸ¥è¯¢æœåŠ¡" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä¸€æ—¦agentå¯åŠ¨å¹¶ä¸”æœåŠ¡åŒæ­¥äº†.æˆ‘ä»¬å¯ä»¥é€šè¿‡DNSæˆ–è€…HTTPçš„APIæ¥æŸ¥è¯¢æœåŠ¡.</p><p><strong>DNS API</strong> è®©æˆ‘ä»¬é¦–å…ˆä½¿ç”¨DNS APIæ¥æŸ¥è¯¢.åœ¨DNS APIä¸­,æœåŠ¡çš„DNSåå­—æ˜¯ <code>NAME.service.consul</code>. è™½ç„¶æ˜¯å¯é…ç½®çš„,ä½†é»˜è®¤çš„æ‰€æœ‰DNSåå­—ä¼šéƒ½åœ¨<code>consul</code>å‘½åç©ºé—´ä¸‹.è¿™ä¸ªå­åŸŸå‘Šè¯‰Consul,æˆ‘ä»¬åœ¨æŸ¥è¯¢æœåŠ¡,<code>NAME</code>åˆ™æ˜¯æœåŠ¡çš„åç§°.</p><p>å¯¹äºæˆ‘ä»¬ä¸Šé¢æ³¨å†Œçš„WebæœåŠ¡.å®ƒçš„åŸŸåæ˜¯ <code>web.service.consul</code> :</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 web.service.consul</span></span>
<span class="line"><span style="color:#a6accd">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 &lt;&lt;&gt;&gt; @127.0.0.1 -p 8600 web.service.consul</span></span>
<span class="line"><span style="color:#a6accd">; (1 server found)</span></span>
<span class="line"><span style="color:#a6accd">;; global options: +cmd</span></span>
<span class="line"><span style="color:#a6accd">;; Got answer:</span></span>
<span class="line"><span style="color:#a6accd">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 39468</span></span>
<span class="line"><span style="color:#a6accd">;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></span>
<span class="line"><span style="color:#a6accd">;; WARNING: recursion requested but not available</span></span>
<span class="line"><span style="color:#a6accd">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#a6accd">;web.service.consul.            IN      A</span></span>
<span class="line"><span style="color:#a6accd">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#a6accd">web.service.consul.     0       IN      A       10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">;; Query time: 0 msec</span></span>
<span class="line"><span style="color:#a6accd">;; SERVER: 127.0.0.1#8600(127.0.0.1)</span></span>
<span class="line"><span style="color:#a6accd">;; WHEN: Tue Mar 28 16:10:24 2017</span></span>
<span class="line"><span style="color:#a6accd">;; MSG SIZE  rcvd: 52</span></span>
<span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]#</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚ä½ æ‰€è§,ä¸€ä¸ª<code>A</code>è®°å½•è¿”å›äº†ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡æ‰€åœ¨çš„èŠ‚ç‚¹çš„IPåœ°å€.<code>A</code>è®°å½•åªèƒ½è®¾ç½®ä¸ºIPåœ°å€. æœ‰ä¹Ÿå¯ç”¨ä½¿ç”¨ DNS API æ¥æ¥æ”¶åŒ…å« åœ°å€å’Œç«¯å£çš„ SRVè®°å½•:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 web.service.consul SRV</span></span>
<span class="line"><span style="color:#a6accd">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 &lt;&lt;&gt;&gt; @127.0.0.1 -p 8600 web.service.consul SRV</span></span>
<span class="line"><span style="color:#a6accd">; (1 server found)</span></span>
<span class="line"><span style="color:#a6accd">;; global options: +cmd</span></span>
<span class="line"><span style="color:#a6accd">;; Got answer:</span></span>
<span class="line"><span style="color:#a6accd">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 13331</span></span>
<span class="line"><span style="color:#a6accd">;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span>
<span class="line"><span style="color:#a6accd">;; WARNING: recursion requested but not available</span></span>
<span class="line"><span style="color:#a6accd">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#a6accd">;web.service.consul.            IN      SRV</span></span>
<span class="line"><span style="color:#a6accd">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#a6accd">web.service.consul.     0       IN      SRV     1 1 80 s1.node.dc1.consul.</span></span>
<span class="line"><span style="color:#a6accd">;; ADDITIONAL SECTION:</span></span>
<span class="line"><span style="color:#a6accd">s1.node.dc1.consul.     0       IN      A       10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">;; Query time: 0 msec</span></span>
<span class="line"><span style="color:#a6accd">;; SERVER: 127.0.0.1#8600(127.0.0.1)</span></span>
<span class="line"><span style="color:#a6accd">;; WHEN: Tue Mar 28 16:10:56 2017</span></span>
<span class="line"><span style="color:#a6accd">;; MSG SIZE  rcvd: 84</span></span>
<span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]#</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><code>SRV</code>è®°å½•å‘Šè¯‰æˆ‘ä»¬ web è¿™ä¸ªæœåŠ¡è¿è¡ŒäºèŠ‚ç‚¹<code>dhcp-10-201-102-198</code> çš„<code>80</code>ç«¯å£. DNSé¢å¤–è¿”å›äº†èŠ‚ç‚¹çš„Aè®°å½•.</p><p>æœ€å,æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ DNS API é€šè¿‡æ ‡ç­¾æ¥è¿‡æ»¤æœåŠ¡.åŸºäºæ ‡ç­¾çš„æœåŠ¡æŸ¥è¯¢æ ¼å¼ä¸º<code>TAG.NAME.service.consul</code>. åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­,æˆ‘ä»¬è¯·æ±‚Consulè¿”å›æœ‰ <code>rails</code>æ ‡ç­¾çš„ <code>web</code>æœåŠ¡.æˆ‘ä»¬æˆåŠŸè·å–äº†æˆ‘ä»¬æ³¨å†Œä¸ºè¿™ä¸ªæ ‡ç­¾çš„æœåŠ¡:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 rails.web.service.consul SRV</span></span>
<span class="line"><span style="color:#a6accd">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 &lt;&lt;&gt;&gt; @127.0.0.1 -p 8600 rails.web.service.consul SRV</span></span>
<span class="line"><span style="color:#a6accd">; (1 server found)</span></span>
<span class="line"><span style="color:#a6accd">;; global options: +cmd</span></span>
<span class="line"><span style="color:#a6accd">;; Got answer:</span></span>
<span class="line"><span style="color:#a6accd">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 37307</span></span>
<span class="line"><span style="color:#a6accd">;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span>
<span class="line"><span style="color:#a6accd">;; WARNING: recursion requested but not available</span></span>
<span class="line"><span style="color:#a6accd">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#a6accd">;rails.web.service.consul.      IN      SRV</span></span>
<span class="line"><span style="color:#a6accd">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#a6accd">rails.web.service.consul. 0     IN      SRV     1 1 80 s1.node.dc1.consul.</span></span>
<span class="line"><span style="color:#a6accd">;; ADDITIONAL SECTION:</span></span>
<span class="line"><span style="color:#a6accd">s1.node.dc1.consul.     0       IN      A       10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">;; Query time: 0 msec</span></span>
<span class="line"><span style="color:#a6accd">;; SERVER: 127.0.0.1#8600(127.0.0.1)</span></span>
<span class="line"><span style="color:#a6accd">;; WHEN: Tue Mar 28 16:11:45 2017</span></span>
<span class="line"><span style="color:#a6accd">;; MSG SIZE  rcvd: 90</span></span>
<span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]#</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>HTTP API</strong> é™¤äº†DNS APIä¹‹å¤–,HTTP APIä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡ŒæœåŠ¡æŸ¥è¯¢:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -s 127.0.0.1:8500/v1/catalog/service/web | python -m json.tool</span></span>
<span class="line"><span style="color:#a6accd">[</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "Address": "10.201.102.198",</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 492843,</span></span>
<span class="line"><span style="color:#a6accd">        "ID": "422ec677-74ef-8f29-2f22-01effeed6334",</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 492843,</span></span>
<span class="line"><span style="color:#a6accd">        "Node": "s1",</span></span>
<span class="line"><span style="color:#a6accd">        "NodeMeta": {},</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceAddress": "",</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceEnableTagOverride": false,</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceID": "web",</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceName": "web",</span></span>
<span class="line"><span style="color:#a6accd">        "ServicePort": 80,</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceTags": [</span></span>
<span class="line"><span style="color:#a6accd">            "rails"</span></span>
<span class="line"><span style="color:#a6accd">        ],</span></span>
<span class="line"><span style="color:#a6accd">        "TaggedAddresses": {</span></span>
<span class="line"><span style="color:#a6accd">            "lan": "10.201.102.198",</span></span>
<span class="line"><span style="color:#a6accd">            "wan": "10.201.102.198"</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ç›®å½•APIç»™å‡ºæ‰€æœ‰èŠ‚ç‚¹æä¾›çš„æœåŠ¡.ç¨åæˆ‘ä»¬ä¼šåƒé€šå¸¸çš„é‚£æ ·å¸¦ä¸Šå¥åº·æ£€æŸ¥è¿›è¡ŒæŸ¥è¯¢.å°±åƒDNSå†…éƒ¨å¤„ç†çš„é‚£æ ·.è¿™æ˜¯åªæŸ¥çœ‹å¥åº·çš„å®ä¾‹çš„æŸ¥è¯¢æ–¹æ³•:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -s 127.0.0.1:8500/v1/catalog/service/web?passing | python -m json.tool</span></span>
<span class="line"><span style="color:#a6accd">[</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "Address": "10.201.102.198",</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 492843,</span></span>
<span class="line"><span style="color:#a6accd">        "ID": "422ec677-74ef-8f29-2f22-01effeed6334",</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 492843,</span></span>
<span class="line"><span style="color:#a6accd">        "Node": "s1",</span></span>
<span class="line"><span style="color:#a6accd">        "NodeMeta": {},</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceAddress": "",</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceEnableTagOverride": false,</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceID": "web",</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceName": "web",</span></span>
<span class="line"><span style="color:#a6accd">        "ServicePort": 80,</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceTags": [</span></span>
<span class="line"><span style="color:#a6accd">            "rails"</span></span>
<span class="line"><span style="color:#a6accd">        ],</span></span>
<span class="line"><span style="color:#a6accd">        "TaggedAddresses": {</span></span>
<span class="line"><span style="color:#a6accd">            "lan": "10.201.102.198",</span></span>
<span class="line"><span style="color:#a6accd">            "wan": "10.201.102.198"</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="webç®¡ç†ç•Œé¢" tabindex="-1">WEBç®¡ç†ç•Œé¢ <a aria-current="page" href="#webç®¡ç†ç•Œé¢" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ConsulåŒæ—¶æä¾›äº†ä¸€ä¸ªæ¼‚äº®çš„åŠŸèƒ½é½å…¨çš„WEBç•Œé¢,å¼€ç®±å³ç”¨.ç•Œé¢å¯ä»¥ç”¨æ¥æŸ¥çœ‹æ‰€æœ‰çš„èŠ‚ç‚¹,å¯ä»¥æŸ¥çœ‹å¥åº·æ£€æŸ¥å’Œä»–ä»¬çš„å½“å‰çŠ¶æ€.å¯ä»¥è¯»å–å’Œè®¾ç½®K/V å­˜å‚¨çš„æ•°æ®.UIè‡ªåŠ¨æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ.<a href="https://www.consul.io/downloads.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->ç‚¹å‡»å‰å¾€ä¸‹è½½<!--]--></a></p><p><img src="https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/ui_download.png" alt="UI_Download"></p><p>ä¸‹è½½å®Œåä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œå»ºè®®æ‰€æœ‰serverè§’è‰²éƒ½ä½¿ç”¨WebUIï¼Œã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -ui-dir ./consul_ui/ -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><ul><li><code>-ui-dir</code>ï¼š æä¾›å­˜æ”¾web uièµ„æºçš„è·¯å¾„ï¼ŒæŒ‡å‘è¯¥ç›®å½•å¿…é¡»æ˜¯å¯è¯»çš„</li><li><code>-client</code>ï¼šconsulæœåŠ¡ä¾¦å¬åœ°å€ï¼Œè¿™ä¸ªåœ°å€æä¾›HTTPã€DNSã€RPCç­‰æœåŠ¡ï¼Œé»˜è®¤æ˜¯127.0.0.1æ‰€ä»¥ä¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¦‚æœä½ è¦å¯¹å¤–æä¾›æœåŠ¡æ”¹æˆ0.0.0.0 å¯é€šè¿‡<a href="http://10.201.102.198:8500/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://10.201.102.198:8500<!--]--></a>è®¿é—®WEBç®¡ç†ç•Œé¢ã€‚</li></ul><p><img src="https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/ui.png" alt="UI_Download"></p><h2 id="å¥åº·æ£€æŸ¥" tabindex="-1">å¥åº·æ£€æŸ¥ <a aria-current="page" href="#å¥åº·æ£€æŸ¥" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æˆ‘ä»¬ç°åœ¨çœ‹åˆ°Consulè¿è¡Œæ—¶å¦‚æ­¤ç®€å•.æ·»åŠ èŠ‚ç‚¹å’ŒæœåŠ¡,æŸ¥è¯¢èŠ‚ç‚¹å’ŒæœåŠ¡.åœ¨è¿™ä¸€èŠ‚.æˆ‘ä»¬å°†ç»§ç»­æ·»åŠ å¥åº·æ£€æŸ¥åˆ°èŠ‚ç‚¹å’ŒæœåŠ¡.å¥åº·æ£€æŸ¥æ˜¯æœåŠ¡å‘ç°çš„å…³é”®ç»„ä»¶.é¢„é˜²ä½¿ç”¨åˆ°ä¸å¥åº·çš„æœåŠ¡.</p><p>è¿™ä¸€æ­¥å»ºç«‹åœ¨å‰ä¸€èŠ‚çš„Consulé›†ç¾¤åˆ›å»ºä¹‹ä¸Š.ç›®å‰ä½ åº”è¯¥æœ‰ä¸€ä¸ªåŒ…å«å¤šä¸ªèŠ‚ç‚¹çš„Consulé›†ç¾¤.</p><p><strong>è‡ªå®šä¹‰æ£€æŸ¥</strong> å’ŒæœåŠ¡æ³¨å†Œç±»ä¼¼,ä¸€ä¸ªæ£€æŸ¥å¯ä»¥é€šè¿‡æ£€æŸ¥å®šä¹‰æˆ–HTTP APIè¯·æ±‚æ¥æ³¨å†Œ.</p><p>æˆ‘ä»¬å°†ä½¿ç”¨å’Œæ£€æŸ¥å®šä¹‰æ¥æ³¨å†Œæ£€æŸ¥.å’ŒæœåŠ¡ç±»ä¼¼,å› ä¸ºè¿™æ˜¯å»ºç«‹æ£€æŸ¥æœ€å¸¸ç”¨çš„æ–¹å¼.</p><p>åœ¨ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„é…ç½®ç›®å½•å»ºç«‹å®šä¹‰æ–‡ä»¶:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/etc/consul.d/web.json1</span></span>
<span class="line"><span style="color:#a6accd">{"service": {</span></span>
<span class="line"><span style="color:#a6accd">    "name": "Faceid",</span></span>
<span class="line"><span style="color:#a6accd">    "tags": ["extract", "verify", "compare", "idcard"],</span></span>
<span class="line"><span style="color:#a6accd">    "address": "10.201.102.198",</span></span>
<span class="line"><span style="color:#a6accd">    "port": 9000,</span></span>
<span class="line"><span style="color:#a6accd">    "check": {</span></span>
<span class="line"><span style="color:#a6accd">        "name": "ping",</span></span>
<span class="line"><span style="color:#a6accd">        "script": "curl -s localhost:9000",</span></span>
<span class="line"><span style="color:#a6accd">        "interval": "3s"</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>or</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/etc/consul.d/web.json1</span></span>
<span class="line"><span style="color:#a6accd">{"service": {</span></span>
<span class="line"><span style="color:#a6accd">    "name": "Faceid",</span></span>
<span class="line"><span style="color:#a6accd">    "tags": ["extract", "verify", "compare", "idcard"],</span></span>
<span class="line"><span style="color:#a6accd">    "address": "10.201.102.199",</span></span>
<span class="line"><span style="color:#a6accd">    "port": 9000,</span></span>
<span class="line"><span style="color:#a6accd">    "check": {</span></span>
<span class="line"><span style="color:#a6accd">        "id": "api",</span></span>
<span class="line"><span style="color:#a6accd">           "name": "HTTP API on port 9000",</span></span>
<span class="line"><span style="color:#a6accd">        "http": "http://localhost:9000",</span></span>
<span class="line"><span style="color:#a6accd">        "interval": "10s",</span></span>
<span class="line"><span style="color:#a6accd">        "timeout": "1s"</span></span>
<span class="line"><span style="color:#a6accd">        }</span></span>
<span class="line"><span style="color:#a6accd">   }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>more</p><h2 id="æ£€æŸ¥å¥åº·çŠ¶æ€" tabindex="-1">æ£€æŸ¥å¥åº·çŠ¶æ€ <a aria-current="page" href="#æ£€æŸ¥å¥åº·çŠ¶æ€" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æˆ‘ä»¬èƒ½é€‚åº”HTTP APIæ¥æ£€æŸ¥ä»–ä»¬.é¦–å…ˆæˆ‘ä»¬æ£€æŸ¥æœ‰å“ªäº›å¤±è´¥çš„æ£€æŸ¥.ä½¿ç”¨è¿™ä¸ªå‘½ä»¤(æ³¨æ„:è¿™ä¸ªå‘½ä»¤å¯ä»¥è¿è¡Œåœ¨ä»»ä½•èŠ‚ç‚¹)</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -s http://localhost:8500/v1/health/state/critical | python -m json.tool</span></span>
<span class="line"><span style="color:#a6accd">[</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "CheckID": "service:Faceid",</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 493398,</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 493846,</span></span>
<span class="line"><span style="color:#a6accd">        "Name": "Service 'Faceid' check",</span></span>
<span class="line"><span style="color:#a6accd">        "Node": "s1",</span></span>
<span class="line"><span style="color:#a6accd">        "Notes": "",</span></span>
<span class="line"><span style="color:#a6accd">        "Output": "",</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceID": "Faceid",</span></span>
<span class="line"><span style="color:#a6accd">        "ServiceName": "Faceid",</span></span>
<span class="line"><span style="color:#a6accd">        "Status": "critical"</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,åªæœ‰ä¸€ä¸ªæ£€æŸ¥æˆ‘ä»¬çš„<code>web</code>æœåŠ¡åœ¨<code>critical</code>çŠ¶æ€</p><p>å¦å¤–,æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨DNSæŸ¥è¯¢webæœåŠ¡,Consulå°†ä¸ä¼šè¿”å›ç»“æœ.å› ä¸ºæœåŠ¡ä¸å¥åº·.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 Faceid.service.consul SRV</span></span>
<span class="line"><span style="color:#a6accd">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 &lt;&lt;&gt;&gt; @127.0.0.1 -p 8600 Faceid.service.consul SRV</span></span>
<span class="line"><span style="color:#a6accd">; (1 server found)</span></span>
<span class="line"><span style="color:#a6accd">;; global options: +cmd</span></span>
<span class="line"><span style="color:#a6accd">;; Got answer:</span></span>
<span class="line"><span style="color:#a6accd">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40884</span></span>
<span class="line"><span style="color:#a6accd">;; flags: qr aa rd; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 3</span></span>
<span class="line"><span style="color:#a6accd">;; WARNING: recursion requested but not available</span></span>
<span class="line"><span style="color:#a6accd">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#a6accd">;Faceid.service.consul.         IN      SRV</span></span>
<span class="line"><span style="color:#a6accd">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#a6accd">Faceid.service.consul.  0       IN      SRV     1 1 9000 s3.node.dc1.consul.</span></span>
<span class="line"><span style="color:#a6accd">Faceid.service.consul.  0       IN      SRV     1 1 9000 s1.node.dc1.consul.</span></span>
<span class="line"><span style="color:#a6accd">Faceid.service.consul.  0       IN      SRV     1 1 9000 s2.node.dc1.consul.</span></span>
<span class="line"><span style="color:#a6accd">;; ADDITIONAL SECTION:</span></span>
<span class="line"><span style="color:#a6accd">s3.node.dc1.consul.     0       IN      A       10.201.102.200</span></span>
<span class="line"><span style="color:#a6accd">s1.node.dc1.consul.     0       IN      A       10.201.102.198</span></span>
<span class="line"><span style="color:#a6accd">s2.node.dc1.consul.     0       IN      A       10.201.102.199</span></span>
<span class="line"><span style="color:#a6accd">;; Query time: 0 msec</span></span>
<span class="line"><span style="color:#a6accd">;; SERVER: 127.0.0.1#8600(127.0.0.1)</span></span>
<span class="line"><span style="color:#a6accd">;; WHEN: Tue Mar 28 18:20:15 2017</span></span>
<span class="line"><span style="color:#a6accd">;; MSG SIZE  rcvd: 165</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="k-ï¼v" tabindex="-1">K ï¼V <a aria-current="page" href="#k-ï¼v" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>é™¤äº†æä¾›æœåŠ¡å‘ç°å’Œå¥åº·æ£€æŸ¥çš„é›†æˆ.Consulæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„é”®/å€¼å­˜å‚¨.è¿™å¯ä»¥ç”¨æ¥ä¿æŒåŠ¨æ€é…ç½®,ååŠ©æœåŠ¡åè°ƒ,é¢†è¢–é€‰ä¸¾,åšå¼€å‘è€…å¯ä»¥æƒ³åˆ°çš„ä»»ä½•äº‹æƒ….</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -v http://localhost:8500/v1/kv/?recurse</span></span>
<span class="line"><span style="color:#a6accd">* About to connect() to localhost port 8500 (#0)</span></span>
<span class="line"><span style="color:#a6accd">*   Trying ::1... æ‹’ç»è¿æ¥</span></span>
<span class="line"><span style="color:#a6accd">*   Trying 127.0.0.1... connected</span></span>
<span class="line"><span style="color:#a6accd">* Connected to localhost (127.0.0.1) port 8500 (#0)</span></span>
<span class="line"><span style="color:#a6accd">&gt; GET /v1/kv/?recurse HTTP/1.1</span></span>
<span class="line"><span style="color:#a6accd">&gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.21 Basic ECC zlib/1.2.3 libidn/1.18 libssh2/1.4.2</span></span>
<span class="line"><span style="color:#a6accd">&gt; Host: localhost:8500</span></span>
<span class="line"><span style="color:#a6accd">&gt; Accept: */*</span></span>
<span class="line"><span style="color:#a6accd">&gt;</span></span>
<span class="line"><span style="color:#a6accd">&lt; HTTP/1.1 404 Not Found</span></span>
<span class="line"><span style="color:#a6accd">&lt; X-Consul-Index: 1</span></span>
<span class="line"><span style="color:#a6accd">&lt; X-Consul-Knownleader: true</span></span>
<span class="line"><span style="color:#a6accd">&lt; X-Consul-Lastcontact: 0</span></span>
<span class="line"><span style="color:#a6accd">&lt; Date: Thu, 18 Aug 2016 08:21:39 GMT</span></span>
<span class="line"><span style="color:#a6accd">&lt; Content-Length: 0</span></span>
<span class="line"><span style="color:#a6accd">&lt; Content-Type: text/plain; charset=utf-8</span></span>
<span class="line"><span style="color:#a6accd">&lt;</span></span>
<span class="line"><span style="color:#a6accd">* Connection #0 to host localhost left intact</span></span>
<span class="line"><span style="color:#a6accd">* Closing connection #0</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å› ä¸ºæ²¡æœ‰keyæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª404å“åº”.ç°åœ¨æˆ‘ä»¬<code>PUT</code>ä¸€äº›ç¤ºä¾‹çš„Key:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -X PUT -d 'test' http://localhost:8500/v1/kv/web/key1</span></span>
<span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -X PUT -d 'test' http://localhost:8500/v1/kv/web/key2?flags=42</span></span>
<span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -X PUT -d 'test'  http://localhost:8500/v1/kv/web/sub/key3</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æˆ‘ä»¬åˆ›å»ºäº†å€¼ä¸ºâ€testâ€çš„3ä¸ªKey,æ³¨æ„è¿”å›çš„å€¼æ˜¯ç»è¿‡äº†<code>base64</code>ç¼–ç çš„.ç”¨æ¥æ”¯æŒéUTF8ç¼–ç å­—ç¬¦.å¯¹Key <code>web/key2</code>æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªæ ‡å¿—å€¼ä¸º <code>42</code>.æ‰€æœ‰çš„keyæ”¯æŒè®¾ç½®ä¸€ä¸ª64ä½çš„æ•´å½¢æ•°å­—æ ‡å¿—.Consulå†…éƒ¨ä¸é€‚ç”¨è¿™ä¸ªå€¼.ä½†æ˜¯ä»–å¯ä»¥è¢«å®¢æˆ·ç«¯é€‚ç”¨æ¥åšä¸€äº›å…ƒæ•°æ®.</p><p>å®Œæˆè®¾ç½®å,æˆ‘ä»¬å‘èµ·äº†ä¸€ä¸ª<code>GET</code>è¯·æ±‚æ¥æ¥æ”¶å¤šä¸ªkeyçš„å€¼,ä½¿ç”¨<code>?recurse</code>å‚æ•°.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -s http://localhost:8500/v1/kv/web/?recurse | python -m json.tool</span></span>
<span class="line"><span style="color:#a6accd">[</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 502660,</span></span>
<span class="line"><span style="color:#a6accd">        "Flags": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "Key": "web/key1",</span></span>
<span class="line"><span style="color:#a6accd">        "LockIndex": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 502660,</span></span>
<span class="line"><span style="color:#a6accd">        "Value": "dGVzdA=="</span></span>
<span class="line"><span style="color:#a6accd">    },</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 502663,</span></span>
<span class="line"><span style="color:#a6accd">        "Flags": 42,</span></span>
<span class="line"><span style="color:#a6accd">        "Key": "web/key2",</span></span>
<span class="line"><span style="color:#a6accd">        "LockIndex": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 502663,</span></span>
<span class="line"><span style="color:#a6accd">        "Value": "dGVzdA=="</span></span>
<span class="line"><span style="color:#a6accd">    },</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 502665,</span></span>
<span class="line"><span style="color:#a6accd">        "Flags": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "Key": "web/sub/key3",</span></span>
<span class="line"><span style="color:#a6accd">        "LockIndex": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 502665,</span></span>
<span class="line"><span style="color:#a6accd">        "Value": "dGVzdA=="</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½ å¯ä»¥è·å–<strong>å•ä¸ª</strong>çš„key</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -s http://localhost:8500/v1/kv/web/key1 | python -m json.tool</span></span>
<span class="line"><span style="color:#a6accd">[</span></span>
<span class="line"><span style="color:#a6accd">    {</span></span>
<span class="line"><span style="color:#a6accd">        "CreateIndex": 502660,</span></span>
<span class="line"><span style="color:#a6accd">        "Flags": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "Key": "web/key1",</span></span>
<span class="line"><span style="color:#a6accd">        "LockIndex": 0,</span></span>
<span class="line"><span style="color:#a6accd">        "ModifyIndex": 502660,</span></span>
<span class="line"><span style="color:#a6accd">        "Value": "dGVzdA=="</span></span>
<span class="line"><span style="color:#a6accd">    }</span></span>
<span class="line"><span style="color:#a6accd">]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åˆ é™¤keyä¹Ÿå¾ˆç®€å•.é€šè¿‡<code>DELETE</code>åŠ¨ä½œæ¥å®Œæˆ.æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šå®Œæ•´è·¯å¾„æ¥åˆ é™¤ä¸€ä¸ªå•ç‹¬çš„key.æˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>?recurse</code><strong>é€’å½’</strong>çš„åˆ é™¤ä¸»è·¯å¾„ä¸‹æ‰€æœ‰key.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl -X DELETE http://localhost:8500/v1/kv/web/sub?recurse</span></span>
<span class="line"><span style="color:#a6accd">true</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥é€šè¿‡å‘é€ç›¸åŒçš„URLå¹¶æä¾›ä¸åŒçš„æ¶ˆæ¯ä½“çš„<code>PUT</code>è¯·æ±‚å»ä¿®æ”¹ä¸€ä¸ªKey.å¦å¤–,Consulæä¾›ä¸€ä¸ªæ£€æŸ¥å¹¶è®¾ç½®çš„æ“ä½œ,å®ç°åŸå­çš„Keyä¿®æ”¹.é€šè¿‡<code>?cas=å‚æ•°</code>åŠ ä¸Š<code>GET</code>ä¸­æœ€è¿‘çš„<code>ModifyIndex</code>æ¥è¾¾åˆ°. ä¾‹å¦‚æˆ‘ä»¬æƒ³ä¿®æ”¹ â€œweb/key1â€:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">curl -X PUT -d 'newval' http://localhost:8500/v1/kv/web/key1?cas=502660</span></span>
<span class="line"><span style="color:#a6accd">true</span></span>
<span class="line"><span style="color:#a6accd">curl -X PUT -d 'newval' http://localhost:8500/v1/kv/web/key1?cas=502660</span></span>
<span class="line"><span style="color:#a6accd">false</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹,ç¬¬ä¸€æ¬¡<code>CAS</code> æ›´æ–°æˆåŠŸå› ä¸º<code>ModifyIndex</code>æ˜¯<code>502660</code>.è€Œç¬¬äºŒæ¬¡å¤±è´¥æ˜¯å› ä¸º<code>ModifyIndex</code>åœ¨ç¬¬ä¸€æ¬¡æ›´æ–°åå·²ç»ä¸æ˜¯<code>502660</code>äº† .</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ModifyIndex</code>æ¥ç­‰å¾…keyå€¼çš„æ”¹å˜.ä¾‹å¦‚æˆ‘ä»¬æƒ³ç­‰å¾…<code>key2</code>è¢«ä¿®æ”¹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl "http://localhost:8500/v1/kv/web/key2"</span></span>
<span class="line"><span style="color:#a6accd">[{"LockIndex":0,"Key":"web/key2","Flags":42,"Value":"dGVzdA==","CreateIndex":502663,"ModifyIndex":502663}]</span></span>
<span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# curl "http://localhost:8500/v1/kv/web/key2?index=502663&amp;wait=5s"</span></span>
<span class="line"><span style="color:#a6accd">[{"LockIndex":0,"Key":"web/key2","Flags":42,"Value":"dGVzdA==","CreateIndex":502663,"ModifyIndex":502663}]</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é€šè¿‡æä¾› <code>?index=</code>,æˆ‘ä»¬è¯·æ±‚ç­‰å¾…keyå€¼æœ‰ä¸€ä¸ªæ¯”<code>502663</code>æ›´å¤§çš„<code>ModifyIndex</code>.è™½ç„¶<code>?wait=5s</code>å‚æ•°é™åˆ¶äº†è¿™ä¸ªè¯·æ±‚æœ€å¤š5ç§’,å¦åˆ™è¿”å›å½“å‰çš„æœªæ”¹å˜çš„å€¼. è¿™æ ·å¯ä»¥æœ‰æ•ˆçš„ç­‰å¾…keyçš„æ”¹å˜.å¦å¤–,è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨äºç­‰å¾…ä¸€ç»„key.ç›´åˆ°å…¶ä¸­çš„æŸä¸ªkeyæœ‰ä¿®æ”¹.</p><h1 id="conusl-å‘½ä»¤è¡Œ" tabindex="-1">Conusl å‘½ä»¤è¡Œ <a aria-current="page" href="#conusl-å‘½ä»¤è¡Œ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>è§è¯†äº†consulçš„å¼ºå¤§ï¼Œconsulå¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„CLIæ¥æ§åˆ¶ï¼Œconsulåªæœ‰ä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ï¼Œå°±æ˜¯consulå‘½ä»¤ï¼Œconsulå‘½ä»¤å¯ä»¥åŒ…å«agentã€membersç­‰å‚æ•°è¿›è¡Œä½¿ç”¨ï¼Œè¿™ä¸€ç¯‡æ¥å…·ä½“çœ‹çœ‹consul CLIçš„å…·ä½“ç”¨æ³•ï¼Œconsul -hå³å¯çœ‹åˆ°consul cliæ‰€æ”¯æŒçš„å‚æ•°ï¼Œè€Œæ¯ä¸ªå‚æ•°é‡Œé¢åˆæ”¯æŒå…¶ä»–å‚æ•°ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å…·ä½“çœ‹çœ‹ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">[root@dhcp-10-201-102-198 ~]# consul</span></span>
<span class="line"><span style="color:#a6accd">usage: consul [--version] [--help] &lt;command&gt; [&lt;args&gt;]</span></span>
<span class="line"><span style="color:#a6accd">Available commands are:</span></span>
<span class="line"><span style="color:#a6accd">    agent          Runs a Consul agent  è¿è¡Œä¸€ä¸ªconsul agent</span></span>
<span class="line"><span style="color:#a6accd">    configtest     Validate config file</span></span>
<span class="line"><span style="color:#a6accd">    event          Fire a new event</span></span>
<span class="line"><span style="color:#a6accd">    exec           Executes a command on Consul nodes  åœ¨consulèŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤</span></span>
<span class="line"><span style="color:#a6accd">    force-leave    Forces a member of the cluster to enter the "left" state   å¼ºåˆ¶èŠ‚ç‚¹æˆå‘˜åœ¨é›†ç¾¤ä¸­çš„çŠ¶æ€è½¬æ¢åˆ°leftçŠ¶æ€</span></span>
<span class="line"><span style="color:#a6accd">    info           Provides debugging information for operators  æä¾›æ“ä½œçš„debugçº§åˆ«çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">    join           Tell Consul agent to join cluster   åŠ å…¥consulèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­</span></span>
<span class="line"><span style="color:#a6accd">    keygen         Generates a new encryption key  ç”Ÿæˆä¸€ä¸ªæ–°çš„åŠ å¯†key</span></span>
<span class="line"><span style="color:#a6accd">    keyring        Manages gossip layer encryption keys</span></span>
<span class="line"><span style="color:#a6accd">    kv             Interact with the key-value store</span></span>
<span class="line"><span style="color:#a6accd">    leave          Gracefully leaves the Consul cluster and shuts down</span></span>
<span class="line"><span style="color:#a6accd">    lock           Execute a command holding a lock</span></span>
<span class="line"><span style="color:#a6accd">    maint          Controls node or service maintenance mode</span></span>
<span class="line"><span style="color:#a6accd">    members        Lists the members of a Consul cluster    åˆ—å‡ºé›†ç¾¤ä¸­æˆå‘˜</span></span>
<span class="line"><span style="color:#a6accd">    monitor        Stream logs from a Consul agent  æ‰“å°consulèŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">    operator       Provides cluster-level tools for Consul operators</span></span>
<span class="line"><span style="color:#a6accd">    reload         Triggers the agent to reload configuration files   è§¦å‘èŠ‚ç‚¹é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#a6accd">    rtt            Estimates network round trip time between nodes</span></span>
<span class="line"><span style="color:#a6accd">    snapshot       Saves, restores and inspects snapshots of Consul server state</span></span>
<span class="line"><span style="color:#a6accd">    version        Prints the Consul version    æ‰“å°consulçš„ç‰ˆæœ¬ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">    watch          Watch for changes in Consul   ç›‘æ§consulçš„æ”¹å˜</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ›´è¯¦ç»†è§<a href="https://www.consul.io/docs/commands/index.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->å®˜ç½‘<!--]--></a></p><h2 id="agent" tabindex="-1">Agent <a aria-current="page" href="#agent" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>agent</code>æŒ‡ä»¤æ˜¯consulçš„æ ¸å¿ƒï¼Œå®ƒè¿è¡Œagentæ¥ç»´æŠ¤æˆå‘˜çš„é‡è¦ä¿¡æ¯ã€è¿è¡Œæ£€æŸ¥ã€æœåŠ¡å®£å¸ƒã€æŸ¥è¯¢å¤„ç†ç­‰ç­‰ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">==&gt; Usage: consul agent [options]</span></span>
<span class="line"><span style="color:#a6accd">  Starts the Consul agent and runs until an interrupt is received. The</span></span>
<span class="line"><span style="color:#a6accd">  agent represents a single node in a cluster.</span></span>
<span class="line"><span style="color:#a6accd">Options:</span></span>
<span class="line"><span style="color:#a6accd">  -advertise=addr                  Sets the advertise address to use</span></span>
<span class="line"><span style="color:#a6accd">  -advertise-wan=addr              Sets address to advertise on wan instead of</span></span>
<span class="line"><span style="color:#a6accd">                                   advertise addr</span></span>
<span class="line"><span style="color:#a6accd">  -bootstrap                       Sets server to bootstrap mode</span></span>
<span class="line"><span style="color:#a6accd">  -bind=0.0.0.0                    Sets the bind address for cluster</span></span>
<span class="line"><span style="color:#a6accd">                                   communication</span></span>
<span class="line"><span style="color:#a6accd">  -http-port=8500                  Sets the HTTP API port to listen on</span></span>
<span class="line"><span style="color:#a6accd">  -bootstrap-expect=0              Sets server to expect bootstrap mode.</span></span>
<span class="line"><span style="color:#a6accd">  -client=127.0.0.1                Sets the address to bind for client access.</span></span>
<span class="line"><span style="color:#a6accd">                                   This includes RPC, DNS, HTTP and HTTPS (if</span></span>
<span class="line"><span style="color:#a6accd">                                   configured)</span></span>
<span class="line"><span style="color:#a6accd">  -config-file=foo                 Path to a JSON file to read configuration</span></span>
<span class="line"><span style="color:#a6accd">                                   from. This can be specified multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -config-dir=foo                  Path to a directory to read configuration</span></span>
<span class="line"><span style="color:#a6accd">                                   files from. This will read every file ending</span></span>
<span class="line"><span style="color:#a6accd">                                   in ".json" as configuration in this</span></span>
<span class="line"><span style="color:#a6accd">                                   directory in alphabetical order. This can be</span></span>
<span class="line"><span style="color:#a6accd">                                   specified multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -data-dir=path                   Path to a data directory to store agent</span></span>
<span class="line"><span style="color:#a6accd">                                   state</span></span>
<span class="line"><span style="color:#a6accd">  -dev                             Starts the agent in development mode.</span></span>
<span class="line"><span style="color:#a6accd">  -recursor=1.2.3.4                Address of an upstream DNS server.</span></span>
<span class="line"><span style="color:#a6accd">                                   Can be specified multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -dc=east-aws                     Datacenter of the agent (deprecated: use</span></span>
<span class="line"><span style="color:#a6accd">                                   'datacenter' instead).</span></span>
<span class="line"><span style="color:#a6accd">  -datacenter=east-aws             Datacenter of the agent.</span></span>
<span class="line"><span style="color:#a6accd">  -encrypt=key                     Provides the gossip encryption key</span></span>
<span class="line"><span style="color:#a6accd">  -join=1.2.3.4                    Address of an agent to join at start time.</span></span>
<span class="line"><span style="color:#a6accd">                                   Can be specified multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -join-wan=1.2.3.4                Address of an agent to join -wan at start</span></span>
<span class="line"><span style="color:#a6accd">                                   time. Can be specified multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join=1.2.3.4              Address of an agent to join at start time</span></span>
<span class="line"><span style="color:#a6accd">                                   with retries enabled. Can be specified</span></span>
<span class="line"><span style="color:#a6accd">                                   multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-interval=30s              Time to wait between join attempts.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-max=0                     Maximum number of join attempts. Defaults to</span></span>
<span class="line"><span style="color:#a6accd">                                   0, which will retry indefinitely.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-ec2-region           EC2 Region to use for discovering servers to</span></span>
<span class="line"><span style="color:#a6accd">                                   join.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-ec2-tag-key          EC2 tag key to filter on for server</span></span>
<span class="line"><span style="color:#a6accd">                                   discovery</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-ec2-tag-value        EC2 tag value to filter on for server</span></span>
<span class="line"><span style="color:#a6accd">                                   discovery</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-gce-project-name     Google Compute Engine project to discover</span></span>
<span class="line"><span style="color:#a6accd">                                   servers in</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-gce-zone-pattern     Google Compute Engine region or zone to</span></span>
<span class="line"><span style="color:#a6accd">                                   discover servers in (regex pattern)</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-gce-tag-value        Google Compute Engine tag value to filter</span></span>
<span class="line"><span style="color:#a6accd">                                   for server discovery</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-gce-credentials-file Path to credentials JSON file to use with</span></span>
<span class="line"><span style="color:#a6accd">                                   Google Compute Engine</span></span>
<span class="line"><span style="color:#a6accd">  -retry-join-wan=1.2.3.4          Address of an agent to join -wan at start</span></span>
<span class="line"><span style="color:#a6accd">                                   time with retries enabled. Can be specified</span></span>
<span class="line"><span style="color:#a6accd">                                   multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-interval-wan=30s          Time to wait between join -wan attempts.</span></span>
<span class="line"><span style="color:#a6accd">  -retry-max-wan=0                 Maximum number of join -wan attempts.</span></span>
<span class="line"><span style="color:#a6accd">                                   Defaults to 0, which will retry</span></span>
<span class="line"><span style="color:#a6accd">                                   indefinitely.</span></span>
<span class="line"><span style="color:#a6accd">  -log-level=info                  Log level of the agent.</span></span>
<span class="line"><span style="color:#a6accd">  -node=hostname                   Name of this node. Must be unique in the</span></span>
<span class="line"><span style="color:#a6accd">                                   cluster</span></span>
<span class="line"><span style="color:#a6accd">  -node-meta=key:value             An arbitrary metadata key/value pair for</span></span>
<span class="line"><span style="color:#a6accd">                                   this node.</span></span>
<span class="line"><span style="color:#a6accd">                                   This can be specified multiple times.</span></span>
<span class="line"><span style="color:#a6accd">  -protocol=N                      Sets the protocol version. Defaults to</span></span>
<span class="line"><span style="color:#a6accd">                                   latest.</span></span>
<span class="line"><span style="color:#a6accd">  -rejoin                          Ignores a previous leave and attempts to</span></span>
<span class="line"><span style="color:#a6accd">                                   rejoin the cluster.</span></span>
<span class="line"><span style="color:#a6accd">  -server                          Switches agent to server mode.</span></span>
<span class="line"><span style="color:#a6accd">  -syslog                          Enables logging to syslog</span></span>
<span class="line"><span style="color:#a6accd">  -ui                              Enables the built-in static web UI server</span></span>
<span class="line"><span style="color:#a6accd">  -ui-dir=path                     Path to directory containing the Web UI</span></span>
<span class="line"><span style="color:#a6accd">                                   resources</span></span>
<span class="line"><span style="color:#a6accd">  -pid-file=path                   Path to file to store agent PID</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="event" tabindex="-1">event <a aria-current="page" href="#event" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>event</code>å‘½ä»¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥fireè‡ªå®šä¹‰çš„ç”¨æˆ·äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯¹consulæ¥è¯´æ˜¯ä¸é€æ˜çš„ï¼Œä½†å®ƒä»¬å¯ä»¥ç”¨æ¥æ„å»ºè‡ªåŠ¨éƒ¨ç½²ã€é‡å¯æœåŠ¡æˆ–è€…å…¶ä»–è¡ŒåŠ¨çš„è„šæœ¬ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-http-addrï¼šhttpæœåŠ¡çš„åœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤æ˜¯127.0.0.1:8500ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-datacenterï¼šæ•°æ®ä¸­å¿ƒã€‚</span></span>
<span class="line"><span style="color:#a6accd">-nameï¼šäº‹ä»¶çš„åç§°</span></span>
<span class="line"><span style="color:#a6accd">-nodeï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#a6accd">-serviceï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹ä¸ŠåŒ¹é…çš„æœåŠ¡</span></span>
<span class="line"><span style="color:#a6accd">-tagï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹ä¸Šç¬¦åˆtagçš„æœåŠ¡ï¼Œå¿…é¡»å’Œ-serviceä¸€èµ·ä½¿ç”¨ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="exec" tabindex="-1">exec <a aria-current="page" href="#exec" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>exec</code>æŒ‡ä»¤æä¾›äº†ä¸€ç§è¿œç¨‹æ‰§è¡Œæœºåˆ¶ï¼Œæ¯”å¦‚ä½ è¦åœ¨æ‰€æœ‰çš„æœºå™¨ä¸Šæ‰§è¡Œuptimeå‘½ä»¤ï¼Œè¿œç¨‹æ‰§è¡Œçš„å·¥ä½œé€šè¿‡jobæ¥æŒ‡å®šï¼Œå­˜å‚¨åœ¨KVä¸­ï¼Œagentä½¿ç”¨eventç³»ç»Ÿå¯ä»¥å¿«é€Ÿçš„çŸ¥é“æœ‰æ–°çš„jobäº§ç”Ÿï¼Œæ¶ˆæ¯æ˜¯é€šè¿‡gossipåè®®æ¥ä¼ é€’çš„ï¼Œå› æ­¤æ¶ˆæ¯ä¼ é€’æ˜¯æœ€ä½³çš„ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯å‘½ä»¤çš„æ‰§è¡Œã€‚äº‹ä»¶é€šè¿‡gossipæ¥é©±åŠ¨ï¼Œè¿œç¨‹æ‰§è¡Œä¾èµ–KVå­˜å‚¨ç³»ç»Ÿ(å°±åƒæ¶ˆæ¯ä»£ç†ä¸€æ ·)ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-http-addrï¼šhttpæœåŠ¡çš„åœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤æ˜¯127.0.0.1:8500ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-datacenterï¼šæ•°æ®ä¸­å¿ƒã€‚</span></span>
<span class="line"><span style="color:#a6accd">-prefixï¼škeyåœ¨KVç³»ç»Ÿä¸­çš„å‰ç¼€ï¼Œç”¨æ¥å­˜å‚¨è¯·æ±‚æ•°æ®ï¼Œé»˜è®¤æ˜¯_rexec</span></span>
<span class="line"><span style="color:#a6accd">-nodeï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹ï¼Œè¯„ä¼°äº‹ä»¶</span></span>
<span class="line"><span style="color:#a6accd">-serviceï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹ä¸ŠåŒ¹é…çš„æœåŠ¡</span></span>
<span class="line"><span style="color:#a6accd">-tagï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è¿‡æ»¤èŠ‚ç‚¹ä¸Šç¬¦åˆtagçš„æœåŠ¡ï¼Œå¿…é¡»å’Œ-serviceä¸€èµ·ä½¿ç”¨ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-waitï¼šåœ¨èŠ‚ç‚¹å¤šé•¿æ—¶é—´æ²¡æœ‰å“åº”åï¼Œè®¤ä¸ºjobå·²ç»å®Œæˆã€‚</span></span>
<span class="line"><span style="color:#a6accd">-wait-replï¼š</span></span>
<span class="line"><span style="color:#a6accd">-verboseï¼šè¾“å‡ºæ›´å¤šä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="force-leave" tabindex="-1">force-leave <a aria-current="page" href="#force-leave" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>force-leave</code>æ²»ç–—å¯ä»¥å¼ºåˆ¶consulé›†ç¾¤ä¸­çš„æˆå‘˜è¿›å…¥leftçŠ¶æ€(ç©ºé—²çŠ¶æ€)ï¼Œè®°ä½ï¼Œå³ä½¿ä¸€ä¸ªæˆå‘˜å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå®ƒä»æ—§å¯ä»¥å†æ¬¡åŠ å…¥é›†ç¾¤ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„çœŸå®ç›®çš„æ˜¯å¼ºåˆ¶ç§»é™¤failedçš„èŠ‚ç‚¹ã€‚å¦‚æœfailedçš„èŠ‚ç‚¹è¿˜æ˜¯ç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼Œåˆ™consulä¼šå‘¨æœŸæ€§çš„é‡æ–°é“¾æ¥failedçš„èŠ‚ç‚¹ï¼Œå¦‚æœç»è¿‡ä¸€æ®µæ—¶é—´å(é»˜è®¤æ˜¯72å°æ—¶)ï¼Œconsulåˆ™ä¼šå®£å¸ƒåœæ­¢å°è¯•é“¾æ¥failedçš„èŠ‚ç‚¹ã€‚force-leaveæŒ‡ä»¤å¯ä»¥å¿«é€Ÿçš„æŠŠfailedèŠ‚ç‚¹è½¬æ¢åˆ°leftçŠ¶æ€ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-rpc-addr:ä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="info" tabindex="-1">info <a aria-current="page" href="#info" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>info</code>æŒ‡ä»¤æä¾›äº†å„ç§æ“ä½œæ—¶å¯ä»¥ç”¨åˆ°çš„debugä¿¡æ¯ï¼Œå¯¹äºclientå’Œserverï¼Œinfoæœ‰è¿”å›ä¸åŒçš„å­ç³»ç»Ÿä¿¡æ¯ï¼Œç›®å‰æœ‰ä»¥ä¸‹å‡ ä¸ªKVä¿¡æ¯ï¼šagent(æä¾›agentä¿¡æ¯)ï¼Œconsul(æä¾›consulåº“çš„ä¿¡æ¯)ï¼Œraft(æä¾›raftåº“çš„ä¿¡æ¯)ï¼Œserf_lan(æä¾›LAN gossip pool),serf_wan(æä¾›WAN gossip pool)</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-rpc-addrï¼šä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="join" tabindex="-1">join <a aria-current="page" href="#join" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>join</code>æŒ‡ä»¤å‘Šè¯‰consul agentåŠ å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é›†ç¾¤ä¸­ï¼Œä¸€ä¸ªæ–°çš„consul agentå¿…é¡»åŠ å…¥ä¸€ä¸ªå·²ç»æœ‰è‡³å°‘ä¸€ä¸ªæˆå‘˜çš„é›†ç¾¤ä¸­ï¼Œè¿™æ ·å®ƒæ‰èƒ½åŠ å…¥å·²ç»å­˜åœ¨çš„é›†ç¾¤ä¸­ï¼Œå¦‚æœä½ ä¸åŠ å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é›†ç¾¤ï¼Œåˆ™agentæ˜¯å®ƒè‡ªèº«é›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä»–agentåˆ™å¯ä»¥åŠ å…¥è¿›æ¥ã€‚agentså¯ä»¥åŠ å…¥å…¶ä»–agentå¤šæ¬¡ã€‚consul join [options] addressã€‚å¦‚æœä½ æƒ³åŠ å…¥å¤šä¸ªé›†ç¾¤ï¼Œåˆ™å¯ä»¥å†™å¤šä¸ªåœ°å€ï¼Œconsulä¼šåŠ å…¥æ‰€æœ‰çš„åœ°å€ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-wanï¼šagentè¿è¡Œåœ¨serveræ¨¡å¼ï¼Œxxxxxxx</span></span>
<span class="line"><span style="color:#a6accd">-rpc-addrï¼šä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="keygen" tabindex="-1">keygen <a aria-current="page" href="#keygen" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>keygen</code>æŒ‡ä»¤ç”ŸæˆåŠ å¯†çš„å¯†é’¥ï¼Œå¯ä»¥ç”¨åœ¨consul agenté€šè®¯åŠ å¯†</p><p>ç”Ÿæˆä¸€ä¸ªkey</p><h2 id="leave" tabindex="-1">leave <a aria-current="page" href="#leave" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>leave</code>æŒ‡ä»¤è§¦å‘ä¸€ä¸ªä¼˜é›…çš„ç¦»å¼€åŠ¨ä½œå¹¶å…³é—­agentï¼ŒèŠ‚ç‚¹ç¦»å¼€åä¸ä¼šå°è¯•é‡æ–°åŠ å…¥é›†ç¾¤ä¸­ã€‚è¿è¡Œåœ¨serverçŠ¶æ€çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«ä¼˜é›…çš„åˆ é™¤ï¼Œè¿™æ˜¯å¾ˆä¸¥é‡çš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¸€ä¸ªä¸ä¼˜é›…çš„ç¦»å¼€ä¼šå½±å“åˆ°é›†ç¾¤çš„å¯ç”¨æ€§ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-rpc-addr:ä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="members" tabindex="-1">members <a aria-current="page" href="#members" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>members</code>æŒ‡ä»¤è¾“å‡ºconsul agentç›®å‰æ‰€çŸ¥é“çš„æ‰€æœ‰çš„æˆå‘˜ä»¥åŠå®ƒä»¬çš„çŠ¶æ€ï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€åªæœ‰aliveã€leftã€failedä¸‰ç§çŠ¶æ€ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-detailedï¼šè¾“å‡ºæ¯ä¸ªèŠ‚ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-rpc-addrï¼šä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-statusï¼šè¿‡æ»¤å‡ºç¬¦åˆæ­£åˆ™è§„åˆ™çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#a6accd">-wanï¼šxxxxxx</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="monitor" tabindex="-1">monitor <a aria-current="page" href="#monitor" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>monitor</code>æŒ‡ä»¤ç”¨æ¥é“¾æ¥è¿è¡Œçš„agentï¼Œå¹¶æ˜¾ç¤ºæ—¥å¿—ã€‚monitorä¼šæ˜¾ç¤ºæœ€è¿‘çš„æ—¥å¿—ï¼Œå¹¶æŒç»­çš„æ˜¾ç¤ºæ—¥å¿—æµï¼Œä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œé™¤éä½ æ‰‹åŠ¨æˆ–è€…è¿œç¨‹agentè‡ªå·±é€€å‡ºã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-log-levelï¼šæ˜¾ç¤ºå“ªä¸ªçº§åˆ«çš„æ—¥å¿—ï¼Œé»˜è®¤æ˜¯info</span></span>
<span class="line"><span style="color:#a6accd">-rpc-addrï¼šä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="reload" tabindex="-1">reload <a aria-current="page" href="#reload" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>reload</code>æŒ‡ä»¤å¯ä»¥é‡æ–°åŠ è½½agentçš„é…ç½®æ–‡ä»¶ã€‚SIGHUPæŒ‡ä»¤åœ¨é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶æ—¶ä½¿ç”¨ï¼Œä»»ä½•é‡æ–°åŠ è½½çš„é”™è¯¯éƒ½ä¼šå†™åœ¨agentçš„logæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸ä¼šæ‰“å°åˆ°å±å¹•ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-rpc-addrï¼šä¸€ä¸ªrpcåœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯127.0.0.1:8400</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="version" tabindex="-1">version <a aria-current="page" href="#version" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æ‰“å°consulçš„ç‰ˆæœ¬</p><h2 id="watch" tabindex="-1">watch <a aria-current="page" href="#watch" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><code>watch</code>æŒ‡ä»¤æä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼Œç”¨æ¥ç›‘è§†å®é™…æ•°æ®è§†å›¾çš„æ”¹å˜(èŠ‚ç‚¹åˆ—è¡¨ã€æˆå‘˜æœåŠ¡ã€KV)ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿›ç¨‹ï¼Œå½“å‰å€¼ä¼šè¢«dumpå‡ºæ¥</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-http-addrï¼šhttpæœåŠ¡çš„åœ°å€ï¼Œagentå¯ä»¥é“¾æ¥ä¸Šæ¥å‘é€å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤æ˜¯127.0.0.1:8500ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-datacenterï¼šæ•°æ®ä¸­å¿ƒæŸ¥è¯¢ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-tokenï¼šACL token</span></span>
<span class="line"><span style="color:#a6accd">-keyï¼šç›‘è§†keyï¼Œåªé’ˆå¯¹keyç±»å‹</span></span>
<span class="line"><span style="color:#a6accd">-nameï¼šç›‘è§†eventï¼Œåªé’ˆå¯¹eventç±»å‹</span></span>
<span class="line"><span style="color:#a6accd">-prefixï¼šç›‘è§†key prefixï¼Œåªé’ˆå¯¹keyprefixç±»å‹</span></span>
<span class="line"><span style="color:#a6accd">-serviceï¼šç›‘æ§serviceï¼Œåªé’ˆå¯¹serviceç±»å‹</span></span>
<span class="line"><span style="color:#a6accd">-stateï¼šè¿‡ç•¥check state</span></span>
<span class="line"><span style="color:#a6accd">-tagï¼šè¿‡æ»¤service tag</span></span>
<span class="line"><span style="color:#a6accd">-typeï¼šç›‘æ§ç±»å‹ï¼Œä¸€èˆ¬æœ‰keyã€keyprefixã€serviceã€nodesã€checksã€event</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="consul-é…ç½®" tabindex="-1">Consul é…ç½® <a aria-current="page" href="#consul-é…ç½®" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>agentæœ‰å„ç§å„æ ·çš„é…ç½®é¡¹å¯ä»¥åœ¨å‘½ä»¤è¡Œæˆ–è€…é…ç½®æ–‡ä»¶è¿›è¡Œå®šä¹‰ï¼Œæ‰€æœ‰çš„é…ç½®é¡¹éƒ½æ˜¯å¯é€‰æ‹©çš„ï¼Œå½“åŠ è½½é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œconsulä»é…ç½®æ–‡ä»¶æˆ–è€…é…ç½®ç›®å½•åŠ è½½é…ç½®ã€‚åé¢å®šä¹‰çš„é…ç½®ä¼šåˆå¹¶å‰é¢å®šä¹‰çš„é…ç½®ï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåˆå¹¶çš„æ„æ€æ˜¯åé¢å®šä¹‰çš„é…ç½®ä¼šè¦†ç›–å‰é¢å®šä¹‰çš„é…ç½®ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µï¼Œä¾‹å¦‚eventå¥æŸ„ï¼Œåˆå¹¶ä»…ä»…æ˜¯æ·»åŠ åˆ°å‰é¢å®šä¹‰çš„å¥æŸ„åé¢ã€‚consulé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ä¹Ÿæ”¯æŒä»¥ä¿¡å·çš„æ–¹å¼æ¥æ”¶updateä¿¡å·ã€‚</p><p>ä¸‹é¢çœ‹çœ‹å‘½ä»¤è¡Œå‚æ•°ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-advertiseï¼šé€šçŸ¥å±•ç°åœ°å€ç”¨æ¥æ”¹å˜æˆ‘ä»¬ç»™é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å±•ç°çš„åœ°å€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹-bindåœ°å€å°±æ˜¯å±•ç°åœ°å€</span></span>
<span class="line"><span style="color:#a6accd">-bootstrapï¼šç”¨æ¥æ§åˆ¶ä¸€ä¸ªserveræ˜¯å¦åœ¨bootstrapæ¨¡å¼ï¼Œåœ¨ä¸€ä¸ªdatacenterä¸­åªèƒ½æœ‰ä¸€ä¸ªserverå¤„äºbootstrapæ¨¡å¼ï¼Œå½“ä¸€ä¸ªserverå¤„äºbootstrapæ¨¡å¼æ—¶ï¼Œå¯ä»¥è‡ªå·±é€‰ä¸¾ä¸ºraft leaderã€‚</span></span>
<span class="line"><span style="color:#a6accd">-bootstrap-expectï¼šåœ¨ä¸€ä¸ªdatacenterä¸­æœŸæœ›æä¾›çš„serverèŠ‚ç‚¹æ•°ç›®ï¼Œå½“è¯¥å€¼æä¾›çš„æ—¶å€™ï¼Œconsulä¸€ç›´ç­‰åˆ°è¾¾åˆ°æŒ‡å®šseveræ•°ç›®çš„æ—¶å€™æ‰ä¼šå¼•å¯¼æ•´ä¸ªé›†ç¾¤ï¼Œè¯¥æ ‡è®°ä¸èƒ½å’Œbootstrapå…¬ç”¨</span></span>
<span class="line"><span style="color:#a6accd">-bindï¼šè¯¥åœ°å€ç”¨æ¥åœ¨é›†ç¾¤å†…éƒ¨çš„é€šè®¯ï¼Œé›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹åˆ°åœ°å€éƒ½å¿…é¡»æ˜¯å¯è¾¾çš„ï¼Œé»˜è®¤æ˜¯0.0.0.0</span></span>
<span class="line"><span style="color:#a6accd">-clientï¼šconsulç»‘å®šåœ¨å“ªä¸ªclientåœ°å€ä¸Šï¼Œè¿™ä¸ªåœ°å€æä¾›HTTPã€DNSã€RPCç­‰æœåŠ¡ï¼Œé»˜è®¤æ˜¯127.0.0.1</span></span>
<span class="line"><span style="color:#a6accd">-config-fileï¼šæ˜ç¡®çš„æŒ‡å®šè¦åŠ è½½å“ªä¸ªé…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#a6accd">-config-dirï¼šé…ç½®æ–‡ä»¶ç›®å½•ï¼Œé‡Œé¢æ‰€æœ‰ä»¥.jsonç»“å°¾çš„æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½</span></span>
<span class="line"><span style="color:#a6accd">-data-dirï¼šæä¾›ä¸€ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾agentçš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„agentå…è®¸éƒ½éœ€è¦è¯¥ç›®å½•ï¼Œè¯¥ç›®å½•å¿…é¡»æ˜¯ç¨³å®šçš„ï¼Œç³»ç»Ÿé‡å¯åéƒ½ç»§ç»­å­˜åœ¨</span></span>
<span class="line"><span style="color:#a6accd">-dcï¼šè¯¥æ ‡è®°æ§åˆ¶agentå…è®¸çš„datacenterçš„åç§°ï¼Œé»˜è®¤æ˜¯dc1</span></span>
<span class="line"><span style="color:#a6accd">-encryptï¼šæŒ‡å®šsecret keyï¼Œä½¿consulåœ¨é€šè®¯æ—¶è¿›è¡ŒåŠ å¯†ï¼Œkeyå¯ä»¥é€šè¿‡consul keygenç”Ÿæˆï¼ŒåŒä¸€ä¸ªé›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„key</span></span>
<span class="line"><span style="color:#a6accd">-joinï¼šåŠ å…¥ä¸€ä¸ªå·²ç»å¯åŠ¨çš„agentçš„ipåœ°å€ï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šå¤šä¸ªagentçš„åœ°å€ã€‚å¦‚æœconsulä¸èƒ½åŠ å…¥ä»»ä½•æŒ‡å®šçš„åœ°å€ä¸­ï¼Œåˆ™agentä¼šå¯åŠ¨å¤±è´¥ï¼Œé»˜è®¤agentå¯åŠ¨æ—¶ä¸ä¼šåŠ å…¥ä»»ä½•èŠ‚ç‚¹ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-retry-joinï¼šå’Œjoinç±»ä¼¼ï¼Œä½†æ˜¯å…è®¸ä½ åœ¨ç¬¬ä¸€æ¬¡å¤±è´¥åè¿›è¡Œå°è¯•ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-retry-intervalï¼šä¸¤æ¬¡joinä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯30s</span></span>
<span class="line"><span style="color:#a6accd">-retry-maxï¼šå°è¯•é‡å¤joinçš„æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯0ï¼Œä¹Ÿå°±æ˜¯æ— é™æ¬¡å°è¯•</span></span>
<span class="line"><span style="color:#a6accd">-log-levelï¼šconsul agentå¯åŠ¨åæ˜¾ç¤ºçš„æ—¥å¿—ä¿¡æ¯çº§åˆ«ã€‚é»˜è®¤æ˜¯infoï¼Œå¯é€‰ï¼štraceã€debugã€infoã€warnã€errã€‚</span></span>
<span class="line"><span style="color:#a6accd">-nodeï¼šèŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­çš„åç§°ï¼Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œé»˜è®¤æ˜¯è¯¥èŠ‚ç‚¹çš„ä¸»æœºå</span></span>
<span class="line"><span style="color:#a6accd">-protocolï¼šconsulä½¿ç”¨çš„åè®®ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#a6accd">-rejoinï¼šä½¿consulå¿½ç•¥å…ˆå‰çš„ç¦»å¼€ï¼Œåœ¨å†æ¬¡å¯åŠ¨åä»æ—§å°è¯•åŠ å…¥é›†ç¾¤ä¸­ã€‚</span></span>
<span class="line"><span style="color:#a6accd">-serverï¼šå®šä¹‰agentè¿è¡Œåœ¨serveræ¨¡å¼ï¼Œæ¯ä¸ªé›†ç¾¤è‡³å°‘æœ‰ä¸€ä¸ªserverï¼Œå»ºè®®æ¯ä¸ªé›†ç¾¤çš„serverä¸è¦è¶…è¿‡5ä¸ª</span></span>
<span class="line"><span style="color:#a6accd">-syslogï¼šå¼€å¯ç³»ç»Ÿæ—¥å¿—åŠŸèƒ½ï¼Œåªåœ¨linux/osxä¸Šç”Ÿæ•ˆ</span></span>
<span class="line"><span style="color:#a6accd">-ui-dir:æä¾›å­˜æ”¾web uièµ„æºçš„è·¯å¾„ï¼Œè¯¥ç›®å½•å¿…é¡»æ˜¯å¯è¯»çš„</span></span>
<span class="line"><span style="color:#a6accd">-pid-file:æä¾›ä¸€ä¸ªè·¯å¾„æ¥å­˜æ”¾pidæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–‡ä»¶è¿›è¡ŒSIGINT/SIGHUP(å…³é—­/æ›´æ–°)agent</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é™¤äº†å‘½ä»¤è¡Œå‚æ•°å¤–ï¼Œé…ç½®ä¹Ÿå¯ä»¥å†™å…¥æ–‡ä»¶ä¸­ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹é…ç½®æ–‡ä»¶ä¼šæ›´ç®€å•ä¸€äº›ï¼Œä¾‹å¦‚ï¼šåˆ©ç”¨consulè¢«ç”¨æ¥ç®¡ç†ç³»ç»Ÿã€‚é…ç½®æ–‡ä»¶æ˜¯jsonæ ¼å¼çš„ï¼Œå¾ˆå®¹æ˜“ç¼–å†™ã€‚é…ç½®æ–‡ä»¶ä¸ä»…è¢«ç”¨æ¥è®¾ç½®agentçš„å¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æä¾›å¥åº·æ£€æµ‹å’ŒæœåŠ¡å‘ç°çš„å®šä¹‰ã€‚é…ç½®æ–‡ä»¶çš„ä¸€èˆ¬æ ·ä¾‹å¦‚ä¸‹ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{</span></span>
<span class="line"><span style="color:#a6accd">  "datacenter": "dc1",</span></span>
<span class="line"><span style="color:#a6accd">  "data_dir": "/opt/consul",</span></span>
<span class="line"><span style="color:#a6accd">  "log_level": "INFO",</span></span>
<span class="line"><span style="color:#a6accd">  "node_name": "s1",</span></span>
<span class="line"><span style="color:#a6accd">  "server": true,</span></span>
<span class="line"><span style="color:#a6accd">  "bootstrap_expect": 3,</span></span>
<span class="line"><span style="color:#a6accd">  "bind_addr": "10.201.102.198",</span></span>
<span class="line"><span style="color:#a6accd">  "client_addr": "0.0.0.0",</span></span>
<span class="line"><span style="color:#a6accd">  "ui_dir": "/root/consul_ui",</span></span>
<span class="line"><span style="color:#a6accd">  "retry_join": ["10.201.102.198","10.201.102.199","10.201.102.200","10.201.102.248"],</span></span>
<span class="line"><span style="color:#a6accd">  "retry_interval": "30s",</span></span>
<span class="line"><span style="color:#a6accd">  "enable_debug": false,</span></span>
<span class="line"><span style="color:#a6accd">  "rejoin_after_leave": true,</span></span>
<span class="line"><span style="color:#a6accd">  "start_join": ["10.201.102.198","10.201.102.199","10.201.102.200","10.201.102.248"],</span></span>
<span class="line"><span style="color:#a6accd">  "enable_syslog": true,</span></span>
<span class="line"><span style="color:#a6accd">  "syslog_facility": "local5"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸‹é¢çœ‹çœ‹è¯¦ç»†çš„é…ç½®æ–‡ä»¶å‚æ•°ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">acl_datacenterï¼šåªç”¨äºserverï¼ŒæŒ‡å®šçš„datacenterçš„æƒå¨ACLä¿¡æ¯ï¼Œæ‰€æœ‰çš„serverså’Œdatacenterå¿…é¡»åŒæ„ACL datacenter</span></span>
<span class="line"><span style="color:#a6accd">acl_default_policyï¼šé»˜è®¤æ˜¯allow</span></span>
<span class="line"><span style="color:#a6accd">acl_down_policyï¼š</span></span>
<span class="line"><span style="color:#a6accd">acl_master_tokenï¼š</span></span>
<span class="line"><span style="color:#a6accd">acl_tokenï¼šagentä¼šä½¿ç”¨è¿™ä¸ªtokenå’Œconsul serverè¿›è¡Œè¯·æ±‚</span></span>
<span class="line"><span style="color:#a6accd">acl_ttlï¼šæ§åˆ¶TTLçš„cacheï¼Œé»˜è®¤æ˜¯30s</span></span>
<span class="line"><span style="color:#a6accd">addressesï¼šä¸€ä¸ªåµŒå¥—å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹keyï¼šdnsã€httpã€rpc</span></span>
<span class="line"><span style="color:#a6accd">advertise_addrï¼šç­‰åŒäº-advertise</span></span>
<span class="line"><span style="color:#a6accd">bootstrapï¼šç­‰åŒäº-bootstrap</span></span>
<span class="line"><span style="color:#a6accd">bootstrap_expectï¼šç­‰åŒäº-bootstrap-expect</span></span>
<span class="line"><span style="color:#a6accd">bind_addrï¼šç­‰åŒäº-bind</span></span>
<span class="line"><span style="color:#a6accd">ca_fileï¼šæä¾›CAæ–‡ä»¶è·¯å¾„ï¼Œç”¨æ¥æ£€æŸ¥å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯çš„é“¾æ¥</span></span>
<span class="line"><span style="color:#a6accd">cert_fileï¼šå¿…é¡»å’Œkey_fileä¸€èµ·</span></span>
<span class="line"><span style="color:#a6accd">check_update_intervalï¼š</span></span>
<span class="line"><span style="color:#a6accd">client_addrï¼šç­‰åŒäº-client</span></span>
<span class="line"><span style="color:#a6accd">datacenterï¼šç­‰åŒäº-dc</span></span>
<span class="line"><span style="color:#a6accd">data_dirï¼šç­‰åŒäº-data-dir</span></span>
<span class="line"><span style="color:#a6accd">disable_anonymous_signatureï¼šåœ¨è¿›è¡Œæ›´æ–°æ£€æŸ¥æ—¶ç¦æ­¢åŒ¿åç­¾å</span></span>
<span class="line"><span style="color:#a6accd">disable_remote_execï¼šç¦æ­¢æ”¯æŒè¿œç¨‹æ‰§è¡Œï¼Œè®¾ç½®ä¸ºtrueï¼Œagentä¼šå¿½è§†æ‰€æœ‰è¿›å…¥çš„è¿œç¨‹æ‰§è¡Œè¯·æ±‚</span></span>
<span class="line"><span style="color:#a6accd">disable_update_checkï¼šç¦æ­¢è‡ªåŠ¨æ£€æŸ¥å®‰å…¨å…¬å‘Šå’Œæ–°ç‰ˆæœ¬ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">dns_configï¼šæ˜¯ä¸€ä¸ªåµŒå¥—å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼šallow_staleã€max_staleã€node_ttl ã€service_ttlã€enable_truncate</span></span>
<span class="line"><span style="color:#a6accd">domainï¼šé»˜è®¤æƒ…å†µä¸‹consulåœ¨è¿›è¡ŒDNSæŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢çš„æ˜¯consulåŸŸï¼Œå¯ä»¥é€šè¿‡è¯¥å‚æ•°è¿›è¡Œä¿®æ”¹</span></span>
<span class="line"><span style="color:#a6accd">enable_debugï¼šå¼€å¯debugæ¨¡å¼</span></span>
<span class="line"><span style="color:#a6accd">enable_syslogï¼šç­‰åŒäº-syslog</span></span>
<span class="line"><span style="color:#a6accd">encryptï¼šç­‰åŒäº-encrypt</span></span>
<span class="line"><span style="color:#a6accd">key_fileï¼šæä¾›ç§é’¥çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#a6accd">leave_on_terminateï¼šé»˜è®¤æ˜¯falseï¼Œå¦‚æœä¸ºtrueï¼Œå½“agentæ”¶åˆ°ä¸€ä¸ªTERMä¿¡å·çš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€leaveä¿¡æ¯åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚</span></span>
<span class="line"><span style="color:#a6accd">log_levelï¼šç­‰åŒäº-log-level</span></span>
<span class="line"><span style="color:#a6accd">node_name:ç­‰åŒäº-node</span></span>
<span class="line"><span style="color:#a6accd">portsï¼šè¿™æ˜¯ä¸€ä¸ªåµŒå¥—å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹keyï¼šdns(dnsåœ°å€ï¼š8600)ã€http(http apiåœ°å€ï¼š8500)ã€rpc(rpc:8400)ã€serf_lan(lan port:8301)ã€serf_wan(wan port:8302)ã€server(server rpc:8300)</span></span>
<span class="line"><span style="color:#a6accd">protocolï¼šç­‰åŒäº-protocol</span></span>
<span class="line"><span style="color:#a6accd">recursorï¼š</span></span>
<span class="line"><span style="color:#a6accd">rejoin_after_leaveï¼šç­‰åŒäº-rejoin</span></span>
<span class="line"><span style="color:#a6accd">retry_joinï¼šç­‰åŒäº-retry-join</span></span>
<span class="line"><span style="color:#a6accd">retry_intervalï¼šç­‰åŒäº-retry-interval</span></span>
<span class="line"><span style="color:#a6accd">serverï¼šç­‰åŒäº-server</span></span>
<span class="line"><span style="color:#a6accd">server_nameï¼šä¼šè¦†ç›–TLS CAçš„node_nameï¼Œå¯ä»¥ç”¨æ¥ç¡®è®¤CA nameå’Œhostnameç›¸åŒ¹é…</span></span>
<span class="line"><span style="color:#a6accd">skip_leave_on_interruptï¼šå’Œleave_on_terminateæ¯”è¾ƒç±»ä¼¼ï¼Œä¸è¿‡åªå½±å“å½“å‰å¥æŸ„</span></span>
<span class="line"><span style="color:#a6accd">start_joinï¼šä¸€ä¸ªå­—ç¬¦æ•°ç»„æä¾›çš„èŠ‚ç‚¹åœ°å€ä¼šåœ¨å¯åŠ¨æ—¶è¢«åŠ å…¥</span></span>
<span class="line"><span style="color:#a6accd">statsd_addrï¼š</span></span>
<span class="line"><span style="color:#a6accd">statsite_addrï¼š</span></span>
<span class="line"><span style="color:#a6accd">syslog_facilityï¼šå½“enable_syslogè¢«æä¾›åï¼Œè¯¥å‚æ•°æ§åˆ¶å“ªä¸ªçº§åˆ«çš„ä¿¡æ¯è¢«å‘é€ï¼Œé»˜è®¤Local0</span></span>
<span class="line"><span style="color:#a6accd">ui_dirï¼šç­‰åŒäº-ui-dir</span></span>
<span class="line"><span style="color:#a6accd">verify_incomingï¼šé»˜è®¤falseï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™æ‰€æœ‰è¿›å…¥é“¾æ¥éƒ½éœ€è¦ä½¿ç”¨TLSï¼Œéœ€è¦å®¢æˆ·ç«¯ä½¿ç”¨ca_fileæä¾›caæ–‡ä»¶ï¼Œåªç”¨äºconsul serverç«¯ï¼Œå› ä¸ºclientä»æ¥æ²¡æœ‰è¿›å…¥çš„é“¾æ¥</span></span>
<span class="line"><span style="color:#a6accd">verify_outgoingï¼šé»˜è®¤falseï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™æ‰€æœ‰å‡ºå»é“¾æ¥éƒ½éœ€è¦ä½¿ç”¨TLSï¼Œéœ€è¦æœåŠ¡ç«¯ä½¿ç”¨ca_fileæä¾›caæ–‡ä»¶ï¼Œconsul serverå’Œclientéƒ½éœ€è¦ä½¿ç”¨ï¼Œå› ä¸ºä¸¤è€…éƒ½æœ‰å‡ºå»çš„é“¾æ¥</span></span>
<span class="line"><span style="color:#a6accd">watchesï¼šwatchä¸€ä¸ªè¯¦ç»†åå•</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="http-api" tabindex="-1">HTTP API <a aria-current="page" href="#http-api" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>consulçš„ä¸»è¦æ¥å£æ˜¯RESTful HTTP APIï¼Œè¯¥APIå¯ä»¥ç”¨æ¥å¢åˆ æŸ¥æ”¹nodesã€servicesã€checksã€configgurationã€‚æ‰€æœ‰çš„endpointsä¸»è¦åˆ†ä¸ºä»¥ä¸‹ç±»åˆ«ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">kv - Key/Valueå­˜å‚¨</span></span>
<span class="line"><span style="color:#a6accd">agent - Agentæ§åˆ¶</span></span>
<span class="line"><span style="color:#a6accd">catalog - ç®¡ç†nodeså’Œservices</span></span>
<span class="line"><span style="color:#a6accd">health - ç®¡ç†å¥åº·ç›‘æµ‹</span></span>
<span class="line"><span style="color:#a6accd">session - Sessionæ“ä½œ</span></span>
<span class="line"><span style="color:#a6accd">acl - ACLåˆ›å»ºå’Œç®¡ç†</span></span>
<span class="line"><span style="color:#a6accd">event - ç”¨æˆ·Events</span></span>
<span class="line"><span style="color:#a6accd">status - Consulç³»ç»ŸçŠ¶æ€</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸‹é¢æˆ‘ä»¬å°±å•ç‹¬çœ‹çœ‹æ¯ä¸ªæ¨¡å—çš„å…·ä½“å†…å®¹ã€‚</p><h2 id="agent-1" tabindex="-1">agent <a aria-current="page" href="#agent-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>agent endpointsç”¨æ¥å’Œæœ¬åœ°agentè¿›è¡Œäº¤äº’ï¼Œä¸€èˆ¬ç”¨æ¥æœåŠ¡æ³¨å†Œå’Œæ£€æŸ¥æ³¨å†Œï¼Œæ”¯æŒä»¥ä¸‹æ¥å£</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/agent/checks : è¿”å›æœ¬åœ°agentæ³¨å†Œçš„æ‰€æœ‰æ£€æŸ¥(åŒ…æ‹¬é…ç½®æ–‡ä»¶å’ŒHTTPæ¥å£)</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/services : è¿”å›æœ¬åœ°agentæ³¨å†Œçš„æ‰€æœ‰ æœåŠ¡</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/members : è¿”å›agentåœ¨é›†ç¾¤çš„gossip poolä¸­çœ‹åˆ°çš„æˆå‘˜</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/self : è¿”å›æœ¬åœ°agentçš„é…ç½®å’Œæˆå‘˜ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/join/&lt;address&gt; : è§¦å‘æœ¬åœ°agentåŠ å…¥node</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/force-leave/&lt;node&gt;&gt;: å¼ºåˆ¶åˆ é™¤node</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/check/register : åœ¨æœ¬åœ°agentå¢åŠ ä¸€ä¸ªæ£€æŸ¥é¡¹ï¼Œä½¿ç”¨PUTæ–¹æ³•ä¼ è¾“ä¸€ä¸ªjsonæ ¼å¼çš„æ•°æ®</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/check/deregister/&lt;checkID&gt; : æ³¨é”€ä¸€ä¸ªæœ¬åœ°agentçš„æ£€æŸ¥é¡¹</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/check/pass/&lt;checkID&gt; : è®¾ç½®ä¸€ä¸ªæœ¬åœ°æ£€æŸ¥é¡¹çš„çŠ¶æ€ä¸ºpassing</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/check/warn/&lt;checkID&gt; : è®¾ç½®ä¸€ä¸ªæœ¬åœ°æ£€æŸ¥é¡¹çš„çŠ¶æ€ä¸ºwarning</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/check/fail/&lt;checkID&gt; : è®¾ç½®ä¸€ä¸ªæœ¬åœ°æ£€æŸ¥é¡¹çš„çŠ¶æ€ä¸ºcritical</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/service/register : åœ¨æœ¬åœ°agentå¢åŠ ä¸€ä¸ªæ–°çš„æœåŠ¡é¡¹ï¼Œä½¿ç”¨PUTæ–¹æ³•ä¼ è¾“ä¸€ä¸ªjsonæ ¼å¼çš„æ•°æ®</span></span>
<span class="line"><span style="color:#a6accd">/v1/agent/service/deregister/&lt;serviceID&gt; : æ³¨é”€ä¸€ä¸ªæœ¬åœ°agentçš„æœåŠ¡é¡¹</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="catalog" tabindex="-1">catalog <a aria-current="page" href="#catalog" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>catalog endpointsç”¨æ¥æ³¨å†Œ/æ³¨é”€nodesã€servicesã€checks</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/catalog/register : Registers a new node, service, or check</span></span>
<span class="line"><span style="color:#a6accd">/v1/catalog/deregister : Deregisters a node, service, or check</span></span>
<span class="line"><span style="color:#a6accd">/v1/catalog/datacenters : Lists known datacenters</span></span>
<span class="line"><span style="color:#a6accd">/v1/catalog/nodes : Lists nodes in a given DC</span></span>
<span class="line"><span style="color:#a6accd">/v1/catalog/services : Lists services in a given DC</span></span>
<span class="line"><span style="color:#a6accd">/v1/catalog/service/&lt;service&gt; : Lists the nodes in a given service</span></span>
<span class="line"><span style="color:#a6accd">/v1/catalog/node/&lt;node&gt; : Lists the services provided by a node</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="health" tabindex="-1">health <a aria-current="page" href="#health" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>health endpointsç”¨æ¥æŸ¥è¯¢å¥åº·çŠ¶å†µç›¸å…³ä¿¡æ¯ï¼Œè¯¥åŠŸèƒ½ä»catalogä¸­å•ç‹¬åˆ†ç¦»å‡ºæ¥</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/healt/node/&lt;node&gt;: è¿”å›nodeæ‰€å®šä¹‰çš„æ£€æŸ¥ï¼Œå¯ç”¨å‚æ•°?dc=</span></span>
<span class="line"><span style="color:#a6accd">/v1/health/checks/&lt;service&gt;: è¿”å›å’ŒæœåŠ¡ç›¸å…³è”çš„æ£€æŸ¥ï¼Œå¯ç”¨å‚æ•°?dc=</span></span>
<span class="line"><span style="color:#a6accd">/v1/health/service/&lt;service&gt;: è¿”å›ç»™å®šdatacenterä¸­ç»™å®šnodeä¸­service</span></span>
<span class="line"><span style="color:#a6accd">/v1/health/state/&lt;state&gt;: è¿”å›ç»™å®šdatacenterä¸­æŒ‡å®šçŠ¶æ€çš„æœåŠ¡ï¼Œstateå¯ä»¥æ˜¯"any", "unknown", "passing", "warning", or "critical"ï¼Œå¯ç”¨å‚æ•°?dc=</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="session" tabindex="-1">session <a aria-current="page" href="#session" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>session endpointsç”¨æ¥createã€updateã€destoryã€query sessions</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/session/create: Creates a new session</span></span>
<span class="line"><span style="color:#a6accd">/v1/session/destroy/&lt;session&gt;: Destroys a given session</span></span>
<span class="line"><span style="color:#a6accd">/v1/session/info/&lt;session&gt;: Queries a given session</span></span>
<span class="line"><span style="color:#a6accd">/v1/session/node/&lt;node&gt;: Lists sessions belonging to a node</span></span>
<span class="line"><span style="color:#a6accd">/v1/session/list: Lists all the active sessions</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="acl" tabindex="-1">acl <a aria-current="page" href="#acl" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>acl endpointsç”¨æ¥createã€updateã€destoryã€query acl</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/acl/create: Creates a new token with policy</span></span>
<span class="line"><span style="color:#a6accd">/v1/acl/update: Update the policy of a token</span></span>
<span class="line"><span style="color:#a6accd">/v1/acl/destroy/&lt;id&gt;: Destroys a given token</span></span>
<span class="line"><span style="color:#a6accd">/v1/acl/info/&lt;id&gt;: Queries the policy of a given token</span></span>
<span class="line"><span style="color:#a6accd">/v1/acl/clone/&lt;id&gt;: Creates a new token by cloning an existing token</span></span>
<span class="line"><span style="color:#a6accd">/v1/acl/list: Lists all the active tokens</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="event-1" tabindex="-1">event <a aria-current="page" href="#event-1" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>event endpointsç”¨æ¥fireæ–°çš„eventsã€æŸ¥è¯¢å·²æœ‰çš„events</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/event/fire/&lt;name&gt;: è§¦å‘ä¸€ä¸ªæ–°çš„eventï¼Œç”¨æˆ·eventéœ€è¦nameå’Œå…¶ä»–å¯é€‰çš„å‚æ•°ï¼Œä½¿ç”¨PUTæ–¹æ³•</span></span>
<span class="line"><span style="color:#a6accd">/v1/event/list: è¿”å›agentçŸ¥é“çš„events</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="status" tabindex="-1">status <a aria-current="page" href="#status" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>status endpointsç”¨æ¥æˆ–è€…consul é›†ç¾¤çš„ä¿¡æ¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">/v1/status/leader : è¿”å›å½“å‰é›†ç¾¤çš„Raft leader</span></span>
<span class="line"><span style="color:#a6accd">/v1/status/peers : è¿”å›å½“å‰é›†ç¾¤ä¸­åŒäº‹</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h1 id="consul-template" tabindex="-1">Consul-Template <a aria-current="page" href="#consul-template" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p>åœ¨consul-templateæ²¡å‡ºç°ä¹‹å‰ï¼Œå¤§å®¶æ„å»ºæœåŠ¡å‘ç°ç³»ç»Ÿï¼Œå¤§å¤šé‡‡ç”¨çš„æ˜¯zookeeperã€etcd+confdè¿™æ ·ç±»ä¼¼çš„ç³»ç»Ÿï¼Œä¹‹å‰å†™è¿‡ä¸€ç¯‡consul+confdçš„æ–‡ï¼Œè®²çš„æ˜¯å¦‚ä½•åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ï¼Œå¦‚ä»Šconsulå®˜æ–¹æ¨å‡ºäº†è‡ªå·±çš„æ¨¡æ¿ç³»ç»Ÿï¼Œå°±æ˜¯consul-templateï¼Œè¿™æ ·çš„è¯åŠ¨æ€çš„é…ç½®ç³»ç»Ÿå¯ä»¥åˆ†åŒ–ä¸ºetcd+confdå’Œconsul+consul-templateä¸¤å¤§é˜µè¥ã€‚consulæ˜¯ä¸€ä¸ªå’Œetcdç±»ä¼¼ä½†åˆå¼ºäºetcdçš„ç³»ç»Ÿï¼Œå…³äºetcdå’Œconsulå¯ä»¥ç¿»é˜…ä»¥å‰çš„æ–‡ç« ï¼Œconsul-templateçš„å®šä½å°±å’Œconfdå·®ä¸å¤šä¸€æ ·äº†ï¼Œconfdçš„åç«¯å¯ä»¥æ˜¯etcdæˆ–è€…consulï¼Œç›¸ä¿¡consulæ­é…consul-templateèƒ½å‘æŒ¥æ›´å¤§çš„æ•ˆæœã€‚consul-templateæä¾›äº†ä¸€ä¸ªä¾¿æ·çš„æ–¹å¼ä»consulä¸­è·å–å­˜å‚¨çš„å€¼ï¼Œconsul-templateå®ˆæŠ¤è¿›ç¨‹ä¼šæŸ¥è¯¢consulå®ä¾‹ï¼Œæ¥æ›´æ–°ç³»ç»Ÿä¸ŠæŒ‡å®šçš„ä»»ä½•æ¨¡æ¿ï¼Œå½“æ›´æ–°å®Œæˆåï¼Œæ¨¡æ¿å¯ä»¥é€‰æ‹©è¿è¡Œä¸€äº›ä»»æ„çš„å‘½ä»¤ã€‚</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">    consul templateçš„ä½¿ç”¨åœºæ™¯ï¼šconsul templateå¯ä»¥æŸ¥è¯¢consulä¸­çš„æœåŠ¡ç›®å½•ã€keyã€key-valuesç­‰ã€‚è¿™ç§å¼ºå¤§çš„æŠ½è±¡åŠŸèƒ½å’ŒæŸ¥è¯¢è¯­è¨€æ¨¡æ¿å¯ä»¥ä½¿consul templateç‰¹åˆ«é€‚åˆåŠ¨æ€çš„åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼šåˆ›å»ºapache/nginx proxy balancersã€haproxy backendsã€varnish serversã€application configurationsã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>consul templateçš„ç‰¹æ€§ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">    quiescenceï¼šconsul templateå†…åˆ¶é™æ­¢å¹³è¡¡åŠŸèƒ½ï¼Œå¯ä»¥æ™ºèƒ½çš„å‘ç°consulå®ä¾‹ä¸­çš„æ›´æ”¹ä¿¡æ¯ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥é˜²æ­¢é¢‘ç¹çš„æ›´æ–°æ¨¡æ¿è€Œå¼•èµ·ç³»ç»Ÿçš„æ³¢åŠ¨ã€‚</span></span>
<span class="line"><span style="color:#a6accd">    dry modeï¼šä¸ç¡®å®šå½“å‰æ¶æ„çš„çŠ¶æ€ï¼Ÿæ‹…å¿ƒæ¨¡æ¿çš„å˜åŒ–ä¼šç ´åå­ç³»ç»Ÿï¼Ÿæ— é¡»æ‹…å¿ƒï¼Œå› ä¸ºconsul templateè¿˜æœ‰-dryæ¨¡å¼ã€‚åœ¨dryæ¨¡å¼ï¼Œconsul templateä¼šå°†ç»“æœå‘ˆç°åœ¨STDOUTï¼Œæ‰€ä»¥æ“ä½œå‘˜å¯ä»¥æ£€æŸ¥è¾“å‡ºæ˜¯å¦æ­£å¸¸ï¼Œä»¥å†³å®šæ›´æ¢æ¨¡æ¿æ˜¯å¦å®‰å…¨</span></span>
<span class="line"><span style="color:#a6accd">    CLI and Configï¼šå¦‚æœä½ å–œæ¬¢åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šä¸€åˆ‡ï¼Œconsul templateéƒ½å¯ä»¥holdä½ã€‚éšç€å†…ç½®HCLçš„æ”¯æŒï¼Œconsul templateæ¥æ”¶ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ–è€…ä¸¤è€…çš„æ··åˆã€‚é€šè¿‡è¿™ç§æ–¹å¼ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨ä½ ç°åœ¨å·²æœ‰çš„é…ç½®ç®¡ç†å·¥å…·å’Œconsul templateæ¥é…åˆã€‚</span></span>
<span class="line"><span style="color:#a6accd">    verbose debuggingï¼šå³ä½¿æ¯ä»¶äº‹ä½ éƒ½åšçš„è¿‘ä¹å®Œç¾ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿˜æ˜¯ä¼šæœ‰å¤±è´¥å‘ç”Ÿã€‚consul templateå¯ä»¥æä¾›æ›´è¯¦ç»†çš„debugæ—¥å¿—ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="å®‰è£…" tabindex="-1">å®‰è£… <a aria-current="page" href="#å®‰è£…" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>ä½ å¯ä»¥åœ¨<a href="https://releases.hashicorp.com/consul-template/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->å‘å¸ƒé¡µ<!--]--></a>ä¸‹è½½å‘å¸ƒåŒ….å¦‚æœä½ å¸Œæœ›è‡ªå·±ç¼–è¯‘è¯·æŸ¥çœ‹<a href="https://github.com/hashicorp/consul-template#contributing" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->è¯´æ˜æ–‡æ¡£<!--]--></a>.</p><h2 id="ä½¿ç”¨" tabindex="-1">ä½¿ç”¨ <a aria-current="page" href="#ä½¿ç”¨" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">-auth=&lt;user[:pass]&gt;      è®¾ç½®åŸºæœ¬çš„è®¤è¯ç”¨æˆ·åå’Œå¯†ç </span></span>
<span class="line"><span style="color:#a6accd">  -consul-addr=&lt;address&gt;   è®¾ç½®Consulå®ä¾‹çš„åœ°å€</span></span>
<span class="line"><span style="color:#a6accd">  -max-stale=&lt;duration&gt;    æŸ¥è¯¢è¿‡æœŸçš„æœ€å¤§é¢‘ç‡ï¼Œé»˜è®¤æ˜¯1s</span></span>
<span class="line"><span style="color:#a6accd">  -dedup                   å¯ç”¨é‡å¤æ•°æ®åˆ é™¤ï¼Œå½“è®¸å¤šconsul templateå®ä¾‹æ¸²æŸ“ä¸€ä¸ªæ¨¡æ¿çš„æ—¶å€™å¯ä»¥é™ä½consulçš„è´Ÿè½½</span></span>
<span class="line"><span style="color:#a6accd">  -ssl                     ä½¿ç”¨httpsè¿æ¥Consulä½¿ç”¨SSL</span></span>
<span class="line"><span style="color:#a6accd">  -ssl-verify              é€šè¿‡SSLè¿æ¥çš„æ—¶å€™æ£€æŸ¥è¯ä¹¦</span></span>
<span class="line"><span style="color:#a6accd">  -ssl-cert                SSLå®¢æˆ·ç«¯è¯ä¹¦å‘é€ç»™æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#a6accd">  -ssl-key                 å®¢æˆ·ç«¯è®¤è¯æ—¶ä½¿ç”¨çš„SSL/TLSç§é’¥</span></span>
<span class="line"><span style="color:#a6accd">  -ssl-ca-cert             éªŒè¯æœåŠ¡å™¨çš„CAè¯ä¹¦åˆ—è¡¨</span></span>
<span class="line"><span style="color:#a6accd">  -token=&lt;token&gt;           è®¾ç½®Consul APIçš„token</span></span>
<span class="line"><span style="color:#a6accd">  -syslog                  æŠŠæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°syslogï¼Œsyslogçš„é»˜è®¤çº§åˆ«æ˜¯local0ã€‚</span></span>
<span class="line"><span style="color:#a6accd">  -syslog-facility=&lt;f&gt;     è®¾ç½®syslogçº§åˆ«ï¼Œé»˜è®¤æ˜¯local0ï¼Œå¿…é¡»å’Œ-syslogé…åˆä½¿ç”¨</span></span>
<span class="line"><span style="color:#a6accd">  -template=&lt;template&gt;     å¢åŠ ä¸€ä¸ªéœ€è¦ç›‘æ§çš„æ¨¡æ¿ï¼Œæ ¼å¼æ˜¯ï¼š'templatePath:outputPath(:command)'ï¼Œå¤šä¸ªæ¨¡æ¿åˆ™å¯ä»¥è®¾ç½®å¤šæ¬¡</span></span>
<span class="line"><span style="color:#a6accd">  -wait=&lt;duration&gt;         å½“å‘ˆç°ä¸€ä¸ªæ–°çš„æ¨¡æ¿åˆ°ç³»ç»Ÿå’Œè§¦å‘ä¸€ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œç­‰å¾…çš„æœ€å¤§æœ€å°æ—¶é—´ã€‚å¦‚æœæœ€å¤§å€¼è¢«å¿½ç•¥ï¼Œé»˜è®¤æ˜¯æœ€å°å€¼çš„4å€ã€‚</span></span>
<span class="line"><span style="color:#a6accd">  -retry=&lt;duration&gt;        å½“åœ¨å’Œconsul apiäº¤äº’çš„è¿”å›å€¼æ˜¯errorçš„æ—¶å€™ï¼Œç­‰å¾…çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯5sã€‚</span></span>
<span class="line"><span style="color:#a6accd">  -config=&lt;path&gt;           é…ç½®æ–‡ä»¶æˆ–è€…é…ç½®ç›®å½•çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#a6accd">  -pid-file=&lt;path&gt;         PIDæ–‡ä»¶çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#a6accd">  -log-level=&lt;level&gt;       è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥æ˜¯"debug","info", "warn" (default), and "err"</span></span>
<span class="line"><span style="color:#a6accd">  -dry                     Dumpç”Ÿæˆçš„æ¨¡æ¿åˆ°æ ‡å‡†è¾“å‡ºï¼Œä¸ä¼šç”Ÿæˆåˆ°ç£ç›˜</span></span>
<span class="line"><span style="color:#a6accd">  -once                    è¿è¡Œconsul-templateä¸€æ¬¡åé€€å‡ºï¼Œä¸ä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ</span></span>
<span class="line"><span style="color:#a6accd">  -reap                    å­è¿›ç¨‹è‡ªåŠ¨æ”¶å‰²123456789101112131415161718192021</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æŸ¥çœ‹å…¨éƒ¨é€‰é¡¹,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul-template -h</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><h2 id="å‘½ä»¤è¡Œ" tabindex="-1">å‘½ä»¤è¡Œ <a aria-current="page" href="#å‘½ä»¤è¡Œ" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>1ã€æŸ¥è¯¢æœ¬åœ°conslå®ä¾‹ï¼Œç”Ÿæˆæ¨¡æ¿åé‡å¯nginxï¼Œå¦‚æœconsulä¸å¯ç”¨ï¼Œå¦‚æœapiæ•…éšœåˆ™æ¯30så°è¯•æ£€æµ‹ä¸€æ¬¡å€¼ï¼Œconsul-templateè¿è¡Œä¸€æ¬¡åé€€å‡º</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul-template -retry 30s -once -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>test.ctmpl</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range service "Faceid"}}</span></span>
<span class="line"><span style="color:#a6accd">{{.ID}} {{.Address}}:{{.Port}} check inter 5000 fall 1 rise 2 weight 2{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>test.out</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">Faceid 10.201.102.198:9000 check inter 5000 fall 1 rise 2 weight 2</span></span>
<span class="line"><span style="color:#a6accd">Faceid 10.201.102.199:9000 check inter 5000 fall 1 rise 2 weight 2</span></span>
<span class="line"><span style="color:#a6accd">Faceid 10.201.102.200:9000 check inter 5000 fall 1 rise 2 weight 2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>2ã€è¿è¡Œconsul-templeä½œä¸ºä¸€ä¸ªæœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul-template -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>3ã€æŸ¥è¯¢ä¸€ä¸ªå®ä¾‹ï¼Œæ¸²æŸ“å¤šä¸ªæ¨¡æ¿ï¼Œç„¶åé‡å¯ç›¸å…³æœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul-template -retry 30s -once -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"\</span></span>
<span class="line"><span style="color:#a6accd"> -template "/tmp/redis.ctmpl:/var/redis/redis.conf:service redis restart" \</span></span>
<span class="line"><span style="color:#a6accd"> -template "/tmp/haproxy.ctmpl:/var/haproxy/haproxy.conf"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>4ã€æŸ¥è¯¢ä¸€ä¸ªå®ä¾‹ï¼Œdumpæ¨¡æ¿åˆ°æ ‡å‡†è¾“å‡ºï¼Œå‚æ•°ä¸­çš„-templateåˆ™ä¼šè¢«å¿½ç•¥</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul-template -dry -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä»¥ä¸Šå‚æ•°é™¤äº†åœ¨å‘½ä»¤è¡Œä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é…ç½®åœ¨æ–‡ä»¶ä¸­ï¼Œä¸‹é¢çœ‹çœ‹Consul-Templateçš„é…ç½®æ–‡ä»¶ï¼Œç®€ç§°HCL(HashiCorp Configuration Language)ï¼Œå®ƒæ˜¯å’ŒJSONå…¼å®¹çš„ï¼Œä¸‹é¢çœ‹ä¸ªä¾‹å­ï¼š</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">#### é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#a6accd">â€‹```Consul-Template```é…ç½®æ–‡ä»¶æ˜¯ä½¿ç”¨[HashiCorp Configuration Language (HCL)](https://github.com/hashicorp/hcl)ç¼–å†™çš„.è¿™æ„å‘³ç€```Consul Template```æ˜¯å’ŒJSONå…¼å®¹çš„,æŸ¥çœ‹æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [HCL è§„èŒƒ](https://github.com/hashicorp/hcl)</span></span>
<span class="line"><span style="color:#a6accd">é…ç½®æ–‡ä»¶è¯­æ³•æ”¯æŒä¸Šé¢çš„æ‰€æœ‰çš„é€‰é¡¹,é™¤éåœ¨è¡¨æ ¼ä¸­è¿›è¡Œæ ‡æ˜.</span></span>
<span class="line"><span style="color:#a6accd">â€‹```json</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯è¦è¿æ¥çš„Consul Agentçš„åœ°å€.é»˜è®¤ä¸º127.0.0.1:8500.è¿™æ˜¯Consulçš„é»˜è®¤ç»‘å®šåœ°å€å’Œç«¯å£.</span></span>
<span class="line"><span style="color:#a6accd">// ä¸å»ºè®®ä½ ç›´æ¥ä¸ Consulçš„ Serverç›´æ¥è¿›è¡Œäº¤äº’,è¯·ä¸æœ¬åœ°çš„Consul Agentè¿›è¡Œäº¤äº’.è¿™æ ·åšæ˜¯æœ‰ä¸€äº›åŸå› </span></span>
<span class="line"><span style="color:#a6accd">// æœ€é‡è¦çš„æ˜¯æœ¬åœ°agentå¯ä»¥å¤ç”¨ä¸serverçš„è¿æ¥.å‡å°‘HTTPçš„è¿æ¥æ•°.å¦å¤–è¿™ä¸ªåœ°å€æ›´å¥½è®°.</span></span>
<span class="line"><span style="color:#a6accd">consul = "127.0.0.1:8500"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯ç”¨äºè¿æ¥Consulçš„ACL token. å¦‚æœä½ çš„é›†ç¾¤æœªå¯ç”¨å°±ä¸éœ€è¦è®¾ç½®.</span></span>
<span class="line"><span style="color:#a6accd">//</span></span>
<span class="line"><span style="color:#a6accd">// è¿™ä¸ªé€‰é¡¹ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ CONSUL_TOKEN æ¥è¿›è¡Œè®¾ç½®</span></span>
<span class="line"><span style="color:#a6accd">token = "abcd1234"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯ç›‘å¬å‡ºå‘reloadäº‹ä»¶çš„ä¿¡å·,é»˜è®¤å€¼å¦‚ä¸‹æ‰€ç¤º.å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºç©ºå°†å¼•èµ· CT ,ä»è€Œä¸ç›‘å¬reloadäº‹ä»¶</span></span>
<span class="line"><span style="color:#a6accd">reload_signal = "SIGHUP"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯ç›‘å¬å‡ºå‘core dumpäº‹ä»¶çš„ä¿¡å·,é»˜è®¤å€¼å¦‚ä¸‹æ‰€ç¤º.å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºç©ºå°†å¼•èµ· CT ,ä»è€Œä¸ç›‘å¬core dumpä¿¡å·</span></span>
<span class="line"><span style="color:#a6accd">dump_signal = "SIGQUIT"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯ç›‘å¬å‡ºå‘graceful stopäº‹ä»¶çš„ä¿¡å·,é»˜è®¤å€¼å¦‚ä¸‹æ‰€ç¤º.å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºç©ºå°†å¼•èµ· CT ,ä»è€Œä¸ç›‘å¬graceful stopä¿¡å·</span></span>
<span class="line"><span style="color:#a6accd">kill_signal = "SIGINT"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯è¿æ¥Consulçš„é‡è¯•æ—¶é—´.Consul Templateæ˜¯é«˜å®¹é”™çš„è®¾è®¡.è¿™æ„å‘³ç€,å‡ºç°å¤±è´¥ä»–ä¸ä¼šé€€å‡º.è€ŒæŒ‰ç…§</span></span>
<span class="line"><span style="color:#a6accd">// åˆ†å¸ƒå¼ç³»ç»Ÿçš„æƒ¯ä¾‹è¿›è¡ŒæŒ‡æ•°è¡¥å¿å’Œé‡è¯•æ¥ç­‰å¾…é›†ç¾¤æ¢å¤.</span></span>
<span class="line"><span style="color:#a6accd">retry = "10s"</span></span>
<span class="line"><span style="color:#a6accd">// This is the maximum interval to allow "stale" data. By default, only the</span></span>
<span class="line"><span style="color:#a6accd">// Consul leader will respond to queries; any requests to a follower will</span></span>
<span class="line"><span style="color:#a6accd">// forward to the leader. In large clusters with many requests, this is not as</span></span>
<span class="line"><span style="color:#a6accd">// scalable, so this option allows any follower to respond to a query, so long</span></span>
<span class="line"><span style="color:#a6accd">// as the last-replicated data is within these bounds. Higher values result in</span></span>
<span class="line"><span style="color:#a6accd">// less cluster load, but are more likely to have outdated data.</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯å…è®¸é™ˆæ—§æ•°æ®çš„æœ€å¤§æ—¶é—´.Consulé»˜è®¤åªæœ‰é¢†è¢–å¯¹è¯·æ±‚è¿›è¡Œç›¸åº”.æ‰€æœ‰å¯¹è¿½éšè€…çš„è¯·æ±‚å°†è¢«è½¬å‘ç»™é¢†è¢–.</span></span>
<span class="line"><span style="color:#a6accd">// åœ¨æœ‰å¤§é‡è¯·æ±‚çš„å¤§å‹é›†ç¾¤ä¸­,è¿™æ˜¾å¾—ä¸å¤Ÿæœ‰æ‰©å±•æ€§.æ‰€ä»¥è¿™ä¸ªé€‰é¡¹å…è®¸ä»»ä½•è¿½éšè€…å“åº”æŸ¥è¯¢,åªè¦æœ€åå¤åˆ¶çš„æ•°æ®</span></span>
<span class="line"><span style="color:#a6accd">// åœ¨è¿™ä¸ªèŒƒå›´å†….æ•°å€¼è¶Šé«˜,è¶Šå‡å°‘é›†ç¾¤è´Ÿè½½,ä½†æ˜¯æ›´å®¹æ˜“æ¥å—åˆ°è¿‡æœŸæ•°æ®.</span></span>
<span class="line"><span style="color:#a6accd">max_stale = "10m"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯logçš„ç­‰çº§,å¦‚æœä½ æ‰¾åˆ°äº†bug,è¯·æ‰“å¼€debug æ—¥å¿—,è¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„å®šä½é—®é¢˜.è¿™ä¸ªé€‰é¡¹ä¹Ÿå¯ç”¨åœ¨å‘½ä»¤è¡Œ.</span></span>
<span class="line"><span style="color:#a6accd">log_level = "warn"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯å­˜æ”¾Consul Template è¿›ç¨‹çš„PIDæ–‡ä»¶çš„è·¯å¾„,å¦‚æœä½ è®¡åˆ’å‘é€å®šåˆ¶çš„ä¿¡å·åˆ°è¿™ä¸ªè¿›ç¨‹è¿™ä¼šæ¯”è¾ƒæœ‰ç”¨.</span></span>
<span class="line"><span style="color:#a6accd">pid_file = "/path/to/pid"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯ä¸€ä¸ªé™æ­¢å®šæ—¶å™¨,ä»–å®šä¹‰äº†åœ¨æ¨¡æ¿æ¸²æŸ“ä¹‹å‰ç­‰å¾…é›†ç¾¤è¾¾åˆ°ä¸€è‡´çŠ¶æ€çš„æœ€å°å’Œæœ€å¤§æ—¶é—´.</span></span>
<span class="line"><span style="color:#a6accd">// è¿™å¯¹äºä¸€äº›å˜åŒ–è¾ƒå¤§çš„ç³»ç»Ÿä¸­æ¯”è¾ƒæœ‰ç”¨,å¯ä»¥å‡å°‘æ¨¡æ¿æ¸²æŸ“çš„æ¬¡æ•°</span></span>
<span class="line"><span style="color:#a6accd">wait = "5s:10s"</span></span>
<span class="line"><span style="color:#a6accd">// è¿™æ˜¯ Vaulté…ç½®çš„å¼€å§‹</span></span>
<span class="line"><span style="color:#a6accd">// Vaultæ˜¯HashiCorpçš„å¦å¤–ä¸€ä¸ªäº§å“</span></span>
<span class="line"><span style="color:#a6accd">vault {</span></span>
<span class="line"><span style="color:#a6accd">  // This is the address of the Vault leader. The protocol (http(s)) portion</span></span>
<span class="line"><span style="color:#a6accd">  // of the address is required.</span></span>
<span class="line"><span style="color:#a6accd">  address = "https://vault.service.consul:8200"</span></span>
<span class="line"><span style="color:#a6accd">  // This is the token to use when communicating with the Vault server.</span></span>
<span class="line"><span style="color:#a6accd">  // Like other tools that integrate with Vault, Consul Template makes the</span></span>
<span class="line"><span style="color:#a6accd">  // assumption that you provide it with a Vault token; it does not have the</span></span>
<span class="line"><span style="color:#a6accd">  // incorporated logic to generate tokens via Vault's auth methods.</span></span>
<span class="line"><span style="color:#a6accd">  //</span></span>
<span class="line"><span style="color:#a6accd">  // This value can also be specified via the environment variable VAULT_TOKEN.</span></span>
<span class="line"><span style="color:#a6accd">  token = "abcd1234"</span></span>
<span class="line"><span style="color:#a6accd">  // This option tells Consul Template to automatically renew the Vault token</span></span>
<span class="line"><span style="color:#a6accd">  // given. If you are unfamiliar with Vault's architecture, Vault requires</span></span>
<span class="line"><span style="color:#a6accd">  // tokens be renewed at some regular interval or they will be revoked. Consul</span></span>
<span class="line"><span style="color:#a6accd">  // Template will automatically renew the token at half the lease duration of</span></span>
<span class="line"><span style="color:#a6accd">  // the token. The default value is true, but this option can be disabled if</span></span>
<span class="line"><span style="color:#a6accd">  // you want to renew the Vault token using an out-of-band process.</span></span>
<span class="line"><span style="color:#a6accd">  //</span></span>
<span class="line"><span style="color:#a6accd">  // Note that secrets specified in a template (using {{secret}} for example)</span></span>
<span class="line"><span style="color:#a6accd">  // are always renewed, even if this option is set to false. This option only</span></span>
<span class="line"><span style="color:#a6accd">  // applies to the top-level Vault token itself.</span></span>
<span class="line"><span style="color:#a6accd">  renew = true</span></span>
<span class="line"><span style="color:#a6accd">  // This section details the SSL options for connecting to the Vault server.</span></span>
<span class="line"><span style="color:#a6accd">  // Please see the SSL options below for more information (they are the same).</span></span>
<span class="line"><span style="color:#a6accd">  ssl {</span></span>
<span class="line"><span style="color:#a6accd">    // ...</span></span>
<span class="line"><span style="color:#a6accd">  }</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">// è¿™éƒ¨åˆ†é…ç½®è¯·æ±‚çš„åŸºæœ¬çš„æƒé™éªŒè¯ä¿¡æ¯</span></span>
<span class="line"><span style="color:#a6accd">auth {</span></span>
<span class="line"><span style="color:#a6accd">  enabled  = true</span></span>
<span class="line"><span style="color:#a6accd">  username = "test"</span></span>
<span class="line"><span style="color:#a6accd">  password = "test"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">// è¿™éƒ¨åˆ†é…ç½®è¿æ¥åˆ°ConsulæœåŠ¡å™¨çš„SSLä¿¡æ¯.</span></span>
<span class="line"><span style="color:#a6accd">ssl {</span></span>
<span class="line"><span style="color:#a6accd">  // ä½¿ç”¨SSLéœ€è¦å…ˆæ‰“å¼€è¿™ä¸ªå¼€å…³</span></span>
<span class="line"><span style="color:#a6accd">  enabled = true</span></span>
<span class="line"><span style="color:#a6accd">  // This enables SSL peer verification. The default value is "true", which</span></span>
<span class="line"><span style="color:#a6accd">  // will check the global CA chain to make sure the given certificates are</span></span>
<span class="line"><span style="color:#a6accd">  // valid. If you are using a self-signed certificate that you have not added</span></span>
<span class="line"><span style="color:#a6accd">  // to the CA chain, you may want to disable SSL verification. However, please</span></span>
<span class="line"><span style="color:#a6accd">  // understand this is a potential security vulnerability.</span></span>
<span class="line"><span style="color:#a6accd">  verify = false</span></span>
<span class="line"><span style="color:#a6accd">  // This is the path to the certificate to use to authenticate. If just a</span></span>
<span class="line"><span style="color:#a6accd">  // certificate is provided, it is assumed to contain both the certificate and</span></span>
<span class="line"><span style="color:#a6accd">  // the key to convert to an X509 certificate. If both the certificate and</span></span>
<span class="line"><span style="color:#a6accd">  // key are specified, Consul Template will automatically combine them into an</span></span>
<span class="line"><span style="color:#a6accd">  // X509 certificate for you.</span></span>
<span class="line"><span style="color:#a6accd">  cert = "/path/to/client/cert"</span></span>
<span class="line"><span style="color:#a6accd">  key = "/path/to/client/key"</span></span>
<span class="line"><span style="color:#a6accd">  // This is the path to the certificate authority to use as a CA. This is</span></span>
<span class="line"><span style="color:#a6accd">  // useful for self-signed certificates or for organizations using their own</span></span>
<span class="line"><span style="color:#a6accd">  // internal certificate authority.</span></span>
<span class="line"><span style="color:#a6accd">  ca_cert = "/path/to/ca"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">// è®¾ç½®è¿æ¥åˆ°syslogæœåŠ¡å™¨çš„é…ç½®</span></span>
<span class="line"><span style="color:#a6accd">// ç”¨äºè¿›è¡Œæ—¥å¿—è®°å½•syslog {</span></span>
<span class="line"><span style="color:#a6accd">  // æ‰“å¼€å¼€å…³</span></span>
<span class="line"><span style="color:#a6accd">  enabled = true</span></span>
<span class="line"><span style="color:#a6accd">  // è®¾å¤‡åç§°</span></span>
<span class="line"><span style="color:#a6accd">  facility = "LOCAL5"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">// This block defines the configuration for de-duplication mode. Please see the</span></span>
<span class="line"><span style="color:#a6accd">// de-duplication mode documentation later in the README for more information</span></span>
<span class="line"><span style="color:#a6accd">// on how de-duplication mode operates.</span></span>
<span class="line"><span style="color:#a6accd">deduplicate {</span></span>
<span class="line"><span style="color:#a6accd">  // This enables de-duplication mode. Specifying any other options also enables</span></span>
<span class="line"><span style="color:#a6accd">  // de-duplication mode.</span></span>
<span class="line"><span style="color:#a6accd">  enabled = true</span></span>
<span class="line"><span style="color:#a6accd">  // This is the prefix to the path in Consul's KV store where de-duplication</span></span>
<span class="line"><span style="color:#a6accd">  // templates will be pre-rendered and stored.</span></span>
<span class="line"><span style="color:#a6accd">  prefix = "consul-template/dedup/"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">// This block defines the configuration for exec mode. Please see the exec mode</span></span>
<span class="line"><span style="color:#a6accd">// documentation at the bottom of this README for more information on how exec</span></span>
<span class="line"><span style="color:#a6accd">// mode operates and the caveats of this mode.</span></span>
<span class="line"><span style="color:#a6accd">exec {</span></span>
<span class="line"><span style="color:#a6accd">  // This is the command to exec as a child process. There can be only one</span></span>
<span class="line"><span style="color:#a6accd">  // command per Consul Template process.</span></span>
<span class="line"><span style="color:#a6accd">  command = "/usr/bin/app"</span></span>
<span class="line"><span style="color:#a6accd">  // This is a random splay to wait before killing the command. The default</span></span>
<span class="line"><span style="color:#a6accd">  // value is 0 (no wait), but large clusters should consider setting a splay</span></span>
<span class="line"><span style="color:#a6accd">  // value to prevent all child processes from reloading at the same time when</span></span>
<span class="line"><span style="color:#a6accd">  // data changes occur. When this value is set to non-zero, Consul Template</span></span>
<span class="line"><span style="color:#a6accd">  // will wait a random period of time up to the splay value before reloading</span></span>
<span class="line"><span style="color:#a6accd">  // or killing the child process. This can be used to prevent the thundering</span></span>
<span class="line"><span style="color:#a6accd">  // herd problem on applications that do not gracefully reload.</span></span>
<span class="line"><span style="color:#a6accd">  splay = "5s"</span></span>
<span class="line"><span style="color:#a6accd">  // This defines the signal that will be sent to the child process when a</span></span>
<span class="line"><span style="color:#a6accd">  // change occurs in a watched template. The signal will only be sent after</span></span>
<span class="line"><span style="color:#a6accd">  // the process is started, and the process will only be started after all</span></span>
<span class="line"><span style="color:#a6accd">  // dependent templates have been rendered at least once. The default value</span></span>
<span class="line"><span style="color:#a6accd">  // is "" (empty or nil), which tells Consul Template to restart the child</span></span>
<span class="line"><span style="color:#a6accd">  // process instead of sending it a signal. This is useful for legacy</span></span>
<span class="line"><span style="color:#a6accd">  // applications or applications that cannot properly reload their</span></span>
<span class="line"><span style="color:#a6accd">  // configuration without a full reload.</span></span>
<span class="line"><span style="color:#a6accd">  reload_signal = "SIGUSR1"</span></span>
<span class="line"><span style="color:#a6accd">  // This defines the signal sent to the child process when Consul Template is</span></span>
<span class="line"><span style="color:#a6accd">  // gracefully shutting down. The application should begin a graceful cleanup.</span></span>
<span class="line"><span style="color:#a6accd">  // If the application does not terminate before the `kill_timeout`, it will</span></span>
<span class="line"><span style="color:#a6accd">  // be terminated (effectively "kill -9"). The default value is "SIGTERM".</span></span>
<span class="line"><span style="color:#a6accd">  kill_signal = "SIGINT"</span></span>
<span class="line"><span style="color:#a6accd">  // This defines the amount of time to wait for the child process to gracefully</span></span>
<span class="line"><span style="color:#a6accd">  // terminate when Consul Template exits. After this specified time, the child</span></span>
<span class="line"><span style="color:#a6accd">  // process will be force-killed (effectively "kill -9"). The default value is</span></span>
<span class="line"><span style="color:#a6accd">  // "30s".</span></span>
<span class="line"><span style="color:#a6accd">  kill_timeout = "2s"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd">// è¿™éƒ¨åˆ†å®šä¹‰äº†å¯¹æ¨¡æ¿çš„é…ç½®,å’Œå…¶ä»–é…ç½®å—ä¸åŒ.è¿™éƒ¨åˆ†å¯ä»¥é’ˆå¯¹ä¸åŒæ¨¡æ¿é…ç½®å¤šæ¬¡.ä¹Ÿå¯ä»¥åœ¨CLIå‘½ä»¤</span></span>
<span class="line"><span style="color:#a6accd">// ç›´æ¥è¿›è¡Œé…ç½®</span></span>
<span class="line"><span style="color:#a6accd">template {</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™æ˜¯è¾“å…¥æ¨¡æ¿çš„é…ç½®æ–‡ä»¶è·¯å¾„,å¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#a6accd">  source = "/path/on/disk/to/template.ctmpl"</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™æ˜¯æºæ¨¡æ¿æ¸²æŸ“ä¹‹åå­˜æ”¾çš„è·¯å¾„,å¦‚æœçˆ¶ç›®å½•ä¸å­˜åœ¨Consul Templateä¼šå°è¯•è¿›è¡Œåˆ›å»º</span></span>
<span class="line"><span style="color:#a6accd">  destination = "/path/on/disk/where/template/will/render.txt"</span></span>
<span class="line"><span style="color:#a6accd">  // This is the optional command to run when the template is rendered. The</span></span>
<span class="line"><span style="color:#a6accd">  // command will only run if the resulting template changes. The command must</span></span>
<span class="line"><span style="color:#a6accd">  // return within 30s (configurable), and it must have a successful exit code.</span></span>
<span class="line"><span style="color:#a6accd">  // Consul Template is not a replacement for a process monitor or init system.</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™æ˜¯å½“æ¨¡æ¿æ¸²æŸ“å®Œæˆåå¯é€‰çš„è¦æ‰§è¡Œçš„å‘½ä»¤.è¿™ä¸ªå‘½ä»¤åªä¼šåœ¨æ¨¡æ¿å‘ç”Ÿæ”¹å˜åæ‰ä¼šè¿è¡Œ.è¿™ä¸ªå‘½ä»¤å¿…é¡»è¦åœ¨30ç§’</span></span>
<span class="line"><span style="color:#a6accd">  // å†…è¿›è¡Œè¿”å›(å¯é…ç½®),å¿…é¡»è¿”å›ä¸€ä¸ªæˆåŠŸçš„é€€å‡ºç .Consul Templateä¸èƒ½æ›¿ä»£è¿›ç¨‹ç›‘è§†æˆ–è€…init ç³»ç»Ÿ</span></span>
<span class="line"><span style="color:#a6accd">  // çš„åŠŸèƒ½</span></span>
<span class="line"><span style="color:#a6accd">  command = "restart service foo"</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™æ˜¯æœ€å¤§çš„ç­‰å¾…å‘½ä»¤è¿”å›çš„æ—¶é—´,é»˜è®¤æ˜¯30ç§’</span></span>
<span class="line"><span style="color:#a6accd">  command_timeout = "60s"</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™æ˜¯æ¸²æŸ“åçš„æ–‡ä»¶çš„æƒé™,å¦‚æœä¸è®¾ç½®,Consul Templateå°†å»åŒ¹é…ä¹‹å‰å·²ç»å­˜åœ¨çš„æ–‡ä»¶çš„æƒé™.</span></span>
<span class="line"><span style="color:#a6accd">  // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨,æƒé™ä¼šè¢«è®¾ç½®ä¸º 0644</span></span>
<span class="line"><span style="color:#a6accd">  perms = 0600</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™ä¸ªé€‰é¡¹å¯¹æ¸²æŸ“ä¹‹å‰çš„æ–‡ä»¶è¿›è¡Œå¤‡ä»½.ä»–ä¿æŒä¸€ä¸ªå¤‡ä»½.</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™ä¸ªé€‰é¡¹åœ¨å‘ç”Ÿæ„å¤–æ›´é«˜æ—¶,æœ‰ä¸€ä¸ªå›æ»šç­–ç•¥.</span></span>
<span class="line"><span style="color:#a6accd">  backup = true</span></span>
<span class="line"><span style="color:#a6accd">  // æ¨¡æ¿çš„åˆ†éš”ç¬¦,é»˜è®¤æ˜¯ "{{"å’Œ"}}".ä½†æ˜¯å¯¹äºä¸€äº›æ¨¡æ¿ç”¨å…¶ä»–çš„åˆ†éš”ç¬¦å¯èƒ½æ›´å¥½</span></span>
<span class="line"><span style="color:#a6accd">  // å¯ä»¥é¿å…ä¸æœ¬èº«çš„å†²çª</span></span>
<span class="line"><span style="color:#a6accd">  left_delimiter  = "{{"</span></span>
<span class="line"><span style="color:#a6accd">  right_delimiter = "}}"</span></span>
<span class="line"><span style="color:#a6accd">  // è¿™æ˜¯æœ€å°å’Œæœ€å¤§ç­‰å¾…æ¸²æŸ“ä¸€ä¸ªæ–°æ¨¡æ¿å’Œæ‰§è¡Œå‘½ä»¤çš„æ—¶é—´.ä½¿ç”¨ åˆ†å· ä¸ªå·.å¦‚æœå¿½ç•¥æœ€å¤§å€¼,æœ€å¤§</span></span>
<span class="line"><span style="color:#a6accd">  // å€¼ä¼šè¢«è®¾ç½®ä¸ºæœ€å°å€¼çš„4å€.è¿™ä¸ªé€‰é¡¹æ²¡æœ‰é»˜è®¤å€¼.è¿™ä¸ªå€¼ç›¸å¯¹å…¨å±€æ‰€ä»¥çš„ç­‰å¾…æ—¶é—´æœ‰æœ€é«˜ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="color:#a6accd">  wait = "2s:6s"</span></span>
<span class="line"><span style="color:#a6accd">}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>æ³¨æ„</strong>: ä¸æ˜¯æ‰€æœ‰çš„é€‰é¡¹éƒ½æ˜¯å¿…é€‰çš„.ä¾‹å¦‚: å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨Vaultä½ ä¸ç”¨è®¾ç½®è¿™ä¸€å—. ç±»ä¼¼çš„ä½ æ²¡æœ‰ä½¿ç”¨syslogç³»ç»Ÿä½ ä¹Ÿä¸éœ€è¦æŒ‡å®šsyslogé…ç½®.</p><p>ä¸ºäº†æ›´åŠ å®‰å…¨,<code>token</code>ä¹Ÿå¯ä»¥ä»ç¯å¢ƒå˜é‡é‡Œè¯»å–,ä½¿ç”¨ <code>CONSUL_TOKEN</code> å’Œ <code>VAULT_TOKEN</code>.å¼ºçƒˆå»ºè®®ä½ ä¸è¦æŠŠtokenæ”¾åˆ°æœªåŠ å¯†çš„æ–‡æœ¬é…ç½®æ–‡ä»¶ä¸­.</p><h2 id="æ¨¡ç‰ˆè¯­æ³•" tabindex="-1">æ¨¡ç‰ˆè¯­æ³• <a aria-current="page" href="#æ¨¡ç‰ˆè¯­æ³•" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>Consul Template ä½¿ç”¨äº†Goçš„æ¨¡æ¿è¯­æ³•.å¦‚æœä½ å¯¹ä»–çš„è¯­æ³•ä¸ç†Ÿæ‚‰å»ºè®®ä½ è¯»ä¸‹æ–‡æ¡£.ä»–çš„è¯­æ³•çœ‹èµ·æ¥ä¸ Mustache, Handlebars, æˆ–è€… Liquid ç±»ä¼¼.</p><p>åœ¨Go æä¾›çš„æ¨¡æ¿å‡½æ•°ä¹‹å¤–,Consul Templateæš´éœ²äº†ä»¥ä¸‹çš„å‡½æ•°:</p><h2 id="api-å‡½æ•°" tabindex="-1">API å‡½æ•° <a aria-current="page" href="#api-å‡½æ•°" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p><strong>datacenters</strong> æŸ¥è¯¢ç›®å½•ä¸­çš„æ‰€æœ‰æ•°æ®ä¸­å¿ƒ.ä½¿ç”¨ä»¥ä¸‹è¯­æ³•:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{datacenters}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>file</strong> è¯»å–å¹¶è¾“å‡ºç£ç›˜ä¸Šçš„æœ¬åœ°æ–‡ä»¶,å¦‚æœæ— æ³•è¯»å–äº§ç”Ÿä¸€ä¸ªé”™è¯¯.ä½¿ç”¨å¦‚ä¸‹è¯­æ³•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{file "/path/to/local/file"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¸ªä¾‹å­å°†è¾“å‡º <code>/path/to/local/file</code> æ–‡ä»¶å†…å®¹åˆ°æ¨¡æ¿. æ³¨æ„:è¿™ä¸ä¼šåœ¨åµŒå¥—æ¨¡æ¿ä¸­è¢«å¤„ç†</p><p><strong>key</strong> æŸ¥è¯¢ConsulæŒ‡å®škeyçš„å€¼,å¦‚æœkeyçš„å€¼ä¸èƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²,å°†äº§ç”Ÿé”™è¯¯.ä½¿ç”¨å¦‚ä¸‹è¯­æ³•:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{key "service/redis/maxconns@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸Šé¢çš„ä¾‹å­æŸ¥è¯¢äº†åœ¨<code>east-aws</code>æ•°æ®ä¸­å¿ƒçš„ <code>service/redis/maxconns</code>çš„å€¼.å¦‚æœå¿½ç•¥æ•°æ®ä¸­å¿ƒå‚æ•°,å°†ä¼šæŸ¥è¯¢æœ¬åœ°æ•°æ®ä¸­å¿ƒçš„å€¼:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{key "service/redis/maxconns"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Consulé”®å€¼ç»“æ„çš„ç¾å¦™åœ¨äº,è¿™å®Œå…¨å–å†³äºä½ !</p><p><strong>key_or_default</strong> æŸ¥è¯¢Consulä¸­æŒ‡å®šçš„keyçš„å€¼,å¦‚æœkeyä¸å­˜åœ¨,åˆ™è¿”å›é»˜è®¤å€¼.ä½¿ç”¨æ–¹å¼å¦‚ä¸‹</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{key_or_default "service/redis/maxconns@east-aws" "5"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ³¨æ„Consul Templateä½¿ç”¨äº†å¤šä¸ªé˜¶æ®µçš„è¿ç®—.åœ¨ç¬¬ä¸€é˜¶æ®µçš„è¿ç®—å¦‚æœConsulæ²¡æœ‰è¿”å›å€¼,åˆ™ä¼šä¸€ç›´ä½¿ç”¨é»˜è®¤å€¼.åç»­æ¨¡æ¿è§£æä¸­å¦‚æœå€¼å­˜åœ¨äº†åˆ™ä¼šè¯»å–çœŸå®çš„å€¼.è¿™å¾ˆé‡è¦,è¿ç»´Consul Templaeä¸ä¼šå› ä¸º<code>key_or_default</code>æ²¡æ‰¾åˆ°keyè€Œé˜»å¡æ¨¡æ¿çš„çš„æ¸²æŸ“.å³ä½¿keyå­˜åœ¨å¦‚æœConsulæ²¡æœ‰æŒ‰æ—¶è¿”å›è¿™ä¸ªæ•°æ®,ä¹Ÿä¼šä½¿ç”¨é»˜è®¤å€¼æ¥è¿›è¡Œæ›¿ä»£.</p><p><strong>ls</strong> æŸ¥çœ‹Consulçš„æ‰€æœ‰ä»¥æŒ‡å®šå‰ç¼€å¼€å¤´çš„key-valueå¯¹.å¦‚æœæœ‰å€¼æ— æ³•è½¬æ¢æˆå­—ç¬¦ä¸²åˆ™ä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range ls "service/redis@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd">{{.Key}} {{.Value}}{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœConsulå®ä¾‹åœ¨<code>east-aws</code>æ•°æ®ä¸­å¿ƒå­˜åœ¨è¿™ä¸ªç»“æ„<code>service/redis</code>,æ¸²æŸ“åçš„æ¨¡æ¿åº”è¯¥ç±»ä¼¼è¿™æ ·:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">minconns 2</span></span>
<span class="line"><span style="color:#a6accd">maxconns 12</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœä½ å¿½ç•¥æ•°æ®ä¸­å¿ƒå±æ€§,åˆ™ä¼šè¿”å›æœ¬åœ°æ•°æ®ä¸­å¿ƒçš„æŸ¥è¯¢ç»“æœ.</p><p><strong>node</strong> æŸ¥è¯¢ç›®å½•ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{node "node1"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœæœªæŒ‡å®šä»»ä½•å‚æ•°,åˆ™å½“å‰agentæ‰€åœ¨èŠ‚ç‚¹å°†ä¼šè¢«è¿”å›:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{node}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯é€‰çš„å‚æ•°æ¥æŒ‡å®šæ•°æ®ä¸­å¿ƒ:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{node "node1" "@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹æ²¡æœ‰æ‰¾åˆ°åˆ™ä¼šè¿”å›<code>nil</code>.å¦‚æœèŠ‚ç‚¹å­˜åœ¨å°±ä¼šåˆ—å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯å’ŒèŠ‚ç‚¹æä¾›çš„æœåŠ¡.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{with node}}{{.Node.Node}} ({{.Node.Address}}){{range .Services}}</span></span>
<span class="line"><span style="color:#a6accd">  {{.Service}} {{.Port}} ({{.Tags | join ","}}){{end}}</span></span>
<span class="line"><span style="color:#a6accd">{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>nodes</strong> æŸ¥è¯¢ç›®å½•ä¸­çš„å…¨éƒ¨èŠ‚ç‚¹,ä½¿ç”¨å¦‚ä¸‹è¯­æ³•</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{nodes}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¸ªä¾‹å­ä¼šæŸ¥è¯¢Consulçš„é»˜è®¤æ•°æ®ä¸­å¿ƒ.ä½ å¯ä»¥ä½¿ç”¨å¯é€‰å‚æ•°æŒ‡å®šä¸€ä¸ªå¯é€‰å‚æ•°æ¥æŒ‡å®šæ•°æ®ä¸­å¿ƒ:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{nodes "@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¸ªä¾‹å­ä¼šæŸ¥è¯¢east-awsæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰å‡ ç‚¹.</p><p><strong>secret</strong> æŸ¥è¯¢<code>Vault</code>ä¸­æŒ‡å®šè·¯å¾„çš„å¯†åŒ™.å¦‚æœæŒ‡å®šçš„è·¯å¾„ä¸å­˜åœ¨æˆ–è€…<code>Vault</code>çš„<code>Token</code>æ²¡æœ‰è¶³å¤Ÿæƒé™å»è¯»å–æŒ‡å®šçš„è·¯å¾„,å°†ä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯.å¦‚æœè·¯å¾„å­˜åœ¨ä½†æ˜¯keyä¸å­˜åœ¨åˆ™è¿”å›â€œ.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{with secret "secret/passwords"}}{{.Data.password}}{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å­—æ®µ:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">LeaseID - the unique lease identifier</span></span>
<span class="line"><span style="color:#a6accd">LeaseDuration - the number of seconds the lease is valid</span></span>
<span class="line"><span style="color:#a6accd">Renewable - if the secret is renewable</span></span>
<span class="line"><span style="color:#a6accd">Data - the raw data - this is a map[string]interface{}, so it can be queried using Go's templating "dot notation"</span></span>
<span class="line"><span style="color:#a6accd">If the map key has dots "." in it, you need to access the value using the index function:</span></span>
<span class="line"><span style="color:#a6accd">{{index .Data "my.key.with.dots"}}</span></span>
<span class="line"><span style="color:#a6accd">If additional arguments are passed to the function, then the operation is assumed to be a write operation instead of a read operation. The write operation must return data in order to be valid. This is especially useful for the PKI secret backend, for example.</span></span>
<span class="line"><span style="color:#a6accd">{{ with secret "pki/issue/my-domain-dot-com" "common_name=foo.example.com" }}</span></span>
<span class="line"><span style="color:#a6accd">{{ .Data.certificate }}</span></span>
<span class="line"><span style="color:#a6accd">{{ end }}</span></span>
<span class="line"><span style="color:#a6accd">The parameters must be key=value pairs, and each pair must be its own argument to the function:</span></span>
<span class="line"><span style="color:#a6accd">{{ secret "path/" "a=b" "c=d" "e=f" }}</span></span>
<span class="line"><span style="color:#a6accd">Please always consider the security implications of having the contents of a secret in plain-text on disk. If an attacker is able to get access to the file, they will have access to plain-text secrets.</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>Please note that Vault does not support blocking queries. As a result, Consul Template will not immediately reload in the event a secret is changed as it does with Consulâ€™s key-value store. Consul Template will fetch a new secret at half the lease duration of the original secret. For example, most items in Vaultâ€™s generic secret backend have a default 30 day lease. This means Consul Template will renew the secret every 15 days. As such, it is recommended that a smaller lease duration be used when generating the initial secret to force Consul Template to renew more often.</p><p><strong>secrets</strong> Query Vault to list the secrets at the given path. Please note this requires Vault 0.5+ and the endpoint you want to list secrets must support listing. Not all endpoints support listing. The result is the list of secret names as strings.</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range secrets "secret/"}}{{.}}{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>The trailing slash is optional in the template, but the generated secret dependency will always have a trailing slash in log output.</p><p>To iterate and list over every secret in the generic secret backend in Vault, for example, you would need to do something like this:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range secrets "secret/"}}</span></span>
<span class="line"><span style="color:#a6accd">{{with secret (printf "secret/%s" .)}}</span></span>
<span class="line"><span style="color:#a6accd">{{range $k, $v := .Data}}</span></span>
<span class="line"><span style="color:#a6accd">{{$k}}: {{$v}}</span></span>
<span class="line"><span style="color:#a6accd">{{end}}</span></span>
<span class="line"><span style="color:#a6accd">{{end}}</span></span>
<span class="line"><span style="color:#a6accd">{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>You should probably never do this. Please also note that Vault does not support blocking queries. To understand the implications, please read the note at the end of the secret function.</p><p><strong>service</strong> æŸ¥è¯¢Consulä¸­åŒ¹é…è¡¨è¾¾å¼çš„æœåŠ¡.è¯­æ³•å¦‚ä¸‹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{service "release.web@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>ä¸Šé¢çš„ä¾‹å­æŸ¥è¯¢Consulä¸­,åœ¨<code>east-aws</code>æ•°æ®ä¸­å¿ƒå­˜åœ¨çš„å¥åº·çš„ <code>web</code>æœåŠ¡.tagå’Œæ•°æ®ä¸­å¿ƒå‚æ•°æ˜¯å¯é€‰çš„.ä»å½“å‰æ•°æ®ä¸­å¿ƒæŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹çš„<code>web</code>æœåŠ¡è€Œä¸ç®¡tag,æŸ¥è¯¢è¯­æ³•å¦‚ä¸‹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{service "web"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¸ªå‡½æ•°è¿”å›<code>[]*HealthService</code>ç»“æ„.å¯æŒ‰ç…§å¦‚ä¸‹æ–¹å¼åº”ç”¨åˆ°æ¨¡æ¿:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range service "web@data center"}}</span></span>
<span class="line"><span style="color:#a6accd">server {{.Name}} {{.Address}}:{{.Port}}{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>äº§ç”Ÿå¦‚ä¸‹è¾“å‡º:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">server nyc_web_01 123.456.789.10:8080</span></span>
<span class="line"><span style="color:#a6accd">server nyc_web_02 456.789.101.213:8080</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>é»˜è®¤å€¼ä¼šè¿”å›å¥åº·çš„æœåŠ¡,å¦‚æœä½ æƒ³è·å–æ‰€æœ‰æœåŠ¡,å¯ä»¥å¢åŠ <code>any</code>é€‰é¡¹,å¦‚ä¸‹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{service "web" "any"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™æ ·å°±ä¼šè¿”å›æ³¨å†Œè¿‡çš„æ‰€æœ‰æœåŠ¡,è€Œä¸è®ºä»–çš„çŠ¶æ€å¦‚ä½•.</p><p>å¦‚æœä½ æƒ³è¿‡æ»¤æŒ‡å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¥åº·çŠ¶æ€,ä½ å¯ä»¥é€šè¿‡é€—å·éš”å¼€å¤šä¸ªå¥åº·çŠ¶æ€:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{service "web" "passing, warning"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™æ ·å°†ä¼šè¿”å›è¢«ä»–ä»¬çš„èŠ‚ç‚¹å’ŒæœåŠ¡çº§åˆ«çš„æ£€æŸ¥å®šä¹‰æ ‡è®°ä¸º â€œpassingâ€ æˆ–è€… â€œwarningâ€çš„æœåŠ¡. è¯·æ³¨æ„é€—å·æ˜¯ <code>OR</code>è€Œä¸æ˜¯<code>AND</code>çš„æ„æ€.</p><p>æŒ‡å®šäº†è¶…è¿‡ä¸€ä¸ªçŠ¶æ€è¿‡æ»¤,å¹¶åŒ…å«<code>any</code>å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯.å› ä¸º<code>any</code>æ˜¯æ¯”æ‰€æœ‰çŠ¶æ€æ›´é«˜çº§çš„è¿‡æ»¤.</p><p>åé¢è¿™2ç§æ–¹å¼æœ‰äº›æ¶æ„ä¸Šçš„ä¸åŒ:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{service "web"}}</span></span>
<span class="line"><span style="color:#a6accd">{{service "web" "passing"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å‰è€…ä¼šè¿”å›Consulè®¤ä¸º<code>healthy</code>å’Œ<code>passing</code>çš„æ‰€æœ‰æœåŠ¡.åè€…å°†è¿”å›æ‰€æœ‰å·²ç»åœ¨Consulæ³¨å†Œçš„æœåŠ¡.ç„¶åä¼šæ‰§è¡Œä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿‡æ»¤.é€šå¸¸å¦‚æœä½ æƒ³è·å–å¥åº·çš„æœåŠ¡,ä½ åº”è¯¥ä¸è¦ä½¿ç”¨<code>passing</code>å‚æ•°,ç›´æ¥å¿½ç•¥ç¬¬ä¸‰ä¸ªå‚æ•°å³å¯.ç„¶è€Œç¬¬ä¸‰ä¸ªå‚æ•°åœ¨ä½ æƒ³æŸ¥è¯¢ passingæˆ–è€…<code>warning</code>çš„æœåŠ¡ä¼šæ¯”è¾ƒæœ‰ç”¨,å¦‚ä¸‹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{service "web" "passing, warning"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æœåŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯å¯è§çš„,å¦‚æœä½ æƒ³è‡ªå·±åšä¸€äº›é¢å¤–çš„è¿‡æ»¤,è¯­æ³•å¦‚ä¸‹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range service "web" "any"}}</span></span>
<span class="line"><span style="color:#a6accd">{{if eq .Status "critical"}}</span></span>
<span class="line"><span style="color:#a6accd">// Critical state!{{end}}</span></span>
<span class="line"><span style="color:#a6accd">{{if eq .Status "passing"}}</span></span>
<span class="line"><span style="color:#a6accd">// Ok{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ‰§è¡Œå‘½ä»¤æ—¶,åœ¨Consulå°†æœåŠ¡è®¾ç½®ä¸ºç»´æŠ¤æ¨¡å¼,åªéœ€è¦åœ¨ä½ çš„å‘½ä»¤ä¸ŠåŒ…ä¸ŠConsulçš„ <code>maint</code> è°ƒç”¨:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">#!/bin/sh</span></span>
<span class="line"><span style="color:#a6accd">set -e</span></span>
<span class="line"><span style="color:#a6accd">consul maint -enable -service web -reason "Consul Template updated"</span></span>
<span class="line"><span style="color:#a6accd">service nginx reload</span></span>
<span class="line"><span style="color:#a6accd">consul maint -disable -service web</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦å¤–å¦‚æœä½ æ²¡æœ‰å®‰è£…Consul agent,ä½ å¯ä»¥ç›´æ¥è°ƒç”¨APIè¯·æ±‚:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">#!/bin/sh</span></span>
<span class="line"><span style="color:#a6accd">set -e</span></span>
<span class="line"><span style="color:#a6accd">curl -X PUT "http://$CONSUL_HTTP_ADDR/v1/agent/service/maintenance/web?enable=true&amp;reason=Consul+Template+Updated"</span></span>
<span class="line"><span style="color:#a6accd">service nginx reload</span></span>
<span class="line"><span style="color:#a6accd">curl -X PUT "http://$CONSUL_HTTP_ADDR/v1/agent/service/maintenance/web?enable=false"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>services</strong> æŸ¥è¯¢Consulç›®å½•ä¸­çš„æ‰€æœ‰æœåŠ¡,ä½¿ç”¨å¦‚ä¸‹è¯­æ³•:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{services}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿™ä¸ªä¾‹å­å°†æŸ¥è¯¢Consulçš„é»˜è®¤æ•°æ®ä¸­å¿ƒ,ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯é€‰å‚æ•°æ¥æŒ‡å®šæ•°æ®ä¸­å¿ƒ:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{services "@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¯·æ³¨æ„: serviceså‡½æ•°ä¸serviceæ˜¯ä¸åŒçš„,serviceæ¥å—æ›´å¤šå‚æ•°å¹¶ä¸”æŸ¥è¯¢ç›‘æ§çš„æœåŠ¡åˆ—è¡¨.è¿™ä¸ªæŸ¥è¯¢Consulç›®å½•å¹¶è¿”å›ä¸€ä¸ªæœåŠ¡çš„tagçš„Map,å¦‚ä¸‹:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range services}}</span></span>
<span class="line"><span style="color:#a6accd">{{.Name}}</span></span>
<span class="line"><span style="color:#a6accd">{{range .Tags}}</span></span>
<span class="line"><span style="color:#a6accd">  {{.}}{{end}}</span></span>
<span class="line"><span style="color:#a6accd">{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p><strong>tree</strong> æŸ¥è¯¢æ‰€æœ‰æŒ‡å®šå‰ç¼€çš„key-valueå€¼å¯¹,å¦‚æœå…¶ä¸­çš„å€¼æœ‰æ— æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„åˆ™å¼•å‘é”™è¯¯:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">{{range tree "service/redis@east-aws"}}</span></span>
<span class="line"><span style="color:#a6accd">{{.Key}} {{.Value}}{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å¦‚æœConsulå®ä¾‹åœ¨<code>east-aws</code>æ•°æ®ä¸­å¿ƒæœ‰ä¸€ä¸ª<code>service/redis</code>ç»“æ„,æ¨¡æ¿çš„æ¸²æŸ“ç»“æœç±»ä¼¼ä¸‹é¢:</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">minconns 2</span></span>
<span class="line"><span style="color:#a6accd">maxconns 12</span></span>
<span class="line"><span style="color:#a6accd">nested/config/value "value"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>å’Œ<code>ls</code>ä¸åŒ,<code>tree</code>è¿”å›å‰ç¼€ä¸‹çš„æ‰€æœ‰key.å’ŒUnixçš„treeå‘½ä»¤æ¯”è¾ƒåƒ.å¦‚æœå¿½ç•¥æ•°æ®ä¸­å¿ƒå‚æ•°,åˆ™ä¼šä½¿ç”¨æœ¬åœ°æ•°æ®ä¸­å¿ƒ</p><p><a href="https://book-consul-guide.vnzmi.com/11_consul_template.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->æŸ¥çœ‹æ›´å¤š<!--]--></a></p><p><a href="https://book-consul-guide.vnzmi.com/11_consul_template.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->é¡¹ç›®Githubåœ°å€<!--]--></a></p><h2 id="haproxy-å®ä¾‹" tabindex="-1">Haproxy å®ä¾‹ <a aria-current="page" href="#haproxy-å®ä¾‹" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h2><p>æ ¹æ®haproxyæœåŠ¡çš„é…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªconsul-templateæ¨¡ç‰ˆæ¸²æŸ“æ–‡ä»¶ï¼š<code>haproxy.ctmpl</code></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># Consul Haproxy configured</span></span>
<span class="line"><span style="color:#a6accd">global</span></span>
<span class="line"><span style="color:#a6accd">        maxconn         20480</span></span>
<span class="line"><span style="color:#a6accd">        ulimit-n        65535</span></span>
<span class="line"><span style="color:#a6accd">        log             127.0.0.1 local5</span></span>
<span class="line"><span style="color:#a6accd">        uid             200</span></span>
<span class="line"><span style="color:#a6accd">        gid             200</span></span>
<span class="line"><span style="color:#a6accd">        chroot          /usr/local/haproxy</span></span>
<span class="line"><span style="color:#a6accd">        nbproc          1</span></span>
<span class="line"><span style="color:#a6accd">        daemon</span></span>
<span class="line"><span style="color:#a6accd">        pidfile         /usr/local/haproxy/logs/haproxy.pid</span></span>
<span class="line"><span style="color:#a6accd">defaults</span></span>
<span class="line"><span style="color:#a6accd">        log             global</span></span>
<span class="line"><span style="color:#a6accd">        mode            http</span></span>
<span class="line"><span style="color:#a6accd">        option          httplog</span></span>
<span class="line"><span style="color:#a6accd">        option          dontlognull</span></span>
<span class="line"><span style="color:#a6accd">        option          forwardfor</span></span>
<span class="line"><span style="color:#a6accd">        option          abortonclose</span></span>
<span class="line"><span style="color:#a6accd">        retries         3</span></span>
<span class="line"><span style="color:#a6accd">        maxconn         3000</span></span>
<span class="line"><span style="color:#a6accd">        stats           enable</span></span>
<span class="line"><span style="color:#a6accd">        stats           hide-version</span></span>
<span class="line"><span style="color:#a6accd">        stats   uri     /admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   auth    admin:admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   refresh 10s</span></span>
<span class="line"><span style="color:#a6accd">        balance         roundrobin</span></span>
<span class="line"><span style="color:#a6accd">        timeout connect 5000ms</span></span>
<span class="line"><span style="color:#a6accd">        timeout client 50000ms</span></span>
<span class="line"><span style="color:#a6accd">        timeout server 50000ms</span></span>
<span class="line"><span style="color:#a6accd">        timeout check 2000ms</span></span>
<span class="line"><span style="color:#a6accd">listen web_haproxy</span></span>
<span class="line"><span style="color:#a6accd">        bind 0.0.0.0:8080</span></span>
<span class="line"><span style="color:#a6accd">        mode http</span></span>
<span class="line"><span style="color:#a6accd">        log     127.0.0.1 local5 err</span></span>
<span class="line"><span style="color:#a6accd">        stats   refresh 5s</span></span>
<span class="line"><span style="color:#a6accd">        stats   uri /admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   realm liang lian</span></span>
<span class="line"><span style="color:#a6accd">        stats   auth admin:admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   hide-version</span></span>
<span class="line"><span style="color:#a6accd">        stats   admin if TRUE</span></span>
<span class="line"><span style="color:#a6accd">frontend consul</span></span>
<span class="line"><span style="color:#a6accd">        bind    0.0.0.0:8500</span></span>
<span class="line"><span style="color:#a6accd">        mode    http</span></span>
<span class="line"><span style="color:#a6accd">        log     global</span></span>
<span class="line"><span style="color:#a6accd">        default_backend consul-cluster</span></span>
<span class="line"><span style="color:#a6accd">backend consul-cluster</span></span>
<span class="line"><span style="color:#a6accd">        mode http</span></span>
<span class="line"><span style="color:#a6accd">        {{range service "Faceid"}}</span></span>
<span class="line"><span style="color:#a6accd">        server {{.ID}} {{.Address}}:{{.Port}} check inter 5000 fall 1 rise 2 weight 2{{end}}</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>è¿è¡Œconsul-templateä½œä¸ºä¸€ä¸ªæœåŠ¡,é€šè¿‡ä¸Šé¢çš„æ¸²æŸ“æ¨¡ç‰ˆæ¸²æŸ“ä¸€ä¸ªhaproxy.cfgçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯haproxyæœåŠ¡</p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd">consul-template -consul-addr=10.201.102.185:8500 -template "/root/haproxy.ctmpl:/etc/haproxy.cfg:service haproxy restart"</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>10.201.102.185 çœ‹æˆ‘ä¸Šç¯‡æ–‡ç« <a href="http://www.liangxiansen.cn/2017/03/06/haproxy/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->Haproxy<!--]--></a>ï¼Œè¿™æ˜¯consulé›†ç¾¤çš„VIPï¼Œä¸ºäº†é¿å…å•ç‹¬è°ƒæŸä¸€å°æœåŠ¡å™¨æœåŠ¡å™¨å‡ºç°æ•…éšœåconsul-templateæ— æ³•å·¥ä½œã€‚</p><p>æ¸²æŸ“åçš„<code>haproxy.cfg</code></p><div class="language-"><span class="copy"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#a6accd"># Consul Haproxy configured</span></span>
<span class="line"><span style="color:#a6accd">global</span></span>
<span class="line"><span style="color:#a6accd">        maxconn         20480</span></span>
<span class="line"><span style="color:#a6accd">        ulimit-n        65535</span></span>
<span class="line"><span style="color:#a6accd">        log             127.0.0.1 local5</span></span>
<span class="line"><span style="color:#a6accd">        uid             200</span></span>
<span class="line"><span style="color:#a6accd">        gid             200</span></span>
<span class="line"><span style="color:#a6accd">        chroot          /usr/local/haproxy</span></span>
<span class="line"><span style="color:#a6accd">        nbproc          1</span></span>
<span class="line"><span style="color:#a6accd">        daemon</span></span>
<span class="line"><span style="color:#a6accd">        pidfile         /usr/local/haproxy/logs/haproxy.pid</span></span>
<span class="line"><span style="color:#a6accd">defaults</span></span>
<span class="line"><span style="color:#a6accd">        log             global</span></span>
<span class="line"><span style="color:#a6accd">        mode            http</span></span>
<span class="line"><span style="color:#a6accd">        option          httplog</span></span>
<span class="line"><span style="color:#a6accd">        option          dontlognull</span></span>
<span class="line"><span style="color:#a6accd">        option          forwardfor</span></span>
<span class="line"><span style="color:#a6accd">        option          abortonclose</span></span>
<span class="line"><span style="color:#a6accd">        retries         3</span></span>
<span class="line"><span style="color:#a6accd">        maxconn         3000</span></span>
<span class="line"><span style="color:#a6accd">        stats           enable</span></span>
<span class="line"><span style="color:#a6accd">        stats           hide-version</span></span>
<span class="line"><span style="color:#a6accd">        stats   uri     /admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   auth    admin:admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   refresh 10s</span></span>
<span class="line"><span style="color:#a6accd">        balance         roundrobin</span></span>
<span class="line"><span style="color:#a6accd">        timeout connect 5000ms</span></span>
<span class="line"><span style="color:#a6accd">        timeout client 50000ms</span></span>
<span class="line"><span style="color:#a6accd">        timeout server 50000ms</span></span>
<span class="line"><span style="color:#a6accd">        timeout check 2000ms</span></span>
<span class="line"><span style="color:#a6accd">listen web_haproxy</span></span>
<span class="line"><span style="color:#a6accd">        bind 0.0.0.0:8080</span></span>
<span class="line"><span style="color:#a6accd">        mode http</span></span>
<span class="line"><span style="color:#a6accd">        log     127.0.0.1 local5 err</span></span>
<span class="line"><span style="color:#a6accd">        stats   refresh 5s</span></span>
<span class="line"><span style="color:#a6accd">        stats   uri /admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   realm liang lian</span></span>
<span class="line"><span style="color:#a6accd">        stats   auth admin:admin</span></span>
<span class="line"><span style="color:#a6accd">        stats   hide-version</span></span>
<span class="line"><span style="color:#a6accd">        stats   admin if TRUE</span></span>
<span class="line"><span style="color:#a6accd">frontend consul</span></span>
<span class="line"><span style="color:#a6accd">        bind    0.0.0.0:8500</span></span>
<span class="line"><span style="color:#a6accd">        mode    http</span></span>
<span class="line"><span style="color:#a6accd">        log     global</span></span>
<span class="line"><span style="color:#a6accd">        default_backend consul-cluster</span></span>
<span class="line"><span style="color:#a6accd">backend consul-cluster</span></span>
<span class="line"><span style="color:#a6accd">        mode http</span></span>
<span class="line"><span style="color:#a6accd">        server Faceid 10.201.102.198:9000 check inter 5000 fall 1 rise 2 weight 2</span></span>
<span class="line"><span style="color:#a6accd">        server Faceid 10.201.102.199:9000 check inter 5000 fall 1 rise 2 weight 2</span></span>
<span class="line"><span style="color:#a6accd">        server Faceid 10.201.102.200:9000 check inter 5000 fall 1 rise 2 weight 2</span></span>
<span class="line"><span style="color:#a6accd"></span></span></code></pre></div><p>æ•´ä¸ªå°±æ˜¯æ­å»ºconsulé›†ç¾¤ï¼Œå¹³å°ä¸­çš„æœåŠ¡ä¼šæ³¨å†Œåˆ°consulé›†ç¾¤ä¸­ï¼Œhaproxyé¿å…consul-templateè°ƒconsulæ—¶å‡ºç°å•ç‚¹æ•…éšœconsul-templateæ— æ³•å·¥ä½œåšçš„é«˜å¯ç”¨ï¼ŒConsul-templateå°±æ˜¯èƒ½åœ¨æ•´ä¸ªå¹³å°çš„å„ä¸ªç³»ç»Ÿå’Œåº”ç”¨ä¸­ä½¿ç”¨ï¼ŒæŸ¥è¯¢consulé›†ç¾¤æ¥è·å–å¹³å°ä¸Šå„ä¸ªåº”ç”¨çš„å­˜æ´»çŠ¶æ€å’ŒIPã€‚</p><p>æ•´å¥—ä¸‹æ¥å®ç°äº†ä¸¤ä¸ªé‡ç‚¹ï¼š</p><p>å®ç°äº†ä¸­å¿ƒæœåŠ¡æ³¨å†ŒæŸ¥è¯¢ å¹³å°ä¸­å…¶ä»–èŠ‚ç‚¹çš„æŸ¥è¯¢æœåŠ¡å’Œé…ç½®æ–‡ä»¶è‡ªåŠ¨æ›´æ–°</p><h1 id="å‚è€ƒèµ„æ–™" tabindex="-1">å‚è€ƒèµ„æ–™ <a aria-current="page" href="#å‚è€ƒèµ„æ–™" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p><a href="https://my.oschina.net/guol/blog/675281" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://my.oschina.net/guol/blog/675281<!--]--></a><a href="https://www.consul.io/docs/guides/index.html" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://www.consul.io/docs/guides/index.html<!--]--></a><a href="https://www.gitbook.com/book/vincentmi/consul-guide/details" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://www.gitbook.com/book/vincentmi/consul-guide/details<!--]--></a></p><p><a href="https://my.oschina.net/abcfy2/blog/675665" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->https://my.oschina.net/abcfy2/blog/675665<!--]--></a></p><h1 id="ä¸‹è½½" tabindex="-1">ä¸‹è½½ <a aria-current="page" href="#ä¸‹è½½" class="router-link-active router-link-exact-active header-anchor" showexternalicon="false" aria-hidden="true"><!--[-->#<!--]--></a></h1><p><a href="http://www.liangxiansen.cn/files/consul.pdf" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->ç‚¹å‡»ä¸‹è½½PDFæ–‡ä»¶<!--]--></a></p><p>åŸ:<a href="http://www.liangxiansen.cn/2017/04/06/consul/" class="" showexternalicon="false" target="_blank" rel="noreferrer"><!--[-->http://www.liangxiansen.cn/2017/04/06/consul/<!--]--></a></p><!--]--><!--[--><!--]--><!--]--><div text="center"><!----></div><!----></article><!--]--><!--[--><!--[--><!--[--><div class="yun-sponsor-container flex justify-center items-center flex-col" m="t-6"><button class="sponsor-button yun-icon-btn shadow hover:shadow-md" title="Donate" text="red-400"><div i-ri-heart-line=""></div></button><div m="y-4" class="qrcode-container qrcode flex justify-around"><!--[--><!--]--></div></div><ul class="post-copyright" m="y-4"><li class="post-copyright-author"><strong>Post author: </strong><span>VALAXY Developer</span></li><li class="post-copyright-link"><strong>Post link: </strong><a href="false/posts/consul%E4%BD%BF%E7%94%A8%E4%B8%AD%E6%96%87%E6%89%8B%E5%86%8C">false/posts/consul%E4%BD%BF%E7%94%A8%E4%B8%AD%E6%96%87%E6%89%8B%E5%86%8C</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong><span>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 ">CC BY-NC-SA</a> unless otherwise stated.</span></li></ul><!--]--><!--]--><!--]--></div><!--]--><!----></div><!--[--><!--]--><!--[--><div class="post-nav"><div class="post-nav-item"><a href="/posts/k8s%E5%88%A0%E9%99%A4pv%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Eterminating" class="post-nav-prev" title="k8såˆ é™¤pvä¸€ç›´å¤„äºterminating"><div class="icon" i-ri-arrow-left-s-line=""></div><span class="title truncate" text="sm">k8såˆ é™¤pvä¸€ç›´å¤„äºterminating</span></a></div><div class="post-nav-item"><a href="/posts/%E8%85%BE%E8%AE%AF%E4%BA%91%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8coscmd%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3" class="post-nav-next" title="è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨COSCMDå·¥å…·å®‰è£…é…ç½®ä¸ä½¿ç”¨å‘½ä»¤è¯¦è§£"><span class="title truncate" text="sm">è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨COSCMDå·¥å…·å®‰è£…é…ç½®ä¸ä½¿ç”¨å‘½ä»¤è¯¦è§£</span><div class="icon" i-ri-arrow-right-s-line=""></div></a></div></div><!--]--><!--[--><!--]--><!----><!--[--><!--]--><footer class="va-footer p-4 text-$va-c-text-light" text="center sm"><div class="beian" m="y-2"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">è±«ICPå¤‡20001100å·-3</a></div><div class="copyright flex justify-center items-center gap-2" p="1"><span>Â©<!--[--> 2016 -<!--]--> 2023</span><a class="inline-flex animate-pulse" href="https://sponsors.yunyoujun.cn" target="_blank" title="Sponsor YunYouJun"><div class="i-ri-cloud-line"></div></a><span>VALAXY Developer</span></div><div class="powered" m="2"><span>Powered by <a href="https://github.com/YunYouJun/valaxy" target="_blank" rel="noopener">Valaxy</a> v0.14.0</span> | <span>Theme - <a href="https://github.com/YunYouJun/valaxy/tree/main/packages/valaxy-theme-yun" title="valaxy-theme-yun" target="_blank">Yun</a> v0.14.0</span></div><!--[--> ç”± <a href="https://www.netdun.net" target="_blank" title="ç½‘ç›¾æ˜Ÿçƒ">ç½‘ç›¾æ˜Ÿçƒ</a> æä¾› CDN æ”¯æŒ<!--]--></footer><!--[--><!--]--></div><!--]--><!--[--><!--[--><button class="xl:hidden toc-btn shadow fixed yun-icon-btn z-350" opacity="75" right="2" bottom="19"><div i-ri-file-list-line=""></div></button><!----><!--  --><aside class="va-card aside" m="l-4" text="center"><div class="aside-container" flex="~ col" overflow="auto"><h2 m="t-6 b-2" font="serif black">Table of Contents</h2><div style="display:none" data-v-f0c1ef64=""><div class="content" data-v-f0c1ef64=""><div class="outline-title" data-v-f0c1ef64="">On this page</div><div class="outline-marker" data-v-f0c1ef64=""></div><nav aria-labelledby="doc-outline-aria-label" data-v-f0c1ef64=""><span id="doc-outline-aria-label" class="visually-hidden" data-v-f0c1ef64="">Table of Contents for current page</span><ul class="root va-toc relative z-1" data-v-f0c1ef64="" data-v-df39fddf=""><!--[--><!--]--></ul></nav></div></div><div class="flex-grow"></div><div class="custom-container"><!--[--><!--]--></div></div></aside><!--]--><!--]--></div></main><a href="#" class="back-to-top yun-icon-btn"><div w="8" h="8" i-ri-arrow-up-s-line=""></div><svg class="progress-circle-container" viewBox="0 0 100 100"><circle stroke-dasharray="301.59289474462014 301.59289474462014" stroke-dashoffset="301.59289474462014" class="progress-circle" cx="50" cy="50" r="48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></circle></svg></a><!--]--><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"app":{"isSidebarOpen":false,"isRightSidebarOpen":false},"site":{}}}'</script><link rel="stylesheet" href="/assets/ValaxyMain-5904cb61.css"><link rel="stylesheet" href="/assets/post-1d1be697.css"><link rel="stylesheet" href="/assets/index-4070d21c.css"></body></html>