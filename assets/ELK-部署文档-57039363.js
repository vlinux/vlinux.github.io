import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-32fe0dc4.js";import{_ as h,c as d,w as e,o as g,b as s,U as l,q as o,r as t,W as u,p as _}from"./app-7a2d4758.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-f3ded1dd.js";import"./YunCard.vue_vue_type_style_index_0_lang-395ab441.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-b27293b7.js";const ql=JSON.parse('{"title":"ELK 部署文档","description":"","frontmatter":{"title":"ELK 部署文档","categories":"DevOps","tags":["ELK"],"date":"2020-09-24T17:06:00.000Z"},"headers":[{"level":2,"title":"1. 前言","slug":"_1-前言","link":"#_1-前言","children":[]},{"level":2,"title":"2. ELK搭建过程","slug":"_2-elk搭建过程","link":"#_2-elk搭建过程","children":[{"level":3,"title":"2.1 Elasticsearch 的安装过程","slug":"_2-1-elasticsearch-的安装过程","link":"#_2-1-elasticsearch-的安装过程","children":[]},{"level":3,"title":"2.2 logstash 安装过程","slug":"_2-2-logstash-安装过程","link":"#_2-2-logstash-安装过程","children":[]},{"level":3,"title":"2.3 Filebeat 和 nginx 安装","slug":"_2-3-filebeat-和-nginx-安装","link":"#_2-3-filebeat-和-nginx-安装","children":[]},{"level":3,"title":"2.4 编写 logstash 配置文件","slug":"_2-4-编写-logstash-配置文件","link":"#_2-4-编写-logstash-配置文件","children":[]}]}],"relativePath":"pages/posts/ELK-部署文档.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/ELK-部署文档.md","lastUpdated":1671090556000}'),i=JSON.parse('{"title":"ELK 部署文档","description":"","frontmatter":{"title":"ELK 部署文档","categories":"DevOps","tags":["ELK"],"date":"2020-09-24T17:06:00.000Z"},"headers":[{"level":2,"title":"1. 前言","slug":"_1-前言","link":"#_1-前言","children":[]},{"level":2,"title":"2. ELK搭建过程","slug":"_2-elk搭建过程","link":"#_2-elk搭建过程","children":[{"level":3,"title":"2.1 Elasticsearch 的安装过程","slug":"_2-1-elasticsearch-的安装过程","link":"#_2-1-elasticsearch-的安装过程","children":[]},{"level":3,"title":"2.2 logstash 安装过程","slug":"_2-2-logstash-安装过程","link":"#_2-2-logstash-安装过程","children":[]},{"level":3,"title":"2.3 Filebeat 和 nginx 安装","slug":"_2-3-filebeat-和-nginx-安装","link":"#_2-3-filebeat-和-nginx-安装","children":[]},{"level":3,"title":"2.4 编写 logstash 配置文件","slug":"_2-4-编写-logstash-配置文件","link":"#_2-4-编写-logstash-配置文件","children":[]}]}],"relativePath":"pages/posts/ELK-部署文档.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/ELK-部署文档.md","lastUpdated":1671090556000}'),m={name:"pages/posts/ELK-部署文档.md",data(){return{data:i,frontmatter:i.frontmatter}},setup(){_("pageData",i)}},b={id:"_1-前言",tabindex:"-1"},v=s("p",null,"在日常运维工作中，对于系统和业务日志的处理尤为重要。尤其是分布式架构，每个服务都会有很多节点，如果要手工一个一个的去取日志，运维怕是要累死。",-1),y=s("p",null,[s("strong",null,"简单介绍：")],-1),A=s("p",null,"ELK 是 elasticsearch + logstash + kibana 三款开源软件的简称。",-1),f=s("p",null,"elasticsearch：是个开源的分布式搜索引擎，特点是：分布式、配置简单、自动发现、索引自动分片、索引副本机制、restful风格接口，多数据源，自动搜索负载等",-1),C=s("p",null,"logstash：可以对日志进行收集、滤过、并将其存储在 elasticsearch中",-1),k=s("p",null,"kibana：可以为 elasticsearch提供友好的用户交互界面，用户可以通过 kibana来分析、搜索甚至绘图来分析数据。",-1),w=s("p",null,"这里介绍下目前使用比较多的架构：",-1),x=s("p",null,"ELK + filebeat",-1),D=s("p",null,"Filebeat 是一个轻量级开源日志文件数据收集器，可以将它安装到需要收集的节点上，它会将日志输送到 logstash 或 elasticsearch",-1),E=s("p",null,"有了 ELK 就可以将分布到多台的日志统一规划起来。",-1),L=s("p",null,"网络上有很多关于 ELK 的部署方案，参考了很多发现要不就是老版本的，要不就是不太完善，因此自己做下记录。",-1),K=s("p",null,"注意：在安装 ELK 的时候，这三个软件的版本必须保持支持，否则出现各种bug",-1),$={id:"_2-elk搭建过程",tabindex:"-1"},T=s("p",null,"实验拓扑图：",-1),S=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914132209462-937984345.png",alt:"img"})],-1),j=s("p",null,"实验环境主机服务介绍：",-1),q=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914132222075-940189767.png",alt:"img"})],-1),H=s("p",null,"本次实验是收集 nginx 日志，并存储在 elasticsearch中。将 elasticsearch 和 kibana 安装在同一主机上可以避免不必要的网络IO操作，直接本机交互。",-1),V={id:"_2-1-elasticsearch-的安装过程",tabindex:"-1"},M=s("p",null,"（1）初始化工作",-1),P=s("ul",null,[s("li",null,"selinux、firewall 关闭"),s("li",null,"时间同步"),s("li",null,"主机名修改"),s("li",null,"修改打开文件最大数")],-1),J=s("p",null,"时间同步：",-1),O=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~]``#ntpdate tiger.sina.com.cn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),z=s("p",null,"修改主机名：",-1),B=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~]``#hostnamectl set-hostname node1``修改完主机名别忘记在 ``/etc/hosts` `中申明``192.168.118.14 node1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),F=s("p",null,"修改文件打开最大数：",-1),I=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~]``#vim /etc/security/limits.conf``*        soft  nproc    655350``*        hard  nproc    655350``*        soft  nofile    655350``*        hard  nofile    655350` `[root@192.168.118.14 ~]``#ulimit -SHn 655350")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),N=s("p",null,"（2）配置 java 环境",-1),U=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@192.168.118.14 ``/usr/local/src``]``#tar xf jdk-8u77-linux-x64.tar.gz -C /usr/local/` `在 ``/etc/profile` `文件中追加\v``JAVA_HOME=``/usr/local/jdk1``.8.0_77``JAVA_BIN=$JAVA_HOME``/bin``PATH=$PATH:$JAVA_BIN``CLASSPATH=$JAVA_HOME``/lib/dt``.jar:$JAVA_HOME``/lib/tools``.jar``export` `JAVA_HOME JAVA_BIN PATH CLASSPATH` `[root@192.168.118.14 ``/usr/local/src``]``#source /etc/profile``[root@192.168.118.14 ``/usr/local/src``]``#ln -vs /usr/local/jdk1.8.0_77/bin/java /usr/bin/``[root@192.168.118.14 ``/usr/local/src``]``#java -version``java version ``"1.8.0_77"``Java(TM) SE Runtime Environment (build 1.8.0_77-b03)``Java HotSpot(TM) 64-Bit Server VM (build 25.77-b03, mixed mode)')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Z=s("p",null,"（3）安装 elasticsearch",-1),R=s("p",null,"这里下载的是 6.8 的 rpm 包",-1),W=s("p",null,"直接安装：",-1),Y=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@192.168.118.14 ~``/ELK``]``#yum localinstall elasticsearch-6.8.2.rpm``修改配置文件如下：``[root@192.168.118.14 ~``/ELK``]``#egrep ^[a-z] /etc/elasticsearch/elasticsearch.yml``cluster.name: super-cluster``node.name: node1``path.data: ``/var/lib/elasticsearch``path.logs: ``/var/log/elasticsearch``bootstrap.memory_lock: ``true``network.host: 0.0.0.0``http.port: 9200``discovery.zen.``ping``.unicast.hosts: [``"192.168.118.14"``]``http.cors.enabled: ``true``http.cors.allow-origin: ``"*"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),G=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914132531738-1407142167.png",alt:"img"})],-1),Q=s("p",null,"启动",-1),X=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~``/ELK``]``#systemctl enable elasticsearch ; systemctl start elasticsearch")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ss=s("p",null,"首次启动可能会启动失败，查看日志：",-1),ls=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~``/ELK``]``#tail /var/log/elasticsearch/super-cluster.log``…``[1]: memory locking requested ``for` `elasticsearch process but memory is not locked``…")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),es=s("p",null,"如上报错，需要修改启动脚本：",-1),as=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~``/ELK``]``#vim /lib/systemd/system/elasticsearch.service``在 [Service] 配置段添加：``…``LimitMEMLOCK=infinity``…` `[root@192.168.118.14 ~``/ELK``]``#systemctl daemon-reload``[root@192.168.118.14 ~``/ELK``]``#systemctl start elasticsearch")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ts=s("p",null,"查看端口，如果 9200 和 9300 监听，则说明 elasticsearch启动成功。",-1),ns=s("p",null,"验证：",-1),os=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@192.168.118.14 ~``/ELK``]``#curl http://localhost:9200/``{`` ``"name"` `: ``"node1"``,`` ``"cluster_name"` `: ``"super-cluster"``,`` ``"cluster_uuid"` `: ``"1FD-KmYMTVCzWVPI9vn8zw"``,`` ``"version"` `: {``  ``"number"` `: ``"6.8.2"``,``  ``"build_flavor"` `: ``"default"``,``  ``"build_type"` `: ``"rpm"``,``  ``"build_hash"` `: ``"b506955"``,``  ``"build_date"` `: ``"2019-07-24T15:24:41.545295Z"``,``  ``"build_snapshot"` `: ``false``,``  ``"lucene_version"` `: ``"7.7.0"``,``  ``"minimum_wire_compatibility_version"` `: ``"5.6.0"``,``  ``"minimum_index_compatibility_version"` `: ``"5.0.0"`` ``},`` ``"tagline"` `: ``"You Know, for Search"``}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),is=s("p",null,"到此，elasticsearch安装成功。",-1),cs=s("p",null,"这里多安装一个elasticsearch-head 用来调试和查看数据是非常方便的。",-1),rs=s("p",null,"首先安装依赖包",-1),ps=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"yum ``install` `git nodejs openssl-devel ``screen` `-y` `克隆 elasticsearch-``head``项目``[root@192.168.118.14 ~]``# git clone https://github.com/mobz/elasticsearch-head.git``[root@192.168.118.14 ~]``# cd elasticsearch-head/` `此时忽略phantomjs-prebuilt@2.1.16，执行命令如下``[root@node1 elasticsearch-``head``]``# npm install phantomjs-prebuilt --ignore-scripts` `[root@node1 elasticsearch-``head``]``# npm install``…")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),hs=s("p",null,"这里是一个非常缓慢的过程。",-1),ds=s("p",null,"启动 elasticsearch-head 服务",-1),gs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~]``#cd elasticsearch-head/``[root@192.168.118.14 ~``/elasticsearch-head``]``#screen``[root@node1 elasticsearch-``head``]``# npm run start``Ctrl+a Ctrl+d 将进程放置到后台，这里不懂的查下 ``screen` `命令，很好使。")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),us=s("p",null,"查看端口 只要 9100 被监听，说明启动成功。",-1),_s=s("p",null,"浏览器访问：",-1),ms=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914132738040-373062108.png",alt:"img"})],-1),bs=s("p",null,"妥了，安装成功。通过 elasticsearch-head 可以查看 elasticsearch 中的所有数据。目前就一个 node1 索引。如果要深入学习 elasticsearch 推荐一本书《elasticsearch-the-definitive-guide-cn》 网上有 PDF 可以下载。",-1),vs=s("p",null,"接下来，安装 kibana 。Kibana 和 elasticsearch安装到同一台主机的",-1),ys=s("p",null,"直接rpm包安装",-1),As=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~``/ELK``]``#yum localinstall kibana-6.8.2-x86_64.rpm -y")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),fs=s("p",null,"修改配置文件：",-1),Cs=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914132823879-2055244822.png",alt:"img"})],-1),ks=s("p",null,"这里注意，如果将 kibana 端口修改为 80 ，这里是需要修改kibana启动用户为 root 因为普通用户是不能启动 1024 以下端口的。",-1),ws=s("p",null,"修改启动配置文件：",-1),xs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.14 ~]``#vim /etc/systemd/system/kibana.service``User=root``Group=root` `再次启动服务``[root@192.168.118.14 ~]``#systemctl daemon-reload``[root@192.168.118.14 ~]``#systemctl restart kibana")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ds=s("p",null,"查看 80 端口如果被监听就说明启动成功。",-1),Es={id:"_2-2-logstash-安装过程",tabindex:"-1"},Ls=s("p",null,"根据规划，logstash 应该被安装到一台独立的主机上，logstash安装非常简单。",-1),Ks=s("p",null,"和上面一样，初始化工作不要忘记，这里就不再描述了。",-1),$s=s("p",null,"安装 jdk 也和上面一样的，jdk验证：",-1),Ts=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@192.168.118.15 ``/usr/local/src``]``#java -version``java version ``"1.8.0_77"``Java(TM) SE Runtime Environment (build 1.8.0_77-b03)``Java HotSpot(TM) 64-Bit Server VM (build 25.77-b03, mixed mode)')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ss=s("p",null,"安装 logstash",-1),js=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.15 ~]``#yum localinstall logstash-6.8.2.rpm -y` `将 logstash 命令添加到 PATH 环境变量中``[root@192.168.118.15 ``/etc/logstash``]``#vim /etc/profile.d/logstash.sh``export` `PATH=``/usr/share/logstash/bin``:$PATH")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),qs=s("p",null,"Ok, 到这里已经安装完成，是不是很简单。",-1),Hs=s("p",null,"验证：",-1),Vs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@192.168.118.15 ~]``#logstash -e \'input { stdin {} } output { stdout{} }\'``只要出现 Successfully started Logstash API endpoint {:port=>9600} 就表示启动成功。``你好，中国``{``   ``"@version"` `=> ``"1"``,``    ``"message"` `=> ``"你好，中国"``,``     ``"host"` `=> ``"logstash-node1"``,``  ``"@timestamp"` `=> 2019-09-14T04:14:35.035Z')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ms=s("p",null,"测试通过，logstash验证成功。",-1),Ps={id:"_2-3-filebeat-和-nginx-安装",tabindex:"-1"},Js=s("p",null,"首先安装 nginx 直接yum安装",-1),Os=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.16 ~]``#yum install nginx -y``启动nginx``[root@192.168.118.16 ~]``#nginx")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),zs=s("p",null,"安装 filebeat",-1),Bs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.16 ~]``#yum localinstall filebeat-6.8.2-x86_64.rpm -y``开启nginx模块``[root@192.168.118.16 ~]``#cd /etc/filebeat/``[root@192.168.118.16 ``/etc/filebeat``]``#filebeat modules enable nginx``Enabled nginx")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Fs=s("p",null,"修改 filebeat主配置文件：",-1),Is=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@192.168.118.16 ~]``#vim /etc/filebeat/filebeat.yml``注释掉输出到 elasticsearch``#output.elasticsearch:`` ``# Array of hosts to connect to.`` ``#hosts: ["localhost:9200"]` `开启输出到 logstash``output.logstash:`` ``# The Logstash hosts`` ``hosts: [``"192.168.118.16:5044"``]')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ns=s("p",null,"注意这里的 hosts 要写 logstash 主机的 IP",-1),Us=s("p",null,"修改 nginx 模块配置文件：",-1),Zs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.16 ~]``#vim /etc/filebeat/modules.d/nginx.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Rs=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133218360-1373188441.png",alt:"img"})],-1),Ws=s("p",null,"启动 filebeat 服务",-1),Ys=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.16 ~]``#systemctl start filebeat``Filebeat 服务是没有监听端口的，只要状态是 running 就表示启动成功，可以查看 filebeat 日志``/var/log/filebeat/filebeat")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Gs=s("p",null,"到此，ELK + filebeat 已经部署完毕，接下来就可以安装需求来进行调整和收集数据，而这一块的工作都集中在 logstash，因此 ELK 编写 logstash 才是难点。Logstash 配置语法，强力建议查看官方文档，非常全面了。",-1),Qs={id:"_2-4-编写-logstash-配置文件",tabindex:"-1"},Xs=s("p",null,"这里采用循序渐进的方式展开，可以先写一个简单的测试。",-1),sl=s("p",null,"编写一个将数据输出到屏幕的配置文件：",-1),ll=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.15 ``/etc/logstash/conf``.d]``#vim test.conf")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),el=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133348056-757315483.png",alt:"img"})],-1),al=s("p",null,"Logstash 可以根据配置文件来启动，启动方式如下：",-1),tl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.15 ``/etc/logstash/conf``.d]``#logstash -f test.conf``出现 Successfully started Logstash API endpoint 就表示启动成功。")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),nl=s("p",null,"启动成功后，我们尝试访问 nginx 生成日志数据。",-1),ol=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133413721-1077865656.png",alt:"img"})],-1),il=s("p",null,"日志文件已经传输过来了，接下来就是把这些数据写入到 elasticsearch 中。",-1),cl=s("p",null,"继续修改配置文件：",-1),rl=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133428819-800242405.png",alt:"img"})],-1),pl=s("p",null,"通过配置文件启动 logstash",-1),hl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@192.168.118.15 ``/etc/logstash/conf``.d]``#logstash -f test.conf")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),dl=s("p",null,"尝试访问 nginx 查看 elasticsearch-head中是否有新的索引被创建出来。",-1),gl=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133459096-999337824.png",alt:"img"})],-1),ul=s("p",null,"如上图，一个新的索引被创建出来，可以通过 elasticsearch-head 查看该索引中的数据。",-1),_l=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133507826-994463079.png",alt:"img"})],-1),ml=s("p",null,"目前已经将日志数据写入到 elasticsearch中了， 然后通过 kibana 展示出来，浏览器访问上面装好的 kibana",-1),bl=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133516828-996668443.png",alt:"img"})],-1),vl=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133533459-1057666429.png",alt:"img"})],-1),yl=s("p",null,"设置完成，直接点击 Discover",-1),Al=s("p",null,"多访问几次nginx，查看日志是否展示出来。",-1),fl=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/828019-20190914133554679-219380505.png",alt:"img"})],-1),Cl=s("p",null,"ok，到此， ELK + filebeat 获取 nginx 日志就完成了。虽然将日志展示出来了， 但是这样杂乱无章的日志数据看着还是很难受的，这就需要进一步的规整。",-1),kl=s("p",null,"下一篇再写如果更详细的通过 logstash获取nginx日志数据，然后通过kibana展示更规整的数据及绘图。",-1);function wl(a,xl,Dl,El,c,Ll){const n=u,r=p;return g(),d(r,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":e(()=>[s("h2",b,[l("1. 前言 "),o(n,{class:"header-anchor",href:"#_1-前言","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),v,y,A,f,C,k,w,x,D,E,L,K,s("h2",$,[l("2. ELK搭建过程 "),o(n,{class:"header-anchor",href:"#_2-elk搭建过程","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),T,S,j,q,H,s("h3",V,[l("2.1 Elasticsearch 的安装过程 "),o(n,{class:"header-anchor",href:"#_2-1-elasticsearch-的安装过程","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),M,P,J,O,z,B,F,I,N,U,Z,s("p",null,[l("下载地址："),o(n,{href:"https://www.elastic.co/cn/downloads/past-releases#elasticsearch",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://www.elastic.co/cn/downloads/past-releases#elasticsearch")]),_:1})]),R,W,Y,G,Q,X,ss,ls,es,as,ts,ns,os,is,cs,s("p",null,[l("程序下载地址："),o(n,{href:"https://github.com/mobz/elasticsearch-head",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://github.com/mobz/elasticsearch-head")]),_:1})]),rs,ps,hs,ds,gs,us,_s,ms,bs,vs,s("p",null,[l("Kibana 下载地址："),o(n,{href:"https://www.elastic.co/cn/downloads/past-releases#kibana",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://www.elastic.co/cn/downloads/past-releases#kibana")]),_:1})]),ys,As,fs,Cs,ks,ws,xs,Ds,s("h3",Es,[l("2.2 logstash 安装过程 "),o(n,{class:"header-anchor",href:"#_2-2-logstash-安装过程","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),Ls,s("p",null,[l("Logstash 下载地址："),o(n,{href:"https://www.elastic.co/cn/downloads/past-releases#logstash",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://www.elastic.co/cn/downloads/past-releases#logstash")]),_:1})]),Ks,$s,Ts,Ss,js,qs,Hs,Vs,Ms,s("h3",Ps,[l("2.3 Filebeat 和 nginx 安装 "),o(n,{class:"header-anchor",href:"#_2-3-filebeat-和-nginx-安装","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),s("p",null,[l("Filebeat 下载地址："),o(n,{href:"https://www.elastic.co/cn/downloads/past-releases#filebeat",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://www.elastic.co/cn/downloads/past-releases#filebeat")]),_:1})]),Js,Os,zs,Bs,Fs,Is,Ns,Us,Zs,Rs,Ws,Ys,Gs,s("h3",Qs,[l("2.4 编写 logstash 配置文件 "),o(n,{class:"header-anchor",href:"#_2-4-编写-logstash-配置文件","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),Xs,sl,ll,el,al,tl,nl,ol,il,cl,rl,pl,hl,dl,gl,ul,_l,ml,bl,vl,yl,Al,fl,Cl,kl]),"main-header":e(()=>[t(a.$slots,"main-header")]),"main-header-after":e(()=>[t(a.$slots,"main-header-after")]),"main-nav":e(()=>[t(a.$slots,"main-nav")]),"main-content":e(()=>[t(a.$slots,"main-content")]),"main-content-after":e(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":e(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":e(()=>[t(a.$slots,"main-nav-after")]),comment:e(()=>[t(a.$slots,"comment")]),footer:e(()=>[t(a.$slots,"footer")]),aside:e(()=>[t(a.$slots,"aside")]),"aside-custom":e(()=>[t(a.$slots,"aside-custom")]),default:e(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter","data"])}const Hl=h(m,[["render",wl]]);export{ql as __pageData,Hl as default};
