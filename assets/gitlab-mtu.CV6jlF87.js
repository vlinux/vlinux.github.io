import{_ as m}from"./ValaxyMain.vue_vue_type_style_index_0_lang.Bth_JSAQ.js";import"./chunks/@vueuse/motion.BITvz5PP.js";import{e as h,u as g,a as b}from"./chunks/vue-router.DpP0leKZ.js";import{aa as f,ap as e,ag as l,af as a,ai as n,P as k,ab as y,a1 as v}from"./framework.GHZxz7jq.js";import"./index.Di1n2b66.js";import"./chunks/dayjs.BldX5ftQ.js";import"./chunks/vue-i18n.C7V8WoQZ.js";import"./chunks/pinia.BfAlK2F6.js";import"./chunks/nprogress.BZwbcB2O.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.BWywLGB4.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.fblE3Fel.js";import"./post.DoKt6roH.js";const x=h("/posts/gitlab-mtu",async s=>JSON.parse('{"title":"MTU 不匹配导致网络访问异常的原理与解决方案","description":"","frontmatter":{"title":"MTU 不匹配导致网络访问异常的原理与解决方案","categories":"Linux技术","tags":["网络","Gitlab"],"date":"2025-09-04 16:56:45"},"headers":[],"relativePath":"pages/posts/gitlab-mtu.md","lastUpdated":null}'),{lazy:(s,i)=>s.name===i.name}),D={__name:"gitlab-mtu",setup(s,{expose:i}){const{data:o}=x(),u=b(),p=g(),r=Object.assign(p.meta.frontmatter||{},o.value?.frontmatter||{});return u.currentRoute.value.data=o.value,v("valaxy:frontmatter",r),globalThis.$frontmatter=r,i({frontmatter:{title:"MTU 不匹配导致网络访问异常的原理与解决方案",categories:"Linux技术",tags:["网络","Gitlab"],date:"2025-09-04 16:56:45"}}),(t,c)=>{const d=m;return y(),f(d,{frontmatter:k(r)},{"main-content-md":e(()=>[...c[0]||(c[0]=[a("h2",{id:"问题现象",tabindex:"-1"},[n("问题现象 "),a("a",{class:"header-anchor",href:"#问题现象","aria-label":'Permalink to "问题现象"'},"​")],-1),a("p",null,"当用户访问部署在内网的 Gitlab 服务时，出现网络连接不稳定、部分请求失败或 SSH 连接超时等问题，需要将用户端的网卡 MTU 值调整为比服务器端更小的值才能正常访问。",-1),a("h2",{id:"根本原因-路径-mtu-发现机制失效",tabindex:"-1"},[n("根本原因：路径 MTU 发现机制失效 "),a("a",{class:"header-anchor",href:"#根本原因-路径-mtu-发现机制失效","aria-label":'Permalink to "根本原因：路径 MTU 发现机制失效"'},"​")],-1),a("h3",{id:"什么是-mtu",tabindex:"-1"},[n("什么是 MTU？ "),a("a",{class:"header-anchor",href:"#什么是-mtu","aria-label":'Permalink to "什么是 MTU？"'},"​")],-1),a("p",null,[a("strong",null,"MTU（Maximum Transmission Unit）"),n(" 是指网络接口一次能够传输的最大数据包大小（单位：字节）。")],-1),a("ul",null,[a("li",null,"标准以太网默认值：1500 字节"),a("li",null,"PPPoE 拨号常见值：1492 字节"),a("li",null,"VPN/隧道网络常见值：1400-1450 字节")],-1),a("h3",{id:"问题发生机制",tabindex:"-1"},[n("问题发生机制 "),a("a",{class:"header-anchor",href:"#问题发生机制","aria-label":'Permalink to "问题发生机制"'},"​")],-1),a("figure",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/%E9%97%AE%E9%A2%98%E5%8F%91%E7%94%9F%E6%9C%BA%E5%88%B6.png",alt:"问题发生机制",loading:"lazy",decoding:"async"})],-1),a("h2",{id:"解决方案",tabindex:"-1"},[n("解决方案 "),a("a",{class:"header-anchor",href:"#解决方案","aria-label":'Permalink to "解决方案"'},"​")],-1),a("h3",{id:"方案一-调整用户端-mtu-临时方案",tabindex:"-1"},[n("方案一：调整用户端 MTU（临时方案） "),a("a",{class:"header-anchor",href:"#方案一-调整用户端-mtu-临时方案","aria-label":'Permalink to "方案一：调整用户端 MTU（临时方案）"'},"​")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"# Linux 系统")]),n(`
`),a("span",{class:"line"},[a("span",null,"sudo ip link set dev eth0 mtu 1400")]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# Windows 系统（管理员权限）")]),n(`
`),a("span",{class:"line"},[a("span",null,'netsh interface ipv4 set subinterface "以太网" mtu=1400 store=persistent')]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# macOS 系统")]),n(`
`),a("span",{class:"line"},[a("span",null,"sudo ifconfig en0 mtu 1400")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h3",{id:"方案二-调整服务器端-mtu-推荐方案",tabindex:"-1"},[n("方案二：调整服务器端 MTU（推荐方案） "),a("a",{class:"header-anchor",href:"#方案二-调整服务器端-mtu-推荐方案","aria-label":'Permalink to "方案二：调整服务器端 MTU（推荐方案）"'},"​")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"# 临时修改")]),n(`
`),a("span",{class:"line"},[a("span",null,"sudo ip link set dev eth0 mtu 1500")]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# 永久修改（CentOS/RHEL）")]),n(`
`),a("span",{class:"line"},[a("span",null,'echo "MTU=1500" | sudo tee -a /etc/sysconfig/network-scripts/ifcfg-eth0')]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# 永久修改（Ubuntu/Debian）")]),n(`
`),a("span",{class:"line"},[a("span",null,"sudo nmcli connection modify eth0 ethernet.mtu 1500")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h3",{id:"方案三-网络设备调整-根本解决方案",tabindex:"-1"},[n("方案三：网络设备调整（根本解决方案） "),a("a",{class:"header-anchor",href:"#方案三-网络设备调整-根本解决方案","aria-label":'Permalink to "方案三：网络设备调整（根本解决方案）"'},"​")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"# Docker 网络调整")]),n(`
`),a("span",{class:"line"},[a("span",null,"docker network create --opt com.docker.network.driver.mtu=1500 gitlab-network")]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# Kubernetes CNI 配置")]),n(`
`),a("span",{class:"line"},[a("span",null,'# 在 CNI 配置文件中添加: "mtu": 1500')])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"诊断命令",tabindex:"-1"},[n("诊断命令 "),a("a",{class:"header-anchor",href:"#诊断命令","aria-label":'Permalink to "诊断命令"'},"​")],-1),a("h3",{id:"检测路径-mtu",tabindex:"-1"},[n("检测路径 MTU "),a("a",{class:"header-anchor",href:"#检测路径-mtu","aria-label":'Permalink to "检测路径 MTU"'},"​")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"# 使用 ping 检测路径 MTU")]),n(`
`),a("span",{class:"line"},[a("span",null,"ping -M do -s 1472 your-gitlab-server.com")]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# 逐步调整 -s 值直到能通，计算公式：MTU = 值 + 28")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h3",{id:"查看当前-mtu-设置",tabindex:"-1"},[n("查看当前 MTU 设置 "),a("a",{class:"header-anchor",href:"#查看当前-mtu-设置","aria-label":'Permalink to "查看当前 MTU 设置"'},"​")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"# Linux 系统")]),n(`
`),a("span",{class:"line"},[a("span",null,"ip link show | grep mtu")]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# Windows 系统")]),n(`
`),a("span",{class:"line"},[a("span",null,"netsh interface ipv4 show interfaces")]),n(`
`),a("span",{class:"line"},[a("span")]),n(`
`),a("span",{class:"line"},[a("span",null,"# macOS 系统")]),n(`
`),a("span",{class:"line"},[a("span",null,"ifconfig | grep mtu")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"最佳实践",tabindex:"-1"},[n("最佳实践 "),a("a",{class:"header-anchor",href:"#最佳实践","aria-label":'Permalink to "最佳实践"'},"​")],-1),a("ol",null,[a("li",null,[a("strong",null,"保持一致性"),n("：确保网络路径中所有设备的 MTU 设置一致")]),a("li",null,[a("strong",null,"标准化"),n("：尽量使用 1500 的标准 MTU 值")]),a("li",null,[a("strong",null,"监控预警"),n("：设置网络监控，及时发现 MTU 不匹配问题")]),a("li",null,[a("strong",null,"文档记录"),n("：记录网络环境的特殊 MTU 要求")])],-1),a("h2",{id:"常见环境-mtu-参考值",tabindex:"-1"},[n("常见环境 MTU 参考值 "),a("a",{class:"header-anchor",href:"#常见环境-mtu-参考值","aria-label":'Permalink to "常见环境 MTU 参考值"'},"​")],-1),a("table",null,[a("thead",null,[a("tr",null,[a("th",{style:{"text-align":"center"}},"网络环境"),a("th",{style:{"text-align":"center"}},"推荐 MTU"),a("th",{style:{"text-align":"center"}},"说明")])]),a("tbody",null,[a("tr",null,[a("td",{style:{"text-align":"center"}},"标准以太网"),a("td",{style:{"text-align":"center"}},"1500"),a("td",{style:{"text-align":"center"}},"大多数网络的默认值")]),a("tr",null,[a("td",{style:{"text-align":"center"}},"PPPoE 拨号"),a("td",{style:{"text-align":"center"}},"1492"),a("td",{style:{"text-align":"center"}},"ADSL 拨号常见设置")]),a("tr",null,[a("td",{style:{"text-align":"center"}},"VPN 隧道"),a("td",{style:{"text-align":"center"}},"1400-1450"),a("td",{style:{"text-align":"center"}},"OpenVPN、WireGuard 等")]),a("tr",null,[a("td",{style:{"text-align":"center"}},"云服务器"),a("td",{style:{"text-align":"center"}},"1500"),a("td",{style:{"text-align":"center"}},"AWS、阿里云等默认值")]),a("tr",null,[a("td",{style:{"text-align":"center"}},"容器网络"),a("td",{style:{"text-align":"center"}},"1500"),a("td",{style:{"text-align":"center"}},"需要与主机一致")])])],-1)])]),"main-header":e(()=>[l(t.$slots,"main-header")]),"main-header-after":e(()=>[l(t.$slots,"main-header-after")]),"main-nav":e(()=>[l(t.$slots,"main-nav")]),"main-content-before":e(()=>[l(t.$slots,"main-content-before")]),"main-content":e(()=>[l(t.$slots,"main-content")]),"main-content-after":e(()=>[l(t.$slots,"main-content-after")]),"main-nav-before":e(()=>[l(t.$slots,"main-nav-before")]),"main-nav-after":e(()=>[l(t.$slots,"main-nav-after")]),comment:e(()=>[l(t.$slots,"comment")]),footer:e(()=>[l(t.$slots,"footer")]),aside:e(()=>[l(t.$slots,"aside")]),"aside-custom":e(()=>[l(t.$slots,"aside-custom")]),default:e(()=>[l(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{D as default,x as usePageData};
