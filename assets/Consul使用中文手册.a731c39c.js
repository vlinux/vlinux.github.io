import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang.0d268722.js";import{_ as r,c as p,w as n,o as C,r as a,b as s,R as l,p as A}from"./app.7d008c65.js";import"./YunFooter.vue_vue_type_script_setup_true_lang.05401363.js";import"./YunCard.vue_vue_type_style_index_0_lang.4a8fe257.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.60c12e42.js";const go=JSON.parse('{"title":"Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C","description":"","frontmatter":{"title":"Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C","categories":"\u81EA\u52A8\u6CE8\u518C","tags":["Consul"],"date":"2021-01-28T14:49:00.000Z"},"headers":[{"level":2,"title":"\u4ECB\u7ECD","slug":"\u4ECB\u7ECD","link":"#\u4ECB\u7ECD","children":[]},{"level":2,"title":"\u57FA\u7840\u67B6\u6784","slug":"\u57FA\u7840\u67B6\u6784","link":"#\u57FA\u7840\u67B6\u6784","children":[]},{"level":2,"title":"\u5B89\u88C5Consul","slug":"\u5B89\u88C5consul","link":"#\u5B89\u88C5consul","children":[]},{"level":2,"title":"\u9A8C\u8BC1\u5B89\u88C5","slug":"\u9A8C\u8BC1\u5B89\u88C5","link":"#\u9A8C\u8BC1\u5B89\u88C5","children":[]},{"level":2,"title":"\u8FD0\u884CAgent","slug":"\u8FD0\u884Cagent","link":"#\u8FD0\u884Cagent","children":[]},{"level":2,"title":"\u542F\u52A8 Consul Server","slug":"\u542F\u52A8-consul-server","link":"#\u542F\u52A8-consul-server","children":[]},{"level":2,"title":"\u542F\u52A8 Consul Client","slug":"\u542F\u52A8-consul-client","link":"#\u542F\u52A8-consul-client","children":[]},{"level":2,"title":"\u505C\u6B62Agent","slug":"\u505C\u6B62agent","link":"#\u505C\u6B62agent","children":[]},{"level":2,"title":"\u66F4\u65B0\u670D\u52A1","slug":"\u66F4\u65B0\u670D\u52A1","link":"#\u66F4\u65B0\u670D\u52A1","children":[]},{"level":2,"title":"\u67E5\u8BE2\u670D\u52A1","slug":"\u67E5\u8BE2\u670D\u52A1","link":"#\u67E5\u8BE2\u670D\u52A1","children":[]},{"level":2,"title":"WEB\u7BA1\u7406\u754C\u9762","slug":"web\u7BA1\u7406\u754C\u9762","link":"#web\u7BA1\u7406\u754C\u9762","children":[]},{"level":2,"title":"\u5065\u5EB7\u68C0\u67E5","slug":"\u5065\u5EB7\u68C0\u67E5","link":"#\u5065\u5EB7\u68C0\u67E5","children":[]},{"level":2,"title":"\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","slug":"\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","link":"#\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","children":[]},{"level":2,"title":"K \uFF0FV","slug":"k-\uFF0Fv","link":"#k-\uFF0Fv","children":[]},{"level":2,"title":"Agent","slug":"agent","link":"#agent","children":[]},{"level":2,"title":"event","slug":"event","link":"#event","children":[]},{"level":2,"title":"exec","slug":"exec","link":"#exec","children":[]},{"level":2,"title":"force-leave","slug":"force-leave","link":"#force-leave","children":[]},{"level":2,"title":"info","slug":"info","link":"#info","children":[]},{"level":2,"title":"join","slug":"join","link":"#join","children":[]},{"level":2,"title":"keygen","slug":"keygen","link":"#keygen","children":[]},{"level":2,"title":"leave","slug":"leave","link":"#leave","children":[]},{"level":2,"title":"members","slug":"members","link":"#members","children":[]},{"level":2,"title":"monitor","slug":"monitor","link":"#monitor","children":[]},{"level":2,"title":"reload","slug":"reload","link":"#reload","children":[]},{"level":2,"title":"version","slug":"version","link":"#version","children":[]},{"level":2,"title":"watch","slug":"watch","link":"#watch","children":[]},{"level":2,"title":"agent","slug":"agent-1","link":"#agent-1","children":[]},{"level":2,"title":"catalog","slug":"catalog","link":"#catalog","children":[]},{"level":2,"title":"health","slug":"health","link":"#health","children":[]},{"level":2,"title":"session","slug":"session","link":"#session","children":[]},{"level":2,"title":"acl","slug":"acl","link":"#acl","children":[]},{"level":2,"title":"event","slug":"event-1","link":"#event-1","children":[]},{"level":2,"title":"status","slug":"status","link":"#status","children":[]},{"level":2,"title":"\u5B89\u88C5","slug":"\u5B89\u88C5","link":"#\u5B89\u88C5","children":[]},{"level":2,"title":"\u4F7F\u7528","slug":"\u4F7F\u7528","link":"#\u4F7F\u7528","children":[]},{"level":2,"title":"\u547D\u4EE4\u884C","slug":"\u547D\u4EE4\u884C","link":"#\u547D\u4EE4\u884C","children":[]},{"level":2,"title":"\u6A21\u7248\u8BED\u6CD5","slug":"\u6A21\u7248\u8BED\u6CD5","link":"#\u6A21\u7248\u8BED\u6CD5","children":[]},{"level":2,"title":"API \u51FD\u6570","slug":"api-\u51FD\u6570","link":"#api-\u51FD\u6570","children":[]},{"level":2,"title":"Haproxy \u5B9E\u4F8B","slug":"haproxy-\u5B9E\u4F8B","link":"#haproxy-\u5B9E\u4F8B","children":[]}],"relativePath":"pages/posts/Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C.md","lastUpdated":1671090556000}'),o=JSON.parse('{"title":"Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C","description":"","frontmatter":{"title":"Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C","categories":"\u81EA\u52A8\u6CE8\u518C","tags":["Consul"],"date":"2021-01-28T14:49:00.000Z"},"headers":[{"level":2,"title":"\u4ECB\u7ECD","slug":"\u4ECB\u7ECD","link":"#\u4ECB\u7ECD","children":[]},{"level":2,"title":"\u57FA\u7840\u67B6\u6784","slug":"\u57FA\u7840\u67B6\u6784","link":"#\u57FA\u7840\u67B6\u6784","children":[]},{"level":2,"title":"\u5B89\u88C5Consul","slug":"\u5B89\u88C5consul","link":"#\u5B89\u88C5consul","children":[]},{"level":2,"title":"\u9A8C\u8BC1\u5B89\u88C5","slug":"\u9A8C\u8BC1\u5B89\u88C5","link":"#\u9A8C\u8BC1\u5B89\u88C5","children":[]},{"level":2,"title":"\u8FD0\u884CAgent","slug":"\u8FD0\u884Cagent","link":"#\u8FD0\u884Cagent","children":[]},{"level":2,"title":"\u542F\u52A8 Consul Server","slug":"\u542F\u52A8-consul-server","link":"#\u542F\u52A8-consul-server","children":[]},{"level":2,"title":"\u542F\u52A8 Consul Client","slug":"\u542F\u52A8-consul-client","link":"#\u542F\u52A8-consul-client","children":[]},{"level":2,"title":"\u505C\u6B62Agent","slug":"\u505C\u6B62agent","link":"#\u505C\u6B62agent","children":[]},{"level":2,"title":"\u66F4\u65B0\u670D\u52A1","slug":"\u66F4\u65B0\u670D\u52A1","link":"#\u66F4\u65B0\u670D\u52A1","children":[]},{"level":2,"title":"\u67E5\u8BE2\u670D\u52A1","slug":"\u67E5\u8BE2\u670D\u52A1","link":"#\u67E5\u8BE2\u670D\u52A1","children":[]},{"level":2,"title":"WEB\u7BA1\u7406\u754C\u9762","slug":"web\u7BA1\u7406\u754C\u9762","link":"#web\u7BA1\u7406\u754C\u9762","children":[]},{"level":2,"title":"\u5065\u5EB7\u68C0\u67E5","slug":"\u5065\u5EB7\u68C0\u67E5","link":"#\u5065\u5EB7\u68C0\u67E5","children":[]},{"level":2,"title":"\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","slug":"\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","link":"#\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","children":[]},{"level":2,"title":"K \uFF0FV","slug":"k-\uFF0Fv","link":"#k-\uFF0Fv","children":[]},{"level":2,"title":"Agent","slug":"agent","link":"#agent","children":[]},{"level":2,"title":"event","slug":"event","link":"#event","children":[]},{"level":2,"title":"exec","slug":"exec","link":"#exec","children":[]},{"level":2,"title":"force-leave","slug":"force-leave","link":"#force-leave","children":[]},{"level":2,"title":"info","slug":"info","link":"#info","children":[]},{"level":2,"title":"join","slug":"join","link":"#join","children":[]},{"level":2,"title":"keygen","slug":"keygen","link":"#keygen","children":[]},{"level":2,"title":"leave","slug":"leave","link":"#leave","children":[]},{"level":2,"title":"members","slug":"members","link":"#members","children":[]},{"level":2,"title":"monitor","slug":"monitor","link":"#monitor","children":[]},{"level":2,"title":"reload","slug":"reload","link":"#reload","children":[]},{"level":2,"title":"version","slug":"version","link":"#version","children":[]},{"level":2,"title":"watch","slug":"watch","link":"#watch","children":[]},{"level":2,"title":"agent","slug":"agent-1","link":"#agent-1","children":[]},{"level":2,"title":"catalog","slug":"catalog","link":"#catalog","children":[]},{"level":2,"title":"health","slug":"health","link":"#health","children":[]},{"level":2,"title":"session","slug":"session","link":"#session","children":[]},{"level":2,"title":"acl","slug":"acl","link":"#acl","children":[]},{"level":2,"title":"event","slug":"event-1","link":"#event-1","children":[]},{"level":2,"title":"status","slug":"status","link":"#status","children":[]},{"level":2,"title":"\u5B89\u88C5","slug":"\u5B89\u88C5","link":"#\u5B89\u88C5","children":[]},{"level":2,"title":"\u4F7F\u7528","slug":"\u4F7F\u7528","link":"#\u4F7F\u7528","children":[]},{"level":2,"title":"\u547D\u4EE4\u884C","slug":"\u547D\u4EE4\u884C","link":"#\u547D\u4EE4\u884C","children":[]},{"level":2,"title":"\u6A21\u7248\u8BED\u6CD5","slug":"\u6A21\u7248\u8BED\u6CD5","link":"#\u6A21\u7248\u8BED\u6CD5","children":[]},{"level":2,"title":"API \u51FD\u6570","slug":"api-\u51FD\u6570","link":"#api-\u51FD\u6570","children":[]},{"level":2,"title":"Haproxy \u5B9E\u4F8B","slug":"haproxy-\u5B9E\u4F8B","link":"#haproxy-\u5B9E\u4F8B","children":[]}],"relativePath":"pages/posts/Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C.md","lastUpdated":1671090556000}'),d={name:"pages/posts/Consul\u4F7F\u7528\u4E2D\u6587\u624B\u518C.md",data(){return{data:o,frontmatter:o.frontmatter}},setup(){A("pageData",o)}},u=s("h1",{id:"\u4F7F\u7528consul",tabindex:"-1"},[l("\u4F7F\u7528consul "),s("a",{class:"header-anchor",href:"#\u4F7F\u7528consul","aria-hidden":"true"},"#")],-1),y=s("h2",{id:"\u4ECB\u7ECD",tabindex:"-1"},[l("\u4ECB\u7ECD "),s("a",{class:"header-anchor",href:"#\u4ECB\u7ECD","aria-hidden":"true"},"#")],-1),h=s("p",null,"Consul\u5305\u542B\u591A\u4E2A\u7EC4\u4EF6,\u4F46\u662F\u4F5C\u4E3A\u4E00\u4E2A\u6574\u4F53,\u4E3A\u4F60\u7684\u57FA\u7840\u8BBE\u65BD\u63D0\u4F9B\u670D\u52A1\u53D1\u73B0\u548C\u670D\u52A1\u914D\u7F6E\u7684\u5DE5\u5177.\u4ED6\u63D0\u4F9B\u4EE5\u4E0B\u5173\u952E\u7279\u6027:",-1),D=s("p",null,[s("strong",null,"\u670D\u52A1\u53D1\u73B0"),l(" Consul\u7684\u5BA2\u6237\u7AEF\u53EF\u7528\u63D0\u4F9B\u4E00\u4E2A\u670D\u52A1,\u6BD4\u5982 api \u6216\u8005mysql ,\u53E6\u5916\u4E00\u4E9B\u5BA2\u6237\u7AEF\u53EF\u7528\u4F7F\u7528Consul\u53BB\u53D1\u73B0\u4E00\u4E2A\u6307\u5B9A\u670D\u52A1\u7684\u63D0\u4F9B\u8005.\u901A\u8FC7DNS\u6216\u8005HTTP\u5E94\u7528\u7A0B\u5E8F\u53EF\u7528\u5F88\u5BB9\u6613\u7684\u627E\u5230\u4ED6\u6240\u4F9D\u8D56\u7684\u670D\u52A1. "),s("strong",null,"\u5065\u5EB7\u68C0\u67E5"),l(" Consul\u5BA2\u6237\u7AEF\u53EF\u7528\u63D0\u4F9B\u4EFB\u610F\u6570\u91CF\u7684\u5065\u5EB7\u68C0\u67E5,\u6307\u5B9A\u4E00\u4E2A\u670D\u52A1(\u6BD4\u5982:webserver\u662F\u5426\u8FD4\u56DE\u4E86200 OK \u72B6\u6001\u7801)\u6216\u8005\u4F7F\u7528\u672C\u5730\u8282\u70B9(\u6BD4\u5982:\u5185\u5B58\u4F7F\u7528\u662F\u5426\u5927\u4E8E90%). \u8FD9\u4E2A\u4FE1\u606F\u53EF\u7531operator\u7528\u6765\u76D1\u89C6\u96C6\u7FA4\u7684\u5065\u5EB7.\u88AB\u670D\u52A1\u53D1\u73B0\u7EC4\u4EF6\u7528\u6765\u907F\u514D\u5C06\u6D41\u91CF\u53D1\u9001\u5230\u4E0D\u5065\u5EB7\u7684\u4E3B\u673A. "),s("strong",null,"Key/Value\u5B58\u50A8"),l(" \u5E94\u7528\u7A0B\u5E8F\u53EF\u7528\u6839\u636E\u81EA\u5DF1\u7684\u9700\u8981\u4F7F\u7528Consul\u7684\u5C42\u7EA7\u7684Key/Value\u5B58\u50A8.\u6BD4\u5982\u52A8\u6001\u914D\u7F6E,\u529F\u80FD\u6807\u8BB0,\u534F\u8C03,\u9886\u8896\u9009\u4E3E\u7B49\u7B49,\u7B80\u5355\u7684HTTP API\u8BA9\u4ED6\u66F4\u6613\u4E8E\u4F7F\u7528. "),s("strong",null,"\u591A\u6570\u636E\u4E2D\u5FC3"),l(" Consul\u652F\u6301\u5F00\u7BB1\u5373\u7528\u7684\u591A\u6570\u636E\u4E2D\u5FC3.\u8FD9\u610F\u5473\u7740\u7528\u6237\u4E0D\u9700\u8981\u62C5\u5FC3\u9700\u8981\u5EFA\u7ACB\u989D\u5916\u7684\u62BD\u8C61\u5C42\u8BA9\u4E1A\u52A1\u6269\u5C55\u5230\u591A\u4E2A\u533A\u57DF. Consul\u9762\u5411DevOps\u548C\u5E94\u7528\u5F00\u53D1\u8005\u53CB\u597D.\u662F\u4ED6\u9002\u5408\u73B0\u4EE3\u7684\u5F39\u6027\u7684\u57FA\u7840\u8BBE\u65BD. "),s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/cluster.png",alt:"consul-cluster"})],-1),g=s("h2",{id:"\u57FA\u7840\u67B6\u6784",tabindex:"-1"},[l("\u57FA\u7840\u67B6\u6784 "),s("a",{class:"header-anchor",href:"#\u57FA\u7840\u67B6\u6784","aria-hidden":"true"},"#")],-1),_=s("p",null,"Consul\u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\u9AD8\u53EF\u7528\u7684\u7CFB\u7EDF. \u8FD9\u8282\u5C06\u5305\u542B\u4E00\u4E9B\u57FA\u7840,\u6211\u4EEC\u5FFD\u7565\u6389\u4E00\u4E9B\u7EC6\u8282\u8FD9\u6837\u4F60\u53EF\u4EE5\u5FEB\u901F\u4E86\u89E3Consul\u662F\u5982\u4F55\u5DE5\u4F5C\u7684.\u5982\u679C\u8981\u4E86\u89E3\u66F4\u591A\u7EC6\u8282,\u8BF7\u53C2\u8003\u6DF1\u5165\u7684\u67B6\u6784\u63CF\u8FF0.",-1),v=s("p",null,"\u6BCF\u4E2A\u63D0\u4F9B\u670D\u52A1\u7ED9Consul\u7684\u9636\u6BB5\u90FD\u8FD0\u884C\u4E86\u4E00\u4E2AConsul agent . \u53D1\u73B0\u670D\u52A1\u6216\u8005\u8BBE\u7F6E\u548C\u83B7\u53D6 key/value\u5B58\u50A8\u7684\u6570\u636E\u4E0D\u662F\u5FC5\u987B\u8FD0\u884Cagent.\u8FD9\u4E2Aagent\u662F\u8D1F\u8D23\u5BF9\u8282\u70B9\u81EA\u8EAB\u548C\u8282\u70B9\u4E0A\u7684\u670D\u52A1\u8FDB\u884C\u5065\u5EB7\u68C0\u67E5\u7684.",-1),m=s("p",null,"Agent\u4E0E\u4E00\u4E2A\u548C\u591A\u4E2AConsul Server \u8FDB\u884C\u4EA4\u4E92.Consul Server \u7528\u4E8E\u5B58\u653E\u548C\u590D\u5236\u6570\u636E.server\u81EA\u884C\u9009\u4E3E\u4E00\u4E2A\u9886\u8896.\u867D\u7136Consul\u53EF\u4EE5\u8FD0\u884C\u5728\u4E00\u53F0server , \u4F46\u662F\u5EFA\u8BAE\u4F7F\u75283\u52305\u53F0\u6765\u907F\u514D\u5931\u8D25\u60C5\u51B5\u4E0B\u6570\u636E\u7684\u4E22\u5931.\u6BCF\u4E2A\u6570\u636E\u4E2D\u5FC3\u5EFA\u8BAE\u914D\u7F6E\u4E00\u4E2Aserver\u96C6\u7FA4.",-1),f=s("p",null,"\u4F60\u57FA\u7840\u8BBE\u65BD\u4E2D\u9700\u8981\u53D1\u73B0\u5176\u4ED6\u670D\u52A1\u7684\u7EC4\u4EF6\u53EF\u4EE5\u67E5\u8BE2\u4EFB\u4F55\u4E00\u4E2AConsul \u7684server\u6216\u8005 agent.Agent\u4F1A\u81EA\u52A8\u8F6C\u53D1\u8BF7\u6C42\u5230server .",-1),b=s("p",null,"\u6BCF\u4E2A\u6570\u636E\u4E2D\u8FD0\u884C\u4E86\u4E00\u4E2AConsul server\u96C6\u7FA4.\u5F53\u4E00\u4E2A\u8DE8\u6570\u636E\u4E2D\u5FC3\u7684\u670D\u52A1\u53D1\u73B0\u548C\u914D\u7F6E\u8BF7\u6C42\u521B\u5EFA\u65F6.\u672C\u5730Consul Server\u8F6C\u53D1\u8BF7\u6C42\u5230\u8FDC\u7A0B\u7684\u6570\u636E\u4E2D\u5FC3\u5E76\u8FD4\u56DE\u7ED3\u679C.",-1),w=s("p",null,[l("\u66F4\u591A\u4ECB\u7ECD\u67E5\u770B\u5B98\u7F51"),s("a",{href:"https://www.consul.io/",target:"_blank",rel:"noreferrer"},"\u70B9\u51FB\u524D\u5F80")],-1),k=s("h2",{id:"\u5B89\u88C5consul",tabindex:"-1"},[l("\u5B89\u88C5Consul "),s("a",{class:"header-anchor",href:"#\u5B89\u88C5consul","aria-hidden":"true"},"#")],-1),T=s("p",null,[l("\u5B89\u88C5Consul,\u627E\u5230\u9002\u5408\u4F60\u7CFB\u7EDF\u7684\u5305\u4E0B\u8F7D\u4ED6.Consul\u6253\u5305\u4E3A\u4E00\u4E2A\u2019Zip\u2019\u6587\u4EF6."),s("a",{href:"https://www.consul.io/downloads.html",target:"_blank",rel:"noreferrer"},"\u524D\u5F80\u4E0B\u8F7D")],-1),x=s("p",null,[l("\u4E0B\u8F7D\u540E\u89E3\u5F00\u538B\u7F29\u5305.\u62F7\u8D1DConsul\u5230\u4F60\u7684PATH\u8DEF\u5F84\u4E2D,\u5728Unix\u7CFB\u7EDF\u4E2D"),s("code",null,"~/bin"),l("\u548C"),s("code",null,"/usr/local/bin"),l("\u662F\u901A\u5E38\u7684\u5B89\u88C5\u76EE\u5F55.\u6839\u636E\u4F60\u662F\u60F3\u4E3A\u5355\u4E2A\u7528\u6237\u5B89\u88C5\u8FD8\u662F\u7ED9\u6574\u4E2A\u7CFB\u7EDF\u5B89\u88C5\u6765\u9009\u62E9.\u5728Windows\u7CFB\u7EDF\u4E2D\u6709\u53EF\u4EE5\u5B89\u88C5\u5230"),s("code",null,"%PATH%"),l("\u7684\u8DEF\u5F84\u4E2D.")],-1),I=s("h2",{id:"\u9A8C\u8BC1\u5B89\u88C5",tabindex:"-1"},[l("\u9A8C\u8BC1\u5B89\u88C5 "),s("a",{class:"header-anchor",href:"#\u9A8C\u8BC1\u5B89\u88C5","aria-hidden":"true"},"#")],-1),S=s("p",null,[l("\u5B8C\u6210\u5B89\u88C5\u540E,\u901A\u8FC7\u6253\u5F00\u4E00\u4E2A\u65B0\u7EC8\u7AEF\u7A97\u53E3\u68C0\u67E5"),s("code",null,"consul"),l("\u5B89\u88C5\u662F\u5426\u6210\u529F.\u901A\u8FC7\u6267\u884C "),s("code",null,"consul"),l("\u4F60\u5E94\u8BE5\u770B\u5230\u7C7B\u4F3C\u4E0B\u9762\u7684\u8F93\u51FA")],-1),N=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-248 ~]# consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"usage: consul [--version] [--help] <command> [<args>]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Available commands are:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    agent          Runs a Consul agent")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    configtest     Validate config file")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    event          Fire a new event")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    exec           Executes a command on Consul nodes")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    force-leave    Forces a member of the cluster to enter the "left" state')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    info           Provides debugging information for operators")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    join           Tell Consul agent to join cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    keygen         Generates a new encryption key")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    keyring        Manages gossip layer encryption keys")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    kv             Interact with the key-value store")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    leave          Gracefully leaves the Consul cluster and shuts down")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    lock           Execute a command holding a lock")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    maint          Controls node or service maintenance mode")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    members        Lists the members of a Consul cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    monitor        Stream logs from a Consul agent")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    operator       Provides cluster-level tools for Consul operators")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    reload         Triggers the agent to reload configuration files")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    rtt            Estimates network round trip time between nodes")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    snapshot       Saves, restores and inspects snapshots of Consul server state")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    version        Prints the Consul version")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    watch          Watch for changes in Consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),P=s("p",null,[l("\u5982\u679C\u4F60\u5F97\u5230\u4E00\u4E2A"),s("code",null,"consul not be found"),l("\u7684\u9519\u8BEF,\u4F60\u7684"),s("code",null,"PATH"),l("\u53EF\u80FD\u6CA1\u6709\u6B63\u786E\u8BBE\u7F6E.\u8BF7\u8FD4\u56DE\u68C0\u67E5\u4F60\u7684consul\u7684\u5B89\u88C5\u8DEF\u5F84\u662F\u5426\u5305\u542B\u5728"),s("code",null,"PATH"),l("\u4E2D.")],-1),E=s("h2",{id:"\u8FD0\u884Cagent",tabindex:"-1"},[l("\u8FD0\u884CAgent "),s("a",{class:"header-anchor",href:"#\u8FD0\u884Cagent","aria-hidden":"true"},"#")],-1),R=s("p",null,[l("\u5B8C\u6210Consul\u7684\u5B89\u88C5\u540E,\u5FC5\u987B\u8FD0\u884Cagent. agent\u53EF\u4EE5\u8FD0\u884C\u4E3A"),s("code",null,"server"),l("\u6216"),s("code",null,"client"),l("\u6A21\u5F0F.\u6BCF\u4E2A\u6570\u636E\u4E2D\u5FC3\u81F3\u5C11\u5FC5\u987B\u62E5\u6709\u4E00\u53F0server . \u5EFA\u8BAE\u5728\u4E00\u4E2A\u96C6\u7FA4\u4E2D\u67093\u6216\u80055\u4E2Aserver.\u90E8\u7F72\u5355\u4E00\u7684server,\u5728\u51FA\u73B0\u5931\u8D25\u65F6\u4F1A\u4E0D\u53EF\u907F\u514D\u7684\u9020\u6210\u6570\u636E\u4E22\u5931.")],-1),j=s("p",null,"\u5176\u4ED6\u7684agent\u8FD0\u884C\u4E3Aclient\u6A21\u5F0F.\u4E00\u4E2Aclient\u662F\u4E00\u4E2A\u975E\u5E38\u8F7B\u91CF\u7EA7\u7684\u8FDB\u7A0B.\u7528\u4E8E\u6CE8\u518C\u670D\u52A1,\u8FD0\u884C\u5065\u5EB7\u68C0\u67E5\u548C\u8F6C\u53D1\u5BF9server\u7684\u67E5\u8BE2.agent\u5FC5\u987B\u5728\u96C6\u7FA4\u4E2D\u7684\u6BCF\u4E2A\u4E3B\u673A\u4E0A\u8FD0\u884C.",-1),O=s("p",null,[l("\u67E5\u770B\u542F\u52A8\u6570\u636E\u4E2D\u5FC3\u7684\u7EC6\u8282\u8BF7\u67E5\u770B"),s("a",{href:"https://www.consul.io/docs/guides/bootstrapping.html",target:"_blank",rel:"noreferrer"},"\u8FD9\u91CC"),l(".")],-1),L=s("h2",{id:"\u542F\u52A8-consul-server",tabindex:"-1"},[l("\u542F\u52A8 Consul Server "),s("a",{class:"header-anchor",href:"#\u542F\u52A8-consul-server","aria-hidden":"true"},"#")],-1),V=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul agent -server -bootstrap-expect 3 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -ui-dir ./consul_ui/ -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),H=s("p",null,[l("\u8FD0\u884Ccosnul agent\u4EE5"),s("code",null,"server"),l("\u6A21\u5F0F\uFF0C")],-1),F=s("ul",null,[s("li",null,[s("code",null,"-server"),l(" \uFF1A \u5B9A\u4E49agent\u8FD0\u884C\u5728server\u6A21\u5F0F")]),s("li",null,[s("code",null,"-bootstrap-expect"),l(" \uFF1A\u5728\u4E00\u4E2Adatacenter\u4E2D\u671F\u671B\u63D0\u4F9B\u7684server\u8282\u70B9\u6570\u76EE\uFF0C\u5F53\u8BE5\u503C\u63D0\u4F9B\u7684\u65F6\u5019\uFF0Cconsul\u4E00\u76F4\u7B49\u5230\u8FBE\u5230\u6307\u5B9Asever\u6570\u76EE\u7684\u65F6\u5019\u624D\u4F1A\u5F15\u5BFC\u6574\u4E2A\u96C6\u7FA4\uFF0C\u8BE5\u6807\u8BB0\u4E0D\u80FD\u548Cbootstrap\u5171\u7528")]),s("li",null,[s("code",null,"-bind"),l("\uFF1A\u8BE5\u5730\u5740\u7528\u6765\u5728\u96C6\u7FA4\u5185\u90E8\u7684\u901A\u8BAF\uFF0C\u96C6\u7FA4\u5185\u7684\u6240\u6709\u8282\u70B9\u5230\u5730\u5740\u90FD\u5FC5\u987B\u662F\u53EF\u8FBE\u7684\uFF0C\u9ED8\u8BA4\u662F0.0.0.0")]),s("li",null,[s("code",null,"-node"),l("\uFF1A\u8282\u70B9\u5728\u96C6\u7FA4\u4E2D\u7684\u540D\u79F0\uFF0C\u5728\u4E00\u4E2A\u96C6\u7FA4\u4E2D\u5FC5\u987B\u662F\u552F\u4E00\u7684\uFF0C\u9ED8\u8BA4\u662F\u8BE5\u8282\u70B9\u7684\u4E3B\u673A\u540D")]),s("li",null,[s("code",null,"-ui-dir"),l("\uFF1A \u63D0\u4F9B\u5B58\u653Eweb ui\u8D44\u6E90\u7684\u8DEF\u5F84\uFF0C\u8BE5\u76EE\u5F55\u5FC5\u987B\u662F\u53EF\u8BFB\u7684")]),s("li",null,[s("code",null,"-rejoin"),l("\uFF1A\u4F7Fconsul\u5FFD\u7565\u5148\u524D\u7684\u79BB\u5F00\uFF0C\u5728\u518D\u6B21\u542F\u52A8\u540E\u4ECD\u65E7\u5C1D\u8BD5\u52A0\u5165\u96C6\u7FA4\u4E2D\u3002")]),s("li",null,[s("code",null,"-config-dir"),l("\uFF1A\u914D\u7F6E\u6587\u4EF6\u76EE\u5F55\uFF0C\u91CC\u9762\u6240\u6709\u4EE5.json\u7ED3\u5C3E\u7684\u6587\u4EF6\u90FD\u4F1A\u88AB\u52A0\u8F7D")]),s("li",null,[s("code",null,"-client"),l("\uFF1Aconsul\u670D\u52A1\u4FA6\u542C\u5730\u5740\uFF0C\u8FD9\u4E2A\u5730\u5740\u63D0\u4F9BHTTP\u3001DNS\u3001RPC\u7B49\u670D\u52A1\uFF0C\u9ED8\u8BA4\u662F127.0.0.1\u6240\u4EE5\u4E0D\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\uFF0C\u5982\u679C\u4F60\u8981\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u6539\u62100.0.0.0")])],-1),U=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 consul]# consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -ui-dir ./consul_ui/ -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> WARNING: Expect Mode enabled, expecting 3 servers")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Starting Consul agent...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Starting Consul agent RPC...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Consul agent running!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"           Version: 'v0.7.4'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"           Node ID: '422ec677-74ef-8f29-2f22-01effeed6334'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"         Node name: 's1'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        Datacenter: 'dc1'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            Server: true (bootstrap: false)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"       Client Addr: 0.0.0.0 (HTTP: 8500, HTTPS: -1, DNS: 8600, RPC: 8400)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      Cluster Addr: 10.201.102.198 (LAN: 8301, WAN: 8302)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    Gossip encrypt: false, RPC-TLS: false, TLS-Incoming: false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"             Atlas: <disabled>")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Log data will now stream in as it occurs:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] raft: Restored from snapshot 139-352267-1489707086023")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] raft: Initial configuration (index=6982): [{Suffrage:Voter ID:10.201.102.199:8300 Address:10.201.102.199:8300} {Suffrage:Voter ID:10.201.102.200:8300 Address:10.201.102.200:8300} {Suffrage:Voter ID:10.201.102.198:8300 Address:10.201.102.198:8300}]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    2017/03/17 18:03:08 [INFO] raft: Node at 10.201.102.198:8300 [Follower] entering Follower state (Leader: "")')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s1 10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] serf: Attempting re-join to previously known node: s2: 10.201.102.199:8301")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] consul: Adding LAN server s1 (Addr: tcp/10.201.102.198:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] consul: Raft data found, disabling bootstrap mode")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s2 10.201.102.199")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s3 10.201.102.200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] serf: Re-joined to previously known node: s2: 10.201.102.199:8301")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] consul: Adding LAN server s2 (Addr: tcp/10.201.102.199:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] consul: Adding LAN server s3 (Addr: tcp/10.201.102.200:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] serf: EventMemberJoin: s1.dc1 10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [INFO] consul: Adding WAN server s1.dc1 (Addr: tcp/10.201.102.198:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:08 [WARN] serf: Failed to re-join any previously known node")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:14 [INFO] agent: Synced service 'consul'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:14 [INFO] agent: Deregistered service 'consul01'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:14 [INFO] agent: Deregistered service 'consul02'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 18:03:14 [INFO] agent: Deregistered service 'consul03'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),G=s("p",null,[s("strong",null,"\u67E5\u770B\u96C6\u7FA4\u6210\u5458"),l(" \u65B0\u5F00\u4E00\u4E2A\u7EC8\u7AEF\u7A97\u53E3\u8FD0\u884C"),s("code",null,"consul members"),l(", \u4F60\u53EF\u4EE5\u770B\u5230Consul\u96C6\u7FA4\u7684\u6210\u5458.")],-1),M=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# consul members")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Node  Address              Status  Type    Build  Protocol  DC")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s1    10.201.102.198:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s2    10.201.102.199:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s3    10.201.102.200:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),W=s("h2",{id:"\u542F\u52A8-consul-client",tabindex:"-1"},[l("\u542F\u52A8 Consul Client "),s("a",{class:"header-anchor",href:"#\u542F\u52A8-consul-client","aria-hidden":"true"},"#")],-1),K=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul agent -data-dir /tmp/consul -node=c1 -bind=10.201.102.248 -config-dir=/etc/consul.d/ -join 10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),q=s("p",null,[l("\u8FD0\u884Ccosnul agent\u4EE5client\u6A21\u5F0F\uFF0C"),s("code",null,"-join"),l(" \u52A0\u5165\u5230\u5DF2\u6709\u7684\u96C6\u7FA4\u4E2D\u53BB\u3002")],-1),$=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-248 ~]# consul agent -data-dir /tmp/consul -node=c1 -bind=10.201.102.248 -config-dir=/etc/consul.d/ -join 10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Starting Consul agent...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Starting Consul agent RPC...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Joining cluster...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    Join completed. Synced with 1 initial agents")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Consul agent running!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"           Version: 'v0.7.4'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"           Node ID: '564dc0c7-7f4f-7402-a301-cebe7f024294'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"         Node name: 'c1'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        Datacenter: 'dc1'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            Server: false (bootstrap: false)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"       Client Addr: 127.0.0.1 (HTTP: 8500, HTTPS: -1, DNS: 8600, RPC: 8400)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      Cluster Addr: 10.201.102.248 (LAN: 8301, WAN: 8302)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    Gossip encrypt: false, RPC-TLS: false, TLS-Incoming: false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"             Atlas: <disabled>")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Log data will now stream in as it occurs:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: c1 10.201.102.248")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] agent: (LAN) joining: [10.201.102.198]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: s2 10.201.102.199")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: s3 10.201.102.200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] serf: EventMemberJoin: s1 10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] agent: (LAN) joined: 1 Err: <nil>")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] consul: adding server s2 (Addr: tcp/10.201.102.199:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] consul: adding server s3 (Addr: tcp/10.201.102.200:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] consul: adding server s1 (Addr: tcp/10.201.102.198:8300) (DC: dc1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    2017/03/17 15:35:16 [INFO] agent: Synced node info")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Q=s("p",null,[s("strong",null,"\u67E5\u770B\u96C6\u7FA4\u6210\u5458"),l(" \u65B0\u5F00\u4E00\u4E2A\u7EC8\u7AEF\u7A97\u53E3\u8FD0\u884C"),s("code",null,"consul members"),l(", \u4F60\u53EF\u4EE5\u770B\u5230Consul\u96C6\u7FA4\u7684\u6210\u5458.")],-1),J=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-248 ~]# consul members")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Node  Address              Status  Type    Build  Protocol  DC")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"c1    10.201.102.248:8301  alive   client  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s1    10.201.102.198:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s2    10.201.102.199:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s3    10.201.102.200:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),z=s("p",null,[s("strong",null,"\u52A0\u5165\u96C6\u7FA4")],-1),X=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-248 ~]# consul join 10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Node  Address              Status  Type    Build  Protocol  DC")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"c1    10.201.102.248:8301  alive   client  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s1    10.201.102.198:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s2    10.201.102.199:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s3    10.201.102.200:8301  alive   server  0.7.4  2         dc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),B=s("h2",{id:"\u505C\u6B62agent",tabindex:"-1"},[l("\u505C\u6B62Agent "),s("a",{class:"header-anchor",href:"#\u505C\u6B62agent","aria-hidden":"true"},"#")],-1),Y=s("p",null,[l("\u4F60\u53EF\u4EE5\u4F7F\u7528"),s("code",null,"Ctrl-C"),l(" \u4F18\u96C5\u7684\u5173\u95EDAgent. \u4E2D\u65ADAgent\u4E4B\u540E\u4F60\u53EF\u4EE5\u770B\u5230\u4ED6\u79BB\u5F00\u4E86\u96C6\u7FA4\u5E76\u5173\u95ED.")],-1),Z=s("p",null,"\u5728\u9000\u51FA\u4E2D,Consul\u63D0\u9192\u5176\u4ED6\u96C6\u7FA4\u6210\u5458,\u8FD9\u4E2A\u8282\u70B9\u79BB\u5F00\u4E86.\u5982\u679C\u4F60\u5F3A\u884C\u6740\u6389\u8FDB\u7A0B.\u96C6\u7FA4\u7684\u5176\u4ED6\u6210\u5458\u5E94\u8BE5\u80FD\u68C0\u6D4B\u5230\u8FD9\u4E2A\u8282\u70B9\u5931\u6548\u4E86.\u5F53\u4E00\u4E2A\u6210\u5458\u79BB\u5F00,\u4ED6\u7684\u670D\u52A1\u548C\u68C0\u6D4B\u4E5F\u4F1A\u4ECE\u76EE\u5F55\u4E2D\u79FB\u9664.\u5F53\u4E00\u4E2A\u6210\u5458\u5931\u6548\u4E86,\u4ED6\u7684\u5065\u5EB7\u72B6\u51B5\u88AB\u7B80\u5355\u7684\u6807\u8BB0\u4E3A\u5371\u9669,\u4F46\u662F\u4E0D\u4F1A\u4ECE\u76EE\u5F55\u4E2D\u79FB\u9664.Consul\u4F1A\u81EA\u52A8\u5C1D\u8BD5\u5BF9\u5931\u6548\u7684\u8282\u70B9\u8FDB\u884C\u91CD\u8FDE.\u5141\u8BB8\u4ED6\u4ECE\u67D0\u4E9B\u7F51\u7EDC\u6761\u4EF6\u4E0B\u6062\u590D\u8FC7\u6765.\u79BB\u5F00\u7684\u8282\u70B9\u5219\u4E0D\u4F1A\u518D\u7EE7\u7EED\u8054\u7CFB.",-1),ss=s("p",null,[l("\u6B64\u5916,\u5982\u679C\u4E00\u4E2Aagent\u4F5C\u4E3A\u4E00\u4E2A\u670D\u52A1\u5668,\u4E00\u4E2A\u4F18\u96C5\u7684\u79BB\u5F00\u662F\u5F88\u91CD\u8981\u7684,\u53EF\u4EE5\u907F\u514D\u5F15\u8D77\u6F5C\u5728\u7684\u53EF\u7528\u6027\u6545\u969C\u5F71\u54CD\u8FBE\u6210"),s("a",{href:"https://www.consul.io/docs/internals/consensus.html",target:"_blank",rel:"noreferrer"},"\u4E00\u81F4\u6027\u534F\u8BAE"),l(".")],-1),ls=s("p",null,[l("\u67E5\u770B"),s("a",{href:"https://www.consul.io/docs/internals/consensus.html",target:"_blank",rel:"noreferrer"},"\u8FD9\u91CC"),l("\u4E86\u89E3\u6DFB\u52A0\u548C\u79FB\u9664server.")],-1),ns=s("h2",{id:"\u66F4\u65B0\u670D\u52A1",tabindex:"-1"},[l("\u66F4\u65B0\u670D\u52A1 "),s("a",{class:"header-anchor",href:"#\u66F4\u65B0\u670D\u52A1","aria-hidden":"true"},"#")],-1),es=s("p",null,[l("\u670D\u52A1\u5B9A\u4E49\u53EF\u4EE5\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\u5E76\u53D1\u9001"),s("code",null,"SIGHUP"),l("\u7ED9agent\u6765\u8FDB\u884C\u66F4\u65B0.\u8FD9\u6837\u4F60\u53EF\u4EE5\u8BA9\u4F60\u5728\u4E0D\u5173\u95ED\u670D\u52A1\u6216\u8005\u4FDD\u6301\u670D\u52A1\u8BF7\u6C42\u53EF\u7528\u7684\u60C5\u51B5\u4E0B\u8FDB\u884C\u66F4\u65B0.")],-1),as=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul reload")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),os=s("p",null,"\u53E6\u5916 HTTP API\u53EF\u4EE5\u7528\u6765\u52A8\u6001\u7684\u6DFB\u52A0,\u79FB\u9664\u548C\u4FEE\u6539\u670D\u52A1.",-1),ts=s("p",null,"\u6CE8\u518C\u670D\u52A1 \u642D\u5EFA\u597Dconusl\u96C6\u7FA4\u540E\uFF0C\u7528\u6237\u6216\u8005\u7A0B\u5E8F\u5C31\u80FD\u5230consul\u4E2D\u53BB\u67E5\u8BE2\u6216\u8005\u6CE8\u518C\u670D\u52A1\u3002\u53EF\u4EE5\u901A\u8FC7\u63D0\u4F9B\u670D\u52A1\u5B9A\u4E49\u6587\u4EF6\u6216\u8005\u8C03\u7528HTTP API\u6765\u6CE8\u518C\u4E00\u4E2A\u670D\u52A1.",-1),cs=s("p",null,[l("\u9996\u5148,\u4E3AConsul\u914D\u7F6E\u521B\u5EFA\u4E00\u4E2A\u76EE\u5F55.Consul\u4F1A\u8F7D\u5165\u914D\u7F6E\u6587\u4EF6\u5939\u91CC\u7684\u6240\u6709\u914D\u7F6E\u6587\u4EF6.\u5728Unix\u7CFB\u7EDF\u4E2D\u901A\u5E38\u7C7B\u4F3C "),s("code",null,"/etc/consul.d"),l(" (.d \u540E\u7F00\u610F\u601D\u662F\u8FD9\u4E2A\u8DEF\u5F84\u5305\u542B\u4E86\u4E00\u7EC4\u914D\u7F6E\u6587\u4EF6).")],-1),is=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mkdir /etc/consul.d")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),rs=s("p",null,"\u7136\u540E,\u6211\u4EEC\u5C06\u7F16\u5199\u670D\u52A1\u5B9A\u4E49\u914D\u7F6E\u6587\u4EF6.\u5047\u8BBE\u6211\u4EEC\u6709\u4E00\u4E2A\u540D\u53EBweb\u7684\u670D\u52A1\u8FD0\u884C\u5728 80\u7AEF\u53E3.\u53E6\u5916,\u6211\u4EEC\u5C06\u7ED9\u4ED6\u8BBE\u7F6E\u4E00\u4E2A\u6807\u7B7E.\u8FD9\u6837\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u4ED6\u4F5C\u4E3A\u989D\u5916\u7684\u67E5\u8BE2\u65B9\u5F0F:",-1),ps=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`echo '{"service": {"name": "web", "tags": ["rails"], "port": 80}}' >/etc/consul.d/web.json`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Cs=s("p",null,"\u73B0\u5728\u91CD\u542Fagent , \u8BBE\u7F6E\u914D\u7F6E\u76EE\u5F55:",-1),As=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"$ consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    [INFO] agent: Synced service 'web'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ds=s("ul",null,[s("li",null,[s("code",null,"-data-dir"),l("\uFF1A\u63D0\u4F9B\u4E00\u4E2A\u76EE\u5F55\u7528\u6765\u5B58\u653Eagent\u7684\u72B6\u6001\uFF0C\u6240\u6709\u7684agent\u5141\u8BB8\u90FD\u9700\u8981\u8BE5\u76EE\u5F55\uFF0C\u8BE5\u76EE\u5F55\u5FC5\u987B\u662F\u7A33\u5B9A\u7684\uFF0C\u7CFB\u7EDF\u91CD\u542F\u540E\u90FD\u7EE7\u7EED\u5B58\u5728 \u4F60\u53EF\u80FD\u6CE8\u610F\u5230\u4E86\u8F93\u51FA\u4E86 \u201Csynced\u201D \u4E86 web\u8FD9\u4E2A\u670D\u52A1.\u610F\u601D\u662F\u8FD9\u4E2Aagent\u4ECE\u914D\u7F6E\u6587\u4EF6\u4E2D\u8F7D\u5165\u4E86\u670D\u52A1\u5B9A\u4E49,\u5E76\u4E14\u6210\u529F\u6CE8\u518C\u5230\u670D\u52A1\u76EE\u5F55.")])],-1),us=s("p",null,"\u5982\u679C\u4F60\u60F3\u6CE8\u518C\u591A\u4E2A\u670D\u52A1,\u4F60\u5E94\u8BE5\u5728Consul\u914D\u7F6E\u76EE\u5F55\u521B\u5EFA\u591A\u4E2A\u670D\u52A1\u5B9A\u4E49\u6587\u4EF6.",-1),ys=s("p",null,[l("HTTP API\u6CE8\u518C\u670D\u52A1,curl\u547D\u4EE4\u6216\u8005postman \u4EE5"),s("code",null,"PUT"),l("\u65B9\u5F0F\u8BF7\u6C42consul HTTP API\u66F4\u591A\u7EC6\u8282"),s("a",{href:"https://www.consul.io/docs/agent/http/catalog.html#catalog_register",target:"_blank",rel:"noreferrer"},"\u70B9\u51FB\u67E5\u770B")],-1),hs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`curl -X PUT -d '{"Datacenter": "dc1", "Node": "c2", "Address": "10.155.0.106", "Service": {"Service": "MAC", "tags": ["lianglian", "Mac"], "Port": 22}}' http://127.0.0.1:8500/v1/catalog/register`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ds=s("h2",{id:"\u67E5\u8BE2\u670D\u52A1",tabindex:"-1"},[l("\u67E5\u8BE2\u670D\u52A1 "),s("a",{class:"header-anchor",href:"#\u67E5\u8BE2\u670D\u52A1","aria-hidden":"true"},"#")],-1),gs=s("p",null,"\u4E00\u65E6agent\u542F\u52A8\u5E76\u4E14\u670D\u52A1\u540C\u6B65\u4E86.\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7DNS\u6216\u8005HTTP\u7684API\u6765\u67E5\u8BE2\u670D\u52A1.",-1),_s=s("p",null,[s("strong",null,"DNS API"),l(" \u8BA9\u6211\u4EEC\u9996\u5148\u4F7F\u7528DNS API\u6765\u67E5\u8BE2.\u5728DNS API\u4E2D,\u670D\u52A1\u7684DNS\u540D\u5B57\u662F "),s("code",null,"NAME.service.consul"),l(". \u867D\u7136\u662F\u53EF\u914D\u7F6E\u7684,\u4F46\u9ED8\u8BA4\u7684\u6240\u6709DNS\u540D\u5B57\u4F1A\u90FD\u5728"),s("code",null,"consul"),l("\u547D\u540D\u7A7A\u95F4\u4E0B.\u8FD9\u4E2A\u5B50\u57DF\u544A\u8BC9Consul,\u6211\u4EEC\u5728\u67E5\u8BE2\u670D\u52A1,"),s("code",null,"NAME"),l("\u5219\u662F\u670D\u52A1\u7684\u540D\u79F0.")],-1),vs=s("p",null,[l("\u5BF9\u4E8E\u6211\u4EEC\u4E0A\u9762\u6CE8\u518C\u7684Web\u670D\u52A1.\u5B83\u7684\u57DF\u540D\u662F "),s("code",null,"web.service.consul"),l(" :")],-1),ms=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 web.service.consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 <<>> @127.0.0.1 -p 8600 web.service.consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; (1 server found)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; global options: +cmd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Got answer:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39468")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WARNING: recursion requested but not available")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; QUESTION SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";web.service.consul.            IN      A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ANSWER SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"web.service.consul.     0       IN      A       10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Query time: 0 msec")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; SERVER: 127.0.0.1#8600(127.0.0.1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WHEN: Tue Mar 28 16:10:24 2017")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; MSG SIZE  rcvd: 52")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]#")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),fs=s("p",null,[l("\u5982\u4F60\u6240\u89C1,\u4E00\u4E2A"),s("code",null,"A"),l("\u8BB0\u5F55\u8FD4\u56DE\u4E86\u4E00\u4E2A\u53EF\u7528\u7684\u670D\u52A1\u6240\u5728\u7684\u8282\u70B9\u7684IP\u5730\u5740."),s("code",null,"A"),l("\u8BB0\u5F55\u53EA\u80FD\u8BBE\u7F6E\u4E3AIP\u5730\u5740. \u6709\u4E5F\u53EF\u7528\u4F7F\u7528 DNS API \u6765\u63A5\u6536\u5305\u542B \u5730\u5740\u548C\u7AEF\u53E3\u7684 SRV\u8BB0\u5F55:")],-1),bs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 web.service.consul SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 <<>> @127.0.0.1 -p 8600 web.service.consul SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; (1 server found)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; global options: +cmd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Got answer:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 13331")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WARNING: recursion requested but not available")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; QUESTION SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";web.service.consul.            IN      SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ANSWER SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"web.service.consul.     0       IN      SRV     1 1 80 s1.node.dc1.consul.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ADDITIONAL SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s1.node.dc1.consul.     0       IN      A       10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Query time: 0 msec")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; SERVER: 127.0.0.1#8600(127.0.0.1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WHEN: Tue Mar 28 16:10:56 2017")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; MSG SIZE  rcvd: 84")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]#")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ws=s("p",null,[s("code",null,"SRV"),l("\u8BB0\u5F55\u544A\u8BC9\u6211\u4EEC web \u8FD9\u4E2A\u670D\u52A1\u8FD0\u884C\u4E8E\u8282\u70B9"),s("code",null,"dhcp-10-201-102-198"),l(" \u7684"),s("code",null,"80"),l("\u7AEF\u53E3. DNS\u989D\u5916\u8FD4\u56DE\u4E86\u8282\u70B9\u7684A\u8BB0\u5F55.")],-1),ks=s("p",null,[l("\u6700\u540E,\u6211\u4EEC\u4E5F\u53EF\u4EE5\u7528 DNS API \u901A\u8FC7\u6807\u7B7E\u6765\u8FC7\u6EE4\u670D\u52A1.\u57FA\u4E8E\u6807\u7B7E\u7684\u670D\u52A1\u67E5\u8BE2\u683C\u5F0F\u4E3A"),s("code",null,"TAG.NAME.service.consul"),l(". \u5728\u4E0B\u9762\u7684\u4F8B\u5B50\u4E2D,\u6211\u4EEC\u8BF7\u6C42Consul\u8FD4\u56DE\u6709 "),s("code",null,"rails"),l("\u6807\u7B7E\u7684 "),s("code",null,"web"),l("\u670D\u52A1.\u6211\u4EEC\u6210\u529F\u83B7\u53D6\u4E86\u6211\u4EEC\u6CE8\u518C\u4E3A\u8FD9\u4E2A\u6807\u7B7E\u7684\u670D\u52A1:")],-1),Ts=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 rails.web.service.consul SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 <<>> @127.0.0.1 -p 8600 rails.web.service.consul SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; (1 server found)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; global options: +cmd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Got answer:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 37307")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WARNING: recursion requested but not available")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; QUESTION SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";rails.web.service.consul.      IN      SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ANSWER SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"rails.web.service.consul. 0     IN      SRV     1 1 80 s1.node.dc1.consul.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ADDITIONAL SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s1.node.dc1.consul.     0       IN      A       10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Query time: 0 msec")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; SERVER: 127.0.0.1#8600(127.0.0.1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WHEN: Tue Mar 28 16:11:45 2017")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; MSG SIZE  rcvd: 90")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]#")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),xs=s("p",null,[s("strong",null,"HTTP API"),l(" \u9664\u4E86DNS API\u4E4B\u5916,HTTP API\u4E5F\u53EF\u4EE5\u7528\u6765\u8FDB\u884C\u670D\u52A1\u67E5\u8BE2:")],-1),Is=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -s 127.0.0.1:8500/v1/catalog/service/web | python -m json.tool")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Address": "10.201.102.198",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 492843,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ID": "422ec677-74ef-8f29-2f22-01effeed6334",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 492843,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Node": "s1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "NodeMeta": {},')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceAddress": "",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceEnableTagOverride": false,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceID": "web",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceName": "web",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServicePort": 80,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceTags": [')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'            "rails"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        ],")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "TaggedAddresses": {')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'            "lan": "10.201.102.198",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'            "wan": "10.201.102.198"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ss=s("p",null,"\u76EE\u5F55API\u7ED9\u51FA\u6240\u6709\u8282\u70B9\u63D0\u4F9B\u7684\u670D\u52A1.\u7A0D\u540E\u6211\u4EEC\u4F1A\u50CF\u901A\u5E38\u7684\u90A3\u6837\u5E26\u4E0A\u5065\u5EB7\u68C0\u67E5\u8FDB\u884C\u67E5\u8BE2.\u5C31\u50CFDNS\u5185\u90E8\u5904\u7406\u7684\u90A3\u6837.\u8FD9\u662F\u53EA\u67E5\u770B\u5065\u5EB7\u7684\u5B9E\u4F8B\u7684\u67E5\u8BE2\u65B9\u6CD5:",-1),Ns=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -s 127.0.0.1:8500/v1/catalog/service/web?passing | python -m json.tool")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Address": "10.201.102.198",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 492843,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ID": "422ec677-74ef-8f29-2f22-01effeed6334",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 492843,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Node": "s1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "NodeMeta": {},')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceAddress": "",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceEnableTagOverride": false,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceID": "web",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceName": "web",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServicePort": 80,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceTags": [')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'            "rails"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        ],")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "TaggedAddresses": {')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'            "lan": "10.201.102.198",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'            "wan": "10.201.102.198"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ps=s("h2",{id:"web\u7BA1\u7406\u754C\u9762",tabindex:"-1"},[l("WEB\u7BA1\u7406\u754C\u9762 "),s("a",{class:"header-anchor",href:"#web\u7BA1\u7406\u754C\u9762","aria-hidden":"true"},"#")],-1),Es=s("p",null,[l("Consul\u540C\u65F6\u63D0\u4F9B\u4E86\u4E00\u4E2A\u6F02\u4EAE\u7684\u529F\u80FD\u9F50\u5168\u7684WEB\u754C\u9762,\u5F00\u7BB1\u5373\u7528.\u754C\u9762\u53EF\u4EE5\u7528\u6765\u67E5\u770B\u6240\u6709\u7684\u8282\u70B9,\u53EF\u4EE5\u67E5\u770B\u5065\u5EB7\u68C0\u67E5\u548C\u4ED6\u4EEC\u7684\u5F53\u524D\u72B6\u6001.\u53EF\u4EE5\u8BFB\u53D6\u548C\u8BBE\u7F6EK/V \u5B58\u50A8\u7684\u6570\u636E.UI\u81EA\u52A8\u652F\u6301\u591A\u6570\u636E\u4E2D\u5FC3."),s("a",{href:"https://www.consul.io/downloads.html",target:"_blank",rel:"noreferrer"},"\u70B9\u51FB\u524D\u5F80\u4E0B\u8F7D")],-1),Rs=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/ui_download.png",alt:"UI_Download"})],-1),js=s("p",null,"\u4E0B\u8F7D\u5B8C\u540E\u4E0A\u4F20\u81F3\u670D\u52A1\u5668\uFF0C\u5EFA\u8BAE\u6240\u6709server\u89D2\u8272\u90FD\u4F7F\u7528WebUI\uFF0C\u3002",-1),Os=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=s1 -bind=10.201.102.198 -ui-dir ./consul_ui/ -rejoin -config-dir=/etc/consul.d/ -client 0.0.0.0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ls=s("ul",null,[s("li",null,[s("code",null,"-ui-dir"),l("\uFF1A \u63D0\u4F9B\u5B58\u653Eweb ui\u8D44\u6E90\u7684\u8DEF\u5F84\uFF0C\u6307\u5411\u8BE5\u76EE\u5F55\u5FC5\u987B\u662F\u53EF\u8BFB\u7684")]),s("li",null,[s("code",null,"-client"),l("\uFF1Aconsul\u670D\u52A1\u4FA6\u542C\u5730\u5740\uFF0C\u8FD9\u4E2A\u5730\u5740\u63D0\u4F9BHTTP\u3001DNS\u3001RPC\u7B49\u670D\u52A1\uFF0C\u9ED8\u8BA4\u662F127.0.0.1\u6240\u4EE5\u4E0D\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\uFF0C\u5982\u679C\u4F60\u8981\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u6539\u62100.0.0.0 \u53EF\u901A\u8FC7"),s("a",{href:"http://10.201.102.198:8500/",target:"_blank",rel:"noreferrer"},"http://10.201.102.198:8500"),l("\u8BBF\u95EEWEB\u7BA1\u7406\u754C\u9762\u3002")])],-1),Vs=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/ui.png",alt:"UI_Download"})],-1),Hs=s("h2",{id:"\u5065\u5EB7\u68C0\u67E5",tabindex:"-1"},[l("\u5065\u5EB7\u68C0\u67E5 "),s("a",{class:"header-anchor",href:"#\u5065\u5EB7\u68C0\u67E5","aria-hidden":"true"},"#")],-1),Fs=s("p",null,"\u6211\u4EEC\u73B0\u5728\u770B\u5230Consul\u8FD0\u884C\u65F6\u5982\u6B64\u7B80\u5355.\u6DFB\u52A0\u8282\u70B9\u548C\u670D\u52A1,\u67E5\u8BE2\u8282\u70B9\u548C\u670D\u52A1.\u5728\u8FD9\u4E00\u8282.\u6211\u4EEC\u5C06\u7EE7\u7EED\u6DFB\u52A0\u5065\u5EB7\u68C0\u67E5\u5230\u8282\u70B9\u548C\u670D\u52A1.\u5065\u5EB7\u68C0\u67E5\u662F\u670D\u52A1\u53D1\u73B0\u7684\u5173\u952E\u7EC4\u4EF6.\u9884\u9632\u4F7F\u7528\u5230\u4E0D\u5065\u5EB7\u7684\u670D\u52A1.",-1),Us=s("p",null,"\u8FD9\u4E00\u6B65\u5EFA\u7ACB\u5728\u524D\u4E00\u8282\u7684Consul\u96C6\u7FA4\u521B\u5EFA\u4E4B\u4E0A.\u76EE\u524D\u4F60\u5E94\u8BE5\u6709\u4E00\u4E2A\u5305\u542B\u591A\u4E2A\u8282\u70B9\u7684Consul\u96C6\u7FA4.",-1),Gs=s("p",null,[s("strong",null,"\u81EA\u5B9A\u4E49\u68C0\u67E5"),l(" \u548C\u670D\u52A1\u6CE8\u518C\u7C7B\u4F3C,\u4E00\u4E2A\u68C0\u67E5\u53EF\u4EE5\u901A\u8FC7\u68C0\u67E5\u5B9A\u4E49\u6216HTTP API\u8BF7\u6C42\u6765\u6CE8\u518C.")],-1),Ms=s("p",null,"\u6211\u4EEC\u5C06\u4F7F\u7528\u548C\u68C0\u67E5\u5B9A\u4E49\u6765\u6CE8\u518C\u68C0\u67E5.\u548C\u670D\u52A1\u7C7B\u4F3C,\u56E0\u4E3A\u8FD9\u662F\u5EFA\u7ACB\u68C0\u67E5\u6700\u5E38\u7528\u7684\u65B9\u5F0F.",-1),Ws=s("p",null,"\u5728\u7B2C\u4E8C\u4E2A\u8282\u70B9\u7684\u914D\u7F6E\u76EE\u5F55\u5EFA\u7ACB\u5B9A\u4E49\u6587\u4EF6:",-1),Ks=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/etc/consul.d/web.json1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{"service": {')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "name": "Faceid",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "tags": ["extract", "verify", "compare", "idcard"],')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "address": "10.201.102.198",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "port": 9000,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "check": {')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "name": "ping",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "script": "curl -s localhost:9000",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "interval": "3s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),qs=s("p",null,"or",-1),$s=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/etc/consul.d/web.json1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{"service": {')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "name": "Faceid",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "tags": ["extract", "verify", "compare", "idcard"],')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "address": "10.201.102.199",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "port": 9000,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    "check": {')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "id": "api",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'           "name": "HTTP API on port 9000",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "http": "http://localhost:9000",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "interval": "10s",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "timeout": "1s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"   }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Qs=s("p",null,"more",-1),Js=s("h2",{id:"\u68C0\u67E5\u5065\u5EB7\u72B6\u6001",tabindex:"-1"},[l("\u68C0\u67E5\u5065\u5EB7\u72B6\u6001 "),s("a",{class:"header-anchor",href:"#\u68C0\u67E5\u5065\u5EB7\u72B6\u6001","aria-hidden":"true"},"#")],-1),zs=s("p",null,"\u6211\u4EEC\u80FD\u9002\u5E94HTTP API\u6765\u68C0\u67E5\u4ED6\u4EEC.\u9996\u5148\u6211\u4EEC\u68C0\u67E5\u6709\u54EA\u4E9B\u5931\u8D25\u7684\u68C0\u67E5.\u4F7F\u7528\u8FD9\u4E2A\u547D\u4EE4(\u6CE8\u610F:\u8FD9\u4E2A\u547D\u4EE4\u53EF\u4EE5\u8FD0\u884C\u5728\u4EFB\u4F55\u8282\u70B9)",-1),Xs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -s http://localhost:8500/v1/health/state/critical | python -m json.tool")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CheckID": "service:Faceid",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 493398,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 493846,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`        "Name": "Service 'Faceid' check",`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Node": "s1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Notes": "",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Output": "",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceID": "Faceid",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ServiceName": "Faceid",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Status": "critical"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Bs=s("p",null,[l("\u6211\u4EEC\u53EF\u4EE5\u770B\u5230,\u53EA\u6709\u4E00\u4E2A\u68C0\u67E5\u6211\u4EEC\u7684"),s("code",null,"web"),l("\u670D\u52A1\u5728"),s("code",null,"critical"),l("\u72B6\u6001")],-1),Ys=s("p",null,"\u53E6\u5916,\u6211\u4EEC\u53EF\u4EE5\u5C1D\u8BD5\u7528DNS\u67E5\u8BE2web\u670D\u52A1,Consul\u5C06\u4E0D\u4F1A\u8FD4\u56DE\u7ED3\u679C.\u56E0\u4E3A\u670D\u52A1\u4E0D\u5065\u5EB7.",-1),Zs=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# dig @127.0.0.1 -p 8600 Faceid.service.consul SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6 <<>> @127.0.0.1 -p 8600 Faceid.service.consul SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"; (1 server found)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; global options: +cmd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Got answer:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 40884")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; flags: qr aa rd; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WARNING: recursion requested but not available")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; QUESTION SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";Faceid.service.consul.         IN      SRV")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ANSWER SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Faceid.service.consul.  0       IN      SRV     1 1 9000 s3.node.dc1.consul.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Faceid.service.consul.  0       IN      SRV     1 1 9000 s1.node.dc1.consul.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Faceid.service.consul.  0       IN      SRV     1 1 9000 s2.node.dc1.consul.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; ADDITIONAL SECTION:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s3.node.dc1.consul.     0       IN      A       10.201.102.200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s1.node.dc1.consul.     0       IN      A       10.201.102.198")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s2.node.dc1.consul.     0       IN      A       10.201.102.199")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; Query time: 0 msec")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; SERVER: 127.0.0.1#8600(127.0.0.1)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; WHEN: Tue Mar 28 18:20:15 2017")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},";; MSG SIZE  rcvd: 165")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),sl=s("h2",{id:"k-\uFF0Fv",tabindex:"-1"},[l("K \uFF0FV "),s("a",{class:"header-anchor",href:"#k-\uFF0Fv","aria-hidden":"true"},"#")],-1),ll=s("p",null,"\u9664\u4E86\u63D0\u4F9B\u670D\u52A1\u53D1\u73B0\u548C\u5065\u5EB7\u68C0\u67E5\u7684\u96C6\u6210.Consul\u63D0\u4F9B\u4E86\u4E00\u4E2A\u6613\u7528\u7684\u952E/\u503C\u5B58\u50A8.\u8FD9\u53EF\u4EE5\u7528\u6765\u4FDD\u6301\u52A8\u6001\u914D\u7F6E,\u534F\u52A9\u670D\u52A1\u534F\u8C03,\u9886\u8896\u9009\u4E3E,\u505A\u5F00\u53D1\u8005\u53EF\u4EE5\u60F3\u5230\u7684\u4EFB\u4F55\u4E8B\u60C5.",-1),nl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -v http://localhost:8500/v1/kv/?recurse")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"* About to connect() to localhost port 8500 (#0)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"*   Trying ::1... \u62D2\u7EDD\u8FDE\u63A5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"*   Trying 127.0.0.1... connected")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"* Connected to localhost (127.0.0.1) port 8500 (#0)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"> GET /v1/kv/?recurse HTTP/1.1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.21 Basic ECC zlib/1.2.3 libidn/1.18 libssh2/1.4.2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"> Host: localhost:8500")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"> Accept: */*")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},">")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< HTTP/1.1 404 Not Found")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< X-Consul-Index: 1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< X-Consul-Knownleader: true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< X-Consul-Lastcontact: 0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< Date: Thu, 18 Aug 2016 08:21:39 GMT")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< Content-Length: 0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"< Content-Type: text/plain; charset=utf-8")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"<")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"* Connection #0 to host localhost left intact")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"* Closing connection #0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),el=s("p",null,[l("\u56E0\u4E3A\u6CA1\u6709key\u6240\u4EE5\u6211\u4EEC\u5F97\u5230\u4E86\u4E00\u4E2A404\u54CD\u5E94.\u73B0\u5728\u6211\u4EEC"),s("code",null,"PUT"),l("\u4E00\u4E9B\u793A\u4F8B\u7684Key:")],-1),al=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -X PUT -d 'test' http://localhost:8500/v1/kv/web/key1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -X PUT -d 'test' http://localhost:8500/v1/kv/web/key2?flags=42")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -X PUT -d 'test'  http://localhost:8500/v1/kv/web/sub/key3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ol=s("p",null,[l("\u6211\u4EEC\u521B\u5EFA\u4E86\u503C\u4E3A\u201Dtest\u201D\u76843\u4E2AKey,\u6CE8\u610F\u8FD4\u56DE\u7684\u503C\u662F\u7ECF\u8FC7\u4E86"),s("code",null,"base64"),l("\u7F16\u7801\u7684.\u7528\u6765\u652F\u6301\u975EUTF8\u7F16\u7801\u5B57\u7B26.\u5BF9Key "),s("code",null,"web/key2"),l("\u6211\u4EEC\u8BBE\u7F6E\u4E86\u4E00\u4E2A\u6807\u5FD7\u503C\u4E3A "),s("code",null,"42"),l(".\u6240\u6709\u7684key\u652F\u6301\u8BBE\u7F6E\u4E00\u4E2A64\u4F4D\u7684\u6574\u5F62\u6570\u5B57\u6807\u5FD7.Consul\u5185\u90E8\u4E0D\u9002\u7528\u8FD9\u4E2A\u503C.\u4F46\u662F\u4ED6\u53EF\u4EE5\u88AB\u5BA2\u6237\u7AEF\u9002\u7528\u6765\u505A\u4E00\u4E9B\u5143\u6570\u636E.")],-1),tl=s("p",null,[l("\u5B8C\u6210\u8BBE\u7F6E\u540E,\u6211\u4EEC\u53D1\u8D77\u4E86\u4E00\u4E2A"),s("code",null,"GET"),l("\u8BF7\u6C42\u6765\u63A5\u6536\u591A\u4E2Akey\u7684\u503C,\u4F7F\u7528"),s("code",null,"?recurse"),l("\u53C2\u6570.")],-1),cl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -s http://localhost:8500/v1/kv/web/?recurse | python -m json.tool")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 502660,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Flags": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Key": "web/key1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "LockIndex": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 502660,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Value": "dGVzdA=="')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    },")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 502663,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Flags": 42,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Key": "web/key2",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "LockIndex": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 502663,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Value": "dGVzdA=="')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    },")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 502665,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Flags": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Key": "web/sub/key3",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "LockIndex": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 502665,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Value": "dGVzdA=="')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),il=s("p",null,[l("\u4F60\u53EF\u4EE5\u83B7\u53D6"),s("strong",null,"\u5355\u4E2A"),l("\u7684key")],-1),rl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -s http://localhost:8500/v1/kv/web/key1 | python -m json.tool")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "CreateIndex": 502660,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Flags": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Key": "web/key1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "LockIndex": 0,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "ModifyIndex": 502660,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        "Value": "dGVzdA=="')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),pl=s("p",null,[l("\u5220\u9664key\u4E5F\u5F88\u7B80\u5355.\u901A\u8FC7"),s("code",null,"DELETE"),l("\u52A8\u4F5C\u6765\u5B8C\u6210.\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u6307\u5B9A\u5B8C\u6574\u8DEF\u5F84\u6765\u5220\u9664\u4E00\u4E2A\u5355\u72EC\u7684key.\u6216\u8005\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528"),s("code",null,"?recurse"),s("strong",null,"\u9012\u5F52"),l("\u7684\u5220\u9664\u4E3B\u8DEF\u5F84\u4E0B\u6240\u6709key.")],-1),Cl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# curl -X DELETE http://localhost:8500/v1/kv/web/sub?recurse")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Al=s("p",null,[l("\u53EF\u4EE5\u901A\u8FC7\u53D1\u9001\u76F8\u540C\u7684URL\u5E76\u63D0\u4F9B\u4E0D\u540C\u7684\u6D88\u606F\u4F53\u7684"),s("code",null,"PUT"),l("\u8BF7\u6C42\u53BB\u4FEE\u6539\u4E00\u4E2AKey.\u53E6\u5916,Consul\u63D0\u4F9B\u4E00\u4E2A\u68C0\u67E5\u5E76\u8BBE\u7F6E\u7684\u64CD\u4F5C,\u5B9E\u73B0\u539F\u5B50\u7684Key\u4FEE\u6539.\u901A\u8FC7"),s("code",null,"?cas=\u53C2\u6570"),l("\u52A0\u4E0A"),s("code",null,"GET"),l("\u4E2D\u6700\u8FD1\u7684"),s("code",null,"ModifyIndex"),l("\u6765\u8FBE\u5230. \u4F8B\u5982\u6211\u4EEC\u60F3\u4FEE\u6539 \u201Cweb/key1\u201D:")],-1),dl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"curl -X PUT -d 'newval' http://localhost:8500/v1/kv/web/key1?cas=502660")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"curl -X PUT -d 'newval' http://localhost:8500/v1/kv/web/key1?cas=502660")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ul=s("p",null,[l("\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B,\u7B2C\u4E00\u6B21"),s("code",null,"CAS"),l(" \u66F4\u65B0\u6210\u529F\u56E0\u4E3A"),s("code",null,"ModifyIndex"),l("\u662F"),s("code",null,"502660"),l(".\u800C\u7B2C\u4E8C\u6B21\u5931\u8D25\u662F\u56E0\u4E3A"),s("code",null,"ModifyIndex"),l("\u5728\u7B2C\u4E00\u6B21\u66F4\u65B0\u540E\u5DF2\u7ECF\u4E0D\u662F"),s("code",null,"502660"),l("\u4E86 .")],-1),yl=s("p",null,[l("\u6211\u4EEC\u4E5F\u53EF\u4EE5\u4F7F\u7528"),s("code",null,"ModifyIndex"),l("\u6765\u7B49\u5F85key\u503C\u7684\u6539\u53D8.\u4F8B\u5982\u6211\u4EEC\u60F3\u7B49\u5F85"),s("code",null,"key2"),l("\u88AB\u4FEE\u6539:")],-1),hl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@dhcp-10-201-102-198 ~]# curl "http://localhost:8500/v1/kv/web/key2"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[{"LockIndex":0,"Key":"web/key2","Flags":42,"Value":"dGVzdA==","CreateIndex":502663,"ModifyIndex":502663}]')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[root@dhcp-10-201-102-198 ~]# curl "http://localhost:8500/v1/kv/web/key2?index=502663&wait=5s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'[{"LockIndex":0,"Key":"web/key2","Flags":42,"Value":"dGVzdA==","CreateIndex":502663,"ModifyIndex":502663}]')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Dl=s("p",null,[l("\u901A\u8FC7\u63D0\u4F9B "),s("code",null,"?index="),l(",\u6211\u4EEC\u8BF7\u6C42\u7B49\u5F85key\u503C\u6709\u4E00\u4E2A\u6BD4"),s("code",null,"502663"),l("\u66F4\u5927\u7684"),s("code",null,"ModifyIndex"),l(".\u867D\u7136"),s("code",null,"?wait=5s"),l("\u53C2\u6570\u9650\u5236\u4E86\u8FD9\u4E2A\u8BF7\u6C42\u6700\u591A5\u79D2,\u5426\u5219\u8FD4\u56DE\u5F53\u524D\u7684\u672A\u6539\u53D8\u7684\u503C. \u8FD9\u6837\u53EF\u4EE5\u6709\u6548\u7684\u7B49\u5F85key\u7684\u6539\u53D8.\u53E6\u5916,\u8FD9\u4E2A\u529F\u80FD\u53EF\u4EE5\u7528\u4E8E\u7B49\u5F85\u4E00\u7EC4key.\u76F4\u5230\u5176\u4E2D\u7684\u67D0\u4E2Akey\u6709\u4FEE\u6539.")],-1),gl=s("h1",{id:"conusl-\u547D\u4EE4\u884C",tabindex:"-1"},[l("Conusl \u547D\u4EE4\u884C "),s("a",{class:"header-anchor",href:"#conusl-\u547D\u4EE4\u884C","aria-hidden":"true"},"#")],-1),_l=s("p",null,"\u89C1\u8BC6\u4E86consul\u7684\u5F3A\u5927\uFF0Cconsul\u53EF\u4EE5\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684CLI\u6765\u63A7\u5236\uFF0Cconsul\u53EA\u6709\u4E00\u4E2A\u547D\u4EE4\u884C\u5E94\u7528\uFF0C\u5C31\u662Fconsul\u547D\u4EE4\uFF0Cconsul\u547D\u4EE4\u53EF\u4EE5\u5305\u542Bagent\u3001members\u7B49\u53C2\u6570\u8FDB\u884C\u4F7F\u7528\uFF0C\u8FD9\u4E00\u7BC7\u6765\u5177\u4F53\u770B\u770Bconsul CLI\u7684\u5177\u4F53\u7528\u6CD5\uFF0Cconsul -h\u5373\u53EF\u770B\u5230consul cli\u6240\u652F\u6301\u7684\u53C2\u6570\uFF0C\u800C\u6BCF\u4E2A\u53C2\u6570\u91CC\u9762\u53C8\u652F\u6301\u5176\u4ED6\u53C2\u6570\uFF0C\u4E0B\u9762\u6211\u4EEC\u5C31\u6765\u5177\u4F53\u770B\u770B\u3002",-1),vl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@dhcp-10-201-102-198 ~]# consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"usage: consul [--version] [--help] <command> [<args>]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Available commands are:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    agent          Runs a Consul agent  \u8FD0\u884C\u4E00\u4E2Aconsul agent")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    configtest     Validate config file")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    event          Fire a new event")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    exec           Executes a command on Consul nodes  \u5728consul\u8282\u70B9\u4E0A\u6267\u884C\u4E00\u4E2A\u547D\u4EE4")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'    force-leave    Forces a member of the cluster to enter the "left" state   \u5F3A\u5236\u8282\u70B9\u6210\u5458\u5728\u96C6\u7FA4\u4E2D\u7684\u72B6\u6001\u8F6C\u6362\u5230left\u72B6\u6001')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    info           Provides debugging information for operators  \u63D0\u4F9B\u64CD\u4F5C\u7684debug\u7EA7\u522B\u7684\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    join           Tell Consul agent to join cluster   \u52A0\u5165consul\u8282\u70B9\u5230\u96C6\u7FA4\u4E2D")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    keygen         Generates a new encryption key  \u751F\u6210\u4E00\u4E2A\u65B0\u7684\u52A0\u5BC6key")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    keyring        Manages gossip layer encryption keys")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    kv             Interact with the key-value store")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    leave          Gracefully leaves the Consul cluster and shuts down")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    lock           Execute a command holding a lock")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    maint          Controls node or service maintenance mode")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    members        Lists the members of a Consul cluster    \u5217\u51FA\u96C6\u7FA4\u4E2D\u6210\u5458")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    monitor        Stream logs from a Consul agent  \u6253\u5370consul\u8282\u70B9\u7684\u65E5\u5FD7\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    operator       Provides cluster-level tools for Consul operators")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    reload         Triggers the agent to reload configuration files   \u89E6\u53D1\u8282\u70B9\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    rtt            Estimates network round trip time between nodes")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    snapshot       Saves, restores and inspects snapshots of Consul server state")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    version        Prints the Consul version    \u6253\u5370consul\u7684\u7248\u672C\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    watch          Watch for changes in Consul   \u76D1\u63A7consul\u7684\u6539\u53D8")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ml=s("p",null,[l("\u66F4\u8BE6\u7EC6\u89C1"),s("a",{href:"https://www.consul.io/docs/commands/index.html",target:"_blank",rel:"noreferrer"},"\u5B98\u7F51")],-1),fl=s("h2",{id:"agent",tabindex:"-1"},[l("Agent "),s("a",{class:"header-anchor",href:"#agent","aria-hidden":"true"},"#")],-1),bl=s("p",null,[s("code",null,"agent"),l("\u6307\u4EE4\u662Fconsul\u7684\u6838\u5FC3\uFF0C\u5B83\u8FD0\u884Cagent\u6765\u7EF4\u62A4\u6210\u5458\u7684\u91CD\u8981\u4FE1\u606F\u3001\u8FD0\u884C\u68C0\u67E5\u3001\u670D\u52A1\u5BA3\u5E03\u3001\u67E5\u8BE2\u5904\u7406\u7B49\u7B49\u3002")],-1),wl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"==> Usage: consul agent [options]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  Starts the Consul agent and runs until an interrupt is received. The")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  agent represents a single node in a cluster.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Options:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -advertise=addr                  Sets the advertise address to use")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -advertise-wan=addr              Sets address to advertise on wan instead of")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   advertise addr")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -bootstrap                       Sets server to bootstrap mode")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -bind=0.0.0.0                    Sets the bind address for cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   communication")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -http-port=8500                  Sets the HTTP API port to listen on")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -bootstrap-expect=0              Sets server to expect bootstrap mode.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -client=127.0.0.1                Sets the address to bind for client access.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   This includes RPC, DNS, HTTP and HTTPS (if")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   configured)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -config-file=foo                 Path to a JSON file to read configuration")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   from. This can be specified multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -config-dir=foo                  Path to a directory to read configuration")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   files from. This will read every file ending")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'                                   in ".json" as configuration in this')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   directory in alphabetical order. This can be")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   specified multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -data-dir=path                   Path to a data directory to store agent")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   state")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -dev                             Starts the agent in development mode.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -recursor=1.2.3.4                Address of an upstream DNS server.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   Can be specified multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -dc=east-aws                     Datacenter of the agent (deprecated: use")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   'datacenter' instead).")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -datacenter=east-aws             Datacenter of the agent.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -encrypt=key                     Provides the gossip encryption key")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -join=1.2.3.4                    Address of an agent to join at start time.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   Can be specified multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -join-wan=1.2.3.4                Address of an agent to join -wan at start")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   time. Can be specified multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join=1.2.3.4              Address of an agent to join at start time")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   with retries enabled. Can be specified")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-interval=30s              Time to wait between join attempts.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-max=0                     Maximum number of join attempts. Defaults to")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   0, which will retry indefinitely.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-ec2-region           EC2 Region to use for discovering servers to")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   join.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-ec2-tag-key          EC2 tag key to filter on for server")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   discovery")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-ec2-tag-value        EC2 tag value to filter on for server")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   discovery")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-gce-project-name     Google Compute Engine project to discover")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   servers in")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-gce-zone-pattern     Google Compute Engine region or zone to")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   discover servers in (regex pattern)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-gce-tag-value        Google Compute Engine tag value to filter")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   for server discovery")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-gce-credentials-file Path to credentials JSON file to use with")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   Google Compute Engine")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-join-wan=1.2.3.4          Address of an agent to join -wan at start")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   time with retries enabled. Can be specified")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-interval-wan=30s          Time to wait between join -wan attempts.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry-max-wan=0                 Maximum number of join -wan attempts.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   Defaults to 0, which will retry")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   indefinitely.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -log-level=info                  Log level of the agent.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -node=hostname                   Name of this node. Must be unique in the")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -node-meta=key:value             An arbitrary metadata key/value pair for")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   this node.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   This can be specified multiple times.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -protocol=N                      Sets the protocol version. Defaults to")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   latest.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -rejoin                          Ignores a previous leave and attempts to")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   rejoin the cluster.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -server                          Switches agent to server mode.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -syslog                          Enables logging to syslog")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ui                              Enables the built-in static web UI server")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ui-dir=path                     Path to directory containing the Web UI")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                                   resources")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -pid-file=path                   Path to file to store agent PID")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),kl=s("h2",{id:"event",tabindex:"-1"},[l("event "),s("a",{class:"header-anchor",href:"#event","aria-hidden":"true"},"#")],-1),Tl=s("p",null,[s("code",null,"event"),l("\u547D\u4EE4\u63D0\u4F9B\u4E86\u4E00\u79CD\u673A\u5236\uFF0C\u7528\u6765fire\u81EA\u5B9A\u4E49\u7684\u7528\u6237\u4E8B\u4EF6\uFF0C\u8FD9\u4E9B\u4E8B\u4EF6\u5BF9consul\u6765\u8BF4\u662F\u4E0D\u900F\u660E\u7684\uFF0C\u4F46\u5B83\u4EEC\u53EF\u4EE5\u7528\u6765\u6784\u5EFA\u81EA\u52A8\u90E8\u7F72\u3001\u91CD\u542F\u670D\u52A1\u6216\u8005\u5176\u4ED6\u884C\u52A8\u7684\u811A\u672C\u3002")],-1),xl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-http-addr\uFF1Ahttp\u670D\u52A1\u7684\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u8BBE\u7F6E\uFF0C\u5219\u9ED8\u8BA4\u662F127.0.0.1:8500\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-datacenter\uFF1A\u6570\u636E\u4E2D\u5FC3\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-name\uFF1A\u4E8B\u4EF6\u7684\u540D\u79F0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-node\uFF1A\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u8FC7\u6EE4\u8282\u70B9")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-service\uFF1A\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u8FC7\u6EE4\u8282\u70B9\u4E0A\u5339\u914D\u7684\u670D\u52A1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-tag\uFF1A\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u8FC7\u6EE4\u8282\u70B9\u4E0A\u7B26\u5408tag\u7684\u670D\u52A1\uFF0C\u5FC5\u987B\u548C-service\u4E00\u8D77\u4F7F\u7528\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Il=s("h2",{id:"exec",tabindex:"-1"},[l("exec "),s("a",{class:"header-anchor",href:"#exec","aria-hidden":"true"},"#")],-1),Sl=s("p",null,[s("code",null,"exec"),l("\u6307\u4EE4\u63D0\u4F9B\u4E86\u4E00\u79CD\u8FDC\u7A0B\u6267\u884C\u673A\u5236\uFF0C\u6BD4\u5982\u4F60\u8981\u5728\u6240\u6709\u7684\u673A\u5668\u4E0A\u6267\u884Cuptime\u547D\u4EE4\uFF0C\u8FDC\u7A0B\u6267\u884C\u7684\u5DE5\u4F5C\u901A\u8FC7job\u6765\u6307\u5B9A\uFF0C\u5B58\u50A8\u5728KV\u4E2D\uFF0Cagent\u4F7F\u7528event\u7CFB\u7EDF\u53EF\u4EE5\u5FEB\u901F\u7684\u77E5\u9053\u6709\u65B0\u7684job\u4EA7\u751F\uFF0C\u6D88\u606F\u662F\u901A\u8FC7gossip\u534F\u8BAE\u6765\u4F20\u9012\u7684\uFF0C\u56E0\u6B64\u6D88\u606F\u4F20\u9012\u662F\u6700\u4F73\u7684\uFF0C\u4F46\u662F\u5E76\u4E0D\u4FDD\u8BC1\u547D\u4EE4\u7684\u6267\u884C\u3002\u4E8B\u4EF6\u901A\u8FC7gossip\u6765\u9A71\u52A8\uFF0C\u8FDC\u7A0B\u6267\u884C\u4F9D\u8D56KV\u5B58\u50A8\u7CFB\u7EDF(\u5C31\u50CF\u6D88\u606F\u4EE3\u7406\u4E00\u6837)\u3002")],-1),Nl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-http-addr\uFF1Ahttp\u670D\u52A1\u7684\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u8BBE\u7F6E\uFF0C\u5219\u9ED8\u8BA4\u662F127.0.0.1:8500\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-datacenter\uFF1A\u6570\u636E\u4E2D\u5FC3\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-prefix\uFF1Akey\u5728KV\u7CFB\u7EDF\u4E2D\u7684\u524D\u7F00\uFF0C\u7528\u6765\u5B58\u50A8\u8BF7\u6C42\u6570\u636E\uFF0C\u9ED8\u8BA4\u662F_rexec")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-node\uFF1A\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u8FC7\u6EE4\u8282\u70B9\uFF0C\u8BC4\u4F30\u4E8B\u4EF6")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-service\uFF1A\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u8FC7\u6EE4\u8282\u70B9\u4E0A\u5339\u914D\u7684\u670D\u52A1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-tag\uFF1A\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u8FC7\u6EE4\u8282\u70B9\u4E0A\u7B26\u5408tag\u7684\u670D\u52A1\uFF0C\u5FC5\u987B\u548C-service\u4E00\u8D77\u4F7F\u7528\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-wait\uFF1A\u5728\u8282\u70B9\u591A\u957F\u65F6\u95F4\u6CA1\u6709\u54CD\u5E94\u540E\uFF0C\u8BA4\u4E3Ajob\u5DF2\u7ECF\u5B8C\u6210\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-wait-repl\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-verbose\uFF1A\u8F93\u51FA\u66F4\u591A\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Pl=s("h2",{id:"force-leave",tabindex:"-1"},[l("force-leave "),s("a",{class:"header-anchor",href:"#force-leave","aria-hidden":"true"},"#")],-1),El=s("p",null,[s("code",null,"force-leave"),l("\u6CBB\u7597\u53EF\u4EE5\u5F3A\u5236consul\u96C6\u7FA4\u4E2D\u7684\u6210\u5458\u8FDB\u5165left\u72B6\u6001(\u7A7A\u95F2\u72B6\u6001)\uFF0C\u8BB0\u4F4F\uFF0C\u5373\u4F7F\u4E00\u4E2A\u6210\u5458\u5904\u4E8E\u6D3B\u8DC3\u72B6\u6001\uFF0C\u5B83\u4ECD\u65E7\u53EF\u4EE5\u518D\u6B21\u52A0\u5165\u96C6\u7FA4\u4E2D\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u7684\u771F\u5B9E\u76EE\u7684\u662F\u5F3A\u5236\u79FB\u9664failed\u7684\u8282\u70B9\u3002\u5982\u679Cfailed\u7684\u8282\u70B9\u8FD8\u662F\u7F51\u7EDC\u7684\u4E00\u90E8\u5206\uFF0C\u5219consul\u4F1A\u5468\u671F\u6027\u7684\u91CD\u65B0\u94FE\u63A5failed\u7684\u8282\u70B9\uFF0C\u5982\u679C\u7ECF\u8FC7\u4E00\u6BB5\u65F6\u95F4\u540E(\u9ED8\u8BA4\u662F72\u5C0F\u65F6)\uFF0Cconsul\u5219\u4F1A\u5BA3\u5E03\u505C\u6B62\u5C1D\u8BD5\u94FE\u63A5failed\u7684\u8282\u70B9\u3002force-leave\u6307\u4EE4\u53EF\u4EE5\u5FEB\u901F\u7684\u628Afailed\u8282\u70B9\u8F6C\u6362\u5230left\u72B6\u6001\u3002")],-1),Rl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr:\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),jl=s("h2",{id:"info",tabindex:"-1"},[l("info "),s("a",{class:"header-anchor",href:"#info","aria-hidden":"true"},"#")],-1),Ol=s("p",null,[s("code",null,"info"),l("\u6307\u4EE4\u63D0\u4F9B\u4E86\u5404\u79CD\u64CD\u4F5C\u65F6\u53EF\u4EE5\u7528\u5230\u7684debug\u4FE1\u606F\uFF0C\u5BF9\u4E8Eclient\u548Cserver\uFF0Cinfo\u6709\u8FD4\u56DE\u4E0D\u540C\u7684\u5B50\u7CFB\u7EDF\u4FE1\u606F\uFF0C\u76EE\u524D\u6709\u4EE5\u4E0B\u51E0\u4E2AKV\u4FE1\u606F\uFF1Aagent(\u63D0\u4F9Bagent\u4FE1\u606F)\uFF0Cconsul(\u63D0\u4F9Bconsul\u5E93\u7684\u4FE1\u606F)\uFF0Craft(\u63D0\u4F9Braft\u5E93\u7684\u4FE1\u606F)\uFF0Cserf_lan(\u63D0\u4F9BLAN gossip pool),serf_wan(\u63D0\u4F9BWAN gossip pool)")],-1),Ll=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr\uFF1A\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Vl=s("h2",{id:"join",tabindex:"-1"},[l("join "),s("a",{class:"header-anchor",href:"#join","aria-hidden":"true"},"#")],-1),Hl=s("p",null,[s("code",null,"join"),l("\u6307\u4EE4\u544A\u8BC9consul agent\u52A0\u5165\u4E00\u4E2A\u5DF2\u7ECF\u5B58\u5728\u7684\u96C6\u7FA4\u4E2D\uFF0C\u4E00\u4E2A\u65B0\u7684consul agent\u5FC5\u987B\u52A0\u5165\u4E00\u4E2A\u5DF2\u7ECF\u6709\u81F3\u5C11\u4E00\u4E2A\u6210\u5458\u7684\u96C6\u7FA4\u4E2D\uFF0C\u8FD9\u6837\u5B83\u624D\u80FD\u52A0\u5165\u5DF2\u7ECF\u5B58\u5728\u7684\u96C6\u7FA4\u4E2D\uFF0C\u5982\u679C\u4F60\u4E0D\u52A0\u5165\u4E00\u4E2A\u5DF2\u7ECF\u5B58\u5728\u7684\u96C6\u7FA4\uFF0C\u5219agent\u662F\u5B83\u81EA\u8EAB\u96C6\u7FA4\u7684\u4E00\u90E8\u5206\uFF0C\u5176\u4ED6agent\u5219\u53EF\u4EE5\u52A0\u5165\u8FDB\u6765\u3002agents\u53EF\u4EE5\u52A0\u5165\u5176\u4ED6agent\u591A\u6B21\u3002consul join [options] address\u3002\u5982\u679C\u4F60\u60F3\u52A0\u5165\u591A\u4E2A\u96C6\u7FA4\uFF0C\u5219\u53EF\u4EE5\u5199\u591A\u4E2A\u5730\u5740\uFF0Cconsul\u4F1A\u52A0\u5165\u6240\u6709\u7684\u5730\u5740\u3002")],-1),Fl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-wan\uFF1Aagent\u8FD0\u884C\u5728server\u6A21\u5F0F\uFF0Cxxxxxxx")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr\uFF1A\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ul=s("h2",{id:"keygen",tabindex:"-1"},[l("keygen "),s("a",{class:"header-anchor",href:"#keygen","aria-hidden":"true"},"#")],-1),Gl=s("p",null,[s("code",null,"keygen"),l("\u6307\u4EE4\u751F\u6210\u52A0\u5BC6\u7684\u5BC6\u94A5\uFF0C\u53EF\u4EE5\u7528\u5728consul agent\u901A\u8BAF\u52A0\u5BC6")],-1),Ml=s("p",null,"\u751F\u6210\u4E00\u4E2Akey",-1),Wl=s("h2",{id:"leave",tabindex:"-1"},[l("leave "),s("a",{class:"header-anchor",href:"#leave","aria-hidden":"true"},"#")],-1),Kl=s("p",null,[s("code",null,"leave"),l("\u6307\u4EE4\u89E6\u53D1\u4E00\u4E2A\u4F18\u96C5\u7684\u79BB\u5F00\u52A8\u4F5C\u5E76\u5173\u95EDagent\uFF0C\u8282\u70B9\u79BB\u5F00\u540E\u4E0D\u4F1A\u5C1D\u8BD5\u91CD\u65B0\u52A0\u5165\u96C6\u7FA4\u4E2D\u3002\u8FD0\u884C\u5728server\u72B6\u6001\u7684\u8282\u70B9\uFF0C\u8282\u70B9\u4F1A\u88AB\u4F18\u96C5\u7684\u5220\u9664\uFF0C\u8FD9\u662F\u5F88\u4E25\u91CD\u7684\uFF0C\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\u4E00\u4E2A\u4E0D\u4F18\u96C5\u7684\u79BB\u5F00\u4F1A\u5F71\u54CD\u5230\u96C6\u7FA4\u7684\u53EF\u7528\u6027\u3002")],-1),ql=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr:\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),$l=s("h2",{id:"members",tabindex:"-1"},[l("members "),s("a",{class:"header-anchor",href:"#members","aria-hidden":"true"},"#")],-1),Ql=s("p",null,[s("code",null,"members"),l("\u6307\u4EE4\u8F93\u51FAconsul agent\u76EE\u524D\u6240\u77E5\u9053\u7684\u6240\u6709\u7684\u6210\u5458\u4EE5\u53CA\u5B83\u4EEC\u7684\u72B6\u6001\uFF0C\u8282\u70B9\u7684\u72B6\u6001\u53EA\u6709alive\u3001left\u3001failed\u4E09\u79CD\u72B6\u6001\u3002")],-1),Jl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-detailed\uFF1A\u8F93\u51FA\u6BCF\u4E2A\u8282\u70B9\u66F4\u8BE6\u7EC6\u7684\u4FE1\u606F\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr\uFF1A\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-status\uFF1A\u8FC7\u6EE4\u51FA\u7B26\u5408\u6B63\u5219\u89C4\u5219\u7684\u8282\u70B9")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-wan\uFF1Axxxxxx")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),zl=s("h2",{id:"monitor",tabindex:"-1"},[l("monitor "),s("a",{class:"header-anchor",href:"#monitor","aria-hidden":"true"},"#")],-1),Xl=s("p",null,[s("code",null,"monitor"),l("\u6307\u4EE4\u7528\u6765\u94FE\u63A5\u8FD0\u884C\u7684agent\uFF0C\u5E76\u663E\u793A\u65E5\u5FD7\u3002monitor\u4F1A\u663E\u793A\u6700\u8FD1\u7684\u65E5\u5FD7\uFF0C\u5E76\u6301\u7EED\u7684\u663E\u793A\u65E5\u5FD7\u6D41\uFF0C\u4E0D\u4F1A\u81EA\u52A8\u9000\u51FA\uFF0C\u9664\u975E\u4F60\u624B\u52A8\u6216\u8005\u8FDC\u7A0Bagent\u81EA\u5DF1\u9000\u51FA\u3002")],-1),Bl=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-log-level\uFF1A\u663E\u793A\u54EA\u4E2A\u7EA7\u522B\u7684\u65E5\u5FD7\uFF0C\u9ED8\u8BA4\u662Finfo")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr\uFF1A\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Yl=s("h2",{id:"reload",tabindex:"-1"},[l("reload "),s("a",{class:"header-anchor",href:"#reload","aria-hidden":"true"},"#")],-1),Zl=s("p",null,[s("code",null,"reload"),l("\u6307\u4EE4\u53EF\u4EE5\u91CD\u65B0\u52A0\u8F7Dagent\u7684\u914D\u7F6E\u6587\u4EF6\u3002SIGHUP\u6307\u4EE4\u5728\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u65F6\u4F7F\u7528\uFF0C\u4EFB\u4F55\u91CD\u65B0\u52A0\u8F7D\u7684\u9519\u8BEF\u90FD\u4F1A\u5199\u5728agent\u7684log\u6587\u4EF6\u4E2D\uFF0C\u5E76\u4E0D\u4F1A\u6253\u5370\u5230\u5C4F\u5E55\u3002")],-1),sn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rpc-addr\uFF1A\u4E00\u4E2Arpc\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F127.0.0.1:8400")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ln=s("h2",{id:"version",tabindex:"-1"},[l("version "),s("a",{class:"header-anchor",href:"#version","aria-hidden":"true"},"#")],-1),nn=s("p",null,"\u6253\u5370consul\u7684\u7248\u672C",-1),en=s("h2",{id:"watch",tabindex:"-1"},[l("watch "),s("a",{class:"header-anchor",href:"#watch","aria-hidden":"true"},"#")],-1),an=s("p",null,[s("code",null,"watch"),l("\u6307\u4EE4\u63D0\u4F9B\u4E86\u4E00\u4E2A\u673A\u5236\uFF0C\u7528\u6765\u76D1\u89C6\u5B9E\u9645\u6570\u636E\u89C6\u56FE\u7684\u6539\u53D8(\u8282\u70B9\u5217\u8868\u3001\u6210\u5458\u670D\u52A1\u3001KV)\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9A\u8FDB\u7A0B\uFF0C\u5F53\u524D\u503C\u4F1A\u88ABdump\u51FA\u6765")],-1),on=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-http-addr\uFF1Ahttp\u670D\u52A1\u7684\u5730\u5740\uFF0Cagent\u53EF\u4EE5\u94FE\u63A5\u4E0A\u6765\u53D1\u9001\u547D\u4EE4\uFF0C\u5982\u679C\u6CA1\u6709\u8BBE\u7F6E\uFF0C\u5219\u9ED8\u8BA4\u662F127.0.0.1:8500\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-datacenter\uFF1A\u6570\u636E\u4E2D\u5FC3\u67E5\u8BE2\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-token\uFF1AACL token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-key\uFF1A\u76D1\u89C6key\uFF0C\u53EA\u9488\u5BF9key\u7C7B\u578B")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-name\uFF1A\u76D1\u89C6event\uFF0C\u53EA\u9488\u5BF9event\u7C7B\u578B")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-prefix\uFF1A\u76D1\u89C6key prefix\uFF0C\u53EA\u9488\u5BF9keyprefix\u7C7B\u578B")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-service\uFF1A\u76D1\u63A7service\uFF0C\u53EA\u9488\u5BF9service\u7C7B\u578B")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-state\uFF1A\u8FC7\u7565check state")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-tag\uFF1A\u8FC7\u6EE4service tag")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-type\uFF1A\u76D1\u63A7\u7C7B\u578B\uFF0C\u4E00\u822C\u6709key\u3001keyprefix\u3001service\u3001nodes\u3001checks\u3001event")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),tn=s("h1",{id:"consul-\u914D\u7F6E",tabindex:"-1"},[l("Consul \u914D\u7F6E "),s("a",{class:"header-anchor",href:"#consul-\u914D\u7F6E","aria-hidden":"true"},"#")],-1),cn=s("p",null,"agent\u6709\u5404\u79CD\u5404\u6837\u7684\u914D\u7F6E\u9879\u53EF\u4EE5\u5728\u547D\u4EE4\u884C\u6216\u8005\u914D\u7F6E\u6587\u4EF6\u8FDB\u884C\u5B9A\u4E49\uFF0C\u6240\u6709\u7684\u914D\u7F6E\u9879\u90FD\u662F\u53EF\u9009\u62E9\u7684\uFF0C\u5F53\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u7684\u65F6\u5019\uFF0Cconsul\u4ECE\u914D\u7F6E\u6587\u4EF6\u6216\u8005\u914D\u7F6E\u76EE\u5F55\u52A0\u8F7D\u914D\u7F6E\u3002\u540E\u9762\u5B9A\u4E49\u7684\u914D\u7F6E\u4F1A\u5408\u5E76\u524D\u9762\u5B9A\u4E49\u7684\u914D\u7F6E\uFF0C\u4F46\u662F\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF0C\u5408\u5E76\u7684\u610F\u601D\u662F\u540E\u9762\u5B9A\u4E49\u7684\u914D\u7F6E\u4F1A\u8986\u76D6\u524D\u9762\u5B9A\u4E49\u7684\u914D\u7F6E\uFF0C\u4F46\u662F\u6709\u4E9B\u60C5\u51B5\uFF0C\u4F8B\u5982event\u53E5\u67C4\uFF0C\u5408\u5E76\u4EC5\u4EC5\u662F\u6DFB\u52A0\u5230\u524D\u9762\u5B9A\u4E49\u7684\u53E5\u67C4\u540E\u9762\u3002consul\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u4E5F\u652F\u6301\u4EE5\u4FE1\u53F7\u7684\u65B9\u5F0F\u63A5\u6536update\u4FE1\u53F7\u3002",-1),rn=s("p",null,"\u4E0B\u9762\u770B\u770B\u547D\u4EE4\u884C\u53C2\u6570\uFF1A",-1),pn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-advertise\uFF1A\u901A\u77E5\u5C55\u73B0\u5730\u5740\u7528\u6765\u6539\u53D8\u6211\u4EEC\u7ED9\u96C6\u7FA4\u4E2D\u7684\u5176\u4ED6\u8282\u70B9\u5C55\u73B0\u7684\u5730\u5740\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B-bind\u5730\u5740\u5C31\u662F\u5C55\u73B0\u5730\u5740")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-bootstrap\uFF1A\u7528\u6765\u63A7\u5236\u4E00\u4E2Aserver\u662F\u5426\u5728bootstrap\u6A21\u5F0F\uFF0C\u5728\u4E00\u4E2Adatacenter\u4E2D\u53EA\u80FD\u6709\u4E00\u4E2Aserver\u5904\u4E8Ebootstrap\u6A21\u5F0F\uFF0C\u5F53\u4E00\u4E2Aserver\u5904\u4E8Ebootstrap\u6A21\u5F0F\u65F6\uFF0C\u53EF\u4EE5\u81EA\u5DF1\u9009\u4E3E\u4E3Araft leader\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-bootstrap-expect\uFF1A\u5728\u4E00\u4E2Adatacenter\u4E2D\u671F\u671B\u63D0\u4F9B\u7684server\u8282\u70B9\u6570\u76EE\uFF0C\u5F53\u8BE5\u503C\u63D0\u4F9B\u7684\u65F6\u5019\uFF0Cconsul\u4E00\u76F4\u7B49\u5230\u8FBE\u5230\u6307\u5B9Asever\u6570\u76EE\u7684\u65F6\u5019\u624D\u4F1A\u5F15\u5BFC\u6574\u4E2A\u96C6\u7FA4\uFF0C\u8BE5\u6807\u8BB0\u4E0D\u80FD\u548Cbootstrap\u516C\u7528")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-bind\uFF1A\u8BE5\u5730\u5740\u7528\u6765\u5728\u96C6\u7FA4\u5185\u90E8\u7684\u901A\u8BAF\uFF0C\u96C6\u7FA4\u5185\u7684\u6240\u6709\u8282\u70B9\u5230\u5730\u5740\u90FD\u5FC5\u987B\u662F\u53EF\u8FBE\u7684\uFF0C\u9ED8\u8BA4\u662F0.0.0.0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-client\uFF1Aconsul\u7ED1\u5B9A\u5728\u54EA\u4E2Aclient\u5730\u5740\u4E0A\uFF0C\u8FD9\u4E2A\u5730\u5740\u63D0\u4F9BHTTP\u3001DNS\u3001RPC\u7B49\u670D\u52A1\uFF0C\u9ED8\u8BA4\u662F127.0.0.1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-config-file\uFF1A\u660E\u786E\u7684\u6307\u5B9A\u8981\u52A0\u8F7D\u54EA\u4E2A\u914D\u7F6E\u6587\u4EF6")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-config-dir\uFF1A\u914D\u7F6E\u6587\u4EF6\u76EE\u5F55\uFF0C\u91CC\u9762\u6240\u6709\u4EE5.json\u7ED3\u5C3E\u7684\u6587\u4EF6\u90FD\u4F1A\u88AB\u52A0\u8F7D")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-data-dir\uFF1A\u63D0\u4F9B\u4E00\u4E2A\u76EE\u5F55\u7528\u6765\u5B58\u653Eagent\u7684\u72B6\u6001\uFF0C\u6240\u6709\u7684agent\u5141\u8BB8\u90FD\u9700\u8981\u8BE5\u76EE\u5F55\uFF0C\u8BE5\u76EE\u5F55\u5FC5\u987B\u662F\u7A33\u5B9A\u7684\uFF0C\u7CFB\u7EDF\u91CD\u542F\u540E\u90FD\u7EE7\u7EED\u5B58\u5728")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-dc\uFF1A\u8BE5\u6807\u8BB0\u63A7\u5236agent\u5141\u8BB8\u7684datacenter\u7684\u540D\u79F0\uFF0C\u9ED8\u8BA4\u662Fdc1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-encrypt\uFF1A\u6307\u5B9Asecret key\uFF0C\u4F7Fconsul\u5728\u901A\u8BAF\u65F6\u8FDB\u884C\u52A0\u5BC6\uFF0Ckey\u53EF\u4EE5\u901A\u8FC7consul keygen\u751F\u6210\uFF0C\u540C\u4E00\u4E2A\u96C6\u7FA4\u4E2D\u7684\u8282\u70B9\u5FC5\u987B\u4F7F\u7528\u76F8\u540C\u7684key")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-join\uFF1A\u52A0\u5165\u4E00\u4E2A\u5DF2\u7ECF\u542F\u52A8\u7684agent\u7684ip\u5730\u5740\uFF0C\u53EF\u4EE5\u591A\u6B21\u6307\u5B9A\u591A\u4E2Aagent\u7684\u5730\u5740\u3002\u5982\u679Cconsul\u4E0D\u80FD\u52A0\u5165\u4EFB\u4F55\u6307\u5B9A\u7684\u5730\u5740\u4E2D\uFF0C\u5219agent\u4F1A\u542F\u52A8\u5931\u8D25\uFF0C\u9ED8\u8BA4agent\u542F\u52A8\u65F6\u4E0D\u4F1A\u52A0\u5165\u4EFB\u4F55\u8282\u70B9\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-retry-join\uFF1A\u548Cjoin\u7C7B\u4F3C\uFF0C\u4F46\u662F\u5141\u8BB8\u4F60\u5728\u7B2C\u4E00\u6B21\u5931\u8D25\u540E\u8FDB\u884C\u5C1D\u8BD5\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-retry-interval\uFF1A\u4E24\u6B21join\u4E4B\u95F4\u7684\u65F6\u95F4\u95F4\u9694\uFF0C\u9ED8\u8BA4\u662F30s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-retry-max\uFF1A\u5C1D\u8BD5\u91CD\u590Djoin\u7684\u6B21\u6570\uFF0C\u9ED8\u8BA4\u662F0\uFF0C\u4E5F\u5C31\u662F\u65E0\u9650\u6B21\u5C1D\u8BD5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-log-level\uFF1Aconsul agent\u542F\u52A8\u540E\u663E\u793A\u7684\u65E5\u5FD7\u4FE1\u606F\u7EA7\u522B\u3002\u9ED8\u8BA4\u662Finfo\uFF0C\u53EF\u9009\uFF1Atrace\u3001debug\u3001info\u3001warn\u3001err\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-node\uFF1A\u8282\u70B9\u5728\u96C6\u7FA4\u4E2D\u7684\u540D\u79F0\uFF0C\u5728\u4E00\u4E2A\u96C6\u7FA4\u4E2D\u5FC5\u987B\u662F\u552F\u4E00\u7684\uFF0C\u9ED8\u8BA4\u662F\u8BE5\u8282\u70B9\u7684\u4E3B\u673A\u540D")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-protocol\uFF1Aconsul\u4F7F\u7528\u7684\u534F\u8BAE\u7248\u672C")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-rejoin\uFF1A\u4F7Fconsul\u5FFD\u7565\u5148\u524D\u7684\u79BB\u5F00\uFF0C\u5728\u518D\u6B21\u542F\u52A8\u540E\u4ECD\u65E7\u5C1D\u8BD5\u52A0\u5165\u96C6\u7FA4\u4E2D\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-server\uFF1A\u5B9A\u4E49agent\u8FD0\u884C\u5728server\u6A21\u5F0F\uFF0C\u6BCF\u4E2A\u96C6\u7FA4\u81F3\u5C11\u6709\u4E00\u4E2Aserver\uFF0C\u5EFA\u8BAE\u6BCF\u4E2A\u96C6\u7FA4\u7684server\u4E0D\u8981\u8D85\u8FC75\u4E2A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-syslog\uFF1A\u5F00\u542F\u7CFB\u7EDF\u65E5\u5FD7\u529F\u80FD\uFF0C\u53EA\u5728linux/osx\u4E0A\u751F\u6548")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-ui-dir:\u63D0\u4F9B\u5B58\u653Eweb ui\u8D44\u6E90\u7684\u8DEF\u5F84\uFF0C\u8BE5\u76EE\u5F55\u5FC5\u987B\u662F\u53EF\u8BFB\u7684")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-pid-file:\u63D0\u4F9B\u4E00\u4E2A\u8DEF\u5F84\u6765\u5B58\u653Epid\u6587\u4EF6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8BE5\u6587\u4EF6\u8FDB\u884CSIGINT/SIGHUP(\u5173\u95ED/\u66F4\u65B0)agent")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Cn=s("p",null,"\u9664\u4E86\u547D\u4EE4\u884C\u53C2\u6570\u5916\uFF0C\u914D\u7F6E\u4E5F\u53EF\u4EE5\u5199\u5165\u6587\u4EF6\u4E2D\uFF0C\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\u914D\u7F6E\u6587\u4EF6\u4F1A\u66F4\u7B80\u5355\u4E00\u4E9B\uFF0C\u4F8B\u5982\uFF1A\u5229\u7528consul\u88AB\u7528\u6765\u7BA1\u7406\u7CFB\u7EDF\u3002\u914D\u7F6E\u6587\u4EF6\u662Fjson\u683C\u5F0F\u7684\uFF0C\u5F88\u5BB9\u6613\u7F16\u5199\u3002\u914D\u7F6E\u6587\u4EF6\u4E0D\u4EC5\u88AB\u7528\u6765\u8BBE\u7F6Eagent\u7684\u542F\u52A8\uFF0C\u4E5F\u53EF\u4EE5\u7528\u6765\u63D0\u4F9B\u5065\u5EB7\u68C0\u6D4B\u548C\u670D\u52A1\u53D1\u73B0\u7684\u5B9A\u4E49\u3002\u914D\u7F6E\u6587\u4EF6\u7684\u4E00\u822C\u6837\u4F8B\u5982\u4E0B\uFF1A",-1),An=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "datacenter": "dc1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "data_dir": "/opt/consul",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "log_level": "INFO",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "node_name": "s1",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "server": true,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "bootstrap_expect": 3,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "bind_addr": "10.201.102.198",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "client_addr": "0.0.0.0",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "ui_dir": "/root/consul_ui",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "retry_join": ["10.201.102.198","10.201.102.199","10.201.102.200","10.201.102.248"],')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "retry_interval": "30s",')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "enable_debug": false,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "rejoin_after_leave": true,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "start_join": ["10.201.102.198","10.201.102.199","10.201.102.200","10.201.102.248"],')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "enable_syslog": true,')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  "syslog_facility": "local5"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),dn=s("p",null,"\u4E0B\u9762\u770B\u770B\u8BE6\u7EC6\u7684\u914D\u7F6E\u6587\u4EF6\u53C2\u6570\uFF1A",-1),un=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl_datacenter\uFF1A\u53EA\u7528\u4E8Eserver\uFF0C\u6307\u5B9A\u7684datacenter\u7684\u6743\u5A01ACL\u4FE1\u606F\uFF0C\u6240\u6709\u7684servers\u548Cdatacenter\u5FC5\u987B\u540C\u610FACL datacenter")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl_default_policy\uFF1A\u9ED8\u8BA4\u662Fallow")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl_down_policy\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl_master_token\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl_token\uFF1Aagent\u4F1A\u4F7F\u7528\u8FD9\u4E2Atoken\u548Cconsul server\u8FDB\u884C\u8BF7\u6C42")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl_ttl\uFF1A\u63A7\u5236TTL\u7684cache\uFF0C\u9ED8\u8BA4\u662F30s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"addresses\uFF1A\u4E00\u4E2A\u5D4C\u5957\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u8BBE\u7F6E\u4EE5\u4E0Bkey\uFF1Adns\u3001http\u3001rpc")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"advertise_addr\uFF1A\u7B49\u540C\u4E8E-advertise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"bootstrap\uFF1A\u7B49\u540C\u4E8E-bootstrap")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"bootstrap_expect\uFF1A\u7B49\u540C\u4E8E-bootstrap-expect")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"bind_addr\uFF1A\u7B49\u540C\u4E8E-bind")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ca_file\uFF1A\u63D0\u4F9BCA\u6587\u4EF6\u8DEF\u5F84\uFF0C\u7528\u6765\u68C0\u67E5\u5BA2\u6237\u7AEF\u6216\u8005\u670D\u52A1\u7AEF\u7684\u94FE\u63A5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cert_file\uFF1A\u5FC5\u987B\u548Ckey_file\u4E00\u8D77")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"check_update_interval\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"client_addr\uFF1A\u7B49\u540C\u4E8E-client")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"datacenter\uFF1A\u7B49\u540C\u4E8E-dc")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"data_dir\uFF1A\u7B49\u540C\u4E8E-data-dir")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"disable_anonymous_signature\uFF1A\u5728\u8FDB\u884C\u66F4\u65B0\u68C0\u67E5\u65F6\u7981\u6B62\u533F\u540D\u7B7E\u540D")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"disable_remote_exec\uFF1A\u7981\u6B62\u652F\u6301\u8FDC\u7A0B\u6267\u884C\uFF0C\u8BBE\u7F6E\u4E3Atrue\uFF0Cagent\u4F1A\u5FFD\u89C6\u6240\u6709\u8FDB\u5165\u7684\u8FDC\u7A0B\u6267\u884C\u8BF7\u6C42")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"disable_update_check\uFF1A\u7981\u6B62\u81EA\u52A8\u68C0\u67E5\u5B89\u5168\u516C\u544A\u548C\u65B0\u7248\u672C\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"dns_config\uFF1A\u662F\u4E00\u4E2A\u5D4C\u5957\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u8BBE\u7F6E\u4EE5\u4E0B\u53C2\u6570\uFF1Aallow_stale\u3001max_stale\u3001node_ttl \u3001service_ttl\u3001enable_truncate")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"domain\uFF1A\u9ED8\u8BA4\u60C5\u51B5\u4E0Bconsul\u5728\u8FDB\u884CDNS\u67E5\u8BE2\u65F6\uFF0C\u67E5\u8BE2\u7684\u662Fconsul\u57DF\uFF0C\u53EF\u4EE5\u901A\u8FC7\u8BE5\u53C2\u6570\u8FDB\u884C\u4FEE\u6539")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"enable_debug\uFF1A\u5F00\u542Fdebug\u6A21\u5F0F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"enable_syslog\uFF1A\u7B49\u540C\u4E8E-syslog")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"encrypt\uFF1A\u7B49\u540C\u4E8E-encrypt")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"key_file\uFF1A\u63D0\u4F9B\u79C1\u94A5\u7684\u8DEF\u5F84")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"leave_on_terminate\uFF1A\u9ED8\u8BA4\u662Ffalse\uFF0C\u5982\u679C\u4E3Atrue\uFF0C\u5F53agent\u6536\u5230\u4E00\u4E2ATERM\u4FE1\u53F7\u7684\u65F6\u5019\uFF0C\u5B83\u4F1A\u53D1\u9001leave\u4FE1\u606F\u5230\u96C6\u7FA4\u4E2D\u7684\u5176\u4ED6\u8282\u70B9\u4E0A\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"log_level\uFF1A\u7B49\u540C\u4E8E-log-level")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"node_name:\u7B49\u540C\u4E8E-node")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ports\uFF1A\u8FD9\u662F\u4E00\u4E2A\u5D4C\u5957\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u8BBE\u7F6E\u4EE5\u4E0Bkey\uFF1Adns(dns\u5730\u5740\uFF1A8600)\u3001http(http api\u5730\u5740\uFF1A8500)\u3001rpc(rpc:8400)\u3001serf_lan(lan port:8301)\u3001serf_wan(wan port:8302)\u3001server(server rpc:8300)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"protocol\uFF1A\u7B49\u540C\u4E8E-protocol")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"recursor\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"rejoin_after_leave\uFF1A\u7B49\u540C\u4E8E-rejoin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"retry_join\uFF1A\u7B49\u540C\u4E8E-retry-join")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"retry_interval\uFF1A\u7B49\u540C\u4E8E-retry-interval")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server\uFF1A\u7B49\u540C\u4E8E-server")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server_name\uFF1A\u4F1A\u8986\u76D6TLS CA\u7684node_name\uFF0C\u53EF\u4EE5\u7528\u6765\u786E\u8BA4CA name\u548Chostname\u76F8\u5339\u914D")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"skip_leave_on_interrupt\uFF1A\u548Cleave_on_terminate\u6BD4\u8F83\u7C7B\u4F3C\uFF0C\u4E0D\u8FC7\u53EA\u5F71\u54CD\u5F53\u524D\u53E5\u67C4")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"start_join\uFF1A\u4E00\u4E2A\u5B57\u7B26\u6570\u7EC4\u63D0\u4F9B\u7684\u8282\u70B9\u5730\u5740\u4F1A\u5728\u542F\u52A8\u65F6\u88AB\u52A0\u5165")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"statsd_addr\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"statsite_addr\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"syslog_facility\uFF1A\u5F53enable_syslog\u88AB\u63D0\u4F9B\u540E\uFF0C\u8BE5\u53C2\u6570\u63A7\u5236\u54EA\u4E2A\u7EA7\u522B\u7684\u4FE1\u606F\u88AB\u53D1\u9001\uFF0C\u9ED8\u8BA4Local0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ui_dir\uFF1A\u7B49\u540C\u4E8E-ui-dir")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"verify_incoming\uFF1A\u9ED8\u8BA4false\uFF0C\u5982\u679C\u4E3Atrue\uFF0C\u5219\u6240\u6709\u8FDB\u5165\u94FE\u63A5\u90FD\u9700\u8981\u4F7F\u7528TLS\uFF0C\u9700\u8981\u5BA2\u6237\u7AEF\u4F7F\u7528ca_file\u63D0\u4F9Bca\u6587\u4EF6\uFF0C\u53EA\u7528\u4E8Econsul server\u7AEF\uFF0C\u56E0\u4E3Aclient\u4ECE\u6765\u6CA1\u6709\u8FDB\u5165\u7684\u94FE\u63A5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"verify_outgoing\uFF1A\u9ED8\u8BA4false\uFF0C\u5982\u679C\u4E3Atrue\uFF0C\u5219\u6240\u6709\u51FA\u53BB\u94FE\u63A5\u90FD\u9700\u8981\u4F7F\u7528TLS\uFF0C\u9700\u8981\u670D\u52A1\u7AEF\u4F7F\u7528ca_file\u63D0\u4F9Bca\u6587\u4EF6\uFF0Cconsul server\u548Cclient\u90FD\u9700\u8981\u4F7F\u7528\uFF0C\u56E0\u4E3A\u4E24\u8005\u90FD\u6709\u51FA\u53BB\u7684\u94FE\u63A5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"watches\uFF1Awatch\u4E00\u4E2A\u8BE6\u7EC6\u540D\u5355")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),yn=s("h1",{id:"http-api",tabindex:"-1"},[l("HTTP API "),s("a",{class:"header-anchor",href:"#http-api","aria-hidden":"true"},"#")],-1),hn=s("p",null,"consul\u7684\u4E3B\u8981\u63A5\u53E3\u662FRESTful HTTP API\uFF0C\u8BE5API\u53EF\u4EE5\u7528\u6765\u589E\u5220\u67E5\u6539nodes\u3001services\u3001checks\u3001configguration\u3002\u6240\u6709\u7684endpoints\u4E3B\u8981\u5206\u4E3A\u4EE5\u4E0B\u7C7B\u522B\uFF1A",-1),Dn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kv - Key/Value\u5B58\u50A8")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"agent - Agent\u63A7\u5236")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"catalog - \u7BA1\u7406nodes\u548Cservices")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"health - \u7BA1\u7406\u5065\u5EB7\u76D1\u6D4B")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"session - Session\u64CD\u4F5C")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"acl - ACL\u521B\u5EFA\u548C\u7BA1\u7406")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"event - \u7528\u6237Events")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"status - Consul\u7CFB\u7EDF\u72B6\u6001")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),gn=s("p",null,"\u4E0B\u9762\u6211\u4EEC\u5C31\u5355\u72EC\u770B\u770B\u6BCF\u4E2A\u6A21\u5757\u7684\u5177\u4F53\u5185\u5BB9\u3002",-1),_n=s("h2",{id:"agent-1",tabindex:"-1"},[l("agent "),s("a",{class:"header-anchor",href:"#agent-1","aria-hidden":"true"},"#")],-1),vn=s("p",null,"agent endpoints\u7528\u6765\u548C\u672C\u5730agent\u8FDB\u884C\u4EA4\u4E92\uFF0C\u4E00\u822C\u7528\u6765\u670D\u52A1\u6CE8\u518C\u548C\u68C0\u67E5\u6CE8\u518C\uFF0C\u652F\u6301\u4EE5\u4E0B\u63A5\u53E3",-1),mn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/checks : \u8FD4\u56DE\u672C\u5730agent\u6CE8\u518C\u7684\u6240\u6709\u68C0\u67E5(\u5305\u62EC\u914D\u7F6E\u6587\u4EF6\u548CHTTP\u63A5\u53E3)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/services : \u8FD4\u56DE\u672C\u5730agent\u6CE8\u518C\u7684\u6240\u6709 \u670D\u52A1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/members : \u8FD4\u56DEagent\u5728\u96C6\u7FA4\u7684gossip pool\u4E2D\u770B\u5230\u7684\u6210\u5458")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/self : \u8FD4\u56DE\u672C\u5730agent\u7684\u914D\u7F6E\u548C\u6210\u5458\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/join/<address> : \u89E6\u53D1\u672C\u5730agent\u52A0\u5165node")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/force-leave/<node>>: \u5F3A\u5236\u5220\u9664node")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/check/register : \u5728\u672C\u5730agent\u589E\u52A0\u4E00\u4E2A\u68C0\u67E5\u9879\uFF0C\u4F7F\u7528PUT\u65B9\u6CD5\u4F20\u8F93\u4E00\u4E2Ajson\u683C\u5F0F\u7684\u6570\u636E")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/check/deregister/<checkID> : \u6CE8\u9500\u4E00\u4E2A\u672C\u5730agent\u7684\u68C0\u67E5\u9879")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/check/pass/<checkID> : \u8BBE\u7F6E\u4E00\u4E2A\u672C\u5730\u68C0\u67E5\u9879\u7684\u72B6\u6001\u4E3Apassing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/check/warn/<checkID> : \u8BBE\u7F6E\u4E00\u4E2A\u672C\u5730\u68C0\u67E5\u9879\u7684\u72B6\u6001\u4E3Awarning")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/check/fail/<checkID> : \u8BBE\u7F6E\u4E00\u4E2A\u672C\u5730\u68C0\u67E5\u9879\u7684\u72B6\u6001\u4E3Acritical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/service/register : \u5728\u672C\u5730agent\u589E\u52A0\u4E00\u4E2A\u65B0\u7684\u670D\u52A1\u9879\uFF0C\u4F7F\u7528PUT\u65B9\u6CD5\u4F20\u8F93\u4E00\u4E2Ajson\u683C\u5F0F\u7684\u6570\u636E")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/agent/service/deregister/<serviceID> : \u6CE8\u9500\u4E00\u4E2A\u672C\u5730agent\u7684\u670D\u52A1\u9879")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),fn=s("h2",{id:"catalog",tabindex:"-1"},[l("catalog "),s("a",{class:"header-anchor",href:"#catalog","aria-hidden":"true"},"#")],-1),bn=s("p",null,"catalog endpoints\u7528\u6765\u6CE8\u518C/\u6CE8\u9500nodes\u3001services\u3001checks",-1),wn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/register : Registers a new node, service, or check")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/deregister : Deregisters a node, service, or check")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/datacenters : Lists known datacenters")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/nodes : Lists nodes in a given DC")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/services : Lists services in a given DC")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/service/<service> : Lists the nodes in a given service")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/catalog/node/<node> : Lists the services provided by a node")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),kn=s("h2",{id:"health",tabindex:"-1"},[l("health "),s("a",{class:"header-anchor",href:"#health","aria-hidden":"true"},"#")],-1),Tn=s("p",null,"health endpoints\u7528\u6765\u67E5\u8BE2\u5065\u5EB7\u72B6\u51B5\u76F8\u5173\u4FE1\u606F\uFF0C\u8BE5\u529F\u80FD\u4ECEcatalog\u4E2D\u5355\u72EC\u5206\u79BB\u51FA\u6765",-1),xn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/healt/node/<node>: \u8FD4\u56DEnode\u6240\u5B9A\u4E49\u7684\u68C0\u67E5\uFF0C\u53EF\u7528\u53C2\u6570?dc=")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/health/checks/<service>: \u8FD4\u56DE\u548C\u670D\u52A1\u76F8\u5173\u8054\u7684\u68C0\u67E5\uFF0C\u53EF\u7528\u53C2\u6570?dc=")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/health/service/<service>: \u8FD4\u56DE\u7ED9\u5B9Adatacenter\u4E2D\u7ED9\u5B9Anode\u4E2Dservice")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'/v1/health/state/<state>: \u8FD4\u56DE\u7ED9\u5B9Adatacenter\u4E2D\u6307\u5B9A\u72B6\u6001\u7684\u670D\u52A1\uFF0Cstate\u53EF\u4EE5\u662F"any", "unknown", "passing", "warning", or "critical"\uFF0C\u53EF\u7528\u53C2\u6570?dc=')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),In=s("h2",{id:"session",tabindex:"-1"},[l("session "),s("a",{class:"header-anchor",href:"#session","aria-hidden":"true"},"#")],-1),Sn=s("p",null,"session endpoints\u7528\u6765create\u3001update\u3001destory\u3001query sessions",-1),Nn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/session/create: Creates a new session")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/session/destroy/<session>: Destroys a given session")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/session/info/<session>: Queries a given session")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/session/node/<node>: Lists sessions belonging to a node")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/session/list: Lists all the active sessions")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Pn=s("h2",{id:"acl",tabindex:"-1"},[l("acl "),s("a",{class:"header-anchor",href:"#acl","aria-hidden":"true"},"#")],-1),En=s("p",null,"acl endpoints\u7528\u6765create\u3001update\u3001destory\u3001query acl",-1),Rn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/acl/create: Creates a new token with policy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/acl/update: Update the policy of a token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/acl/destroy/<id>: Destroys a given token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/acl/info/<id>: Queries the policy of a given token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/acl/clone/<id>: Creates a new token by cloning an existing token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/acl/list: Lists all the active tokens")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),jn=s("h2",{id:"event-1",tabindex:"-1"},[l("event "),s("a",{class:"header-anchor",href:"#event-1","aria-hidden":"true"},"#")],-1),On=s("p",null,"event endpoints\u7528\u6765fire\u65B0\u7684events\u3001\u67E5\u8BE2\u5DF2\u6709\u7684events",-1),Ln=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/event/fire/<name>: \u89E6\u53D1\u4E00\u4E2A\u65B0\u7684event\uFF0C\u7528\u6237event\u9700\u8981name\u548C\u5176\u4ED6\u53EF\u9009\u7684\u53C2\u6570\uFF0C\u4F7F\u7528PUT\u65B9\u6CD5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/event/list: \u8FD4\u56DEagent\u77E5\u9053\u7684events")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Vn=s("h2",{id:"status",tabindex:"-1"},[l("status "),s("a",{class:"header-anchor",href:"#status","aria-hidden":"true"},"#")],-1),Hn=s("p",null,"status endpoints\u7528\u6765\u6216\u8005consul \u96C6\u7FA4\u7684\u4FE1\u606F",-1),Fn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/status/leader : \u8FD4\u56DE\u5F53\u524D\u96C6\u7FA4\u7684Raft leader")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/v1/status/peers : \u8FD4\u56DE\u5F53\u524D\u96C6\u7FA4\u4E2D\u540C\u4E8B")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Un=s("h1",{id:"consul-template",tabindex:"-1"},[l("Consul-Template "),s("a",{class:"header-anchor",href:"#consul-template","aria-hidden":"true"},"#")],-1),Gn=s("p",null,"\u5728consul-template\u6CA1\u51FA\u73B0\u4E4B\u524D\uFF0C\u5927\u5BB6\u6784\u5EFA\u670D\u52A1\u53D1\u73B0\u7CFB\u7EDF\uFF0C\u5927\u591A\u91C7\u7528\u7684\u662Fzookeeper\u3001etcd+confd\u8FD9\u6837\u7C7B\u4F3C\u7684\u7CFB\u7EDF\uFF0C\u4E4B\u524D\u5199\u8FC7\u4E00\u7BC7consul+confd\u7684\u6587\uFF0C\u8BB2\u7684\u662F\u5982\u4F55\u52A8\u6001\u751F\u6210\u914D\u7F6E\u6587\u4EF6\u7684\uFF0C\u5982\u4ECAconsul\u5B98\u65B9\u63A8\u51FA\u4E86\u81EA\u5DF1\u7684\u6A21\u677F\u7CFB\u7EDF\uFF0C\u5C31\u662Fconsul-template\uFF0C\u8FD9\u6837\u7684\u8BDD\u52A8\u6001\u7684\u914D\u7F6E\u7CFB\u7EDF\u53EF\u4EE5\u5206\u5316\u4E3Aetcd+confd\u548Cconsul+consul-template\u4E24\u5927\u9635\u8425\u3002consul\u662F\u4E00\u4E2A\u548Cetcd\u7C7B\u4F3C\u4F46\u53C8\u5F3A\u4E8Eetcd\u7684\u7CFB\u7EDF\uFF0C\u5173\u4E8Eetcd\u548Cconsul\u53EF\u4EE5\u7FFB\u9605\u4EE5\u524D\u7684\u6587\u7AE0\uFF0Cconsul-template\u7684\u5B9A\u4F4D\u5C31\u548Cconfd\u5DEE\u4E0D\u591A\u4E00\u6837\u4E86\uFF0Cconfd\u7684\u540E\u7AEF\u53EF\u4EE5\u662Fetcd\u6216\u8005consul\uFF0C\u76F8\u4FE1consul\u642D\u914Dconsul-template\u80FD\u53D1\u6325\u66F4\u5927\u7684\u6548\u679C\u3002consul-template\u63D0\u4F9B\u4E86\u4E00\u4E2A\u4FBF\u6377\u7684\u65B9\u5F0F\u4ECEconsul\u4E2D\u83B7\u53D6\u5B58\u50A8\u7684\u503C\uFF0Cconsul-template\u5B88\u62A4\u8FDB\u7A0B\u4F1A\u67E5\u8BE2consul\u5B9E\u4F8B\uFF0C\u6765\u66F4\u65B0\u7CFB\u7EDF\u4E0A\u6307\u5B9A\u7684\u4EFB\u4F55\u6A21\u677F\uFF0C\u5F53\u66F4\u65B0\u5B8C\u6210\u540E\uFF0C\u6A21\u677F\u53EF\u4EE5\u9009\u62E9\u8FD0\u884C\u4E00\u4E9B\u4EFB\u610F\u7684\u547D\u4EE4\u3002",-1),Mn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    consul template\u7684\u4F7F\u7528\u573A\u666F\uFF1Aconsul template\u53EF\u4EE5\u67E5\u8BE2consul\u4E2D\u7684\u670D\u52A1\u76EE\u5F55\u3001key\u3001key-values\u7B49\u3002\u8FD9\u79CD\u5F3A\u5927\u7684\u62BD\u8C61\u529F\u80FD\u548C\u67E5\u8BE2\u8BED\u8A00\u6A21\u677F\u53EF\u4EE5\u4F7Fconsul template\u7279\u522B\u9002\u5408\u52A8\u6001\u7684\u521B\u5EFA\u914D\u7F6E\u6587\u4EF6\u3002\u4F8B\u5982\uFF1A\u521B\u5EFAapache/nginx proxy balancers\u3001haproxy backends\u3001varnish servers\u3001application configurations\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Wn=s("p",null,"consul template\u7684\u7279\u6027\uFF1A",-1),Kn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    quiescence\uFF1Aconsul template\u5185\u5236\u9759\u6B62\u5E73\u8861\u529F\u80FD\uFF0C\u53EF\u4EE5\u667A\u80FD\u7684\u53D1\u73B0consul\u5B9E\u4F8B\u4E2D\u7684\u66F4\u6539\u4FE1\u606F\u3002\u8FD9\u4E2A\u529F\u80FD\u53EF\u4EE5\u9632\u6B62\u9891\u7E41\u7684\u66F4\u65B0\u6A21\u677F\u800C\u5F15\u8D77\u7CFB\u7EDF\u7684\u6CE2\u52A8\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    dry mode\uFF1A\u4E0D\u786E\u5B9A\u5F53\u524D\u67B6\u6784\u7684\u72B6\u6001\uFF1F\u62C5\u5FC3\u6A21\u677F\u7684\u53D8\u5316\u4F1A\u7834\u574F\u5B50\u7CFB\u7EDF\uFF1F\u65E0\u987B\u62C5\u5FC3\uFF0C\u56E0\u4E3Aconsul template\u8FD8\u6709-dry\u6A21\u5F0F\u3002\u5728dry\u6A21\u5F0F\uFF0Cconsul template\u4F1A\u5C06\u7ED3\u679C\u5448\u73B0\u5728STDOUT\uFF0C\u6240\u4EE5\u64CD\u4F5C\u5458\u53EF\u4EE5\u68C0\u67E5\u8F93\u51FA\u662F\u5426\u6B63\u5E38\uFF0C\u4EE5\u51B3\u5B9A\u66F4\u6362\u6A21\u677F\u662F\u5426\u5B89\u5168")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    CLI and Config\uFF1A\u5982\u679C\u4F60\u559C\u6B22\u5728\u547D\u4EE4\u884C\u4E0A\u6307\u5B9A\u4E00\u5207\uFF0Cconsul template\u90FD\u53EF\u4EE5hold\u4F4F\u3002\u968F\u7740\u5185\u7F6EHCL\u7684\u652F\u6301\uFF0Cconsul template\u63A5\u6536\u4E00\u4E2A\u914D\u7F6E\u6587\u4EF6\uFF0C\u547D\u4EE4\u884C\u53C2\u6570\uFF0C\u6216\u8005\u4E24\u8005\u7684\u6DF7\u5408\u3002\u901A\u8FC7\u8FD9\u79CD\u65B9\u5F0F\u4F60\u53EF\u4EE5\u7EE7\u7EED\u4F7F\u7528\u4F60\u73B0\u5728\u5DF2\u6709\u7684\u914D\u7F6E\u7BA1\u7406\u5DE5\u5177\u548Cconsul template\u6765\u914D\u5408\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    verbose debugging\uFF1A\u5373\u4F7F\u6BCF\u4EF6\u4E8B\u4F60\u90FD\u505A\u7684\u8FD1\u4E4E\u5B8C\u7F8E\uFF0C\u4F46\u662F\u6709\u65F6\u5019\u8FD8\u662F\u4F1A\u6709\u5931\u8D25\u53D1\u751F\u3002consul template\u53EF\u4EE5\u63D0\u4F9B\u66F4\u8BE6\u7EC6\u7684debug\u65E5\u5FD7\u4FE1\u606F\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),qn=s("h2",{id:"\u5B89\u88C5",tabindex:"-1"},[l("\u5B89\u88C5 "),s("a",{class:"header-anchor",href:"#\u5B89\u88C5","aria-hidden":"true"},"#")],-1),$n=s("p",null,[l("\u4F60\u53EF\u4EE5\u5728"),s("a",{href:"https://releases.hashicorp.com/consul-template/",target:"_blank",rel:"noreferrer"},"\u53D1\u5E03\u9875"),l("\u4E0B\u8F7D\u53D1\u5E03\u5305.\u5982\u679C\u4F60\u5E0C\u671B\u81EA\u5DF1\u7F16\u8BD1\u8BF7\u67E5\u770B"),s("a",{href:"https://github.com/hashicorp/consul-template#contributing",target:"_blank",rel:"noreferrer"},"\u8BF4\u660E\u6587\u6863"),l(".")],-1),Qn=s("h2",{id:"\u4F7F\u7528",tabindex:"-1"},[l("\u4F7F\u7528 "),s("a",{class:"header-anchor",href:"#\u4F7F\u7528","aria-hidden":"true"},"#")],-1),Jn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"-auth=<user[:pass]>      \u8BBE\u7F6E\u57FA\u672C\u7684\u8BA4\u8BC1\u7528\u6237\u540D\u548C\u5BC6\u7801")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -consul-addr=<address>   \u8BBE\u7F6EConsul\u5B9E\u4F8B\u7684\u5730\u5740")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -max-stale=<duration>    \u67E5\u8BE2\u8FC7\u671F\u7684\u6700\u5927\u9891\u7387\uFF0C\u9ED8\u8BA4\u662F1s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -dedup                   \u542F\u7528\u91CD\u590D\u6570\u636E\u5220\u9664\uFF0C\u5F53\u8BB8\u591Aconsul template\u5B9E\u4F8B\u6E32\u67D3\u4E00\u4E2A\u6A21\u677F\u7684\u65F6\u5019\u53EF\u4EE5\u964D\u4F4Econsul\u7684\u8D1F\u8F7D")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ssl                     \u4F7F\u7528https\u8FDE\u63A5Consul\u4F7F\u7528SSL")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ssl-verify              \u901A\u8FC7SSL\u8FDE\u63A5\u7684\u65F6\u5019\u68C0\u67E5\u8BC1\u4E66")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ssl-cert                SSL\u5BA2\u6237\u7AEF\u8BC1\u4E66\u53D1\u9001\u7ED9\u670D\u52A1\u5668")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ssl-key                 \u5BA2\u6237\u7AEF\u8BA4\u8BC1\u65F6\u4F7F\u7528\u7684SSL/TLS\u79C1\u94A5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -ssl-ca-cert             \u9A8C\u8BC1\u670D\u52A1\u5668\u7684CA\u8BC1\u4E66\u5217\u8868")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -token=<token>           \u8BBE\u7F6EConsul API\u7684token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -syslog                  \u628A\u6807\u51C6\u8F93\u51FA\u548C\u6807\u51C6\u9519\u8BEF\u91CD\u5B9A\u5411\u5230syslog\uFF0Csyslog\u7684\u9ED8\u8BA4\u7EA7\u522B\u662Flocal0\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -syslog-facility=<f>     \u8BBE\u7F6Esyslog\u7EA7\u522B\uFF0C\u9ED8\u8BA4\u662Flocal0\uFF0C\u5FC5\u987B\u548C-syslog\u914D\u5408\u4F7F\u7528")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -template=<template>     \u589E\u52A0\u4E00\u4E2A\u9700\u8981\u76D1\u63A7\u7684\u6A21\u677F\uFF0C\u683C\u5F0F\u662F\uFF1A'templatePath:outputPath(:command)'\uFF0C\u591A\u4E2A\u6A21\u677F\u5219\u53EF\u4EE5\u8BBE\u7F6E\u591A\u6B21")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -wait=<duration>         \u5F53\u5448\u73B0\u4E00\u4E2A\u65B0\u7684\u6A21\u677F\u5230\u7CFB\u7EDF\u548C\u89E6\u53D1\u4E00\u4E2A\u547D\u4EE4\u7684\u65F6\u5019\uFF0C\u7B49\u5F85\u7684\u6700\u5927\u6700\u5C0F\u65F6\u95F4\u3002\u5982\u679C\u6700\u5927\u503C\u88AB\u5FFD\u7565\uFF0C\u9ED8\u8BA4\u662F\u6700\u5C0F\u503C\u76844\u500D\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -retry=<duration>        \u5F53\u5728\u548Cconsul api\u4EA4\u4E92\u7684\u8FD4\u56DE\u503C\u662Ferror\u7684\u65F6\u5019\uFF0C\u7B49\u5F85\u7684\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u662F5s\u3002")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -config=<path>           \u914D\u7F6E\u6587\u4EF6\u6216\u8005\u914D\u7F6E\u76EE\u5F55\u7684\u8DEF\u5F84")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -pid-file=<path>         PID\u6587\u4EF6\u7684\u8DEF\u5F84")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  -log-level=<level>       \u8BBE\u7F6E\u65E5\u5FD7\u7EA7\u522B\uFF0C\u53EF\u4EE5\u662F"debug","info", "warn" (default), and "err"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -dry                     Dump\u751F\u6210\u7684\u6A21\u677F\u5230\u6807\u51C6\u8F93\u51FA\uFF0C\u4E0D\u4F1A\u751F\u6210\u5230\u78C1\u76D8")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -once                    \u8FD0\u884Cconsul-template\u4E00\u6B21\u540E\u9000\u51FA\uFF0C\u4E0D\u4EE5\u5B88\u62A4\u8FDB\u7A0B\u8FD0\u884C")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  -reap                    \u5B50\u8FDB\u7A0B\u81EA\u52A8\u6536\u5272123456789101112131415161718192021")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),zn=s("p",null,"\u67E5\u770B\u5168\u90E8\u9009\u9879,\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4",-1),Xn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul-template -h")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Bn=s("h2",{id:"\u547D\u4EE4\u884C",tabindex:"-1"},[l("\u547D\u4EE4\u884C "),s("a",{class:"header-anchor",href:"#\u547D\u4EE4\u884C","aria-hidden":"true"},"#")],-1),Yn=s("p",null,"1\u3001\u67E5\u8BE2\u672C\u5730consl\u5B9E\u4F8B\uFF0C\u751F\u6210\u6A21\u677F\u540E\u91CD\u542Fnginx\uFF0C\u5982\u679Cconsul\u4E0D\u53EF\u7528\uFF0C\u5982\u679Capi\u6545\u969C\u5219\u6BCF30s\u5C1D\u8BD5\u68C0\u6D4B\u4E00\u6B21\u503C\uFF0Cconsul-template\u8FD0\u884C\u4E00\u6B21\u540E\u9000\u51FA",-1),Zn=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul-template -retry 30s -once -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),se=s("p",null,"test.ctmpl",-1),le=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range service "Faceid"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{.ID}} {{.Address}}:{{.Port}} check inter 5000 fall 1 rise 2 weight 2{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ne=s("p",null,"test.out",-1),ee=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Faceid 10.201.102.198:9000 check inter 5000 fall 1 rise 2 weight 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Faceid 10.201.102.199:9000 check inter 5000 fall 1 rise 2 weight 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Faceid 10.201.102.200:9000 check inter 5000 fall 1 rise 2 weight 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ae=s("p",null,"2\u3001\u8FD0\u884Cconsul-temple\u4F5C\u4E3A\u4E00\u4E2A\u670D\u52A1",-1),oe=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul-template -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),te=s("p",null,"3\u3001\u67E5\u8BE2\u4E00\u4E2A\u5B9E\u4F8B\uFF0C\u6E32\u67D3\u591A\u4E2A\u6A21\u677F\uFF0C\u7136\u540E\u91CD\u542F\u76F8\u5173\u670D\u52A1",-1),ce=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul-template -retry 30s -once -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"\\')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},' -template "/tmp/redis.ctmpl:/var/redis/redis.conf:service redis restart" \\')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},' -template "/tmp/haproxy.ctmpl:/var/haproxy/haproxy.conf"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ie=s("p",null,"4\u3001\u67E5\u8BE2\u4E00\u4E2A\u5B9E\u4F8B\uFF0Cdump\u6A21\u677F\u5230\u6807\u51C6\u8F93\u51FA\uFF0C\u53C2\u6570\u4E2D\u7684-template\u5219\u4F1A\u88AB\u5FFD\u7565",-1),re=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul-template -dry -consul-addr=10.201.102.198:8500 -template "test.ctmpl:test.out"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),pe=s("p",null,"\u4EE5\u4E0A\u53C2\u6570\u9664\u4E86\u5728\u547D\u4EE4\u884C\u4F7F\u7528\uFF0C\u4E5F\u53EF\u4EE5\u76F4\u63A5\u914D\u7F6E\u5728\u6587\u4EF6\u4E2D\uFF0C\u4E0B\u9762\u770B\u770BConsul-Template\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u7B80\u79F0HCL(HashiCorp Configuration Language)\uFF0C\u5B83\u662F\u548CJSON\u517C\u5BB9\u7684\uFF0C\u4E0B\u9762\u770B\u4E2A\u4F8B\u5B50\uFF1A",-1),Ce=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"#### \u914D\u7F6E\u6587\u4EF6")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u200B```Consul-Template```\u914D\u7F6E\u6587\u4EF6\u662F\u4F7F\u7528[HashiCorp Configuration Language (HCL)](https://github.com/hashicorp/hcl)\u7F16\u5199\u7684.\u8FD9\u610F\u5473\u7740```Consul Template```\u662F\u548CJSON\u517C\u5BB9\u7684,\u67E5\u770B\u66F4\u591A\u4FE1\u606F\u8BF7\u67E5\u770B [HCL \u89C4\u8303](https://github.com/hashicorp/hcl)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u914D\u7F6E\u6587\u4EF6\u8BED\u6CD5\u652F\u6301\u4E0A\u9762\u7684\u6240\u6709\u7684\u9009\u9879,\u9664\u975E\u5728\u8868\u683C\u4E2D\u8FDB\u884C\u6807\u660E.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u200B```json")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u8981\u8FDE\u63A5\u7684Consul Agent\u7684\u5730\u5740.\u9ED8\u8BA4\u4E3A127.0.0.1:8500.\u8FD9\u662FConsul\u7684\u9ED8\u8BA4\u7ED1\u5B9A\u5730\u5740\u548C\u7AEF\u53E3.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u4E0D\u5EFA\u8BAE\u4F60\u76F4\u63A5\u4E0E Consul\u7684 Server\u76F4\u63A5\u8FDB\u884C\u4EA4\u4E92,\u8BF7\u4E0E\u672C\u5730\u7684Consul Agent\u8FDB\u884C\u4EA4\u4E92.\u8FD9\u6837\u505A\u662F\u6709\u4E00\u4E9B\u539F\u56E0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u6700\u91CD\u8981\u7684\u662F\u672C\u5730agent\u53EF\u4EE5\u590D\u7528\u4E0Eserver\u7684\u8FDE\u63A5.\u51CF\u5C11HTTP\u7684\u8FDE\u63A5\u6570.\u53E6\u5916\u8FD9\u4E2A\u5730\u5740\u66F4\u597D\u8BB0.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul = "127.0.0.1:8500"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u7528\u4E8E\u8FDE\u63A5Consul\u7684ACL token. \u5982\u679C\u4F60\u7684\u96C6\u7FA4\u672A\u542F\u7528\u5C31\u4E0D\u9700\u8981\u8BBE\u7F6E.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"//")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u4E2A\u9009\u9879\u4E5F\u53EF\u4EE5\u901A\u8FC7\u73AF\u5883\u53D8\u91CF CONSUL_TOKEN \u6765\u8FDB\u884C\u8BBE\u7F6E")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'token = "abcd1234"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u76D1\u542C\u51FA\u53D1reload\u4E8B\u4EF6\u7684\u4FE1\u53F7,\u9ED8\u8BA4\u503C\u5982\u4E0B\u6240\u793A.\u5C06\u8FD9\u4E2A\u503C\u8BBE\u7F6E\u4E3A\u7A7A\u5C06\u5F15\u8D77 CT ,\u4ECE\u800C\u4E0D\u76D1\u542Creload\u4E8B\u4EF6")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'reload_signal = "SIGHUP"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u76D1\u542C\u51FA\u53D1core dump\u4E8B\u4EF6\u7684\u4FE1\u53F7,\u9ED8\u8BA4\u503C\u5982\u4E0B\u6240\u793A.\u5C06\u8FD9\u4E2A\u503C\u8BBE\u7F6E\u4E3A\u7A7A\u5C06\u5F15\u8D77 CT ,\u4ECE\u800C\u4E0D\u76D1\u542Ccore dump\u4FE1\u53F7")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'dump_signal = "SIGQUIT"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u76D1\u542C\u51FA\u53D1graceful stop\u4E8B\u4EF6\u7684\u4FE1\u53F7,\u9ED8\u8BA4\u503C\u5982\u4E0B\u6240\u793A.\u5C06\u8FD9\u4E2A\u503C\u8BBE\u7F6E\u4E3A\u7A7A\u5C06\u5F15\u8D77 CT ,\u4ECE\u800C\u4E0D\u76D1\u542Cgraceful stop\u4FE1\u53F7")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'kill_signal = "SIGINT"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u8FDE\u63A5Consul\u7684\u91CD\u8BD5\u65F6\u95F4.Consul Template\u662F\u9AD8\u5BB9\u9519\u7684\u8BBE\u8BA1.\u8FD9\u610F\u5473\u7740,\u51FA\u73B0\u5931\u8D25\u4ED6\u4E0D\u4F1A\u9000\u51FA.\u800C\u6309\u7167")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u5206\u5E03\u5F0F\u7CFB\u7EDF\u7684\u60EF\u4F8B\u8FDB\u884C\u6307\u6570\u8865\u507F\u548C\u91CD\u8BD5\u6765\u7B49\u5F85\u96C6\u7FA4\u6062\u590D.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'retry = "10s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'// This is the maximum interval to allow "stale" data. By default, only the')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// Consul leader will respond to queries; any requests to a follower will")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// forward to the leader. In large clusters with many requests, this is not as")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// scalable, so this option allows any follower to respond to a query, so long")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// as the last-replicated data is within these bounds. Higher values result in")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// less cluster load, but are more likely to have outdated data.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u5141\u8BB8\u9648\u65E7\u6570\u636E\u7684\u6700\u5927\u65F6\u95F4.Consul\u9ED8\u8BA4\u53EA\u6709\u9886\u8896\u5BF9\u8BF7\u6C42\u8FDB\u884C\u76F8\u5E94.\u6240\u6709\u5BF9\u8FFD\u968F\u8005\u7684\u8BF7\u6C42\u5C06\u88AB\u8F6C\u53D1\u7ED9\u9886\u8896.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u5728\u6709\u5927\u91CF\u8BF7\u6C42\u7684\u5927\u578B\u96C6\u7FA4\u4E2D,\u8FD9\u663E\u5F97\u4E0D\u591F\u6709\u6269\u5C55\u6027.\u6240\u4EE5\u8FD9\u4E2A\u9009\u9879\u5141\u8BB8\u4EFB\u4F55\u8FFD\u968F\u8005\u54CD\u5E94\u67E5\u8BE2,\u53EA\u8981\u6700\u540E\u590D\u5236\u7684\u6570\u636E")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u5728\u8FD9\u4E2A\u8303\u56F4\u5185.\u6570\u503C\u8D8A\u9AD8,\u8D8A\u51CF\u5C11\u96C6\u7FA4\u8D1F\u8F7D,\u4F46\u662F\u66F4\u5BB9\u6613\u63A5\u53D7\u5230\u8FC7\u671F\u6570\u636E.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'max_stale = "10m"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662Flog\u7684\u7B49\u7EA7,\u5982\u679C\u4F60\u627E\u5230\u4E86bug,\u8BF7\u6253\u5F00debug \u65E5\u5FD7,\u8FD9\u6837\u6211\u4EEC\u53EF\u4EE5\u66F4\u597D\u7684\u5B9A\u4F4D\u95EE\u9898.\u8FD9\u4E2A\u9009\u9879\u4E5F\u53EF\u7528\u5728\u547D\u4EE4\u884C.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'log_level = "warn"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u5B58\u653EConsul Template \u8FDB\u7A0B\u7684PID\u6587\u4EF6\u7684\u8DEF\u5F84,\u5982\u679C\u4F60\u8BA1\u5212\u53D1\u9001\u5B9A\u5236\u7684\u4FE1\u53F7\u5230\u8FD9\u4E2A\u8FDB\u7A0B\u8FD9\u4F1A\u6BD4\u8F83\u6709\u7528.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'pid_file = "/path/to/pid"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F\u4E00\u4E2A\u9759\u6B62\u5B9A\u65F6\u5668,\u4ED6\u5B9A\u4E49\u4E86\u5728\u6A21\u677F\u6E32\u67D3\u4E4B\u524D\u7B49\u5F85\u96C6\u7FA4\u8FBE\u5230\u4E00\u81F4\u72B6\u6001\u7684\u6700\u5C0F\u548C\u6700\u5927\u65F6\u95F4.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u5BF9\u4E8E\u4E00\u4E9B\u53D8\u5316\u8F83\u5927\u7684\u7CFB\u7EDF\u4E2D\u6BD4\u8F83\u6709\u7528,\u53EF\u4EE5\u51CF\u5C11\u6A21\u677F\u6E32\u67D3\u7684\u6B21\u6570")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'wait = "5s:10s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u662F Vault\u914D\u7F6E\u7684\u5F00\u59CB")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// Vault\u662FHashiCorp\u7684\u53E6\u5916\u4E00\u4E2A\u4EA7\u54C1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"vault {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the address of the Vault leader. The protocol (http(s)) portion")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // of the address is required.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  address = "https://vault.service.consul:8200"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the token to use when communicating with the Vault server.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // Like other tools that integrate with Vault, Consul Template makes the")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // assumption that you provide it with a Vault token; it does not have the")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // incorporated logic to generate tokens via Vault's auth methods.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  //")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This value can also be specified via the environment variable VAULT_TOKEN.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  token = "abcd1234"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This option tells Consul Template to automatically renew the Vault token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // given. If you are unfamiliar with Vault's architecture, Vault requires")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // tokens be renewed at some regular interval or they will be revoked. Consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // Template will automatically renew the token at half the lease duration of")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // the token. The default value is true, but this option can be disabled if")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // you want to renew the Vault token using an out-of-band process.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  //")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // Note that secrets specified in a template (using {{secret}} for example)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // are always renewed, even if this option is set to false. This option only")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // applies to the top-level Vault token itself.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  renew = true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This section details the SSL options for connecting to the Vault server.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // Please see the SSL options below for more information (they are the same).")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  ssl {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    // ...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u90E8\u5206\u914D\u7F6E\u8BF7\u6C42\u7684\u57FA\u672C\u7684\u6743\u9650\u9A8C\u8BC1\u4FE1\u606F")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"auth {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  enabled  = true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  username = "test"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  password = "test"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u90E8\u5206\u914D\u7F6E\u8FDE\u63A5\u5230Consul\u670D\u52A1\u5668\u7684SSL\u4FE1\u606F.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ssl {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u4F7F\u7528SSL\u9700\u8981\u5148\u6253\u5F00\u8FD9\u4E2A\u5F00\u5173")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  enabled = true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  // This enables SSL peer verification. The default value is "true", which')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // will check the global CA chain to make sure the given certificates are")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // valid. If you are using a self-signed certificate that you have not added")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // to the CA chain, you may want to disable SSL verification. However, please")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // understand this is a potential security vulnerability.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  verify = false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the path to the certificate to use to authenticate. If just a")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // certificate is provided, it is assumed to contain both the certificate and")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // the key to convert to an X509 certificate. If both the certificate and")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // key are specified, Consul Template will automatically combine them into an")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // X509 certificate for you.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  cert = "/path/to/client/cert"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  key = "/path/to/client/key"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the path to the certificate authority to use as a CA. This is")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // useful for self-signed certificates or for organizations using their own")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // internal certificate authority.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  ca_cert = "/path/to/ca"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8BBE\u7F6E\u8FDE\u63A5\u5230syslog\u670D\u52A1\u5668\u7684\u914D\u7F6E")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u7528\u4E8E\u8FDB\u884C\u65E5\u5FD7\u8BB0\u5F55syslog {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u6253\u5F00\u5F00\u5173")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  enabled = true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8BBE\u5907\u540D\u79F0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  facility = "LOCAL5"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// This block defines the configuration for de-duplication mode. Please see the")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// de-duplication mode documentation later in the README for more information")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// on how de-duplication mode operates.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"deduplicate {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This enables de-duplication mode. Specifying any other options also enables")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // de-duplication mode.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  enabled = true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the prefix to the path in Consul's KV store where de-duplication")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // templates will be pre-rendered and stored.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  prefix = "consul-template/dedup/"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// This block defines the configuration for exec mode. Please see the exec mode")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// documentation at the bottom of this README for more information on how exec")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// mode operates and the caveats of this mode.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"exec {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the command to exec as a child process. There can be only one")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // command per Consul Template process.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  command = "/usr/bin/app"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is a random splay to wait before killing the command. The default")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // value is 0 (no wait), but large clusters should consider setting a splay")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // value to prevent all child processes from reloading at the same time when")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // data changes occur. When this value is set to non-zero, Consul Template")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // will wait a random period of time up to the splay value before reloading")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // or killing the child process. This can be used to prevent the thundering")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // herd problem on applications that do not gracefully reload.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  splay = "5s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This defines the signal that will be sent to the child process when a")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // change occurs in a watched template. The signal will only be sent after")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // the process is started, and the process will only be started after all")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // dependent templates have been rendered at least once. The default value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  // is "" (empty or nil), which tells Consul Template to restart the child')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // process instead of sending it a signal. This is useful for legacy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // applications or applications that cannot properly reload their")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // configuration without a full reload.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  reload_signal = "SIGUSR1"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This defines the signal sent to the child process when Consul Template is")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // gracefully shutting down. The application should begin a graceful cleanup.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // If the application does not terminate before the `kill_timeout`, it will")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  // be terminated (effectively "kill -9"). The default value is "SIGTERM".')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  kill_signal = "SIGINT"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This defines the amount of time to wait for the child process to gracefully")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // terminate when Consul Template exits. After this specified time, the child")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  // process will be force-killed (effectively "kill -9"). The default value is')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  // "30s".')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  kill_timeout = "2s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u8FD9\u90E8\u5206\u5B9A\u4E49\u4E86\u5BF9\u6A21\u677F\u7684\u914D\u7F6E,\u548C\u5176\u4ED6\u914D\u7F6E\u5757\u4E0D\u540C.\u8FD9\u90E8\u5206\u53EF\u4EE5\u9488\u5BF9\u4E0D\u540C\u6A21\u677F\u914D\u7F6E\u591A\u6B21.\u4E5F\u53EF\u4EE5\u5728CLI\u547D\u4EE4")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// \u76F4\u63A5\u8FDB\u884C\u914D\u7F6E")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"template {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u662F\u8F93\u5165\u6A21\u677F\u7684\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84,\u5FC5\u9009\u9879")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  source = "/path/on/disk/to/template.ctmpl"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u662F\u6E90\u6A21\u677F\u6E32\u67D3\u4E4B\u540E\u5B58\u653E\u7684\u8DEF\u5F84,\u5982\u679C\u7236\u76EE\u5F55\u4E0D\u5B58\u5728Consul Template\u4F1A\u5C1D\u8BD5\u8FDB\u884C\u521B\u5EFA")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  destination = "/path/on/disk/where/template/will/render.txt"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // This is the optional command to run when the template is rendered. The")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // command will only run if the resulting template changes. The command must")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // return within 30s (configurable), and it must have a successful exit code.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // Consul Template is not a replacement for a process monitor or init system.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u662F\u5F53\u6A21\u677F\u6E32\u67D3\u5B8C\u6210\u540E\u53EF\u9009\u7684\u8981\u6267\u884C\u7684\u547D\u4EE4.\u8FD9\u4E2A\u547D\u4EE4\u53EA\u4F1A\u5728\u6A21\u677F\u53D1\u751F\u6539\u53D8\u540E\u624D\u4F1A\u8FD0\u884C.\u8FD9\u4E2A\u547D\u4EE4\u5FC5\u987B\u8981\u572830\u79D2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u5185\u8FDB\u884C\u8FD4\u56DE(\u53EF\u914D\u7F6E),\u5FC5\u987B\u8FD4\u56DE\u4E00\u4E2A\u6210\u529F\u7684\u9000\u51FA\u7801.Consul Template\u4E0D\u80FD\u66FF\u4EE3\u8FDB\u7A0B\u76D1\u89C6\u6216\u8005init \u7CFB\u7EDF")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u7684\u529F\u80FD")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  command = "restart service foo"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u662F\u6700\u5927\u7684\u7B49\u5F85\u547D\u4EE4\u8FD4\u56DE\u7684\u65F6\u95F4,\u9ED8\u8BA4\u662F30\u79D2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  command_timeout = "60s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u662F\u6E32\u67D3\u540E\u7684\u6587\u4EF6\u7684\u6743\u9650,\u5982\u679C\u4E0D\u8BBE\u7F6E,Consul Template\u5C06\u53BB\u5339\u914D\u4E4B\u524D\u5DF2\u7ECF\u5B58\u5728\u7684\u6587\u4EF6\u7684\u6743\u9650.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u5982\u679C\u6587\u4EF6\u4E0D\u5B58\u5728,\u6743\u9650\u4F1A\u88AB\u8BBE\u7F6E\u4E3A 0644")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  perms = 0600")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u4E2A\u9009\u9879\u5BF9\u6E32\u67D3\u4E4B\u524D\u7684\u6587\u4EF6\u8FDB\u884C\u5907\u4EFD.\u4ED6\u4FDD\u6301\u4E00\u4E2A\u5907\u4EFD.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u4E2A\u9009\u9879\u5728\u53D1\u751F\u610F\u5916\u66F4\u9AD8\u65F6,\u6709\u4E00\u4E2A\u56DE\u6EDA\u7B56\u7565.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  backup = true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  // \u6A21\u677F\u7684\u5206\u9694\u7B26,\u9ED8\u8BA4\u662F "{{"\u548C"}}".\u4F46\u662F\u5BF9\u4E8E\u4E00\u4E9B\u6A21\u677F\u7528\u5176\u4ED6\u7684\u5206\u9694\u7B26\u53EF\u80FD\u66F4\u597D')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u53EF\u4EE5\u907F\u514D\u4E0E\u672C\u8EAB\u7684\u51B2\u7A81")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  left_delimiter  = "{{"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  right_delimiter = "}}"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u8FD9\u662F\u6700\u5C0F\u548C\u6700\u5927\u7B49\u5F85\u6E32\u67D3\u4E00\u4E2A\u65B0\u6A21\u677F\u548C\u6267\u884C\u547D\u4EE4\u7684\u65F6\u95F4.\u4F7F\u7528 \u5206\u53F7 \u4E2A\u53F7.\u5982\u679C\u5FFD\u7565\u6700\u5927\u503C,\u6700\u5927")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  // \u503C\u4F1A\u88AB\u8BBE\u7F6E\u4E3A\u6700\u5C0F\u503C\u76844\u500D.\u8FD9\u4E2A\u9009\u9879\u6CA1\u6709\u9ED8\u8BA4\u503C.\u8FD9\u4E2A\u503C\u76F8\u5BF9\u5168\u5C40\u6240\u4EE5\u7684\u7B49\u5F85\u65F6\u95F4\u6709\u6700\u9AD8\u4F18\u5148\u7EA7")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  wait = "2s:6s"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ae=s("p",null,[s("strong",null,"\u6CE8\u610F"),l(": \u4E0D\u662F\u6240\u6709\u7684\u9009\u9879\u90FD\u662F\u5FC5\u9009\u7684.\u4F8B\u5982: \u5982\u679C\u4F60\u6CA1\u6709\u4F7F\u7528Vault\u4F60\u4E0D\u7528\u8BBE\u7F6E\u8FD9\u4E00\u5757. \u7C7B\u4F3C\u7684\u4F60\u6CA1\u6709\u4F7F\u7528syslog\u7CFB\u7EDF\u4F60\u4E5F\u4E0D\u9700\u8981\u6307\u5B9Asyslog\u914D\u7F6E.")],-1),de=s("p",null,[l("\u4E3A\u4E86\u66F4\u52A0\u5B89\u5168,"),s("code",null,"token"),l("\u4E5F\u53EF\u4EE5\u4ECE\u73AF\u5883\u53D8\u91CF\u91CC\u8BFB\u53D6,\u4F7F\u7528 "),s("code",null,"CONSUL_TOKEN"),l(" \u548C "),s("code",null,"VAULT_TOKEN"),l(".\u5F3A\u70C8\u5EFA\u8BAE\u4F60\u4E0D\u8981\u628Atoken\u653E\u5230\u672A\u52A0\u5BC6\u7684\u6587\u672C\u914D\u7F6E\u6587\u4EF6\u4E2D.")],-1),ue=s("h2",{id:"\u6A21\u7248\u8BED\u6CD5",tabindex:"-1"},[l("\u6A21\u7248\u8BED\u6CD5 "),s("a",{class:"header-anchor",href:"#\u6A21\u7248\u8BED\u6CD5","aria-hidden":"true"},"#")],-1),ye=s("p",null,"Consul Template \u4F7F\u7528\u4E86Go\u7684\u6A21\u677F\u8BED\u6CD5.\u5982\u679C\u4F60\u5BF9\u4ED6\u7684\u8BED\u6CD5\u4E0D\u719F\u6089\u5EFA\u8BAE\u4F60\u8BFB\u4E0B\u6587\u6863.\u4ED6\u7684\u8BED\u6CD5\u770B\u8D77\u6765\u4E0E Mustache, Handlebars, \u6216\u8005 Liquid \u7C7B\u4F3C.",-1),he=s("p",null,"\u5728Go \u63D0\u4F9B\u7684\u6A21\u677F\u51FD\u6570\u4E4B\u5916,Consul Template\u66B4\u9732\u4E86\u4EE5\u4E0B\u7684\u51FD\u6570:",-1),De=s("h2",{id:"api-\u51FD\u6570",tabindex:"-1"},[l("API \u51FD\u6570 "),s("a",{class:"header-anchor",href:"#api-\u51FD\u6570","aria-hidden":"true"},"#")],-1),ge=s("p",null,[s("strong",null,"datacenters"),l(" \u67E5\u8BE2\u76EE\u5F55\u4E2D\u7684\u6240\u6709\u6570\u636E\u4E2D\u5FC3.\u4F7F\u7528\u4EE5\u4E0B\u8BED\u6CD5:")],-1),_e=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{datacenters}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ve=s("p",null,[s("strong",null,"file"),l(" \u8BFB\u53D6\u5E76\u8F93\u51FA\u78C1\u76D8\u4E0A\u7684\u672C\u5730\u6587\u4EF6,\u5982\u679C\u65E0\u6CD5\u8BFB\u53D6\u4EA7\u751F\u4E00\u4E2A\u9519\u8BEF.\u4F7F\u7528\u5982\u4E0B\u8BED\u6CD5")],-1),me=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{file "/path/to/local/file"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),fe=s("p",null,[l("\u8FD9\u4E2A\u4F8B\u5B50\u5C06\u8F93\u51FA "),s("code",null,"/path/to/local/file"),l(" \u6587\u4EF6\u5185\u5BB9\u5230\u6A21\u677F. \u6CE8\u610F:\u8FD9\u4E0D\u4F1A\u5728\u5D4C\u5957\u6A21\u677F\u4E2D\u88AB\u5904\u7406")],-1),be=s("p",null,[s("strong",null,"key"),l(" \u67E5\u8BE2Consul\u6307\u5B9Akey\u7684\u503C,\u5982\u679Ckey\u7684\u503C\u4E0D\u80FD\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32,\u5C06\u4EA7\u751F\u9519\u8BEF.\u4F7F\u7528\u5982\u4E0B\u8BED\u6CD5:")],-1),we=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{key "service/redis/maxconns@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ke=s("p",null,[l("\u4E0A\u9762\u7684\u4F8B\u5B50\u67E5\u8BE2\u4E86\u5728"),s("code",null,"east-aws"),l("\u6570\u636E\u4E2D\u5FC3\u7684 "),s("code",null,"service/redis/maxconns"),l("\u7684\u503C.\u5982\u679C\u5FFD\u7565\u6570\u636E\u4E2D\u5FC3\u53C2\u6570,\u5C06\u4F1A\u67E5\u8BE2\u672C\u5730\u6570\u636E\u4E2D\u5FC3\u7684\u503C:")],-1),Te=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{key "service/redis/maxconns"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),xe=s("p",null,"Consul\u952E\u503C\u7ED3\u6784\u7684\u7F8E\u5999\u5728\u4E8E,\u8FD9\u5B8C\u5168\u53D6\u51B3\u4E8E\u4F60!",-1),Ie=s("p",null,[s("strong",null,"key_or_default"),l(" \u67E5\u8BE2Consul\u4E2D\u6307\u5B9A\u7684key\u7684\u503C,\u5982\u679Ckey\u4E0D\u5B58\u5728,\u5219\u8FD4\u56DE\u9ED8\u8BA4\u503C.\u4F7F\u7528\u65B9\u5F0F\u5982\u4E0B")],-1),Se=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{key_or_default "service/redis/maxconns@east-aws" "5"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ne=s("p",null,[l("\u6CE8\u610FConsul Template\u4F7F\u7528\u4E86\u591A\u4E2A\u9636\u6BB5\u7684\u8FD0\u7B97.\u5728\u7B2C\u4E00\u9636\u6BB5\u7684\u8FD0\u7B97\u5982\u679CConsul\u6CA1\u6709\u8FD4\u56DE\u503C,\u5219\u4F1A\u4E00\u76F4\u4F7F\u7528\u9ED8\u8BA4\u503C.\u540E\u7EED\u6A21\u677F\u89E3\u6790\u4E2D\u5982\u679C\u503C\u5B58\u5728\u4E86\u5219\u4F1A\u8BFB\u53D6\u771F\u5B9E\u7684\u503C.\u8FD9\u5F88\u91CD\u8981,\u8FD0\u7EF4Consul Templae\u4E0D\u4F1A\u56E0\u4E3A"),s("code",null,"key_or_default"),l("\u6CA1\u627E\u5230key\u800C\u963B\u585E\u6A21\u677F\u7684\u7684\u6E32\u67D3.\u5373\u4F7Fkey\u5B58\u5728\u5982\u679CConsul\u6CA1\u6709\u6309\u65F6\u8FD4\u56DE\u8FD9\u4E2A\u6570\u636E,\u4E5F\u4F1A\u4F7F\u7528\u9ED8\u8BA4\u503C\u6765\u8FDB\u884C\u66FF\u4EE3.")],-1),Pe=s("p",null,[s("strong",null,"ls"),l(" \u67E5\u770BConsul\u7684\u6240\u6709\u4EE5\u6307\u5B9A\u524D\u7F00\u5F00\u5934\u7684key-value\u5BF9.\u5982\u679C\u6709\u503C\u65E0\u6CD5\u8F6C\u6362\u6210\u5B57\u7B26\u4E32\u5219\u4F1A\u4EA7\u751F\u4E00\u4E2A\u9519\u8BEF:")],-1),Ee=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range ls "service/redis@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{.Key}} {{.Value}}{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Re=s("p",null,[l("\u5982\u679CConsul\u5B9E\u4F8B\u5728"),s("code",null,"east-aws"),l("\u6570\u636E\u4E2D\u5FC3\u5B58\u5728\u8FD9\u4E2A\u7ED3\u6784"),s("code",null,"service/redis"),l(",\u6E32\u67D3\u540E\u7684\u6A21\u677F\u5E94\u8BE5\u7C7B\u4F3C\u8FD9\u6837:")],-1),je=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"minconns 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"maxconns 12")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Oe=s("p",null,"\u5982\u679C\u4F60\u5FFD\u7565\u6570\u636E\u4E2D\u5FC3\u5C5E\u6027,\u5219\u4F1A\u8FD4\u56DE\u672C\u5730\u6570\u636E\u4E2D\u5FC3\u7684\u67E5\u8BE2\u7ED3\u679C.",-1),Le=s("p",null,[s("strong",null,"node"),l(" \u67E5\u8BE2\u76EE\u5F55\u4E2D\u7684\u4E00\u4E2A\u8282\u70B9\u4FE1\u606F")],-1),Ve=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{node "node1"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),He=s("p",null,"\u5982\u679C\u672A\u6307\u5B9A\u4EFB\u4F55\u53C2\u6570,\u5219\u5F53\u524Dagent\u6240\u5728\u8282\u70B9\u5C06\u4F1A\u88AB\u8FD4\u56DE:",-1),Fe=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{node}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ue=s("p",null,"\u4F60\u53EF\u4EE5\u6307\u5B9A\u4E00\u4E2A\u53EF\u9009\u7684\u53C2\u6570\u6765\u6307\u5B9A\u6570\u636E\u4E2D\u5FC3:",-1),Ge=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{node "node1" "@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Me=s("p",null,[l("\u5982\u679C\u6307\u5B9A\u7684\u8282\u70B9\u6CA1\u6709\u627E\u5230\u5219\u4F1A\u8FD4\u56DE"),s("code",null,"nil"),l(".\u5982\u679C\u8282\u70B9\u5B58\u5728\u5C31\u4F1A\u5217\u51FA\u8282\u70B9\u7684\u4FE1\u606F\u548C\u8282\u70B9\u63D0\u4F9B\u7684\u670D\u52A1.")],-1),We=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{with node}}{{.Node.Node}} ({{.Node.Address}}){{range .Services}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'  {{.Service}} {{.Port}} ({{.Tags | join ","}}){{end}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ke=s("p",null,[s("strong",null,"nodes"),l(" \u67E5\u8BE2\u76EE\u5F55\u4E2D\u7684\u5168\u90E8\u8282\u70B9,\u4F7F\u7528\u5982\u4E0B\u8BED\u6CD5")],-1),qe=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{nodes}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),$e=s("p",null,"\u8FD9\u4E2A\u4F8B\u5B50\u4F1A\u67E5\u8BE2Consul\u7684\u9ED8\u8BA4\u6570\u636E\u4E2D\u5FC3.\u4F60\u53EF\u4EE5\u4F7F\u7528\u53EF\u9009\u53C2\u6570\u6307\u5B9A\u4E00\u4E2A\u53EF\u9009\u53C2\u6570\u6765\u6307\u5B9A\u6570\u636E\u4E2D\u5FC3:",-1),Qe=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{nodes "@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Je=s("p",null,"\u8FD9\u4E2A\u4F8B\u5B50\u4F1A\u67E5\u8BE2east-aws\u6570\u636E\u4E2D\u5FC3\u7684\u6240\u6709\u51E0\u70B9.",-1),ze=s("p",null,[s("strong",null,"secret"),l(" \u67E5\u8BE2"),s("code",null,"Vault"),l("\u4E2D\u6307\u5B9A\u8DEF\u5F84\u7684\u5BC6\u5319.\u5982\u679C\u6307\u5B9A\u7684\u8DEF\u5F84\u4E0D\u5B58\u5728\u6216\u8005"),s("code",null,"Vault"),l("\u7684"),s("code",null,"Token"),l("\u6CA1\u6709\u8DB3\u591F\u6743\u9650\u53BB\u8BFB\u53D6\u6307\u5B9A\u7684\u8DEF\u5F84,\u5C06\u4F1A\u4EA7\u751F\u4E00\u4E2A\u9519\u8BEF.\u5982\u679C\u8DEF\u5F84\u5B58\u5728\u4F46\u662Fkey\u4E0D\u5B58\u5728\u5219\u8FD4\u56DE\u201C.")],-1),Xe=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{with secret "secret/passwords"}}{{.Data.password}}{{end}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Be=s("p",null,"\u53EF\u4EE5\u4F7F\u7528\u5982\u4E0B\u5B57\u6BB5:",-1),Ye=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"LeaseID - the unique lease identifier")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"LeaseDuration - the number of seconds the lease is valid")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Renewable - if the secret is renewable")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`Data - the raw data - this is a map[string]interface{}, so it can be queried using Go's templating "dot notation"`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'If the map key has dots "." in it, you need to access the value using the index function:')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{index .Data "my.key.with.dots"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"If additional arguments are passed to the function, then the operation is assumed to be a write operation instead of a read operation. The write operation must return data in order to be valid. This is especially useful for the PKI secret backend, for example.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{ with secret "pki/issue/my-domain-dot-com" "common_name=foo.example.com" }}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{ .Data.certificate }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{ end }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"The parameters must be key=value pairs, and each pair must be its own argument to the function:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{ secret "path/" "a=b" "c=d" "e=f" }}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Please always consider the security implications of having the contents of a secret in plain-text on disk. If an attacker is able to get access to the file, they will have access to plain-text secrets.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ze=s("p",null,"Please note that Vault does not support blocking queries. As a result, Consul Template will not immediately reload in the event a secret is changed as it does with Consul\u2019s key-value store. Consul Template will fetch a new secret at half the lease duration of the original secret. For example, most items in Vault\u2019s generic secret backend have a default 30 day lease. This means Consul Template will renew the secret every 15 days. As such, it is recommended that a smaller lease duration be used when generating the initial secret to force Consul Template to renew more often.",-1),sa=s("p",null,[s("strong",null,"secrets"),l(" Query Vault to list the secrets at the given path. Please note this requires Vault 0.5+ and the endpoint you want to list secrets must support listing. Not all endpoints support listing. The result is the list of secret names as strings.")],-1),la=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range secrets "secret/"}}{{.}}{{end}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),na=s("p",null,"The trailing slash is optional in the template, but the generated secret dependency will always have a trailing slash in log output.",-1),ea=s("p",null,"To iterate and list over every secret in the generic secret backend in Vault, for example, you would need to do something like this:",-1),aa=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range secrets "secret/"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{with secret (printf "secret/%s" .)}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{range $k, $v := .Data}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{$k}}: {{$v}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),oa=s("p",null,"You should probably never do this. Please also note that Vault does not support blocking queries. To understand the implications, please read the note at the end of the secret function.",-1),ta=s("p",null,[s("strong",null,"service"),l(" \u67E5\u8BE2Consul\u4E2D\u5339\u914D\u8868\u8FBE\u5F0F\u7684\u670D\u52A1.\u8BED\u6CD5\u5982\u4E0B:")],-1),ca=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "release.web@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ia=s("p",null,[l("\u4E0A\u9762\u7684\u4F8B\u5B50\u67E5\u8BE2Consul\u4E2D,\u5728"),s("code",null,"east-aws"),l("\u6570\u636E\u4E2D\u5FC3\u5B58\u5728\u7684\u5065\u5EB7\u7684 "),s("code",null,"web"),l("\u670D\u52A1.tag\u548C\u6570\u636E\u4E2D\u5FC3\u53C2\u6570\u662F\u53EF\u9009\u7684.\u4ECE\u5F53\u524D\u6570\u636E\u4E2D\u5FC3\u67E5\u8BE2\u6240\u6709\u8282\u70B9\u7684"),s("code",null,"web"),l("\u670D\u52A1\u800C\u4E0D\u7BA1tag,\u67E5\u8BE2\u8BED\u6CD5\u5982\u4E0B:")],-1),ra=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "web"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),pa=s("p",null,[l("\u8FD9\u4E2A\u51FD\u6570\u8FD4\u56DE"),s("code",null,"[]*HealthService"),l("\u7ED3\u6784.\u53EF\u6309\u7167\u5982\u4E0B\u65B9\u5F0F\u5E94\u7528\u5230\u6A21\u677F:")],-1),Ca=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range service "web@data center"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server {{.Name}} {{.Address}}:{{.Port}}{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Aa=s("p",null,"\u4EA7\u751F\u5982\u4E0B\u8F93\u51FA:",-1),da=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server nyc_web_01 123.456.789.10:8080")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server nyc_web_02 456.789.101.213:8080")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ua=s("p",null,[l("\u9ED8\u8BA4\u503C\u4F1A\u8FD4\u56DE\u5065\u5EB7\u7684\u670D\u52A1,\u5982\u679C\u4F60\u60F3\u83B7\u53D6\u6240\u6709\u670D\u52A1,\u53EF\u4EE5\u589E\u52A0"),s("code",null,"any"),l("\u9009\u9879,\u5982\u4E0B:")],-1),ya=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "web" "any"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ha=s("p",null,"\u8FD9\u6837\u5C31\u4F1A\u8FD4\u56DE\u6CE8\u518C\u8FC7\u7684\u6240\u6709\u670D\u52A1,\u800C\u4E0D\u8BBA\u4ED6\u7684\u72B6\u6001\u5982\u4F55.",-1),Da=s("p",null,"\u5982\u679C\u4F60\u60F3\u8FC7\u6EE4\u6307\u5B9A\u7684\u4E00\u4E2A\u6216\u8005\u591A\u4E2A\u5065\u5EB7\u72B6\u6001,\u4F60\u53EF\u4EE5\u901A\u8FC7\u9017\u53F7\u9694\u5F00\u591A\u4E2A\u5065\u5EB7\u72B6\u6001:",-1),ga=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "web" "passing, warning"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),_a=s("p",null,[l("\u8FD9\u6837\u5C06\u4F1A\u8FD4\u56DE\u88AB\u4ED6\u4EEC\u7684\u8282\u70B9\u548C\u670D\u52A1\u7EA7\u522B\u7684\u68C0\u67E5\u5B9A\u4E49\u6807\u8BB0\u4E3A \u201Cpassing\u201D \u6216\u8005 \u201Cwarning\u201D\u7684\u670D\u52A1. \u8BF7\u6CE8\u610F\u9017\u53F7\u662F "),s("code",null,"OR"),l("\u800C\u4E0D\u662F"),s("code",null,"AND"),l("\u7684\u610F\u601D.")],-1),va=s("p",null,[l("\u6307\u5B9A\u4E86\u8D85\u8FC7\u4E00\u4E2A\u72B6\u6001\u8FC7\u6EE4,\u5E76\u5305\u542B"),s("code",null,"any"),l("\u5C06\u4F1A\u8FD4\u56DE\u4E00\u4E2A\u9519\u8BEF.\u56E0\u4E3A"),s("code",null,"any"),l("\u662F\u6BD4\u6240\u6709\u72B6\u6001\u66F4\u9AD8\u7EA7\u7684\u8FC7\u6EE4.")],-1),ma=s("p",null,"\u540E\u9762\u8FD92\u79CD\u65B9\u5F0F\u6709\u4E9B\u67B6\u6784\u4E0A\u7684\u4E0D\u540C:",-1),fa=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "web"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "web" "passing"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ba=s("p",null,[l("\u524D\u8005\u4F1A\u8FD4\u56DEConsul\u8BA4\u4E3A"),s("code",null,"healthy"),l("\u548C"),s("code",null,"passing"),l("\u7684\u6240\u6709\u670D\u52A1.\u540E\u8005\u5C06\u8FD4\u56DE\u6240\u6709\u5DF2\u7ECF\u5728Consul\u6CE8\u518C\u7684\u670D\u52A1.\u7136\u540E\u4F1A\u6267\u884C\u4E00\u4E2A\u5BA2\u6237\u7AEF\u7684\u8FC7\u6EE4.\u901A\u5E38\u5982\u679C\u4F60\u60F3\u83B7\u53D6\u5065\u5EB7\u7684\u670D\u52A1,\u4F60\u5E94\u8BE5\u4E0D\u8981\u4F7F\u7528"),s("code",null,"passing"),l("\u53C2\u6570,\u76F4\u63A5\u5FFD\u7565\u7B2C\u4E09\u4E2A\u53C2\u6570\u5373\u53EF.\u7136\u800C\u7B2C\u4E09\u4E2A\u53C2\u6570\u5728\u4F60\u60F3\u67E5\u8BE2 passing\u6216\u8005"),s("code",null,"warning"),l("\u7684\u670D\u52A1\u4F1A\u6BD4\u8F83\u6709\u7528,\u5982\u4E0B:")],-1),wa=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{service "web" "passing, warning"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ka=s("p",null,"\u670D\u52A1\u7684\u72B6\u6001\u4E5F\u662F\u53EF\u89C1\u7684,\u5982\u679C\u4F60\u60F3\u81EA\u5DF1\u505A\u4E00\u4E9B\u989D\u5916\u7684\u8FC7\u6EE4,\u8BED\u6CD5\u5982\u4E0B:",-1),Ta=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range service "web" "any"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{if eq .Status "critical"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// Critical state!{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{if eq .Status "passing"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"// Ok{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),xa=s("p",null,[l("\u6267\u884C\u547D\u4EE4\u65F6,\u5728Consul\u5C06\u670D\u52A1\u8BBE\u7F6E\u4E3A\u7EF4\u62A4\u6A21\u5F0F,\u53EA\u9700\u8981\u5728\u4F60\u7684\u547D\u4EE4\u4E0A\u5305\u4E0AConsul\u7684 "),s("code",null,"maint"),l(" \u8C03\u7528:")],-1),Ia=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"#!/bin/sh")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"set -e")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul maint -enable -service web -reason "Consul Template updated"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"service nginx reload")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul maint -disable -service web")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Sa=s("p",null,"\u53E6\u5916\u5982\u679C\u4F60\u6CA1\u6709\u5B89\u88C5Consul agent,\u4F60\u53EF\u4EE5\u76F4\u63A5\u8C03\u7528API\u8BF7\u6C42:",-1),Na=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"#!/bin/sh")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"set -e")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'curl -X PUT "http://$CONSUL_HTTP_ADDR/v1/agent/service/maintenance/web?enable=true&reason=Consul+Template+Updated"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"service nginx reload")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'curl -X PUT "http://$CONSUL_HTTP_ADDR/v1/agent/service/maintenance/web?enable=false"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Pa=s("p",null,[s("strong",null,"services"),l(" \u67E5\u8BE2Consul\u76EE\u5F55\u4E2D\u7684\u6240\u6709\u670D\u52A1,\u4F7F\u7528\u5982\u4E0B\u8BED\u6CD5:")],-1),Ea=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{services}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ra=s("p",null,"\u8FD9\u4E2A\u4F8B\u5B50\u5C06\u67E5\u8BE2Consul\u7684\u9ED8\u8BA4\u6570\u636E\u4E2D\u5FC3,\u4F60\u53EF\u4EE5\u6307\u5B9A\u4E00\u4E2A\u53EF\u9009\u53C2\u6570\u6765\u6307\u5B9A\u6570\u636E\u4E2D\u5FC3:",-1),ja=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{services "@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Oa=s("p",null,"\u8BF7\u6CE8\u610F: services\u51FD\u6570\u4E0Eservice\u662F\u4E0D\u540C\u7684,service\u63A5\u53D7\u66F4\u591A\u53C2\u6570\u5E76\u4E14\u67E5\u8BE2\u76D1\u63A7\u7684\u670D\u52A1\u5217\u8868.\u8FD9\u4E2A\u67E5\u8BE2Consul\u76EE\u5F55\u5E76\u8FD4\u56DE\u4E00\u4E2A\u670D\u52A1\u7684tag\u7684Map,\u5982\u4E0B:",-1),La=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{range services}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{.Name}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{range .Tags}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  {{.}}{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Va=s("p",null,[s("strong",null,"tree"),l(" \u67E5\u8BE2\u6240\u6709\u6307\u5B9A\u524D\u7F00\u7684key-value\u503C\u5BF9,\u5982\u679C\u5176\u4E2D\u7684\u503C\u6709\u65E0\u6CD5\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\u7684\u5219\u5F15\u53D1\u9519\u8BEF:")],-1),Ha=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'{{range tree "service/redis@east-aws"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"{{.Key}} {{.Value}}{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Fa=s("p",null,[l("\u5982\u679CConsul\u5B9E\u4F8B\u5728"),s("code",null,"east-aws"),l("\u6570\u636E\u4E2D\u5FC3\u6709\u4E00\u4E2A"),s("code",null,"service/redis"),l("\u7ED3\u6784,\u6A21\u677F\u7684\u6E32\u67D3\u7ED3\u679C\u7C7B\u4F3C\u4E0B\u9762:")],-1),Ua=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"minconns 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"maxconns 12")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'nested/config/value "value"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ga=s("p",null,[l("\u548C"),s("code",null,"ls"),l("\u4E0D\u540C,"),s("code",null,"tree"),l("\u8FD4\u56DE\u524D\u7F00\u4E0B\u7684\u6240\u6709key.\u548CUnix\u7684tree\u547D\u4EE4\u6BD4\u8F83\u50CF.\u5982\u679C\u5FFD\u7565\u6570\u636E\u4E2D\u5FC3\u53C2\u6570,\u5219\u4F1A\u4F7F\u7528\u672C\u5730\u6570\u636E\u4E2D\u5FC3")],-1),Ma=s("p",null,[s("a",{href:"https://book-consul-guide.vnzmi.com/11_consul_template.html",target:"_blank",rel:"noreferrer"},"\u67E5\u770B\u66F4\u591A")],-1),Wa=s("p",null,[s("a",{href:"https://book-consul-guide.vnzmi.com/11_consul_template.html",target:"_blank",rel:"noreferrer"},"\u9879\u76EEGithub\u5730\u5740")],-1),Ka=s("h2",{id:"haproxy-\u5B9E\u4F8B",tabindex:"-1"},[l("Haproxy \u5B9E\u4F8B "),s("a",{class:"header-anchor",href:"#haproxy-\u5B9E\u4F8B","aria-hidden":"true"},"#")],-1),qa=s("p",null,[l("\u6839\u636Ehaproxy\u670D\u52A1\u7684\u914D\u7F6E\u6587\u4EF6\u521B\u5EFA\u4E00\u4E2Aconsul-template\u6A21\u7248\u6E32\u67D3\u6587\u4EF6\uFF1A"),s("code",null,"haproxy.ctmpl")],-1),$a=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"# Consul Haproxy configured")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        maxconn         20480")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        ulimit-n        65535")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log             127.0.0.1 local5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        uid             200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        gid             200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        chroot          /usr/local/haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        nbproc          1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        daemon")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        pidfile         /usr/local/haproxy/logs/haproxy.pid")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"defaults")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log             global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode            http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          httplog")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          dontlognull")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          forwardfor")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          abortonclose")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        retries         3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        maxconn         3000")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats           enable")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats           hide-version")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   uri     /admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   auth    admin:admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   refresh 10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        balance         roundrobin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout connect 5000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout client 50000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout server 50000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout check 2000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"listen web_haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        bind 0.0.0.0:8080")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log     127.0.0.1 local5 err")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   refresh 5s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   uri /admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   realm liang lian")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   auth admin:admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   hide-version")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   admin if TRUE")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"frontend consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        bind    0.0.0.0:8500")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode    http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log     global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        default_backend consul-cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"backend consul-cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'        {{range service "Faceid"}}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server {{.ID}} {{.Address}}:{{.Port}} check inter 5000 fall 1 rise 2 weight 2{{end}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Qa=s("p",null,"\u8FD0\u884Cconsul-template\u4F5C\u4E3A\u4E00\u4E2A\u670D\u52A1,\u901A\u8FC7\u4E0A\u9762\u7684\u6E32\u67D3\u6A21\u7248\u6E32\u67D3\u4E00\u4E2Ahaproxy.cfg\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u7136\u540E\u91CD\u542Fhaproxy\u670D\u52A1",-1),Ja=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'consul-template -consul-addr=10.201.102.185:8500 -template "/root/haproxy.ctmpl:/etc/haproxy.cfg:service haproxy restart"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),za=s("p",null,[l("10.201.102.185 \u770B\u6211\u4E0A\u7BC7\u6587\u7AE0"),s("a",{href:"http://www.liangxiansen.cn/2017/03/06/haproxy/",target:"_blank",rel:"noreferrer"},"Haproxy"),l("\uFF0C\u8FD9\u662Fconsul\u96C6\u7FA4\u7684VIP\uFF0C\u4E3A\u4E86\u907F\u514D\u5355\u72EC\u8C03\u67D0\u4E00\u53F0\u670D\u52A1\u5668\u670D\u52A1\u5668\u51FA\u73B0\u6545\u969C\u540Econsul-template\u65E0\u6CD5\u5DE5\u4F5C\u3002")],-1),Xa=s("p",null,[l("\u6E32\u67D3\u540E\u7684"),s("code",null,"haproxy.cfg")],-1),Ba=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"# Consul Haproxy configured")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        maxconn         20480")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        ulimit-n        65535")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log             127.0.0.1 local5")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        uid             200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        gid             200")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        chroot          /usr/local/haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        nbproc          1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        daemon")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        pidfile         /usr/local/haproxy/logs/haproxy.pid")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"defaults")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log             global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode            http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          httplog")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          dontlognull")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          forwardfor")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        option          abortonclose")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        retries         3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        maxconn         3000")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats           enable")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats           hide-version")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   uri     /admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   auth    admin:admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   refresh 10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        balance         roundrobin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout connect 5000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout client 50000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout server 50000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        timeout check 2000ms")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"listen web_haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        bind 0.0.0.0:8080")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log     127.0.0.1 local5 err")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   refresh 5s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   uri /admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   realm liang lian")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   auth admin:admin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   hide-version")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        stats   admin if TRUE")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"frontend consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        bind    0.0.0.0:8500")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode    http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        log     global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        default_backend consul-cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"backend consul-cluster")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        mode http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server Faceid 10.201.102.198:9000 check inter 5000 fall 1 rise 2 weight 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server Faceid 10.201.102.199:9000 check inter 5000 fall 1 rise 2 weight 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server Faceid 10.201.102.200:9000 check inter 5000 fall 1 rise 2 weight 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Ya=s("p",null,"\u6574\u4E2A\u5C31\u662F\u642D\u5EFAconsul\u96C6\u7FA4\uFF0C\u5E73\u53F0\u4E2D\u7684\u670D\u52A1\u4F1A\u6CE8\u518C\u5230consul\u96C6\u7FA4\u4E2D\uFF0Chaproxy\u907F\u514Dconsul-template\u8C03consul\u65F6\u51FA\u73B0\u5355\u70B9\u6545\u969Cconsul-template\u65E0\u6CD5\u5DE5\u4F5C\u505A\u7684\u9AD8\u53EF\u7528\uFF0CConsul-template\u5C31\u662F\u80FD\u5728\u6574\u4E2A\u5E73\u53F0\u7684\u5404\u4E2A\u7CFB\u7EDF\u548C\u5E94\u7528\u4E2D\u4F7F\u7528\uFF0C\u67E5\u8BE2consul\u96C6\u7FA4\u6765\u83B7\u53D6\u5E73\u53F0\u4E0A\u5404\u4E2A\u5E94\u7528\u7684\u5B58\u6D3B\u72B6\u6001\u548CIP\u3002",-1),Za=s("p",null,"\u6574\u5957\u4E0B\u6765\u5B9E\u73B0\u4E86\u4E24\u4E2A\u91CD\u70B9\uFF1A",-1),so=s("p",null,"\u5B9E\u73B0\u4E86\u4E2D\u5FC3\u670D\u52A1\u6CE8\u518C\u67E5\u8BE2 \u5E73\u53F0\u4E2D\u5176\u4ED6\u8282\u70B9\u7684\u67E5\u8BE2\u670D\u52A1\u548C\u914D\u7F6E\u6587\u4EF6\u81EA\u52A8\u66F4\u65B0",-1),lo=s("h1",{id:"\u53C2\u8003\u8D44\u6599",tabindex:"-1"},[l("\u53C2\u8003\u8D44\u6599 "),s("a",{class:"header-anchor",href:"#\u53C2\u8003\u8D44\u6599","aria-hidden":"true"},"#")],-1),no=s("p",null,[s("a",{href:"https://my.oschina.net/guol/blog/675281",target:"_blank",rel:"noreferrer"},"https://my.oschina.net/guol/blog/675281"),s("a",{href:"https://www.consul.io/docs/guides/index.html",target:"_blank",rel:"noreferrer"},"https://www.consul.io/docs/guides/index.html"),s("a",{href:"https://www.gitbook.com/book/vincentmi/consul-guide/details",target:"_blank",rel:"noreferrer"},"https://www.gitbook.com/book/vincentmi/consul-guide/details")],-1),eo=s("p",null,[s("a",{href:"https://my.oschina.net/abcfy2/blog/675665",target:"_blank",rel:"noreferrer"},"https://my.oschina.net/abcfy2/blog/675665")],-1),ao=s("h1",{id:"\u4E0B\u8F7D",tabindex:"-1"},[l("\u4E0B\u8F7D "),s("a",{class:"header-anchor",href:"#\u4E0B\u8F7D","aria-hidden":"true"},"#")],-1),oo=s("p",null,[s("a",{href:"http://www.liangxiansen.cn/files/consul.pdf",target:"_blank",rel:"noreferrer"},"\u70B9\u51FB\u4E0B\u8F7DPDF\u6587\u4EF6")],-1),to=s("p",null,[l("\u539F:"),s("a",{href:"http://www.liangxiansen.cn/2017/04/06/consul/",target:"_blank",rel:"noreferrer"},"http://www.liangxiansen.cn/2017/04/06/consul/")],-1);function co(e,io,ro,po,t,Co){const c=i;return C(),p(c,{frontmatter:t.frontmatter,data:t.data},{"main-content-md":n(()=>[u,y,h,D,g,_,v,m,f,b,w,k,T,x,I,S,N,P,E,R,j,O,L,V,H,F,U,G,M,W,K,q,$,Q,J,z,X,B,Y,Z,ss,ls,ns,es,as,os,ts,cs,is,rs,ps,Cs,As,ds,us,ys,hs,Ds,gs,_s,vs,ms,fs,bs,ws,ks,Ts,xs,Is,Ss,Ns,Ps,Es,Rs,js,Os,Ls,Vs,Hs,Fs,Us,Gs,Ms,Ws,Ks,qs,$s,Qs,Js,zs,Xs,Bs,Ys,Zs,sl,ll,nl,el,al,ol,tl,cl,il,rl,pl,Cl,Al,dl,ul,yl,hl,Dl,gl,_l,vl,ml,fl,bl,wl,kl,Tl,xl,Il,Sl,Nl,Pl,El,Rl,jl,Ol,Ll,Vl,Hl,Fl,Ul,Gl,Ml,Wl,Kl,ql,$l,Ql,Jl,zl,Xl,Bl,Yl,Zl,sn,ln,nn,en,an,on,tn,cn,rn,pn,Cn,An,dn,un,yn,hn,Dn,gn,_n,vn,mn,fn,bn,wn,kn,Tn,xn,In,Sn,Nn,Pn,En,Rn,jn,On,Ln,Vn,Hn,Fn,Un,Gn,Mn,Wn,Kn,qn,$n,Qn,Jn,zn,Xn,Bn,Yn,Zn,se,le,ne,ee,ae,oe,te,ce,ie,re,pe,Ce,Ae,de,ue,ye,he,De,ge,_e,ve,me,fe,be,we,ke,Te,xe,Ie,Se,Ne,Pe,Ee,Re,je,Oe,Le,Ve,He,Fe,Ue,Ge,Me,We,Ke,qe,$e,Qe,Je,ze,Xe,Be,Ye,Ze,sa,la,na,ea,aa,oa,ta,ca,ia,ra,pa,Ca,Aa,da,ua,ya,ha,Da,ga,_a,va,ma,fa,ba,wa,ka,Ta,xa,Ia,Sa,Na,Pa,Ea,Ra,ja,Oa,La,Va,Ha,Fa,Ua,Ga,Ma,Wa,Ka,qa,$a,Qa,Ja,za,Xa,Ba,Ya,Za,so,lo,no,eo,ao,oo,to]),"main-header":n(()=>[a(e.$slots,"main-header")]),"main-header-after":n(()=>[a(e.$slots,"main-header-after")]),"main-nav":n(()=>[a(e.$slots,"main-nav")]),"main-content":n(()=>[a(e.$slots,"main-content")]),"main-content-after":n(()=>[a(e.$slots,"main-content-after")]),"main-nav-before":n(()=>[a(e.$slots,"main-nav-before")]),"main-nav-after":n(()=>[a(e.$slots,"main-nav-after")]),comment:n(()=>[a(e.$slots,"comment")]),footer:n(()=>[a(e.$slots,"footer")]),aside:n(()=>[a(e.$slots,"aside")]),"aside-custom":n(()=>[a(e.$slots,"aside-custom")]),default:n(()=>[a(e.$slots,"default")]),_:3},8,["frontmatter","data"])}const _o=r(d,[["render",co]]);export{go as __pageData,_o as default};
