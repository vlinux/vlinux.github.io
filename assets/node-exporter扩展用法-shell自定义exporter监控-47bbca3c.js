import{_ as p}from"./ValaxyMain-69d5034a.js";import{_ as c,p as i,c as d,w as o,o as C,r as n,b as e,R as s}from"./app-2f70f213.js";import"./YunFooter-5ce7538e.js";import"./YunCard-e25878d2.js";import"./YunPageHeader-cb5c6fff.js";const H=JSON.parse('{"title":"node-exporter扩展用法-shell自定义exporter监控","description":"","frontmatter":{"title":"node-exporter扩展用法-shell自定义exporter监控","categories":"Prometheus","tags":["自定义exporter"],"date":"2019-11-20T11:08:00.000Z"},"headers":[{"level":2,"title":"添加取值脚本","slug":"添加取值脚本","link":"#添加取值脚本","children":[]},{"level":2,"title":"设置定时任务","slug":"设置定时任务","link":"#设置定时任务","children":[]},{"level":2,"title":"添加启动参数","slug":"添加启动参数","link":"#添加启动参数","children":[]},{"level":2,"title":"验证","slug":"验证","link":"#验证","children":[]}],"relativePath":"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","lastUpdated":1671090556000}'),t=JSON.parse('{"title":"node-exporter扩展用法-shell自定义exporter监控","description":"","frontmatter":{"title":"node-exporter扩展用法-shell自定义exporter监控","categories":"Prometheus","tags":["自定义exporter"],"date":"2019-11-20T11:08:00.000Z"},"headers":[{"level":2,"title":"添加取值脚本","slug":"添加取值脚本","link":"#添加取值脚本","children":[]},{"level":2,"title":"设置定时任务","slug":"设置定时任务","link":"#设置定时任务","children":[]},{"level":2,"title":"添加启动参数","slug":"添加启动参数","link":"#添加启动参数","children":[]},{"level":2,"title":"验证","slug":"验证","link":"#验证","children":[]}],"relativePath":"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","lastUpdated":1671090556000}'),_={name:"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md",data(){return{data:t,frontmatter:t.frontmatter}},setup(){i("pageData",t)}},y=e("blockquote",null,[e("p",null,"当Prometheus的node_exporter中没有我们需要的一些监控项时，就可以使用自定义exporter的扩展功能，但是对于那些开发能力稍微弱一些的朋友（特指我），如果你会shell脚本的编写，最基础的awk语法，那么你也可以进行自定义exporter，这就需要借助Node-exporter实现了。")],-1),u=e("p",null,[s("*"),e("em",null,[s("node_exporter 可在启动时指定路径，并将该路径下的 "),e("em",null,".prom 识别为监控数据文件。")])],-1),h=e("h2",{id:"添加取值脚本",tabindex:"-1"},[s("添加取值脚本 "),e("a",{class:"header-anchor",href:"#添加取值脚本","aria-hidden":"true"},"#")],-1),A=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"[root@one tmp]# cat /data/exporter/key/key_runner ")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"#! /bin/bash")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},'echo Logical_CPU_core_total  `cat /proc/cpuinfo| grep "processor"| wc -l`')]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"echo logined_users_total     `who | wc -l`;")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"echo procs_total `ps aux|wc -l`")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"echo procs_zombie       `ps axo pid=,stat=|grep Z|wc -l`")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),m=e("p",null,"执行效果",-1),D=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"[root@one key]# bash  key_runner")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"Logical_CPU_core_total 2")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"logined_users_total 1")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_total 148")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_zombie 0")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),x=e("h2",{id:"设置定时任务",tabindex:"-1"},[s("设置定时任务 "),e("a",{class:"header-anchor",href:"#设置定时任务","aria-hidden":"true"},"#")],-1),g=e("blockquote",null,[e("p",null,"每分钟执行一次")],-1),f=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"* * * * * bash /usr/local/node_exporter/key/key_runner > /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),v=e("h2",{id:"添加启动参数",tabindex:"-1"},[s("添加启动参数 "),e("a",{class:"header-anchor",href:"#添加启动参数","aria-hidden":"true"},"#")],-1),k=e("p",null,"启动node_exporter，指定新加key值的prom路径",-1),b=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"./node_exporter --collector.textfile.directory=/usr/local/node_exporter-0.16/key")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),E=e("p",null,"如果你是Docker启动，请考虑使用下面这条命令.",-1),P=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"docker"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"run"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-d"),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--net="),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#C3E88D"}},"host"),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--pid="),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#C3E88D"}},"host"),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--name=node-exporter"),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"-v"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#C3E88D"}},"/:/host:ro"),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#C3E88D"}},"quay.io/prometheus/node-exporter"),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--path.rootfs"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"/host"),e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#C3E88D"}},"--collector.textfile.directory=/host/data/exporter/key/")]),s(`
`),e("span",{class:"line"})])])],-1),F=e("h2",{id:"验证",tabindex:"-1"},[s("验证 "),e("a",{class:"header-anchor",href:"#验证","aria-hidden":"true"},"#")],-1),$=e("p",null,"查看metrics值是否新增了该监控项",-1),U=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},'[root@one key]# curl 127.0.0.1:9100/metrics|grep -E "Logical_CPU_core_total|logined_users_total|procs_total|procs_zombie"')]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE Logical_CPU_core_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"Logical_CPU_core_total 2")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# HELP logined_users_total Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE logined_users_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"logined_users_total 1")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# HELP procs_total Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE procs_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_total 151")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# HELP procs_zombie Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE procs_zombie untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_zombie 0")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1);function w(l,L,T,z,a,B){const r=p;return C(),d(r,{frontmatter:a.frontmatter,data:a.data},{"main-content-md":o(()=>[y,u,h,A,m,D,x,g,f,v,k,b,E,P,F,$,U]),"main-header":o(()=>[n(l.$slots,"main-header")]),"main-header-after":o(()=>[n(l.$slots,"main-header-after")]),"main-nav":o(()=>[n(l.$slots,"main-nav")]),"main-content":o(()=>[n(l.$slots,"main-content")]),"main-content-after":o(()=>[n(l.$slots,"main-content-after")]),"main-nav-before":o(()=>[n(l.$slots,"main-nav-before")]),"main-nav-after":o(()=>[n(l.$slots,"main-nav-after")]),comment:o(()=>[n(l.$slots,"comment")]),footer:o(()=>[n(l.$slots,"footer")]),aside:o(()=>[n(l.$slots,"aside")]),"aside-custom":o(()=>[n(l.$slots,"aside-custom")]),default:o(()=>[n(l.$slots,"default")]),_:3},8,["frontmatter","data"])}const V=c(_,[["render",w],["__file","/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/node-exporter扩展用法-shell自定义exporter监控.md"]]);export{H as __pageData,V as default};
