import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang-e99d3f99.js";import{_ as y,c as D,w as o,o as C,a as A,b as s,d as l,e as n,r as t,f as F,p as u}from"./app-24c8f26b.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-d5aa7215.js";import"./YunCard.vue_vue_type_style_index_0_lang-07a61ffe.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-7ae0f4ad.js";const _s=JSON.parse('{"title":"kubernetes中使用Prometheus-Operator和BlackBox—Exporter实现监控域名钉钉告警","description":"","frontmatter":{"title":"kubernetes中使用Prometheus-Operator和BlackBox—Exporter实现监控域名钉钉告警","date":"2023-03-01T09:16:00.000Z","updated":null,"tags":["Prometheus-Operator"],"categories":"Prometheus","end":false},"headers":[{"level":2,"title":"配置告警规则","slug":"配置告警规则","link":"#配置告警规则","children":[]},{"level":2,"title":"配置钉钉WebHook和群机器人","slug":"配置钉钉webhook和群机器人","link":"#配置钉钉webhook和群机器人","children":[{"level":3,"title":"在k8s中安装全家桶","slug":"在k8s中安装全家桶","link":"#在k8s中安装全家桶","children":[]}]},{"level":2,"title":"配置Alertmanager","slug":"配置alertmanager","link":"#配置alertmanager","children":[]},{"level":2,"title":"验证","slug":"验证","link":"#验证","children":[]}],"relativePath":"pages/posts/k8s-kube-prometheus-probe-blackbox-exporter.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/k8s-kube-prometheus-probe-blackbox-exporter.md","lastUpdated":1679902831000}'),r=JSON.parse('{"title":"kubernetes中使用Prometheus-Operator和BlackBox—Exporter实现监控域名钉钉告警","description":"","frontmatter":{"title":"kubernetes中使用Prometheus-Operator和BlackBox—Exporter实现监控域名钉钉告警","date":"2023-03-01T09:16:00.000Z","updated":null,"tags":["Prometheus-Operator"],"categories":"Prometheus","end":false},"headers":[{"level":2,"title":"配置告警规则","slug":"配置告警规则","link":"#配置告警规则","children":[]},{"level":2,"title":"配置钉钉WebHook和群机器人","slug":"配置钉钉webhook和群机器人","link":"#配置钉钉webhook和群机器人","children":[{"level":3,"title":"在k8s中安装全家桶","slug":"在k8s中安装全家桶","link":"#在k8s中安装全家桶","children":[]}]},{"level":2,"title":"配置Alertmanager","slug":"配置alertmanager","link":"#配置alertmanager","children":[]},{"level":2,"title":"验证","slug":"验证","link":"#验证","children":[]}],"relativePath":"pages/posts/k8s-kube-prometheus-probe-blackbox-exporter.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/k8s-kube-prometheus-probe-blackbox-exporter.md","lastUpdated":1679902831000}'),m={name:"pages/posts/k8s-kube-prometheus-probe-blackbox-exporter.md",data(){return{data:r,frontmatter:r.frontmatter}},setup(){u("pageData",r)}},h=s("p",null,"现有的k8s+prome环境是几年前部署的，所以当时版本的operator并不自带Blackbox_exporter CRD，所以有了这篇文章",-1),d=s("p",null,"最近有个工作需求是监控域名，实际上我自己玩的机器上早就监控着了，但工资这边貌似一直没有，好了开干吧",-1),b=s("blockquote",null,[s("p",null,"已有环境为Kubernetes+Kube-Prometheus（Prometheus-Operator项目更名为Kube-Prometheus）"),s("p",null,"Kubernetes v1.19.6"),s("p",null,"Kube-Prometheus 0.7.0")],-1),g=s("p",null,"在这里贴一张Kube-Prometheus项目对应支持的Kubernetes版本，如果您需要安装kube-prome的话，请优选最新版本",-1),f=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301142533409.png",alt:"image-20230301142533409"})],-1),k={id:"安装blackboxexporter",tabindex:"-1"},E=s("blockquote",null,[s("p",null,"该如何在现有环境下安装呢？我采用的办法是直接使用新版的blackbox crd文件即可，如果出现问题了，那就解决问题（结果就是一切顺利）")],-1),_=s("p",null,"或许你可以直接这样做,如果你的网络允许的话",-1),v=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"***")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"kubectl"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"apply"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-f"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://github.com/prometheus-operator/kube-prometheus/blob/release-"),s("span",{style:{color:"#F78C6C"}},"0.12"),s("span",{style:{color:"#C3E88D"}},"/manifests/blackboxExporter-service.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"***")]),l(`
`),s("span",{class:"line"})])])],-1),x=s("p",null,"安装成功之后，打开Prometheus WebUI，你会看到Target多了一个，不用惊慌，这是正常的表现，但如果五分钟内它是红色的，那你可以惊慌的",-1),B=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301144149533.png",alt:"image-20230301144149533"})],-1),w={id:"配置监控",tabindex:"-1"},P=s("blockquote",null,[s("p",null,"回想一下，在你刚学Prometheus的时候单击安装Blackbox，想要添加一个域名监控是否是直接去修改Prome的配置文件prometheus.yml？ 但现在是在k8s中的CRD，大人时代变了。"),s("p",null,"现在你想添加一个job，可并不是直接修改Prometheus配置文件了，当然你如果使用additional的话当我没说"),s("p",null,"你也并不能使用ServiceMonitor创建一个你以为的“job”，因为刚刚你安装的那些个CRD，把kind单独命名为了Prode")],-1),$=s("p",null,"就像这样，创建一个Prometheus监控黑盒的特殊“job”,然后创建",-1),z=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"vim blackboxExporter-probeDomain.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),S=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"apiVersion"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring.coreos.com/v1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"kind"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Probe")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"metadata"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"probe")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"namespace"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"spec"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"jobName"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"域名监控")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"prober"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 指定blackbox的地址")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"url"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"blackbox-exporter:19115")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"module"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"http_2xx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 配置文件中的检测模块")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 目标（可以是static配置也可以是ingress配置）")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# ingress <Object>")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"staticConfig"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 如果配置了 ingress，静态配置优先")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"namespaces"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#为什么加这个标签是因为后续我的alert配置里写了只对这个名称空间下的告警允许告警")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"static"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://www.vlinux.cn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"#该文件支持的其他字段和配置可以自行探索 kubectl explain probe.spec")]),l(`
`),s("span",{class:"line"})])])],-1),q=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"kubectl"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"apply"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-f"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"blackboxExporter-probeDomain.yaml")]),l(`
`),s("span",{class:"line"})])])],-1),M=s("p",null,"假如一切顺利，你就会在Promethes WebUI看到如下target新增，这证明你配置的很成功",-1),U=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301145914347.png",alt:"image-20230301145914347"})],-1),j=s("p",null,"如果你有Grafana，那么你已经可以在Grafana去做你想要的对应的面板了，比如这样",-1),K=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301150433056.png",alt:"image-20230301150433056"})],-1),N={id:"配置告警",tabindex:"-1"},R=s("p",null,"让我们捋一下如果想让这个域名一旦出现问题，就告警到钉钉需要几个关键步骤",-1),W=s("p",null,"Prometheus本身不支持发到钉钉应用，我们还需要安装Webhook 钩子，还需要在钉钉群里创建一个机器人。May be就这些",-1),I=s("p",null,"配置告警规则，配置钉钉WebHook和群机器人，配置Alertmanager，验证，完事儿",-1),L={id:"配置告警规则",tabindex:"-1"},O=s("p",null,"创建Rule CRD文件",-1),G=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"vim prometheus-blackboxRules.yaml"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"---")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"apiVersion"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring.coreos.com/v1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"kind"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"PrometheusRule")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"metadata"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"prometheus"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"k8s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"role"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"alert-rules")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"domain-rules")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"namespace"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"spec"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"groups"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"domain-rules")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"alert"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"黑盒监控状态")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"expr"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"probe_success == 0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"for"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"critical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#F07178"}},"namespace"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"annotations"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#F07178"}},"summary"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"黑盒探测失败,域名地址: {{ $labels.instance }}"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#F07178"}},"description"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"探测失败,探测值 = {{ $value }}"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#F07178"}},"recoverymessage"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"实例 {{ $labels.instance }} 已恢复正常监控"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"---")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"kubectl apply -f  prometheus-blackboxRules.yaml"),s("span",{style:{color:"#A6ACCD"}},"    ")]),l(`
`),s("span",{class:"line"})])])],-1),H=s("p",null,"创建后我们可以看到在WebUI的界面会新增一个规则",-1),T=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301152122827.png",alt:"image-20230301152122827"})],-1),X={id:"配置钉钉webhook和群机器人",tabindex:"-1"},Q=s("blockquote",null,[s("p",null,"在这里WebHook我们使用PrometheusAlert（全家桶）这个开源项目，方便就完事了"),s("p",null,"钉钉机器人的申请不再赘述，因为很简单，现在的机器人申请都需要添加关键词，记住了你的告警里面会发什么字就添加相应的关键词进去")],-1),V=s("p",null,[s("strong",null,"PrometheusAlert")],-1),J={id:"在k8s中安装全家桶",tabindex:"-1"},Z=s("blockquote",null,[s("p",null,"作者提供了相应的YAML，直接执行就好，执行前记得修改里面的配置文件，钉钉的tekon等等")],-1),Y=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"kubectl"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"apply"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-f"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://github.com/feiyu563/PrometheusAlert/blob/master/example/kubernetes/PrometheusAlert-Deployment.yaml")]),l(`
`),s("span",{class:"line"})])])],-1),ss=s("p",null,"访问部署好的全家桶，修改钉钉告警模版，像这样",-1),ls=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301153018566.png",alt:"image-20230301153018566"})],-1),os=s("p",null,"钉钉告警模版（这个模版的告警详情在下面）",-1),es=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," $var "),s("span",{style:{color:"#C3E88D"}},":="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},".externalURL}}{{"),s("span",{style:{color:"#A6ACCD"}}," $status "),s("span",{style:{color:"#C3E88D"}},":="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},".status}}{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"range"),s("span",{style:{color:"#A6ACCD"}}," $k"),s("span",{style:{color:"#C3E88D"}},","),s("span",{style:{color:"#A6ACCD"}},"$v"),s("span",{style:{color:"#C3E88D"}},":=.alerts"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"}}"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"{{if"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"eq"),s("span",{style:{color:"#A6ACCD"}}," $status "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"resolved"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"## [告警恢复-通知]({{$var}})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"#### 监控指标: {{$v.labels.alertname}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," eq $v.labels.severity"),s("span",{style:{color:"#89DDFF"}},' "'),s("span",{style:{color:"#C3E88D"}},"warning"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警级别: **<font color="#E6A23C">{{$v.labels.severity}}</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," eq $v.labels.severity"),s("span",{style:{color:"#89DDFF"}},' "'),s("span",{style:{color:"#C3E88D"}},"critical"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"  }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警级别: **<font color="#F56C6C">{{$v.labels.severity}}</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," end "),s("span",{style:{color:"#89DDFF"}},"}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 当前状态: **<font color="#67C23A" size=4>已恢复</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"#### 故障实例: {{$v.labels.instance}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"###### 开始时间: {{GetCSTtime $v.startsAt}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"###### 恢复时间: {{GetCSTtime $v.endsAt}}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警恢复: <font color="#67C23A">{{$v.annotations.recoverymessage}}</font>')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"## [监控告警-通知]({{$var}})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"#### 监控指标: {{$v.labels.alertname}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," eq $v.labels.severity"),s("span",{style:{color:"#89DDFF"}},' "'),s("span",{style:{color:"#C3E88D"}},"warning"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警级别: **<font color="#E6A23C" size=4>{{$v.labels.severity}}</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 当前状态: **<font color="#E6A23C">需要处理</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," eq $v.labels.severity"),s("span",{style:{color:"#89DDFF"}},' "'),s("span",{style:{color:"#C3E88D"}},"critical"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"  }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警级别: **<font color="#F56C6C" size=4>{{$v.labels.severity}}</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 当前状态: **<font color="#F56C6C">需要处理</font>**')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," end "),s("span",{style:{color:"#89DDFF"}},"}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"#### 故障实例: {{$v.labels.instance}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"###### 告警阈值: {{$v.annotations.description}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"###### 触发时间: {{GetCSTtime $v.startsAt}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," eq $v.labels.severity"),s("span",{style:{color:"#89DDFF"}},' "'),s("span",{style:{color:"#C3E88D"}},"warning"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警触发: <font color="#E6A23C">{{$v.annotations.summary}}</font>')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," eq $v.labels.severity"),s("span",{style:{color:"#89DDFF"}},' "'),s("span",{style:{color:"#C3E88D"}},"critical"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," }}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#### 告警触发: <font color="#F56C6C">{{$v.annotations.summary}}</font>')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," end "),s("span",{style:{color:"#89DDFF"}},"}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," end "),s("span",{style:{color:"#89DDFF"}},"}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{{"),s("span",{style:{color:"#A6ACCD"}}," end "),s("span",{style:{color:"#89DDFF"}},"}}")]),l(`
`),s("span",{class:"line"})])])],-1),ns={id:"配置alertmanager",tabindex:"-1"},as=s("p",null,"新建Alert配置CRD",-1),ts=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"vim"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"alertmanager-config.yaml")]),l(`
`),s("span",{class:"line"})])])],-1),rs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"apiVersion"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring.coreos.com/v1alpha1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"kind"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"AlertmanagerConfig")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"metadata"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"dinghook")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"namespace"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"monitoring")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"alertmanagerConfig"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"example")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"spec"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"receivers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Critical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"webhookConfigs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"url"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"http://prometheus-alert-center:8080/prometheusalert?type=dd&tpl=prometheus-dd&ddurl=https://oapi.dingtalk.com/robot/send?access_token=e3c0bc10f8********")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"sendResolved"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FF9CAC"}},"true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"groupBy"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"job"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"groupWait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"30s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"groupInterval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"repeatInterval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"12h")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Critical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"routes"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Critical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"match"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"critical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"namespace"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"default")]),l(`
`),s("span",{class:"line"})])])],-1),cs=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"kubectl"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"apply"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-f"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"alertmanager-config.yaml")]),l(`
`),s("span",{class:"line"})])])],-1),ps=s("p",null,"创建后你可以访问Alertmanger的Web界面看看你是否修改成功，他会自动加载配置文件的",-1),is={id:"验证",tabindex:"-1"},ys=s("p",null,"我使用的是我自己的域名，所以我停掉，并且恢复就可以验证，告警和恢复是否发出了。下面放一张恢复的样子。",-1),Ds=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20230301153036377.png",alt:"image-20230301153036377"})],-1),Cs=s("p",null,"文章就到这里，如有疑问，请直接点击微信联系我",-1),As=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"ssh-rsa"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"AAAAB3NzaC1yc2EAAAADAQABAAABgQC4+hofFobukwiaECjTrKm3dNjmP2cFiOFCgkbU0Eg/Ot6BtCkk+Lu9OyRwJs/vELor42CSliNS1uAXqlh3a4vc4c0BvqBSLmuv2kNpm+FjlSB3JbElp2thW5Ris+Q+TuIFd7XfBjX9zZgm2swrumgpinPtHu31lH/lr472C5mjxjv20KmZUasoZ0lFZVWox9dqCq/UPCK1Zv4XeUHESSjT+8cHPsMa36Vej3W29YOzMMnCT70vIVqcM6LYS/5odyiuc+ofCJS0mIuKRG2mPh4f6owSID/xIKW6bX0Qo7M4b6z7lu6xJczzrOrif/47FBzNfzD+Mt3ww7BAi+tPs5Mr3ynZDMeMSeLk3aNtYMtOCwyCI0toxTr+SjMzHKzKJdE0K/f+lloGkC/c7zfIGB+TwO1eHYFoFf0ALyftExioUbJOmflBAgdiFaLfudxu/fCXZenGpCm9D+XhIlFu+lpsViu255xwy18nJNkvgapU7tukgOSyydUiD1kAl+L/NCc="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"jenkins@025447547acc")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"ssh-rsa"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"AAAAB3NzaC1yc2EAAAADAQABAAABgQDQnmdriCxU7jQzBBg6vCyUKzI102UJpTWBJ6xa8jnpTXzBi8XBMtq96PbWKCp2N+33wNjcGMfIOHXxokomIzmMtHMFP7F9AHLLYQuARoP43cby9/HSS5qXEEpWL2b2X9wh2zIbY96pcCwX7zW9wMofS4AiWZIn/5bzG/qriobCuQKXO+UnmRLGUfGv9BYoGdNFyyMfaZc3JMRugSD9LIdqXvoCcmFp+PHV1ErKrDMLAN4mBc4bdRnU3SYtpnb/tEd6TCrUyze4zQ0TkdDyXfZpytLSAk39BRBR/PSnYiQoWirEixmQb5Y5Ru6Pe4MGwfJL4t5mQ7iIf2U9S1eq1+z4p92/jUr45F9rARt2pu1GOo/xOIndK7el4aRUVKL5oXimzuGH7XTyHL4wwdtYQQP1dWF391iNbD7eEAXB8PVdbV5mo6HwLoAg2aKRIqNyin7zdqA6bm+vtk8CtQfdx6yWL6W18ceSqNgz2GvG8FjPa0uuryIN8njzCKZVCqlvdTk="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root@025447547acc")]),l(`
`),s("span",{class:"line"})])])],-1);function Fs(a,us,ms,hs,c,ds){const e=F,p=i;return C(),D(p,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":o(()=>[h,d,A(" more "),b,g,f,s("h1",k,[l("安装"),n(e,{href:"https://github.com/prometheus-operator/kube-prometheus/blob/release-0.12/manifests/blackboxExporter-service.yaml",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("blackboxExporter")]),_:1}),l(),n(e,{class:"header-anchor",href:"#安装blackboxexporter","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),E,s("p",null,[l("在这个"),n(e,{href:"https://github.com/prometheus-operator/kube-prometheus/tree/release-0.12/manifests",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("地址")]),_:1}),l("中找到所有blackboxExporter开头的文件，安装它")]),_,v,x,B,s("h1",w,[l("配置监控 "),n(e,{class:"header-anchor",href:"#配置监控","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),P,$,z,S,q,M,U,j,K,s("h1",N,[l("配置告警 "),n(e,{class:"header-anchor",href:"#配置告警","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),R,W,I,s("h2",L,[l("配置告警规则 "),n(e,{class:"header-anchor",href:"#配置告警规则","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),O,G,H,T,s("h2",X,[l("配置钉钉WebHook和群机器人 "),n(e,{class:"header-anchor",href:"#配置钉钉webhook和群机器人","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Q,V,s("p",null,[l("文档地址："),n(e,{href:"https://feiyu563.github.io/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://feiyu563.github.io/")]),_:1})]),s("p",null,[l("Github地址："),n(e,{href:"https://github.com/feiyu563/PrometheusAlert",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://github.com/feiyu563/PrometheusAlert")]),_:1})]),s("h3",J,[l("在k8s中安装全家桶 "),n(e,{class:"header-anchor",href:"#在k8s中安装全家桶","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Z,Y,ss,ls,os,es,s("h2",ns,[l("配置Alertmanager "),n(e,{class:"header-anchor",href:"#配置alertmanager","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),as,ts,rs,cs,ps,s("h2",is,[l("验证 "),n(e,{class:"header-anchor",href:"#验证","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),ys,Ds,Cs,As,s("p",null,[l("智慧巴士后端接口测试失败，请处理。Jenkins地址："),n(e,{href:"http://10.99.102.11:8081/view/Monitor/job/bus-platform/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("http://10.99.102.11:8081/view/Monitor/job/bus-platform/")]),_:1})])]),"main-header":o(()=>[t(a.$slots,"main-header")]),"main-header-after":o(()=>[t(a.$slots,"main-header-after")]),"main-nav":o(()=>[t(a.$slots,"main-nav")]),"main-content":o(()=>[t(a.$slots,"main-content")]),"main-content-after":o(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":o(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":o(()=>[t(a.$slots,"main-nav-after")]),comment:o(()=>[t(a.$slots,"comment")]),footer:o(()=>[t(a.$slots,"footer")]),aside:o(()=>[t(a.$slots,"aside")]),"aside-custom":o(()=>[t(a.$slots,"aside-custom")]),default:o(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter","data"])}const vs=y(m,[["render",Fs]]);export{_s as __pageData,vs as default};
