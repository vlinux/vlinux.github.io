import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-e7d89830.js";import{_ as d,c as y,w as l,o as C,b as a,d as s,e as n,r as t,f as D,p as h}from"./app-4d89398e.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-2ca9ab31.js";import"./YunCard.vue_vue_type_style_index_0_lang-4f49289b.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-a8598bd1.js";const ja=JSON.parse('{"title":"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信","description":"","frontmatter":{"title":"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信","categories":"Grafana","tags":["Grafana","腾讯云监控"],"date":"2022-01-26T16:18:23.000Z"},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"设计","slug":"设计","link":"#设计","children":[]},{"level":2,"title":"开始","slug":"开始","link":"#开始","children":[{"level":3,"title":"安装Grafana","slug":"安装grafana","link":"#安装grafana","children":[]},{"level":3,"title":"配置Grafana腾讯云监控数据源","slug":"配置grafana腾讯云监控数据源","link":"#配置grafana腾讯云监控数据源","children":[]},{"level":3,"title":"Grafana-image-renderer插件安装","slug":"grafana-image-renderer插件安装","link":"#grafana-image-renderer插件安装","children":[]},{"level":3,"title":"安装Grafana-report生成PDF文件","slug":"安装grafana-report生成pdf文件","link":"#安装grafana-report生成pdf文件","children":[]}]},{"level":2,"title":"生成图片或导出PDF发送至企业微信","slug":"生成图片或导出pdf发送至企业微信","link":"#生成图片或导出pdf发送至企业微信","children":[{"level":3,"title":"图片生成","slug":"图片生成","link":"#图片生成","children":[]},{"level":3,"title":"PDF文件生成","slug":"pdf文件生成","link":"#pdf文件生成","children":[]}]}],"relativePath":"pages/posts/Grafana-Tencent-Exporter-Image-Send-Wechat.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Grafana-Tencent-Exporter-Image-Send-Wechat.md","lastUpdated":1673509249000}'),r=JSON.parse('{"title":"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信","description":"","frontmatter":{"title":"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信","categories":"Grafana","tags":["Grafana","腾讯云监控"],"date":"2022-01-26T16:18:23.000Z"},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"设计","slug":"设计","link":"#设计","children":[]},{"level":2,"title":"开始","slug":"开始","link":"#开始","children":[{"level":3,"title":"安装Grafana","slug":"安装grafana","link":"#安装grafana","children":[]},{"level":3,"title":"配置Grafana腾讯云监控数据源","slug":"配置grafana腾讯云监控数据源","link":"#配置grafana腾讯云监控数据源","children":[]},{"level":3,"title":"Grafana-image-renderer插件安装","slug":"grafana-image-renderer插件安装","link":"#grafana-image-renderer插件安装","children":[]},{"level":3,"title":"安装Grafana-report生成PDF文件","slug":"安装grafana-report生成pdf文件","link":"#安装grafana-report生成pdf文件","children":[]}]},{"level":2,"title":"生成图片或导出PDF发送至企业微信","slug":"生成图片或导出pdf发送至企业微信","link":"#生成图片或导出pdf发送至企业微信","children":[{"level":3,"title":"图片生成","slug":"图片生成","link":"#图片生成","children":[]},{"level":3,"title":"PDF文件生成","slug":"pdf文件生成","link":"#pdf文件生成","children":[]}]}],"relativePath":"pages/posts/Grafana-Tencent-Exporter-Image-Send-Wechat.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Grafana-Tencent-Exporter-Image-Send-Wechat.md","lastUpdated":1673509249000}'),f={name:"pages/posts/Grafana-Tencent-Exporter-Image-Send-Wechat.md",data(){return{data:r,frontmatter:r.frontmatter}},setup(){h("pageData",r)}},A={id:"背景",tabindex:"-1"},g=a("blockquote",null,[a("p",null,"公司的服务资源几乎都在腾讯云上,现在客户需求每天看到服务器和部分服务的使用报告")],-1),u=a("p",null,"经过一番查询发现还是有方法实现的(在不写代码的情况下,这里指出了shell以外的任何代码)",-1),_={id:"设计",tabindex:"-1"},m=a("p",null,"首先我们需要有Grafana,这样才能用于展示,调试等操作",-1),F=a("p",null,"其次数据源我们可以直接使用腾讯云研发的基于Grafana的插件,使用该插件. 作用就是可以把你的Grafana数据源设置为腾讯云监控. 也就是说你在腾讯云监控界面能看到什么,经过一番不太困难的设置,你在Grafana里也同样能达到效果",-1),E=a("p",null,"将Grafana的Panel变成图片,我们可以使用grafana-image-renderer插件(玩起来颇吃力)",-1),v=a("p",null,"将Grafana的Dashboard变成PDF,我们可以使用Grafana-report",-1),b=a("p",null,"最后就是将生成的图片或者PDF发送至企业微信,在最下面我会贴出我写的脚本,你只需要拿去直接用就可以了",-1),k=a("ul",null,[a("li",null,"部署Grafana"),a("li",null,"安装Tencent Cloud Monitoring和grafana-image-renderer插件"),a("li",null,"安装Grafana-report生成PDF文件"),a("li",null,"脚本定时发送运维日报(PDF文件或图片)至企业微信")],-1),G={id:"开始",tabindex:"-1"},x={id:"安装grafana",tabindex:"-1"},w=a("p",null,"接下来我们就来安装 Grafana，Grafana 本身是非常轻量级的，不会占用大量资源，此外 Grafana 需要一个数据库来存储其配置数据，比如用户、数据源和仪表盘等，目前 Grafana 支持 SQLite、MySQL、PostgreSQL 3 种数据库，默认使用的是 SQLite，该数据库文件会存储在 Grafana 的安装位置，所以需要对 Grafana 的安装目录进行持久化。",-1),P=a("div",{class:"language-"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"wget https://dl.grafana.com/oss/release/grafana-8.2.1-1.x86_64.rpm")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"yum install grafana-8.2.1-1.x86_64.rpm")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})])])])],-1),B=a("p",null,"安装完成后我们就可以使用 systemd 来管理 Grafana：",-1),I=a("div",{class:"language-"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"systemctl daemon-reload")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"systemctl enable grafana-server")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"systemctl start grafana-server")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"systemctl status grafana-server")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})])])])],-1),$=a("p",null,[s("默认的启动配置环境变量位于 "),a("code",null,"/etc/sysconfig/grafana-server"),s(" 文件中：")],-1),S=a("div",{class:"language-"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"cat /etc/sysconfig/grafana-server")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"GRAFANA_USER=grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"GRAFANA_GROUP=grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"GRAFANA_HOME=/usr/share/grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"LOG_DIR=/var/log/grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"DATA_DIR=/var/lib/grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"MAX_OPEN_FILES=10000")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"CONF_DIR=/etc/grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"CONF_FILE=/etc/grafana/grafana.ini")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"RESTART_ON_UPGRADE=true")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"PLUGINS_DIR=/var/lib/grafana/plugins")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"PROVISIONING_CFG_DIR=/etc/grafana/provisioning")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"# Only used on systemd systems")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"PID_FILE_DIR=/var/run/grafana")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})])])])],-1),z=a("p",null,"从上面文件中可以找到 Grafana 的各种数据配置路径，比如数据目录、日志目录、插件目录等等，正常启动完成后 Grafana 会监听在 3000 端口上，所以我们可以在浏览器中打开 Grafana 的 WebUI。",-1),q=a("p",null,[s("默认的用户名和密码为 "),a("code",null,"admin"),s("，也可以在配置文件 "),a("code",null,"/etc/grafana/grafana.ini"),s(" 中配置 "),a("code",null,"admin_user"),s(" 和 "),a("code",null,"admin_password"),s(" 两个参数来进行覆盖。")],-1),T=a("p",null,[s("当然如果我们想要部署一个高可用版本的 Grafana 的话，那么使用 SQLite 数据库就不行了，需要切换到 MySQL 或者 PostgreSQL，我们可以在 Grafana 配置的 "),a("code",null,"[database]"),s(" 部分找到数据库的相关配置，Grafana 会将所有长期数据保存在数据库中，然后部署多个 Grafana 实例使用同一个数据库即可实现高可用。")],-1),W={id:"配置grafana腾讯云监控数据源",tabindex:"-1"},N=a("blockquote",null,[a("p",null,[s("腾讯云监控 为用户提供云服务器、云数据库等多个云产品的负载和性能监控指标，用户可以使用云监控控制台、云监控 API 等方式获取相关监控数据。腾讯云监控应用插件 Tencent Cloud Monitor "),a("strong",null,"App，是一款适配开源软件 Grafana 的应用插件，通过调用 腾讯云监控 API 3.0的方式获取监控数据，并对数据进行自定义 Dashboard 展示。")])],-1),R=a("p",null,"使用 Grafana CLI 安装：",-1),O=a("div",{class:"language-"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"grafana-cli plugins install tencentcloud-monitor-app")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})])])])],-1),L=a("p",null,"安装后重启Grafana",-1),M=a("div",{class:"language-bash"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"systemctl"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"restart"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"grafana-server")]),s(`
`),a("span",{class:"line"})])])],-1),j=a("blockquote",null,[a("p",null,"访问Grafana配置数据源,在此之前,您需要在腾讯云API管理中心创建属于你自己的Sercetkey.")],-1),U=a("blockquote",null,[a("p",null,"Grafana在配置数据源的时候需要使用该key进行认证.")],-1),Q=a("p",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112151154005.png#mirages-width=1920&mirages-height=940&mirages-cdn-type=5",alt:"image-20220112151154005"})],-1),V=a("p",null,"在Grafana插件中打开该应用,然后在数据源中进行配置",-1),Y=a("p",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112151259213.png#mirages-width=1920&mirages-height=640&mirages-cdn-type=5",alt:"image-20220112151259213"})],-1),Z=a("p",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112151417057.png#mirages-width=1920&mirages-height=937&mirages-cdn-type=5",alt:"image-20220112151417057"})],-1),H=a("p",null,"配置后好点击最下方得Save&Test就可以了.这时候你就可以在Grafana中查看你在腾讯云中得服务资源监控了.",-1),J={id:"grafana-image-renderer插件安装",tabindex:"-1"},K=a("blockquote",null,[a("p",null,"该插件自己安装会报错比较多,推荐使用Docker启动,因为我机器上默认已经安装好了Docker所以就不再放安装Docker得文档了"),a("p",null,"该方法是采用插件和Grafana主体分离的形式运行的,以防生成图片过大时机器过载")],-1),X=a("p",null,"运行",-1),aa=a("div",{class:"language-"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"docker pull grafana/grafana-image-renderer")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"docker run -d --name=render --network=host --restart=always -e BROWSER_TZ=Asia/Shanghai grafana/grafana-image-renderer")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})])])])],-1),sa=a("p",null,"在Grafana中配置插件地址",-1),la=a("div",{class:"language-"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"vim /etc/grafana/grafana.ini")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"#修改以下内容")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"[rendering]")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"server_url = http://你的Grafana插件地址:8081/render")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"callback_url = http://你的grafana地址:3000/")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"#字符改成zh；支持中文")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"rendering_language = zh")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}})])])])],-1),ea=a("p",null,"重启Grafana使配置生效",-1),na=a("div",{class:"language-bash"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"systemctl"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"restart"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"grafana-server")]),s(`
`),a("span",{class:"line"})])])],-1),oa=a("p",null,"任选一Panel,点击Share,点击拍照图标即可生成该Panel图片",-1),ta=a("p",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112152306485.png#mirages-width=939&mirages-height=372&mirages-cdn-type=5",alt:"image-20220112152306485"})],-1),ra=a("p",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112152355044.png#mirages-width=870&mirages-height=476&mirages-cdn-type=5",alt:"image-20220112152355044"})],-1),ca={id:"安装grafana-report生成pdf文件",tabindex:"-1"},ia=a("blockquote",null,[a("p",null,"我尝试过Docker启动该服务,不过后来因各种报错和依赖放弃了,于是打算自己下载项目直接运行该服务.")],-1),pa=a("p",null,"安装该服务相关依赖,解决后续可能会出现的不显示中文,中文乱码,或者因为字体报错而无法生成文件等情况,在这之前你需要配置好Yum源,Base和epel",-1),da=a("div",{class:"language-bash"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"yum"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"install"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"go"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"git"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-pdftex"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-latex-bin"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-texconfig"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-latex"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-metafont"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-cmap"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-ec"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-fncychap"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-pdftex-def"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-fancyhdr"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-titlesec"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-multirow"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-framed"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-wrapfig"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-parskip"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-caption"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-ifluatex"),a("span",{style:{color:"#A6ACCD"}},"*"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-collection-fontsrecommended"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texlive-collection-latexrecommended"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"texinfo-tex")]),s(`
`),a("span",{class:"line"})])])],-1),ya=a("p",null,"编译该程序",-1),Ca=a("div",{class:"language-bash"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"go"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"get"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"github.com/IzakMarais/reporter/...")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"go"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"install"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"-v"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"github.com/IzakMarais/reporter/cmd/grafana-reporter")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"go/bin/grafana-reporter"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"-ip"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"ip:"),a("span",{style:{color:"#F78C6C"}},"8686"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"（会开启8686端口）")]),s(`
`),a("span",{class:"line"})])])],-1),Da=a("p",null,"因为该插件是以匿名方式访问Grafana所产生PDF文件的,所以在Grafana中我们还需要打开匿名访问的权限.",-1),ha=a("p",null,"编辑grafana.ini",-1),fa=a("div",{class:"language-ini"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#################################### Anonymous Auth ######################")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#89DDFF"}},"[auth.anonymous]")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"# enable anonymous access")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#F07178"}},"enabled"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#A6ACCD"}}," true")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," ")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"# specify organization name that should be used for unauthenticated users")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},";org_name = Main Org.")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," ")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"# specify role for unauthenticated users")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#F07178"}},"org_role"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#A6ACCD"}}," Viewer")]),s(`
`),a("span",{class:"line"})])])],-1),Aa=a("p",null,"重启Grafana以生效",-1),ga=a("div",{class:"language-shell"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"systemctl"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"restart"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"grafana-server")]),s(`
`),a("span",{class:"line"})])])],-1),ua={id:"生成图片或导出pdf发送至企业微信",tabindex:"-1"},_a={id:"图片生成",tabindex:"-1"},ma=a("p",null,"上面安装的时候我们演示了如何对一个Panel生成图片,那如何对一个dashboard也生成一个图片呢?",-1),Fa=a("p",null,"官网的说法是: 不支持",-1),Ea=a("p",null,"但我问了很多大佬,最终找到了好用的方法.",-1),va=a("p",null,"既然Panel可以生成,那我们直接拼接Panel的链接不就好了.",-1),ba=a("p",null,"假如你的Dashboard的链接是这样的",-1),ka=a("p",null,"那么你的图片生成链接就是这样子的",-1),Ga=a("p",null,"如果图片的长宽或者显示图表时常你不满意,也可以通过修改参数来更改 from,width,height.",-1),xa={id:"pdf文件生成",tabindex:"-1"},wa=a("p",null,"假如你的Dashboard的链接是这样的",-1),Pa=a("p",null,"那么你的PDF生成链接就是这样子的",-1),Ba=a("blockquote",null,[a("p",null,"定时发送运维日报文件PDF到企业微信机器人脚本如下")],-1),Ia=a("p",null,"请根据自身情况合适修改,如修改企业微信机器人提供的KEY等",-1),$a=a("div",{class:"language-shell"},[a("span",{class:"copy"}),a("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[a("code",null,[a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#**********************************************************")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#作者: Vlinux")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#最新修改: 2022-01-12 16:43")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#文件名: wxbot_sendfile.sh")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#描述: 自动发送服务器指定文件到企业微信群聊机器人")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#**********************************************************")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#!/bin/bash")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"time"),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#89DDFF"}},"$("),a("span",{style:{color:"#FFCB6B"}},"date"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},'"'),a("span",{style:{color:"#C3E88D"}},"+%Y%m%d"),a("span",{style:{color:"#89DDFF"}},'")')]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"wget"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"-O"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"/opt/devops/运维日报"),a("span",{style:{color:"#89DDFF"}},"$("),a("span",{style:{color:"#FFCB6B"}},"date"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},'"'),a("span",{style:{color:"#C3E88D"}},"+%Y%m%d"),a("span",{style:{color:"#89DDFF"}},'")'),a("span",{style:{color:"#C3E88D"}},".pdf"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"http://GrafanaIP:"),a("span",{style:{color:"#F78C6C"}},"8686"),a("span",{style:{color:"#C3E88D"}},"/api/v5/report/G3PSmI17k")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#---------------------------------------------------修改部分-----------------------------------")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"Webhook"),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#C3E88D"}},"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=a3114e-"),a("span",{style:{color:"#F78C6C"}},"9708"),a("span",{style:{color:"#C3E88D"}},"--"),a("span",{style:{color:"#F78C6C"}},"8135"),a("span",{style:{color:"#C3E88D"}},"-6941761ffb08")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"file_dir"),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#C3E88D"}},"/opt/devops/运维日报"),a("span",{style:{color:"#89DDFF"}},"${"),a("span",{style:{color:"#A6ACCD"}},"time"),a("span",{style:{color:"#89DDFF"}},"}"),a("span",{style:{color:"#C3E88D"}},".pdf"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#676E95","font-style":"italic"}},"#文件所在目录")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#82AAFF"}},"echo"),a("span",{style:{color:"#A6ACCD"}}," $file_dir")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#676E95","font-style":"italic"}},"#----------------------------------------------------END--------------------------------------")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"key"),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#89DDFF"}},"$("),a("span",{style:{color:"#82AAFF"}},"echo"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#A6ACCD"}},"$Webhook"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},"|"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#FFCB6B"}},"awk"),a("span",{style:{color:"#C3E88D"}}," -F = "),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}},"{print $2}"),a("span",{style:{color:"#89DDFF"}},"')")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),a("span",{style:{color:"#A6ACCD"}}," test -s $file_dir"),a("span",{style:{color:"#89DDFF"}},";"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#89DDFF","font-style":"italic"}},"then")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," file_id"),a("span",{style:{color:"#89DDFF"}},"="),a("span",{style:{color:"#89DDFF"}},"`"),a("span",{style:{color:"#FFCB6B"}},"curl"),a("span",{style:{color:"#C3E88D"}}," -s -F media=@"),a("span",{style:{color:"#A6ACCD"}},"$file_dir"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},'"'),a("span",{style:{color:"#C3E88D"}},"https://qyapi.weixin.qq.com/cgi-bin/webhook/upload_media?key="),a("span",{style:{color:"#A6ACCD"}},"$key"),a("span",{style:{color:"#C3E88D"}},"&amp;type=file"),a("span",{style:{color:"#89DDFF"}},'"'),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},"|")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#FFCB6B"}},"awk"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}},"END{print}"),a("span",{style:{color:"#89DDFF"}},"'|"),a("span",{style:{color:"#FFCB6B"}},"awk"),a("span",{style:{color:"#C3E88D"}}," -F "),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}},'"'),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}}," "),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}},"{print $14}"),a("span",{style:{color:"#89DDFF"}},"'`")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}},"   "),a("span",{style:{color:"#89DDFF","font-style":"italic"}},"else")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#82AAFF"}},"echo"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"未检测到文件，脚本退出")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#82AAFF"}},"exit"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#F78C6C"}},"1")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#89DDFF","font-style":"italic"}},"fi")]),s(`
`),a("span",{class:"line"}),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#FFCB6B"}},"curl"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#89DDFF"}},"${"),a("span",{style:{color:"#A6ACCD"}},"Webhook"),a("span",{style:{color:"#89DDFF"}},"}"),a("span",{style:{color:"#A6ACCD"}}," \\")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"-H"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}},"Content-Type: application/json"),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#A6ACCD"}}," \\")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#C3E88D"}},"-d"),a("span",{style:{color:"#A6ACCD"}}," "),a("span",{style:{color:"#89DDFF"}},"'")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}}," {")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}},' "msgtype": "file",')]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}},' "file": {')]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}},' "media_id": "'),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#A6ACCD"}},"$file_id"),a("span",{style:{color:"#89DDFF"}},"'"),a("span",{style:{color:"#C3E88D"}},'"')]),s(`
`),a("span",{class:"line"}),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}}," }")]),s(`
`),a("span",{class:"line"},[a("span",{style:{color:"#C3E88D"}}," }"),a("span",{style:{color:"#89DDFF"}},"'")]),s(`
`),a("span",{class:"line"})])])],-1);function Sa(o,za,qa,Ta,c,Wa){const e=D,i=p;return C(),y(i,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":l(()=>[a("h2",A,[s("背景 "),n(e,{class:"header-anchor",href:"#背景","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),g,u,a("h2",_,[s("设计 "),n(e,{class:"header-anchor",href:"#设计","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),m,F,E,v,b,k,a("h2",G,[s("开始 "),n(e,{class:"header-anchor",href:"#开始","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),a("h3",x,[s("安装Grafana "),n(e,{class:"header-anchor",href:"#安装grafana","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),w,a("p",null,[s("要安装 Grafana 的方式有很多，我们这里使用的是 CentOS 系统，可以在 Grafana 官方下载页面筛选合适的版本 "),n(e,{href:"https://grafana.com/grafana/download?edition=oss&platform=linux",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("https://grafana.com/grafana/download?edition=oss&platform=linux")]),_:1}),s(" 根据自己的需求来进行安装，比如我们这里直接使用 rpm 包进行安装：")]),P,B,I,$,S,z,q,T,a("h3",W,[s("配置Grafana腾讯云监控数据源 "),n(e,{class:"header-anchor",href:"#配置grafana腾讯云监控数据源","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),N,a("p",null,[s("参考Github项目地址:"),n(e,{href:"https://github.com/TencentCloud/tencentcloud-monitor-grafana-app",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("https://github.com/TencentCloud/tencentcloud-monitor-grafana-app")]),_:1})]),R,O,L,M,j,U,Q,V,Y,Z,H,a("h3",J,[s("Grafana-image-renderer插件安装 "),n(e,{class:"header-anchor",href:"#grafana-image-renderer插件安装","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),K,X,aa,sa,la,ea,na,oa,ta,ra,a("h3",ca,[s("安装Grafana-report生成PDF文件 "),n(e,{class:"header-anchor",href:"#安装grafana-report生成pdf文件","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),ia,pa,da,ya,Ca,Da,ha,fa,Aa,ga,a("h2",ua,[s("生成图片或导出PDF发送至企业微信 "),n(e,{class:"header-anchor",href:"#生成图片或导出pdf发送至企业微信","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),a("h3",_a,[s("图片生成 "),n(e,{class:"header-anchor",href:"#图片生成","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),ma,Fa,Ea,va,ba,a("p",null,[n(e,{href:"http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1")]),_:1})]),ka,a("p",null,[n(e,{href:"http://GrafanaIP:3000/render/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1&from=now-1h&to=now&width=1600&height=100000",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("http://GrafanaIP:3000/render/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1&from=now-1h&to=now&width=1600&height=100000")]),_:1})]),Ga,a("blockquote",null,[a("p",null,[s("发送图片至企业微信机器人请借鉴:"),n(e,{href:"https://www.jianshu.com/p/f1a0cbd13a70",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("https://www.jianshu.com/p/f1a0cbd13a70")]),_:1})])]),a("h3",xa,[s("PDF文件生成 "),n(e,{class:"header-anchor",href:"#pdf文件生成","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),wa,a("p",null,[n(e,{href:"http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1")]),_:1})]),Pa,a("p",null,[n(e,{href:"http://GrafanaIP:8686/api/v5/report/9CWBz0bik",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("http://GrafanaIP:8686/api/v5/report/9CWBz0bik")]),_:1})]),Ba,Ia,$a]),"main-header":l(()=>[t(o.$slots,"main-header")]),"main-header-after":l(()=>[t(o.$slots,"main-header-after")]),"main-nav":l(()=>[t(o.$slots,"main-nav")]),"main-content":l(()=>[t(o.$slots,"main-content")]),"main-content-after":l(()=>[t(o.$slots,"main-content-after")]),"main-nav-before":l(()=>[t(o.$slots,"main-nav-before")]),"main-nav-after":l(()=>[t(o.$slots,"main-nav-after")]),comment:l(()=>[t(o.$slots,"comment")]),footer:l(()=>[t(o.$slots,"footer")]),aside:l(()=>[t(o.$slots,"aside")]),"aside-custom":l(()=>[t(o.$slots,"aside-custom")]),default:l(()=>[t(o.$slots,"default")]),_:3},8,["frontmatter","data"])}const Ua=d(f,[["render",Sa]]);export{ja as __pageData,Ua as default};
