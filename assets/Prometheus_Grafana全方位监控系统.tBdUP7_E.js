import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang.C2bsXNP9.js";import"./chunks/@vueuse/motion.BITvz5PP.js";import{e as c,u as o,a as y}from"./chunks/vue-router.DESBU8cS.js";import{aa as u,ap as l,ag as h,af as i,ai as s,P as m,ab as F,a1 as b}from"./framework.GHZxz7jq.js";import"./index.fe-YlSh0.js";import"./chunks/dayjs.BldX5ftQ.js";import"./chunks/vue-i18n.C7V8WoQZ.js";import"./chunks/pinia.BfAlK2F6.js";import"./chunks/nprogress.BZwbcB2O.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.Bfmmp6N5.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.fblE3Fel.js";import"./post.Dv7YwUny.js";const C=c("/posts/Prometheus+Grafana全方位监控系统",async t=>JSON.parse('{"title":"Prometheus+Grafana全方位监控系统","description":"","frontmatter":{"title":"Prometheus+Grafana全方位监控系统","categories":"DevOps","tags":["Prometheus"],"date":"2020-08-30 16:38:00"},"headers":[],"relativePath":"pages/posts/Prometheus+Grafana全方位监控系统.md","lastUpdated":null}'),{lazy:(t,e)=>t.name===e.name}),T={__name:"Prometheus+Grafana全方位监控系统",setup(t,{expose:e}){const{data:k}=C(),E=y(),p=o(),n=Object.assign(p.meta.frontmatter||{},k.value?.frontmatter||{});return E.currentRoute.value.data=k.value,b("valaxy:frontmatter",n),globalThis.$frontmatter=n,e({frontmatter:{title:"Prometheus+Grafana全方位监控系统",categories:"DevOps",tags:["Prometheus"],date:"2020-08-30 16:38:00"}}),(a,r)=>{const g=d;return F(),u(g,{frontmatter:m(n)},{"main-content-md":l(()=>[...r[0]||(r[0]=[i("h1",{id:"prometheus-grafana全方位监控系统",tabindex:"-1"},[s("Prometheus+Grafana全方位监控系统 "),i("a",{class:"header-anchor",href:"#prometheus-grafana全方位监控系统","aria-label":'Permalink to "Prometheus+Grafana全方位监控系统"'},"​")],-1),i("p",null,[i("code",null,"emmm"),s("，前段时间写了一篇关于使用"),i("code",null,"Prometheus+grafana+node-exporter"),s("监控"),i("code",null,"k8s"),s("的文章，那篇写的很简单，只是单纯的搭建出来了，目前我对这东西一点都不了解，所以先来了解一下"),i("code",null,"Prometheus"),s("和他常用的组件吧，包括"),i("code",null,"Prometheus/Grafana/node-exports/Alertmanager"),s("，开始吧。")],-1),i("p",null,[s("本文包括"),i("code",null,"Prometheus"),s("概述、部署、配置、监控、告警、之前我做监控用的都是"),i("code",null,"zabbix"),s("，"),i("code",null,"zabbix"),s("也算是一个全面型的监控系统，但是他不太适合容器监控，他对容器监控集成欠缺很多，他比较偏向于非容器监控。")],-1),i("p",null,[i("code",null,"Prometheus"),s("算是一个全能型选手，原生支持容器监控，当然监控传统应用也不是吃干饭的，所以就是容器和非容器他都支持，所有的监控系统都具备这个流程，数据采集→数据处理→数据存储→数据展示→告警，本文就是针对"),i("code",null,"Prometheus"),s("展开的，所以先看看"),i("code",null,"Prometheus"),s("概述")],-1),i("h2",{id:"prometheus概述",tabindex:"-1"},[s("Prometheus概述 "),i("a",{class:"header-anchor",href:"#prometheus概述","aria-label":'Permalink to "Prometheus概述"'},"​")],-1),i("p",null,[s("先来看一下"),i("code",null,"Prometheus"),s("是个啥")],-1),i("h3",{id:"prometheus是什么",tabindex:"-1"},[s("Prometheus是什么 "),i("a",{class:"header-anchor",href:"#prometheus是什么","aria-label":'Permalink to "Prometheus是什么"'},"​")],-1),i("p",null,[s("中文名普罗米修斯，最初在"),i("code",null,"SoundCloud"),s("上构建的监控系统，自"),i("code",null,"2012"),s("年成为社区开源项目，用户非常活跃的开发人员和用户社区，2016年加入"),i("code",null,"CNCF"),s("，成为继"),i("code",null,"kubernetes"),s("之后的第二个托管项目，"),i("a",{href:"https://prometheus.io/",target:"_blank",rel:"noreferrer"},"官方网站")],-1),i("h3",{id:"prometheus特点",tabindex:"-1"},[s("Prometheus特点 "),i("a",{class:"header-anchor",href:"#prometheus特点","aria-label":'Permalink to "Prometheus特点"'},"​")],-1),i("p",null,"官方扒过来的",-1),i("ul",null,[i("li",null,"多维数据模型：由度量名称和键值对标识的时间序列数据"),i("li",null,"PromSQL: —种灵活的查询语言，可以利用多维数据完成复杂的查询"),i("li",null,"不依赖分布式存储，单个服务器节点可直接工作"),i("li",null,"基于HTTP的pull方式釆集时间序列数据"),i("li",null,"推送时间序列数据通过PushGateway组件支持"),i("li",null,"通过服务发现或静态配罝发现目标"),i("li",null,"多种图形模式及仪表盘支持(grafana)")],-1),i("h3",{id:"prometheus-组成与架构",tabindex:"-1"},[s("Prometheus 组成与架构 "),i("a",{class:"header-anchor",href:"#prometheus-组成与架构","aria-label":'Permalink to "Prometheus 组成与架构"'},"​")],-1),i("p",null,"来看一张图，官方扒到的",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702133835.png#mirages-width=774&mirages-height=462&mirages-cdn-type=5",alt:"20190702133835",loading:"lazy",decoding:"async"})],-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"名称"),i("th",null,"说明")])]),i("tbody",null,[i("tr",null,[i("td",null,"Prometheus Server"),i("td",null,"收集指标和存储时间序列数据，并提供查询接口")]),i("tr",null,[i("td",null,"Push Gateway"),i("td",null,"短期存储指标数据，主要用于临时性任务")]),i("tr",null,[i("td",null,"Exporters"),i("td",null,"采集已有的三方服务监控指标并暴露metrics")]),i("tr",null,[i("td",null,"Alertmanager"),i("td",null,"告警")]),i("tr",null,[i("td",null,"Web UI"),i("td",null,"简单的WEB控制台")])])],-1),i("p",null,"集成了数据的采集，处理，存储，展示，告警一系列流程都已经具备了",-1),i("h3",{id:"数据模型",tabindex:"-1"},[s("数据模型 "),i("a",{class:"header-anchor",href:"#数据模型","aria-label":'Permalink to "数据模型"'},"​")],-1),i("p",null,[i("code",null,"Prometheus"),s("将所有数据存储为时间序列，具有相同度量名称以及标签属于同个指标，也就是说"),i("code",null,"Prometheus"),s("从数据源拿到数据之后都会存到内置的"),i("code",null,"TSDB"),s("中，这里存储的就是时间序列数据，它存储的数据会有一个度量名称，譬如你现在监控一个"),i("code",null,"nginx"),s("，首先你要给他起个名字，这个名称也就是度量名，还会有"),i("code",null,"N"),s("个标签，你可以理解名称为表名，标签为字段，所以，每个时间序列都由度量标准名称和一组键值对(也称为标签)唯一标识。")],-1),i("p",null,"时间序列的格式是这样的，",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"<metrice name> {<label name>=<label value>,...}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[i("code",null,"metrice name"),s("指的就是度量标准名称，"),i("code",null,"label name"),s("也就是标签名，这个标签可以有多个，栗子")],-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,'nginx_http_access{method="GET",uri="/index.html"}')])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这个度量名称为"),i("code",null,"nginx_http_access"),s("，后面是两个标签，和他们各对应的值，当然你还可以继续指定标签，你指定的标签越多查询的维度就越多。")],-1),i("h3",{id:"指标类型",tabindex:"-1"},[s("指标类型 "),i("a",{class:"header-anchor",href:"#指标类型","aria-label":'Permalink to "指标类型"'},"​")],-1),i("p",null,"看表格吧",-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"类型名称"),i("th",null,"说明")])]),i("tbody",null,[i("tr",null,[i("td",null,"Counter"),i("td",null,"递增计数器，适合收集接口请求次数")]),i("tr",null,[i("td",null,"Guage"),i("td",null,"可以任意变化的数值，适用CPU使用率")]),i("tr",null,[i("td",null,"Histogram"),i("td",null,"对一段时间内数据进行采集，并对有所数值求和于统计数量")]),i("tr",null,[i("td",null,"Summary"),i("td",null,"与Histogram类型类似")])])],-1),i("h3",{id:"作业和实例",tabindex:"-1"},[s("作业和实例 "),i("a",{class:"header-anchor",href:"#作业和实例","aria-label":'Permalink to "作业和实例"'},"​")],-1),i("p",null,[s("实例指的就是你可以抓取的目标，这个会在"),i("code",null,"Prometheus "),s("配置文件中提现，作业是具有相同目标的实例集合称为作业，你可以理解为是一个组，一会写配置文件的时候会详细解析，下面开始安装"),i("code",null,"Prometheus"),s("。")],-1),i("h2",{id:"prometheus部署",tabindex:"-1"},[s("Prometheus部署 "),i("a",{class:"header-anchor",href:"#prometheus部署","aria-label":'Permalink to "Prometheus部署"'},"​")],-1),i("p",null,[s("先通过二进制来部署"),i("code",null,"Prometheus"),s("吧，"),i("a",{href:"https://github.com/prometheus/prometheus/releases",target:"_blank",rel:"noreferrer"},"下载地址"),s("，我们要下载服务端，也就是这个包")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702152359.png#mirages-width=1214&mirages-height=339&mirages-cdn-type=5",alt:"20190702152359",loading:"lazy",decoding:"async"})],-1),i("p",null,"我在服务器上直接下载了，下载完后解压移动到别的目录。",-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# wget https://github.com/prometheus/prometheus/releases/download/v2.10.0/prometheus-2.10.0.linux-amd64.tar.gz")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# tar zxf prometheus-2.10.0.linux-amd64.tar.gz ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# mv prometheus-2.10.0.linux-amd64 /usr/local/prometheus")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# cd /usr/local/prometheus/ && "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ls")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"console_libraries"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  consoles"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  LICENSE"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  NOTICE"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  prometheus"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  prometheus.yml"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  promtool")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("先配置一下监控本机吧，它默认的配置文件是"),i("code",null,"prometheus.yml"),s("，已经配置好了，也就是这一段，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'prometheus'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # metrics_path defaults to '/metrics'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # scheme defaults to 'http'.")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[i("code",null,"targets"),s("就是一个作业，也就是被监控端，监控本机的"),i("code",null,"9090"),s("端口，启动选项也有很多，了解一下，主要是关注两点，分别如下。")],-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      --storage.tsdb.path"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'"data/"'),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"   ##存储数据的目录，默认/data")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      --storage.tsdb.retention.time"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," ##数据存储时间，默认15天")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这里提一下存储的问题，"),i("code",null,"TSDB"),s("不太适合长期去存储数据，数据量大了支持并不是很好，官方声明也是不会对这一块存储进行改善，给你的建议是使用外部存储，譬如使用"),i("code",null,"InfluxDB"),s("，这里暂时就不改他的默认存储了，把他进入系统服务吧，写一个"),i("code",null,"systemd"),s("的配置文件，直接启动了")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/prometheus]# cat "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," /usr/lib/systemd/system/prometheus.service "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"OEF"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Unit]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> Description=prometheus server daemon")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Service]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> Restart=on-failure")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ExecStart=/usr/local/prometheus/prometheus --config.file=/usr/local/prometheus/prometheus.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Install]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> WantedBy=multi-user.target")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> OEF")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[root@rj-bai /usr/local/prometheus]# systemctl daemon-reload && systemctl start prometheus.service")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这样就启动了撒，去访问"),i("code",null,"9090"),s("端口就可以看到页面了，这个页面能看到的东西很多，自己点点看吧，能看到这个页面就表示莫得问题。")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702163712.png#mirages-width=1845&mirages-height=454&mirages-cdn-type=5",alt:"20190702163712",loading:"lazy",decoding:"async"})],-1),i("p",null,"目前使用二进制部署主要是因为方便改配置文件，下面开始看配置文件。",-1),i("h2",{id:"全局配置文件介绍",tabindex:"-1"},[s("全局配置文件介绍 "),i("a",{class:"header-anchor",href:"#全局配置文件介绍","aria-label":'Permalink to "全局配置文件介绍"'},"​")],-1),i("p",null,[i("code",null,"prometheus"),s(" 已经安装起来了，下面看一下配置文件与核心功能，很多功能都是通过配置文件去实现的，比较多，所以先熟悉一下他的配置文件。")],-1),i("h3",{id:"全局配置文件",tabindex:"-1"},[s("全局配置文件 "),i("a",{class:"header-anchor",href:"#全局配置文件","aria-label":'Permalink to "全局配置文件"'},"​")],-1),i("p",null,[s("也就是"),i("code",null,"prometheus.yml"),s("，官方说明"),i("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/",target:"_blank",rel:"noreferrer"},"地址"),s("，大概分为这几块，我把注释去掉了，全局配置选项")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<duration> | default = 1m"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]      "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##采集间隔")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_timeout"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<duration> | default = 10s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]      "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##采集超时时间")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"evaluation_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<duration> | default = 1m"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##告警评估周期")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  external_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                    "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##外部标签             ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"<labelname>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<labelvalue> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"指定告警规则",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"rule_files"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<filepath_glob> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"配置被监控端",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<scrape_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"配置告警方式",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alerting"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  alert_relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<relabel_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  alertmanagers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<alertmanager_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"指定远程存储",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"remote_write"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<remote_write> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"remote_read"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<remote_read> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这就是一个整体的配置文件，现在再看默认的配置文件就能看懂某一段是干啥的了，现在开始配置"),i("code",null,"scrape_configs")],-1),i("h3",{id:"scrape-configs",tabindex:"-1"},[s("scrape_configs "),i("a",{class:"header-anchor",href:"#scrape-configs","aria-label":'Permalink to "scrape_configs"'},"​")],-1),i("p",null,"这块就是来配置我们要监控的东西，在这一块中配置的东西又有很多了，看一下官方的，一堆，我还是去掉注释分段贴出来吧。",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<job_name>"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  ##指定job名字")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<duration> | default = <global_config.scrape_interval>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_timeout"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<duration> | default = <global_config.scrape_timeout>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##这两段指定采集时间，默认继承全局")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metrics_path"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<path> | default = /metrics"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##metrics路径，默认metrics")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"honor_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<boolean> | default = false"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##默认附加的标签，默认不覆盖")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("它默认暴露监控数据的接口就是"),i("code",null,"ip:9090/metrics"),s("，你可以去指定这个名称，访问一下这里看看，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702171903.png#mirages-width=647&mirages-height=399&mirages-cdn-type=5",alt:"20190702171903",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("在"),i("code",null,"ip:9090/targets"),s("能看到当前监控的主机，现在只有本机一个，标签显示也在这里。")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702171956.png#mirages-width=1450&mirages-height=277&mirages-cdn-type=5",alt:"20190702171956",loading:"lazy",decoding:"async"})],-1),i("p",null,"在看下一段，这里定义的是要如何去访问采集目标",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scheme"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<scheme> | default = http"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 默认使用http方式去访问")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"params"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"<string>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<string>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] ]        "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 配置访问时携带的参数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"basic_auth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<string>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<secret>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"password_file"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<string>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]          "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 配置访问接口的用户名密码")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"bearer_token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<secret>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"bearer_token_file"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/path/to/bearer/token/file"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##指定认证token")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"tls_config"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<tls_config>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]                     "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 指定CA证书")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"proxy_url"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<string>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]                "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 使用代理模式访问目标")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"下一段，服务发现配置，贴了几个，不是完整的",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"consul_sd_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                   "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##通过consul去发现")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<consul_sd_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dns_sd_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                      "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##通过DNS去发现")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<dns_sd_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"file_sd_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                   "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##通过文件去发现")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<file_sd_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"kubernetes_sd_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":               "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##通过kubernetes去发现")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<kubernetes_sd_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"静态配置被监控端",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<static_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"刚刚监控本机的就是静态配置去监控的，也是就这一段，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'prometheus'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"最后标签配置",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<relabel_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]          "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##在数据采集前对标签进行重新标记")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metric_relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<relabel_config> ..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]          "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##在数据采集之后对标签进行重新标记")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"sample_limit"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<int> | default = 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ] "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##采集样本数量，默认0")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("下面看一下"),i("code",null,"relabel_configs")],-1),i("h3",{id:"relabel-configs",tabindex:"-1"},[s("relabel_configs "),i("a",{class:"header-anchor",href:"#relabel-configs","aria-label":'Permalink to "relabel_configs"'},"​")],-1),i("p",null,[s("就是用来重新打标记的，对于"),i("code",null,"prometheus"),s(" 数据模型最关键点就是一个指标名称和一组标签来组成一个多维度的数据模型，你想完成一个复杂的查询就需要你有很多维度，"),i("code",null,"relabel_configs"),s(" 就是对标签进行处理的，他能帮你在数据采集之前对任何目标的标签进行修改，重打标签的意义就是如果标签有重复的可以帮你重命名，看一哈现在的，上面铁锅")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708111918.png#mirages-width=1855&mirages-height=455&mirages-cdn-type=5",alt:"20190708111918",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("现在"),i("code",null,"instance"),s("是他默认给我加的标签，想改的话就需要"),i("code",null,"relabel_configs"),s("去帮你重打标签，他也可以删除标签，如果某个标签用不到了也可以删掉，再就是过滤标签，再看一下"),i("code",null,"relabel_configs"),s("的配置有哪些，也就是这一段")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"source_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'['"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," <labelname>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"..."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"']'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]   "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##源标签，指定对哪个现有标签进行操作")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"separator"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<string> | default = ;"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]            "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##多个源标签时连接的分隔符")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"target_label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<labelname>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]                    "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##要将源标签换成什么名字")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"regex"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<regex> | default = (.*)"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]              "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##怎么来匹配源标签，默认匹配所有")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"modulus"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<uint64>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]                            "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##不怎么会用到")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"replacement"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<string> | default = $1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]         "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##替换正则表达式匹配到的分组，分组引用$1,$2,$3")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  [ "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"action"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"<relabel_action> | default = replace"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ] "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##基于正则表达式匹配执行的操作，默认替换")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这东西到底怎么用，做个演示，根据两台服务器聚合查看"),i("code",null,"CPU"),s("使用率，说白了就是同时去查看这两台服务器的"),i("code",null,"CPU"),s("利用率，用这个标签就可以实现了。")],-1),i("h4",{id:"添加标签",tabindex:"-1"},[s("添加标签 "),i("a",{class:"header-anchor",href:"#添加标签","aria-label":'Permalink to "添加标签"'},"​")],-1),i("p",null,[s("去"),i("code",null,"WEB"),s("界面看一下当前被监控端"),i("code",null,"CPU"),s("使用率，用"),i("code",null,"sql"),s("去查，也就是这个值。")],-1),i("figure",null,[i("img",{src:"https://res.rj-bai.com/201907/20190708111918.png",alt:"20190708111918",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("可以看到一个度量名称和两个默认附加的标签，我现在想统计两台服务器的"),i("code",null,"CPU"),s("使用率，就需要加一个标签了，说白了就是添加一个维度去获取这两台服务器"),i("code",null,"CPU"),s("使用率，接下来去改配置文件吧，给他加个标签，如下，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        server"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"local")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"热更新一下，",-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/prometheus]# ps aux "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," prometheus.yml"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  |"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," grep"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  |"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," awk"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {'print $2'}"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," xargs"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kill"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hup")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"看一下有没有生效，刷新一下页面就能看到了，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708113120.png#mirages-width=694&mirages-height=480&mirages-cdn-type=5",alt:"20190708113120",loading:"lazy",decoding:"async"})],-1),i("p",null,"然后可以根据这个标签去查了，语法是这样的，内置函数，",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,'sum(process_cpu_seconds_total{server="local"})')])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708113824.png#mirages-width=1214&mirages-height=413&mirages-cdn-type=5",alt:"201907081124",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("所以就算你有"),i("code",null,"N"),s("个被监控的服务器打上这个标签之后在这里就可以看到总数了，添加标签很简单，下面看一下重命名标签，就是将现有的标签进行重命名。")],-1),i("h4",{id:"标签重命名",tabindex:"-1"},[s("标签重命名 "),i("a",{class:"header-anchor",href:"#标签重命名","aria-label":'Permalink to "标签重命名"'},"​")],-1),i("p",null,[s("就是将一个已有的标签重命名一个新的标签，实际操作一下，之前的标签去掉了，现在要把"),i("code",null,"job_name"),s("改个名字，也就是这一块的配置，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'prometheus'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("目前"),i("code",null,"job_name"),s("为"),i("code",null,"prometheus"),s("，当前这个虚拟机是跑在"),i("code",null,"IP"),s("地址为"),i("code",null,"21"),s("的物理机上，所以现在把他的"),i("code",null,"job_name"),s("改成"),i("code",null,"server21"),s("，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'server21'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"重启一下，刷新页面就可以看到了，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708160319.png#mirages-width=1543&mirages-height=371&mirages-cdn-type=5",alt:"20190708160319",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("我现在要将"),i("code",null,"job"),s("这个标签标记为"),i("code",null,"local"),s("，也就是将"),i("code",null,'job="server21'),s("改为"),i("code",null,'local="server21'),s("，下面开始用"),i("code",null,"relabel"),s("进行重命名，改完之后的配置是这样的，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'server21'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"action"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"replace")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      source_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'job'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##源标签")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      regex"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"(.*)"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"             ##正则，会匹配到job值，也就是server21")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      replacement"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"$1"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         ##引用正则匹配到的内容，也就是server21")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      target_label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"local"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ##赋予新的标签，名为local")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"这样就可以了撒，重新加载一下，看页面，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708161317.png#mirages-width=617&mirages-height=368&mirages-cdn-type=5",alt:"20190708161317",loading:"lazy",decoding:"async"})],-1),i("p",null,"新的数据已经有了，之前的标签还会保留，因为没有配置删除他，这样就可以了，现在就可以聚合了，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708161530.png#mirages-width=1136&mirages-height=419&mirages-cdn-type=5",alt:"20190708161530",loading:"lazy",decoding:"async"})],-1),i("p",null,"这样他就会将所有实例使用率相加求和。",-1),i("h4",{id:"action重新打标签动作",tabindex:"-1"},[s("action重新打标签动作 "),i("a",{class:"header-anchor",href:"#action重新打标签动作","aria-label":'Permalink to "action重新打标签动作"'},"​")],-1),i("p",null,"如表所示，上面就是用了一个默认的。",-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"值"),i("th",null,"描述")])]),i("tbody",null,[i("tr",null,[i("td",null,"replace"),i("td",null,"默认，通过正则匹配source_label的值，使用replacement来引用表达式匹配的分组")]),i("tr",null,[i("td",null,"keep"),i("td",null,"删除regex于链接不匹配的目标source_labels")]),i("tr",null,[i("td",null,"drop"),i("td",null,"删除regex与连接匹配的目标source_labels")]),i("tr",null,[i("td",null,"labeldrop"),i("td",null,"匹配Regex所有标签名称")]),i("tr",null,[i("td",null,"labelkeep"),i("td",null,"匹配regex所有标签名称")]),i("tr",null,[i("td",null,"hashmod"),i("td",null,"设置target_label为modulus连接的哈希值source_lanels")]),i("tr",null,[i("td",null,"labelmap"),i("td",null,[s("匹配regex所有标签名称，复制匹配标签的值分组，replacement分组引用("),i("span",{class:"katex"},[i("span",{class:"katex-mathml"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("semantics",null,[i("mrow",null,[i("mn",null,"1"),i("mo",{separator:"true"},",")]),i("annotation",{encoding:"application/x-tex"},"{1},")])])]),i("span",{class:"katex-html","aria-hidden":"true"},[i("span",{class:"base"},[i("span",{class:"strut",style:{height:"0.8389em","vertical-align":"-0.1944em"}}),i("span",{class:"mord"},[i("span",{class:"mord"},"1")]),i("span",{class:"mpunct"},",")])])]),s("{2})替代")])])])],-1),i("p",null,"比如说我现在不想采集本机的数据了，就可以用上面的标签进行操作了，加点东西就行了，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'server21'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"action"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"replace")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      source_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'job'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      regex"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"(.*)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      replacement"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"$1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      target_label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"local")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"action"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"drop")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      source_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"job"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("删除标签为"),i("code",null,"job"),s("的节点，目前只有一个节点，所以这个跑了之后就看不到数据了，如果真的要用这个给不需要监控的节点打一个标签，然后在这里匹配就行了，所以现在重新载入的话就没数据了，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708164048.png#mirages-width=515&mirages-height=325&mirages-cdn-type=5",alt:"20190708164048",loading:"lazy",decoding:"async"})],-1),i("p",null,"最后看一下删除标签。",-1),i("h4",{id:"删除标签",tabindex:"-1"},[s("删除标签 "),i("a",{class:"header-anchor",href:"#删除标签","aria-label":'Permalink to "删除标签"'},"​")],-1),i("p",null,[s("刚刚我新打了一个标签，也就是"),i("code",null,"local"),s("标签，所以之前的"),i("code",null,"job"),s("标签可以不要了，下面直接给他删了吧，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'server21'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    relabel_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"action"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"replace")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      source_labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'job'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      regex"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"(.*)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      replacement"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"$1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      target_label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"local")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"action"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"labeldrop"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      regex"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"job")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("重载一下就看到"),i("code",null,"job"),s("的标签了。")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708164600.png#mirages-width=467&mirages-height=413&mirages-cdn-type=5",alt:"20190708164600",loading:"lazy",decoding:"async"})],-1),i("p",null,"这样就可以了撒，下面看看基于文件的服务发现功能",-1),i("h3",{id:"基于文件的服务发现",tabindex:"-1"},[s("基于文件的服务发现 "),i("a",{class:"header-anchor",href:"#基于文件的服务发现","aria-label":'Permalink to "基于文件的服务发现"'},"​")],-1),i("p",null,[s("下面会涉及到基于文件的服务发现，还有就是基于"),i("code",null,"kubernetes"),s("的服务发现，这个到监控"),i("code",null,"k8s"),s("集群的时候再说吧，先看基于文件的吧，现在还没准备别的服务器，还是发现本身吧，先把配置文件改成这样，重载之后就看不到本机了。")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/prometheus"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat prometheus.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  scrape_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":     "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"15s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  evaluation_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"15s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alerting"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  alertmanagers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"rule_files"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'prometheus'")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708171041.png#mirages-width=942&mirages-height=299&mirages-cdn-type=5",alt:"20190708171041",loading:"lazy",decoding:"async"})],-1),i("p",null,"然后就可以去改配置文件了，通过服务发现将自身加入进去，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/prometheus"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat prometheus.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  scrape_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":     "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"15s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  evaluation_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"15s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alerting"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  alertmanagers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"rule_files"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scrape_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'prometheus'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    file_sd_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"files"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'/usr/local/prometheus/files_sd_configs/*.yaml'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##指定服务发现文件位置")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        refresh_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5s"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                      ##刷新间隔改为5秒")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("重载服务，然后去写服务发现的"),i("code",null,"YAML"),s("文件吧，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/prometheus/files_sd_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat configs.yml"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost:9090'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"server21")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"这样就可以了，文件保存五秒后就能看到发现的主机了，查数据也没问题",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708173554.png#mirages-width=1234&mirages-height=334&mirages-cdn-type=5",alt:"20190708173554",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708173611.png#mirages-width=1432&mirages-height=254&mirages-cdn-type=5",alt:"20190708173611",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708173654.png#mirages-width=940&mirages-height=419&mirages-cdn-type=5",alt:"20190708173654",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("就是这种原理，下面开始监控"),i("code",null,"linux"),s("和一些服务吧")],-1),i("h2",{id:"监控栗子",tabindex:"-1"},[s("监控栗子 "),i("a",{class:"header-anchor",href:"#监控栗子","aria-label":'Permalink to "监控栗子"'},"​")],-1),i("h3",{id:"监控linux服务器",tabindex:"-1"},[s("监控linux服务器 "),i("a",{class:"header-anchor",href:"#监控linux服务器","aria-label":'Permalink to "监控linux服务器"'},"​")],-1),i("p",null,[i("code",null,"emmmm"),s("，在被监控端需要装一个名为"),i("code",null,"node_exporter"),s("的导出器，他会帮你收集系统指标和一些软件运行的指标，把指标暴露出去，这样"),i("code",null,"prometheus"),s("就可以去采集了，具体"),i("code",null,"node_exporter"),s("能采集哪些东西，看官方的"),i("a",{href:"https://github.com/prometheus/node_exporter",target:"_blank",rel:"noreferrer"},[i("code",null,"github")]),s("吧，还是蛮多的，现在随便找个服务器下载一下"),i("code",null,"node_exporter"),s("运行起来就行了。")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# wget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# tar zxf node_exporter-0.18.1.linux-amd64.tar.gz ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# mv node_exporter-0.18.1.linux-amd64 /usr/local/node_exporter")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# cd /usr/local/node_exporter")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"在启动之前看一下他的启动参数，",-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node /usr/local/node_exporter]# ./node_exporter --help")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("可以看到一堆，她就是一个收集器，配置你要收集或不收集哪些信息，看"),i("code",null,"default"),s("就能看出来撒，加到系统服务中吧，用"),i("code",null,"systemctl"),s("去管理。")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node /usr/local/node_exporter]# cat "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," /usr/lib/systemd/system/node_exporter.service "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"OEF"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Unit]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> Description=node_exporter")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Service]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> Restart=on-failure")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ExecStart=/usr/local/node_exporter/node_exporter")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Install]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> WantedBy=multi-user.target")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> OEF")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[root@kubeadm-node /usr/local/node_exporter]# systemctl daemon-reload ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[root@kubeadm-node /usr/local/node_exporter]# systemctl start node_exporter.service")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[root@kubeadm-node /usr/local/node_exporter]# curl -s 127.0.0.1:9100/metrics | head")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709105800.png#mirages-width=766&mirages-height=390&mirages-cdn-type=5",alt:"20190709105800",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("正常启动了撒，现在要配置"),i("code",null,"prometheus"),s("来监控这个主机了，之前配置过动态发现了，现在再加一个，把服务端和被监控端分开，所以新加了这个。")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/prometheus]# cat prometheus.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  -"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," job_name:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'nodes'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    file_sd_configs:"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      -"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," files:"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'/usr/local/prometheus/nodes_sd_configs/*.yml'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        refresh_interval:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 5s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/prometheus]# mkdir nodes_sd_configs && "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nodes_sd_configs")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/prometheus]# ps aux "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," prometheus.yml"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  |"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," grep"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  |"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," awk"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {'print $2'}"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," xargs"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kill"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hup")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/prometheus/nodes_sd_configs]# cat nodes.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"-"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," targets:"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'192.168.1.248:9100'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  labels:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    name:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," server20")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"直接去看页面吧，应该已经添加进去了，顺便查一下数据",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709111843.png#mirages-width=1390&mirages-height=400&mirages-cdn-type=5",alt:"20190709111843",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709112040.png#mirages-width=851&mirages-height=441&mirages-cdn-type=5",alt:"20190709112040",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("这样就可以了，莫得问题，下面用"),i("code",null,"PromSQL"),s("获取"),i("code",null,"CPU&"),s("内存硬盘使用率")],-1),i("h3",{id:"使用promsql",tabindex:"-1"},[s("使用PromSQL "),i("a",{class:"header-anchor",href:"#使用promsql","aria-label":'Permalink to "使用PromSQL"'},"​")],-1),i("p",null,[s("想查数据就需要写"),i("code",null,"PromSQL"),s("去查询了，")],-1),i("h4",{id:"查询cpu使用率",tabindex:"-1"},[s("查询CPU使用率 "),i("a",{class:"header-anchor",href:"#查询cpu使用率","aria-label":'Permalink to "查询CPU使用率"'},"​")],-1),i("p",null,[s("比如果我想查看刚刚加进来的"),i("code",null,"nodes CPU"),s("利用率，以"),i("code",null,"node"),s("开头的"),i("code",null,"sql"),s("都是"),i("code",null,"node_expores"),s("采集的指标，度量很多，看"),i("code",null,"CPU"),s("使用率看着一个指标就够了，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709112714.png#mirages-width=1723&mirages-height=923&mirages-cdn-type=5",alt:"",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("总"),i("code",null,"CPU"),s("使用情况，会列出你处理器多少核，每个核的使用情况，这个CPU是干什么使用的，用户态还是内核态还是操作"),i("code",null,"IO"),s("等待的时间，还有优先级调度使用的"),i("code",null,"CPU"),s("，他会通过一个名为"),i("code",null,"mode"),s("的标签去区分这些，一般不会这么去统计，现在统计一下刚刚加进去的那个"),i("code",null,"nodes"),s("五分钟之内"),i("code",null,"CPU"),s("平均使用率是多少，还是得写"),i("code",null,"PromSQL"),s("，大概是这样，")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," irate(node_cpu_seconds_total{mode"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"idle"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}[5m])"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[i("code",null,"emmm"),s("，"),i("code",null,'node_cpu_seconds_total{mode="idle"}[5m]'),s("这一段是统计出了服务器最近5分钟"),i("code",null,"CPU"),s("的空闲率，执行之后是这种效果，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709114438.png#mirages-width=1682&mirages-height=808&mirages-cdn-type=5",alt:"20190709114438",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("这是五分钟之内所有值，然后使用了"),i("code",null,"irate"),s("函数来统计它的平均值，转化成了百分比，乘了一百，所以执行结果如下。")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709114935.png#mirages-width=1761&mirages-height=439&mirages-cdn-type=5",alt:"20190709114935",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("这就是所有"),i("code",null,"CPU"),s("的空闲率了，我要取的是所有CPU的使用率，所以又一百减去了空闲率的值就是使用率了，所以上面第一条"),i("code",null,"sql"),s("执行发回的结果如下。")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709115136.png#mirages-width=1667&mirages-height=420&mirages-cdn-type=5",alt:"20190709115136",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("这就是五分钟之内总的"),i("code",null,"CPU"),s("的平均使用率了，我的那个节点就是四核"),i("code",null,"CPU"),s("，每个都被列出来了，真鸡儿麻烦，再看一下内存使用率，和上面其实一样，值都有了，求出他的百分比就行了，")],-1),i("h4",{id:"查询内存使用率",tabindex:"-1"},[s("查询内存使用率 "),i("a",{class:"header-anchor",href:"#查询内存使用率","aria-label":'Permalink to "查询内存使用率"'},"​")],-1),i("p",null,[i("code",null,"linux"),s("内核有一个内存缓存机制，所以"),i("code",null,"buff/cache"),s("的占用不算是已被使用的物理内存，所以计算方式就是将这三个值加到一起就是剩余内存了，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709134042.png#mirages-width=611&mirages-height=61&mirages-cdn-type=5",alt:"20190709134042",loading:"lazy",decoding:"async"})],-1),i("p",null,[i("code",null,"sql"),s("的话这样写，直接查一下，")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"node_memory_MemFree_bytes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"node_memory_Cached_bytes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"node_memory_Buffers_bytes")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709134504.png#mirages-width=1600&mirages-height=341&mirages-cdn-type=5",alt:"20190709134504",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("这就是总共剩余的内存，单位是"),i("code",null,"bite"),s("，现在我要计算使用内存百分比，和上面看"),i("code",null,"CPU"),s("使用率的方法一致，"),i("code",null,"sql"),s("如下")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (node_memory_MemFree_bytes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"node_memory_Cached_bytes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"node_memory_Buffers_bytes) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node_memory_MemTotal_bytes "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709135149.png#mirages-width=1505&mirages-height=408&mirages-cdn-type=5",alt:"20190709135149",loading:"lazy",decoding:"async"})],-1),i("p",null,"下面看看硬盘使用率",-1),i("h4",{id:"查询硬盘使用率",tabindex:"-1"},[s("查询硬盘使用率 "),i("a",{class:"header-anchor",href:"#查询硬盘使用率","aria-label":'Permalink to "查询硬盘使用率"'},"​")],-1),i("p",null,"你的磁盘和挂载点可能不止一个，先看一下目前收集到的信息，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709145758.png#mirages-width=1470&mirages-height=478&mirages-cdn-type=5",alt:"20190709145758",loading:"lazy",decoding:"async"})],-1),i("p",null,"所以就要指定分区进行计算了，所以匹配这里写了一个正则去匹配你挂载的磁盘，如下",-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (node_filesystem_free_bytes{mountpoint"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",fstype"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"~"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ext4|xfs"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node_filesystem_size_bytes{mountpoint"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",fstype"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"~"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ext4|xfs"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[i("code",null,"node_filesystem_size_bytes"),s("查的是"),i("code",null,"/"),s("总大小，"),i("code",null,"node_filesystem_free_bytes"),s("查的是剩余大小，只匹配"),i("code",null,"ext4&xfs"),s("类型的，像是什么"),i("code",null,"tmpfs&shm"),s("类型的都不匹配，还是算出了剩余的百分比，所以执行后的结果是这样，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709150539.png#mirages-width=1907&mirages-height=326&mirages-cdn-type=5",alt:"20190709150539",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709150559.png#mirages-width=1185&mirages-height=254&mirages-cdn-type=5",alt:"20190709150559",loading:"lazy",decoding:"async"})],-1),i("p",null,"计算方式大概就是这样，现在还没涉及到图形展示这一块，下面看一下获取系统服务运行状态。",-1),i("h4",{id:"查询系统服务运行状态",tabindex:"-1"},[s("查询系统服务运行状态 "),i("a",{class:"header-anchor",href:"#查询系统服务运行状态","aria-label":'Permalink to "查询系统服务运行状态"'},"​")],-1),i("p",null,[s("就是监控系统服务运行状态，说白了就是监控以"),i("code",null,"systemctl"),s("启动的服务，现在监控一下这个，"),i("code",null,"node_exports"),s("就支持对这种服务进行监控，目前还没有启用这个功能，现在启动一下撒，直接去改"),i("code",null,"node_exports"),s("的启动文件，加两条参数即可。")],-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# cat /usr/lib/systemd/system/node_exporter.service ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Unit]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Description"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"node_exporter")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Service]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Restart"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"on-failure")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ExecStart"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/local/node_exporter/node_exporter"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," --collector.systemd"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --collector.systemd.unit-whitelist=(docker"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sshd"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},").service")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Install]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"WantedBy"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"multi-user.target")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("第二段就是制定我要监控哪些系统服务，我写了"),i("code",null,"docker&sshd"),s("，重启后可以去查询了，")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# systemctl daemon-reload         ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# systemctl restart node_exporter.service")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("我查一下当前"),i("code",null,"docker&sshd"),s("的运行状态是什么，可以直接这样写了，")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"node_systemd_unit_state{exported_name"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"~"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"(docker|sshd).service"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709153503.png#mirages-width=1908&mirages-height=601&mirages-cdn-type=5",alt:"20190709153503",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("目前"),i("code",null,"state=active"),s("的值为"),i("code",null,"0"),s("，说明正常运行，所以之后写告警规则的时候就去判断这个值是不是"),i("code",null,"1"),s("，如果不是就要进行某些操作了，下面装一下"),i("code",null,"grafana"),s("吧")],-1),i("h3",{id:"部署grafana",tabindex:"-1"},[s("部署grafana "),i("a",{class:"header-anchor",href:"#部署grafana","aria-label":'Permalink to "部署grafana"'},"​")],-1),i("p",null,[i("code",null,"grafana"),s("就是一个图形展示系统，他主要是对度量指标进行分析可视化，他本身不会存储任何数据，他只会展示数据库里面的数据，支持很多类型的数据库，"),i("a",{href:"https://grafana.com/",target:"_blank",rel:"noreferrer"},"官网"),s("，刚好我装有"),i("code",null,"docker"),s("，其实目前在操作的这两台服务是一个"),i("code",null,"k8s"),s("集群，用"),i("code",null,"kubeadm"),s("启动的，所以我直接用"),i("code",null,"docker"),s("启动了，还是写个"),i("code",null,"deployment"),s("，算了直接用"),i("code",null,"docker"),s("命令启吧，")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@kubeadm-node "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# docker run "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," -u 0 "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," -d "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," -p 3000:3000  "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," --name"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"grafana"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"   \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"-v"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /var/lib/grafana:/var/lib/grafana"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"grafana/grafana")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这样就行了，直接访问"),i("code",null,"3000"),s("端口就好了，用户名密码默认"),i("code",null,"admin/admin"),s("，初次登陆会让你修改密码，就可以看到主页了，然后直接添加数据源，把"),i("code",null,"prometheus"),s("加进去，保存就行了，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709163321.png#mirages-width=556&mirages-height=777&mirages-cdn-type=5",alt:"20190709163321",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("然后直接导入一个仪表盘进来吧，"),i("code",null,"ID"),s("是"),i("code",null,"9276"),s("，大概是这种效果，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709173630.png#mirages-width=1786&mirages-height=883&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("然后网络带宽那里没数据，我看了一下他的"),i("code",null,"sql"),s("，只需要将"),i("code",null,"$nic"),s("改为你的网卡名就有数据了，所以现在监控"),i("code",null,"linux"),s("服务器是没问题了，下面试试监控"),i("code",null,"docker"),s("。")],-1),i("h3",{id:"监控docker",tabindex:"-1"},[s("监控docker "),i("a",{class:"header-anchor",href:"#监控docker","aria-label":'Permalink to "监控docker"'},"​")],-1),i("p",null,[s("想要监控"),i("code",null,"docker"),s("需要用到名为"),i("code",null,"cadvisor"),s("的工具，是谷歌开源的，它用于收集正在运行的容器资源使用和性能信息，"),i("a",{href:"https://github.com/google/cadvisor",target:"_blank",rel:"noreferrer"},"github"),s("地址，你需要在要监控的服务器上部署"),i("code",null,"cadvisor"),s("，直接用"),i("code",null,"docker"),s("去启动就完了，命令如下")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"docker"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --volume=/:/rootfs:ro"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --volume=/var/run:/var/run:ro"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --volume=/sys:/sys:ro"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --volume=/var/lib/docker/:/var/lib/docker:ro"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --volume=/dev/disk/:/dev/disk:ro"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --publish=8080:8080"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --detach=true"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --name=cadvisor"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  google/cadvisor:latest")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("容器启动后也是会暴露一个指标接口，默认是"),i("code",null,"8080/metrics"),s("，这里就不访问了，下一步就是加入到普罗米修斯中进行监控了，去改他的配置文件，静态配置一个吧，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'docker'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'192.168.1.248:8080'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("加完直接重载，页面直接导入一个图表吧，"),i("code",null,"ID"),s("是"),i("code",null,"193"),s("或者11277再或者11600！！！，效果是这样的，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709181607.png#mirages-width=1787&mirages-height=969&mirages-cdn-type=5",alt:"20190709181607",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("主要就是监控容器的"),i("code",null,"CPU"),s("内存网络流量的，都可看到，目前我"),i("code",null,"248"),s("就运行了六个容器，就是这样，下面在看看监控"),i("code",null,"mysql")],-1),i("h3",{id:"监控mysql",tabindex:"-1"},[s("监控mysql "),i("a",{class:"header-anchor",href:"#监控mysql","aria-label":'Permalink to "监控mysql"'},"​")],-1),i("p",null,[s("监控"),i("code",null,"mysql"),s("就会用到"),i("code",null,"mysql_exporter"),s("，这个也能在官网下到，也就是"),i("a",{href:"https://prometheus.io/download/#mysqld_exporter",target:"_blank",rel:"noreferrer"},"这里"),s("，这个东西需要你安装到运行"),i("code",null,"mysql"),s("的实例上，本地的"),i("code",null,"mysql"),s("比较多，我随便找了一个扔了上去，先去"),i("code",null,"mysql"),s("创建一个用户吧，这个程序需要连接明月三千里才能获取到指标。")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mysql"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CREATE"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," USER "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'exporter'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," IDENTIFIED "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BY"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'exporter'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Query OK, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," rows"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," affected ("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"02"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sec)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mysql"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," GRANT"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PROCESS, REPLICATION CLIENT, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ON"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," TO"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'exporter'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'localhost'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Query OK, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," rows"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," affected ("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"00"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sec)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mysql"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," flush privileges;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Query OK, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," rows"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," affected ("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"00"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sec)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mysql"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," select"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," user,host "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," mysql"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709184630.png#mirages-width=476&mirages-height=226&mirages-cdn-type=5",alt:"20190709184630",loading:"lazy",decoding:"async"})],-1),i("p",null,"用户创建好了去解压包吧，",-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@mysql "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# tar zxf mysqld_exporter-0.11.0.linux-amd64.tar.gz -C /usr/local/ && "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /usr/local/")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@mysql local]# mv mysqld_exporter-0.11.0.linux-amd64/ mysqld_exporter && "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysqld_exporter")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("需要写一个文件，"),i("code",null,"mysqld_exporter"),s("直接读这个文件就可以连接"),i("code",null,"mysql"),s("了，")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@mysql mysqld_exporter]# cat .my.cnd")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[client]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"user"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"exporter")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"password"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"exporter")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"文件有了，在启动的时候指定一下读取这个文件，直接启动",-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@mysql mysqld_exporter]# ./mysqld_exporter --config.my-cnf"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".my.cnf")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709185400.png#mirages-width=692&mirages-height=115&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,"现在把这个加到普罗米修斯中，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'mysql'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'192.168.1.126:9104'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("然后导入一个仪表盘，"),i("code",null,"ID"),s("为"),i("code",null,"7362"),s("，看页面，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709190259.png#mirages-width=1795&mirages-height=900&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("还是有些空值，而且官方也说了"),i("code",null,"5.6"),s("版本有些不支持，我看了一下"),i("code",null,"Buffer Pool Size of Total RAM"),s("的"),i("code",null,"sql"),s("，是这样写的，")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(mysql_global_variables_innodb_buffer_pool_size{instance"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"$host"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," on"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (instance) node_memory_MemTotal_bytes{instance"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"$host"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("现在应该能看的差不多了，他去查了"),i("code",null,"mysql"),s("节点的总内存，但是我明月三千里节点并没有装"),i("code",null,"node_exports"),s("，所以就没数据了，总之支持采集的数据和仪表盘模板很多，自行琢磨吧，上面只是最简单的几个例子，下面来看看告警这一块的东西。")],-1),i("h2",{id:"alertmanager",tabindex:"-1"},[s("alertmanager "),i("a",{class:"header-anchor",href:"#alertmanager","aria-label":'Permalink to "alertmanager"'},"​")],-1),i("p",null,[s("普罗米修斯本身是不支持告警的，告警是由"),i("code",null,"alertmanager"),s("这个组件完成的，普罗米修斯将告警收集起来会推送给"),i("code",null,"alertmanager"),s("，"),i("code",null,"alertmanager"),s("接收到告警后决定怎么去处理这些告警，应该发给谁，下面先部署一下"),i("code",null,"alertmanager"),s("吧，我直接下载了，在普罗米修斯服务器上，")],-1),i("h3",{id:"部署alertmanager",tabindex:"-1"},[s("部署alertmanager "),i("a",{class:"header-anchor",href:"#部署alertmanager","aria-label":'Permalink to "部署alertmanager"'},"​")],-1),i("p",null,[i("code",null,"alertmanager"),s("没必要和普罗米修斯放在一个服务器上，他们之间能通讯就可以了，我目前资源紧张就扔到一起了，直接"),i("code",null,"wget"),s("了，")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# wget https://github.com/prometheus/alertmanager/releases/download/v0.18.0/alertmanager-0.18.0.linux-amd64.tar.gz")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("让他先下着，聊一下普罗米修斯和"),i("code",null,"alertmanager"),s("是怎么通讯的，首先你需要在"),i("code",null,"prometheus"),s("中定义你的监控规则，说白了就是写一个触发器，某个值超过了我设置的阈值我就要告警了，触发告警之后"),i("code",null,"prometheus"),s("会推送当前的告警规则到"),i("code",null,"alertmanager"),s("，"),i("code",null,"alertmanager"),s("收到了会进行一系列的流程处理，然后发送到接收人手里，他的处理规则也是很复杂的，后面会说，现在也下载完了，解压")],-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# tar zxf alertmanager-0.18.0.linux-amd64.tar.gz ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# mv alertmanager-0.18.0.linux-amd64 /usr/local/alertmanager && "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /usr/local/alertmanager"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ls")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"alertmanager"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  alertmanager.yml"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  amtool"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  LICENSE"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  NOTICE")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"有两个二进制文件，分别是启动程序和一个工具，还有一个主配置文件，先来了解一下他的主配置文件，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  resolve_timeout"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5m")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"全局配置，设置解析超时时间，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"route"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]      "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##alertmanager中的分组，选哪个标签作为分组的依据")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"              ##分组等待时间，拿到第一条告警后等待10s，如果有其他的一起发送出去")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"          ##各个分组之前发搜告警的间隔时间")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1h"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"          ##重复告警时间，默认1小时")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'web.hook'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         ##接收者")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"这里是配置告警的，配置告警怎么发送，怎么来分配，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receivers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'web.hook'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  webhook_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"url"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'http://127.0.0.1:5001/'")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"这里是配置告警的接收者，我要发送给谁，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"inhibit_rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"source_match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'critical'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    target_match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'warning'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    equal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'dev'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'instance'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这里用于配置告警收敛的，主要就是减少发送告警，来发送一些关键的，所以先把这段注释了吧，暂时用不到，之后会用到，所以基于这个配置文件改改，暂时先发送"),i("code",null,"email"),s("吧，所以改完的配置文件如下，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/alertmanager"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat alertmanager.yml"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  resolve_timeout"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_smarthost"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'smtp.163.com:25'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         #smtp服务地址")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@163.com'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  #发送邮箱")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_auth_username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@163.com'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         #认证用户名")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_auth_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxxx'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                #认证密码")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_require_tls"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                   #禁用tls")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"route"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'email'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                      #定义接受告警组名")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receivers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                  ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'email'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                          #定义组名")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                         "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#配置邮件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xx@xxx.com'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                     #收件人")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"保存后检查一下这个文件有没有问题，命令如下，",-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/alertmanager]# ./amtool check-config alertmanager.yml ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Checking"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'alertmanager.yml'"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  SUCCESS")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"然后去启动吧，还是加到系统服务中吧，",-1),i("div",{class:"language-shell"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"shell"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@rj-bai /usr/local/alertmanager]# cat "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," /usr/lib/systemd/system/alertmanager.service "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"OEF"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Unit]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> Description=alertmanager")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Service]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> Restart=on-failure")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ExecStart=/usr/local/alertmanager/alertmanager --config.file=/usr/local/alertmanager/alertmanager.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> [Install]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> WantedBy=multi-user.target")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"> OEF")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[root@rj-bai /usr/local/alertmanager]# systemctl start alertmanager")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("现在"),i("code",null,"alertmanager"),s("是装完了，需要和"),i("code",null,"prometheus"),s("融合一下，需要配置两部分，分别如下，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alerting"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  alertmanagers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"127.0.0.1:9093"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"   ##配置alertmanager地址，我的在本机")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"rule_files"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"rules/*.yml"'),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         ##配置告警规则的文件")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("配置这两项就够了，保存之后创建"),i("code",null,"rules"),s("目录，接下来就可以配置告警规则了。")],-1),i("h3",{id:"配置告警规则并邮件通知",tabindex:"-1"},[s("配置告警规则并邮件通知 "),i("a",{class:"header-anchor",href:"#配置告警规则并邮件通知","aria-label":'Permalink to "配置告警规则并邮件通知"'},"​")],-1),i("p",null,"我直接在官方复制过来了一个例子顺便改了改，如下，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/prometheus/rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat example.yml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groups"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"exports.rules"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ##定义这组告警的组名，同性质的，都是监控实例exports是否开启的模板")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alert"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"采集器凉了"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ## 告警名称")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    expr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"up == 0"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        ## 告警表达式，监控up指标，如果等于0就进行下面的操作")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"              ## 持续一分钟为0进行告警")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":              "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 定义告警级别")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ERROR")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    annotations"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":         "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 定义了告警通知怎么写，默认调用了{$labels.instance&$labels.job}的值")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      summary"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"实例 {{ $labels.instance }} 采集器凉了撒"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      description"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"实例 {{ $labels.instance }} job 名为 {{ $labels.job }} 的采集器凉了有一分钟了撒"')])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("每个实例都会有一个"),i("code",null,"up"),s("的指标，上面的标签名"),i("code",null,"job"),s("都能看到，用"),i("code",null,"sql"),s("去查一下，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711145721.png#mirages-width=1720&mirages-height=403&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("采集器在开启状态下返回值就是"),i("code",null,"1"),s("，如果采集器出现问题没启动或是什么别的异常都会返回"),i("code",null,"0"),s("，"),i("code",null,"0"),s("就是代表异常了，所以说白了就是那条规则就是监控所有实例的"),i("code",null,"up"),s("指标，如果指标值为"),i("code",null,"0"),s("且持续时间超过一分钟我就要告警了，保存吧，直接重启"),i("code",null,"prometheus"),s("吧，重启之后可以在"),i("code",null,"web"),s("控制台看到你配置的规则了，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711152123.png#mirages-width=1840&mirages-height=360&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("emmmm，既然配置完了，验证一下吧，随便关掉一个采集器，等邮件就行了，我把明月三千里的关掉了，然后发现有一条告警处于"),i("code",null,"PENDING"),s("状态，他已经准备去通知"),i("code",null,"alertmanager"),s("了，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711153136.png#mirages-width=1834&mirages-height=466&mirages-cdn-type=5",alt:"",loading:"lazy",decoding:"async"})],-1),i("p",null,"一分钟之后我收到邮件了，长这样，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711154859.png#mirages-width=1120&mirages-height=578&mirages-cdn-type=5",alt:"20190711154859",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("如果问题没解决他每分钟都会给你发一封邮件，刚刚配置了，发送邮件的等待时间一会会细说一下，我再停一个，我再把"),i("code",null,"docker"),s("停了，看看他发出的邮件是什么样的，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711155830.png#mirages-width=1118&mirages-height=766&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("这里两条告警被合并到一个邮件里发出来了，这就是做了分组，如果你有同类告警的，也就是根据"),i("code",null,"alertname "),s("去区分的，都会给你合并，"),i("code",null,"mysql&docker"),s("被合并到一起了，再看一下他还是支持哪些方式来告警，看"),i("a",{href:"https://prometheus.io/docs/alerting/configuration/",target:"_blank",rel:"noreferrer"},"这里"),s("吧，拉到最下面可以看到支持微信，丁丁目前是不支持的，有第三方的，我将来会对接企业微信的撒，暂时现用邮件吧，下面看看"),i("code",null,"alertmanager"),s("的告警状态吧。")],-1),i("h3",{id:"告警状态",tabindex:"-1"},[s("告警状态 "),i("a",{class:"header-anchor",href:"#告警状态","aria-label":'Permalink to "告警状态"'},"​")],-1),i("p",null,[s("目前"),i("code",null,"alertmanager"),s("告警状态分为三种，如下")],-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"值"),i("th",null,"说明")])]),i("tbody",null,[i("tr",null,[i("td",null,"Inactive"),i("td",null,"什么都没有发生")]),i("tr",null,[i("td",null,"Pending"),i("td",null,"已触发阈值，但未满足告警持续时间，for时间")]),i("tr",null,[i("td",null,"Firing"),i("td",null,"已触发阈值且满足告警持续时间，通知alertmanager你可以发送告警了")])])],-1),i("p",null,[s("在这个阶段是有个时间的，并不是出现问题告警会马上发出去，这个时间包含了数据采集时间、告警评估时间，这两个时间是在"),i("code",null,"prometheus"),s("中配置的，也就是这里，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  scrape_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":     "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"15s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  evaluation_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"15s")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("目前是十五秒采集一次数据，评估告警规则时间也是十五秒，这个评估告警规则的时间就是我每隔多长时间要进行一次评估是否到达的阈值了，说白了这东西的目的就是为了减少告警的次数，更加精确的判断当前的状态是不是"),i("code",null,"ok"),s("的，下面在看看告警的分配")],-1),i("h3",{id:"告警的分配",tabindex:"-1"},[s("告警的分配 "),i("a",{class:"header-anchor",href:"#告警的分配","aria-label":'Permalink to "告警的分配"'},"​")],-1),i("p",null,[s("具体告警要怎么去分配，也是在"),i("code",null,"alertmanager"),s("中配置的，也就是这一段，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"route"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'email'")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这就是设置告警的分发策略了，这个"),i("code",null,"route"),s("可以拆分成多个子路由，目前所有的告警都会发送到名为"),i("code",null,"email"),s("的接收器里面，"),i("code",null,"email"),s("接收器的规则也是在配置文件中指定的，也就是这一段，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receivers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'email'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xx@xxx.com'")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("接收器目前只有一个名为"),i("code",null,"email"),s("的，也可以有多个，如果你有什么特殊需求，需要将不同类型的告警发送给不同的人，就需要配置多个接收器去区分了，如下，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  resolve_timeout"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_smarthost"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'smtp.163.com:25'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@163.com'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_auth_username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@163.com'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_auth_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  smtp_require_tls"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"route"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'default-receiver'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  ##定义默认接收器名，如果其他的匹配不到走这个")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"30s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"4h")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cluster"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"alertname"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]                "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##分组设置")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  routes"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                       "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##子路由")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'database-pager'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  ##定义接收器名字          ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                             ##分组设置")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    match_re"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                   "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##正则匹配")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      service"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"mysql|cassandra"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  ##他会接收标签service值为mysql&&cassandra的告警")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'frontend-pager'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  ##接收器名")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"product"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"environment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]            "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##分组设置")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                      "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##直接匹配")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      team"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"frontend"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            ##匹配标签team值为frontend的告警")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receivers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                      "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##定义接收器")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'default-receiver'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                      ##接收器名字")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":                                "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##邮件接口")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx.xx.com'"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            ##接收人，下面以此类推")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'database-pager'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx.xx.com'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'frontend-pager'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@.xx.com'")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"我就不掩饰了，配置其实很简单，演示很麻烦撒，算了算了，过，下面看一哈告警收敛",-1),i("h3",{id:"告警收敛",tabindex:"-1"},[s("告警收敛 "),i("a",{class:"header-anchor",href:"#告警收敛","aria-label":'Permalink to "告警收敛"'},"​")],-1),i("p",null,[s("收敛就是尽量压缩告警邮件的数量，太多了谁都会懵逼，可能有些关键的呗淹没了，"),i("code",null,"alertmanager"),s("中有很多收敛机制，最主要的就是分组抑制静默，"),i("code",null,"alertmanager"),s("收到告警之后他会先进行分组，然后进入通知队列，这个队列会对通知的邮件进行抑制静默，再根据"),i("code",null,"router"),s("将告警路由到不同的接收器，这就是"),i("code",null,"alertmanager"),s("收到一个告警后经历的阶段，只是一个大概的情况，下面深入了解一下这几个阶段到底是什么原理怎么去配置，先来简单看一下他们的定义")],-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"机制"),i("th",null,"说明")])]),i("tbody",null,[i("tr",null,[i("td",null,"分组(group)"),i("td",null,"将类似性质的告警合并为单个进行通知")]),i("tr",null,[i("td",null,"抑制(Inhibition)"),i("td",null,"当告警发生后，停止重复发送由此告警引发的其他告警")]),i("tr",null,[i("td",null,"静默(Silences)"),i("td",null,"是一种简单的特定时间静音提醒的机制")])])],-1),i("h4",{id:"分组",tabindex:"-1"},[s("分组 "),i("a",{class:"header-anchor",href:"#分组","aria-label":'Permalink to "分组"'},"​")],-1),i("p",null,[s("举个栗子，比如说我在阿里云有"),i("code",null,"10"),s("台服务器，但是我忘续费了，结果服务器到期都被停掉了(真实发生过)，这时候"),i("code",null,"node_exports"),s("肯定也无法访问了，服务器都停了，这时候普罗米修斯发现这"),i("code",null,"10"),s("个服务器都凉了，我要准备通知"),i("code",null,"alertmanager"),s("告警了，在不做分组的情况下你的告警媒介会有十条信息发出来，这种情况下我们可以他这些信息合并到一起撒，一条信息列出哪些服务器凉了。")],-1),i("p",null,"其实分组设置最开始的时候我就做了，这一段就是设置分组的，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"route"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这里配置了分组的依据，默认就是"),i("code",null,"alertname"),s("，这个名字可以随便写的，做了分组之后他会去匹配你告警时的名字，告警的名字是在这里配置的，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alert"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"采集器凉了")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("如果是相同名字的告警在一定时间内出现多条，这个一定时间指的就是"),i("code",null,"group_wait"),s("的时间，那么多条就会合并成一条告警信息发出来，这个之前就配置了，所以在我停掉"),i("code",null,"mysql&docker"),s("采集器之后他就把这两条告警合并成一条信息发了出来，也就是这张图，上面贴过了。")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711155830.png#mirages-width=1118&mirages-height=766&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,"这两条的告警名字都是采集器凉了撒，而且在十秒钟之内出现了两条，所以就被合并成一条发出来了，分组的目的就是为了减少告警信息的数量，同类告警聚合，所以现在总结一下配置分组的参数。",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#根据标签进行alert分组，可以写多个")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"          #发送告警等待时间，")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      #分组告警信息间隔时间，譬如两组，第一组发送后等待十秒发送第二组")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      #重复发送告警时间，时间不要太短，也不要太长")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("h4",{id:"抑制",tabindex:"-1"},[s("抑制 "),i("a",{class:"header-anchor",href:"#抑制","aria-label":'Permalink to "抑制"'},"​")],-1),i("p",null,[s("他的主要作用就是消除冗余告警，我们会受到一个关键的告警信息，这个也是在"),i("code",null,"alertmanager"),s("中配置的，我标签只留了一个，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"inhibit_rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"source_match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":          ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'critical'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    target_match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'warning'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    equal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'instance'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这段配置意思就是当我收到一个告警级别为"),i("code",null,"critical"),s("时，他就会抑制掉"),i("code",null,"warning"),s("这个级别的告警，这个告警等级是在你编写规则的时候定义的，最后一行就是要对哪些告警做抑制，通过标签匹配的，我这里只留了一个"),i("code",null,"instance"),s("，举个最简单的例子，当现在"),i("code",null,"alertmanager"),s("先收到一条"),i("code",null,"critical"),s("、又收到一条"),i("code",null,"warning"),s("且"),i("code",null,"instance"),s("值一致的两条告警他的处理逻辑是怎样的。")],-1),i("p",null,[s("我现在监控"),i("code",null,"nginx"),s("，"),i("code",null,"nginx"),s("宕掉的告警级别为"),i("code",null,"warning"),s("，宿主机宕掉的告警级别为"),i("code",null,"critical"),s("，譬如说现在我跑"),i("code",null,"nginx"),s("的服务器凉了，这时候"),i("code",null,"nginx"),s("肯定也凉了，普罗米修斯发现后通知"),i("code",null,"alertmanager"),s("，普罗米修斯发过来的是两条告警信息，一条是宿主机凉了的，一条是"),i("code",null,"nginx"),s("凉了的，"),i("code",null,"alertmanager"),s("收到之后，发现告警级别一条是"),i("code",null,"critical"),s("，一条是"),i("code",null,"warning"),s("，而且"),i("code",null,"instance"),s("标签值一致，也就是说这是在一台机器上发生的，所以他就会只发一条"),i("code",null,"critical"),s("的告警出来，"),i("code",null,"warning"),s("的就被抑制掉了，我们收到的就是服务器凉了的通知，大概就是这样，暂时不演示了。")],-1),i("h4",{id:"静默",tabindex:"-1"},[s("静默 "),i("a",{class:"header-anchor",href:"#静默","aria-label":'Permalink to "静默"'},"​")],-1),i("p",null,[s("就是一个简单的特定时间静音提醒的机制，主要是使用标签匹配这一批不发送告警，譬如说我某天要对服务器进行维护，可能会涉及到服务器重启，在这期间肯定会有"),i("code",null,"N"),s("多告警发出来，所以你可以子啊这期间配置一个静默，这类的告警就不要发了，我知道发生了啥子事情，配置静默就很简单了，直接在"),i("code",null,"web"),s("页面配置就行了，"),i("code",null,"9093"),s("端口，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715113322.png#mirages-width=1435&mirages-height=425&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715113602.png#mirages-width=1173&mirages-height=769&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("选择开始时间结束时间，通过标签匹配去做，我匹配了"),i("code",null,"job=docker"),s("的机器，创建，所以我先在把容器采集器停掉也不会有告警出来了，我就不停了，就是这样配置，比较简单，扯了一堆，是时候自己写一个告警规则了，结合上面一切的东西。")],-1),i("h2",{id:"编写告警规则栗子",tabindex:"-1"},[s("编写告警规则栗子 "),i("a",{class:"header-anchor",href:"#编写告警规则栗子","aria-label":'Permalink to "编写告警规则栗子"'},"​")],-1),i("p",null,[s("来监控内存吧，内存使用率超过"),i("code",null,"80"),s("我就要告警了，还是先需要写"),i("code",null,"sql"),s("，把我想要的值查出来，所以要查当前内存使用率大于百分之八十的"),i("code",null,"sql"),s("如下，")],-1),i("div",{class:"language-sql"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"sql"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(node_memory_MemTotal_bytes "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node_memory_MemFree_bytes "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node_memory_Buffers_bytes "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node_memory_Cached_bytes) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (node_memory_MemTotal_bytes )"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 100"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 80")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"下面就是要写规则了，我写的规则如下，顺便把之前的规则也改了一下，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/prometheus/rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat memory.yml"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groups"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"memeory_rules")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alert"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"内存炸了")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    expr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"(node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / (node_memory_MemTotal_bytes )* 100 > 80")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"warning")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    annotations"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      summary"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"{{ $labels.instance }} 内存炸了"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      description"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"{{ $labels.instance }} 内存炸了，当前使用率为 {{ $value }}"')])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("这样就可以了撒，我又把明月三千里加入到监控，也就是安装了"),i("code",null,"node_exports"),s("，现在也能正常获取到使用率了，下面试试上面提到的那个告警分配，我要把明月三千里的告警信息发送到我另一个邮箱，"),i("code",null,"job"),s("名字"),i("code",null,"mysql"),s("，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"job_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'mysql'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    static_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'192.168.1.126:9104'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"targets"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'192.168.1.126:9100'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"重启一下撒，能看到这些，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715142721.png#mirages-width=1225&mirages-height=304&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715143146.png#mirages-width=666&mirages-height=692&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,"然后去配置一下告警的分配，我要把关于明月三千里的告警发送到另一个邮箱，所以这里改了一哈，",-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"route"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'alertname'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'default-receiver'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  routes"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"group_by"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'mysql'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      group_wait"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      group_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10s")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      repeat_interval"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'mysql-pager'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      match_re"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        job"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"mysql")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"receivers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'default-receiver'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@xx.com'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'mysql-pager'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  email_configs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"to"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'xxx@xx.cn'")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"inhibit_rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"source_match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":          ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'critical'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    target_match"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'warning'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    equal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'instance'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("所以一会收到明月三千里的邮件是我"),i("code",null,"cn"),s("的邮箱，这样就可以了撒，重启"),i("code",null,"alertmanager"),s("，为了让他发出告警邮件，我调一下阈值，改为百分之"),i("code",null,"20"),s("，所以我"),i("code",null,"com"),s("收到的邮件如下，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715150334.png#mirages-width=971&mirages-height=460&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[i("code",null,"cn"),s("收到的邮件如下")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715150419.png#mirages-width=936&mirages-height=437&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("然后再试一下抑制，我再加一个监控项，我要监控"),i("code",null,"TCP"),s("连接数，状态是"),i("code",null,"ESTABLISHED"),s("的，超过"),i("code",null,"300"),s("我就要告警了，定义告警级别为"),i("code",null,"critical"),s("，所以"),i("code",null,"rule"),s("文件如下，")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"root@rj-bai /usr/local/prometheus/rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cat tcp-established.yml"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groups"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"- "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"tcp-established_rules")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  rules"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"alert"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"TCP连接数过高")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    expr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"node_sockstat_TCP_alloc > 300"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    for"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1m")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    labels"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      severity"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"critical")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    annotations"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      summary"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"{{ $labels.instance }} TCP连接数过高"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      description"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"{{ $labels.instance }} TCP连接数过高，当前连接数 {{ $value }}"')])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"重启后看页面，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715160750.png#mirages-width=1534&mirages-height=809&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("有三条告警已经进入"),i("code",null,"Pending"),s("状态了，没意外的话"),i("code",null,"cn"),s("邮箱只有一条告诉你连接数过高的告警信息发出来了，内存使用率过高的就会被抑制，看一下，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715161059.png#mirages-width=1861&mirages-height=792&mirages-cdn-type=5",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,"所以这条已经被抑制了，",-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715161644.png",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[i("code",null,"248"),s("服务器不受影响，"),i("code",null,"com"),s("邮箱还是会收到内存炸了的告警，")],-1),i("figure",null,[i("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715161714.png",alt:"img",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("就是这样撒，你想编写其他的告警规则流程和上面是一样的，告警的分配和抑制不是必需的，自行琢磨吧，下一篇准备重写"),i("code",null,"K8S"),s("监控方面的东西，了解这些东西之后之后就应该很简单了撒，本篇就这样，过。")],-1)])]),"main-header":l(()=>[h(a.$slots,"main-header")]),"main-header-after":l(()=>[h(a.$slots,"main-header-after")]),"main-nav":l(()=>[h(a.$slots,"main-nav")]),"main-content-before":l(()=>[h(a.$slots,"main-content-before")]),"main-content":l(()=>[h(a.$slots,"main-content")]),"main-content-after":l(()=>[h(a.$slots,"main-content-after")]),"main-nav-before":l(()=>[h(a.$slots,"main-nav-before")]),"main-nav-after":l(()=>[h(a.$slots,"main-nav-after")]),comment:l(()=>[h(a.$slots,"comment")]),footer:l(()=>[h(a.$slots,"footer")]),aside:l(()=>[h(a.$slots,"aside")]),"aside-custom":l(()=>[h(a.$slots,"aside-custom")]),default:l(()=>[h(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{T as default,C as usePageData};
