import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-0662cb8e.js";import{_ as d,c as g,w as s,o as C,a as h,b as n,d as l,e as o,r as t,f as D,p as y}from"./app-79ddcd9b.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-ffbb3f5a.js";import"./YunCard.vue_vue_type_style_index_0_lang-9812589a.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-7ab74174.js";const yn=JSON.parse('{"title":"Nginx平滑升级","description":"","frontmatter":{"title":"Nginx平滑升级","categories":"Linux技术","tags":["Nginx","Nginx平滑升级"],"date":"2023-01-16T21:00:00.000Z"},"headers":[{"level":2,"title":"Nginx信号简介","slug":"nginx信号简介","link":"#nginx信号简介","children":[]},{"level":2,"title":"**主进程支持的信号 **","slug":"主进程支持的信号","link":"#主进程支持的信号","children":[]},{"level":2,"title":"工作进程支持的信号","slug":"工作进程支持的信号","link":"#工作进程支持的信号","children":[]},{"level":2,"title":"1、查看现有的nginx编译参数","slug":"_1、查看现有的nginx编译参数","link":"#_1、查看现有的nginx编译参数","children":[]},{"level":2,"title":"2.上传新版本的源码包nginx-1.22.0.tar.gz，解压缩到/usr/local/","slug":"_2-上传新版本的源码包nginx-1-22-0-tar-gz，解压缩到-usr-local","link":"#_2-上传新版本的源码包nginx-1-22-0-tar-gz，解压缩到-usr-local","children":[]},{"level":2,"title":"3、备份nginx二进制文件（期间nginx不会停止服务）","slug":"_3、备份nginx二进制文件（期间nginx不会停止服务）","link":"#_3、备份nginx二进制文件（期间nginx不会停止服务）","children":[]},{"level":2,"title":"4、复制新的nginx二进制文件，进入新的nginx源码包","slug":"_4、复制新的nginx二进制文件，进入新的nginx源码包","link":"#_4、复制新的nginx二进制文件，进入新的nginx源码包","children":[]},{"level":2,"title":"5、测试新版本的nginx是否正常","slug":"_5、测试新版本的nginx是否正常","link":"#_5、测试新版本的nginx是否正常","children":[]},{"level":2,"title":"6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","slug":"_6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","link":"#_6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","children":[]},{"level":2,"title":"USR2: 启动新的主进程，实现热升级","slug":"usr2-启动新的主进程，实现热升级","link":"#usr2-启动新的主进程，实现热升级","children":[]},{"level":2,"title":"7、查看nginx pid，会出现一个nginx.pid.oldbin","slug":"_7、查看nginx-pid，会出现一个nginx-pid-oldbin","link":"#_7、查看nginx-pid，会出现一个nginx-pid-oldbin","children":[]},{"level":2,"title":"8、从容关闭旧的Nginx进程(WINCH: 逐步关闭工作进程)","slug":"_8、从容关闭旧的nginx进程-winch-逐步关闭工作进程","link":"#_8、从容关闭旧的nginx进程-winch-逐步关闭工作进程","children":[]},{"level":2,"title":"9、此时不重载配置启动旧的工作进程","slug":"_9、此时不重载配置启动旧的工作进程","link":"#_9、此时不重载配置启动旧的工作进程","children":[]},{"level":2,"title":"HUP: 重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","slug":"hup-重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","link":"#hup-重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","children":[]},{"level":2,"title":"10、结束工作进程，完成此次升级","slug":"_10、结束工作进程，完成此次升级","link":"#_10、结束工作进程，完成此次升级","children":[]},{"level":2,"title":"QUIT: 等待请求处理结束后再退出","slug":"quit-等待请求处理结束后再退出","link":"#quit-等待请求处理结束后再退出","children":[]},{"level":2,"title":"11、验证Nginx是否升级成功","slug":"_11、验证nginx是否升级成功","link":"#_11、验证nginx是否升级成功","children":[]}],"relativePath":"pages/posts/nginx-updata.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/nginx-updata.md","lastUpdated":1675999697000}'),i=JSON.parse('{"title":"Nginx平滑升级","description":"","frontmatter":{"title":"Nginx平滑升级","categories":"Linux技术","tags":["Nginx","Nginx平滑升级"],"date":"2023-01-16T21:00:00.000Z"},"headers":[{"level":2,"title":"Nginx信号简介","slug":"nginx信号简介","link":"#nginx信号简介","children":[]},{"level":2,"title":"**主进程支持的信号 **","slug":"主进程支持的信号","link":"#主进程支持的信号","children":[]},{"level":2,"title":"工作进程支持的信号","slug":"工作进程支持的信号","link":"#工作进程支持的信号","children":[]},{"level":2,"title":"1、查看现有的nginx编译参数","slug":"_1、查看现有的nginx编译参数","link":"#_1、查看现有的nginx编译参数","children":[]},{"level":2,"title":"2.上传新版本的源码包nginx-1.22.0.tar.gz，解压缩到/usr/local/","slug":"_2-上传新版本的源码包nginx-1-22-0-tar-gz，解压缩到-usr-local","link":"#_2-上传新版本的源码包nginx-1-22-0-tar-gz，解压缩到-usr-local","children":[]},{"level":2,"title":"3、备份nginx二进制文件（期间nginx不会停止服务）","slug":"_3、备份nginx二进制文件（期间nginx不会停止服务）","link":"#_3、备份nginx二进制文件（期间nginx不会停止服务）","children":[]},{"level":2,"title":"4、复制新的nginx二进制文件，进入新的nginx源码包","slug":"_4、复制新的nginx二进制文件，进入新的nginx源码包","link":"#_4、复制新的nginx二进制文件，进入新的nginx源码包","children":[]},{"level":2,"title":"5、测试新版本的nginx是否正常","slug":"_5、测试新版本的nginx是否正常","link":"#_5、测试新版本的nginx是否正常","children":[]},{"level":2,"title":"6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","slug":"_6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","link":"#_6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","children":[]},{"level":2,"title":"USR2: 启动新的主进程，实现热升级","slug":"usr2-启动新的主进程，实现热升级","link":"#usr2-启动新的主进程，实现热升级","children":[]},{"level":2,"title":"7、查看nginx pid，会出现一个nginx.pid.oldbin","slug":"_7、查看nginx-pid，会出现一个nginx-pid-oldbin","link":"#_7、查看nginx-pid，会出现一个nginx-pid-oldbin","children":[]},{"level":2,"title":"8、从容关闭旧的Nginx进程(WINCH: 逐步关闭工作进程)","slug":"_8、从容关闭旧的nginx进程-winch-逐步关闭工作进程","link":"#_8、从容关闭旧的nginx进程-winch-逐步关闭工作进程","children":[]},{"level":2,"title":"9、此时不重载配置启动旧的工作进程","slug":"_9、此时不重载配置启动旧的工作进程","link":"#_9、此时不重载配置启动旧的工作进程","children":[]},{"level":2,"title":"HUP: 重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","slug":"hup-重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","link":"#hup-重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","children":[]},{"level":2,"title":"10、结束工作进程，完成此次升级","slug":"_10、结束工作进程，完成此次升级","link":"#_10、结束工作进程，完成此次升级","children":[]},{"level":2,"title":"QUIT: 等待请求处理结束后再退出","slug":"quit-等待请求处理结束后再退出","link":"#quit-等待请求处理结束后再退出","children":[]},{"level":2,"title":"11、验证Nginx是否升级成功","slug":"_11、验证nginx是否升级成功","link":"#_11、验证nginx是否升级成功","children":[]}],"relativePath":"pages/posts/nginx-updata.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/nginx-updata.md","lastUpdated":1675999697000}'),x={name:"pages/posts/nginx-updata.md",data(){return{data:i,frontmatter:i.frontmatter}},setup(){y("pageData",i)}},u=n("p",null,"二进制安装的Nginx平滑升级还是有点点麻烦的，这个教程我用它平滑无感知升级过无数次，可放心食用",-1),_={id:"nginx信号简介",tabindex:"-1"},A=n("strong",null,"Nginx信号简介",-1),F={id:"主进程支持的信号",tabindex:"-1"},m=n("p",null,"TERM, INT: 立刻退出",-1),v=n("p",null,"QUIT: 等待工作进程结束后再退出",-1),b=n("p",null,"KILL: 强制终止进程",-1),f=n("p",null,"HUP: 重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。",-1),k=n("p",null,"USR1: 重新打开日志文件",-1),E=n("p",null,"USR2: 启动新的主进程，实现热升级",-1),B=n("p",null,"WINCH: 逐步关闭工作进程",-1),w={id:"工作进程支持的信号",tabindex:"-1"},N=n("strong",null,"工作进程支持的信号",-1),U=n("p",null,"TERM, INT: 立刻退出",-1),$=n("p",null,"QUIT: 等待请求处理结束后再退出",-1),I=n("p",null,"USR1: 重新打开日志文件",-1),S={id:"_1、查看现有的nginx编译参数",tabindex:"-1"},T=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# /usr/local/nginx/sbin/nginx -V")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"nginx"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"version:"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"nginx/1.16.1")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"built"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"by"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"gcc"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"4.8.5"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"20150623"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#89DDFF"}},"("),n("span",{style:{color:"#FFCB6B"}},"Red"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"Hat"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"4.8.5-"),n("span",{style:{color:"#F78C6C"}},"44"),n("span",{style:{color:"#89DDFF"}},")"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#89DDFF"}},"("),n("span",{style:{color:"#FFCB6B"}},"GCC"),n("span",{style:{color:"#89DDFF"}},")"),n("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"built"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"with"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"OpenSSL"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"1.1.0g"),n("span",{style:{color:"#A6ACCD"}},"  "),n("span",{style:{color:"#F78C6C"}},"2"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"Nov"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"2017")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"TLS"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"SNI"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"support"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"enabled")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"configure"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"arguments:"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--prefix=/usr/local/nginx"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--with-http_ssl_module"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--with-openssl=/root/devops/openssl-1.1.0g"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--with-pcre=/root/devops/pcre-8.32"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--with-zlib=/root/devops/zlib-1.2.11"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--with-http_stub_status_module"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"--add-module=/root/devops/nginx-module-vts")]),l(`
`),n("span",{class:"line"})])])],-1),z={id:"_2-上传新版本的源码包nginx-1-22-0-tar-gz，解压缩到-usr-local",tabindex:"-1"},H=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# cd /usr/local/nginx-1.22.0/")]),l(`
`),n("span",{class:"line"}),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao nginx-1.22.0"),n("span",{style:{color:"#89DDFF"}},"]"),n("span",{style:{color:"#A6ACCD"}},"# ./configure --prefix"),n("span",{style:{color:"#89DDFF"}},"="),n("span",{style:{color:"#C3E88D"}},"/usr/local/nginx-1.22.0"),n("span",{style:{color:"#A6ACCD"}}," --with-http_ssl_module --with-openssl"),n("span",{style:{color:"#89DDFF"}},"="),n("span",{style:{color:"#C3E88D"}},"/root/devops/openssl-1.1.0g"),n("span",{style:{color:"#A6ACCD"}},"  --with-pcre"),n("span",{style:{color:"#89DDFF"}},"="),n("span",{style:{color:"#C3E88D"}},"/root/devops/pcre-"),n("span",{style:{color:"#F78C6C"}},"8.32"),n("span",{style:{color:"#A6ACCD"}}," --with-zlib"),n("span",{style:{color:"#89DDFF"}},"="),n("span",{style:{color:"#C3E88D"}},"/root/devops/zlib-1.2.11"),n("span",{style:{color:"#A6ACCD"}}," --with-http_stub_status_module --add-module"),n("span",{style:{color:"#89DDFF"}},"="),n("span",{style:{color:"#C3E88D"}},"/root/devops/nginx-module-vts")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"注意指定依赖包具体位置")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# make")]),l(`
`),n("span",{class:"line"}),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"不要make"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"install"),n("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),n("span",{class:"line"})])])],-1),R={id:"_3、备份nginx二进制文件（期间nginx不会停止服务）",tabindex:"-1"},L=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx_"),n("span",{style:{color:"#89DDFF"}},"`"),n("span",{style:{color:"#FFCB6B"}},"date"),n("span",{style:{color:"#C3E88D"}}," +%F"),n("span",{style:{color:"#89DDFF"}},"`")]),l(`
`),n("span",{class:"line"})])])],-1),P={id:"_4、复制新的nginx二进制文件，进入新的nginx源码包",tabindex:"-1"},V=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# cp /usr/local/nginx/nginx-1.22.0/objs/nginx  /usr/local/nginx/sbin/")]),l(`
`),n("span",{class:"line"})])])],-1),q={id:"_5、测试新版本的nginx是否正常",tabindex:"-1"},Q=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# /usr/local/nginx/sbin/nginx -t")]),l(`
`),n("span",{class:"line"})])])],-1),W={id:"_6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）",tabindex:"-1"},J={id:"usr2-启动新的主进程，实现热升级",tabindex:"-1"},M=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# kill -USR2 "),n("span",{style:{color:"#89DDFF"}},"`"),n("span",{style:{color:"#FFCB6B"}},"cat"),n("span",{style:{color:"#C3E88D"}}," /var/run/nginx.pid"),n("span",{style:{color:"#89DDFF"}},"`")]),l(`
`),n("span",{class:"line"})])])],-1),O={id:"_7、查看nginx-pid，会出现一个nginx-pid-oldbin",tabindex:"-1"},Z=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# ll /var/run/nginx.pid"),n("span",{style:{color:"#89DDFF"}},"*")]),l(`
`),n("span",{class:"line"}),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"-rw-r--r--"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"1"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"root"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"root"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"5"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"Jul"),n("span",{style:{color:"#A6ACCD"}},"  "),n("span",{style:{color:"#F78C6C"}},"1"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"00"),n("span",{style:{color:"#C3E88D"}},":"),n("span",{style:{color:"#F78C6C"}},"00"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"/var/run/nginx.pid")]),l(`
`),n("span",{class:"line"}),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#FFCB6B"}},"-rw-r--r--"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"1"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"root"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"root"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"5"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"Jul"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"1"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#F78C6C"}},"11"),n("span",{style:{color:"#C3E88D"}},":"),n("span",{style:{color:"#F78C6C"}},"11"),n("span",{style:{color:"#A6ACCD"}}," "),n("span",{style:{color:"#C3E88D"}},"/var/run/nginx.pid.oldbin")]),l(`
`),n("span",{class:"line"})])])],-1),j={id:"_8、从容关闭旧的nginx进程-winch-逐步关闭工作进程",tabindex:"-1"},G=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# kill -WINCH "),n("span",{style:{color:"#89DDFF"}},"`"),n("span",{style:{color:"#FFCB6B"}},"cat"),n("span",{style:{color:"#C3E88D"}}," /var/run/nginx.pid.oldbin"),n("span",{style:{color:"#89DDFF"}},"`")]),l(`
`),n("span",{class:"line"})])])],-1),K={id:"_9、此时不重载配置启动旧的工作进程",tabindex:"-1"},X={id:"hup-重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。",tabindex:"-1"},Y=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# kill -HUP "),n("span",{style:{color:"#89DDFF"}},"`"),n("span",{style:{color:"#FFCB6B"}},"cat"),n("span",{style:{color:"#C3E88D"}}," /var/run/nginx.pid.oldbin"),n("span",{style:{color:"#89DDFF"}},"`")]),l(`
`),n("span",{class:"line"})])])],-1),nn={id:"_10、结束工作进程，完成此次升级",tabindex:"-1"},ln={id:"quit-等待请求处理结束后再退出",tabindex:"-1"},sn=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# kill -QUIT "),n("span",{style:{color:"#89DDFF"}},"`"),n("span",{style:{color:"#FFCB6B"}},"cat"),n("span",{style:{color:"#C3E88D"}}," /var/run/nginx.pid.oldbin"),n("span",{style:{color:"#89DDFF"}},"`")]),l(`
`),n("span",{class:"line"})])])],-1),en={id:"_11、验证nginx是否升级成功",tabindex:"-1"},on=n("div",{class:"language-bash"},[n("span",{class:"copy"}),n("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#89DDFF"}},"["),n("span",{style:{color:"#A6ACCD"}},"root@wenmao "),n("span",{style:{color:"#89DDFF"}},"~]"),n("span",{style:{color:"#A6ACCD"}},"# /usr/local/nginx/sbin/nginx -V")]),l(`
`),n("span",{class:"line"})])])],-1);function an(a,tn,rn,cn,r,pn){const e=D,c=p;return C(),g(c,{frontmatter:r.frontmatter,data:r.data},{"main-content-md":s(()=>[u,h(" more "),n("h2",_,[A,l(),o(e,{class:"header-anchor",href:"#nginx信号简介","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),n("h2",F,[l("**主进程支持的信号 ** "),o(e,{class:"header-anchor",href:"#主进程支持的信号","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),m,v,b,f,k,E,B,n("h2",w,[N,l(),o(e,{class:"header-anchor",href:"#工作进程支持的信号","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),U,$,I,n("h2",S,[l("1、查看现有的nginx编译参数 "),o(e,{class:"header-anchor",href:"#_1、查看现有的nginx编译参数","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),T,n("h2",z,[l("2.上传新版本的源码包nginx-1.22.0.tar.gz，解压缩到/usr/local/ "),o(e,{class:"header-anchor",href:"#_2-上传新版本的源码包nginx-1-22-0-tar-gz，解压缩到-usr-local","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),H,n("h2",R,[l("3、备份nginx二进制文件（期间nginx不会停止服务） "),o(e,{class:"header-anchor",href:"#_3、备份nginx二进制文件（期间nginx不会停止服务）","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),L,n("h2",P,[l("4、复制新的nginx二进制文件，进入新的nginx源码包 "),o(e,{class:"header-anchor",href:"#_4、复制新的nginx二进制文件，进入新的nginx源码包","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),V,n("h2",q,[l("5、测试新版本的nginx是否正常 "),o(e,{class:"header-anchor",href:"#_5、测试新版本的nginx是否正常","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),Q,n("h2",W,[l("6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件） "),o(e,{class:"header-anchor",href:"#_6、给nginx发送平滑迁移信号（若不清楚pid路径，请查看nginx配置文件）","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),n("h2",J,[l("USR2: 启动新的主进程，实现热升级 "),o(e,{class:"header-anchor",href:"#usr2-启动新的主进程，实现热升级","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),M,n("h2",O,[l("7、查看nginx pid，会出现一个nginx.pid.oldbin "),o(e,{class:"header-anchor",href:"#_7、查看nginx-pid，会出现一个nginx-pid-oldbin","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),Z,n("h2",j,[l("8、从容关闭旧的Nginx进程(WINCH: 逐步关闭工作进程) "),o(e,{class:"header-anchor",href:"#_8、从容关闭旧的nginx进程-winch-逐步关闭工作进程","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),G,n("h2",K,[l("9、此时不重载配置启动旧的工作进程 "),o(e,{class:"header-anchor",href:"#_9、此时不重载配置启动旧的工作进程","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),n("h2",X,[l("HUP: 重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。 "),o(e,{class:"header-anchor",href:"#hup-重新加载配置文件，使用新的配置启动工作进程，并逐步关闭旧进程。","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),Y,n("h2",nn,[l("10、结束工作进程，完成此次升级 "),o(e,{class:"header-anchor",href:"#_10、结束工作进程，完成此次升级","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),n("h2",ln,[l("QUIT: 等待请求处理结束后再退出 "),o(e,{class:"header-anchor",href:"#quit-等待请求处理结束后再退出","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),sn,n("h2",en,[l("11、验证Nginx是否升级成功 "),o(e,{class:"header-anchor",href:"#_11、验证nginx是否升级成功","aria-hidden":"true"},{default:s(()=>[l("#")]),_:1})]),on]),"main-header":s(()=>[t(a.$slots,"main-header")]),"main-header-after":s(()=>[t(a.$slots,"main-header-after")]),"main-nav":s(()=>[t(a.$slots,"main-nav")]),"main-content":s(()=>[t(a.$slots,"main-content")]),"main-content-after":s(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":s(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":s(()=>[t(a.$slots,"main-nav-after")]),comment:s(()=>[t(a.$slots,"comment")]),footer:s(()=>[t(a.$slots,"footer")]),aside:s(()=>[t(a.$slots,"aside")]),"aside-custom":s(()=>[t(a.$slots,"aside-custom")]),default:s(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter","data"])}const xn=d(x,[["render",an]]);export{yn as __pageData,xn as default};
