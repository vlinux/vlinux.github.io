import{_ as r}from"./ValaxyMain-fde20bcc.js";import{_ as c,p,c as u,w as n,o as d,r as a,b as s,R as e}from"./app-73107480.js";import"./YunFooter-091e638c.js";import"./YunCard-a5dab7a4.js";import"./YunPageHeader-0348731d.js";const E=JSON.parse('{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","description":"","frontmatter":{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","categories":"Kubernetes","tags":["NFS-client"],"date":"2021-01-19T11:30:00.000Z"},"headers":[{"level":2,"title":"一、nfs服务器安装nfs与配置","slug":"一、nfs服务器安装nfs与配置","link":"#一、nfs服务器安装nfs与配置","children":[]},{"level":2,"title":"二、其它客户端服务器安装nfs-utils","slug":"二、其它客户端服务器安装nfs-utils","link":"#二、其它客户端服务器安装nfs-utils","children":[]},{"level":2,"title":"三、部署NFS实现自动创建PV插件：","slug":"三、部署nfs实现自动创建pv插件：","link":"#三、部署nfs实现自动创建pv插件：","children":[]}],"relativePath":"pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","lastUpdated":1671090556000}'),t=JSON.parse('{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","description":"","frontmatter":{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","categories":"Kubernetes","tags":["NFS-client"],"date":"2021-01-19T11:30:00.000Z"},"headers":[{"level":2,"title":"一、nfs服务器安装nfs与配置","slug":"一、nfs服务器安装nfs与配置","link":"#一、nfs服务器安装nfs与配置","children":[]},{"level":2,"title":"二、其它客户端服务器安装nfs-utils","slug":"二、其它客户端服务器安装nfs-utils","link":"#二、其它客户端服务器安装nfs-utils","children":[]},{"level":2,"title":"三、部署NFS实现自动创建PV插件：","slug":"三、部署nfs实现自动创建pv插件：","link":"#三、部署nfs实现自动创建pv插件：","children":[]}],"relativePath":"pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","lastUpdated":1671090556000}'),f={name:"pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md",data(){return{data:t,frontmatter:t.frontmatter}},setup(){p("pageData",t)}},A=s("blockquote",null,[s("p",null,"记录一下小实验，以免以后忘记")],-1),m=s("h2",{id:"一、nfs服务器安装nfs与配置",tabindex:"-1"},[e("一、nfs服务器安装nfs与配置 "),s("a",{class:"header-anchor",href:"#一、nfs服务器安装nfs与配置","aria-hidden":"true"},"#")],-1),y=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"yum -y install nfs-utils rpcbind")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"systemctl  start rpcbind.service ")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"systemctl  start nfs")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"#配置")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mkdir /data/nfs -p")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chow nfsnobody.nfsnobody /data/nfs")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cat>>/etc/exports<<EOF")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/data/nfs 172.16.208.0/20(rw,sync,no_root_squash,no_all_squash)")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"EOF")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"exportfs  -arv")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),C=s("h2",{id:"二、其它客户端服务器安装nfs-utils",tabindex:"-1"},[e("二、其它客户端服务器安装nfs-utils "),s("a",{class:"header-anchor",href:"#二、其它客户端服务器安装nfs-utils","aria-hidden":"true"},"#")],-1),h=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"yum install -y  nfs-utils")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),_=s("h2",{id:"三、部署nfs实现自动创建pv插件：",tabindex:"-1"},[e("三、部署NFS实现自动创建PV插件： "),s("a",{class:"header-anchor",href:"#三、部署nfs实现自动创建pv插件：","aria-hidden":"true"},"#")],-1),g=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"git clone https://github.com/kubernetes-incubator/external-storage")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),v=s("p",null,"上面的Clone下来的仓库由于是官网的所以可能导致内部有些资源是外网资源，无法正常部署跟启动，于是乎博主自己使用科学上网的方式已经把外网资源给PUll下来替换进去了，现在你只需要下载博主提供的就可以了，下载链接在下面@(你懂的)不用谢",-1),b=s("p",null,[e('[file href="'),s("a",{href:"https://wwa.lanzoui.com/i2mohkkammj",target:"_blank",rel:"noreferrer"},"https://wwa.lanzoui.com/i2mohkkammj"),e('"]NFS动态存储类[/file]')],-1),k=s("blockquote",null,[s("p",null,"部署流程如下")],-1),D=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"unzip nfs-client.zip")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cd nfs-client/")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl apply -f rbac.yaml # 授权访问apiserver")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl apply -f deployment.yaml # 部署插件，需修改里面NFS服务器地址与共享目录")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl apply -f class.yaml # 创建存储类")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl get cs # 查看存储类")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),S=s("p",null,"当你出现报错",-1),N=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"pod has unbound immediate PersistentVolumeClaims")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),F=s("p",null,"多半是你的k8s版本高于1.20的问题",-1),x=s("p",null,'第一种解决方法 [tip type="danger" title="使用k8s版本高于v1.20.0的注意"] 修改**/etc/kubernetes/manifests/kube-apiserver.yaml** 文件',-1),$=s("p",null,"添加添加**- --feature-gates=RemoveSelfLink=false**",-1),K=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@master ~]# grep -B 5 'feature-gates' /etc/kubernetes/manifests/kube-apiserver.yaml")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --service-account-key-file=/etc/kubernetes/pki/sa.pub")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --service-account-signing-key-file=/etc/kubernetes/pki/sa.key")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --service-cluster-ip-range=10.96.0.0/12")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --tls-cert-file=/etc/kubernetes/pki/apiserver.crt")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --feature-gates=RemoveSelfLink=false #添加内容")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),L=s("p",null,"[/tip]",-1),M=s("p",null,"第二种解决方法 修改nfs-client的deployment参数：",-1),Y=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl -n kube-system edit deploy <nfs-client-deploy名>")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),w=s("p",null,[e("将其中的.spec.template.spec.containers[0].image参数修改为："),s("a",{href:"http://k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2",target:"_blank",rel:"noreferrer"},"k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2"),e(" 等待nfs-client pod启动即可。")],-1);function P(l,V,U,q,o,z){const i=r;return d(),u(i,{frontmatter:o.frontmatter,data:o.data},{"main-content-md":n(()=>[A,m,y,C,h,_,g,v,b,k,D,S,N,F,x,$,K,L,M,Y,w]),"main-header":n(()=>[a(l.$slots,"main-header")]),"main-header-after":n(()=>[a(l.$slots,"main-header-after")]),"main-nav":n(()=>[a(l.$slots,"main-nav")]),"main-content":n(()=>[a(l.$slots,"main-content")]),"main-content-after":n(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":n(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":n(()=>[a(l.$slots,"main-nav-after")]),comment:n(()=>[a(l.$slots,"comment")]),footer:n(()=>[a(l.$slots,"footer")]),aside:n(()=>[a(l.$slots,"aside")]),"aside-custom":n(()=>[a(l.$slots,"aside-custom")]),default:n(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter","data"])}const J=c(f,[["render",P],["__file","/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md"]]);export{E as __pageData,J as default};
