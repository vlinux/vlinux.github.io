import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang-268858e5.js";import{_ as d,c as _,w as l,o as h,b as e,d as s,e as n,r as a,f as C,p as y}from"./app-a0d158f1.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-e3228d3f.js";import"./YunCard.vue_vue_type_style_index_0_lang-617bf4bc.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-2dccabe0.js";const J=JSON.parse('{"title":"node-exporter扩展用法-shell自定义exporter监控","description":"","frontmatter":{"title":"node-exporter扩展用法-shell自定义exporter监控","categories":"Prometheus","tags":["自定义exporter"],"date":"2019-11-20T11:08:00.000Z"},"headers":[{"level":2,"title":"添加取值脚本","slug":"添加取值脚本","link":"#添加取值脚本","children":[]},{"level":2,"title":"设置定时任务","slug":"设置定时任务","link":"#设置定时任务","children":[]},{"level":2,"title":"添加启动参数","slug":"添加启动参数","link":"#添加启动参数","children":[]},{"level":2,"title":"验证","slug":"验证","link":"#验证","children":[]}],"relativePath":"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","lastUpdated":1671090556000}'),r=JSON.parse('{"title":"node-exporter扩展用法-shell自定义exporter监控","description":"","frontmatter":{"title":"node-exporter扩展用法-shell自定义exporter监控","categories":"Prometheus","tags":["自定义exporter"],"date":"2019-11-20T11:08:00.000Z"},"headers":[{"level":2,"title":"添加取值脚本","slug":"添加取值脚本","link":"#添加取值脚本","children":[]},{"level":2,"title":"设置定时任务","slug":"设置定时任务","link":"#设置定时任务","children":[]},{"level":2,"title":"添加启动参数","slug":"添加启动参数","link":"#添加启动参数","children":[]},{"level":2,"title":"验证","slug":"验证","link":"#验证","children":[]}],"relativePath":"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","lastUpdated":1671090556000}'),u={name:"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md",data(){return{data:r,frontmatter:r.frontmatter}},setup(){y("pageData",r)}},A=e("blockquote",null,[e("p",null,"当Prometheus的node_exporter中没有我们需要的一些监控项时，就可以使用自定义exporter的扩展功能，但是对于那些开发能力稍微弱一些的朋友（特指我），如果你会shell脚本的编写，最基础的awk语法，那么你也可以进行自定义exporter，这就需要借助Node-exporter实现了。")],-1),m=e("p",null,[s("*"),e("em",null,[s("node_exporter 可在启动时指定路径，并将该路径下的 "),e("em",null,".prom 识别为监控数据文件。")])],-1),D={id:"添加取值脚本",tabindex:"-1"},g=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"[root@one tmp]# cat /data/exporter/key/key_runner ")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"#! /bin/bash")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},'echo Logical_CPU_core_total  `cat /proc/cpuinfo| grep "processor"| wc -l`')]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"echo logined_users_total     `who | wc -l`;")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"echo procs_total `ps aux|wc -l`")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"echo procs_zombie       `ps axo pid=,stat=|grep Z|wc -l`")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),x=e("p",null,"执行效果",-1),f=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"[root@one key]# bash  key_runner")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"Logical_CPU_core_total 2")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"logined_users_total 1")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_total 148")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_zombie 0")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),k={id:"设置定时任务",tabindex:"-1"},v=e("blockquote",null,[e("p",null,"每分钟执行一次")],-1),b=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"* * * * * bash /usr/local/node_exporter/key/key_runner > /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),E={id:"添加启动参数",tabindex:"-1"},P=e("p",null,"启动node_exporter，指定新加key值的prom路径",-1),$=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"./node_exporter --collector.textfile.directory=/usr/local/node_exporter-0.16/key")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),F=e("p",null,"如果你是Docker启动，请考虑使用下面这条命令.",-1),L=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"docker"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"run"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-d"),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--net="),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#C3E88D"}},"host"),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--pid="),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#C3E88D"}},"host"),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--name=node-exporter"),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"-v"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#C3E88D"}},"/:/host:ro"),e("span",{style:{color:"#89DDFF"}},'"'),e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#C3E88D"}},"quay.io/prometheus/node-exporter"),e("span",{style:{color:"#A6ACCD"}},"   "),e("span",{style:{color:"#C3E88D"}},"--path.rootfs"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"/host"),e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#C3E88D"}},"--collector.textfile.directory=/host/data/exporter/key/")]),s(`
`),e("span",{class:"line"})])])],-1),U={id:"验证",tabindex:"-1"},w=e("p",null,"查看metrics值是否新增了该监控项",-1),T=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},'[root@one key]# curl 127.0.0.1:9100/metrics|grep -E "Logical_CPU_core_total|logined_users_total|procs_total|procs_zombie"')]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE Logical_CPU_core_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"Logical_CPU_core_total 2")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# HELP logined_users_total Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE logined_users_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"logined_users_total 1")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# HELP procs_total Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE procs_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_total 151")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# HELP procs_zombie Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"# TYPE procs_zombie untyped")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"procs_zombie 0")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1);function z(o,N,B,M,c,S){const t=C,p=i;return h(),_(p,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":l(()=>[A,m,e("h2",D,[s("添加取值脚本 "),n(t,{class:"header-anchor",href:"#添加取值脚本","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),g,x,f,e("h2",k,[s("设置定时任务 "),n(t,{class:"header-anchor",href:"#设置定时任务","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),v,b,e("h2",E,[s("添加启动参数 "),n(t,{class:"header-anchor",href:"#添加启动参数","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),P,$,F,L,e("h2",U,[s("验证 "),n(t,{class:"header-anchor",href:"#验证","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),w,T]),"main-header":l(()=>[a(o.$slots,"main-header")]),"main-header-after":l(()=>[a(o.$slots,"main-header-after")]),"main-nav":l(()=>[a(o.$slots,"main-nav")]),"main-content":l(()=>[a(o.$slots,"main-content")]),"main-content-after":l(()=>[a(o.$slots,"main-content-after")]),"main-nav-before":l(()=>[a(o.$slots,"main-nav-before")]),"main-nav-after":l(()=>[a(o.$slots,"main-nav-after")]),comment:l(()=>[a(o.$slots,"comment")]),footer:l(()=>[a(o.$slots,"footer")]),aside:l(()=>[a(o.$slots,"aside")]),"aside-custom":l(()=>[a(o.$slots,"aside-custom")]),default:l(()=>[a(o.$slots,"default")]),_:3},8,["frontmatter","data"])}const O=d(u,[["render",z]]);export{J as __pageData,O as default};
