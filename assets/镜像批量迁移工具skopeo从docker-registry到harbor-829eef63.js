import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-befed7fa.js";import{_ as d,c as y,w as o,o as h,b as e,U as s,q as n,r as a,W as m,p as C}from"./app-d79bb61a.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-8b4b5bea.js";import"./YunCard.vue_vue_type_style_index_0_lang-fed46e2f.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-20b8fbac.js";const K=JSON.parse('{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","description":"","frontmatter":{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","categories":"Kubernetes","tags":["skopeo"],"date":"2022-09-20T15:23:00.000Z"},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"获取test该namespace下所有服务镜像","slug":"获取test该namespace下所有服务镜像","link":"#获取test该namespace下所有服务镜像","children":[]},{"level":3,"title":"登录两个镜像仓库","slug":"登录两个镜像仓库","link":"#登录两个镜像仓库","children":[]},{"level":3,"title":"迁移","slug":"迁移","link":"#迁移","children":[]}]}],"relativePath":"pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","lastUpdated":1671090556000}'),r=JSON.parse('{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","description":"","frontmatter":{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","categories":"Kubernetes","tags":["skopeo"],"date":"2022-09-20T15:23:00.000Z"},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"获取test该namespace下所有服务镜像","slug":"获取test该namespace下所有服务镜像","link":"#获取test该namespace下所有服务镜像","children":[]},{"level":3,"title":"登录两个镜像仓库","slug":"登录两个镜像仓库","link":"#登录两个镜像仓库","children":[]},{"level":3,"title":"迁移","slug":"迁移","link":"#迁移","children":[]}]}],"relativePath":"pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","lastUpdated":1671090556000}'),D={name:"pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md",data(){return{data:r,frontmatter:r.frontmatter}},setup(){C("pageData",r)}},u={id:"背景",tabindex:"-1"},k=e("p",null,"本例将docker-registry镜像迁移至 harbor",-1),g={id:"安装",tabindex:"-1"},f=e("blockquote",null,[e("p",null,"可以从github项目直接下载使用二进制命令"),e("p",null,"也可以在centos服务器上直接yum安装,需要epel源")],-1),_=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"yum"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-y"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"install"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"skopeo")]),s(`
`),e("span",{class:"line"})])])],-1),A={id:"获取test该namespace下所有服务镜像",tabindex:"-1"},b=e("blockquote",null,[e("p",null,"这里我的原镜像为docker-registry")],-1),F=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"kubectl"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"get"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"deployment,statefulset,daemonset"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-o"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"custom-columns="),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#C3E88D"}},"NAME:metadata.name,IMAGES:spec.template.spec.containers[*].image"),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-n"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"test"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},">"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"all-image")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#676E95","font-style":"italic"}},"## 获取到所有image之后将域名去掉只保留除域名外")]),s(`
`),e("span",{class:"line"})])])],-1),v={id:"登录两个镜像仓库",tabindex:"-1"},E=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"docker login harbor.kcooc.cn")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"docker login docker-registry.kococ.cn")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),$={id:"迁移",tabindex:"-1"},B=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",{class:"shiki material-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"cat"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"mv-image.sh")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#676E95","font-style":"italic"}},"#!/bin/bash")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF","font-style":"italic"}},"for"),e("span",{style:{color:"#A6ACCD"}}," i "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"in"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"`"),e("span",{style:{color:"#FFCB6B"}},"cat"),e("span",{style:{color:"#C3E88D"}}," all-image"),e("span",{style:{color:"#89DDFF"}},"`"),e("span",{style:{color:"#89DDFF"}},";"),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"do")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"skopeo"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"copy"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"docker://docker-registry.kococ.cn/"),e("span",{style:{color:"#89DDFF"}},"${"),e("span",{style:{color:"#A6ACCD"}},"i"),e("span",{style:{color:"#89DDFF"}},"}"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"docker://harbor.kococ.cn/"),e("span",{style:{color:"#89DDFF"}},"${"),e("span",{style:{color:"#A6ACCD"}},"i"),e("span",{style:{color:"#89DDFF"}},"}"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"--authfile"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"/root/.docker/config.json")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF","font-style":"italic"}},"done")]),s(`
`),e("span",{class:"line"})])])],-1);function x(l,N,U,q,c,S){const t=m,i=p;return h(),y(i,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":o(()=>[e("h2",u,[s("背景 "),n(t,{class:"header-anchor",href:"#背景","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),e("blockquote",null,[e("p",null,[s("docker-registry地址："),n(t,{href:"http://docker-registry.kococ.cn",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("docker-registry.kococ.cn")]),_:1})]),e("p",null,[s("新镜像仓库harbor地址："),n(t,{href:"http://harbor.kococ.cn",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("harbor.kococ.cn")]),_:1})]),k]),e("h3",g,[s("安装 "),n(t,{class:"header-anchor",href:"#安装","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),f,_,e("h3",A,[s("获取test该namespace下所有服务镜像 "),n(t,{class:"header-anchor",href:"#获取test该namespace下所有服务镜像","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),b,F,e("h3",v,[s("登录两个镜像仓库 "),n(t,{class:"header-anchor",href:"#登录两个镜像仓库","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),E,e("h3",$,[s("迁移 "),n(t,{class:"header-anchor",href:"#迁移","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),B]),"main-header":o(()=>[a(l.$slots,"main-header")]),"main-header-after":o(()=>[a(l.$slots,"main-header-after")]),"main-nav":o(()=>[a(l.$slots,"main-nav")]),"main-content":o(()=>[a(l.$slots,"main-content")]),"main-content-after":o(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":o(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":o(()=>[a(l.$slots,"main-nav-after")]),comment:o(()=>[a(l.$slots,"comment")]),footer:o(()=>[a(l.$slots,"footer")]),aside:o(()=>[a(l.$slots,"aside")]),"aside-custom":o(()=>[a(l.$slots,"aside-custom")]),default:o(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter","data"])}const O=d(D,[["render",x]]);export{K as __pageData,O as default};
