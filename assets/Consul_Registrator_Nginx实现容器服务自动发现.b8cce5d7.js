import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang.1aa046e0.js";import{_ as r,c as p,w as s,o as u,r as o,g as n,R as l,p as d}from"./app.f8763b1f.js";import"./YunFooter.vue_vue_type_script_setup_true_lang.9e45df7a.js";import"./YunCard.vue_vue_type_style_index_0_lang.ee20fc38.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.3a09cd11.js";const xl=JSON.parse('{"title":"Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0","description":"","frontmatter":{"title":"Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0","categories":"\u5FAE\u670D\u52A1","tags":["Consul+Registrator+Nginx","\u5FAE\u670D\u52A1"],"date":"2019-01-01T15:34:00.000Z"},"headers":[{"level":2,"title":"1.\u4E86\u89E3consul","slug":"_1-\u4E86\u89E3consul","link":"#_1-\u4E86\u89E3consul","children":[{"level":3,"title":"1.1 \u67B6\u6784\u8BBE\u8BA1","slug":"_1-1-\u67B6\u6784\u8BBE\u8BA1","link":"#_1-1-\u67B6\u6784\u8BBE\u8BA1","children":[]},{"level":3,"title":"1.2 \u67B6\u6784\u4F18\u52BF","slug":"_1-2-\u67B6\u6784\u4F18\u52BF","link":"#_1-2-\u67B6\u6784\u4F18\u52BF","children":[]}]},{"level":2,"title":"2.\u73AF\u5883\u8BF4\u660E","slug":"_2-\u73AF\u5883\u8BF4\u660E","link":"#_2-\u73AF\u5883\u8BF4\u660E","children":[]},{"level":2,"title":"3.\u90E8\u7F72nginx","slug":"_3-\u90E8\u7F72nginx","link":"#_3-\u90E8\u7F72nginx","children":[{"level":3,"title":"3.1 \u5B89\u88C5nginx","slug":"_3-1-\u5B89\u88C5nginx","link":"#_3-1-\u5B89\u88C5nginx","children":[]},{"level":3,"title":"3.2 \u5B89\u88C5consul-template","slug":"_3-2-\u5B89\u88C5consul-template","link":"#_3-2-\u5B89\u88C5consul-template","children":[]}]},{"level":2,"title":"4.\u90E8\u7F72consul","slug":"_4-\u90E8\u7F72consul","link":"#_4-\u90E8\u7F72consul","children":[{"level":3,"title":"4.1 \u5B89\u88C5consul","slug":"_4-1-\u5B89\u88C5consul","link":"#_4-1-\u5B89\u88C5consul","children":[]},{"level":3,"title":"4.2 \u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","slug":"_4-2-\u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","link":"#_4-2-\u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","children":[]},{"level":3,"title":"4.3 \u901A\u8FC7http api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","slug":"_4-3-\u901A\u8FC7http-api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","link":"#_4-3-\u901A\u8FC7http-api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","children":[]}]},{"level":2,"title":"5.\u914D\u7F6Enginx","slug":"_5-\u914D\u7F6Enginx","link":"#_5-\u914D\u7F6Enginx","children":[{"level":3,"title":"5.1 \u521B\u5EFAnginx.ctmpl\u6A21\u677F","slug":"_5-1-\u521B\u5EFAnginx-ctmpl\u6A21\u677F","link":"#_5-1-\u521B\u5EFAnginx-ctmpl\u6A21\u677F","children":[]},{"level":3,"title":"5.2 \u4FEE\u6539nginx.conf","slug":"_5-2-\u4FEE\u6539nginx-conf","link":"#_5-2-\u4FEE\u6539nginx-conf","children":[]},{"level":3,"title":"5.3 \u8FD0\u884Cconsul-template\u8FDB\u7A0B","slug":"_5-3-\u8FD0\u884Cconsul-template\u8FDB\u7A0B","link":"#_5-3-\u8FD0\u884Cconsul-template\u8FDB\u7A0B","children":[]}]},{"level":2,"title":"6.\u90E8\u7F72docker","slug":"_6-\u90E8\u7F72docker","link":"#_6-\u90E8\u7F72docker","children":[{"level":3,"title":"6.1 \u5B89\u88C5docker\u670D\u52A1","slug":"_6-1-\u5B89\u88C5docker\u670D\u52A1","link":"#_6-1-\u5B89\u88C5docker\u670D\u52A1","children":[]},{"level":3,"title":"6.2 \u521B\u5EFAregistrator\u5BB9\u5668","slug":"_6-2-\u521B\u5EFAregistrator\u5BB9\u5668","link":"#_6-2-\u521B\u5EFAregistrator\u5BB9\u5668","children":[]}]}],"relativePath":"pages/posts/Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0.md","path":"/Users/vlinux/vlinux/blog/valaxy/valaxy-vlinux/pages/posts/Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0.md","lastUpdated":0}'),a=JSON.parse('{"title":"Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0","description":"","frontmatter":{"title":"Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0","categories":"\u5FAE\u670D\u52A1","tags":["Consul+Registrator+Nginx","\u5FAE\u670D\u52A1"],"date":"2019-01-01T15:34:00.000Z"},"headers":[{"level":2,"title":"1.\u4E86\u89E3consul","slug":"_1-\u4E86\u89E3consul","link":"#_1-\u4E86\u89E3consul","children":[{"level":3,"title":"1.1 \u67B6\u6784\u8BBE\u8BA1","slug":"_1-1-\u67B6\u6784\u8BBE\u8BA1","link":"#_1-1-\u67B6\u6784\u8BBE\u8BA1","children":[]},{"level":3,"title":"1.2 \u67B6\u6784\u4F18\u52BF","slug":"_1-2-\u67B6\u6784\u4F18\u52BF","link":"#_1-2-\u67B6\u6784\u4F18\u52BF","children":[]}]},{"level":2,"title":"2.\u73AF\u5883\u8BF4\u660E","slug":"_2-\u73AF\u5883\u8BF4\u660E","link":"#_2-\u73AF\u5883\u8BF4\u660E","children":[]},{"level":2,"title":"3.\u90E8\u7F72nginx","slug":"_3-\u90E8\u7F72nginx","link":"#_3-\u90E8\u7F72nginx","children":[{"level":3,"title":"3.1 \u5B89\u88C5nginx","slug":"_3-1-\u5B89\u88C5nginx","link":"#_3-1-\u5B89\u88C5nginx","children":[]},{"level":3,"title":"3.2 \u5B89\u88C5consul-template","slug":"_3-2-\u5B89\u88C5consul-template","link":"#_3-2-\u5B89\u88C5consul-template","children":[]}]},{"level":2,"title":"4.\u90E8\u7F72consul","slug":"_4-\u90E8\u7F72consul","link":"#_4-\u90E8\u7F72consul","children":[{"level":3,"title":"4.1 \u5B89\u88C5consul","slug":"_4-1-\u5B89\u88C5consul","link":"#_4-1-\u5B89\u88C5consul","children":[]},{"level":3,"title":"4.2 \u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","slug":"_4-2-\u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","link":"#_4-2-\u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","children":[]},{"level":3,"title":"4.3 \u901A\u8FC7http api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","slug":"_4-3-\u901A\u8FC7http-api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","link":"#_4-3-\u901A\u8FC7http-api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","children":[]}]},{"level":2,"title":"5.\u914D\u7F6Enginx","slug":"_5-\u914D\u7F6Enginx","link":"#_5-\u914D\u7F6Enginx","children":[{"level":3,"title":"5.1 \u521B\u5EFAnginx.ctmpl\u6A21\u677F","slug":"_5-1-\u521B\u5EFAnginx-ctmpl\u6A21\u677F","link":"#_5-1-\u521B\u5EFAnginx-ctmpl\u6A21\u677F","children":[]},{"level":3,"title":"5.2 \u4FEE\u6539nginx.conf","slug":"_5-2-\u4FEE\u6539nginx-conf","link":"#_5-2-\u4FEE\u6539nginx-conf","children":[]},{"level":3,"title":"5.3 \u8FD0\u884Cconsul-template\u8FDB\u7A0B","slug":"_5-3-\u8FD0\u884Cconsul-template\u8FDB\u7A0B","link":"#_5-3-\u8FD0\u884Cconsul-template\u8FDB\u7A0B","children":[]}]},{"level":2,"title":"6.\u90E8\u7F72docker","slug":"_6-\u90E8\u7F72docker","link":"#_6-\u90E8\u7F72docker","children":[{"level":3,"title":"6.1 \u5B89\u88C5docker\u670D\u52A1","slug":"_6-1-\u5B89\u88C5docker\u670D\u52A1","link":"#_6-1-\u5B89\u88C5docker\u670D\u52A1","children":[]},{"level":3,"title":"6.2 \u521B\u5EFAregistrator\u5BB9\u5668","slug":"_6-2-\u521B\u5EFAregistrator\u5BB9\u5668","link":"#_6-2-\u521B\u5EFAregistrator\u5BB9\u5668","children":[]}]}],"relativePath":"pages/posts/Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0.md","path":"/Users/vlinux/vlinux/blog/valaxy/valaxy-vlinux/pages/posts/Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0.md","lastUpdated":0}'),g={name:"pages/posts/Consul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0.md",data(){return{data:a,frontmatter:a.frontmatter}},setup(){d("pageData",a)}},h=n("h1",{id:"\u57FA\u4E8Econsul-registrator-nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6",tabindex:"-1"},[l("\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6 "),n("a",{class:"header-anchor",href:"#\u57FA\u4E8Econsul-registrator-nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6","aria-hidden":"true"},"#")],-1),_=n("blockquote",null,[n("p",null,"\u6211\u4EEC\u5148\u6765\u770B\u4E00\u4E0B\u670D\u52A1\u53D1\u73B0\u5E38\u7528\u7684\u6846\u67B6\u6709\u54EA\u4E9B\uFF1A"),n("ul",null,[n("li",null,"zookeeper"),n("li",null,"eureka"),n("li",null,"etcd"),n("li",null,"consul")])],-1),C=n("p",null,[l("\u8FD9\u91CC\u5C31\u4E0D\u6328\u4E2A\u6765\u4ECB\u7ECD\u5B83\u4EEC\u4E86\uFF0C\u672C\u6587\u4E2D\u4E3B\u8981\u4EE5consul\u4E3A\u4E3B\uFF0C\u5982\u679C\u4F60\u5728\u5927\u91CF\u63A5\u89E6\u6216\u4F7F\u7528\u5FAE\u670D\u52A1\u7684\u8BDD\uFF0C\u4F60\u53EF\u80FD\u4F1A\u78B0\u5230\u4E00\u4E2A\u95EE\u9898\uFF1F\u5F53\u4F60\u521B\u5EFA\u7684\u670D\u52A1\u6570\u91CF\u8D8A\u6765\u8D8A\u591A\u65F6\uFF0C\u8FD9\u4E9B\u670D\u52A1\u4E4B\u95F4\u7684\u901A\u4FE1\u4FBF\u8D8A\u96BE\u7BA1\u7406\uFF0C\u800C\u4E14\u7EF4\u62A4\u4EE3\u4EF7\u4F1A\u8D8A\u6765\u8D8A\u9AD8\u3002consul\u53EF\u4EE5\u7ED9\u4F60\u7B54\u6848\uFF0C\u6211\u4EEC\u4E00\u8D77\u6765\u4E86\u89E3\u4E00\u4E0Bconsul\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/41b1033a119139c1375c52d5300eced9.jpg",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),A=n("h2",{id:"_1-\u4E86\u89E3consul",tabindex:"-1"},[l("1.\u4E86\u89E3consul "),n("a",{class:"header-anchor",href:"#_1-\u4E86\u89E3consul","aria-hidden":"true"},"#")],-1),m=n("p",null,"Consul\u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\uFF0C\u9AD8\u5EA6\u53EF\u7528\u4E14\u652F\u6301\u591A\u6570\u636E\u4E2D\u5FC3\u7684\u670D\u52A1\u53D1\u73B0\uFF0C\u914D\u7F6E\u548C\u7F16\u6392\u5DE5\u5177\u3002 Consul\u652F\u6301\u5927\u89C4\u6A21\u90E8\u7F72\uFF0C\u914D\u7F6E\u548C\u7EF4\u62A4\u9762\u5411\u670D\u52A1\u7684\u4F53\u7CFB\u7ED3\u6784\u3002 \u6B32\u4E86\u89E3\u66F4\u591A\u5B98\u65B9\u4FE1\u606F\uFF0C\u8BF7\u53C2\u9605\uFF1A",-1),x=n("ul",null,[n("li",null,[n("a",{href:"https://www.consul.io/",target:"_blank",rel:"noreferrer"},"consul \u6587\u6863")]),n("li",null,[n("a",{href:"https://github.com/hashicorp/consul",target:"_blank",rel:"noreferrer"},"consul github")])],-1),y=n("h3",{id:"_1-1-\u67B6\u6784\u8BBE\u8BA1",tabindex:"-1"},[l("1.1 \u67B6\u6784\u8BBE\u8BA1 "),n("a",{class:"header-anchor",href:"#_1-1-\u67B6\u6784\u8BBE\u8BA1","aria-hidden":"true"},"#")],-1),k=n("p",null,"\u5728\u73B0\u5B9E\u4E2D\uFF0C\u6211\u4EEC\u4E00\u76F4\u6E34\u671B\u7740\u8FFD\u6C42\u63D0\u4F9B\u9AD8\u8D28\u91CF\u3001\u9AD8\u53EF\u7528\u7684\u670D\u52A1\u67B6\u6784\u4F53\u7CFB\uFF0C\u540C\u65F6\u51CF\u5C11\u4E0D\u5FC5\u8981\u7684\u90E8\u7F72\u548C\u7EF4\u62A4\u4EE3\u4EF7\uFF0C\u51CF\u5C11\u5BB9\u9519\u7387\u3002\u9762\u5BF9\u5982\u6B64\u9AD8\u7684\u8981\u6C42\uFF0C\u53EF\u4EE5\u6709\u4E24\u79CD\u67B6\u6784\u65B9\u6848\uFF1A",-1),v=n("ul",null,[n("li",null,"Docker+Etcd+Confd+Nginx"),n("li",null,"Docker+Consul+Nginx")],-1),D=n("p",null,[l("\u672C\u6587\u4E2D\u6211\u4EEC\u4E3B\u8981\u6765\u4ECB\u7ECD Docker+Consul+Nginx\u65B9\u6848\uFF0C\u6B64\u65B9\u6848\u66F4\u52A0\u9AD8\u6548\u3001\u5FEB\u6377\uFF0C\u5E76\u4E14\u7EF4\u62A4\u4EE3\u4EF7\u548C\u5BB9\u9519\u7387\u66F4\u4F4E\uFF0C\u5206\u5E03\u5F0F\u652F\u6301\u529B\u5EA6\u66F4\u5F3A\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/de11c5f722122d7f4f64b27c0d56a7a3.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),b=n("p",null,"\u4F7F\u7528Docker\u5C06Consul\u3001Consul Template\u3001Registrator\u548CNginx\u7EC4\u88C5\u6210\u4E00\u4E2A\u503C\u5F97\u4FE1\u4EFB\u4E14\u53EF\u6269\u5C55\u7684\u670D\u52A1\u6846\u67B6\uFF0C\u8FD9\u5957\u67B6\u6784\u8BA9\u4F60\u5728\u8FD9\u4E2A\u6846\u67B6\u4E2D\u6DFB\u52A0\u548C\u79FB\u9664\u670D\u52A1\uFF0C\u4E0D\u9700\u8981\u91CD\u5199\u4EFB\u4F55\u914D\u7F6E\uFF0C\u4E5F\u4E0D\u9700\u8981\u91CD\u542F\u4EFB\u4F55\u670D\u52A1\uFF0C\u4E00\u5207\u90FD\u80FD\u6B63\u5E38\u8FD0\u884C\uFF0C\u5DE5\u4F5C\u6D41\u7A0B\u5F88\u7B80\u5355\uFF1A",-1),f=n("blockquote",null,[n("p",null,"docker\u8282\u70B9 ---------> consul ---------> nginx.conf")],-1),w=n("h3",{id:"_1-2-\u67B6\u6784\u4F18\u52BF",tabindex:"-1"},[l("1.2 \u67B6\u6784\u4F18\u52BF "),n("a",{class:"header-anchor",href:"#_1-2-\u67B6\u6784\u4F18\u52BF","aria-hidden":"true"},"#")],-1),N=n("p",null,"Docker+Consul+Nginx\u867D\u7136\u770B\u8D77\u6765\u662F\u4E09\u4E2A\u7EC4\u4EF6\u7684\u8FD0\u7528\uFF0C\u4F46\u5374\u8BC1\u660E\u662F\u4E00\u4E2A\u6709\u673A\u7684\u6574\u4F53\u3002\u5B83\u4EEC\u4E92\u76F8\u8054\u7CFB\u3001\u4E92\u76F8\u4F5C\u7528\uFF0C\u5B8C\u5168\u6EE1\u8DB3\u6211\u4EEC\u5BF9\u9AD8\u53EF\u7528\u3001\u9AD8\u6548\u670D\u52A1\u67B6\u6784\u65B9\u6848\u7684\u9700\u6C42\uFF0C\u662FDocker\u751F\u6001\u5708\u4E2D\u6700\u7406\u60F3\u7684\u7EC4\u5408\u4E4B\u4E00\uFF0C\u5177\u6709\u4EE5\u4E0B\u4F18\u52BF\uFF1A",-1),R=n("ol",null,[n("li",null,"\u81EA\u52A8\u53D1\u73B0\u4E0E\u6CE8\u518C\u7EC4\u4EF6consul\u4F7F\u7528 Raft \u7B97\u6CD5\u6765\u4FDD\u8BC1\u4E00\u81F4\u6027\uFF0C\u6BD4\u590D\u6742\u7684Paxos \u7B97\u6CD5\u66F4\u76F4\u63A5\u3002\u76F8\u6BD4\u8F83\u800C\u8A00\uFF0Czookeeper \u91C7\u7528\u7684\u662F Paxos\uFF0C\u800C etcd \u4F7F\u7528\u7684\u5219\u662F Raft\uFF1B"),n("li",null,"\u652F\u6301\u591A\u6570\u636E\u4E2D\u5FC3\uFF0C\u591A\u6570\u636E\u4E2D\u5FC3\u96C6\u7FA4\u53EF\u4EE5\u907F\u514D\u5355\u6570\u636E\u4E2D\u5FC3\u7684\u5355\u70B9\u6545\u969C\uFF0Czookeeper \u548C etcd \u5747\u4E0D\u63D0\u4F9B\u591A\u6570\u636E\u4E2D\u5FC3\u529F\u80FD\u7684\u652F\u6301\uFF1B"),n("li",null,"\u81EA\u52A8\u3001\u5B9E\u65F6\u53D1\u73B0\u53CA\u65E0\u611F\u77E5\u670D\u52A1\u5237\u65B0\uFF0C\u5177\u5907\u8D44\u6E90\u5F39\u6027\uFF0C\u4F38\u7F29\u81EA\u5982\uFF1B"),n("li",null,"\u652F\u6301\u5065\u5EB7\u68C0\u67E5\uFF0C\u8D1F\u8F7D\u80FD\u52A8\u6001\u5728\u53EF\u7528\u7684\u670D\u52A1\u5B9E\u4F8B\u4E0A\u8FDB\u884C\u5747\u8861\uFF0Cetcd \u4E0D\u63D0\u4F9B\u6B64\u529F\u80FD\uFF1B"),n("li",null,"\u652F\u6301\u8DB3\u591F\u591A\u53F0Docker\u5BB9\u5668(\u524D\u63D0\u67B6\u6784\u8D44\u6E90\u8DB3\u4EE5\u4FDD\u8BC1\u6027\u80FD\u652F\u6491)\uFF1B"),n("li",null,"\u652F\u6301http \u548Cdns \u534F\u8BAE\u63A5\u53E3\uFF0Czookeeper \u7684\u96C6\u6210\u8F83\u4E3A\u590D\u6742\uFF0Cetcd \u53EA\u652F\u6301 http \u534F\u8BAE\uFF1B"),n("li",null,"\u670D\u52A1\u89C4\u6A21\u65B9\u4FBF\u8FDB\u884C\u5FEB\u901F\u8C03\u6574\uFF0C\u5B98\u65B9\u63D0\u4F9Bweb\u7BA1\u7406\u754C\u9762\uFF0Cetcd \u65E0\u6B64\u529F\u80FD\uFF1B"),n("li",null,"Consul template \u642D\u914Dconsul\u4F7F\u7528\uFF0C\u652F\u6301\u591A\u79CD\u63A5\u5165\u5C42\uFF0C\u5982Nginx\u3001Haproxy\u3002")],-1),q=n("h2",{id:"_2-\u73AF\u5883\u8BF4\u660E",tabindex:"-1"},[l("2.\u73AF\u5883\u8BF4\u660E "),n("a",{class:"header-anchor",href:"#_2-\u73AF\u5883\u8BF4\u660E","aria-hidden":"true"},"#")],-1),I=n("p",null,"\u672C\u6587\u6240\u7528\u7684\u73AF\u5883\u5747\u63091.1\u4E2D\u7684\u67B6\u6784\u56FE\u6765\u90E8\u7F72\uFF0Cnginx\u75281\u53F0\u670D\u52A1\u5668\u3001consul\u75281\u53F0\u670D\u52A1\u5668\u3001docker host\u75282\u53F0\u670D\u52A1\u5668\uFF0C\u5171\u75284\u53F0\u670D\u52A1\u5668\u6765\u90E8\u7F72\uFF0C\u5F53\u7136\u5982\u679C\u4F60\u7684\u670D\u52A1\u5668\u7D27\u5F20\uFF0C\u75283\u53F0\u4E5F\u4E00\u6837\uFF0C\u51CF\u5C111\u53F0docker host\u5C31\u884C\uFF1A",-1),$=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"\u670D\u52A1\u5668IP"),n("th",null,"\u670D\u52A1\u5668\u540D"),n("th",null,"\u89D2\u8272")])]),n("tbody",null,[n("tr",null,[n("td",null,"172.18.18.32"),n("td",null,"nginx"),n("td",null,"\u8FD0\u884Cnginx\u670D\u52A1\u3001consul-template\u5B88\u62A4\u8FDB\u7A0B")]),n("tr",null,[n("td",null,"172.18.18.33"),n("td",null,"consul"),n("td",null,"\u8FD0\u884Cconsul\u670D\u52A1")]),n("tr",null,[n("td",null,"172.18.18.34"),n("td",null,"docker01"),n("td",null,"\u8FD0\u884Cregistrator\u5BB9\u5668\u3001\u8FD0\u884Cnginx\u5BB9\u5668\uFF08\u6620\u5C04\u7AEF\u53E381\u300182\uFF09")]),n("tr",null,[n("td",null,"172.18.18.35"),n("td",null,"docker02"),n("td",null,"\u8FD0\u884Cregistrator\u5BB9\u5668\u3001\u8FD0\u884Cnginx\u5BB9\u5668\uFF08\u6620\u5C04\u7AEF\u53E383\u300184\uFF09")])])],-1),E=n("h2",{id:"_3-\u90E8\u7F72nginx",tabindex:"-1"},[l("3.\u90E8\u7F72nginx "),n("a",{class:"header-anchor",href:"#_3-\u90E8\u7F72nginx","aria-hidden":"true"},"#")],-1),S=n("blockquote",null,[n("p",null,"\u5728nginx\u670D\u52A1\u5668\u4E0A\u64CD\u4F5C")],-1),z=n("h3",{id:"_3-1-\u5B89\u88C5nginx",tabindex:"-1"},[l("3.1 \u5B89\u88C5nginx "),n("a",{class:"header-anchor",href:"#_3-1-\u5B89\u88C5nginx","aria-hidden":"true"},"#")],-1),P=n("p",null,"1\u3001\u4E0B\u8F7D\u5E76\u89E3\u538Bnginx\uFF1A \u4F60\u53EF\u4EE5\u7528docker\u7684\u65B9\u6848\u8FD0\u884Cnginx\u3001\u4E5F\u53EF\u4EE5\u7528\u6E90\u7801\u5305\u7F16\u8BD1\u5B89\u88C5nginx\u3002\u5728\u672C\u6587\u4E2Dnginx\u7528\u6E90\u7801\u5305\u7684\u65B9\u5F0F\u5B89\u88C5",-1),O=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx /]# cd /usr/src/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx src /]# tar -zxvf nginx-1.12.1.tar.gz")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),T=n("p",null,"2\u3001\u7F16\u8BD1\u5B89\u88C5nginx\uFF1A",-1),U=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx src]# yum -y install gcc gcc-c++ make openssl-devel pcre-devel")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx src]# cd nginx-1.12.1/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx nginx-1.12.1]# ./configure --prefix=/usr/local/nginx   --with-http_stub_status_module --with-http_realip_module --with-pcre  --with-http_ssl_module")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx nginx-1.12.1]# make -j 2")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx nginx-1.12.1]# make install")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),V=n("h3",{id:"_3-2-\u5B89\u88C5consul-template",tabindex:"-1"},[l("3.2 \u5B89\u88C5consul-template "),n("a",{class:"header-anchor",href:"#_3-2-\u5B89\u88C5consul-template","aria-hidden":"true"},"#")],-1),F=n("p",null,[l("\u5B89\u88C5consul-template\u975E\u5E38\u7B80\u5355\uFF0C\u4E0B\u8F7D\u4E8C\u8FDB\u5236\u5305\u5373\u53EF\u4F7F\u7528 1\u3001\u4E0B\u8F7Dconsul-template \u4E0B\u8F7D\u5730\u5740\uFF1A"),n("a",{href:"https://releases.hashicorp.com/consul-template/0.19.3/consul-template_0.19.3_linux_amd64.zip",target:"_blank",rel:"noreferrer"},"https://releases.hashicorp.com/consul-template/0.19.3/consul-template_0.19.3_linux_amd64.zip")],-1),j=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx ]# wget https://releases.hashicorp.com/consul-template/0.19.3/consul-template_0.19.3_linux_amd64.zip")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),B=n("p",null,"2\u3001\u89E3\u538B\u5E76\u5B89\u88C5\u5230/usr/bin\u76EE\u5F55",-1),H=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx ]# unzip consul-template_0.19.3_linux_amd64.zip")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx ]# mv consul-template /usr/bin/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),J=n("h2",{id:"_4-\u90E8\u7F72consul",tabindex:"-1"},[l("4.\u90E8\u7F72consul "),n("a",{class:"header-anchor",href:"#_4-\u90E8\u7F72consul","aria-hidden":"true"},"#")],-1),L=n("blockquote",null,[n("p",null,"\u5728consul\u670D\u52A1\u5668\u4E0A\u64CD\u4F5C")],-1),Z=n("h3",{id:"_4-1-\u5B89\u88C5consul",tabindex:"-1"},[l("4.1 \u5B89\u88C5consul "),n("a",{class:"header-anchor",href:"#_4-1-\u5B89\u88C5consul","aria-hidden":"true"},"#")],-1),K=n("p",null,[l("\u6709\u4E24\u79CD\u65B9\u5F0F\u5B89\u88C5consul\uFF08\u5BB9\u5668\u3001\u4E8C\u8FDB\u5236\u5305\uFF09\uFF0C\u5728\u672C\u6587\u4E2D\u9009\u4F7F\u7528\u4E8C\u5236\u5305\u7684\u65B9\u5F0F\u3002 1\u3001\u4E0B\u8F7Dconsul\u4E8C\u8FDB\u5236\u5305 \u4E0B\u8F7D\u5730\u5740 "),n("a",{href:"https://www.consul.io/downloads.html",target:"_blank",rel:"noreferrer"},"https://www.consul.io/downloads.html")],-1),M=n("p",null,"2\u3001\u89E3\u538B\u3001\u5B89\u88C5",-1),Y=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#unzip consul_0.9.2_linux_amd64.zip")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#mv consul /usr/bin/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),G=n("p",null,"3\u3001\u90E8\u7F72consul",-1),Q=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#consul agent -server -bootstrap -ui -data-dir=/var/lib/consul-data -bind=172.18.18.33 -client=0.0.0.0 -node=server01")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),W=n("p",null,"\u53C2\u6570\u8BF4\u660E\uFF1A agent:\u8FD0\u884C\u4E00\u4E2Aconsul\u4EE3\u7406\u3002 -server :\u5207\u6362\u4EE3\u7406\u5230\u670D\u52A1\u5668\u6A21\u5F0F\u3002 -bootstrap :\u5C06\u670D\u52A1\u5668\u8BBE\u7F6E\u4E3A\u5F15\u5BFC\u6A21\u5F0F\u3002 -ui:\u542F\u7528\u5185\u7F6E\u7684\u9759\u6001web UI\u670D\u52A1\u5668\u3002 -data-dir:\u8DEF\u5F84\u5230\u6570\u636E\u76EE\u5F55\u5B58\u50A8\u4EE3\u7406\u72B6\u6001\u3002 -bind:\u8BBE\u7F6E\u96C6\u7FA4\u901A\u4FE1\u7684\u7ED1\u5B9A\u5730\u5740\u3002 -client:\u8BBE\u7F6E\u7528\u4E8E\u7ED1\u5B9A\u5BA2\u6237\u7AEF\u8BBF\u95EE\u7684\u5730\u5740\u3002\u8FD9\u5305\u62ECRPC\u3001DNS\u3001HTTP\u548CHTTPS(\u5982\u679C\u914D\u7F6E)\u3002 -node:\u6B64\u8282\u70B9\u7684\u540D\u79F0\u3002 \u5728\u96C6\u7FA4\u4E2D\u5FC5\u987B\u662F\u552F\u4E00\u7684\uFF0C\u5982\u679C\u4F60\u8FD0\u884C\u7B2C2\u53F0consul\uFF0C\u53EF\u4EE5\u5199server02\u3001server03\u7B49\u3002",-1),X=n("p",null,"consul\u542F\u52A8\u540E\u5B83\u4F1A\u5728\u524D\u53F0\u663E\u793A\uFF0C\u5982\u679C\u4F60\u60F3\u8BA9\u5B83\u5728\u540E\u53F0\u8FD0\u884C\uFF0C\u53EF\u4EE5\u52A0\u4E0Anohup &\u6765\u8FD0\u884C\u5B83\uFF1A",-1),nn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#nohup consul agent -server -bootstrap -ui -data-dir=/var/lib/consul-data -bind=172.18.18.33 -client=0.0.0.0 -node=server01 &")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),ln=n("p",null,[l("4\u3001\u67E5\u770Bconsul\u542F\u52A8\u540E\u7684\u60C5\u51B5\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/cbcdb4563e083359c0beb09e8cd66d3a.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"}),l(" \u542F\u52A8consul\u540E\u9ED8\u8BA4\u4F1A\u76D1\u542C5\u4E2A\u7AEF\u53E3\uFF1A 8300\uFF1A replication\u3001leader farwarding\u7684\u7AEF\u53E3 8301\uFF1A lan cossip\u7684\u7AEF\u53E3 8302\uFF1A wan gossip\u7684\u7AEF\u53E3 8500\uFF1A web ui\u754C\u9762\u7684\u7AEF\u53E3 8600\uFF1A \u4F7F\u7528dns\u534F\u8BAE\u67E5\u770B\u8282\u70B9\u4FE1\u606F\u7684\u7AEF\u53E3 \u53EF\u53C2\u8003\u4E0B\u56FE\u67E5\u770B\u7AEF\u53E3\u7684\u610F\u601D\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/30228798a59a97b32f4018de04ec2f40.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),sn=n("h3",{id:"_4-2-\u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F",tabindex:"-1"},[l("4.2 \u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F "),n("a",{class:"header-anchor",href:"#_4-2-\u67E5\u770Bconsul\u96C6\u7FA4\u4FE1\u606F","aria-hidden":"true"},"#")],-1),en=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#consul members")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#consul info |grep leader")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#consul catalog services")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),on=n("h3",{id:"_4-3-\u901A\u8FC7http-api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F",tabindex:"-1"},[l("4.3 \u901A\u8FC7http api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F "),n("a",{class:"header-anchor",href:"#_4-3-\u901A\u8FC7http-api\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F","aria-hidden":"true"},"#")],-1),an=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"# \u96C6\u7FA4server\u6210\u5458")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#curl 127.0.0.1:8500/v1/status/peers")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"# \u96C6\u7FA4Raft leader")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#curl 127.0.0.1:8500/v1/status/leader")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"# \u6CE8\u518C\u7684\u6240\u6709\u670D\u52A1")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#curl 127.0.0.1:8500/v1/catalog/services")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"# \u670D\u52A1\u4FE1\u606F")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#curl 127.0.0.1:8500/v1/catalog/services/nginx")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"# \u96C6\u7FA4\u8282\u70B9\u8BE6\u7EC6\u4FE1\u606F")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@consul ~]#curl 127.0.0.1:8500/v1/catalog/nodes")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),tn=n("p",null,[l("\u4E00\u822C\u6211\u4EEC\u901A\u8FC7 "),n("a",{href:"http://xn--consul-gf4jr3wwp4b:8500/",target:"_blank",rel:"noreferrer"},"http://consul\u670D\u52A1\u5668:8500"),l(" web\u754C\u9762\u6765\u8BBF\u95EE\u67E5\u770B\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/90afa2e429dcac75f0b794cd889763b0.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"}),l(" \u4ECE\u4E0A\u56FE\u53EF\u4EE5\u770B\u5230\uFF0Cconsul \u754C\u9762\u67095\u4E2A\u83DC\u5355\u9879\uFF08SERVICES\u3001NODES\u3001KEY/VALUE\u3001ACL\u3001DC1\uFF09\u3002\u5728SERVICES\u4E2D\uFF0C\u76EE\u524D\u56E0\u4E3A\u6CA1\u6709\u4EFB\u4F55\u670D\u52A1\u52A0\u5165\u8FDB\u6765\uFF0C\u53EA\u663E\u793A\u4E86consul\u5B83\u81EA\u5DF1\u7684\u670D\u52A1\u72B6\u6001\u3002")],-1),cn=n("p",null,[l("\u6211\u4EEC\u5728\u6765\u770B\u4E0BNODES\uFF0C\u4ECE\u56FE\u4E2D\u5F88\u597D\u7406\u89E3\uFF0C \u5728server01\u8FD9\u53F0\u8282\u70B9\u4E0A\u6709\u4E2Aconsul :8300\u7684\u670D\u52A1\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/fbd5cf540d3daba111834be03eaebbaa.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),rn=n("p",null,"\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u53BBnginx\u670D\u52A1\u5668\u4E0A\u914D\u7F6E\u4E00\u4E0Bnginx\u6A21\u677F\uFF0C\u5E76\u5728\u4E24\u53F0docker\u4E3B\u673A\u4E0A\u8FD0\u884Cregistrator\u670D\u52A1\u8FDB\u884C\u6D4B\u8BD5\u3002",-1),pn=n("h2",{id:"_5-\u914D\u7F6Enginx",tabindex:"-1"},[l("5.\u914D\u7F6Enginx "),n("a",{class:"header-anchor",href:"#_5-\u914D\u7F6Enginx","aria-hidden":"true"},"#")],-1),un=n("blockquote",null,[n("p",null,"\u5728nginx\u670D\u52A1\u5668\u4E0A\u64CD\u4F5C")],-1),dn=n("p",null,"\u5728\u6B65\u9AA43\u4E2Dnginx\u5DF2\u7ECF\u5B89\u88C5\u597D\u4E86\uFF0C\u8FD9\u4E00\u6B65\u53EA\u662F\u914D\u7F6Enginx\uFF0C\u5927\u6982\u914D\u7F6E\u7684\u601D\u8DEF\u4E3A\uFF1A",-1),gn=n("ul",null,[n("li",null,"\u5728/usr/local/nginx/conf\u4E2D\u521B\u5EFA\u76EE\u5F55consul\uFF0C\u76EE\u5F55\u540D\u81EA\u5B9A\u4E49\uFF1B"),n("li",null,"\u5728consul\u76EE\u5F55\u4E2D\u521B\u5EFAnginx.ctmpl\u6A21\u677F\uFF1B"),n("li",null,"\u5728nginx.conf\u914D\u7F6E\u4E2D\u6DFB\u52A0include\u9879\u5E76\u6307\u5411consul\u76EE\u5F55 \uFF1B"),n("li",null,"\u91CD\u542Fnginx\u670D\u52A1\uFF1B")],-1),hn=n("h3",{id:"_5-1-\u521B\u5EFAnginx-ctmpl\u6A21\u677F",tabindex:"-1"},[l("5.1 \u521B\u5EFAnginx.ctmpl\u6A21\u677F "),n("a",{class:"header-anchor",href:"#_5-1-\u521B\u5EFAnginx-ctmpl\u6A21\u677F","aria-hidden":"true"},"#")],-1),_n=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx /]#mkdir /usr/local/nginx/consul/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx /]#cd /usr/local/nginx/consul/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx consul]#vim nginx.ctmpl")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"upstream http_backend {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},'    {{range service "nginx"}}')]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    server {{ .Address }}:{{ .Port }};")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    {{ end }}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"server {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    listen 8000;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    server_name localhost;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    location / {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    proxy_pass http://http_backend;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Cn=n("p",null,"nginx.ctmpl\u6A21\u677F\u4E2D\u7684\u5185\u5BB9\u5C31\u662F\u4E24\u6BB5\u610F\u601D\uFF0C\u719F\u6089nginx\u7684\u670B\u53CB\u4E00\u770B\u4E5F\u80FD\u660E\u767D\uFF1A\u7B2C1 \u5B9A\u4E49nginx upstream\u4E00\u4E2A\u7B80\u5355\u6A21\u677F\uFF0C\u7B2C2 \u5B9A\u4E49\u4E00\u4E2Aserver\uFF0C\u76D1\u542C8000\u7AEF\u53E3\uFF0C\u53CD\u5411\u4EE3\u7406\u5230upstream\u3002",-1),An=n("h3",{id:"_5-2-\u4FEE\u6539nginx-conf",tabindex:"-1"},[l("5.2 \u4FEE\u6539nginx.conf "),n("a",{class:"header-anchor",href:"#_5-2-\u4FEE\u6539nginx-conf","aria-hidden":"true"},"#")],-1),mn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx consul]# vim /usr/local/nginx/conf/nginx.conf")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"worker_processes  1;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"events {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    worker_connections  1024;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"http {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    include       mime.types;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    default_type  application/octet-stream;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    sendfile        on;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    keepalive_timeout  65;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    server {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        listen       80;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        server_name  localhost;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        location / {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"            root   html;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"            index  index.html index.htm;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        }")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        error_page   500 502 503 504  /50x.html;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        location = /50x.html {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"            root   html;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        }")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"        #\u6DFB\u52A0\u8FD9\u4E00\u884C")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    include /usr/local/nginx/consul/*.conf;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),xn=n("p",null,"\u6DFB\u52A0\u597D\u4E86\u5728\u91CD\u8F7Dnginx\u670D\u52A1\uFF1A",-1),yn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx consul]# /usr/local/nginx/sbin/nginx  -s reload")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),kn=n("h3",{id:"_5-3-\u8FD0\u884Cconsul-template\u8FDB\u7A0B",tabindex:"-1"},[l("5.3 \u8FD0\u884Cconsul-template\u8FDB\u7A0B "),n("a",{class:"header-anchor",href:"#_5-3-\u8FD0\u884Cconsul-template\u8FDB\u7A0B","aria-hidden":"true"},"#")],-1),vn=n("p",null,"1\u3001\u542F\u52A8consul-template",-1),Dn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},'[root@nginx consul]#consul-template --consul-addr 172.18.18.33:8500 --template "./nginx.ctmpl:vhost.conf" --log-level=info')]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"2018/03/14 08:08:06.933447 [INFO] consul-template v0.19.3 (ebf2d3d)")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"2018/03/14 08:08:06.933459 [INFO] (runner) creating new runner (dry: false, once: false)")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"2018/03/14 08:08:06.933779 [INFO] (runner) creating watcher")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"2018/03/14 08:08:06.933858 [INFO] (runner) starting")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"2018/03/14 08:08:06.933873 [INFO] (runner) initiating run")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"2018/03/14 08:08:06.935387 [INFO] (runner) initiating run")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"\u6CE8\u610F\uFF1A\u5B83\u8FD9\u4E2A\u65E5\u5FD7\u662F\u4E00\u76F4\u5728\u524D\u53F0\u8F93\u51FA\uFF0C\u901A\u8FC7ctrl+c\u505C\u6B62consul-template\u8FDB\u7A0B\u3002")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),bn=n("p",null,"\u53C2\u6570\u8BF4\u660E\uFF1A --consul-addr\uFF1A\u6307\u5B9Aconsul\u670D\u52A1\u7684ip\u548C\u7AEF\u53E3\uFF1B ./nginx.ctmpl\uFF1A\u8FD9\u662F\u7528nginx.ctmpl\u8FD9\u4E2A\u6A21\u677F\u6765\u542F\u52A8\u8FDB\u7A0B\uFF0C\u8FD9\u662F\u5199\u7684\u76F8\u5BF9\u8DEF\u5F84\uFF0C\u4E5F\u53EF\u4EE5\u5199\u7EDD\u5BF9\u8DEF\u5F84\uFF1B vhost.conf\uFF1Anginx.ctmpl\u6A21\u677F\u751F\u6210\u540E\u7684\u6587\u4EF6\u540D\uFF0C\u8FD9\u4E5F\u53EF\u4EE5\u5199\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u5982\u679C\u4E0D\u5199\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u5C31\u5728\u5F53\u524D\u76EE\u5F55\u751F\u6210\uFF08/usr/local/nginx/consul/\uFF09",-1),fn=n("p",null,"2\u3001\u9A8C\u8BC1consul-template \u7531\u4E8Econsul-template\u5728\u524D\u53F0\u8FD0\u884C\uFF0C\u6240\u4EE5\u6211\u4EEC\u5728\u6253\u5F00\u4E00\u4E2Anginx\u7EC8\u7AEF\u9A8C\u8BC1\u3002",-1),wn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"#\u67E5\u770B\u4E0B\u8FDB\u7A0B")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx ~]# ps -ef | grep consul-template")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"root     22954 22794  0 16:08 pts/0    00:00:00 consul-template --consul-addr 172.18.18.33:8500 --template ./nginx.ctmpl:vhost.conf --log-level=info")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"#\u67E5\u770B\u4E0Bconsul\u76EE\u5F55\u4E0B\u7684\u6587\u4EF6")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx ~]# cd /usr/local/nginx/consul/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx consul]# ls")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"nginx.ctmpl  vhost.conf")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Nn=n("p",null,"\u5728consul\u76EE\u5F55\u4E0B\uFF0C\u662F\u4E0D\u662F\u53D1\u73B0\u591A\u4E86\u4E00\u4E2A\u6587\u4EF6vhost.conf\uFF0C\u5C31\u662F\u521A\u624D\u542F\u52A8consul-template\u8FDB\u7A0B\u65F6\u751F\u6210\u7684\u3002",-1),Rn=n("p",null,"\u5728\u6765\u67E5\u770B\u4E0Bvhost.conf\u7684\u5185\u5BB9\uFF0C\u76EE\u524Dupstraem\u914D\u7F6E\u4E3A\u7A7A\uFF0C\u8FD8\u6CA1\u6709docker\u4E3B\u673A\u52A0\u5165\u8FDB\u6765\uFF1A",-1),qn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx consul]# cat vhost.conf ")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"upstream http_backend {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"server {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    listen 8000;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    server_name localhost;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    location / {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    proxy_pass http://http_backend;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),In=n("p",null,"\u63A5\u4E0B\u6765\u53BB\u914D\u7F6E\u4E0Bdocker\u4E3B\u673A\u3002",-1),$n=n("h2",{id:"_6-\u90E8\u7F72docker",tabindex:"-1"},[l("6.\u90E8\u7F72docker "),n("a",{class:"header-anchor",href:"#_6-\u90E8\u7F72docker","aria-hidden":"true"},"#")],-1),En=n("blockquote",null,[n("p",null,"\u5728docker01\u548Cdocker02\u4E0A\u64CD\u4F5C")],-1),Sn=n("p",null,"\u5148\u6765\u8BF4\u4E00\u4E0B\u5728docker\u670D\u52A1\u5668\u4E0A\u64CD\u4F5C\u7684\u5927\u6982\u601D\u8DEF\uFF1A",-1),zn=n("ul",null,[n("li",null,"\u5206\u522B\u5728\u4E24\u53F0docker\u670D\u52A1\u5668\u4E0A\u90FD\u521B\u5EFAregistrator\u5BB9\u5668\uFF0C\u6CE8\u610F\u5230consul\u670D\u52A1\u4E2D\u5FC3\uFF1B"),n("li",null,"\u5728docker01\u4E0A\u8FD0\u884C\u4E24\u53F0nginx\u5BB9\u5668\uFF08\u7AEF\u53E381\u300182\uFF09\uFF0C\u5728docker02\u4E0A\u8FD0\u884C\u4E24\u53F0nginx\u5BB9\u5668\uFF08\u7AEF\u53E383\u300184\uFF09\uFF1B"),n("li",null,"\u4FEE\u6539\u8FD94\u53F0nginx\u5BB9\u5668\u4E2D\u7684index.html\u9875\u9762\u5185\u5BB9\u4E3A\uFF08docker01:81\u3001docker01:82\u3001docker02:83\u3001docker02:84\uFF09"),n("li",null,"\u8BBF\u95EEconsul web\u754C\u9762\u9A8C\u8BC1"),n("li",null,[l("\u8BBF\u95EEnginx\u670D\u52A1\u5668\u5730\u5740 "),n("a",{href:"http://172.18.18.32:8000/",target:"_blank",rel:"noreferrer"},"http://172.18.18.32:8000"),l(" \u8FDB\u884C\u9A8C\u8BC1\uFF1B")])],-1),Pn=n("h3",{id:"_6-1-\u5B89\u88C5docker\u670D\u52A1",tabindex:"-1"},[l("6.1 \u5B89\u88C5docker\u670D\u52A1 "),n("a",{class:"header-anchor",href:"#_6-1-\u5B89\u88C5docker\u670D\u52A1","aria-hidden":"true"},"#")],-1),On=n("blockquote",null,[n("p",null,[l("\u5B89\u88C5\u8FC7\u7A0B\u7701\u7565\uFF0C\u53EF\u53C2\u8003\u7B14\u8005\u8FD9\u7BC7\u6587\u7AE0\u8FDB\u884C\u5B89\u88C5 "),n("a",{href:"https://blog.51cto.com/ganbing/2050621",target:"_blank",rel:"noreferrer"},"\u300Adocker\u73AF\u5883\u5B89\u88C5\uFF08Ubuntu\u3001Centos\uFF09\u300B")])],-1),Tn=n("h3",{id:"_6-2-\u521B\u5EFAregistrator\u5BB9\u5668",tabindex:"-1"},[l("6.2 \u521B\u5EFAregistrator\u5BB9\u5668 "),n("a",{class:"header-anchor",href:"#_6-2-\u521B\u5EFAregistrator\u5BB9\u5668","aria-hidden":"true"},"#")],-1),Un=n("p",null,"\u5206\u522B\u5728docker 01 \u548Cdocker 02 \u4E0A\u90FD\u521B\u5EFA\uFF1A",-1),Vn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker01 /]# docker run -d --name registrator --network=host -v /var/run/docker.sock:/tmp/docker.sock --restart=always gliderlabs/registrator:latest --ip 172.18.18.34 consul://172.18.18.33:8500")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker02 /]# docker run -d --name registrator --network=host -v /var/run/docker.sock:/tmp/docker.sock --restart=always gliderlabs/registrator:latest --ip 172.18.18.35 consul://172.18.18.33:8500")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Fn=n("p",null,"\u53C2\u6570\u8BF4\u660E\uFF1A --network\uFF1A\u628A\u8FD0\u884C\u7684docker\u5BB9\u5668\u8BBE\u5B9A\u4E3Ahost\u7F51\u7EDC\u6A21\u5F0F\uFF1B -v /var/run/docker.sock\uFF1A\u628A\u5BBF\u4E3B\u673A\u7684Docker\u5B88\u62A4\u8FDB\u7A0B(Docker daemon)\u9ED8\u8BA4\u76D1\u542C\u7684Unix\u57DF\u5957\u63A5\u5B57\u6302\u8F7D\u5230\u5BB9\u5668\u4E2D\uFF1B --ip : \u521A\u624D\u628Anetwork\u6307\u5B9A\u4E86host\u6A21\u5F0F\uFF0C\u6240\u4EE5\u6211\u4EEC\u6307\u5B9A\u4E0BIP\u4E3A\u5BBF\u4E3B\u673A\u7684IP\uFF1B consul:j\u6700\u540E\u8FD9\u4E2A\u9009\u9879\u662F\u914D\u7F6Econsul\u670D\u52A1\u5668\u7684IP\u548C\u7AEF\u53E3\u3002",-1),jn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"### 6.3 \u542F\u52A8nginx\u5BB9\u5668")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Bn=n("p",null,"1\u3001\u5148\u5728docker01\u4E0A\u542F\u52A8\u7B2C1\u53F0nginx\uFF0C\u4E5F\u5C31\u662F\u7AEF\u53E3\u4E3A81\u7684\u5BB9\u5668\uFF1A",-1),Hn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker01 /]#docker run -itd --name nginx_81 -p 81:80 nginx")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Jn=n("p",null,"\u8FDB\u5165\u5BB9\u5668\u4FEE\u6539index.html\uFF1A",-1),Ln=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker01 /]# docker exec -it nginx_81 bash")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"root@272533504ab0:/# cd /usr/share/nginx/html/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},'root@272533504ab0:/usr/share/nginx/html# echo  "docker01:81" > index.html ')]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Zn=n("p",null,"\u5728\u53BBnginx\u670D\u52A1\u5668\u4E0A\u9A8C\u8BC1\u4E0Bvhost.conf\uFF0C\u4ECE\u4E0B\u9762\u53EF\u4EE5\u770B\u5230docker01\u7684nginx 81\u6CE8\u518C\u8FDB\u6765\u4E86\uFF1A",-1),Kn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@nginx consul]# cat vhost.conf ")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"upstream http_backend {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    server 172.18.18.34:81;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"server {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    listen 8000;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    server_name localhost;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    location / {")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    proxy_pass http://http_backend;")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"    }")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Mn=n("p",null,[l("\u7136\u540E\u8BBF\u95EE\u4E00\u4E0Bnginx\u670D\u52A1\u5668\u7684IP\u5730\u5740\uFF0C"),n("a",{href:"http://172.18.18.32:8000/",target:"_blank",rel:"noreferrer"},"http://172.18.18.32:8000"),l(" \uFF0C\u4ECE\u4E0B\u56FE\u53EF\u4EE5\u770B\u51FA\u662F\u53EF\u4EE5\u8BBF\u95EE\u7684\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/f9e6667d74a7be1d42284ffdffb4574d.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),Yn=n("p",null,"2\u3001\u5728docker01\u4E0A\u542F\u52A8\u7B2C2\u53F0nginx\uFF0C\u4E5F\u5C31\u662F\u7AEF\u53E3\u4E3A82\u7684\u5BB9\u5668\uFF0C\u5E76\u4FEE\u6539\u597Dindex.html\uFF1A",-1),Gn=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker01 /]# docker run -itd --name nginx_82 -p 82:80 nginx")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker /]# docker exec -it nginx_82  bash")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"root@b66febfa0753:/# cd /usr/share/nginx/html/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},'root@b66febfa0753:/usr/share/nginx/html# echo  "docker01:82" > index.html ')]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),Qn=n("p",null,[l("\u5728\u53BBnginx\u670D\u52A1\u5668\u4E0A\u9A8C\u8BC1\u4E0Bvhost.conf\uFF0C\u4ECE\u4E0B\u9762\u53EF\u4EE5\u770B\u5230docker01\u7684nginx 82\u4E5F\u6CE8\u518C\u8FDB\u6765\u4E86\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/875b40266e4604d164bde45162d241f2.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),Wn=n("p",null,[l("\u63A5\u7740\uFF0C\u6211\u4EEC\u8BBF\u95EE\u4E0Bconsul\u670D\u52A1\u7684web\u754C\u9762\uFF0C"),n("a",{href:"http://172.18.18.33:8500/",target:"_blank",rel:"noreferrer"},"http://172.18.18.33:8500"),l(" \uFF0C\u4ECE\u4E0B\u56FE\u53EF\u4EE5\u770B\u51FA\uFF0C\u5728SERVICE\u4E2D\u662F\u4E0D\u662F\u53D1\u73B0\u591A\u4E86\u4E2Anginx \u670D\u52A1\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/e65f922f8c5d94cd4747c491c446f510.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),Xn=n("p",null,[l("\u7136\u540E\uFF0C\u5728\u770B\u770BNODES\uFF0C\u4ECE\u4E0B\u56FE\u53EF\u4EE5\u770B\u51FA\uFF0C\u521A\u624D\u521B\u5EFA\u7684\u4E24\u4E2Anginx\u5BB9\u5668\uFF0881\u300182\uFF09\u90FD\u6CE8\u518C\u5230\u4E86server01\u8FD9\u53F0consul\u670D\u52A1\u5668\uFF0C\u5982\u679C\u6211\u4EEC\u7684consul\u662F\u96C6\u7FA4\u73AF\u5883\u7684\u8BDD\uFF0C\u53EF\u4EE5\u5206\u522B\u6CE8\u518C\u5230server02\u6216server03\u4E2D\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/75754c5d4892ed121ef07809d531bcc4.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),nl=n("p",null,"3\u3001\u628Adocker02\u670D\u52A1\u5668\u4E0A\u7684nginx\u5BB9\u566883\u548C84\u4E5F\u521B\u5EFA\u4E86 \u521B\u5EFAnginx:83",-1),ll=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker02 /]# docker run -itd --name nginx_83 -p 83:80 nginx")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker02 /]# docker exec -it nginx_83 bash")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"root@5c21ba694829:/# cd /usr/share/nginx/html/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},'root@5c21ba694829:/usr/share/nginx/html# echo  "docker02:83" > index.html')]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),sl=n("p",null,"\u521B\u5EFAnginx:84",-1),el=n("div",{class:"language-"},[n("span",{class:"copy"}),n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker02 /]# docker run -itd --name nginx_84 -p 84:80 nginx")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"[root@docker02 /]#docker exec -it nginx_84  bash")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},"root@0f9d72ff453b:/# cd /usr/share/nginx/html/")]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}},'root@0f9d72ff453b:/usr/share/nginx/html#  echo  "docker02:84" > index.html')]),l(`
`),n("span",{class:"line"},[n("span",{style:{color:"#A6ACCD"}})])])])],-1),ol=n("p",null,[l("4\u3001\u53BBnginx\u670D\u52A1\u5668\u4E0A\u9A8C\u8BC1vhost.conf\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/5a805084f033178c246e11009878b25d.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"}),l(" \u4ECE\u4E0A\u56FE\u53EF\u4EE5\u770B\u51FA\uFF0Cdocker02\u670D\u52A1\u5668\u4E0A\u768483\u548C84\u4E5F\u81EA\u52A8\u6CE8\u518C\u8FDB\u6765\u4E86\u3002")],-1),al=n("p",null,[l("5\u3001\u5728\u6765\u770B\u770Bconsul\u670D\u52A1\u5668\u4E0A\u7684web\u754C\u9762\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/b01af6a525853a49150d3a9078982d78.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"}),l(" \u4ECE\u4E0A\u56FE\u53EF\u4EE5\u770B\u51FA\uFF0CSERVICE\u4E2D\u7684nginx\u5DF2\u7ECF\u6709\u4E864\u4E2A\uFF0C\u5E76\u4E14\u8FD8\u591A\u4E86\u4E9B\u5176\u5B83\u7684\u670D\u52A1\uFF0C\u8FD9\u4E9B\u670D\u52A1\u662F\u6211docker02\u4E0A\u8DD1\u7684\u5176\u5B83\u5E94\u7528\u5BB9\u5668\uFF0C\u4E5F\u90FD\u4F1A\u81EA\u52A8\u6CE8\u518C\u8FDB\u6765\u3002")],-1),tl=n("p",null,[l("6\u3001\u8BBF\u95EEnginx\u670D\u52A1\u5668\u505A\u6700\u540E\u7684\u9A8C\u8BC1\uFF0C"),n("a",{href:"http://172.18.18.32:8000/",target:"_blank",rel:"noreferrer"},"http://172.18.18.32:8000"),l(" \uFF0C\u8BB0\u5F97\u7528f5\u5237\u65B0\u9A8C\u8BC1\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/b2ee65f22819aea534d34d1568a95310.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"}),l(" F5\u5237\u65B0\u4E00\u4E0B\u9875\u9762\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/843ea731f4d6f357ed22541f5a01b546.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"}),l(" \u5728\u5237\u65B0\u4E00\u4E0B\uFF0C\u662F\u4E0D\u662F\u8BBF\u95EE\u5230\u4E86docker02\u8FD9\u53F0\u4E3B\u673A\u4E86\uFF1A "),n("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/6f08d5ad7e7369095d726a3434aad4f7.png",alt:"\u57FA\u4E8EConsul+Registrator+Nginx\u5B9E\u73B0\u5BB9\u5668\u670D\u52A1\u81EA\u52A8\u53D1\u73B0\u7684\u96C6\u7FA4\u6846\u67B6"})],-1),cl=n("p",null,"\u5230\u6B64\uFF0C\u81EA\u52A8\u6CE8\u518C\u670D\u52A1\u7684\u8FC7\u7A0B\u5C31\u5B8C\u6210\u4E86\uFF0C\u60F3\u8981\u8BE6\u7EC6\u4E86\u89E3consul\u7684\u670B\u53CB\u53EF\u4EE5\u53C2\u8003\u5B98\u65B9\u6587\u6863\uFF1A",-1),il=n("p",null,[l("consul \u5B98\u65B9\u4E0B\u8F7D\uFF1A"),n("a",{href:"https://www.consul.io/downloads.html",target:"_blank",rel:"noreferrer"},"https://www.consul.io/downloads.html"),l(" consul\u5B98\u65B9\u96C6\u7FA4\u5B89\u88C5\uFF1A"),n("a",{href:"https://www.consul.io/intro/getting-started/join.html",target:"_blank",rel:"noreferrer"},"https://www.consul.io/intro/getting-started/join.html"),l(" consul github \uFF1A"),n("a",{href:"https://github.com/hashicorp/consul",target:"_blank",rel:"noreferrer"},"https://github.com/hashicorp/consul"),l(" consul\u5B98\u65B9\u955C\u50CF\uFF1A "),n("a",{href:"https://hub.docker.com/_/consul/",target:"_blank",rel:"noreferrer"},"https://hub.docker.com/_/consul/"),l(" \u539F\u4F5C: "),n("a",{href:"https://blog.51cto.com/ganbing/2086851",target:"_blank",rel:"noreferrer"},"https://blog.51cto.com/ganbing/2086851")],-1);function rl(e,pl,ul,dl,t,gl){const c=i;return u(),p(c,{frontmatter:t.frontmatter,data:t.data},{"main-content-md":s(()=>[h,_,C,A,m,x,y,k,v,D,b,f,w,N,R,q,I,$,E,S,z,P,O,T,U,V,F,j,B,H,J,L,Z,K,M,Y,G,Q,W,X,nn,ln,sn,en,on,an,tn,cn,rn,pn,un,dn,gn,hn,_n,Cn,An,mn,xn,yn,kn,vn,Dn,bn,fn,wn,Nn,Rn,qn,In,$n,En,Sn,zn,Pn,On,Tn,Un,Vn,Fn,jn,Bn,Hn,Jn,Ln,Zn,Kn,Mn,Yn,Gn,Qn,Wn,Xn,nl,ll,sl,el,ol,al,tl,cl,il]),"main-header":s(()=>[o(e.$slots,"main-header")]),"main-header-after":s(()=>[o(e.$slots,"main-header-after")]),"main-nav":s(()=>[o(e.$slots,"main-nav")]),"main-content":s(()=>[o(e.$slots,"main-content")]),"main-content-after":s(()=>[o(e.$slots,"main-content-after")]),"main-nav-before":s(()=>[o(e.$slots,"main-nav-before")]),"main-nav-after":s(()=>[o(e.$slots,"main-nav-after")]),comment:s(()=>[o(e.$slots,"comment")]),footer:s(()=>[o(e.$slots,"footer")]),aside:s(()=>[o(e.$slots,"aside")]),"aside-custom":s(()=>[o(e.$slots,"aside-custom")]),default:s(()=>[o(e.$slots,"default")]),_:3},8,["frontmatter","data"])}const yl=r(g,[["render",rl]]);export{xl as __pageData,yl as default};
