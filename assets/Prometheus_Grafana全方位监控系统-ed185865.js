import{_ as D}from"./ValaxyMain.vue_vue_type_style_index_0_lang-e7d89830.js";import{_ as i,c as y,w as o,o as C,b as s,d as l,e as n,r as t,f as F,p as A}from"./app-4d89398e.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-2ca9ab31.js";import"./YunCard.vue_vue_type_style_index_0_lang-4f49289b.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-a8598bd1.js";const lt=JSON.parse('{"title":"Prometheus+Grafana全方位监控系统","description":"","frontmatter":{"title":"Prometheus+Grafana全方位监控系统","categories":"DevOps","tags":["Prometheus"],"date":"2020-08-30T16:38:00.000Z"},"headers":[{"level":2,"title":"Prometheus概述","slug":"prometheus概述","link":"#prometheus概述","children":[{"level":3,"title":"Prometheus是什么","slug":"prometheus是什么","link":"#prometheus是什么","children":[]},{"level":3,"title":"Prometheus特点","slug":"prometheus特点","link":"#prometheus特点","children":[]},{"level":3,"title":"Prometheus 组成与架构","slug":"prometheus-组成与架构","link":"#prometheus-组成与架构","children":[]},{"level":3,"title":"数据模型","slug":"数据模型","link":"#数据模型","children":[]},{"level":3,"title":"指标类型","slug":"指标类型","link":"#指标类型","children":[]},{"level":3,"title":"作业和实例","slug":"作业和实例","link":"#作业和实例","children":[]}]},{"level":2,"title":"Prometheus部署","slug":"prometheus部署","link":"#prometheus部署","children":[]},{"level":2,"title":"全局配置文件介绍","slug":"全局配置文件介绍","link":"#全局配置文件介绍","children":[{"level":3,"title":"全局配置文件","slug":"全局配置文件","link":"#全局配置文件","children":[]},{"level":3,"title":"scrape_configs","slug":"scrape-configs","link":"#scrape-configs","children":[]},{"level":3,"title":"relabel_configs","slug":"relabel-configs","link":"#relabel-configs","children":[]},{"level":3,"title":"基于文件的服务发现","slug":"基于文件的服务发现","link":"#基于文件的服务发现","children":[]}]},{"level":2,"title":"监控栗子","slug":"监控栗子","link":"#监控栗子","children":[{"level":3,"title":"监控linux服务器","slug":"监控linux服务器","link":"#监控linux服务器","children":[]},{"level":3,"title":"使用PromSQL","slug":"使用promsql","link":"#使用promsql","children":[]},{"level":3,"title":"部署grafana","slug":"部署grafana","link":"#部署grafana","children":[]},{"level":3,"title":"监控docker","slug":"监控docker","link":"#监控docker","children":[]},{"level":3,"title":"监控mysql","slug":"监控mysql","link":"#监控mysql","children":[]}]},{"level":2,"title":"alertmanager","slug":"alertmanager","link":"#alertmanager","children":[{"level":3,"title":"部署alertmanager","slug":"部署alertmanager","link":"#部署alertmanager","children":[]},{"level":3,"title":"配置告警规则并邮件通知","slug":"配置告警规则并邮件通知","link":"#配置告警规则并邮件通知","children":[]},{"level":3,"title":"告警状态","slug":"告警状态","link":"#告警状态","children":[]},{"level":3,"title":"告警的分配","slug":"告警的分配","link":"#告警的分配","children":[]},{"level":3,"title":"告警收敛","slug":"告警收敛","link":"#告警收敛","children":[]}]},{"level":2,"title":"编写告警规则栗子","slug":"编写告警规则栗子","link":"#编写告警规则栗子","children":[]}],"relativePath":"pages/posts/Prometheus+Grafana全方位监控系统.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Prometheus+Grafana全方位监控系统.md","lastUpdated":1673425512000}'),c=JSON.parse('{"title":"Prometheus+Grafana全方位监控系统","description":"","frontmatter":{"title":"Prometheus+Grafana全方位监控系统","categories":"DevOps","tags":["Prometheus"],"date":"2020-08-30T16:38:00.000Z"},"headers":[{"level":2,"title":"Prometheus概述","slug":"prometheus概述","link":"#prometheus概述","children":[{"level":3,"title":"Prometheus是什么","slug":"prometheus是什么","link":"#prometheus是什么","children":[]},{"level":3,"title":"Prometheus特点","slug":"prometheus特点","link":"#prometheus特点","children":[]},{"level":3,"title":"Prometheus 组成与架构","slug":"prometheus-组成与架构","link":"#prometheus-组成与架构","children":[]},{"level":3,"title":"数据模型","slug":"数据模型","link":"#数据模型","children":[]},{"level":3,"title":"指标类型","slug":"指标类型","link":"#指标类型","children":[]},{"level":3,"title":"作业和实例","slug":"作业和实例","link":"#作业和实例","children":[]}]},{"level":2,"title":"Prometheus部署","slug":"prometheus部署","link":"#prometheus部署","children":[]},{"level":2,"title":"全局配置文件介绍","slug":"全局配置文件介绍","link":"#全局配置文件介绍","children":[{"level":3,"title":"全局配置文件","slug":"全局配置文件","link":"#全局配置文件","children":[]},{"level":3,"title":"scrape_configs","slug":"scrape-configs","link":"#scrape-configs","children":[]},{"level":3,"title":"relabel_configs","slug":"relabel-configs","link":"#relabel-configs","children":[]},{"level":3,"title":"基于文件的服务发现","slug":"基于文件的服务发现","link":"#基于文件的服务发现","children":[]}]},{"level":2,"title":"监控栗子","slug":"监控栗子","link":"#监控栗子","children":[{"level":3,"title":"监控linux服务器","slug":"监控linux服务器","link":"#监控linux服务器","children":[]},{"level":3,"title":"使用PromSQL","slug":"使用promsql","link":"#使用promsql","children":[]},{"level":3,"title":"部署grafana","slug":"部署grafana","link":"#部署grafana","children":[]},{"level":3,"title":"监控docker","slug":"监控docker","link":"#监控docker","children":[]},{"level":3,"title":"监控mysql","slug":"监控mysql","link":"#监控mysql","children":[]}]},{"level":2,"title":"alertmanager","slug":"alertmanager","link":"#alertmanager","children":[{"level":3,"title":"部署alertmanager","slug":"部署alertmanager","link":"#部署alertmanager","children":[]},{"level":3,"title":"配置告警规则并邮件通知","slug":"配置告警规则并邮件通知","link":"#配置告警规则并邮件通知","children":[]},{"level":3,"title":"告警状态","slug":"告警状态","link":"#告警状态","children":[]},{"level":3,"title":"告警的分配","slug":"告警的分配","link":"#告警的分配","children":[]},{"level":3,"title":"告警收敛","slug":"告警收敛","link":"#告警收敛","children":[]}]},{"level":2,"title":"编写告警规则栗子","slug":"编写告警规则栗子","link":"#编写告警规则栗子","children":[]}],"relativePath":"pages/posts/Prometheus+Grafana全方位监控系统.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Prometheus+Grafana全方位监控系统.md","lastUpdated":1673425512000}'),d={name:"pages/posts/Prometheus+Grafana全方位监控系统.md",data(){return{data:c,frontmatter:c.frontmatter}},setup(){A("pageData",c)}},u={id:"prometheus-grafana全方位监控系统",tabindex:"-1"},h=s("p",null,[s("code",null,"emmm"),l("，前段时间写了一篇关于使用"),s("code",null,"Prometheus+grafana+node-exporter"),l("监控"),s("code",null,"k8s"),l("的文章，那篇写的很简单，只是单纯的搭建出来了，目前我对这东西一点都不了解，所以先来了解一下"),s("code",null,"Prometheus"),l("和他常用的组件吧，包括"),s("code",null,"Prometheus/Grafana/node-exports/Alertmanager"),l("，开始吧。")],-1),m=s("p",null,[l("本文包括"),s("code",null,"Prometheus"),l("概述、部署、配置、监控、告警、之前我做监控用的都是"),s("code",null,"zabbix"),l("，"),s("code",null,"zabbix"),l("也算是一个全面型的监控系统，但是他不太适合容器监控，他对容器监控集成欠缺很多，他比较偏向于非容器监控。")],-1),g=s("p",null,[s("code",null,"Prometheus"),l("算是一个全能型选手，原生支持容器监控，当然监控传统应用也不是吃干饭的，所以就是容器和非容器他都支持，所有的监控系统都具备这个流程，数据采集→数据处理→数据存储→数据展示→告警，本文就是针对"),s("code",null,"Prometheus"),l("展开的，所以先看看"),s("code",null,"Prometheus"),l("概述")],-1),_={id:"prometheus概述",tabindex:"-1"},b=s("p",null,[l("先来看一下"),s("code",null,"Prometheus"),l("是个啥")],-1),E={id:"prometheus是什么",tabindex:"-1"},f=s("code",null,"SoundCloud",-1),x=s("code",null,"2012",-1),v=s("code",null,"CNCF",-1),w=s("code",null,"kubernetes",-1),k={id:"prometheus特点",tabindex:"-1"},P=s("p",null,"官方扒过来的",-1),q=s("ul",null,[s("li",null,"多维数据模型：由度量名称和键值对标识的时间序列数据"),s("li",null,"PromSQL: —种灵活的查询语言，可以利用多维数据完成复杂的查询"),s("li",null,"不依赖分布式存储，单个服务器节点可直接工作"),s("li",null,"基于HTTP的pull方式釆集时间序列数据"),s("li",null,"推送时间序列数据通过PushGateway组件支持"),s("li",null,"通过服务发现或静态配罝发现目标"),s("li",null,"多种图形模式及仪表盘支持(grafana)")],-1),B={id:"prometheus-组成与架构",tabindex:"-1"},j=s("p",null,"来看一张图，官方扒到的",-1),$=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702133835.png#mirages-width=774&mirages-height=462&mirages-cdn-type=5",alt:"20190702133835"})],-1),S=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"名称"),s("th",null,"说明")])]),s("tbody",null,[s("tr",null,[s("td",null,"Prometheus Server"),s("td",null,"收集指标和存储时间序列数据，并提供查询接口")]),s("tr",null,[s("td",null,"Push Gateway"),s("td",null,"短期存储指标数据，主要用于临时性任务")]),s("tr",null,[s("td",null,"Exporters"),s("td",null,"采集已有的三方服务监控指标并暴露metrics")]),s("tr",null,[s("td",null,"Alertmanager"),s("td",null,"告警")]),s("tr",null,[s("td",null,"Web UI"),s("td",null,"简单的WEB控制台")])])],-1),U=s("p",null,"集成了数据的采集，处理，存储，展示，告警一系列流程都已经具备了",-1),T={id:"数据模型",tabindex:"-1"},I=s("p",null,[s("code",null,"Prometheus"),l("将所有数据存储为时间序列，具有相同度量名称以及标签属于同个指标，也就是说"),s("code",null,"Prometheus"),l("从数据源拿到数据之后都会存到内置的"),s("code",null,"TSDB"),l("中，这里存储的就是时间序列数据，它存储的数据会有一个度量名称，譬如你现在监控一个"),s("code",null,"nginx"),l("，首先你要给他起个名字，这个名称也就是度量名，还会有"),s("code",null,"N"),l("个标签，你可以理解名称为表名，标签为字段，所以，每个时间序列都由度量标准名称和一组键值对(也称为标签)唯一标识。")],-1),N=s("p",null,"时间序列的格式是这样的，",-1),O=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"<metrice name> {<label name>=<label value>,...}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),G=s("p",null,[s("code",null,"metrice name"),l("指的就是度量标准名称，"),s("code",null,"label name"),l("也就是标签名，这个标签可以有多个，栗子")],-1),z=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'nginx_http_access{method="GET",uri="/index.html"}')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),L=s("p",null,[l("这个度量名称为"),s("code",null,"nginx_http_access"),l("，后面是两个标签，和他们各对应的值，当然你还可以继续指定标签，你指定的标签越多查询的维度就越多。")],-1),M={id:"指标类型",tabindex:"-1"},R=s("p",null,"看表格吧",-1),Q=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"类型名称"),s("th",null,"说明")])]),s("tbody",null,[s("tr",null,[s("td",null,"Counter"),s("td",null,"递增计数器，适合收集接口请求次数")]),s("tr",null,[s("td",null,"Guage"),s("td",null,"可以任意变化的数值，适用CPU使用率")]),s("tr",null,[s("td",null,"Histogram"),s("td",null,"对一段时间内数据进行采集，并对有所数值求和于统计数量")]),s("tr",null,[s("td",null,"Summary"),s("td",null,"与Histogram类型类似")])])],-1),W={id:"作业和实例",tabindex:"-1"},H=s("p",null,[l("实例指的就是你可以抓取的目标，这个会在"),s("code",null,"Prometheus "),l("配置文件中提现，作业是具有相同目标的实例集合称为作业，你可以理解为是一个组，一会写配置文件的时候会详细解析，下面开始安装"),s("code",null,"Prometheus"),l("。")],-1),K={id:"prometheus部署",tabindex:"-1"},V=s("code",null,"Prometheus",-1),J=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702152359.png#mirages-width=1214&mirages-height=339&mirages-cdn-type=5",alt:"20190702152359"})],-1),Y=s("p",null,"我在服务器上直接下载了，下载完后解压移动到别的目录。",-1),Z=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# wget https://github.com/prometheus/prometheus/releases/download/v2."),s("span",{style:{color:"#F78C6C"}},"10.0"),s("span",{style:{color:"#A6ACCD"}},"/prometheus-2.10.0.linux-amd64.tar.gz")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# tar zxf prometheus-2.10.0.linux-amd64.tar.gz ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# mv prometheus-2.10.0.linux-amd64 /usr/local/prometheus")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# cd /usr/local/prometheus/ "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"ls")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"console_libraries"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"consoles"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"LICENSE"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"NOTICE"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"prometheus"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"prometheus.yml"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"promtool")]),l(`
`),s("span",{class:"line"})])])],-1),X=s("p",null,[l("先配置一下监控本机吧，它默认的配置文件是"),s("code",null,"prometheus.yml"),l("，已经配置好了，也就是这一段，")],-1),ss=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"prometheus"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# metrics_path defaults to '/metrics'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# scheme defaults to 'http'.")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),ls=s("p",null,[s("code",null,"targets"),l("就是一个作业，也就是被监控端，监控本机的"),s("code",null,"9090"),l("端口，启动选项也有很多，了解一下，主要是关注两点，分别如下。")],-1),os=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#FFCB6B"}},'--storage.tsdb.path="data/"'),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##存储数据的目录，默认/data")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#FFCB6B"}},"--storage.tsdb.retention.time"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##数据存储时间，默认15天")]),l(`
`),s("span",{class:"line"})])])],-1),es=s("p",null,[l("这里提一下存储的问题，"),s("code",null,"TSDB"),l("不太适合长期去存储数据，数据量大了支持并不是很好，官方声明也是不会对这一块存储进行改善，给你的建议是使用外部存储，譬如使用"),s("code",null,"InfluxDB"),l("，这里暂时就不改他的默认存储了，把他进入系统服务吧，写一个"),s("code",null,"systemd"),l("的配置文件，直接启动了")],-1),ns=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," /usr/lib/systemd/system/prometheus.service "),s("span",{style:{color:"#89DDFF"}},"<<OEF"),s("span",{style:{color:"#C3E88D"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Unit]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> Description=prometheus server daemon")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Service]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> Restart=on-failure")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ExecStart=/usr/local/prometheus/prometheus --config.file=/usr/local/prometheus/prometheus.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Install]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> WantedBy=multi-user.target")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> OEF")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"[root@rj-bai /usr/local/prometheus]# systemctl daemon-reload && systemctl start prometheus.service")]),l(`
`),s("span",{class:"line"})])])],-1),as=s("p",null,[l("这样就启动了撒，去访问"),s("code",null,"9090"),l("端口就可以看到页面了，这个页面能看到的东西很多，自己点点看吧，能看到这个页面就表示莫得问题。")],-1),ts=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702163712.png#mirages-width=1845&mirages-height=454&mirages-cdn-type=5",alt:"20190702163712"})],-1),cs=s("p",null,"目前使用二进制部署主要是因为方便改配置文件，下面开始看配置文件。",-1),rs={id:"全局配置文件介绍",tabindex:"-1"},ps=s("p",null,[s("code",null,"prometheus"),l(" 已经安装起来了，下面看一下配置文件与核心功能，很多功能都是通过配置文件去实现的，比较多，所以先熟悉一下他的配置文件。")],-1),Ds={id:"全局配置文件",tabindex:"-1"},is=s("code",null,"prometheus.yml",-1),ys=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"scrape_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<duration> | default = 1m"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##采集间隔")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"scrape_timeout"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<duration> | default = 10s"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##采集超时时间")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"evaluation_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<duration> | default = 1m"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##告警评估周期")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"external_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##外部标签             ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"<labelname>"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<labelvalue> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),Cs=s("p",null,"指定告警规则",-1),Fs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"rule_files"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<filepath_glob> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),As=s("p",null,"配置被监控端",-1),ds=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<scrape_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),us=s("p",null,"配置告警方式",-1),hs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"alerting"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"alert_relabel_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<relabel_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"alertmanagers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<alertmanager_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),ms=s("p",null,"指定远程存储",-1),gs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"remote_write"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<remote_write> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"remote_read"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<remote_read> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),_s=s("p",null,[l("这就是一个整体的配置文件，现在再看默认的配置文件就能看懂某一段是干啥的了，现在开始配置"),s("code",null,"scrape_configs")],-1),bs={id:"scrape-configs",tabindex:"-1"},Es=s("p",null,"这块就是来配置我们要监控的东西，在这一块中配置的东西又有很多了，看一下官方的，一堆，我还是去掉注释分段贴出来吧。",-1),fs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<job_name>"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##指定job名字")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"scrape_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<duration> | default = <global_config.scrape_interval>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"scrape_timeout"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<duration> | default = <global_config.scrape_timeout>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##这两段指定采集时间，默认继承全局")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"metrics_path"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<path> | default = /metrics"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##metrics路径，默认metrics")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"honor_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<boolean> | default = false"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##默认附加的标签，默认不覆盖")]),l(`
`),s("span",{class:"line"})])])],-1),xs=s("p",null,[l("它默认暴露监控数据的接口就是"),s("code",null,"ip:9090/metrics"),l("，你可以去指定这个名称，访问一下这里看看，")],-1),vs=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702171903.png#mirages-width=647&mirages-height=399&mirages-cdn-type=5",alt:"20190702171903"})],-1),ws=s("p",null,[l("在"),s("code",null,"ip:9090/targets"),l("能看到当前监控的主机，现在只有本机一个，标签显示也在这里。")],-1),ks=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190702171956.png#mirages-width=1450&mirages-height=277&mirages-cdn-type=5",alt:"20190702171956"})],-1),Ps=s("p",null,"在看下一段，这里定义的是要如何去访问采集目标",-1),qs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"scheme"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<scheme> | default = http"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 默认使用http方式去访问")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"params"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"<string>"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"<string>"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"..."),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 配置访问时携带的参数")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"basic_auth"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<string>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"password"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<secret>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"password_file"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<string>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 配置访问接口的用户名密码")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"bearer_token"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<secret>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"bearer_token_file"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/path/to/bearer/token/file"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##指定认证token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"tls_config"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<tls_config>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"                     "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 指定CA证书")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"proxy_url"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<string>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"                "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 使用代理模式访问目标")]),l(`
`),s("span",{class:"line"})])])],-1),Bs=s("p",null,"下一段，服务发现配置，贴了几个，不是完整的",-1),js=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"consul_sd_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##通过consul去发现")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<consul_sd_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"dns_sd_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##通过DNS去发现")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<dns_sd_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"file_sd_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##通过文件去发现")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<file_sd_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"kubernetes_sd_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"               "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##通过kubernetes去发现")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<kubernetes_sd_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),$s=s("p",null,"静态配置被监控端",-1),Ss=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<static_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),Us=s("p",null,"刚刚监控本机的就是静态配置去监控的，也是就这一段，",-1),Ts=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"prometheus"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),Is=s("p",null,"最后标签配置",-1),Ns=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"relabel_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<relabel_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##在数据采集前对标签进行重新标记")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"metric_relabel_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," - "),s("span",{style:{color:"#C3E88D"}},"<relabel_config> ..."),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##在数据采集之后对标签进行重新标记")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"sample_limit"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<int> | default = 0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##采集样本数量，默认0")]),l(`
`),s("span",{class:"line"})])])],-1),Os=s("p",null,[l("下面看一下"),s("code",null,"relabel_configs")],-1),Gs={id:"relabel-configs",tabindex:"-1"},zs=s("p",null,[l("就是用来重新打标记的，对于"),s("code",null,"prometheus"),l(" 数据模型最关键点就是一个指标名称和一组标签来组成一个多维度的数据模型，你想完成一个复杂的查询就需要你有很多维度，"),s("code",null,"relabel_configs"),l(" 就是对标签进行处理的，他能帮你在数据采集之前对任何目标的标签进行修改，重打标签的意义就是如果标签有重复的可以帮你重命名，看一哈现在的，上面铁锅")],-1),Ls=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708111918.png#mirages-width=1855&mirages-height=455&mirages-cdn-type=5",alt:"20190708111918"})],-1),Ms=s("p",null,[l("现在"),s("code",null,"instance"),l("是他默认给我加的标签，想改的话就需要"),s("code",null,"relabel_configs"),l("去帮你重打标签，他也可以删除标签，如果某个标签用不到了也可以删掉，再就是过滤标签，再看一下"),s("code",null,"relabel_configs"),l("的配置有哪些，也就是这一段")],-1),Rs=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"relabel_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"source_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<labelname>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"[,"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"..."),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"]"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##源标签，指定对哪个现有标签进行操作")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"separator"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<string> | default = ;"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##多个源标签时连接的分隔符")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"target_label"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<labelname>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"                    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##要将源标签换成什么名字")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"regex"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<regex> | default = (.*)"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"              "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##怎么来匹配源标签，默认匹配所有")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"modulus"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<uint64>"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"                            "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##不怎么会用到")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"replacement"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<string> | default = $1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##替换正则表达式匹配到的分组，分组引用$1,$2,$3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"action"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"<relabel_action> | default = replace"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##基于正则表达式匹配执行的操作，默认替换")]),l(`
`),s("span",{class:"line"})])])],-1),Qs=s("p",null,[l("这东西到底怎么用，做个演示，根据两台服务器聚合查看"),s("code",null,"CPU"),l("使用率，说白了就是同时去查看这两台服务器的"),s("code",null,"CPU"),l("利用率，用这个标签就可以实现了。")],-1),Ws={id:"添加标签",tabindex:"-1"},Hs=s("p",null,[l("去"),s("code",null,"WEB"),l("界面看一下当前被监控端"),s("code",null,"CPU"),l("使用率，用"),s("code",null,"sql"),l("去查，也就是这个值。")],-1),Ks=s("p",null,[s("img",{src:"https://res.rj-bai.com/201907/20190708111918.png",alt:"20190708111918"})],-1),Vs=s("p",null,[l("可以看到一个度量名称和两个默认附加的标签，我现在想统计两台服务器的"),s("code",null,"CPU"),l("使用率，就需要加一个标签了，说白了就是添加一个维度去获取这两台服务器"),s("code",null,"CPU"),l("使用率，接下来去改配置文件吧，给他加个标签，如下，")],-1),Js=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"server"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"local"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),Ys=s("p",null,"热更新一下，",-1),Zs=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# ps aux "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"grep"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"prometheus.yml"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"grep"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"grep"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"awk"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"{"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"print $2"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"}"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"xargs"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"kill"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-hup")]),l(`
`),s("span",{class:"line"})])])],-1),Xs=s("p",null,"看一下有没有生效，刷新一下页面就能看到了，",-1),sl=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708113120.png#mirages-width=694&mirages-height=480&mirages-cdn-type=5",alt:"20190708113120"})],-1),ll=s("p",null,"然后可以根据这个标签去查了，语法是这样的，内置函数，",-1),ol=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},'sum(process_cpu_seconds_total{server="local"})')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),el=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708113824.png#mirages-width=1214&mirages-height=413&mirages-cdn-type=5",alt:"201907081124"})],-1),nl=s("p",null,[l("所以就算你有"),s("code",null,"N"),l("个被监控的服务器打上这个标签之后在这里就可以看到总数了，添加标签很简单，下面看一下重命名标签，就是将现有的标签进行重命名。")],-1),al={id:"标签重命名",tabindex:"-1"},tl=s("p",null,[l("就是将一个已有的标签重命名一个新的标签，实际操作一下，之前的标签去掉了，现在要把"),s("code",null,"job_name"),l("改个名字，也就是这一块的配置，")],-1),cl=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"prometheus"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),rl=s("p",null,[l("目前"),s("code",null,"job_name"),l("为"),s("code",null,"prometheus"),l("，当前这个虚拟机是跑在"),s("code",null,"IP"),l("地址为"),s("code",null,"21"),l("的物理机上，所以现在把他的"),s("code",null,"job_name"),l("改成"),s("code",null,"server21"),l("，")],-1),pl=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"server21"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),Dl=s("p",null,"重启一下，刷新页面就可以看到了，",-1),il=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708160319.png#mirages-width=1543&mirages-height=371&mirages-cdn-type=5",alt:"20190708160319"})],-1),yl=s("p",null,[l("我现在要将"),s("code",null,"job"),l("这个标签标记为"),s("code",null,"local"),l("，也就是将"),s("code",null,'job="server21'),l("改为"),s("code",null,'local="server21'),l("，下面开始用"),s("code",null,"relabel"),l("进行重命名，改完之后的配置是这样的，")],-1),Cl=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"server21"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"relabel_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"action"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"replace")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"source_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"job"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##源标签")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"regex"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"(.*)"),s("span",{style:{color:"#A6ACCD"}},"             "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##正则，会匹配到job值，也就是server21")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"replacement"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"$1"),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##引用正则匹配到的内容，也就是server21")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"target_label"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"local"),s("span",{style:{color:"#A6ACCD"}},"     "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##赋予新的标签，名为local")]),l(`
`),s("span",{class:"line"})])])],-1),Fl=s("p",null,"这样就可以了撒，重新加载一下，看页面，",-1),Al=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708161317.png#mirages-width=617&mirages-height=368&mirages-cdn-type=5",alt:"20190708161317"})],-1),dl=s("p",null,"新的数据已经有了，之前的标签还会保留，因为没有配置删除他，这样就可以了，现在就可以聚合了，",-1),ul=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708161530.png#mirages-width=1136&mirages-height=419&mirages-cdn-type=5",alt:"20190708161530"})],-1),hl=s("p",null,"这样他就会将所有实例使用率相加求和。",-1),ml={id:"action重新打标签动作",tabindex:"-1"},gl=s("p",null,"如表所示，上面就是用了一个默认的。",-1),_l=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"值"),s("th",null,"描述")])]),s("tbody",null,[s("tr",null,[s("td",null,"replace"),s("td",null,"默认，通过正则匹配source_label的值，使用replacement来引用表达式匹配的分组")]),s("tr",null,[s("td",null,"keep"),s("td",null,"删除regex于链接不匹配的目标source_labels")]),s("tr",null,[s("td",null,"drop"),s("td",null,"删除regex与连接匹配的目标source_labels")]),s("tr",null,[s("td",null,"labeldrop"),s("td",null,"匹配Regex所有标签名称")]),s("tr",null,[s("td",null,"labelkeep"),s("td",null,"匹配regex所有标签名称")]),s("tr",null,[s("td",null,"hashmod"),s("td",null,"设置target_label为modulus连接的哈希值source_lanels")]),s("tr",null,[s("td",null,"labelmap"),s("td",null,[l("匹配regex所有标签名称，复制匹配标签的值分组，replacement分组引用("),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mn",null,"1"),s("mo",{separator:"true"},",")]),s("annotation",{encoding:"application/x-tex"},"{1},")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8389em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"1")]),s("span",{class:"mpunct"},",")])])]),l("{2})替代")])])])],-1),bl=s("p",null,"比如说我现在不想采集本机的数据了，就可以用上面的标签进行操作了，加点东西就行了，",-1),El=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"server21"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"relabel_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"action"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"replace")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"source_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"job"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"regex"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"(.*)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"replacement"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"$1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"target_label"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"local")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"action"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"drop")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"source_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"job"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),fl=s("p",null,[l("删除标签为"),s("code",null,"job"),l("的节点，目前只有一个节点，所以这个跑了之后就看不到数据了，如果真的要用这个给不需要监控的节点打一个标签，然后在这里匹配就行了，所以现在重新载入的话就没数据了，")],-1),xl=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708164048.png#mirages-width=515&mirages-height=325&mirages-cdn-type=5",alt:"20190708164048"})],-1),vl=s("p",null,"最后看一下删除标签。",-1),wl={id:"删除标签",tabindex:"-1"},kl=s("p",null,[l("刚刚我新打了一个标签，也就是"),s("code",null,"local"),l("标签，所以之前的"),s("code",null,"job"),l("标签可以不要了，下面直接给他删了吧，")],-1),Pl=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"server21"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"relabel_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"action"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"replace")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"source_labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"job"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"regex"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"(.*)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"replacement"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"$1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"target_label"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"local")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"action"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"labeldrop"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"regex"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"job")]),l(`
`),s("span",{class:"line"})])])],-1),ql=s("p",null,[l("重载一下就看到"),s("code",null,"job"),l("的标签了。")],-1),Bl=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708164600.png#mirages-width=467&mirages-height=413&mirages-cdn-type=5",alt:"20190708164600"})],-1),jl=s("p",null,"这样就可以了撒，下面看看基于文件的服务发现功能",-1),$l={id:"基于文件的服务发现",tabindex:"-1"},Sl=s("p",null,[l("下面会涉及到基于文件的服务发现，还有就是基于"),s("code",null,"kubernetes"),l("的服务发现，这个到监控"),s("code",null,"k8s"),l("集群的时候再说吧，先看基于文件的吧，现在还没准备别的服务器，还是发现本身吧，先把配置文件改成这样，重载之后就看不到本机了。")],-1),Ul=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat prometheus.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"scrape_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"     "),s("span",{style:{color:"#C3E88D"}},"15s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"evaluation_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"15s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"alerting"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"alertmanagers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"rule_files"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"prometheus"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"})])])],-1),Tl=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708171041.png#mirages-width=942&mirages-height=299&mirages-cdn-type=5",alt:"20190708171041"})],-1),Il=s("p",null,"然后就可以去改配置文件了，通过服务发现将自身加入进去，",-1),Nl=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat prometheus.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"scrape_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"     "),s("span",{style:{color:"#C3E88D"}},"15s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"evaluation_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"15s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"alerting"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"alertmanagers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"rule_files"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"prometheus"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"file_sd_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"files"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"/usr/local/prometheus/files_sd_configs/*.yaml"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##指定服务发现文件位置")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"refresh_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5s"),s("span",{style:{color:"#A6ACCD"}},"                                      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##刷新间隔改为5秒")]),l(`
`),s("span",{class:"line"})])])],-1),Ol=s("p",null,[l("重载服务，然后去写服务发现的"),s("code",null,"YAML"),l("文件吧，")],-1),Gl=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/prometheus/files_sd_configs"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat configs.yml"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost:9090"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"server21")]),l(`
`),s("span",{class:"line"})])])],-1),zl=s("p",null,"这样就可以了，文件保存五秒后就能看到发现的主机了，查数据也没问题",-1),Ll=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708173554.png#mirages-width=1234&mirages-height=334&mirages-cdn-type=5",alt:"20190708173554"})],-1),Ml=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708173611.png#mirages-width=1432&mirages-height=254&mirages-cdn-type=5",alt:"20190708173611"})],-1),Rl=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190708173654.png#mirages-width=940&mirages-height=419&mirages-cdn-type=5",alt:"20190708173654"})],-1),Ql=s("p",null,[l("就是这种原理，下面开始监控"),s("code",null,"linux"),l("和一些服务吧")],-1),Wl={id:"监控栗子",tabindex:"-1"},Hl={id:"监控linux服务器",tabindex:"-1"},Kl=s("code",null,"emmmm",-1),Vl=s("code",null,"node_exporter",-1),Jl=s("code",null,"prometheus",-1),Yl=s("code",null,"node_exporter",-1),Zl=s("code",null,"github",-1),Xl=s("code",null,"node_exporter",-1),so=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# wget https://github.com/prometheus/node_exporter/releases/download/v0."),s("span",{style:{color:"#F78C6C"}},"18.1"),s("span",{style:{color:"#A6ACCD"}},"/node_exporter-0.18.1.linux-amd64.tar.gz")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# tar zxf node_exporter-0.18.1.linux-amd64.tar.gz ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# mv node_exporter-0.18.1.linux-amd64 /usr/local/node_exporter")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# cd /usr/local/node_exporter")]),l(`
`),s("span",{class:"line"})])])],-1),lo=s("p",null,"在启动之前看一下他的启动参数，",-1),oo=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node /usr/local/node_exporter"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# ./node_exporter --help")]),l(`
`),s("span",{class:"line"})])])],-1),eo=s("p",null,[l("可以看到一堆，她就是一个收集器，配置你要收集或不收集哪些信息，看"),s("code",null,"default"),l("就能看出来撒，加到系统服务中吧，用"),s("code",null,"systemctl"),l("去管理。")],-1),no=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node /usr/local/node_exporter"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," /usr/lib/systemd/system/node_exporter.service "),s("span",{style:{color:"#89DDFF"}},"<<OEF"),s("span",{style:{color:"#C3E88D"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Unit]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> Description=node_exporter")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Service]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> Restart=on-failure")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ExecStart=/usr/local/node_exporter/node_exporter")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Install]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> WantedBy=multi-user.target")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> OEF")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"[root@kubeadm-node /usr/local/node_exporter]# systemctl daemon-reload ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"[root@kubeadm-node /usr/local/node_exporter]# systemctl start node_exporter.service")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"[root@kubeadm-node /usr/local/node_exporter]# curl -s 127.0.0.1:9100/metrics | head ")]),l(`
`),s("span",{class:"line"})])])],-1),ao=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709105800.png#mirages-width=766&mirages-height=390&mirages-cdn-type=5",alt:"20190709105800"})],-1),to=s("p",null,[l("正常启动了撒，现在要配置"),s("code",null,"prometheus"),l("来监控这个主机了，之前配置过动态发现了，现在再加一个，把服务端和被监控端分开，所以新加了这个。")],-1),co=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat prometheus.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"job_name:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"nodes"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#FFCB6B"}},"file_sd_configs:"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"files:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"/usr/local/prometheus/nodes_sd_configs/*.yml"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#FFCB6B"}},"refresh_interval:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# mkdir nodes_sd_configs "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"cd"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"nodes_sd_configs")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/prometheus"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# ps aux "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"grep"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"prometheus.yml"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"grep"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"grep"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"awk"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"{"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"print $2"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"}"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"xargs"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"kill"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-hup")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/prometheus/nodes_sd_configs"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat nodes.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"targets:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"192.168.1.248:9100"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#FFCB6B"}},"labels:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#FFCB6B"}},"name:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"server20")]),l(`
`),s("span",{class:"line"})])])],-1),ro=s("p",null,"直接去看页面吧，应该已经添加进去了，顺便查一下数据",-1),po=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709111843.png#mirages-width=1390&mirages-height=400&mirages-cdn-type=5",alt:"20190709111843"})],-1),Do=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709112040.png#mirages-width=851&mirages-height=441&mirages-cdn-type=5",alt:"20190709112040"})],-1),io=s("p",null,[l("这样就可以了，莫得问题，下面用"),s("code",null,"PromSQL"),l("获取"),s("code",null,"CPU&"),l("内存硬盘使用率")],-1),yo={id:"使用promsql",tabindex:"-1"},Co=s("p",null,[l("想查数据就需要写"),s("code",null,"PromSQL"),l("去查询了，")],-1),Fo={id:"查询cpu使用率",tabindex:"-1"},Ao=s("p",null,[l("比如果我想查看刚刚加进来的"),s("code",null,"nodes CPU"),l("利用率，以"),s("code",null,"node"),l("开头的"),s("code",null,"sql"),l("都是"),s("code",null,"node_expores"),l("采集的指标，度量很多，看"),s("code",null,"CPU"),l("使用率看着一个指标就够了，")],-1),uo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709112714.png#mirages-width=1723&mirages-height=923&mirages-cdn-type=5",alt:""})],-1),ho=s("p",null,[l("总"),s("code",null,"CPU"),l("使用情况，会列出你处理器多少核，每个核的使用情况，这个CPU是干什么使用的，用户态还是内核态还是操作"),s("code",null,"IO"),l("等待的时间，还有优先级调度使用的"),s("code",null,"CPU"),l("，他会通过一个名为"),s("code",null,"mode"),l("的标签去区分这些，一般不会这么去统计，现在统计一下刚刚加进去的那个"),s("code",null,"nodes"),l("五分钟之内"),s("code",null,"CPU"),l("平均使用率是多少，还是得写"),s("code",null,"PromSQL"),l("，大概是这样，")],-1),mo=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," irate(node_cpu_seconds_total{mode"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"idle"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"}[5m])"),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#F78C6C"}},"100")]),l(`
`),s("span",{class:"line"})])])],-1),go=s("p",null,[s("code",null,"emmm"),l("，"),s("code",null,'node_cpu_seconds_total{mode="idle"}[5m]'),l("这一段是统计出了服务器最近5分钟"),s("code",null,"CPU"),l("的空闲率，执行之后是这种效果，")],-1),_o=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709114438.png#mirages-width=1682&mirages-height=808&mirages-cdn-type=5",alt:"20190709114438"})],-1),bo=s("p",null,[l("这是五分钟之内所有值，然后使用了"),s("code",null,"irate"),l("函数来统计它的平均值，转化成了百分比，乘了一百，所以执行结果如下。")],-1),Eo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709114935.png#mirages-width=1761&mirages-height=439&mirages-cdn-type=5",alt:"20190709114935"})],-1),fo=s("p",null,[l("这就是所有"),s("code",null,"CPU"),l("的空闲率了，我要取的是所有CPU的使用率，所以又一百减去了空闲率的值就是使用率了，所以上面第一条"),s("code",null,"sql"),l("执行发回的结果如下。")],-1),xo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709115136.png#mirages-width=1667&mirages-height=420&mirages-cdn-type=5",alt:"20190709115136"})],-1),vo=s("p",null,[l("这就是五分钟之内总的"),s("code",null,"CPU"),l("的平均使用率了，我的那个节点就是四核"),s("code",null,"CPU"),l("，每个都被列出来了，真鸡儿麻烦，再看一下内存使用率，和上面其实一样，值都有了，求出他的百分比就行了，")],-1),wo={id:"查询内存使用率",tabindex:"-1"},ko=s("p",null,[s("code",null,"linux"),l("内核有一个内存缓存机制，所以"),s("code",null,"buff/cache"),l("的占用不算是已被使用的物理内存，所以计算方式就是将这三个值加到一起就是剩余内存了，")],-1),Po=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709134042.png#mirages-width=611&mirages-height=61&mirages-cdn-type=5",alt:"20190709134042"})],-1),qo=s("p",null,[s("code",null,"sql"),l("的话这样写，直接查一下，")],-1),Bo=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"node_memory_MemFree_bytes"),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}},"node_memory_Cached_bytes"),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}},"node_memory_Buffers_bytes")]),l(`
`),s("span",{class:"line"})])])],-1),jo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709134504.png#mirages-width=1600&mirages-height=341&mirages-cdn-type=5",alt:"20190709134504"})],-1),$o=s("p",null,[l("这就是总共剩余的内存，单位是"),s("code",null,"bite"),l("，现在我要计算使用内存百分比，和上面看"),s("code",null,"CPU"),l("使用率的方法一致，"),s("code",null,"sql"),l("如下")],-1),So=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," (node_memory_MemFree_bytes"),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}},"node_memory_Cached_bytes"),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}},"node_memory_Buffers_bytes) "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," node_memory_MemTotal_bytes "),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#F78C6C"}},"100")]),l(`
`),s("span",{class:"line"})])])],-1),Uo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709135149.png#mirages-width=1505&mirages-height=408&mirages-cdn-type=5",alt:"20190709135149"})],-1),To=s("p",null,"下面看看硬盘使用率",-1),Io={id:"查询硬盘使用率",tabindex:"-1"},No=s("p",null,"你的磁盘和挂载点可能不止一个，先看一下目前收集到的信息，",-1),Oo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709145758.png#mirages-width=1470&mirages-height=478&mirages-cdn-type=5",alt:"20190709145758"})],-1),Go=s("p",null,"所以就要指定分区进行计算了，所以匹配这里写了一个正则去匹配你挂载的磁盘，如下",-1),zo=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," (node_filesystem_free_bytes{mountpoint"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},",fstype"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"~"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"ext4|xfs"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"} "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," node_filesystem_size_bytes{mountpoint"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},",fstype"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"~"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"ext4|xfs"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"} "),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#A6ACCD"}},")")]),l(`
`),s("span",{class:"line"})])])],-1),Lo=s("p",null,[s("code",null,"node_filesystem_size_bytes"),l("查的是"),s("code",null,"/"),l("总大小，"),s("code",null,"node_filesystem_free_bytes"),l("查的是剩余大小，只匹配"),s("code",null,"ext4&xfs"),l("类型的，像是什么"),s("code",null,"tmpfs&shm"),l("类型的都不匹配，还是算出了剩余的百分比，所以执行后的结果是这样，")],-1),Mo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709150539.png#mirages-width=1907&mirages-height=326&mirages-cdn-type=5",alt:"20190709150539"})],-1),Ro=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709150559.png#mirages-width=1185&mirages-height=254&mirages-cdn-type=5",alt:"20190709150559"})],-1),Qo=s("p",null,"计算方式大概就是这样，现在还没涉及到图形展示这一块，下面看一下获取系统服务运行状态。",-1),Wo={id:"查询系统服务运行状态",tabindex:"-1"},Ho=s("p",null,[l("就是监控系统服务运行状态，说白了就是监控以"),s("code",null,"systemctl"),l("启动的服务，现在监控一下这个，"),s("code",null,"node_exports"),l("就支持对这种服务进行监控，目前还没有启用这个功能，现在启动一下撒，直接去改"),s("code",null,"node_exports"),l("的启动文件，加两条参数即可。")],-1),Ko=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# cat /usr/lib/systemd/system/node_exporter.service ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"Unit"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Description"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"node_exporter")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"Service"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Restart"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"on-failure")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ExecStart"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"/usr/local/node_exporter/node_exporter"),s("span",{style:{color:"#A6ACCD"}}," --collector.systemd --collector.systemd.unit-whitelist"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"("),s("span",{style:{color:"#C3E88D"}},"docker"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#C3E88D"}},"sshd"),s("span",{style:{color:"#A6ACCD"}},")"),s("span",{style:{color:"#C3E88D"}},".service")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"Install"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"WantedBy"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"multi-user.target")]),l(`
`),s("span",{class:"line"})])])],-1),Vo=s("p",null,[l("第二段就是制定我要监控哪些系统服务，我写了"),s("code",null,"docker&sshd"),l("，重启后可以去查询了，")],-1),Jo=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# systemctl daemon-reload         ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# systemctl restart node_exporter.service ")]),l(`
`),s("span",{class:"line"})])])],-1),Yo=s("p",null,[l("我查一下当前"),s("code",null,"docker&sshd"),l("的运行状态是什么，可以直接这样写了，")],-1),Zo=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"node_systemd_unit_state{exported_name"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"~"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"(docker|sshd).service"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),Xo=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709153503.png#mirages-width=1908&mirages-height=601&mirages-cdn-type=5",alt:"20190709153503"})],-1),se=s("p",null,[l("目前"),s("code",null,"state=active"),l("的值为"),s("code",null,"0"),l("，说明正常运行，所以之后写告警规则的时候就去判断这个值是不是"),s("code",null,"1"),l("，如果不是就要进行某些操作了，下面装一下"),s("code",null,"grafana"),l("吧")],-1),le={id:"部署grafana",tabindex:"-1"},oe=s("code",null,"grafana",-1),ee=s("code",null,"docker",-1),ne=s("code",null,"k8s",-1),ae=s("code",null,"kubeadm",-1),te=s("code",null,"docker",-1),ce=s("code",null,"deployment",-1),re=s("code",null,"docker",-1),pe=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@kubeadm-node "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# docker run \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," -u "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," -d \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," -p "),s("span",{style:{color:"#F78C6C"}},"3000"),s("span",{style:{color:"#A6ACCD"}},":"),s("span",{style:{color:"#F78C6C"}},"3000"),s("span",{style:{color:"#A6ACCD"}},"  \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," --name"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"grafana"),s("span",{style:{color:"#A6ACCD"}},"   \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," -v /var/lib/grafana:/var/lib/grafana \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," grafana/grafana")]),l(`
`),s("span",{class:"line"})])])],-1),De=s("p",null,[l("这样就行了，直接访问"),s("code",null,"3000"),l("端口就好了，用户名密码默认"),s("code",null,"admin/admin"),l("，初次登陆会让你修改密码，就可以看到主页了，然后直接添加数据源，把"),s("code",null,"prometheus"),l("加进去，保存就行了，")],-1),ie=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709163321.png#mirages-width=556&mirages-height=777&mirages-cdn-type=5",alt:"20190709163321"})],-1),ye=s("p",null,[l("然后直接导入一个仪表盘进来吧，"),s("code",null,"ID"),l("是"),s("code",null,"9276"),l("，大概是这种效果，")],-1),Ce=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709173630.png#mirages-width=1786&mirages-height=883&mirages-cdn-type=5",alt:"img"})],-1),Fe=s("p",null,[l("然后网络带宽那里没数据，我看了一下他的"),s("code",null,"sql"),l("，只需要将"),s("code",null,"$nic"),l("改为你的网卡名就有数据了，所以现在监控"),s("code",null,"linux"),l("服务器是没问题了，下面试试监控"),s("code",null,"docker"),l("。")],-1),Ae={id:"监控docker",tabindex:"-1"},de=s("code",null,"docker",-1),ue=s("code",null,"cadvisor",-1),he=s("code",null,"cadvisor",-1),me=s("code",null,"docker",-1),ge=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"run"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--volume=/:/rootfs:ro"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--volume=/var/run:/var/run:ro"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--volume=/sys:/sys:ro"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--volume=/var/lib/docker/:/var/lib/docker:ro"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--volume=/dev/disk/:/dev/disk:ro"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--publish=8080:8080"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--detach=true"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"--name=cadvisor"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"google/cadvisor:latest")]),l(`
`),s("span",{class:"line"})])])],-1),_e=s("p",null,[l("容器启动后也是会暴露一个指标接口，默认是"),s("code",null,"8080/metrics"),l("，这里就不访问了，下一步就是加入到普罗米修斯中进行监控了，去改他的配置文件，静态配置一个吧，")],-1),be=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"docker"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"192.168.1.248:8080"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),Ee=s("p",null,[l("加完直接重载，页面直接导入一个图表吧，"),s("code",null,"ID"),l("是"),s("code",null,"193"),l("或者11277再或者11600！！！，效果是这样的，")],-1),fe=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709181607.png#mirages-width=1787&mirages-height=969&mirages-cdn-type=5",alt:"20190709181607"})],-1),xe=s("p",null,[l("主要就是监控容器的"),s("code",null,"CPU"),l("内存网络流量的，都可看到，目前我"),s("code",null,"248"),l("就运行了六个容器，就是这样，下面在看看监控"),s("code",null,"mysql")],-1),ve={id:"监控mysql",tabindex:"-1"},we=s("code",null,"mysql",-1),ke=s("code",null,"mysql_exporter",-1),Pe=s("code",null,"mysql",-1),qe=s("code",null,"mysql",-1),Be=s("code",null,"mysql",-1),je=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mysql"),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"CREATE"),s("span",{style:{color:"#A6ACCD"}}," USER "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"exporter"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"@"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}}," IDENTIFIED "),s("span",{style:{color:"#F78C6C"}},"BY"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"exporter"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Query OK, "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"rows"),s("span",{style:{color:"#A6ACCD"}}," affected ("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}},"."),s("span",{style:{color:"#F78C6C"}},"02"),s("span",{style:{color:"#A6ACCD"}}," sec)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mysql"),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"GRANT"),s("span",{style:{color:"#A6ACCD"}}," PROCESS, REPLICATION CLIENT, "),s("span",{style:{color:"#F78C6C"}},"SELECT"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"ON"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}},"."),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"TO"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"exporter"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"@"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"localhost"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Query OK, "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"rows"),s("span",{style:{color:"#A6ACCD"}}," affected ("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}},"."),s("span",{style:{color:"#F78C6C"}},"00"),s("span",{style:{color:"#A6ACCD"}}," sec)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mysql"),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," flush privileges;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Query OK, "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"rows"),s("span",{style:{color:"#A6ACCD"}}," affected ("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#A6ACCD"}},"."),s("span",{style:{color:"#F78C6C"}},"00"),s("span",{style:{color:"#A6ACCD"}}," sec)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mysql"),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"select"),s("span",{style:{color:"#A6ACCD"}}," user,host "),s("span",{style:{color:"#F78C6C"}},"from"),s("span",{style:{color:"#A6ACCD"}}," mysql.user;")]),l(`
`),s("span",{class:"line"})])])],-1),$e=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709184630.png#mirages-width=476&mirages-height=226&mirages-cdn-type=5",alt:"20190709184630"})],-1),Se=s("p",null,"用户创建好了去解压包吧，",-1),Ue=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@mysql "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# tar zxf mysqld_exporter-0.11.0.linux-amd64.tar.gz -C /usr/local/ "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"cd"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@mysql local"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# mv mysqld_exporter-0.11.0.linux-amd64/ mysqld_exporter "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"cd"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"mysqld_exporter")]),l(`
`),s("span",{class:"line"})])])],-1),Te=s("p",null,[l("需要写一个文件，"),s("code",null,"mysqld_exporter"),l("直接读这个文件就可以连接"),s("code",null,"mysql"),l("了，")],-1),Ie=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@mysql mysqld_exporter"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat .my.cnd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"client"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"user"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"exporter")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"password"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},"exporter")]),l(`
`),s("span",{class:"line"})])])],-1),Ne=s("p",null,"文件有了，在启动的时候指定一下读取这个文件，直接启动",-1),Oe=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@mysql mysqld_exporter"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# ./mysqld_exporter --config.my-cnf"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#C3E88D"}},".my.cnf")]),l(`
`),s("span",{class:"line"})])])],-1),Ge=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709185400.png#mirages-width=692&mirages-height=115&mirages-cdn-type=5",alt:"img"})],-1),ze=s("p",null,"现在把这个加到普罗米修斯中，",-1),Le=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"mysql"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"192.168.1.126:9104"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),Me=s("p",null,[l("然后导入一个仪表盘，"),s("code",null,"ID"),l("为"),s("code",null,"7362"),l("，看页面，")],-1),Re=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190709190259.png#mirages-width=1795&mirages-height=900&mirages-cdn-type=5",alt:"img"})],-1),Qe=s("p",null,[l("还是有些空值，而且官方也说了"),s("code",null,"5.6"),l("版本有些不支持，我看了一下"),s("code",null,"Buffer Pool Size of Total RAM"),l("的"),s("code",null,"sql"),l("，是这样写的，")],-1),We=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"(mysql_global_variables_innodb_buffer_pool_size{instance"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"$host"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"} "),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#A6ACCD"}},") "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"on"),s("span",{style:{color:"#A6ACCD"}}," (instance) node_memory_MemTotal_bytes{instance"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"$host"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),He=s("p",null,[l("现在应该能看的差不多了，他去查了"),s("code",null,"mysql"),l("节点的总内存，但是我明月三千里节点并没有装"),s("code",null,"node_exports"),l("，所以就没数据了，总之支持采集的数据和仪表盘模板很多，自行琢磨吧，上面只是最简单的几个例子，下面来看看告警这一块的东西。")],-1),Ke={id:"alertmanager",tabindex:"-1"},Ve=s("p",null,[l("普罗米修斯本身是不支持告警的，告警是由"),s("code",null,"alertmanager"),l("这个组件完成的，普罗米修斯将告警收集起来会推送给"),s("code",null,"alertmanager"),l("，"),s("code",null,"alertmanager"),l("接收到告警后决定怎么去处理这些告警，应该发给谁，下面先部署一下"),s("code",null,"alertmanager"),l("吧，我直接下载了，在普罗米修斯服务器上，")],-1),Je={id:"部署alertmanager",tabindex:"-1"},Ye=s("p",null,[s("code",null,"alertmanager"),l("没必要和普罗米修斯放在一个服务器上，他们之间能通讯就可以了，我目前资源紧张就扔到一起了，直接"),s("code",null,"wget"),l("了，")],-1),Ze=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# wget https://github.com/prometheus/alertmanager/releases/download/v0."),s("span",{style:{color:"#F78C6C"}},"18.0"),s("span",{style:{color:"#A6ACCD"}},"/alertmanager-0.18.0.linux-amd64.tar.gz")]),l(`
`),s("span",{class:"line"})])])],-1),Xe=s("p",null,[l("让他先下着，聊一下普罗米修斯和"),s("code",null,"alertmanager"),l("是怎么通讯的，首先你需要在"),s("code",null,"prometheus"),l("中定义你的监控规则，说白了就是写一个触发器，某个值超过了我设置的阈值我就要告警了，触发告警之后"),s("code",null,"prometheus"),l("会推送当前的告警规则到"),s("code",null,"alertmanager"),l("，"),s("code",null,"alertmanager"),l("收到了会进行一系列的流程处理，然后发送到接收人手里，他的处理规则也是很复杂的，后面会说，现在也下载完了，解压")],-1),sn=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# tar zxf alertmanager-0.18.0.linux-amd64.tar.gz ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#A6ACCD"}},"# mv alertmanager-0.18.0.linux-amd64 /usr/local/alertmanager "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"cd"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/alertmanager"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"ls")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"alertmanager"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"alertmanager.yml"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"amtool"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"LICENSE"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"NOTICE")]),l(`
`),s("span",{class:"line"})])])],-1),ln=s("p",null,"有两个二进制文件，分别是启动程序和一个工具，还有一个主配置文件，先来了解一下他的主配置文件，",-1),on=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"resolve_timeout"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"})])])],-1),en=s("p",null,"全局配置，设置解析超时时间，",-1),nn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##alertmanager中的分组，选哪个标签作为分组的依据")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s"),s("span",{style:{color:"#A6ACCD"}},"              "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##分组等待时间，拿到第一条告警后等待10s，如果有其他的一起发送出去")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s"),s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##各个分组之前发搜告警的间隔时间")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1h"),s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##重复告警时间，默认1小时")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"web.hook"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##接收者")]),l(`
`),s("span",{class:"line"})])])],-1),an=s("p",null,"这里是配置告警的，配置告警怎么发送，怎么来分配，",-1),tn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"receivers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"web.hook"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"webhook_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"url"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"http://127.0.0.1:5001/"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"})])])],-1),cn=s("p",null,"这里是配置告警的接收者，我要发送给谁，",-1),rn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"inhibit_rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"source_match"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"critical"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"target_match"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"warning"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"equal"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"dev"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"instance"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),pn=s("p",null,[l("这里用于配置告警收敛的，主要就是减少发送告警，来发送一些关键的，所以先把这段注释了吧，暂时用不到，之后会用到，所以基于这个配置文件改改，暂时先发送"),s("code",null,"email"),l("吧，所以改完的配置文件如下，")],-1),Dn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/alertmanager"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat alertmanager.yml"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"resolve_timeout"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_smarthost"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"smtp.163.com:25"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#smtp服务地址")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_from"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@163.com"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#发送邮箱")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_auth_username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@163.com"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#认证用户名")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_auth_password"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxxx"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#认证密码")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_require_tls"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FF9CAC"}},"false"),s("span",{style:{color:"#A6ACCD"}},"                   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#禁用tls")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"email"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#定义接受告警组名")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"receivers"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"email"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#定义组名")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#配置邮件")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xx@xxx.com"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                     "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#收件人")]),l(`
`),s("span",{class:"line"})])])],-1),yn=s("p",null,"保存后检查一下这个文件有没有问题，命令如下，",-1),Cn=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/alertmanager"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# ./amtool check-config alertmanager.yml ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Checking"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertmanager.yml"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"SUCCESS")]),l(`
`),s("span",{class:"line"})])])],-1),Fn=s("p",null,"然后去启动吧，还是加到系统服务中吧，",-1),An=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@rj-bai /usr/local/alertmanager"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," /usr/lib/systemd/system/alertmanager.service "),s("span",{style:{color:"#89DDFF"}},"<<OEF"),s("span",{style:{color:"#C3E88D"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Unit]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> Description=alertmanager")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Service]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> Restart=on-failure")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ExecStart=/usr/local/alertmanager/alertmanager --config.file=/usr/local/alertmanager/alertmanager.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> [Install]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> WantedBy=multi-user.target")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"> OEF")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C3E88D"}},"[root@rj-bai /usr/local/alertmanager]# systemctl start alertmanager")]),l(`
`),s("span",{class:"line"})])])],-1),dn=s("p",null,[l("现在"),s("code",null,"alertmanager"),l("是装完了，需要和"),s("code",null,"prometheus"),l("融合一下，需要配置两部分，分别如下，")],-1),un=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"alerting"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"alertmanagers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"       "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"127.0.0.1:9093"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##配置alertmanager地址，我的在本机")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"rule_files"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"rules/*.yml"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##配置告警规则的文件")]),l(`
`),s("span",{class:"line"})])])],-1),hn=s("p",null,[l("配置这两项就够了，保存之后创建"),s("code",null,"rules"),l("目录，接下来就可以配置告警规则了。")],-1),mn={id:"配置告警规则并邮件通知",tabindex:"-1"},gn=s("p",null,"我直接在官方复制过来了一个例子顺便改了改，如下，",-1),_n=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/prometheus/rules"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat example.yml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"groups"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"exports.rules"),s("span",{style:{color:"#A6ACCD"}},"     "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##定义这组告警的组名，同性质的，都是监控实例exports是否开启的模板")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"alert"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"采集器凉了"),s("span",{style:{color:"#A6ACCD"}},"     "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 告警名称")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"expr"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"up == 0"),s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 告警表达式，监控up指标，如果等于0就进行下面的操作")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"for"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m"),s("span",{style:{color:"#A6ACCD"}},"              "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 持续一分钟为0进行告警")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"              "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 定义告警级别")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"ERROR")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"annotations"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#676E95","font-style":"italic"}},"## 定义了告警通知怎么写，默认调用了{$labels.instance&$labels.job}的值")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"summary"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"实例 {{ $labels.instance }} 采集器凉了撒"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"description"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"实例 {{ $labels.instance }} job 名为 {{ $labels.job }} 的采集器凉了有一分钟了撒"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"})])])],-1),bn=s("p",null,[l("每个实例都会有一个"),s("code",null,"up"),l("的指标，上面的标签名"),s("code",null,"job"),l("都能看到，用"),s("code",null,"sql"),l("去查一下，")],-1),En=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711145721.png#mirages-width=1720&mirages-height=403&mirages-cdn-type=5",alt:"img"})],-1),fn=s("p",null,[l("采集器在开启状态下返回值就是"),s("code",null,"1"),l("，如果采集器出现问题没启动或是什么别的异常都会返回"),s("code",null,"0"),l("，"),s("code",null,"0"),l("就是代表异常了，所以说白了就是那条规则就是监控所有实例的"),s("code",null,"up"),l("指标，如果指标值为"),s("code",null,"0"),l("且持续时间超过一分钟我就要告警了，保存吧，直接重启"),s("code",null,"prometheus"),l("吧，重启之后可以在"),s("code",null,"web"),l("控制台看到你配置的规则了，")],-1),xn=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711152123.png#mirages-width=1840&mirages-height=360&mirages-cdn-type=5",alt:"img"})],-1),vn=s("p",null,[l("emmmm，既然配置完了，验证一下吧，随便关掉一个采集器，等邮件就行了，我把明月三千里的关掉了，然后发现有一条告警处于"),s("code",null,"PENDING"),l("状态，他已经准备去通知"),s("code",null,"alertmanager"),l("了，")],-1),wn=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711153136.png#mirages-width=1834&mirages-height=466&mirages-cdn-type=5",alt:""})],-1),kn=s("p",null,"一分钟之后我收到邮件了，长这样，",-1),Pn=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711154859.png#mirages-width=1120&mirages-height=578&mirages-cdn-type=5",alt:"20190711154859"})],-1),qn=s("p",null,[l("如果问题没解决他每分钟都会给你发一封邮件，刚刚配置了，发送邮件的等待时间一会会细说一下，我再停一个，我再把"),s("code",null,"docker"),l("停了，看看他发出的邮件是什么样的，")],-1),Bn=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711155830.png#mirages-width=1118&mirages-height=766&mirages-cdn-type=5",alt:"img"})],-1),jn=s("code",null,"alertname ",-1),$n=s("code",null,"mysql&docker",-1),Sn=s("code",null,"alertmanager",-1),Un={id:"告警状态",tabindex:"-1"},Tn=s("p",null,[l("目前"),s("code",null,"alertmanager"),l("告警状态分为三种，如下")],-1),In=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"值"),s("th",null,"说明")])]),s("tbody",null,[s("tr",null,[s("td",null,"Inactive"),s("td",null,"什么都没有发生")]),s("tr",null,[s("td",null,"Pending"),s("td",null,"已触发阈值，但未满足告警持续时间，for时间")]),s("tr",null,[s("td",null,"Firing"),s("td",null,"已触发阈值且满足告警持续时间，通知alertmanager你可以发送告警了")])])],-1),Nn=s("p",null,[l("在这个阶段是有个时间的，并不是出现问题告警会马上发出去，这个时间包含了数据采集时间、告警评估时间，这两个时间是在"),s("code",null,"prometheus"),l("中配置的，也就是这里，")],-1),On=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"scrape_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"     "),s("span",{style:{color:"#C3E88D"}},"15s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"evaluation_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"15s"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),Gn=s("p",null,[l("目前是十五秒采集一次数据，评估告警规则时间也是十五秒，这个评估告警规则的时间就是我每隔多长时间要进行一次评估是否到达的阈值了，说白了这东西的目的就是为了减少告警的次数，更加精确的判断当前的状态是不是"),s("code",null,"ok"),l("的，下面在看看告警的分配")],-1),zn={id:"告警的分配",tabindex:"-1"},Ln=s("p",null,[l("具体告警要怎么去分配，也是在"),s("code",null,"alertmanager"),l("中配置的，也就是这一段，")],-1),Mn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"email"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"})])])],-1),Rn=s("p",null,[l("这就是设置告警的分发策略了，这个"),s("code",null,"route"),l("可以拆分成多个子路由，目前所有的告警都会发送到名为"),s("code",null,"email"),l("的接收器里面，"),s("code",null,"email"),l("接收器的规则也是在配置文件中指定的，也就是这一段，")],-1),Qn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"receivers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"email"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xx@xxx.com"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"})])])],-1),Wn=s("p",null,[l("接收器目前只有一个名为"),s("code",null,"email"),l("的，也可以有多个，如果你有什么特殊需求，需要将不同类型的告警发送给不同的人，就需要配置多个接收器去区分了，如下，")],-1),Hn=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"global"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"resolve_timeout"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_smarthost"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"smtp.163.com:25"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_from"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@163.com"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_auth_username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@163.com"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_auth_password"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"smtp_require_tls"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FF9CAC"}},"false")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"default-receiver"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##定义默认接收器名，如果其他的匹配不到走这个")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"30s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"4h")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"cluster"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"                "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##分组设置")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"routes"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                       "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##子路由")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"database-pager"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##定义接收器名字          ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s"),s("span",{style:{color:"#A6ACCD"}},"                             "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##分组设置")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"match_re"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##正则匹配")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"service"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"mysql|cassandra"),s("span",{style:{color:"#A6ACCD"}},"                  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##他会接收标签service值为mysql&&cassandra的告警")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"frontend-pager"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##接收器名")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"product"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"environment"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"            "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##分组设置")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"match"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##直接匹配")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"team"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"frontend"),s("span",{style:{color:"#A6ACCD"}},"                            "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##匹配标签team值为frontend的告警")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"receivers"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##定义接收器")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"default-receiver"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##接收器名字")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"                                "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##邮件接口")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx.xx.com"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"                            "),s("span",{style:{color:"#676E95","font-style":"italic"}},"##接收人，下面以此类推")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"database-pager"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx.xx.com"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"frontend-pager"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@.xx.com"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"})])])],-1),Kn=s("p",null,"我就不掩饰了，配置其实很简单，演示很麻烦撒，算了算了，过，下面看一哈告警收敛",-1),Vn={id:"告警收敛",tabindex:"-1"},Jn=s("p",null,[l("收敛就是尽量压缩告警邮件的数量，太多了谁都会懵逼，可能有些关键的呗淹没了，"),s("code",null,"alertmanager"),l("中有很多收敛机制，最主要的就是分组抑制静默，"),s("code",null,"alertmanager"),l("收到告警之后他会先进行分组，然后进入通知队列，这个队列会对通知的邮件进行抑制静默，再根据"),s("code",null,"router"),l("将告警路由到不同的接收器，这就是"),s("code",null,"alertmanager"),l("收到一个告警后经历的阶段，只是一个大概的情况，下面深入了解一下这几个阶段到底是什么原理怎么去配置，先来简单看一下他们的定义")],-1),Yn=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"机制"),s("th",null,"说明")])]),s("tbody",null,[s("tr",null,[s("td",null,"分组(group)"),s("td",null,"将类似性质的告警合并为单个进行通知")]),s("tr",null,[s("td",null,"抑制(Inhibition)"),s("td",null,"当告警发生后，停止重复发送由此告警引发的其他告警")]),s("tr",null,[s("td",null,"静默(Silences)"),s("td",null,"是一种简单的特定时间静音提醒的机制")])])],-1),Zn={id:"分组",tabindex:"-1"},Xn=s("p",null,[l("举个栗子，比如说我在阿里云有"),s("code",null,"10"),l("台服务器，但是我忘续费了，结果服务器到期都被停掉了(真实发生过)，这时候"),s("code",null,"node_exports"),l("肯定也无法访问了，服务器都停了，这时候普罗米修斯发现这"),s("code",null,"10"),l("个服务器都凉了，我要准备通知"),s("code",null,"alertmanager"),l("告警了，在不做分组的情况下你的告警媒介会有十条信息发出来，这种情况下我们可以他这些信息合并到一起撒，一条信息列出哪些服务器凉了。")],-1),sa=s("p",null,"其实分组设置最开始的时候我就做了，这一段就是设置分组的，",-1),la=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m")]),l(`
`),s("span",{class:"line"})])])],-1),oa=s("p",null,[l("这里配置了分组的依据，默认就是"),s("code",null,"alertname"),l("，这个名字可以随便写的，做了分组之后他会去匹配你告警时的名字，告警的名字是在这里配置的，")],-1),ea=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"alert"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"采集器凉了")]),l(`
`),s("span",{class:"line"})])])],-1),na=s("p",null,[l("如果是相同名字的告警在一定时间内出现多条，这个一定时间指的就是"),s("code",null,"group_wait"),l("的时间，那么多条就会合并成一条告警信息发出来，这个之前就配置了，所以在我停掉"),s("code",null,"mysql&docker"),l("采集器之后他就把这两条告警合并成一条信息发了出来，也就是这张图，上面贴过了。")],-1),aa=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190711155830.png#mirages-width=1118&mirages-height=766&mirages-cdn-type=5",alt:"img"})],-1),ta=s("p",null,"这两条的告警名字都是采集器凉了撒，而且在十秒钟之内出现了两条，所以就被合并成一条发出来了，分组的目的就是为了减少告警信息的数量，同类告警聚合，所以现在总结一下配置分组的参数。",-1),ca=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#根据标签进行alert分组，可以写多个")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s"),s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#发送告警等待时间，")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s"),s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#分组告警信息间隔时间，譬如两组，第一组发送后等待十秒发送第二组")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m"),s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#重复发送告警时间，时间不要太短，也不要太长")]),l(`
`),s("span",{class:"line"})])])],-1),ra={id:"抑制",tabindex:"-1"},pa=s("p",null,[l("他的主要作用就是消除冗余告警，我们会受到一个关键的告警信息，这个也是在"),s("code",null,"alertmanager"),l("中配置的，我标签只留了一个，")],-1),Da=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"inhibit_rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"source_match"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"          ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"critical"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"target_match"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"warning"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"equal"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"instance"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),ia=s("p",null,[l("这段配置意思就是当我收到一个告警级别为"),s("code",null,"critical"),l("时，他就会抑制掉"),s("code",null,"warning"),l("这个级别的告警，这个告警等级是在你编写规则的时候定义的，最后一行就是要对哪些告警做抑制，通过标签匹配的，我这里只留了一个"),s("code",null,"instance"),l("，举个最简单的例子，当现在"),s("code",null,"alertmanager"),l("先收到一条"),s("code",null,"critical"),l("、又收到一条"),s("code",null,"warning"),l("且"),s("code",null,"instance"),l("值一致的两条告警他的处理逻辑是怎样的。")],-1),ya=s("p",null,[l("我现在监控"),s("code",null,"nginx"),l("，"),s("code",null,"nginx"),l("宕掉的告警级别为"),s("code",null,"warning"),l("，宿主机宕掉的告警级别为"),s("code",null,"critical"),l("，譬如说现在我跑"),s("code",null,"nginx"),l("的服务器凉了，这时候"),s("code",null,"nginx"),l("肯定也凉了，普罗米修斯发现后通知"),s("code",null,"alertmanager"),l("，普罗米修斯发过来的是两条告警信息，一条是宿主机凉了的，一条是"),s("code",null,"nginx"),l("凉了的，"),s("code",null,"alertmanager"),l("收到之后，发现告警级别一条是"),s("code",null,"critical"),l("，一条是"),s("code",null,"warning"),l("，而且"),s("code",null,"instance"),l("标签值一致，也就是说这是在一台机器上发生的，所以他就会只发一条"),s("code",null,"critical"),l("的告警出来，"),s("code",null,"warning"),l("的就被抑制掉了，我们收到的就是服务器凉了的通知，大概就是这样，暂时不演示了。")],-1),Ca={id:"静默",tabindex:"-1"},Fa=s("p",null,[l("就是一个简单的特定时间静音提醒的机制，主要是使用标签匹配这一批不发送告警，譬如说我某天要对服务器进行维护，可能会涉及到服务器重启，在这期间肯定会有"),s("code",null,"N"),l("多告警发出来，所以你可以子啊这期间配置一个静默，这类的告警就不要发了，我知道发生了啥子事情，配置静默就很简单了，直接在"),s("code",null,"web"),l("页面配置就行了，"),s("code",null,"9093"),l("端口，")],-1),Aa=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715113322.png#mirages-width=1435&mirages-height=425&mirages-cdn-type=5",alt:"img"})],-1),da=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715113602.png#mirages-width=1173&mirages-height=769&mirages-cdn-type=5",alt:"img"})],-1),ua=s("p",null,[l("选择开始时间结束时间，通过标签匹配去做，我匹配了"),s("code",null,"job=docker"),l("的机器，创建，所以我先在把容器采集器停掉也不会有告警出来了，我就不停了，就是这样配置，比较简单，扯了一堆，是时候自己写一个告警规则了，结合上面一切的东西。")],-1),ha={id:"编写告警规则栗子",tabindex:"-1"},ma=s("p",null,[l("来监控内存吧，内存使用率超过"),s("code",null,"80"),l("我就要告警了，还是先需要写"),s("code",null,"sql"),l("，把我想要的值查出来，所以要查当前内存使用率大于百分之八十的"),s("code",null,"sql"),l("如下，")],-1),ga=s("div",{class:"language-sql"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"(node_memory_MemTotal_bytes "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," node_memory_MemFree_bytes "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," node_memory_Buffers_bytes "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," node_memory_Cached_bytes) "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," (node_memory_MemTotal_bytes )"),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"80")]),l(`
`),s("span",{class:"line"})])])],-1),_a=s("p",null,"下面就是要写规则了，我写的规则如下，顺便把之前的规则也改了一下，",-1),ba=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/prometheus/rules"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat memory.yml"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"groups"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"memeory_rules")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"alert"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"内存炸了")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"expr"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"(node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / (node_memory_MemTotal_bytes )* 100 > 80")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"for"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"warning")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"annotations"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"summary"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"{{ $labels.instance }} 内存炸了"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"description"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"{{ $labels.instance }} 内存炸了，当前使用率为 {{ $value }}"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"})])])],-1),Ea=s("p",null,[l("这样就可以了撒，我又把明月三千里加入到监控，也就是安装了"),s("code",null,"node_exports"),l("，现在也能正常获取到使用率了，下面试试上面提到的那个告警分配，我要把明月三千里的告警信息发送到我另一个邮箱，"),s("code",null,"job"),l("名字"),s("code",null,"mysql"),l("，")],-1),fa=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"mysql"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"192.168.1.126:9104"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"192.168.1.126:9100"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),xa=s("p",null,"重启一下撒，能看到这些，",-1),va=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715142721.png#mirages-width=1225&mirages-height=304&mirages-cdn-type=5",alt:"img"})],-1),wa=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715143146.png#mirages-width=666&mirages-height=692&mirages-cdn-type=5",alt:"img"})],-1),ka=s("p",null,"然后去配置一下告警的分配，我要把关于明月三千里的告警发送到另一个邮箱，所以这里改了一哈，",-1),Pa=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"route"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"alertname"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"default-receiver"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"routes"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"group_by"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"mysql"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"group_wait"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"group_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"repeat_interval"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"5m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"receiver"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"mysql-pager"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"match_re"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"job"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"mysql")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"receivers"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"default-receiver"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@xx.com"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"mysql-pager"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"email_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"to"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"xxx@xx.cn"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"inhibit_rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"source_match"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"          ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"critical"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"target_match"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"warning"),s("span",{style:{color:"#89DDFF"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"equal"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"instance"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"})])])],-1),qa=s("p",null,[l("所以一会收到明月三千里的邮件是我"),s("code",null,"cn"),l("的邮箱，这样就可以了撒，重启"),s("code",null,"alertmanager"),l("，为了让他发出告警邮件，我调一下阈值，改为百分之"),s("code",null,"20"),l("，所以我"),s("code",null,"com"),l("收到的邮件如下，")],-1),Ba=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715150334.png#mirages-width=971&mirages-height=460&mirages-cdn-type=5",alt:"img"})],-1),ja=s("p",null,[s("code",null,"cn"),l("收到的邮件如下")],-1),$a=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715150419.png#mirages-width=936&mirages-height=437&mirages-cdn-type=5",alt:"img"})],-1),Sa=s("p",null,[l("然后再试一下抑制，我再加一个监控项，我要监控"),s("code",null,"TCP"),l("连接数，状态是"),s("code",null,"ESTABLISHED"),l("的，超过"),s("code",null,"300"),l("我就要告警了，定义告警级别为"),s("code",null,"critical"),l("，所以"),s("code",null,"rule"),l("文件如下，")],-1),Ua=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#C3E88D"}},"root@rj-bai /usr/local/prometheus/rules"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# "),s("span",{style:{color:"#C3E88D"}},"cat tcp-established.yml"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"groups"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"tcp-established_rules")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"rules"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"alert"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"TCP连接数过高")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"expr"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"node_sockstat_TCP_alloc > 300"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"for"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"severity"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"critical")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"annotations"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"summary"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"{{ $labels.instance }} TCP连接数过高"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#F07178"}},"description"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"{{ $labels.instance }} TCP连接数过高，当前连接数 {{ $value }}"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"})])])],-1),Ta=s("p",null,"重启后看页面，",-1),Ia=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715160750.png#mirages-width=1534&mirages-height=809&mirages-cdn-type=5",alt:"img"})],-1),Na=s("p",null,[l("有三条告警已经进入"),s("code",null,"Pending"),l("状态了，没意外的话"),s("code",null,"cn"),l("邮箱只有一条告诉你连接数过高的告警信息发出来了，内存使用率过高的就会被抑制，看一下，")],-1),Oa=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715161059.png#mirages-width=1861&mirages-height=792&mirages-cdn-type=5",alt:"img"})],-1),Ga=s("p",null,"所以这条已经被抑制了，",-1),za=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715161644.png",alt:"img"})],-1),La=s("p",null,[s("code",null,"248"),l("服务器不受影响，"),s("code",null,"com"),l("邮箱还是会收到内存炸了的告警，")],-1),Ma=s("p",null,[s("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20190715161714.png",alt:"img"})],-1),Ra=s("p",null,[l("就是这样撒，你想编写其他的告警规则流程和上面是一样的，告警的分配和抑制不是必需的，自行琢磨吧，下一篇准备重写"),s("code",null,"K8S"),l("监控方面的东西，了解这些东西之后之后就应该很简单了撒，本篇就这样，过。")],-1);function Qa(a,Wa,Ha,Ka,r,Va){const e=F,p=D;return C(),y(p,{frontmatter:r.frontmatter,data:r.data},{"main-content-md":o(()=>[s("h1",u,[l("Prometheus+Grafana全方位监控系统 "),n(e,{class:"header-anchor",href:"#prometheus-grafana全方位监控系统","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),h,m,g,s("h2",_,[l("Prometheus概述 "),n(e,{class:"header-anchor",href:"#prometheus概述","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),b,s("h3",E,[l("Prometheus是什么 "),n(e,{class:"header-anchor",href:"#prometheus是什么","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("中文名普罗米修斯，最初在"),f,l("上构建的监控系统，自"),x,l("年成为社区开源项目，用户非常活跃的开发人员和用户社区，2016年加入"),v,l("，成为继"),w,l("之后的第二个托管项目，"),n(e,{href:"https://prometheus.io/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("官方网站")]),_:1})]),s("h3",k,[l("Prometheus特点 "),n(e,{class:"header-anchor",href:"#prometheus特点","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),P,q,s("h3",B,[l("Prometheus 组成与架构 "),n(e,{class:"header-anchor",href:"#prometheus-组成与架构","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),j,$,S,U,s("h3",T,[l("数据模型 "),n(e,{class:"header-anchor",href:"#数据模型","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),I,N,O,G,z,L,s("h3",M,[l("指标类型 "),n(e,{class:"header-anchor",href:"#指标类型","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),R,Q,s("h3",W,[l("作业和实例 "),n(e,{class:"header-anchor",href:"#作业和实例","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),H,s("h2",K,[l("Prometheus部署 "),n(e,{class:"header-anchor",href:"#prometheus部署","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("先通过二进制来部署"),V,l("吧，"),n(e,{href:"https://github.com/prometheus/prometheus/releases",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("下载地址")]),_:1}),l("，我们要下载服务端，也就是这个包")]),J,Y,Z,X,ss,ls,os,es,ns,as,ts,cs,s("h2",rs,[l("全局配置文件介绍 "),n(e,{class:"header-anchor",href:"#全局配置文件介绍","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),ps,s("h3",Ds,[l("全局配置文件 "),n(e,{class:"header-anchor",href:"#全局配置文件","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("也就是"),is,l("，官方说明"),n(e,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("地址")]),_:1}),l("，大概分为这几块，我把注释去掉了，全局配置选项")]),ys,Cs,Fs,As,ds,us,hs,ms,gs,_s,s("h3",bs,[l("scrape_configs "),n(e,{class:"header-anchor",href:"#scrape-configs","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Es,fs,xs,vs,ws,ks,Ps,qs,Bs,js,$s,Ss,Us,Ts,Is,Ns,Os,s("h3",Gs,[l("relabel_configs "),n(e,{class:"header-anchor",href:"#relabel-configs","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),zs,Ls,Ms,Rs,Qs,s("h4",Ws,[l("添加标签 "),n(e,{class:"header-anchor",href:"#添加标签","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Hs,Ks,Vs,Js,Ys,Zs,Xs,sl,ll,ol,el,nl,s("h4",al,[l("标签重命名 "),n(e,{class:"header-anchor",href:"#标签重命名","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),tl,cl,rl,pl,Dl,il,yl,Cl,Fl,Al,dl,ul,hl,s("h4",ml,[l("action重新打标签动作 "),n(e,{class:"header-anchor",href:"#action重新打标签动作","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),gl,_l,bl,El,fl,xl,vl,s("h4",wl,[l("删除标签 "),n(e,{class:"header-anchor",href:"#删除标签","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),kl,Pl,ql,Bl,jl,s("h3",$l,[l("基于文件的服务发现 "),n(e,{class:"header-anchor",href:"#基于文件的服务发现","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Sl,Ul,Tl,Il,Nl,Ol,Gl,zl,Ll,Ml,Rl,Ql,s("h2",Wl,[l("监控栗子 "),n(e,{class:"header-anchor",href:"#监控栗子","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("h3",Hl,[l("监控linux服务器 "),n(e,{class:"header-anchor",href:"#监控linux服务器","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[Kl,l("，在被监控端需要装一个名为"),Vl,l("的导出器，他会帮你收集系统指标和一些软件运行的指标，把指标暴露出去，这样"),Jl,l("就可以去采集了，具体"),Yl,l("能采集哪些东西，看官方的"),n(e,{href:"https://github.com/prometheus/node_exporter",target:"_blank",rel:"noreferrer"},{default:o(()=>[Zl]),_:1}),l("吧，还是蛮多的，现在随便找个服务器下载一下"),Xl,l("运行起来就行了。")]),so,lo,oo,eo,no,ao,to,co,ro,po,Do,io,s("h3",yo,[l("使用PromSQL "),n(e,{class:"header-anchor",href:"#使用promsql","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Co,s("h4",Fo,[l("查询CPU使用率 "),n(e,{class:"header-anchor",href:"#查询cpu使用率","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Ao,uo,ho,mo,go,_o,bo,Eo,fo,xo,vo,s("h4",wo,[l("查询内存使用率 "),n(e,{class:"header-anchor",href:"#查询内存使用率","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),ko,Po,qo,Bo,jo,$o,So,Uo,To,s("h4",Io,[l("查询硬盘使用率 "),n(e,{class:"header-anchor",href:"#查询硬盘使用率","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),No,Oo,Go,zo,Lo,Mo,Ro,Qo,s("h4",Wo,[l("查询系统服务运行状态 "),n(e,{class:"header-anchor",href:"#查询系统服务运行状态","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Ho,Ko,Vo,Jo,Yo,Zo,Xo,se,s("h3",le,[l("部署grafana "),n(e,{class:"header-anchor",href:"#部署grafana","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[oe,l("就是一个图形展示系统，他主要是对度量指标进行分析可视化，他本身不会存储任何数据，他只会展示数据库里面的数据，支持很多类型的数据库，"),n(e,{href:"https://grafana.com/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("官网")]),_:1}),l("，刚好我装有"),ee,l("，其实目前在操作的这两台服务是一个"),ne,l("集群，用"),ae,l("启动的，所以我直接用"),te,l("启动了，还是写个"),ce,l("，算了直接用"),re,l("命令启吧，")]),pe,De,ie,ye,Ce,Fe,s("h3",Ae,[l("监控docker "),n(e,{class:"header-anchor",href:"#监控docker","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("想要监控"),de,l("需要用到名为"),ue,l("的工具，是谷歌开源的，它用于收集正在运行的容器资源使用和性能信息，"),n(e,{href:"https://github.com/google/cadvisor",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("github")]),_:1}),l("地址，你需要在要监控的服务器上部署"),he,l("，直接用"),me,l("去启动就完了，命令如下")]),ge,_e,be,Ee,fe,xe,s("h3",ve,[l("监控mysql "),n(e,{class:"header-anchor",href:"#监控mysql","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("监控"),we,l("就会用到"),ke,l("，这个也能在官网下到，也就是"),n(e,{href:"https://prometheus.io/download/#mysqld_exporter",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("这里")]),_:1}),l("，这个东西需要你安装到运行"),Pe,l("的实例上，本地的"),qe,l("比较多，我随便找了一个扔了上去，先去"),Be,l("创建一个用户吧，这个程序需要连接明月三千里才能获取到指标。")]),je,$e,Se,Ue,Te,Ie,Ne,Oe,Ge,ze,Le,Me,Re,Qe,We,He,s("h2",Ke,[l("alertmanager "),n(e,{class:"header-anchor",href:"#alertmanager","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Ve,s("h3",Je,[l("部署alertmanager "),n(e,{class:"header-anchor",href:"#部署alertmanager","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Ye,Ze,Xe,sn,ln,on,en,nn,an,tn,cn,rn,pn,Dn,yn,Cn,Fn,An,dn,un,hn,s("h3",mn,[l("配置告警规则并邮件通知 "),n(e,{class:"header-anchor",href:"#配置告警规则并邮件通知","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),gn,_n,bn,En,fn,xn,vn,wn,kn,Pn,qn,Bn,s("p",null,[l("这里两条告警被合并到一个邮件里发出来了，这就是做了分组，如果你有同类告警的，也就是根据"),jn,l("去区分的，都会给你合并，"),$n,l("被合并到一起了，再看一下他还是支持哪些方式来告警，看"),n(e,{href:"https://prometheus.io/docs/alerting/configuration/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("这里")]),_:1}),l("吧，拉到最下面可以看到支持微信，丁丁目前是不支持的，有第三方的，我将来会对接企业微信的撒，暂时现用邮件吧，下面看看"),Sn,l("的告警状态吧。")]),s("h3",Un,[l("告警状态 "),n(e,{class:"header-anchor",href:"#告警状态","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Tn,In,Nn,On,Gn,s("h3",zn,[l("告警的分配 "),n(e,{class:"header-anchor",href:"#告警的分配","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Ln,Mn,Rn,Qn,Wn,Hn,Kn,s("h3",Vn,[l("告警收敛 "),n(e,{class:"header-anchor",href:"#告警收敛","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Jn,Yn,s("h4",Zn,[l("分组 "),n(e,{class:"header-anchor",href:"#分组","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Xn,sa,la,oa,ea,na,aa,ta,ca,s("h4",ra,[l("抑制 "),n(e,{class:"header-anchor",href:"#抑制","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),pa,Da,ia,ya,s("h4",Ca,[l("静默 "),n(e,{class:"header-anchor",href:"#静默","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Fa,Aa,da,ua,s("h2",ha,[l("编写告警规则栗子 "),n(e,{class:"header-anchor",href:"#编写告警规则栗子","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),ma,ga,_a,ba,Ea,fa,xa,va,wa,ka,Pa,qa,Ba,ja,$a,Sa,Ua,Ta,Ia,Na,Oa,Ga,za,La,Ma,Ra]),"main-header":o(()=>[t(a.$slots,"main-header")]),"main-header-after":o(()=>[t(a.$slots,"main-header-after")]),"main-nav":o(()=>[t(a.$slots,"main-nav")]),"main-content":o(()=>[t(a.$slots,"main-content")]),"main-content-after":o(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":o(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":o(()=>[t(a.$slots,"main-nav-after")]),comment:o(()=>[t(a.$slots,"comment")]),footer:o(()=>[t(a.$slots,"footer")]),aside:o(()=>[t(a.$slots,"aside")]),"aside-custom":o(()=>[t(a.$slots,"aside-custom")]),default:o(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter","data"])}const ot=i(d,[["render",Qa]]);export{lt as __pageData,ot as default};
