import{_ as c}from"./ValaxyMain.vue_vue_type_style_index_0_lang.325c3879.js";import{_ as p,c as i,w as o,o as y,r as a,g as s,R as l,p as D}from"./app.590b28b1.js";import"./YunFooter.vue_vue_type_script_setup_true_lang.fa8547c7.js";import"./YunCard.vue_vue_type_style_index_0_lang.7630474f.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.5dc3594f.js";const vs=JSON.parse('{"title":"Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6","description":"","frontmatter":{"title":"Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6","categories":"\u81EA\u52A8\u6CE8\u518C","tags":["Registrator+Consul+Consul-template+HaProxy"],"date":"2020-09-16T16:26:00.000Z"},"headers":[],"relativePath":"pages/posts/Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6.md","path":"/Users/vlinux/vlinux/blog/valaxy/valaxy-vlinux/pages/posts/Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6.md","lastUpdated":0}'),e=JSON.parse('{"title":"Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6","description":"","frontmatter":{"title":"Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6","categories":"\u81EA\u52A8\u6CE8\u518C","tags":["Registrator+Consul+Consul-template+HaProxy"],"date":"2020-09-16T16:26:00.000Z"},"headers":[],"relativePath":"pages/posts/Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6.md","path":"/Users/vlinux/vlinux/blog/valaxy/valaxy-vlinux/pages/posts/Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6.md","lastUpdated":0}'),C={name:"pages/posts/Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6.md",data(){return{data:e,frontmatter:e.frontmatter}},setup(){D("pageData",e)}},A=s("h1",{id:"registrator-consul-consul-template-haproxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539haproty\u914D\u7F6E\u6587\u4EF6",tabindex:"-1"},[l("Registrator+Consul+Consul-template+HaProxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539Haproty\u914D\u7F6E\u6587\u4EF6 "),s("a",{class:"header-anchor",href:"#registrator-consul-consul-template-haproxy\u5B9E\u73B0\u52A8\u6001\u4FEE\u6539haproty\u914D\u7F6E\u6587\u4EF6","aria-hidden":"true"},"#")],-1),u=s("p",null,[s("strong",null,"\u5B9E\u73B0\u9700\u6C42\uFF1A")],-1),F=s("p",null,"\u7528Haproxy\u505A\u8D1F\u8F7D\u5747\u8861\uFF0C\u624B\u52A8\u65B9\u5F0F\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u6DFB\u52A0\u6216\u5220\u9664\u8282\u70B9\u670D\u52A1\u5668\u4FE1\u606F\uFF0C\u6BD4\u8F83\u9EBB\u70E6\u3002",-1),d=s("p",null,"\u901A\u8FC7Registrator\u6536\u96C6\u9700\u8981\u6CE8\u518C\u5230Consul\u4F5C\u4E3AHaproxy\u8282\u70B9\u670D\u52A1\u5668\u7684\u4FE1\u606F\uFF0C\u7136\u540E\u6CE8\u518C\u5230Consul key/value\u3002",-1),_=s("p",null,"Consul-template\u53BBConsul key/value\u4E2D\u8BFB\u53D6\u4FE1\u606F,\u7136\u540E\u81EA\u52A8\u4FEE\u6539Haproxy\u914D\u7F6E\u6587\u4EF6\uFF0C\u5E76\u91CD\u8F7DHaproxy\u3002\u4E0D\u9700\u8981\u4FEE\u6539haproxy.cfg\u3002",-1),h=s("p",null,[s("strong",null,"\u96C6\u7FA4\u73AF\u5883\uFF1A")],-1),g=s("p",null,[s("img",{src:"https://cdn.jsdelivr.net/gh/kococ/TYPECHO_IMG/mu77/wKioL1ePH8TyP4vwAAA_diaQRtU606.png",alt:"wKioL1ePH8TyP4vwAAA_diaQRtU606"})],-1),m=s("p",null,"Postil\uFF1AMesos\u96C6\u7FA4\u642D\u5EFA\u8FC7\u7A0B\u6B64\u5904\u7701\u7565",-1),v=s("p",null,"\u5173\u95EDselinux\u548C\u9632\u706B\u5899",-1),f=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"setenforce 0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sed -i "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"s/SELINUX=enforcing/SELINUX=disabled/"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}}," /etc/selinux/config")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"systemctl stop firewalld "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," systemctl disable firewalld")]),l(`
`),s("span",{class:"line"})])])],-1),k=s("p",null,"ZK-server",-1),x=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u5BB9\u5668\u6765\u505Aconsul\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u83B7\u53D6Consul-server\u955C\u50CF")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# docker pull docker.io/gliderlabs/consul-server")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u542F\u52A8Consul-server")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# docker run -d --name=consul --net=host docker.io/gliderlabs/consul-server -bootstrap -bind=192.168.200.8")]),l(`
`),s("span",{class:"line"})])])],-1),E=s("p",null,"\u5BBF\u4E3B\u673A\u6765\u505Aconsul",-1),b=s("p",null,"\u4E0B\u8F7Dconsul\u5305\uFF0C\u5E76\u89E3\u538B",-1),H=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# wget https://releases.hashicorp.com/consul/0.6.4/consul_0.6.4_linux_386.zip")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# unzip consul_0.6.4_linux_386.zip")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# mv consul /usr/bin/")]),l(`
`),s("span",{class:"line"})])])],-1),w=s("p",null,"\u4E0B\u8F7Dconsul-template\u5305\uFF0C\u5E76\u89E3\u538B",-1),P=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# wget https://releases.hashicorp.com/consul-template/0.15.0/consul-template_0.15.0_linux_386.zip")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# unzip consul-template_0.15.0_linux_386.zip")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# mv consul-template /usr/bin/")]),l(`
`),s("span",{class:"line"})])])],-1),z=s("p",null,"\u5B89\u88C5HaProxy\u5E76\u542F\u52A8",-1),K=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# yum -y install haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# systemctl start haproxy")]),l(`
`),s("span",{class:"line"})])])],-1),B=s("p",null,"\u521B\u5EFAconsul\u670D\u52A1\u5668\u914D\u7F6E\u76EE\u5F55",-1),N=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# mkdir /config")]),l(`
`),s("span",{class:"line"})])])],-1),R=s("p",null,"\u7F16\u5199agent\u548Cserver\u7684json\u6587\u4EF6",-1),$=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# vi /config/agent.json ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u6DFB\u52A0\u5185\u5BB9\u5982\u4E0B\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"client_addr"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"0.0.0.0"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"data_dir"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/data"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"leave_on_terminate"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": true,")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"dns_config"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"allow_stale"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": true,")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"max_stale"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"1s"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# vi /config/server.json")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u6DFB\u52A0\u5185\u5BB9\u5982\u4E0B\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"ui"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": true,")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"dns_config"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"allow_stale"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}},": "),s("span",{style:{color:"#82AAFF"}},"false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),M=s("p",null,"\u542F\u52A8consul\u5355\u8282\u70B9\u670D\u52A1\u5668\uFF0C\u5F53\u7136\uFF0C\u4F60consul\u670D\u52A1\u5668\u8282\u70B9\u591A\u7684\u8BDD\u4E5F\u53EF\u4EE5\u505Aconsul\u96C6\u7FA4\u3002",-1),j=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# consul agent -server -config-dir=/config -bootstrap -bind=192.168.200.8 &")]),l(`
`),s("span",{class:"line"})])])],-1),I=s("p",null,"Postil\uFF1A\u53EF\u7528consul members \u67E5\u770Bconsul\u96C6\u7FA4\u8282\u70B9",-1),S=s("p",null,"Slave1-server",-1),Z=s("p",null,"\u83B7\u53D6Registrator\u955C\u50CF",-1),L=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@slave1 "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# docker pull gliderlabs/registrator:latest")]),l(`
`),s("span",{class:"line"})])])],-1),T=s("p",null,"\u542F\u52A8Registrator",-1),U=s("p",null,"Postil\uFF1A\u8FD9\u79CD\u542F\u52A8\u65B9\u5F0F\u662F\u6CE8\u518C\u5230Consul\u7684key/value",-1),q=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@slave1 "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# docker run -d --restart=always --name=registrator --net=host --volume=/var/run/docker.sock:/tmp/docker.sock docker.io/gliderlabs/registrator -ip 192.168.200.10 consulkv://192.168.200.8:8500/hello")]),l(`
`),s("span",{class:"line"})])])],-1),O=s("p",null,"Postil\uFF1A-ip\u540E\u9762\u8DDFregistration \u6240\u5C5E\u7684\u4E3B\u673A IP, \u4E00\u5B9A\u8981\u8BBE\u7F6E\u6B64\u5C5E\u6027, \u5426\u5219\u670D\u52A1IP\u4F1A\u663E\u793A\u4E3A127.0.0.1",-1),G=s("p",null,"\u6D4B\u8BD5Registrator\u662F\u5426\u628A\u672C\u673A\u5BB9\u5668\u6CE8\u518C\u5230Consul key/value",-1),Y=s("p",null,"\u542F\u52A8\u4E2A\u5BB9\u5668",-1),V=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@slave1 "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# docker run -d -P --name=test --net=bridge p_w_picpath/nginx")]),l(`
`),s("span",{class:"line"})])])],-1),J=s("p",null,"\u8FDB\u5165Consul UI\u754C\u9762\u67E5\u770B",-1),Q=s("p",null,[s("a",{href:"http://192.168.200.8:8500/ui/#/dc1/kv/",target:"_blank",rel:"noreferrer"},"http://192.168.200.8:8500/ui/#/dc1/kv/")],-1),X=s("p",null,[s("img",{src:"https://cdn.jsdelivr.net/gh/kococ/TYPECHO_IMG/mu77/wKioL1eN2n-BKahmAAAlbgipA10864.png",alt:"wKioL1eN2n-BKahmAAAlbgipA10864"})],-1),W=s("p",null,"ZK-server",-1),ss=s("p",null,"\u521B\u5EFAconsul\u914D\u7F6E\u76EE\u5F55",-1),ls=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# mkdir -p /data/cfg/consul")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# vi /data/cfg/consul/tmpl.json")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u6DFB\u52A0\u5185\u5BB9\u5982\u4E0B\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"consul = "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"127.0.0.1:8500"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"template "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#82AAFF"}},"source"),s("span",{style:{color:"#A6ACCD"}}," = "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/etc/haproxy/haproxy.ctmpl"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  destination = "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/etc/haproxy/haproxy.cfg"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#82AAFF"}},"command"),s("span",{style:{color:"#A6ACCD"}}," = "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"systemctl reload haproxy"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),os=s("p",null,"\u7F16\u5199haproxy\u6A21\u7248",-1),ns=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"# vi /etc/haproxy/haproxy.ctmpl")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\u6DFB\u52A0\u5185\u5BB9\u5982\u4E0B\uFF1A")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    log         127.0.0.1 local2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    chroot      /var/lib/haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    pidfile     /var/run/haproxy.pid")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    maxconn     4000")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    user        haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    group       haproxy")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    daemon")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95"}},"# turn on stats unix socket")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    stats socket /var/lib/haproxy/stats")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"defaults")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    mode                    http")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    log                     global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    option                  httplog")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    option                  dontlognull")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    option http-server-close")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    option forwardfor       except 127.0.0.0/8")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    option                  redispatch")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    retries                 3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout http-request    10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout queue           1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout connect         10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout client          1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout server          1m")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout http-keep-alive 10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    timeout check           10s")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    maxconn                 3000")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"frontend  main "),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}},":80")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    acl url_static       path_beg       -i /static /p_w_picpaths /javascript /stylesheets")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    acl url_static       path_end       -i .jpg .gif .png .css .js")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    use_backend static          "),s("span",{style:{color:"#89DDFF"}},"if"),s("span",{style:{color:"#A6ACCD"}}," url_static")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    default_backend             app")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"backend static")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    balance     roundrobin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server      static 127.0.0.1:4331 check")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"backend app")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    balance     roundrobin")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"     {{range "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"key, "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"pairs := tree "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"hello/"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," byKey}}{{range "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"serverid, "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"pair := "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"pairs}}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"     server app "),s("span",{style:{color:"#89DDFF"}},"``"),s("span",{style:{color:"#A6ACCD"}},"."),s("span",{style:{color:"#89DDFF"}},"`"),s("span",{style:{color:"#C3E88D"}},"Value"),s("span",{style:{color:"#89DDFF"}},"`"),s("span",{style:{color:"#A6ACCD"}}," check inter 2000 fall 3 weight 1 "),s("span",{style:{color:"#89DDFF"}},"`"),s("span",{style:{color:"#C3E88D"}},"end"),s("span",{style:{color:"#89DDFF"}},"``"),s("span",{style:{color:"#C3E88D"}},"end"),s("span",{style:{color:"#89DDFF"}},"`")]),l(`
`),s("span",{class:"line"})])])],-1),as=s("p",null,"\u542F\u52A8consul-template",-1),es=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@zk-server "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95"}},"#consul-template -config /data/cfg/consul/tmpl.json > consul-template.out 2>&1 &")]),l(`
`),s("span",{class:"line"})])])],-1),ts=s("p",null,"\u7528marathon\u542F\u52A8\u4E00\u4E2Anginx\u5BB9\u5668\uFF0C\u770Bregistrator\u662F\u5426\u6CE8\u518C\u5230consul,\u7136\u540E\u770Bconsul-template\u662F\u5426\u81EA\u52A8\u6DFB\u52A0\u4E86\u8FD9\u4E2A\u540E\u7AEF\u670D\u52A1\u5668\u5230/etc/haproxy/haproxy.cfg",-1),rs=s("p",null,[s("a",{href:"https://s5.51cto.com/wyfs02/M01/84/5A/wKiom1eN29Ch92f1AAAn-FZu8sk782.png",target:"_blank",rel:"noreferrer"},[s("img",{src:"https://cdn.jsdelivr.net/gh/kococ/TYPECHO_IMG/mu77/wKiom1eN29Ch92f1AAAn-FZu8sk782.png",alt:"wKiom1eN29Ch92f1AAAn-FZu8sk782.png"})])],-1),cs=s("p",null,[s("a",{href:"https://s5.51cto.com/wyfs02/M01/84/59/wKioL1eN29DSwwZMAABEjcHBKnE132.png",target:"_blank",rel:"noreferrer"},[s("img",{src:"https://cdn.jsdelivr.net/gh/kococ/TYPECHO_IMG/mu77/wKioL1eN29DSwwZMAABEjcHBKnE132.png",alt:"wKioL1eN29DSwwZMAABEjcHBKnE132.png"})])],-1),ps=s("p",null,[s("a",{href:"https://s2.51cto.com/wyfs02/M01/84/5A/wKiom1eN29HBhfyIAAFS6Sq96qE500.png",target:"_blank",rel:"noreferrer"},[s("img",{src:"https://cdn.jsdelivr.net/gh/kococ/TYPECHO_IMG/mu77/wKiom1eN29HBhfyIAAFS6Sq96qE500.png",alt:"wKiom1eN29HBhfyIAAFS6Sq96qE500.png"})])],-1),is=s("p",null,"\u8BBF\u95EEHaProxy_IP",-1),ys=s("p",null,[s("a",{href:"https://s4.51cto.com/wyfs02/M02/84/59/wKioL1eN2_DwH-usAABMZxBsa6s864.png",target:"_blank",rel:"noreferrer"},[s("img",{src:"https://cdn.jsdelivr.net/gh/kococ/TYPECHO_IMG/mu77/wKioL1eN2_DwH-usAABMZxBsa6s864.png",alt:"wKioL1eN2_DwH-usAABMZxBsa6s864.png"})])],-1);function Ds(n,Cs,As,us,t,Fs){const r=c;return y(),i(r,{frontmatter:t.frontmatter,data:t.data},{"main-content-md":o(()=>[A,u,F,d,_,h,g,m,v,f,k,x,E,b,H,w,P,z,K,B,N,R,$,M,j,I,S,Z,L,T,U,q,O,G,Y,V,J,Q,X,W,ss,ls,os,ns,as,es,ts,rs,cs,ps,is,ys]),"main-header":o(()=>[a(n.$slots,"main-header")]),"main-header-after":o(()=>[a(n.$slots,"main-header-after")]),"main-nav":o(()=>[a(n.$slots,"main-nav")]),"main-content":o(()=>[a(n.$slots,"main-content")]),"main-content-after":o(()=>[a(n.$slots,"main-content-after")]),"main-nav-before":o(()=>[a(n.$slots,"main-nav-before")]),"main-nav-after":o(()=>[a(n.$slots,"main-nav-after")]),comment:o(()=>[a(n.$slots,"comment")]),footer:o(()=>[a(n.$slots,"footer")]),aside:o(()=>[a(n.$slots,"aside")]),"aside-custom":o(()=>[a(n.$slots,"aside-custom")]),default:o(()=>[a(n.$slots,"default")]),_:3},8,["frontmatter","data"])}const fs=p(C,[["render",Ds]]);export{vs as __pageData,fs as default};
