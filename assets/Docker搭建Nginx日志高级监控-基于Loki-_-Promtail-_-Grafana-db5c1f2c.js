import{_ as c}from"./ValaxyMain-f02151dd.js";import{_ as i,p,c as C,w as n,o as y,r as e,b as s,R as l}from"./app-b8a6f45d.js";import"./YunFooter-17369ec4.js";import"./YunCard-b0df9910.js";import"./YunPageHeader-95685dde.js";const js=JSON.parse('{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","description":"","frontmatter":{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","categories":"监控分析","tags":["Loki"],"date":"2021-06-30T14:55:35.000Z"},"headers":[{"level":2,"title":"Ngin添加GeoIP模块","slug":"ngin添加geoip模块","link":"#ngin添加geoip模块","children":[]},{"level":2,"title":"1.1 停止现有Nginx","slug":"_1-1-停止现有nginx","link":"#_1-1-停止现有nginx","children":[]},{"level":2,"title":"1.2 带GeoIP重新编译Nginx","slug":"_1-2-带geoip重新编译nginx","link":"#_1-2-带geoip重新编译nginx","children":[{"level":3,"title":"1.2.1 下载GeoIP依赖","slug":"_1-2-1-下载geoip依赖","link":"#_1-2-1-下载geoip依赖","children":[]},{"level":3,"title":"1.2.2 进入nginx/sbin目录查看现有nginx模块依赖","slug":"_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","link":"#_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","children":[]},{"level":3,"title":"1.2.3 添加geoip模块重新编译","slug":"_1-2-3-添加geoip模块重新编译","link":"#_1-2-3-添加geoip模块重新编译","children":[]},{"level":3,"title":"1.2.4 执行命令，查看geoip是否编译成功","slug":"_1-2-4-执行命令，查看geoip是否编译成功","link":"#_1-2-4-执行命令，查看geoip是否编译成功","children":[]}]},{"level":2,"title":"1.3. 查看GeoIP.dat位置","slug":"_1-3-查看geoip-dat位置","link":"#_1-3-查看geoip-dat位置","children":[]},{"level":2,"title":"1.4. 修改nginx配置文件","slug":"_1-4-修改nginx配置文件","link":"#_1-4-修改nginx配置文件","children":[]},{"level":2,"title":"1.5. 重启nginx","slug":"_1-5-重启nginx","link":"#_1-5-重启nginx","children":[]},{"level":2,"title":"1.6. 查看大图","slug":"_1-6-查看大图","link":"#_1-6-查看大图","children":[]},{"level":2,"title":"1.7. 监控日志支持正则匹配","slug":"_1-7-监控日志支持正则匹配","link":"#_1-7-监控日志支持正则匹配","children":[]}],"relativePath":"pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","lastUpdated":1671090556000}'),a=JSON.parse('{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","description":"","frontmatter":{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","categories":"监控分析","tags":["Loki"],"date":"2021-06-30T14:55:35.000Z"},"headers":[{"level":2,"title":"Ngin添加GeoIP模块","slug":"ngin添加geoip模块","link":"#ngin添加geoip模块","children":[]},{"level":2,"title":"1.1 停止现有Nginx","slug":"_1-1-停止现有nginx","link":"#_1-1-停止现有nginx","children":[]},{"level":2,"title":"1.2 带GeoIP重新编译Nginx","slug":"_1-2-带geoip重新编译nginx","link":"#_1-2-带geoip重新编译nginx","children":[{"level":3,"title":"1.2.1 下载GeoIP依赖","slug":"_1-2-1-下载geoip依赖","link":"#_1-2-1-下载geoip依赖","children":[]},{"level":3,"title":"1.2.2 进入nginx/sbin目录查看现有nginx模块依赖","slug":"_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","link":"#_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","children":[]},{"level":3,"title":"1.2.3 添加geoip模块重新编译","slug":"_1-2-3-添加geoip模块重新编译","link":"#_1-2-3-添加geoip模块重新编译","children":[]},{"level":3,"title":"1.2.4 执行命令，查看geoip是否编译成功","slug":"_1-2-4-执行命令，查看geoip是否编译成功","link":"#_1-2-4-执行命令，查看geoip是否编译成功","children":[]}]},{"level":2,"title":"1.3. 查看GeoIP.dat位置","slug":"_1-3-查看geoip-dat位置","link":"#_1-3-查看geoip-dat位置","children":[]},{"level":2,"title":"1.4. 修改nginx配置文件","slug":"_1-4-修改nginx配置文件","link":"#_1-4-修改nginx配置文件","children":[]},{"level":2,"title":"1.5. 重启nginx","slug":"_1-5-重启nginx","link":"#_1-5-重启nginx","children":[]},{"level":2,"title":"1.6. 查看大图","slug":"_1-6-查看大图","link":"#_1-6-查看大图","children":[]},{"level":2,"title":"1.7. 监控日志支持正则匹配","slug":"_1-7-监控日志支持正则匹配","link":"#_1-7-监控日志支持正则匹配","children":[]}],"relativePath":"pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","lastUpdated":1671090556000}'),g={name:"pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md",data(){return{data:a,frontmatter:a.frontmatter}},setup(){p("pageData",a)}},d=s("h1",{id:"手把手搭建nginx日志高级监控-——-基于loki-promtail-grafana",tabindex:"-1"},[l("手把手搭建Nginx日志高级监控 —— 基于Loki + Promtail + Grafana "),s("a",{class:"header-anchor",href:"#手把手搭建nginx日志高级监控-——-基于loki-promtail-grafana","aria-hidden":"true"},"#")],-1),A=s("blockquote",null,[s("p",null,"参考官方文档："),s("p",null,[l("Loki: "),s("a",{href:"https://grafana.com/docs/loki/latest/",target:"_blank",rel:"noreferrer"},"https://grafana.com/docs/loki/latest/")]),s("p",null,[l("Grafana Loki V2 Dashboard for Nginx "),s("a",{href:"https://grafana.com/grafana/dashboards/12559?pg=dashboards&plcmt=featured-main",target:"_blank",rel:"noreferrer"},"https://grafana.com/grafana/dashboards/12559?pg=dashboards&plcmt=featured-main")])],-1),_=s("p",null,"日志收集效果截图：",-1),h=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/12345678.png",alt:"12345678"})],-1),D=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/23456.png",alt:"23456"})],-1),u=s("h1",{id:"_1-loki-promtail简介",tabindex:"-1"},[l("1. Loki + Promtail简介 "),s("a",{class:"header-anchor",href:"#_1-loki-promtail简介","aria-hidden":"true"},"#")],-1),m=s("p",null,"官网有说明。",-1),F=s("p",null,"简单理解，",-1),x=s("p",null,"Loki是个日志监控系统，可用来分析日志，并提供给Grafana进行图形化展示。",-1),f=s("p",null,"Promtail是个日志转发的代理，用于给Loki提供日志数据的。",-1),b=s("h1",{id:"_2-loki-promtail下载并安装启动",tabindex:"-1"},[l("2. Loki + Promtail下载并安装启动 "),s("a",{class:"header-anchor",href:"#_2-loki-promtail下载并安装启动","aria-hidden":"true"},"#")],-1),k=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"wget"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://github.com/grafana/loki/blob/main/cmd/loki/loki-local-config.yaml"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-O"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"loki-config.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"run"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--name"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"loki"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"$("),s("span",{style:{color:"#82AAFF"}},"pwd"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}},":/mnt/config"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-p"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"3100"),s("span",{style:{color:"#C3E88D"}},":"),s("span",{style:{color:"#F78C6C"}},"3100"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"grafana/loki:2.1.0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-config.file=/mnt/config/loki-config.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"wget"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://github.com/grafana/loki/blob/main/clients/cmd/promtail/promtail-docker-config.yaml"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-O"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail-config.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"run"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--name"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"$("),s("span",{style:{color:"#82AAFF"}},"pwd"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}},":/mnt/config"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/nginx/logs:/usr/local/nginx/logs"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"grafana/promtail:2.1.0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-config.file=/mnt/config/promtail-config.yaml")]),l(`
`),s("span",{class:"line"})])])],-1),v=s("blockquote",null,[s("p",null,"脚本来自官网，容器启动后先停止，然后修改配置文件")],-1),E=s("h1",{id:"_3-修改nginx配置",tabindex:"-1"},[l("3. 修改Nginx配置 "),s("a",{class:"header-anchor",href:"#_3-修改nginx配置","aria-hidden":"true"},"#")],-1),B=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"log_format json_analytics '{'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                            '"msec": "$msec", ' # request unixtime in seconds with a milliseconds resolution`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                            '"connection": "$connection", ' # connection serial number`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                            '"connection_requests": "$connection_requests", ' # number of requests made in connection`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"pid": "$pid", ' # process pid`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_id": "$request_id", ' # the unique request id`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_length": "$request_length", ' # request length (including headers and body)`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"remote_addr": "$remote_addr", ' # client IP`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"remote_user": "$remote_user", ' # client HTTP username`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"remote_port": "$remote_port", ' # client port`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"time_local": "$time_local", '`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"time_iso8601": "$time_iso8601", ' # local time in the ISO 8601 standard format`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request": "$request", ' # full path no arguments if the request`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_uri": "$request_uri", ' # full path and arguments if the request`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"args": "$args", ' # args`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"status": "$status", ' # response status code`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"body_bytes_sent": "$body_bytes_sent", ' # the number of body bytes exclude headers sent to a client`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"bytes_sent": "$bytes_sent", ' # the number of bytes sent to a client`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_referer": "$http_referer", ' # HTTP referer`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_user_agent": "$http_user_agent", ' # user agent`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_x_forwarded_for": "$http_x_forwarded_for", ' # http_x_forwarded_for`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_host": "$http_host", ' # the request Host: header`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"server_name": "$server_name", ' # the name of the vhost serving the request`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_time": "$request_time", ' # request processing time in seconds with msec resolution`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream": "$upstream_addr", ' # upstream backend server for proxied requests`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_connect_time": "$upstream_connect_time", ' # upstream handshake time incl. TLS`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_header_time": "$upstream_header_time", ' # time spent receiving upstream headers`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_response_time": "$upstream_response_time", ' # time spend receiving upstream body`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_response_length": "$upstream_response_length", ' # upstream response length`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_cache_status": "$upstream_cache_status", ' # cache HIT/MISS where applicable`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"ssl_protocol": "$ssl_protocol", ' # TLS protocol`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"ssl_cipher": "$ssl_cipher", ' # TLS cipher`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"scheme": "$scheme", ' # http or https`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_method": "$request_method", ' # request method`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"server_protocol": "$server_protocol", ' # request protocol, like HTTP/1.1 or HTTP/2.0`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"pipe": "$pipe", ' # "p" if request was pipelined, "." otherwise`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"gzip_ratio": "$gzip_ratio", '`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_cf_ray": "$http_cf_ray"'`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                    '}';")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"access_log logs/json_access.log json_analytics;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),w=s("blockquote",null,[s("p",null,"这一步是将Nginx输出的日志文件进行格式化")],-1),$=s("h1",{id:"_4-修改promtail配置",tabindex:"-1"},[l("4. 修改Promtail配置 "),s("a",{class:"header-anchor",href:"#_4-修改promtail配置","aria-hidden":"true"},"#")],-1),P=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"server"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"http_listen_port"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"grpc_listen_port"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"positions"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"filename"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/tmp/positions.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"clients"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"url"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"http://172.17.0.4:3100/loki/api/v1/push"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# Loki日志推送地址")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"system")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#pipeline_stages:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#- replace:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#    expression: '(?:[0-9]{1,3}\\.){3}([0-9]{1,3})'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#    replace: '***'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"localhost"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 根据官方文档，这里只能是localhost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"job"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"nginx_access_log")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"agent"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"__path__"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/nginx/logs/json_access.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 需要上传的日志地址。")]),l(`
`),s("span",{class:"line"})])])],-1),q=s("h1",{id:"_5-重启loki-promtail容器",tabindex:"-1"},[l("5. 重启Loki+Promtail容器 "),s("a",{class:"header-anchor",href:"#_5-重启loki-promtail容器","aria-hidden":"true"},"#")],-1),G=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"restart"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"loki"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"restart"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail")]),l(`
`),s("span",{class:"line"})])])],-1),N=s("h1",{id:"_6-配置grafana数据源",tabindex:"-1"},[l("6. 配置Grafana数据源 "),s("a",{class:"header-anchor",href:"#_6-配置grafana数据源","aria-hidden":"true"},"#")],-1),I=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142131.png",alt:"image-20210630142131562"})],-1),L=s("h1",{id:"_7-配置grafana模版",tabindex:"-1"},[l("7. 配置Grafana模版 "),s("a",{class:"header-anchor",href:"#_7-配置grafana模版","aria-hidden":"true"},"#")],-1),T=s("p",null,"模版ID：12559",-1),j=s("p",null,"非常装逼，非常热门",-1),S=s("p",null,"导入方法与本博客多篇日志收集Grafana导入方法相同",-1),H=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142256.png",alt:"image-20210630142256248"})],-1),V=s("h1",{id:"_8-查看面板",tabindex:"-1"},[l("8. 查看面板 "),s("a",{class:"header-anchor",href:"#_8-查看面板","aria-hidden":"true"},"#")],-1),O=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142558.png",alt:"image-20210630142558503"})],-1),U=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142622.png",alt:"image-20210630142622826"})],-1),J=s("p",null,"插件因素显示不全请自行安装，grafana-cli plugins install *****",-1),z=s("h1",{id:"_9-可查看指标",tabindex:"-1"},[l("9. 可查看指标 "),s("a",{class:"header-anchor",href:"#_9-可查看指标","aria-hidden":"true"},"#")],-1),M=s("ul",null,[s("li",null,"总请求量"),s("li",null,"状态码 2xx,3xx,5xx请求量"),s("li",null,"流量情况"),s("li",null,"请求明细"),s("li",null,"百分之95请求响应时间"),s("li",null,"最大请求IP"),s("li",null,"最大请求路径")],-1),Z=s("h1",{id:"_10-国家面板",tabindex:"-1"},[l("10. 国家面板 "),s("a",{class:"header-anchor",href:"#_10-国家面板","aria-hidden":"true"},"#")],-1),K=s("p",null,"Country面板无数据，是因为Grafana没有地图面板插件，且Nginx默认没有开启国家城市过滤。",-1),R=s("p",null,[s("strong",null,"文章最下面进行操作")],-1),Q=s("h1",{id:"_11-资源消耗",tabindex:"-1"},[l("11. 资源消耗 "),s("a",{class:"header-anchor",href:"#_11-资源消耗","aria-hidden":"true"},"#")],-1),W=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630143102.png",alt:"image-20210630143102322"})],-1),X=s("p",null,"就这资源消耗，还要啥自行车？要啥ELK？",-1),Y=s("hr",null,null,-1),ss=s("h2",{id:"ngin添加geoip模块",tabindex:"-1"},[l("Ngin添加GeoIP模块 "),s("a",{class:"header-anchor",href:"#ngin添加geoip模块","aria-hidden":"true"},"#")],-1),ls=s("h2",{id:"_1-1-停止现有nginx",tabindex:"-1"},[l("1.1 停止现有Nginx "),s("a",{class:"header-anchor",href:"#_1-1-停止现有nginx","aria-hidden":"true"},"#")],-1),ns=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"/nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-s"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"stop")]),l(`
`),s("span",{class:"line"})])])],-1),os=s("h2",{id:"_1-2-带geoip重新编译nginx",tabindex:"-1"},[l("1.2 带GeoIP重新编译Nginx "),s("a",{class:"header-anchor",href:"#_1-2-带geoip重新编译nginx","aria-hidden":"true"},"#")],-1),es=s("h3",{id:"_1-2-1-下载geoip依赖",tabindex:"-1"},[l("1.2.1 下载GeoIP依赖 "),s("a",{class:"header-anchor",href:"#_1-2-1-下载geoip依赖","aria-hidden":"true"},"#")],-1),as=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"sudo"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"apt"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"install"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"libgeoip1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"libgeoip-dev"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"geoip-bin")]),l(`
`),s("span",{class:"line"})])])],-1),ts=s("p",null,"github文档如下",-1),rs=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630143344.png",alt:"img"})],-1),cs=s("h3",{id:"_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖",tabindex:"-1"},[l("1.2.2 进入nginx/sbin目录查看现有nginx模块依赖 "),s("a",{class:"header-anchor",href:"#_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","aria-hidden":"true"},"#")],-1),is=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"/nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-V")]),l(`
`),s("span",{class:"line"})])])],-1),ps=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630143504.png",alt:"image-20210630143504540"})],-1),Cs=s("p",null,"如上图，将红线位置拷贝，用于添加模块重新编译",-1),ys=s("h3",{id:"_1-2-3-添加geoip模块重新编译",tabindex:"-1"},[l("1.2.3 添加geoip模块重新编译 "),s("a",{class:"header-anchor",href:"#_1-2-3-添加geoip模块重新编译","aria-hidden":"true"},"#")],-1),gs=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"/configure"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--prefix=/usr/local/nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_gzip_static_module"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_stub_status_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_ssl_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-pcre"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-file-aio"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_realip_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_geoip_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--add-module=/usr/local/nginx-module-vts-master")]),l(`
`),s("span",{class:"line"})])])],-1),ds=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"make"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"make"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"install"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),As=s("h3",{id:"_1-2-4-执行命令，查看geoip是否编译成功",tabindex:"-1"},[l("1.2.4 执行命令，查看geoip是否编译成功 "),s("a",{class:"header-anchor",href:"#_1-2-4-执行命令，查看geoip是否编译成功","aria-hidden":"true"},"#")],-1),_s=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"nginx -V")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),hs=s("p",null,"带 --with-http_geoip_module 即编译成功",-1),Ds=s("h2",{id:"_1-3-查看geoip-dat位置",tabindex:"-1"},[l("1.3. 查看GeoIP.dat位置 "),s("a",{class:"header-anchor",href:"#_1-3-查看geoip-dat位置","aria-hidden":"true"},"#")],-1),us=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/local/nginx/sbin"),s("span",{style:{color:"#A6ACCD"}},"# whereis GeoIP")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"GeoIP:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/include/GeoIP.h"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/share/GeoIP")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/share/GeoIP"),s("span",{style:{color:"#A6ACCD"}},"# ls -al")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"total"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"10012")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"drwxr-xr-x"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F78C6C"}},"4096"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Feb"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"17"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"22"),s("span",{style:{color:"#C3E88D"}},":"),s("span",{style:{color:"#F78C6C"}},"14"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},".")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"drwxr-xr-x"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"121"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F78C6C"}},"4096"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Feb"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"17"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"22"),s("span",{style:{color:"#C3E88D"}},":"),s("span",{style:{color:"#F78C6C"}},"14"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"..")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"-rw-r--r--"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"2099217"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Jan"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"23"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F78C6C"}},"2020"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"GeoIP.dat")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"-rw-r--r--"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"8138841"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Jan"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"23"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F78C6C"}},"2020"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"GeoIPv6.dat")]),l(`
`),s("span",{class:"line"})])])],-1),ms=s("h2",{id:"_1-4-修改nginx配置文件",tabindex:"-1"},[l("1.4. 修改nginx配置文件 "),s("a",{class:"header-anchor",href:"#_1-4-修改nginx配置文件","aria-hidden":"true"},"#")],-1),Fs=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"# 添加国家模块配置")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"geoip_country"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/share/GeoIP/GeoIP.dat"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"})])])],-1),xs=s("h2",{id:"_1-5-重启nginx",tabindex:"-1"},[l("1.5. 重启nginx "),s("a",{class:"header-anchor",href:"#_1-5-重启nginx","aria-hidden":"true"},"#")],-1),fs=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-s"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"reload"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),bs=s("h2",{id:"_1-6-查看大图",tabindex:"-1"},[l("1.6. 查看大图 "),s("a",{class:"header-anchor",href:"#_1-6-查看大图","aria-hidden":"true"},"#")],-1),ks=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630144706.png",alt:"img"})],-1),vs=s("h2",{id:"_1-7-监控日志支持正则匹配",tabindex:"-1"},[l("1.7. 监控日志支持正则匹配 "),s("a",{class:"header-anchor",href:"#_1-7-监控日志支持正则匹配","aria-hidden":"true"},"#")],-1),Es=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/local/nginx/logs"),s("span",{style:{color:"#A6ACCD"}},"# ls")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"access.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"error.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"json_access.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"json_access.log."),s("span",{style:{color:"#F78C6C"}},"2021"),s("span",{style:{color:"#C3E88D"}},"-"),s("span",{style:{color:"#F78C6C"}},"02"),s("span",{style:{color:"#C3E88D"}},"-"),s("span",{style:{color:"#F78C6C"}},"17"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"nginx.pid")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/local/loki+promtail"),s("span",{style:{color:"#A6ACCD"}},"# vim promtail-config.yaml  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#FFCB6B"}},"static_configs:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"targets:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"localhost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#FFCB6B"}},"labels:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"job:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"nginx_access_log")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"agent:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"__path__:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/nginx/logs/"),s("span",{style:{color:"#A6ACCD"}},"*"),s("span",{style:{color:"#C3E88D"}},"json_access.log"),s("span",{style:{color:"#A6ACCD"}},"*")]),l(`
`),s("span",{class:"line"})])])],-1);function Bs(o,ws,$s,Ps,t,qs){const r=c;return y(),C(r,{frontmatter:t.frontmatter,data:t.data},{"main-content-md":n(()=>[d,A,_,h,D,u,m,F,x,f,b,k,v,E,B,w,$,P,q,G,N,I,L,T,j,S,H,V,O,U,J,z,M,Z,K,R,Q,W,X,Y,ss,ls,ns,os,es,as,ts,rs,cs,is,ps,Cs,ys,gs,ds,As,_s,hs,Ds,us,ms,Fs,xs,fs,bs,ks,vs,Es]),"main-header":n(()=>[e(o.$slots,"main-header")]),"main-header-after":n(()=>[e(o.$slots,"main-header-after")]),"main-nav":n(()=>[e(o.$slots,"main-nav")]),"main-content":n(()=>[e(o.$slots,"main-content")]),"main-content-after":n(()=>[e(o.$slots,"main-content-after")]),"main-nav-before":n(()=>[e(o.$slots,"main-nav-before")]),"main-nav-after":n(()=>[e(o.$slots,"main-nav-after")]),comment:n(()=>[e(o.$slots,"comment")]),footer:n(()=>[e(o.$slots,"footer")]),aside:n(()=>[e(o.$slots,"aside")]),"aside-custom":n(()=>[e(o.$slots,"aside-custom")]),default:n(()=>[e(o.$slots,"default")]),_:3},8,["frontmatter","data"])}const Ss=i(g,[["render",Bs],["__file","/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md"]]);export{js as __pageData,Ss as default};
