import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang.C2bsXNP9.js";import"./chunks/@vueuse/motion.BITvz5PP.js";import{e as g,u as b,a as m}from"./chunks/vue-router.DESBU8cS.js";import{aa as f,ap as n,ag as e,af as s,ai as a,P as k,ab as S,a1 as y}from"./framework.GHZxz7jq.js";import"./index.fe-YlSh0.js";import"./chunks/dayjs.BldX5ftQ.js";import"./chunks/vue-i18n.C7V8WoQZ.js";import"./chunks/pinia.BfAlK2F6.js";import"./chunks/nprogress.BZwbcB2O.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.Bfmmp6N5.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.fblE3Fel.js";import"./post.Dv7YwUny.js";const v=g("/posts/gitlab-ssh-forward-port",async t=>JSON.parse('{"title":"SSH Config 配置如何覆盖 Git 默认端口","description":"","frontmatter":{"title":"SSH Config 配置如何覆盖 Git 默认端口","categories":"Linux技术","tags":["网络","SSH","Gitlab"],"date":"2025-09-04 16:56:45"},"headers":[],"relativePath":"pages/posts/gitlab-ssh-forward-port.md","lastUpdated":null}'),{lazy:(t,i)=>t.name===i.name}),T={__name:"gitlab-ssh-forward-port",setup(t,{expose:i}){const{data:c}=v(),p=m(),h=b(),o=Object.assign(h.meta.frontmatter||{},c.value?.frontmatter||{});return p.currentRoute.value.data=c.value,y("valaxy:frontmatter",o),globalThis.$frontmatter=o,i({frontmatter:{title:"SSH Config 配置如何覆盖 Git 默认端口",categories:"Linux技术",tags:["网络","SSH","Gitlab"],date:"2025-09-04 16:56:45"}}),(l,r)=>{const u=d;return S(),f(u,{frontmatter:k(o)},{"main-content-md":n(()=>[...r[0]||(r[0]=[s("h2",{id:"背景",tabindex:"-1"},[a("背景 "),s("a",{class:"header-anchor",href:"#背景","aria-label":'Permalink to "背景"'},"​")],-1),s("p",null,"因安全需求，Gitlab部署好后，原22端口需替换为2222端口。所以会出现开发拉代码报错，因为git clone默认使用22端口拉代码。",-1),s("p",null,"需要修改SSH相关参数就可以实现在本机对即将请求的22端口进行转发至2222",-1),s("h2",{id:"核心原理-ssh-配置优先级",tabindex:"-1"},[a("核心原理：SSH 配置优先级 "),s("a",{class:"header-anchor",href:"#核心原理-ssh-配置优先级","aria-label":'Permalink to "核心原理：SSH 配置优先级"'},"​")],-1),s("h3",{id:"ssh-config-工作机制",tabindex:"-1"},[a("SSH Config 工作机制 "),s("a",{class:"header-anchor",href:"#ssh-config-工作机制","aria-label":'Permalink to "SSH Config 工作机制"'},"​")],-1),s("p",null,"SSH 客户端会按照以下优先级读取配置：",-1),s("ol",null,[s("li",null,"命令行参数（最高优先级）"),s("li",null,[s("code",null,"~/.ssh/config"),a("用户级配置")]),s("li",null,[s("code",null,"/etc/ssh/ssh_config"),a("系统级配置")]),s("li",null,"SSH 默认值（最低优先级）")],-1),s("h3",{id:"示例配置分析",tabindex:"-1"},[a("示例配置分析 "),s("a",{class:"header-anchor",href:"#示例配置分析","aria-label":'Permalink to "示例配置分析"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# ~/.ssh/config 内容")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host git.hycs.sitc")]),a(`
`),s("span",{class:"line"},[s("span",null,"  HostName git.hycs.sitc")]),a(`
`),s("span",{class:"line"},[s("span",null,"  User git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  Port 2222  # 显式指定端口，覆盖默认值")]),a(`
`),s("span",{class:"line"},[s("span",null,"  IdentityFile ~/.ssh/id_rsa")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"验证方法",tabindex:"-1"},[a("验证方法 "),s("a",{class:"header-anchor",href:"#验证方法","aria-label":'Permalink to "验证方法"'},"​")],-1),s("h3",{id:"查看实际连接信息",tabindex:"-1"},[a("查看实际连接信息 "),s("a",{class:"header-anchor",href:"#查看实际连接信息","aria-label":'Permalink to "查看实际连接信息"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# 使用详细模式查看 SSH 连接过程")]),a(`
`),s("span",{class:"line"},[s("span",null,"ssh -v git@git.hycs.sitc")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 输出示例：")]),a(`
`),s("span",{class:"line"},[s("span",null,"debug1: Connecting to git.hycs.sitc [x.x.x.x] port 2222.")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"测试端口连通性",tabindex:"-1"},[a("测试端口连通性 "),s("a",{class:"header-anchor",href:"#测试端口连通性","aria-label":'Permalink to "测试端口连通性"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# 测试默认端口")]),a(`
`),s("span",{class:"line"},[s("span",null,"telnet git.hycs.sitc 22")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 测试自定义端口  ")]),a(`
`),s("span",{class:"line"},[s("span",null,"telnet git.hycs.sitc 2222")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"端口配置方案",tabindex:"-1"},[a("端口配置方案 "),s("a",{class:"header-anchor",href:"#端口配置方案","aria-label":'Permalink to "端口配置方案"'},"​")],-1),s("h3",{id:"方案一-使用-ssh-配置-推荐",tabindex:"-1"},[a("方案一：使用 SSH 配置（推荐） "),s("a",{class:"header-anchor",href:"#方案一-使用-ssh-配置-推荐","aria-label":'Permalink to "方案一：使用 SSH 配置（推荐）"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# ~/.ssh/config")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host git.example.com")]),a(`
`),s("span",{class:"line"},[s("span",null,"  HostName git.example.com")]),a(`
`),s("span",{class:"line"},[s("span",null,"  User git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  Port 2222")]),a(`
`),s("span",{class:"line"},[s("span",null,"  IdentityFile ~/.ssh/id_rsa")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 多个 Git 服务配置示例")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host github.com")]),a(`
`),s("span",{class:"line"},[s("span",null,"  User git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  Port 22")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host gitlab.company.com")]),a(`
`),s("span",{class:"line"},[s("span",null,"  User git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  Port 2222")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"方案二-git-url-显式指定端口",tabindex:"-1"},[a("方案二：Git URL 显式指定端口 "),s("a",{class:"header-anchor",href:"#方案二-git-url-显式指定端口","aria-label":'Permalink to "方案二：Git URL 显式指定端口"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# 克隆时指定端口")]),a(`
`),s("span",{class:"line"},[s("span",null,"git clone ssh://git@git.hycs.sitc:2222/username/repo.git")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 修改现有远程地址")]),a(`
`),s("span",{class:"line"},[s("span",null,"git remote set-url origin ssh://git@git.hycs.sitc:2222/username/repo.git")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"方案三-全局-ssh-参数配置",tabindex:"-1"},[a("方案三：全局 SSH 参数配置 "),s("a",{class:"header-anchor",href:"#方案三-全局-ssh-参数配置","aria-label":'Permalink to "方案三：全局 SSH 参数配置"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# 设置全局 SSH 选项")]),a(`
`),s("span",{class:"line"},[s("span",null,'git config --global core.sshCommand "ssh -p 2222"')]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 或针对特定仓库设置")]),a(`
`),s("span",{class:"line"},[s("span",null,'git config core.sshCommand "ssh -p 2222 -i ~/.ssh/custom_key"')])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"服务器端检查",tabindex:"-1"},[a("服务器端检查 "),s("a",{class:"header-anchor",href:"#服务器端检查","aria-label":'Permalink to "服务器端检查"'},"​")],-1),s("h3",{id:"查看-gitlab-ssh-配置",tabindex:"-1"},[a("查看 GitLab SSH 配置 "),s("a",{class:"header-anchor",href:"#查看-gitlab-ssh-配置","aria-label":'Permalink to "查看 GitLab SSH 配置"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# 查看 GitLab 当前 SSH 端口配置")]),a(`
`),s("span",{class:"line"},[s("span",null,"sudo gitlab-rails runner 'puts Gitlab.config.gitlab_shell.ssh_port'")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 检查配置文件")]),a(`
`),s("span",{class:"line"},[s("span",null,"cat /etc/gitlab/gitlab.rb | grep gitlab_shell.ssh_port")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"修改-gitlab-ssh-端口",tabindex:"-1"},[a("修改 GitLab SSH 端口 "),s("a",{class:"header-anchor",href:"#修改-gitlab-ssh-端口","aria-label":'Permalink to "修改 GitLab SSH 端口"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# /etc/gitlab/gitlab.rb")]),a(`
`),s("span",{class:"line"},[s("span",null,"gitlab_rails['gitlab_shell_ssh_port'] = 2222")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 重载配置")]),a(`
`),s("span",{class:"line"},[s("span",null,"sudo gitlab-ctl reconfigure")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"故障排除",tabindex:"-1"},[a("故障排除 "),s("a",{class:"header-anchor",href:"#故障排除","aria-label":'Permalink to "故障排除"'},"​")],-1),s("h3",{id:"常见问题及解决方案",tabindex:"-1"},[a("常见问题及解决方案 "),s("a",{class:"header-anchor",href:"#常见问题及解决方案","aria-label":'Permalink to "常见问题及解决方案"'},"​")],-1),s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"center"}},"问题现象"),s("th",{style:{"text-align":"center"}},"可能原因"),s("th",{style:{"text-align":"center"}},"解决方案")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"center"}},"连接超时"),s("td",{style:{"text-align":"center"}},"防火墙阻止端口"),s("td",{style:{"text-align":"center"}},"检查防火墙规则")]),s("tr",null,[s("td",{style:{"text-align":"center"}},"权限拒绝"),s("td",{style:{"text-align":"center"}},"SSH 密钥不匹配"),s("td",{style:{"text-align":"center"}},"检查 IdentityFile 配置")]),s("tr",null,[s("td",{style:{"text-align":"center"}},"协议错误"),s("td",{style:{"text-align":"center"}},"服务未监听指定端口"),s("td",{style:{"text-align":"center"}},"验证端口监听状态")])])],-1),s("h3",{id:"端口检测命令",tabindex:"-1"},[a("端口检测命令 "),s("a",{class:"header-anchor",href:"#端口检测命令","aria-label":'Permalink to "端口检测命令"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# 检查服务器端口监听状态")]),a(`
`),s("span",{class:"line"},[s("span",null,"sudo netstat -tlnp | grep :2222")]),a(`
`),s("span",{class:"line"},[s("span",null,"sudo ss -tlnp | grep :2222")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 检查防火墙设置")]),a(`
`),s("span",{class:"line"},[s("span",null,"sudo ufw status")]),a(`
`),s("span",{class:"line"},[s("span",null,"sudo iptables -L -n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"最佳实践",tabindex:"-1"},[a("最佳实践 "),s("a",{class:"header-anchor",href:"#最佳实践","aria-label":'Permalink to "最佳实践"'},"​")],-1),s("ol",null,[s("li",null,[s("strong",null,"统一配置管理"),a("：使用 SSH Config 统一管理多环境配置")]),s("li",null,[s("strong",null,"端口标准化"),a("：尽量使用标准端口，减少特殊配置")]),s("li",null,[s("strong",null,"文档化"),a("：记录端口特殊配置及原因")]),s("li",null,[s("strong",null,"安全考虑"),a("：非标准端口可减少自动化攻击，但不应作为唯一安全措施")])],-1),s("h2",{id:"配置示例汇总",tabindex:"-1"},[a("配置示例汇总 "),s("a",{class:"header-anchor",href:"#配置示例汇总","aria-label":'Permalink to "配置示例汇总"'},"​")],-1),s("h3",{id:"多环境-ssh-配置",tabindex:"-1"},[a("多环境 SSH 配置 "),s("a",{class:"header-anchor",href:"#多环境-ssh-配置","aria-label":'Permalink to "多环境 SSH 配置"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# ~/.ssh/config")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 公司内部 GitLab")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host internal-git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  HostName git.internal.com")]),a(`
`),s("span",{class:"line"},[s("span",null,"  User git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  Port 2222")]),a(`
`),s("span",{class:"line"},[s("span",null,"  IdentityFile ~/.ssh/internal_key")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# GitHub")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host github.com")]),a(`
`),s("span",{class:"line"},[s("span",null,"  User git")]),a(`
`),s("span",{class:"line"},[s("span",null,"  Port 22")]),a(`
`),s("span",{class:"line"},[s("span",null,"  IdentityFile ~/.ssh/github_key")]),a(`
`),s("span",{class:"line"},[s("span")]),a(`
`),s("span",{class:"line"},[s("span",null,"# 其他 Git 服务")]),a(`
`),s("span",{class:"line"},[s("span",null,"Host *")]),a(`
`),s("span",{class:"line"},[s("span",null,"  # 默认配置")]),a(`
`),s("span",{class:"line"},[s("span",null,"  TCPKeepAlive yes")]),a(`
`),s("span",{class:"line"},[s("span",null,"  ServerAliveInterval 60")])])]),s("button",{class:"code-block-unfold-btn"})],-1)])]),"main-header":n(()=>[e(l.$slots,"main-header")]),"main-header-after":n(()=>[e(l.$slots,"main-header-after")]),"main-nav":n(()=>[e(l.$slots,"main-nav")]),"main-content-before":n(()=>[e(l.$slots,"main-content-before")]),"main-content":n(()=>[e(l.$slots,"main-content")]),"main-content-after":n(()=>[e(l.$slots,"main-content-after")]),"main-nav-before":n(()=>[e(l.$slots,"main-nav-before")]),"main-nav-after":n(()=>[e(l.$slots,"main-nav-after")]),comment:n(()=>[e(l.$slots,"comment")]),footer:n(()=>[e(l.$slots,"footer")]),aside:n(()=>[e(l.$slots,"aside")]),"aside-custom":n(()=>[e(l.$slots,"aside-custom")]),default:n(()=>[e(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{T as default,v as usePageData};
