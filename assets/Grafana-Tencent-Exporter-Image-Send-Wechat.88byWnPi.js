import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang.DBuGQqdy.js";import"./chunks/@vueuse/motion.BITvz5PP.js";import{e as c,u as F,a as u}from"./chunks/vue-router.BxaDuBsg.js";import{aa as y,ap as i,ag as n,af as a,ai as s,P as f,ab as m,a1 as b}from"./framework.GHZxz7jq.js";import"./index.DpUV-Spk.js";import"./chunks/dayjs.BldX5ftQ.js";import"./chunks/vue-i18n.C7V8WoQZ.js";import"./chunks/pinia.BfAlK2F6.js";import"./chunks/nprogress.BZwbcB2O.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.MEbNDp3K.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.fblE3Fel.js";import"./post.CjbzLuOT.js";const E=c("/posts/Grafana-Tencent-Exporter-Image-Send-Wechat",async e=>JSON.parse('{"title":"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信","description":"","frontmatter":{"title":"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信","categories":"Grafana","tags":["Grafana","腾讯云监控"],"date":"2022-01-26 16:18:23"},"headers":[],"relativePath":"pages/posts/Grafana-Tencent-Exporter-Image-Send-Wechat.md","lastUpdated":null}'),{lazy:(e,t)=>e.name===t.name}),R={__name:"Grafana-Tencent-Exporter-Image-Send-Wechat",setup(e,{expose:t}){const{data:r}=E(),p=u(),d=F(),h=Object.assign(d.meta.frontmatter||{},r.value?.frontmatter||{});return p.currentRoute.value.data=r.value,b("valaxy:frontmatter",h),globalThis.$frontmatter=h,t({frontmatter:{title:"Grafana使用腾讯云监控插件监控腾讯云产品并形成Dashboard图片或PDF文件发送企业微信",categories:"Grafana",tags:["Grafana","腾讯云监控"],date:"2022-01-26 16:18:23"}}),(l,k)=>{const o=g;return m(),y(o,{frontmatter:f(h)},{"main-content-md":i(()=>[...k[0]||(k[0]=[a("h2",{id:"背景",tabindex:"-1"},[s("背景 "),a("a",{class:"header-anchor",href:"#背景","aria-label":'Permalink to "背景"'},"​")],-1),a("blockquote",null,[a("p",null,"公司的服务资源几乎都在腾讯云上,现在客户需求每天看到服务器和部分服务的使用报告")],-1),a("p",null,"经过一番查询发现还是有方法实现的(在不写代码的情况下,这里指出了shell以外的任何代码)",-1),a("h2",{id:"设计",tabindex:"-1"},[s("设计 "),a("a",{class:"header-anchor",href:"#设计","aria-label":'Permalink to "设计"'},"​")],-1),a("p",null,"首先我们需要有Grafana,这样才能用于展示,调试等操作",-1),a("p",null,"其次数据源我们可以直接使用腾讯云研发的基于Grafana的插件,使用该插件. 作用就是可以把你的Grafana数据源设置为腾讯云监控. 也就是说你在腾讯云监控界面能看到什么,经过一番不太困难的设置,你在Grafana里也同样能达到效果",-1),a("p",null,"将Grafana的Panel变成图片,我们可以使用grafana-image-renderer插件(玩起来颇吃力)",-1),a("p",null,"将Grafana的Dashboard变成PDF,我们可以使用Grafana-report",-1),a("p",null,"最后就是将生成的图片或者PDF发送至企业微信,在最下面我会贴出我写的脚本,你只需要拿去直接用就可以了",-1),a("ul",null,[a("li",null,"部署Grafana"),a("li",null,"安装Tencent Cloud Monitoring和grafana-image-renderer插件"),a("li",null,"安装Grafana-report生成PDF文件"),a("li",null,"脚本定时发送运维日报(PDF文件或图片)至企业微信")],-1),a("h2",{id:"开始",tabindex:"-1"},[s("开始 "),a("a",{class:"header-anchor",href:"#开始","aria-label":'Permalink to "开始"'},"​")],-1),a("h3",{id:"安装grafana",tabindex:"-1"},[s("安装Grafana "),a("a",{class:"header-anchor",href:"#安装grafana","aria-label":'Permalink to "安装Grafana"'},"​")],-1),a("p",null,"接下来我们就来安装 Grafana，Grafana 本身是非常轻量级的，不会占用大量资源，此外 Grafana 需要一个数据库来存储其配置数据，比如用户、数据源和仪表盘等，目前 Grafana 支持 SQLite、MySQL、PostgreSQL 3 种数据库，默认使用的是 SQLite，该数据库文件会存储在 Grafana 的安装位置，所以需要对 Grafana 的安装目录进行持久化。",-1),a("p",null,[s("要安装 Grafana 的方式有很多，我们这里使用的是 CentOS 系统，可以在 Grafana 官方下载页面筛选合适的版本 "),a("a",{href:"https://grafana.com/grafana/download?edition=oss&platform=linux",target:"_blank",rel:"noreferrer"},"https://grafana.com/grafana/download?edition=oss&platform=linux"),s(" 根据自己的需求来进行安装，比如我们这里直接使用 rpm 包进行安装：")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"wget https://dl.grafana.com/oss/release/grafana-8.2.1-1.x86_64.rpm")]),s(`
`),a("span",{class:"line"},[a("span",null,"yum install grafana-8.2.1-1.x86_64.rpm")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"安装完成后我们就可以使用 systemd 来管理 Grafana：",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"systemctl daemon-reload")]),s(`
`),a("span",{class:"line"},[a("span",null,"systemctl enable grafana-server")]),s(`
`),a("span",{class:"line"},[a("span",null,"systemctl start grafana-server")]),s(`
`),a("span",{class:"line"},[a("span",null,"systemctl status grafana-server")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,[s("默认的启动配置环境变量位于 "),a("code",null,"/etc/sysconfig/grafana-server"),s(" 文件中：")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"cat /etc/sysconfig/grafana-server")]),s(`
`),a("span",{class:"line"},[a("span")]),s(`
`),a("span",{class:"line"},[a("span",null,"GRAFANA_USER=grafana")]),s(`
`),a("span",{class:"line"},[a("span",null,"GRAFANA_GROUP=grafana")]),s(`
`),a("span",{class:"line"},[a("span",null,"GRAFANA_HOME=/usr/share/grafana")]),s(`
`),a("span",{class:"line"},[a("span",null,"LOG_DIR=/var/log/grafana")]),s(`
`),a("span",{class:"line"},[a("span",null,"DATA_DIR=/var/lib/grafana")]),s(`
`),a("span",{class:"line"},[a("span",null,"MAX_OPEN_FILES=10000")]),s(`
`),a("span",{class:"line"},[a("span",null,"CONF_DIR=/etc/grafana")]),s(`
`),a("span",{class:"line"},[a("span",null,"CONF_FILE=/etc/grafana/grafana.ini")]),s(`
`),a("span",{class:"line"},[a("span",null,"RESTART_ON_UPGRADE=true")]),s(`
`),a("span",{class:"line"},[a("span",null,"PLUGINS_DIR=/var/lib/grafana/plugins")]),s(`
`),a("span",{class:"line"},[a("span",null,"PROVISIONING_CFG_DIR=/etc/grafana/provisioning")]),s(`
`),a("span",{class:"line"},[a("span",null,"# Only used on systemd systems")]),s(`
`),a("span",{class:"line"},[a("span",null,"PID_FILE_DIR=/var/run/grafana")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"从上面文件中可以找到 Grafana 的各种数据配置路径，比如数据目录、日志目录、插件目录等等，正常启动完成后 Grafana 会监听在 3000 端口上，所以我们可以在浏览器中打开 Grafana 的 WebUI。",-1),a("p",null,[s("默认的用户名和密码为 "),a("code",null,"admin"),s("，也可以在配置文件 "),a("code",null,"/etc/grafana/grafana.ini"),s(" 中配置 "),a("code",null,"admin_user"),s(" 和 "),a("code",null,"admin_password"),s(" 两个参数来进行覆盖。")],-1),a("p",null,[s("当然如果我们想要部署一个高可用版本的 Grafana 的话，那么使用 SQLite 数据库就不行了，需要切换到 MySQL 或者 PostgreSQL，我们可以在 Grafana 配置的 "),a("code",null,"[database]"),s(" 部分找到数据库的相关配置，Grafana 会将所有长期数据保存在数据库中，然后部署多个 Grafana 实例使用同一个数据库即可实现高可用。")],-1),a("h3",{id:"配置grafana腾讯云监控数据源",tabindex:"-1"},[s("配置Grafana腾讯云监控数据源 "),a("a",{class:"header-anchor",href:"#配置grafana腾讯云监控数据源","aria-label":'Permalink to "配置Grafana腾讯云监控数据源"'},"​")],-1),a("blockquote",null,[a("p",null,[s("腾讯云监控 为用户提供云服务器、云数据库等多个云产品的负载和性能监控指标，用户可以使用云监控控制台、云监控 API 等方式获取相关监控数据。腾讯云监控应用插件 Tencent Cloud Monitor "),a("strong",null,"App，是一款适配开源软件 Grafana 的应用插件，通过调用 腾讯云监控 API 3.0的方式获取监控数据，并对数据进行自定义 Dashboard 展示。")])],-1),a("p",null,[s("参考Github项目地址:"),a("a",{href:"https://github.com/TencentCloud/tencentcloud-monitor-grafana-app",target:"_blank",rel:"noreferrer"},"https://github.com/TencentCloud/tencentcloud-monitor-grafana-app")],-1),a("p",null,"使用 Grafana CLI 安装：",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"grafana-cli plugins install tencentcloud-monitor-app")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"安装后重启Grafana",-1),a("div",{class:"language-bash"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"bash"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," restart"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," grafana-server")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("blockquote",null,[a("p",null,"访问Grafana配置数据源,在此之前,您需要在腾讯云API管理中心创建属于你自己的Sercetkey.")],-1),a("blockquote",null,[a("p",null,"Grafana在配置数据源的时候需要使用该key进行认证.")],-1),a("figure",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112151154005.png#mirages-width=1920&mirages-height=940&mirages-cdn-type=5",alt:"image-20220112151154005",loading:"lazy",decoding:"async"})],-1),a("p",null,"在Grafana插件中打开该应用,然后在数据源中进行配置",-1),a("figure",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112151259213.png#mirages-width=1920&mirages-height=640&mirages-cdn-type=5",alt:"image-20220112151259213",loading:"lazy",decoding:"async"})],-1),a("figure",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112151417057.png#mirages-width=1920&mirages-height=937&mirages-cdn-type=5",alt:"image-20220112151417057",loading:"lazy",decoding:"async"})],-1),a("p",null,"配置后好点击最下方得Save&Test就可以了.这时候你就可以在Grafana中查看你在腾讯云中得服务资源监控了.",-1),a("h3",{id:"grafana-image-renderer插件安装",tabindex:"-1"},[s("Grafana-image-renderer插件安装 "),a("a",{class:"header-anchor",href:"#grafana-image-renderer插件安装","aria-label":'Permalink to "Grafana-image-renderer插件安装"'},"​")],-1),a("blockquote",null,[a("p",null,"该插件自己安装会报错比较多,推荐使用Docker启动,因为我机器上默认已经安装好了Docker所以就不再放安装Docker得文档了"),a("p",null,"该方法是采用插件和Grafana主体分离的形式运行的,以防生成图片过大时机器过载")],-1),a("p",null,"运行",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"docker pull grafana/grafana-image-renderer")]),s(`
`),a("span",{class:"line"},[a("span",null,"docker run -d --name=render --network=host --restart=always -e BROWSER_TZ=Asia/Shanghai grafana/grafana-image-renderer")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"在Grafana中配置插件地址",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"vim /etc/grafana/grafana.ini")]),s(`
`),a("span",{class:"line"},[a("span")]),s(`
`),a("span",{class:"line"},[a("span",null,"#修改以下内容")]),s(`
`),a("span",{class:"line"},[a("span",null,"[rendering]")]),s(`
`),a("span",{class:"line"},[a("span",null,"server_url = http://你的Grafana插件地址:8081/render")]),s(`
`),a("span",{class:"line"},[a("span",null,"callback_url = http://你的grafana地址:3000/")]),s(`
`),a("span",{class:"line"},[a("span",null,"#字符改成zh；支持中文")]),s(`
`),a("span",{class:"line"},[a("span",null,"rendering_language = zh")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"重启Grafana使配置生效",-1),a("div",{class:"language-bash"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"bash"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," restart"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," grafana-server")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"任选一Panel,点击Share,点击拍照图标即可生成该Panel图片",-1),a("figure",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112152306485.png#mirages-width=939&mirages-height=372&mirages-cdn-type=5",alt:"image-20220112152306485",loading:"lazy",decoding:"async"})],-1),a("figure",null,[a("img",{src:"https://cos.vlinux.cn/www-vlinux-cn-blog-img/image-20220112152355044.png#mirages-width=870&mirages-height=476&mirages-cdn-type=5",alt:"image-20220112152355044",loading:"lazy",decoding:"async"})],-1),a("h3",{id:"安装grafana-report生成pdf文件",tabindex:"-1"},[s("安装Grafana-report生成PDF文件 "),a("a",{class:"header-anchor",href:"#安装grafana-report生成pdf文件","aria-label":'Permalink to "安装Grafana-report生成PDF文件"'},"​")],-1),a("blockquote",null,[a("p",null,"我尝试过Docker启动该服务,不过后来因各种报错和依赖放弃了,于是打算自己下载项目直接运行该服务.")],-1),a("p",null,"安装该服务相关依赖,解决后续可能会出现的不显示中文,中文乱码,或者因为字体报错而无法生成文件等情况,在这之前你需要配置好Yum源,Base和epel",-1),a("div",{class:"language-bash"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"bash"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"yum"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," go"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," git"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-pdftex"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-latex-bin"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-texconfig"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-latex"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-metafont"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-cmap"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-ec"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-fncychap"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-pdftex-def"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-fancyhdr"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-titlesec"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-multirow"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-framed"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-wrapfig"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-parskip"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-caption"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-ifluatex"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-collection-fontsrecommended"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texlive-collection-latexrecommended"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," texinfo-tex")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"编译该程序",-1),a("div",{class:"language-bash"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"bash"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"go"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," get"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," github.com/IzakMarais/reporter/...")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"go"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," github.com/IzakMarais/reporter/cmd/grafana-reporter")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"go/bin/grafana-reporter"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -ip"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ip:8686"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," （会开启8686端口）")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"因为该插件是以匿名方式访问Grafana所产生PDF文件的,所以在Grafana中我们还需要打开匿名访问的权限.",-1),a("p",null,"编辑grafana.ini",-1),a("div",{class:"language-ini"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"ini"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#################################### Anonymous Auth ######################")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"[auth.anonymous]")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# enable anonymous access")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"enabled"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = true")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# specify organization name that should be used for unauthenticated users")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},";org_name = Main Org.")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# specify role for unauthenticated users")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"org_role"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = Viewer")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"重启Grafana以生效",-1),a("div",{class:"language-shell"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"shell"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," restart"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," grafana-server")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"生成图片或导出pdf发送至企业微信",tabindex:"-1"},[s("生成图片或导出PDF发送至企业微信 "),a("a",{class:"header-anchor",href:"#生成图片或导出pdf发送至企业微信","aria-label":'Permalink to "生成图片或导出PDF发送至企业微信"'},"​")],-1),a("h3",{id:"图片生成",tabindex:"-1"},[s("图片生成 "),a("a",{class:"header-anchor",href:"#图片生成","aria-label":'Permalink to "图片生成"'},"​")],-1),a("p",null,"上面安装的时候我们演示了如何对一个Panel生成图片,那如何对一个dashboard也生成一个图片呢?",-1),a("p",null,"官网的说法是: 不支持",-1),a("p",null,"但我问了很多大佬,最终找到了好用的方法.",-1),a("p",null,"既然Panel可以生成,那我们直接拼接Panel的链接不就好了.",-1),a("p",null,"假如你的Dashboard的链接是这样的",-1),a("p",null,[a("a",{href:"http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1",target:"_blank",rel:"noreferrer"},"http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1")],-1),a("p",null,"那么你的图片生成链接就是这样子的",-1),a("p",null,[a("a",{href:"http://GrafanaIP:3000/render/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1&from=now-1h&to=now&width=1600&height=100000",target:"_blank",rel:"noreferrer"},"http://GrafanaIP:3000/render/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1&from=now-1h&to=now&width=1600&height=100000")],-1),a("p",null,"如果图片的长宽或者显示图表时常你不满意,也可以通过修改参数来更改 from,width,height.",-1),a("blockquote",null,[a("p",null,[s("发送图片至企业微信机器人请借鉴:"),a("a",{href:"https://www.jianshu.com/p/f1a0cbd13a70",target:"_blank",rel:"noreferrer"},"https://www.jianshu.com/p/f1a0cbd13a70")])],-1),a("h3",{id:"pdf文件生成",tabindex:"-1"},[s("PDF文件生成 "),a("a",{class:"header-anchor",href:"#pdf文件生成","aria-label":'Permalink to "PDF文件生成"'},"​")],-1),a("p",null,"假如你的Dashboard的链接是这样的",-1),a("p",null,[a("a",{href:"http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1",target:"_blank",rel:"noreferrer"},"http://GrafanaIP:3000/d/9CWBz0bik/zhu-ji-zi-yuan-qing-dan?orgId=1")],-1),a("p",null,"那么你的PDF生成链接就是这样子的",-1),a("p",null,[a("a",{href:"http://GrafanaIP:8686/api/v5/report/9CWBz0bik",target:"_blank",rel:"noreferrer"},"http://GrafanaIP:8686/api/v5/report/9CWBz0bik")],-1),a("blockquote",null,[a("p",null,"定时发送运维日报文件PDF到企业微信机器人脚本如下")],-1),a("p",null,"请根据自身情况合适修改,如修改企业微信机器人提供的KEY等",-1),a("div",{class:"language-shell"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"},"shell"),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#**********************************************************")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#作者: Vlinux")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#最新修改: 2022-01-12 16:43")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#文件名: wxbot_sendfile.sh")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#描述: 自动发送服务器指定文件到企业微信群聊机器人")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#**********************************************************")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/bash")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"time"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$("),a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"date"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "+%Y%m%d"'),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"wget"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -O"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/devops/运维日报"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$("),a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"date"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "+%Y%m%d"'),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".pdf"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," http://GrafanaIP:8686/api/v5/report/G3PSmI17k")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#---------------------------------------------------修改部分-----------------------------------")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Webhook"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"key"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"a3114e-9708--8135-6941761ffb08")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"file_dir"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/opt/devops/运维日报"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${time}"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".pdf"),a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #文件所在目录")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $file_dir")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#----------------------------------------------------END--------------------------------------")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"key"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$("),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $Webhook "),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," awk"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -F"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ="),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '{print $2}'"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," test"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -s"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $file_dir; "),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"then")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," file_id"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`"),a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"curl"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -s"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -F"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," media=@"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$file_dir"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "https://qyapi.weixin.qq.com/cgi-bin/webhook/upload_media?key='),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$key"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'&amp;type=file" '),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," awk"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'END{print}'"),a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"awk"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -F"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '\"' '{print $14}'`")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"   else")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," echo"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 未检测到文件，脚本退出")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," exit"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"fi")]),s(`
`),a("span",{class:"line"}),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"curl"),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ${Webhook} "),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -H"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'Content-Type: application/json'"),a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "msgtype": "file",')]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "file": {')]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},` "media_id": "'`),a("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$file_id"),a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`'"`)]),s(`
`),a("span",{class:"line"}),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," }")]),s(`
`),a("span",{class:"line"},[a("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," }'")])])]),a("button",{class:"code-block-unfold-btn"})],-1)])]),"main-header":i(()=>[n(l.$slots,"main-header")]),"main-header-after":i(()=>[n(l.$slots,"main-header-after")]),"main-nav":i(()=>[n(l.$slots,"main-nav")]),"main-content-before":i(()=>[n(l.$slots,"main-content-before")]),"main-content":i(()=>[n(l.$slots,"main-content")]),"main-content-after":i(()=>[n(l.$slots,"main-content-after")]),"main-nav-before":i(()=>[n(l.$slots,"main-nav-before")]),"main-nav-after":i(()=>[n(l.$slots,"main-nav-after")]),comment:i(()=>[n(l.$slots,"comment")]),footer:i(()=>[n(l.$slots,"footer")]),aside:i(()=>[n(l.$slots,"aside")]),"aside-custom":i(()=>[n(l.$slots,"aside-custom")]),default:i(()=>[n(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{R as default,E as usePageData};
