import{_ as p}from"./ValaxyMain-69d5034a.js";import{_ as r,p as D,c as y,w as o,o as F,r as e,b as s,R as l}from"./app-2f70f213.js";import"./YunFooter-5ce7538e.js";import"./YunCard-e25878d2.js";import"./YunPageHeader-cb5c6fff.js";const Fl=JSON.parse('{"title":"Nginx反向代理负载均衡","description":"","frontmatter":{"title":"Nginx反向代理负载均衡","categories":"Linux技术","tags":["Nginx","Nginx反向代理","Nginx负载均衡"],"date":"2019-09-16T21:00:00.000Z"},"headers":[{"level":2,"title":"Nginx代理服务基本概述","slug":"nginx代理服务基本概述","link":"#nginx代理服务基本概述","children":[]},{"level":2,"title":"正向代理和反向代理","slug":"正向代理和反向代理","link":"#正向代理和反向代理","children":[]},{"level":2,"title":"Nginx代理服务支持的协议","slug":"nginx代理服务支持的协议","link":"#nginx代理服务支持的协议","children":[]},{"level":2,"title":"Nginx反向代理配置语法","slug":"nginx反向代理配置语法","link":"#nginx反向代理配置语法","children":[]},{"level":2,"title":"Nginx反向代理实战","slug":"nginx反向代理实战","link":"#nginx反向代理实战","children":[]},{"level":2,"title":"Nginx负载均衡概述","slug":"nginx负载均衡概述","link":"#nginx负载均衡概述","children":[{"level":3,"title":"为什么需要负载均衡","slug":"为什么需要负载均衡","link":"#为什么需要负载均衡","children":[]}]},{"level":2,"title":"Nginx负载均衡配置场景","slug":"nginx负载均衡配置场景","link":"#nginx负载均衡配置场景","children":[{"level":3,"title":"1.四层负载均衡","slug":"_1-四层负载均衡","link":"#_1-四层负载均衡","children":[]},{"level":3,"title":"2.七层负载均衡","slug":"_2-七层负载均衡","link":"#_2-七层负载均衡","children":[]},{"level":3,"title":"3.四层负载均衡与七层负载均衡区别","slug":"_3-四层负载均衡与七层负载均衡区别","link":"#_3-四层负载均衡与七层负载均衡区别","children":[]}]},{"level":2,"title":"Nginx负载均衡调度算法","slug":"nginx负载均衡调度算法","link":"#nginx负载均衡调度算法","children":[]},{"level":2,"title":"Nginx负载均衡配置参数","slug":"nginx负载均衡配置参数","link":"#nginx负载均衡配置参数","children":[]},{"level":2,"title":"Nginx反向代理负载均衡关系图","slug":"nginx反向代理负载均衡关系图","link":"#nginx反向代理负载均衡关系图","children":[]},{"level":2,"title":"Nginx负载均衡实战","slug":"nginx负载均衡实战","link":"#nginx负载均衡实战","children":[{"level":3,"title":"1.规划分类","slug":"_1-规划分类","link":"#_1-规划分类","children":[]},{"level":3,"title":"2.创建地址池","slug":"_2-创建地址池","link":"#_2-创建地址池","children":[]},{"level":3,"title":"3.匹配条件","slug":"_3-匹配条件","link":"#_3-匹配条件","children":[]},{"level":3,"title":"4.组合在一起","slug":"_4-组合在一起","link":"#_4-组合在一起","children":[]},{"level":3,"title":"5.创建代码环境","slug":"_5-创建代码环境","link":"#_5-创建代码环境","children":[]},{"level":3,"title":"6.进行测试","slug":"_6-进行测试","link":"#_6-进行测试","children":[]}]},{"level":2,"title":"3.1 根据文件类型转发","slug":"_3-1-根据文件类型转发","link":"#_3-1-根据文件类型转发","children":[{"level":3,"title":"转发需求","slug":"转发需求","link":"#转发需求","children":[]},{"level":3,"title":"lb配置文件","slug":"lb配置文件","link":"#lb配置文件","children":[]}]},{"level":2,"title":"3.2 动静分离","slug":"_3-2-动静分离","link":"#_3-2-动静分离","children":[{"level":3,"title":"转发需求","slug":"转发需求-1","link":"#转发需求-1","children":[]},{"level":3,"title":"配置文件","slug":"配置文件","link":"#配置文件","children":[]}]},{"level":2,"title":"3.3 根据客户端转发","slug":"_3-3-根据客户端转发","link":"#_3-3-根据客户端转发","children":[{"level":3,"title":"转发需求","slug":"转发需求-2","link":"#转发需求-2","children":[]},{"level":3,"title":"lb服务器配置文件","slug":"lb服务器配置文件","link":"#lb服务器配置文件","children":[]},{"level":3,"title":"web服务器配置","slug":"web服务器配置","link":"#web服务器配置","children":[]},{"level":3,"title":"访问测试","slug":"访问测试","link":"#访问测试","children":[]}]}],"relativePath":"pages/posts/Nginx反向代理负载均衡.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Nginx反向代理负载均衡.md","lastUpdated":1671091756000}'),a=JSON.parse('{"title":"Nginx反向代理负载均衡","description":"","frontmatter":{"title":"Nginx反向代理负载均衡","categories":"Linux技术","tags":["Nginx","Nginx反向代理","Nginx负载均衡"],"date":"2019-09-16T21:00:00.000Z"},"headers":[{"level":2,"title":"Nginx代理服务基本概述","slug":"nginx代理服务基本概述","link":"#nginx代理服务基本概述","children":[]},{"level":2,"title":"正向代理和反向代理","slug":"正向代理和反向代理","link":"#正向代理和反向代理","children":[]},{"level":2,"title":"Nginx代理服务支持的协议","slug":"nginx代理服务支持的协议","link":"#nginx代理服务支持的协议","children":[]},{"level":2,"title":"Nginx反向代理配置语法","slug":"nginx反向代理配置语法","link":"#nginx反向代理配置语法","children":[]},{"level":2,"title":"Nginx反向代理实战","slug":"nginx反向代理实战","link":"#nginx反向代理实战","children":[]},{"level":2,"title":"Nginx负载均衡概述","slug":"nginx负载均衡概述","link":"#nginx负载均衡概述","children":[{"level":3,"title":"为什么需要负载均衡","slug":"为什么需要负载均衡","link":"#为什么需要负载均衡","children":[]}]},{"level":2,"title":"Nginx负载均衡配置场景","slug":"nginx负载均衡配置场景","link":"#nginx负载均衡配置场景","children":[{"level":3,"title":"1.四层负载均衡","slug":"_1-四层负载均衡","link":"#_1-四层负载均衡","children":[]},{"level":3,"title":"2.七层负载均衡","slug":"_2-七层负载均衡","link":"#_2-七层负载均衡","children":[]},{"level":3,"title":"3.四层负载均衡与七层负载均衡区别","slug":"_3-四层负载均衡与七层负载均衡区别","link":"#_3-四层负载均衡与七层负载均衡区别","children":[]}]},{"level":2,"title":"Nginx负载均衡调度算法","slug":"nginx负载均衡调度算法","link":"#nginx负载均衡调度算法","children":[]},{"level":2,"title":"Nginx负载均衡配置参数","slug":"nginx负载均衡配置参数","link":"#nginx负载均衡配置参数","children":[]},{"level":2,"title":"Nginx反向代理负载均衡关系图","slug":"nginx反向代理负载均衡关系图","link":"#nginx反向代理负载均衡关系图","children":[]},{"level":2,"title":"Nginx负载均衡实战","slug":"nginx负载均衡实战","link":"#nginx负载均衡实战","children":[{"level":3,"title":"1.规划分类","slug":"_1-规划分类","link":"#_1-规划分类","children":[]},{"level":3,"title":"2.创建地址池","slug":"_2-创建地址池","link":"#_2-创建地址池","children":[]},{"level":3,"title":"3.匹配条件","slug":"_3-匹配条件","link":"#_3-匹配条件","children":[]},{"level":3,"title":"4.组合在一起","slug":"_4-组合在一起","link":"#_4-组合在一起","children":[]},{"level":3,"title":"5.创建代码环境","slug":"_5-创建代码环境","link":"#_5-创建代码环境","children":[]},{"level":3,"title":"6.进行测试","slug":"_6-进行测试","link":"#_6-进行测试","children":[]}]},{"level":2,"title":"3.1 根据文件类型转发","slug":"_3-1-根据文件类型转发","link":"#_3-1-根据文件类型转发","children":[{"level":3,"title":"转发需求","slug":"转发需求","link":"#转发需求","children":[]},{"level":3,"title":"lb配置文件","slug":"lb配置文件","link":"#lb配置文件","children":[]}]},{"level":2,"title":"3.2 动静分离","slug":"_3-2-动静分离","link":"#_3-2-动静分离","children":[{"level":3,"title":"转发需求","slug":"转发需求-1","link":"#转发需求-1","children":[]},{"level":3,"title":"配置文件","slug":"配置文件","link":"#配置文件","children":[]}]},{"level":2,"title":"3.3 根据客户端转发","slug":"_3-3-根据客户端转发","link":"#_3-3-根据客户端转发","children":[{"level":3,"title":"转发需求","slug":"转发需求-2","link":"#转发需求-2","children":[]},{"level":3,"title":"lb服务器配置文件","slug":"lb服务器配置文件","link":"#lb服务器配置文件","children":[]},{"level":3,"title":"web服务器配置","slug":"web服务器配置","link":"#web服务器配置","children":[]},{"level":3,"title":"访问测试","slug":"访问测试","link":"#访问测试","children":[]}]}],"relativePath":"pages/posts/Nginx反向代理负载均衡.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Nginx反向代理负载均衡.md","lastUpdated":1671091756000}'),i={name:"pages/posts/Nginx反向代理负载均衡.md",data(){return{data:a,frontmatter:a.frontmatter}},setup(){D("pageData",a)}},C=s("h1",{id:"第一章-反向代理",tabindex:"-1"},[l("第一章 反向代理 "),s("a",{class:"header-anchor",href:"#第一章-反向代理","aria-hidden":"true"},"#")],-1),A=s("h2",{id:"nginx代理服务基本概述",tabindex:"-1"},[l("Nginx代理服务基本概述 "),s("a",{class:"header-anchor",href:"#nginx代理服务基本概述","aria-hidden":"true"},"#")],-1),d=s("p",null,"1.代理一词往往并不陌生, 该服务我们常常用到如(代理理财、代理租房、代理收货等等)，如下图所示",-1),h=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-a3b5875e1b44445a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),_=s("p",null,"2.在没有代理模式的情况下，客户端和 Nginx 服务端，都是客户端直接请求服务端，服务端直接响应客户端。",-1),g=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-b0f9334374c9a40f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),u=s("p",null,"3.那么在互联网请求里面, 客户端往往无法直接向服务端发起请求, 那么就需要用到代理服务, 来实现客户端和服务通信，如下图所示",-1),x=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-7ef0e8f177241a7b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),m=s("h2",{id:"正向代理和反向代理",tabindex:"-1"},[l("正向代理和反向代理 "),s("a",{class:"header-anchor",href:"#正向代理和反向代理","aria-hidden":"true"},"#")],-1),f=s("p",null,"以访问Goo为例，客户端连接到VPN相当于正向代理 VPN代理请求访问后端服务器并返回属于反向代理",-1),B=s("h2",{id:"nginx代理服务支持的协议",tabindex:"-1"},[l("Nginx代理服务支持的协议 "),s("a",{class:"header-anchor",href:"#nginx代理服务支持的协议","aria-hidden":"true"},"#")],-1),b=s("p",null,"1.Nginx 作为代理服务，可支持的代理协议非常的多，具体如下图",-1),v=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-e812f49d132dc120.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),w=s("p",null,"2.如果将 Nginx 作为反向代理服务，常常会用到如下几种代理协议，如下图所示",-1),k=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-9338a70ac645620d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),E=s("p",null,"3.反向代理模式与 Nginx 代理模块总结如表格所示",-1),N=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-5dd0c477e40e6079.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/742/format/webp",alt:"img"})],-1),$=s("h2",{id:"nginx反向代理配置语法",tabindex:"-1"},[l("Nginx反向代理配置语法 "),s("a",{class:"header-anchor",href:"#nginx反向代理配置语法","aria-hidden":"true"},"#")],-1),j=s("p",null,"1.Nginx代理配置语法",-1),S=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_pass URL"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," —")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": location"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," in location"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," limit_except")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"http"),s("span",{style:{color:"#A6ACCD"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//localhost:8000/uri/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"http"),s("span",{style:{color:"#A6ACCD"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//192.168.56.11:8000/uri/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"http"),s("span",{style:{color:"#A6ACCD"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//unix:/tmp/backend.socket:/uri/")]),l(`
`),s("span",{class:"line"})])])],-1),V=s("p",null,"2.添加传递给后端服务器的请求头信息",-1),M=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_set_header field value"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_set_header Host "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"proxy_host"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header Connection close"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"# 用户请求的时候 HOST 的值是 www.oldboy.com, 那么代理服务会像后端传递请求的还是 www.oldboy.com")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header Host "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"http_host"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"# 将$remote_addr 的值放进变量 X-Real-IP 中， $remote_addr 的值为客户端的 ip")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header X"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#C792EA"}},"Real"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"IP "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"remote_addr"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"# 客户端通过代理服务访问后端服务, 后端服务通过该变量会记录真实客户端地址")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header X"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Forwarded"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"For "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"proxy_add_x_forwarded_for"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"})])])],-1),P=s("p",null,"3.代理到后端的TCP连接数，响应，返回等超时时间",-1),I=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"//nginx 代理与后端服务器连接超时时间(代理连接超时)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_connect_timeout time"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_connect_timeout "),s("span",{style:{color:"#F78C6C"}},"60"),s("span",{style:{color:"#A6ACCD"}},"s"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"//nginx 代理等待后端服务器的响应时间")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_read_timeout time"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_read_timeout "),s("span",{style:{color:"#F78C6C"}},"60"),s("span",{style:{color:"#A6ACCD"}},"s"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"//后端服务器数据回传给 nginx 代理超时时间")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_send_timeout time"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_send_timeout "),s("span",{style:{color:"#F78C6C"}},"60"),s("span",{style:{color:"#A6ACCD"}},"s"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"})])])],-1),L=s("p",null,"4.代理缓冲区",-1),U=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"//nignx 会把后端返回的内容先放到缓冲区当中，然后再返回给客户端,边收边传, 不是全部接收完再传给客户端")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_buffering "),s("span",{style:{color:"#89DDFF"}},"on"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"off;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_buffering "),s("span",{style:{color:"#89DDFF"}},"on;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"//设置 nginx 代理保存用户头信息的缓冲区大小")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_buffer_size size"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_buffer_size "),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#A6ACCD"}},"k"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#A6ACCD"}},"k"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"//proxy_buffers 缓冲区")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Syntax"),s("span",{style:{color:"#A6ACCD"}},": proxy_buffers number size"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Default"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," proxy_buffers "),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#A6ACCD"}},"k"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#A6ACCD"}},"k"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"Context"),s("span",{style:{color:"#A6ACCD"}},": http"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," server"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," location")]),l(`
`),s("span",{class:"line"})])])],-1),R=s("p",null,"5.proxy代理网站常用配置 将配置写入新文件，调用时使用include引用即可",-1),T=s("div",{class:"language-ruby"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"lb01 "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# cat /etc/nginx/proxy_params ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header Host "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"http_host"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header X"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Real"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"IP "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"remote_addr"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_set_header X"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Forwarded"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"For "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"proxy_add_x_forwarded_for"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_connect_timeout "),s("span",{style:{color:"#F78C6C"}},"30"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_send_timeout "),s("span",{style:{color:"#F78C6C"}},"60"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_read_timeout "),s("span",{style:{color:"#F78C6C"}},"60"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_buffering on"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_buffer_size 32k"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"proxy_buffers "),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#A6ACCD"}}," 128k"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"})])])],-1),X=s("p",null,"6.代理配置location时调用，方便后面多个location重复使用",-1),z=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//127.0.0.1:8080;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),H=s("h2",{id:"nginx反向代理实战",tabindex:"-1"},[l("Nginx反向代理实战 "),s("a",{class:"header-anchor",href:"#nginx反向代理实战","aria-hidden":"true"},"#")],-1),O=s("p",null,"配置关系图：",-1),J=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-624ce98a23326448.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),W=s("p",null,"1.环境准备",-1),Z=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"lb01"),s("span",{style:{color:"#A6ACCD"}},"       "),s("span",{style:{color:"#C3E88D"}},"代理服务器")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"web01"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#C3E88D"}},"web服务器")]),l(`
`),s("span",{class:"line"})])])],-1),G=s("p",null,"2.web01服务器配置 配置一个网站，监听在 8080，此时网站仅 172 网段的用户能访问",-1),q=s("div",{class:"language-csharp"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," ~"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cd "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"etc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"nginx"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"d"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# vim web"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"conf")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"8080"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#FFCB6B"}},"server_name"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"localhost"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        root "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        index index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        deny 10.0.0.0"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#F78C6C"}},"24"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#FFCB6B"}},"allow"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"all"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# mkdir "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# echo "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"web01-7"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# systemctl restart nginx")]),l(`
`),s("span",{class:"line"})])])],-1),K=s("p",null,"3.配置lb01代理服务器 配置监听 eth0 的 80 端口，使 10.0.0.0 网段的用户，能够通过代理服务器访问到后端的172.16.1.7 的 8080 端口站点内容",-1),Q=s("div",{class:"language-csharp"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," ~"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cd "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"etc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"nginx"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"d"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat proxy_web_node1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"conf")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server_name nginx"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass "),s("span",{style:{color:"#FFCB6B"}},"http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//172.16.1.7:8080;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#FFCB6B"}},"include"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# systemctl enable nginx")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# systemctl start nginx")]),l(`
`),s("span",{class:"line"})])])],-1),Y=s("h1",{id:"第二章-负载均衡",tabindex:"-1"},[l("第二章 负载均衡 "),s("a",{class:"header-anchor",href:"#第二章-负载均衡","aria-hidden":"true"},"#")],-1),ss=s("h2",{id:"nginx负载均衡概述",tabindex:"-1"},[l("Nginx负载均衡概述 "),s("a",{class:"header-anchor",href:"#nginx负载均衡概述","aria-hidden":"true"},"#")],-1),ls=s("h3",{id:"为什么需要负载均衡",tabindex:"-1"},[l("为什么需要负载均衡 "),s("a",{class:"header-anchor",href:"#为什么需要负载均衡","aria-hidden":"true"},"#")],-1),os=s("p",null,"我们的 Web 服务器直接面向用户，往往要承载大量并发请求，单台服务器难以负荷，我使用多台 WEB 服务器组成集群，前端使用 Nginx 负载均衡，将请求分散的打到我们的后端服务器集群中，实现负载的分发。那么会大大提升系统的吞吐率、请求性能、高容灾",-1),ns=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-3e3daa9bf57283c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),es=s("p",null,"往往我们接触的最多的是 SLB(Server Load Balance)负载均衡，实现最多的也是 SLB、那么 SLB 它的调度节点和服务节点通常是在一个地域里面。那么它在这个小的逻辑地域里面决定了他对部分服务的实时性、响应性是非常好的。 所以说当海量用户请求过来以后，它同样是请求调度节点，调度节点将用户的请求转发给后端对应的服务节点，服务节点处理完请求后在转发给调度节点，调度节点最后响应给用户节点。这样也能实现一个均衡的作用，那么Nginx 则是一个典型的 SLB",-1),as=s("h2",{id:"nginx负载均衡配置场景",tabindex:"-1"},[l("Nginx负载均衡配置场景 "),s("a",{class:"header-anchor",href:"#nginx负载均衡配置场景","aria-hidden":"true"},"#")],-1),ts=s("h3",{id:"_1-四层负载均衡",tabindex:"-1"},[l("1.四层负载均衡 "),s("a",{class:"header-anchor",href:"#_1-四层负载均衡","aria-hidden":"true"},"#")],-1),cs=s("p",null,"所谓四层负载均衡指的是 OSI 七层模型中的传输层，那么传输层 Nginx 已经能支持 TCP/IP 的控制，所以只需要对客户端的请求进行 TCP/IP 协议的包转发就可以实现负载均衡，那么它的好处是性能非常快、只需要底层进行应用处理，而不需要进行一些复杂的逻辑",-1),ps=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-969d03f8082a1915.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),rs=s("h3",{id:"_2-七层负载均衡",tabindex:"-1"},[l("2.七层负载均衡 "),s("a",{class:"header-anchor",href:"#_2-七层负载均衡","aria-hidden":"true"},"#")],-1),Ds=s("p",null,"七层负载均衡它是在应用层，那么它可以完成很多应用方面的协议请求，比如我们说的 http 应用的负载均衡，它可以实现 http 信息的改写、头信息的改写、安全应用规则控制、 URL 匹配规则控制、以及转发、 rewrite 等等的规则，所以在应用层的服务里面，我们可以做的内容就更多，那么 Nginx 则是一个典型的七层负载均衡 SLB",-1),ys=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-f61309f2feaf95e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),Fs=s("h3",{id:"_3-四层负载均衡与七层负载均衡区别",tabindex:"-1"},[l("3.四层负载均衡与七层负载均衡区别 "),s("a",{class:"header-anchor",href:"#_3-四层负载均衡与七层负载均衡区别","aria-hidden":"true"},"#")],-1),is=s("p",null,"四层负载均衡数据包在底层就进行了分发，而七层负载均衡数据包则是在最顶层进行分发、由此可以看出，七层负载均衡效率没有四负载均衡高。 但七层负载均衡更贴近于服务，如:http 协议就是七层协议，我们可以用 Nginx 可以作会话保持， URL 路径规则匹配、 head 头改写等等，这些是四层负载均衡无法实现的",-1),Cs=s("h2",{id:"nginx负载均衡调度算法",tabindex:"-1"},[l("Nginx负载均衡调度算法 "),s("a",{class:"header-anchor",href:"#nginx负载均衡调度算法","aria-hidden":"true"},"#")],-1),As=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-373a5e02f00f66ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"img"})],-1),ds=s("h2",{id:"nginx负载均衡配置参数",tabindex:"-1"},[l("Nginx负载均衡配置参数 "),s("a",{class:"header-anchor",href:"#nginx负载均衡配置参数","aria-hidden":"true"},"#")],-1),hs=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-3f7e8e92e3982c78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/746/format/webp",alt:"img"})],-1),_s=s("h2",{id:"nginx反向代理负载均衡关系图",tabindex:"-1"},[l("Nginx反向代理负载均衡关系图 "),s("a",{class:"header-anchor",href:"#nginx反向代理负载均衡关系图","aria-hidden":"true"},"#")],-1),gs=s("p",null,[s("img",{src:"http://upload-images.jianshu.io/upload_images/14248468-c02fb171c4f25977.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/704/format/webp",alt:"img"})],-1),us=s("h2",{id:"nginx负载均衡实战",tabindex:"-1"},[l("Nginx负载均衡实战 "),s("a",{class:"header-anchor",href:"#nginx负载均衡实战","aria-hidden":"true"},"#")],-1),xs=s("h3",{id:"_1-规划分类",tabindex:"-1"},[l("1.规划分类 "),s("a",{class:"header-anchor",href:"#_1-规划分类","aria-hidden":"true"},"#")],-1),ms=s("div",{class:"language-cpp"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"upload     10.0.0.8:"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#A6ACCD"}},"     upload服务器")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#C792EA"}},"static"),s("span",{style:{color:"#A6ACCD"}},"     10.0.0.7:"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#A6ACCD"}},"     static静态服务器")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"           10.0.0.9:"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#A6ACCD"}},"     默认服务器")]),l(`
`),s("span",{class:"line"})])])],-1),fs=s("h3",{id:"_2-创建地址池",tabindex:"-1"},[l("2.创建地址池 "),s("a",{class:"header-anchor",href:"#_2-创建地址池","aria-hidden":"true"},"#")],-1),Bs=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"upstream"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"upload_pools{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#FFCB6B"}},"server"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10.0.0.8:"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"upstream"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"static_pools{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#FFCB6B"}},"server"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10.0.0.7:"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"upstream"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"defaule_pools{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#FFCB6B"}},"server"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"10.0.0.9:"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),bs=s("h3",{id:"_3-匹配条件",tabindex:"-1"},[l("3.匹配条件 "),s("a",{class:"header-anchor",href:"#_3-匹配条件","aria-hidden":"true"},"#")],-1),vs=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#C792EA"}},"static"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//static_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"###将符合upload的请求交给上传服务器池upload_pools,配置如下")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"upload"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//upload_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"###不符合上述规则的请求,默认全交给动态服务器池default_pools,配置如下:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//default_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),ws=s("h3",{id:"_4-组合在一起",tabindex:"-1"},[l("4.组合在一起 "),s("a",{class:"header-anchor",href:"#_4-组合在一起","aria-hidden":"true"},"#")],-1),ks=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"lb01 "),s("span",{style:{color:"#89DDFF"}},"~]"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# cat /etc/nginx/conf.d/node_proxy.conf")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream upload_pools "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream static_pools "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"7"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream default_pools "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"9"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server_name www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#C792EA"}},"static"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//static_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"upload"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//upload_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//default_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),Es=s("h3",{id:"_5-创建代码环境",tabindex:"-1"},[l("5.创建代码环境 "),s("a",{class:"header-anchor",href:"#_5-创建代码环境","aria-hidden":"true"},"#")],-1),Ns=s("p",null,"每个虚拟机存放的网页路径",-1),$s=s("div",{class:"language-cpp"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"upload"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#C792EA"}},"static"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"})])])],-1),js=s("p",null,"创建目录及测试页面命令",-1),Ss=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"mkdir"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-p"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/data/html/www/{upload,static}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"echo"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},'"$('),s("span",{style:{color:"#FFCB6B"}},"hostname"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}}," default"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#C3E88D"}},"/data/html/www/index.html"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"echo"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},'"$('),s("span",{style:{color:"#FFCB6B"}},"hostname"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}}," upload"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#C3E88D"}},"/data/html/www/upload/index.html"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"echo"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},'"$('),s("span",{style:{color:"#FFCB6B"}},"hostname"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}}," static"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#C3E88D"}},"/data/html/www/static/index.html"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),Vs=s("h3",{id:"_6-进行测试",tabindex:"-1"},[l("6.进行测试 "),s("a",{class:"header-anchor",href:"#_6-进行测试","aria-hidden":"true"},"#")],-1),Ms=s("div",{class:"language-csharp"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," ~"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# curl www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sweb01 default")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," ~"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# curl www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#C792EA"}},"static"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"web01 "),s("span",{style:{color:"#C792EA"}},"static")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@lb01"),s("span",{style:{color:"#A6ACCD"}}," ~"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# curl www"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"upload"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"web02 upload")]),l(`
`),s("span",{class:"line"})])])],-1),Ps=s("h1",{id:"第三章-根据条件转发实战",tabindex:"-1"},[l("第三章 根据条件转发实战 "),s("a",{class:"header-anchor",href:"#第三章-根据条件转发实战","aria-hidden":"true"},"#")],-1),Is=s("h2",{id:"_3-1-根据文件类型转发",tabindex:"-1"},[l("3.1 根据文件类型转发 "),s("a",{class:"header-anchor",href:"#_3-1-根据文件类型转发","aria-hidden":"true"},"#")],-1),Ls=s("h3",{id:"转发需求",tabindex:"-1"},[l("转发需求 "),s("a",{class:"header-anchor",href:"#转发需求","aria-hidden":"true"},"#")],-1),Us=s("p",null,"只需修改nginx.conf的配置文件中的loaction区块代码即可",-1),Rs=s("h3",{id:"lb配置文件",tabindex:"-1"},[l("lb配置文件 "),s("a",{class:"header-anchor",href:"#lb配置文件","aria-hidden":"true"},"#")],-1),Ts=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"location "),s("span",{style:{color:"#89DDFF"}},"~"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD"}},"gif"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"jpg"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"jpeg"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"png"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"bmp"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"swf"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"css"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"js"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"$ "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//static_pools;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_set_header Host "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"host"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    proxy_set_header X"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Forwarded"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"For "),s("span",{style:{color:"#89DDFF"}},"$"),s("span",{style:{color:"#A6ACCD"}},"remote_addr"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    upstream server_pools "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"7"),s("span",{style:{color:"#A6ACCD"}}," weight"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," max_fails"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"3"),s("span",{style:{color:"#A6ACCD"}}," fail_timeout"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#A6ACCD"}},"s"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#A6ACCD"}}," weight"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," max_fails"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"3"),s("span",{style:{color:"#A6ACCD"}}," fail_timeout"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#A6ACCD"}},"s"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"9"),s("span",{style:{color:"#A6ACCD"}}," weight"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," max_fails"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"3"),s("span",{style:{color:"#A6ACCD"}}," fail_timeout"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#A6ACCD"}},"s"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),Xs=s("h2",{id:"_3-2-动静分离",tabindex:"-1"},[l("3.2 动静分离 "),s("a",{class:"header-anchor",href:"#_3-2-动静分离","aria-hidden":"true"},"#")],-1),zs=s("h3",{id:"转发需求-1",tabindex:"-1"},[l("转发需求 "),s("a",{class:"header-anchor",href:"#转发需求-1","aria-hidden":"true"},"#")],-1),Hs=s("p",null,"动态资源转发到php服务器 静态资源转发到静态服务器",-1),Os=s("h3",{id:"配置文件",tabindex:"-1"},[l("配置文件 "),s("a",{class:"header-anchor",href:"#配置文件","aria-hidden":"true"},"#")],-1),Js=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"lb01 "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"etc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"nginx"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# cat ds_proxy.conf ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"lb01 conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"d]"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# cat ds_proxy.conf")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream "),s("span",{style:{color:"#C792EA"}},"static"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"7"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream php "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"8080"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server_name ds"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        root "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        index index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"~"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}},"\\"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD"}},"png"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"jpg"),s("span",{style:{color:"#89DDFF"}},"|"),s("span",{style:{color:"#A6ACCD"}},"gif"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"$ "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//static;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"~"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#A6ACCD"}},"\\"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"php$ "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//php;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),Ws=s("h2",{id:"_3-3-根据客户端转发",tabindex:"-1"},[l("3.3 根据客户端转发 "),s("a",{class:"header-anchor",href:"#_3-3-根据客户端转发","aria-hidden":"true"},"#")],-1),Zs=s("h3",{id:"转发需求-2",tabindex:"-1"},[l("转发需求 "),s("a",{class:"header-anchor",href:"#转发需求-2","aria-hidden":"true"},"#")],-1),Gs=s("p",null,"手机和电脑 访问相同的网站----结果不同",-1),qs=s("h3",{id:"lb服务器配置文件",tabindex:"-1"},[l("lb服务器配置文件 "),s("a",{class:"header-anchor",href:"#lb服务器配置文件","aria-hidden":"true"},"#")],-1),Ks=s("div",{class:"language-php"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"lb01 conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# cat sj.conf    ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream iphone "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"172"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"16"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"7"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"9091"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream android "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"172"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"16"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"7"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"9090"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"upstream pc "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server "),s("span",{style:{color:"#F78C6C"}},"172"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"16"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F78C6C"}},"7"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"9092"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"80"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    server_name sj"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"com"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"        "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#默认跳转至 pc 站点")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//pc;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"include"),s("span",{style:{color:"#A6ACCD"}}," proxy_params"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"        "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#如果客户端是 Iphone 则跳转到 iphone 的资源池")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"($"),s("span",{style:{color:"#A6ACCD"}},"http_user_agent "),s("span",{style:{color:"#89DDFF"}},"~*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Iphone"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//iphone;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"}"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"        "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#如果客户端是 Android 则跳转到 android 的资源池")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"($"),s("span",{style:{color:"#A6ACCD"}},"http_user_agent "),s("span",{style:{color:"#89DDFF"}},"~*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Android"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"){")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"            proxy_pass http"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#676E95","font-style":"italic"}},"//android;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"}"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"        "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#如果客户端是 IE 浏览器，则返回 403 错误。")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"($"),s("span",{style:{color:"#A6ACCD"}},"http_user_agent "),s("span",{style:{color:"#89DDFF"}},"~*"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"msie"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"){")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"         "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"403"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"})])])],-1),Qs=s("h3",{id:"web服务器配置",tabindex:"-1"},[l("web服务器配置 "),s("a",{class:"header-anchor",href:"#web服务器配置","aria-hidden":"true"},"#")],-1),Ys=s("div",{class:"language-csharp"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# cat sj"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"conf    ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"9090"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        root "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"android"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        index index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"9091"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        root "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"iphone"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        index index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"server "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    listen "),s("span",{style:{color:"#F78C6C"}},"9092"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    location "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        root "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"pc"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        index index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# mkdir "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"p "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/{"),s("span",{style:{color:"#A6ACCD"}},"android,iphone,pc"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# echo "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"PC"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"pc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# echo "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Iphone"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"iphone"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# echo "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Android"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},">"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"code"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"android"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"index"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#A6ACCD"}},"html")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"root@web01"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"conf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},"# systemctl restart nginx")]),l(`
`),s("span",{class:"line"})])])],-1),sl=s("h3",{id:"访问测试",tabindex:"-1"},[l("访问测试 "),s("a",{class:"header-anchor",href:"#访问测试","aria-hidden":"true"},"#")],-1),ll=s("div",{class:"language-css"},[s("span",{class:"copy"}),s("pre",null,[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@lb01 conf."),s("span",{style:{color:"#C792EA"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},'# curl -A "chrome" sj'),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"com")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"PC")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@lb01 conf."),s("span",{style:{color:"#C792EA"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},'# curl -A "iphone" sj'),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"com"),s("span",{style:{color:"#A6ACCD"}},"      ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Iphone")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"root@lb01 conf."),s("span",{style:{color:"#C792EA"}},"d"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}},'# curl -A "android" sj'),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"oldboy"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"com"),s("span",{style:{color:"#A6ACCD"}},"      ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"Android  ")]),l(`
`),s("span",{class:"line"})])])],-1);function ol(n,nl,el,al,t,tl){const c=p;return F(),y(c,{frontmatter:t.frontmatter,data:t.data},{"main-content-md":o(()=>[C,A,d,h,_,g,u,x,m,f,B,b,v,w,k,E,N,$,j,S,V,M,P,I,L,U,R,T,X,z,H,O,J,W,Z,G,q,K,Q,Y,ss,ls,os,ns,es,as,ts,cs,ps,rs,Ds,ys,Fs,is,Cs,As,ds,hs,_s,gs,us,xs,ms,fs,Bs,bs,vs,ws,ks,Es,Ns,$s,js,Ss,Vs,Ms,Ps,Is,Ls,Us,Rs,Ts,Xs,zs,Hs,Os,Js,Ws,Zs,Gs,qs,Ks,Qs,Ys,sl,ll]),"main-header":o(()=>[e(n.$slots,"main-header")]),"main-header-after":o(()=>[e(n.$slots,"main-header-after")]),"main-nav":o(()=>[e(n.$slots,"main-nav")]),"main-content":o(()=>[e(n.$slots,"main-content")]),"main-content-after":o(()=>[e(n.$slots,"main-content-after")]),"main-nav-before":o(()=>[e(n.$slots,"main-nav-before")]),"main-nav-after":o(()=>[e(n.$slots,"main-nav-after")]),comment:o(()=>[e(n.$slots,"comment")]),footer:o(()=>[e(n.$slots,"footer")]),aside:o(()=>[e(n.$slots,"aside")]),"aside-custom":o(()=>[e(n.$slots,"aside-custom")]),default:o(()=>[e(n.$slots,"default")]),_:3},8,["frontmatter","data"])}const il=r(i,[["render",ol],["__file","/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Nginx反向代理负载均衡.md"]]);export{Fl as __pageData,il as default};
