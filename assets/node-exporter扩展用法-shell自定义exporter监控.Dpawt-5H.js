import{_ as u}from"./ValaxyMain.vue_vue_type_style_index_0_lang.gfo-rUCP.js";import"./chunks/@vueuse/motion.BITvz5PP.js";import{e as k,u as m,a as g}from"./chunks/vue-router.DQHxU7r6.js";import{aa as b,ap as a,ag as t,af as e,ai as s,P as y,ab as _,a1 as f}from"./framework.GHZxz7jq.js";import"./index.CFgbcban.js";import"./chunks/dayjs.BldX5ftQ.js";import"./chunks/vue-i18n.C7V8WoQZ.js";import"./chunks/pinia.BfAlK2F6.js";import"./chunks/nprogress.BZwbcB2O.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.CU_FKKcY.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.fblE3Fel.js";import"./post.zk_xPNhE.js";const F=k("/posts/node-exporter扩展用法-shell自定义exporter监控",async n=>JSON.parse('{"title":"node-exporter扩展用法-shell自定义exporter监控","description":"","frontmatter":{"title":"node-exporter扩展用法-shell自定义exporter监控","categories":"Prometheus","tags":["自定义exporter"],"date":"2019-11-20 11:08:00"},"headers":[],"relativePath":"pages/posts/node-exporter扩展用法-shell自定义exporter监控.md","lastUpdated":null}'),{lazy:(n,o)=>n.name===o.name}),q={__name:"node-exporter扩展用法-shell自定义exporter监控",setup(n,{expose:o}){const{data:i}=F(),c=g(),d=m(),r=Object.assign(d.meta.frontmatter||{},i.value?.frontmatter||{});return c.currentRoute.value.data=i.value,f("valaxy:frontmatter",r),globalThis.$frontmatter=r,o({frontmatter:{title:"node-exporter扩展用法-shell自定义exporter监控",categories:"Prometheus",tags:["自定义exporter"],date:"2019-11-20 11:08:00"}}),(l,p)=>{const h=u;return _(),b(h,{frontmatter:y(r)},{"main-content-md":a(()=>[...p[0]||(p[0]=[e("blockquote",null,[e("p",null,"当Prometheus的node_exporter中没有我们需要的一些监控项时，就可以使用自定义exporter的扩展功能，但是对于那些开发能力稍微弱一些的朋友（特指我），如果你会shell脚本的编写，最基础的awk语法，那么你也可以进行自定义exporter，这就需要借助Node-exporter实现了。")],-1),e("p",null,[s("*"),e("em",null,[s("node_exporter 可在启动时指定路径，并将该路径下的 "),e("em",null,".prom 识别为监控数据文件。")])],-1),e("h2",{id:"添加取值脚本",tabindex:"-1"},[s("添加取值脚本 "),e("a",{class:"header-anchor",href:"#添加取值脚本","aria-label":'Permalink to "添加取值脚本"'},"​")],-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"[root@one tmp]# cat /data/exporter/key/key_runner ")]),s(`
`),e("span",{class:"line"},[e("span",null,"#! /bin/bash")]),s(`
`),e("span",{class:"line"},[e("span")]),s(`
`),e("span",{class:"line"},[e("span",null,'echo Logical_CPU_core_total  `cat /proc/cpuinfo| grep "processor"| wc -l`')]),s(`
`),e("span",{class:"line"},[e("span",null,"echo logined_users_total     `who | wc -l`;")]),s(`
`),e("span",{class:"line"},[e("span",null,"echo procs_total `ps aux|wc -l`")]),s(`
`),e("span",{class:"line"},[e("span",null,"echo procs_zombie       `ps axo pid=,stat=|grep Z|wc -l`")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("p",null,"执行效果",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"[root@one key]# bash  key_runner")]),s(`
`),e("span",{class:"line"},[e("span",null,"Logical_CPU_core_total 2")]),s(`
`),e("span",{class:"line"},[e("span",null,"logined_users_total 1")]),s(`
`),e("span",{class:"line"},[e("span",null,"procs_total 148")]),s(`
`),e("span",{class:"line"},[e("span",null,"procs_zombie 0")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"设置定时任务",tabindex:"-1"},[s("设置定时任务 "),e("a",{class:"header-anchor",href:"#设置定时任务","aria-label":'Permalink to "设置定时任务"'},"​")],-1),e("blockquote",null,[e("p",null,"每分钟执行一次")],-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"* * * * * bash /usr/local/node_exporter/key/key_runner > /usr/local/node_exporter/key/key.prom")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"添加启动参数",tabindex:"-1"},[s("添加启动参数 "),e("a",{class:"header-anchor",href:"#添加启动参数","aria-label":'Permalink to "添加启动参数"'},"​")],-1),e("p",null,"启动node_exporter，指定新加key值的prom路径",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"./node_exporter --collector.textfile.directory=/usr/local/node_exporter-0.16/key")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("p",null,"如果你是Docker启动，请考虑使用下面这条命令.",-1),e("div",{class:"language-bash"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"bash"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"docker"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   --net="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"host"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   --pid="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"host"'),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   --name=node-exporter"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   -v"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "/:/host:ro"'),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  quay.io/prometheus/node-exporter"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   --path.rootfs"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /host"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  --collector.textfile.directory=/host/data/exporter/key/")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"验证",tabindex:"-1"},[s("验证 "),e("a",{class:"header-anchor",href:"#验证","aria-label":'Permalink to "验证"'},"​")],-1),e("p",null,"查看metrics值是否新增了该监控项",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,'[root@one key]# curl 127.0.0.1:9100/metrics|grep -E "Logical_CPU_core_total|logined_users_total|procs_total|procs_zombie"')]),s(`
`),e("span",{class:"line"},[e("span",null,"# TYPE Logical_CPU_core_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",null,"Logical_CPU_core_total 2")]),s(`
`),e("span",{class:"line"},[e("span",null,"# HELP logined_users_total Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",null,"# TYPE logined_users_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",null,"logined_users_total 1")]),s(`
`),e("span",{class:"line"},[e("span",null,"# HELP procs_total Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",null,"# TYPE procs_total untyped")]),s(`
`),e("span",{class:"line"},[e("span",null,"procs_total 151")]),s(`
`),e("span",{class:"line"},[e("span",null,"# HELP procs_zombie Metric read from /usr/local/node_exporter/key/key.prom")]),s(`
`),e("span",{class:"line"},[e("span",null,"# TYPE procs_zombie untyped")]),s(`
`),e("span",{class:"line"},[e("span",null,"procs_zombie 0")])])]),e("button",{class:"code-block-unfold-btn"})],-1)])]),"main-header":a(()=>[t(l.$slots,"main-header")]),"main-header-after":a(()=>[t(l.$slots,"main-header-after")]),"main-nav":a(()=>[t(l.$slots,"main-nav")]),"main-content-before":a(()=>[t(l.$slots,"main-content-before")]),"main-content":a(()=>[t(l.$slots,"main-content")]),"main-content-after":a(()=>[t(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[t(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[t(l.$slots,"main-nav-after")]),comment:a(()=>[t(l.$slots,"comment")]),footer:a(()=>[t(l.$slots,"footer")]),aside:a(()=>[t(l.$slots,"aside")]),"aside-custom":a(()=>[t(l.$slots,"aside-custom")]),default:a(()=>[t(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{q as default,F as usePageData};
