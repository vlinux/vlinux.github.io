import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-1512d120.js";import{_ as C,c as y,w as e,o as d,b as s,U as l,q as o,r as t,W as g,p as _}from"./app-a02e75c2.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-bc33d52c.js";import"./YunCard.vue_vue_type_style_index_0_lang-e0de3339.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-722c3092.js";const Hs=JSON.parse('{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","description":"","frontmatter":{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","categories":"监控分析","tags":["Loki"],"date":"2021-06-30T14:55:35.000Z"},"headers":[{"level":2,"title":"Ngin添加GeoIP模块","slug":"ngin添加geoip模块","link":"#ngin添加geoip模块","children":[]},{"level":2,"title":"1.1 停止现有Nginx","slug":"_1-1-停止现有nginx","link":"#_1-1-停止现有nginx","children":[]},{"level":2,"title":"1.2 带GeoIP重新编译Nginx","slug":"_1-2-带geoip重新编译nginx","link":"#_1-2-带geoip重新编译nginx","children":[{"level":3,"title":"1.2.1 下载GeoIP依赖","slug":"_1-2-1-下载geoip依赖","link":"#_1-2-1-下载geoip依赖","children":[]},{"level":3,"title":"1.2.2 进入nginx/sbin目录查看现有nginx模块依赖","slug":"_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","link":"#_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","children":[]},{"level":3,"title":"1.2.3 添加geoip模块重新编译","slug":"_1-2-3-添加geoip模块重新编译","link":"#_1-2-3-添加geoip模块重新编译","children":[]},{"level":3,"title":"1.2.4 执行命令，查看geoip是否编译成功","slug":"_1-2-4-执行命令，查看geoip是否编译成功","link":"#_1-2-4-执行命令，查看geoip是否编译成功","children":[]}]},{"level":2,"title":"1.3. 查看GeoIP.dat位置","slug":"_1-3-查看geoip-dat位置","link":"#_1-3-查看geoip-dat位置","children":[]},{"level":2,"title":"1.4. 修改nginx配置文件","slug":"_1-4-修改nginx配置文件","link":"#_1-4-修改nginx配置文件","children":[]},{"level":2,"title":"1.5. 重启nginx","slug":"_1-5-重启nginx","link":"#_1-5-重启nginx","children":[]},{"level":2,"title":"1.6. 查看大图","slug":"_1-6-查看大图","link":"#_1-6-查看大图","children":[]},{"level":2,"title":"1.7. 监控日志支持正则匹配","slug":"_1-7-监控日志支持正则匹配","link":"#_1-7-监控日志支持正则匹配","children":[]}],"relativePath":"pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","lastUpdated":1671090556000}'),r=JSON.parse('{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","description":"","frontmatter":{"title":"Docker搭建Nginx日志高级监控-基于Loki + Promtail + Grafana","categories":"监控分析","tags":["Loki"],"date":"2021-06-30T14:55:35.000Z"},"headers":[{"level":2,"title":"Ngin添加GeoIP模块","slug":"ngin添加geoip模块","link":"#ngin添加geoip模块","children":[]},{"level":2,"title":"1.1 停止现有Nginx","slug":"_1-1-停止现有nginx","link":"#_1-1-停止现有nginx","children":[]},{"level":2,"title":"1.2 带GeoIP重新编译Nginx","slug":"_1-2-带geoip重新编译nginx","link":"#_1-2-带geoip重新编译nginx","children":[{"level":3,"title":"1.2.1 下载GeoIP依赖","slug":"_1-2-1-下载geoip依赖","link":"#_1-2-1-下载geoip依赖","children":[]},{"level":3,"title":"1.2.2 进入nginx/sbin目录查看现有nginx模块依赖","slug":"_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","link":"#_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","children":[]},{"level":3,"title":"1.2.3 添加geoip模块重新编译","slug":"_1-2-3-添加geoip模块重新编译","link":"#_1-2-3-添加geoip模块重新编译","children":[]},{"level":3,"title":"1.2.4 执行命令，查看geoip是否编译成功","slug":"_1-2-4-执行命令，查看geoip是否编译成功","link":"#_1-2-4-执行命令，查看geoip是否编译成功","children":[]}]},{"level":2,"title":"1.3. 查看GeoIP.dat位置","slug":"_1-3-查看geoip-dat位置","link":"#_1-3-查看geoip-dat位置","children":[]},{"level":2,"title":"1.4. 修改nginx配置文件","slug":"_1-4-修改nginx配置文件","link":"#_1-4-修改nginx配置文件","children":[]},{"level":2,"title":"1.5. 重启nginx","slug":"_1-5-重启nginx","link":"#_1-5-重启nginx","children":[]},{"level":2,"title":"1.6. 查看大图","slug":"_1-6-查看大图","link":"#_1-6-查看大图","children":[]},{"level":2,"title":"1.7. 监控日志支持正则匹配","slug":"_1-7-监控日志支持正则匹配","link":"#_1-7-监控日志支持正则匹配","children":[]}],"relativePath":"pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md","lastUpdated":1671090556000}'),h={name:"pages/posts/Docker搭建Nginx日志高级监控-基于Loki-+-Promtail-+-Grafana.md",data(){return{data:r,frontmatter:r.frontmatter}},setup(){_("pageData",r)}},A={id:"手把手搭建nginx日志高级监控-——-基于loki-promtail-grafana",tabindex:"-1"},D=s("p",null,"参考官方文档：",-1),u=s("p",null,"日志收集效果截图：",-1),m=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/12345678.png",alt:"12345678"})],-1),F=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/23456.png",alt:"23456"})],-1),f={id:"_1-loki-promtail简介",tabindex:"-1"},x=s("p",null,"官网有说明。",-1),k=s("p",null,"简单理解，",-1),b=s("p",null,"Loki是个日志监控系统，可用来分析日志，并提供给Grafana进行图形化展示。",-1),E=s("p",null,"Promtail是个日志转发的代理，用于给Loki提供日志数据的。",-1),v={id:"_2-loki-promtail下载并安装启动",tabindex:"-1"},B=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"wget"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://github.com/grafana/loki/blob/main/cmd/loki/loki-local-config.yaml"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-O"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"loki-config.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"run"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--name"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"loki"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"$("),s("span",{style:{color:"#82AAFF"}},"pwd"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}},":/mnt/config"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-p"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"3100"),s("span",{style:{color:"#C3E88D"}},":"),s("span",{style:{color:"#F78C6C"}},"3100"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"grafana/loki:2.1.0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-config.file=/mnt/config/loki-config.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"wget"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"https://github.com/grafana/loki/blob/main/clients/cmd/promtail/promtail-docker-config.yaml"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-O"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail-config.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"run"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--name"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"$("),s("span",{style:{color:"#82AAFF"}},"pwd"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#C3E88D"}},":/mnt/config"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-v"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/nginx/logs:/usr/local/nginx/logs"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"grafana/promtail:2.1.0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-config.file=/mnt/config/promtail-config.yaml")]),l(`
`),s("span",{class:"line"})])])],-1),w=s("blockquote",null,[s("p",null,"脚本来自官网，容器启动后先停止，然后修改配置文件")],-1),$={id:"_3-修改nginx配置",tabindex:"-1"},P=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"log_format json_analytics '{'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                            '"msec": "$msec", ' # request unixtime in seconds with a milliseconds resolution`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                            '"connection": "$connection", ' # connection serial number`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                            '"connection_requests": "$connection_requests", ' # number of requests made in connection`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"pid": "$pid", ' # process pid`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_id": "$request_id", ' # the unique request id`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_length": "$request_length", ' # request length (including headers and body)`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"remote_addr": "$remote_addr", ' # client IP`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"remote_user": "$remote_user", ' # client HTTP username`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"remote_port": "$remote_port", ' # client port`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"time_local": "$time_local", '`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"time_iso8601": "$time_iso8601", ' # local time in the ISO 8601 standard format`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request": "$request", ' # full path no arguments if the request`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_uri": "$request_uri", ' # full path and arguments if the request`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"args": "$args", ' # args`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"status": "$status", ' # response status code`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"body_bytes_sent": "$body_bytes_sent", ' # the number of body bytes exclude headers sent to a client`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"bytes_sent": "$bytes_sent", ' # the number of bytes sent to a client`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_referer": "$http_referer", ' # HTTP referer`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_user_agent": "$http_user_agent", ' # user agent`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_x_forwarded_for": "$http_x_forwarded_for", ' # http_x_forwarded_for`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_host": "$http_host", ' # the request Host: header`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"server_name": "$server_name", ' # the name of the vhost serving the request`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_time": "$request_time", ' # request processing time in seconds with msec resolution`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream": "$upstream_addr", ' # upstream backend server for proxied requests`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_connect_time": "$upstream_connect_time", ' # upstream handshake time incl. TLS`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_header_time": "$upstream_header_time", ' # time spent receiving upstream headers`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_response_time": "$upstream_response_time", ' # time spend receiving upstream body`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_response_length": "$upstream_response_length", ' # upstream response length`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"upstream_cache_status": "$upstream_cache_status", ' # cache HIT/MISS where applicable`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"ssl_protocol": "$ssl_protocol", ' # TLS protocol`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"ssl_cipher": "$ssl_cipher", ' # TLS cipher`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"scheme": "$scheme", ' # http or https`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"request_method": "$request_method", ' # request method`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"server_protocol": "$server_protocol", ' # request protocol, like HTTP/1.1 or HTTP/2.0`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"pipe": "$pipe", ' # "p" if request was pipelined, "." otherwise`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"gzip_ratio": "$gzip_ratio", '`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},`                    '"http_cf_ray": "$http_cf_ray"'`)]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"                    '}';")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"access_log logs/json_access.log json_analytics;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),q=s("blockquote",null,[s("p",null,"这一步是将Nginx输出的日志文件进行格式化")],-1),G={id:"_4-修改promtail配置",tabindex:"-1"},N=s("div",{class:"language-yaml"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"server"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"http_listen_port"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"grpc_listen_port"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"0")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"positions"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F07178"}},"filename"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/tmp/positions.yaml")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"clients"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"url"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"http://172.17.0.4:3100/loki/api/v1/push"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# Loki日志推送地址")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"scrape_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"job_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"system")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#pipeline_stages:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#- replace:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#    expression: '(?:[0-9]{1,3}\\.){3}([0-9]{1,3})'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"    "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#    replace: '***'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F07178"}},"static_configs"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F07178"}},"targets"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"localhost"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 根据官方文档，这里只能是localhost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#F07178"}},"labels"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"job"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"nginx_access_log")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"agent"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#F07178"}},"__path__"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/nginx/logs/json_access.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"# 需要上传的日志地址。")]),l(`
`),s("span",{class:"line"})])])],-1),I={id:"_5-重启loki-promtail容器",tabindex:"-1"},L=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"restart"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"loki"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"docker"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"restart"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail")]),l(`
`),s("span",{class:"line"})])])],-1),T={id:"_6-配置grafana数据源",tabindex:"-1"},j=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142131.png",alt:"image-20210630142131562"})],-1),S={id:"_7-配置grafana模版",tabindex:"-1"},V=s("p",null,"模版ID：12559",-1),H=s("p",null,"非常装逼，非常热门",-1),O=s("p",null,"导入方法与本博客多篇日志收集Grafana导入方法相同",-1),U=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142256.png",alt:"image-20210630142256248"})],-1),J={id:"_8-查看面板",tabindex:"-1"},z=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142558.png",alt:"image-20210630142558503"})],-1),M=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630142622.png",alt:"image-20210630142622826"})],-1),Z=s("p",null,"插件因素显示不全请自行安装，grafana-cli plugins install *****",-1),K={id:"_9-可查看指标",tabindex:"-1"},W=s("ul",null,[s("li",null,"总请求量"),s("li",null,"状态码 2xx,3xx,5xx请求量"),s("li",null,"流量情况"),s("li",null,"请求明细"),s("li",null,"百分之95请求响应时间"),s("li",null,"最大请求IP"),s("li",null,"最大请求路径")],-1),Q={id:"_10-国家面板",tabindex:"-1"},R=s("p",null,"Country面板无数据，是因为Grafana没有地图面板插件，且Nginx默认没有开启国家城市过滤。",-1),X=s("p",null,[s("strong",null,"文章最下面进行操作")],-1),Y={id:"_11-资源消耗",tabindex:"-1"},ss=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630143102.png",alt:"image-20210630143102322"})],-1),ls=s("p",null,"就这资源消耗，还要啥自行车？要啥ELK？",-1),es=s("hr",null,null,-1),ns={id:"ngin添加geoip模块",tabindex:"-1"},os={id:"_1-1-停止现有nginx",tabindex:"-1"},as=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"/nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-s"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"stop")]),l(`
`),s("span",{class:"line"})])])],-1),ts={id:"_1-2-带geoip重新编译nginx",tabindex:"-1"},rs={id:"_1-2-1-下载geoip依赖",tabindex:"-1"},is=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"sudo"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"apt"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"install"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"libgeoip1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"libgeoip-dev"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"geoip-bin")]),l(`
`),s("span",{class:"line"})])])],-1),cs=s("p",null,"github文档如下",-1),ps=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630143344.png",alt:"img"})],-1),Cs={id:"_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖",tabindex:"-1"},ys=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"/nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-V")]),l(`
`),s("span",{class:"line"})])])],-1),ds=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630143504.png",alt:"image-20210630143504540"})],-1),gs=s("p",null,"如上图，将红线位置拷贝，用于添加模块重新编译",-1),_s={id:"_1-2-3-添加geoip模块重新编译",tabindex:"-1"},hs=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"."),s("span",{style:{color:"#FFCB6B"}},"/configure"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--prefix=/usr/local/nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_gzip_static_module"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_stub_status_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_ssl_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-pcre"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-file-aio"),s("span",{style:{color:"#A6ACCD"}}," \\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_realip_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--with-http_geoip_module"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"--add-module=/usr/local/nginx-module-vts-master")]),l(`
`),s("span",{class:"line"})])])],-1),As=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"make"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"&&"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"make"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"install"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),Ds={id:"_1-2-4-执行命令，查看geoip是否编译成功",tabindex:"-1"},us=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"nginx -V")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),ms=s("p",null,"带 --with-http_geoip_module 即编译成功",-1),Fs={id:"_1-3-查看geoip-dat位置",tabindex:"-1"},fs=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/local/nginx/sbin"),s("span",{style:{color:"#A6ACCD"}},"# whereis GeoIP")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"GeoIP:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/include/GeoIP.h"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/share/GeoIP")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/share/GeoIP"),s("span",{style:{color:"#A6ACCD"}},"# ls -al")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"total"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"10012")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"drwxr-xr-x"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F78C6C"}},"4096"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Feb"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"17"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"22"),s("span",{style:{color:"#C3E88D"}},":"),s("span",{style:{color:"#F78C6C"}},"14"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},".")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"drwxr-xr-x"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"121"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#F78C6C"}},"4096"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Feb"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"17"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"22"),s("span",{style:{color:"#C3E88D"}},":"),s("span",{style:{color:"#F78C6C"}},"14"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"..")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"-rw-r--r--"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"2099217"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Jan"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"23"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F78C6C"}},"2020"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"GeoIP.dat")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"-rw-r--r--"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"root"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"8138841"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"Jan"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"23"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#F78C6C"}},"2020"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"GeoIPv6.dat")]),l(`
`),s("span",{class:"line"})])])],-1),xs={id:"_1-4-修改nginx配置文件",tabindex:"-1"},ks=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"# 添加国家模块配置")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"geoip_country"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/share/GeoIP/GeoIP.dat"),s("span",{style:{color:"#89DDFF"}},";")]),l(`
`),s("span",{class:"line"})])])],-1),bs={id:"_1-5-重启nginx",tabindex:"-1"},Es=s("div",{class:"language-shell"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"nginx"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"-s"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"reload"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"})])])],-1),vs={id:"_1-6-查看大图",tabindex:"-1"},Bs=s("p",null,[s("img",{src:"https://vlinux-1259060227.cos.ap-shanghai.myqcloud.com/www-vlinux-cn-blog-img/gitee-backup/img-master/image/20210630144706.png",alt:"img"})],-1),ws={id:"_1-7-监控日志支持正则匹配",tabindex:"-1"},$s=s("div",{class:"language-bash"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/local/nginx/logs"),s("span",{style:{color:"#A6ACCD"}},"# ls")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"access.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"error.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"json_access.log"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"json_access.log."),s("span",{style:{color:"#F78C6C"}},"2021"),s("span",{style:{color:"#C3E88D"}},"-"),s("span",{style:{color:"#F78C6C"}},"02"),s("span",{style:{color:"#C3E88D"}},"-"),s("span",{style:{color:"#F78C6C"}},"17"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#C3E88D"}},"nginx.pid")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"root@daicytest01:/usr/local/loki+promtail"),s("span",{style:{color:"#A6ACCD"}},"# vim promtail-config.yaml  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#FFCB6B"}},"static_configs:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"      "),s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"targets:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"localhost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"        "),s("span",{style:{color:"#FFCB6B"}},"labels:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"job:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"nginx_access_log")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"agent:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"promtail")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"          "),s("span",{style:{color:"#FFCB6B"}},"__path__:"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C3E88D"}},"/usr/local/nginx/logs/"),s("span",{style:{color:"#A6ACCD"}},"*"),s("span",{style:{color:"#C3E88D"}},"json_access.log"),s("span",{style:{color:"#A6ACCD"}},"*")]),l(`
`),s("span",{class:"line"})])])],-1);function Ps(a,qs,Gs,Ns,i,Is){const n=g,c=p;return d(),y(c,{frontmatter:i.frontmatter,data:i.data},{"main-content-md":e(()=>[s("h1",A,[l("手把手搭建Nginx日志高级监控 —— 基于Loki + Promtail + Grafana "),o(n,{class:"header-anchor",href:"#手把手搭建nginx日志高级监控-——-基于loki-promtail-grafana","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),s("blockquote",null,[D,s("p",null,[l("Loki: "),o(n,{href:"https://grafana.com/docs/loki/latest/",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://grafana.com/docs/loki/latest/")]),_:1})]),s("p",null,[l("Grafana Loki V2 Dashboard for Nginx "),o(n,{href:"https://grafana.com/grafana/dashboards/12559?pg=dashboards&plcmt=featured-main",target:"_blank",rel:"noreferrer"},{default:e(()=>[l("https://grafana.com/grafana/dashboards/12559?pg=dashboards&plcmt=featured-main")]),_:1})])]),u,m,F,s("h1",f,[l("1. Loki + Promtail简介 "),o(n,{class:"header-anchor",href:"#_1-loki-promtail简介","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),x,k,b,E,s("h1",v,[l("2. Loki + Promtail下载并安装启动 "),o(n,{class:"header-anchor",href:"#_2-loki-promtail下载并安装启动","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),B,w,s("h1",$,[l("3. 修改Nginx配置 "),o(n,{class:"header-anchor",href:"#_3-修改nginx配置","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),P,q,s("h1",G,[l("4. 修改Promtail配置 "),o(n,{class:"header-anchor",href:"#_4-修改promtail配置","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),N,s("h1",I,[l("5. 重启Loki+Promtail容器 "),o(n,{class:"header-anchor",href:"#_5-重启loki-promtail容器","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),L,s("h1",T,[l("6. 配置Grafana数据源 "),o(n,{class:"header-anchor",href:"#_6-配置grafana数据源","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),j,s("h1",S,[l("7. 配置Grafana模版 "),o(n,{class:"header-anchor",href:"#_7-配置grafana模版","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),V,H,O,U,s("h1",J,[l("8. 查看面板 "),o(n,{class:"header-anchor",href:"#_8-查看面板","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),z,M,Z,s("h1",K,[l("9. 可查看指标 "),o(n,{class:"header-anchor",href:"#_9-可查看指标","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),W,s("h1",Q,[l("10. 国家面板 "),o(n,{class:"header-anchor",href:"#_10-国家面板","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),R,X,s("h1",Y,[l("11. 资源消耗 "),o(n,{class:"header-anchor",href:"#_11-资源消耗","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),ss,ls,es,s("h2",ns,[l("Ngin添加GeoIP模块 "),o(n,{class:"header-anchor",href:"#ngin添加geoip模块","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),s("h2",os,[l("1.1 停止现有Nginx "),o(n,{class:"header-anchor",href:"#_1-1-停止现有nginx","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),as,s("h2",ts,[l("1.2 带GeoIP重新编译Nginx "),o(n,{class:"header-anchor",href:"#_1-2-带geoip重新编译nginx","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),s("h3",rs,[l("1.2.1 下载GeoIP依赖 "),o(n,{class:"header-anchor",href:"#_1-2-1-下载geoip依赖","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),is,cs,ps,s("h3",Cs,[l("1.2.2 进入nginx/sbin目录查看现有nginx模块依赖 "),o(n,{class:"header-anchor",href:"#_1-2-2-进入nginx-sbin目录查看现有nginx模块依赖","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),ys,ds,gs,s("h3",_s,[l("1.2.3 添加geoip模块重新编译 "),o(n,{class:"header-anchor",href:"#_1-2-3-添加geoip模块重新编译","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),hs,As,s("h3",Ds,[l("1.2.4 执行命令，查看geoip是否编译成功 "),o(n,{class:"header-anchor",href:"#_1-2-4-执行命令，查看geoip是否编译成功","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),us,ms,s("h2",Fs,[l("1.3. 查看GeoIP.dat位置 "),o(n,{class:"header-anchor",href:"#_1-3-查看geoip-dat位置","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),fs,s("h2",xs,[l("1.4. 修改nginx配置文件 "),o(n,{class:"header-anchor",href:"#_1-4-修改nginx配置文件","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),ks,s("h2",bs,[l("1.5. 重启nginx "),o(n,{class:"header-anchor",href:"#_1-5-重启nginx","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),Es,s("h2",vs,[l("1.6. 查看大图 "),o(n,{class:"header-anchor",href:"#_1-6-查看大图","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),Bs,s("h2",ws,[l("1.7. 监控日志支持正则匹配 "),o(n,{class:"header-anchor",href:"#_1-7-监控日志支持正则匹配","aria-hidden":"true"},{default:e(()=>[l("#")]),_:1})]),$s]),"main-header":e(()=>[t(a.$slots,"main-header")]),"main-header-after":e(()=>[t(a.$slots,"main-header-after")]),"main-nav":e(()=>[t(a.$slots,"main-nav")]),"main-content":e(()=>[t(a.$slots,"main-content")]),"main-content-after":e(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":e(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":e(()=>[t(a.$slots,"main-nav-after")]),comment:e(()=>[t(a.$slots,"comment")]),footer:e(()=>[t(a.$slots,"footer")]),aside:e(()=>[t(a.$slots,"aside")]),"aside-custom":e(()=>[t(a.$slots,"aside-custom")]),default:e(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter","data"])}const Os=C(h,[["render",Ps]]);export{Hs as __pageData,Os as default};
