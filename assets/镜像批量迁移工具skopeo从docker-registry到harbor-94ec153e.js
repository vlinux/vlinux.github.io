import{_ as c}from"./ValaxyMain-fde20bcc.js";import{_ as i,p,c as d,w as o,o as y,r as a,b as e,R as s}from"./app-73107480.js";import"./YunFooter-091e638c.js";import"./YunCard-a5dab7a4.js";import"./YunPageHeader-0348731d.js";const V=JSON.parse('{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","description":"","frontmatter":{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","categories":"Kubernetes","tags":["skopeo"],"date":"2022-09-20T15:23:00.000Z"},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"获取test该namespace下所有服务镜像","slug":"获取test该namespace下所有服务镜像","link":"#获取test该namespace下所有服务镜像","children":[]},{"level":3,"title":"登录两个镜像仓库","slug":"登录两个镜像仓库","link":"#登录两个镜像仓库","children":[]},{"level":3,"title":"迁移","slug":"迁移","link":"#迁移","children":[]}]}],"relativePath":"pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","lastUpdated":1671090556000}'),t=JSON.parse('{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","description":"","frontmatter":{"title":"镜像批量迁移工具skopeo从docker-registry到harbor","categories":"Kubernetes","tags":["skopeo"],"date":"2022-09-20T15:23:00.000Z"},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"获取test该namespace下所有服务镜像","slug":"获取test该namespace下所有服务镜像","link":"#获取test该namespace下所有服务镜像","children":[]},{"level":3,"title":"登录两个镜像仓库","slug":"登录两个镜像仓库","link":"#登录两个镜像仓库","children":[]},{"level":3,"title":"迁移","slug":"迁移","link":"#迁移","children":[]}]}],"relativePath":"pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md","lastUpdated":1671090556000}'),h={name:"pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md",data(){return{data:t,frontmatter:t.frontmatter}},setup(){p("pageData",t)}},u=e("h2",{id:"背景",tabindex:"-1"},[s("背景 "),e("a",{class:"header-anchor",href:"#背景","aria-hidden":"true"},"#")],-1),C=e("blockquote",null,[e("p",null,[s("docker-registry地址："),e("a",{href:"http://docker-registry.kococ.cn",target:"_blank",rel:"noreferrer"},"docker-registry.kococ.cn")]),e("p",null,[s("新镜像仓库harbor地址："),e("a",{href:"http://harbor.kococ.cn",target:"_blank",rel:"noreferrer"},"harbor.kococ.cn")]),e("p",null,"本例将docker-registry镜像迁移至 harbor")],-1),D=e("h3",{id:"安装",tabindex:"-1"},[s("安装 "),e("a",{class:"header-anchor",href:"#安装","aria-hidden":"true"},"#")],-1),m=e("blockquote",null,[e("p",null,"可以从github项目直接下载使用二进制命令"),e("p",null,"也可以在centos服务器上直接yum安装,需要epel源")],-1),g=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"yum"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-y"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"install"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"skopeo")]),s(`
`),e("span",{class:"line"})])])],-1),k=e("h3",{id:"获取test该namespace下所有服务镜像",tabindex:"-1"},[s("获取test该namespace下所有服务镜像 "),e("a",{class:"header-anchor",href:"#获取test该namespace下所有服务镜像","aria-hidden":"true"},"#")],-1),A=e("blockquote",null,[e("p",null,"这里我的原镜像为docker-registry")],-1),f=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"kubectl"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"get"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"deployment,statefulset,daemonset"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-o"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"custom-columns="),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#C3E88D"}},"NAME:metadata.name,IMAGES:spec.template.spec.containers[*].image"),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"-n"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"test"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},">"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"all-image")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#676E95","font-style":"italic"}},"## 获取到所有image之后将域名去掉只保留除域名外")]),s(`
`),e("span",{class:"line"})])])],-1),b=e("h3",{id:"登录两个镜像仓库",tabindex:"-1"},[s("登录两个镜像仓库 "),e("a",{class:"header-anchor",href:"#登录两个镜像仓库","aria-hidden":"true"},"#")],-1),_=e("div",{class:"language-"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"docker login harbor.kcooc.cn")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"docker login docker-registry.kococ.cn")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}})])])])],-1),F=e("h3",{id:"迁移",tabindex:"-1"},[s("迁移 "),e("a",{class:"header-anchor",href:"#迁移","aria-hidden":"true"},"#")],-1),v=e("div",{class:"language-bash"},[e("span",{class:"copy"}),e("pre",null,[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"cat"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"mv-image.sh")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#676E95","font-style":"italic"}},"#!/bin/bash")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF","font-style":"italic"}},"for"),e("span",{style:{color:"#A6ACCD"}}," i "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"in"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"`"),e("span",{style:{color:"#FFCB6B"}},"cat"),e("span",{style:{color:"#C3E88D"}}," all-image"),e("span",{style:{color:"#89DDFF"}},"`"),e("span",{style:{color:"#89DDFF"}},";"),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"do")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#FFCB6B"}},"skopeo"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"copy"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"docker://docker-registry.kococ.cn/"),e("span",{style:{color:"#89DDFF"}},"${"),e("span",{style:{color:"#A6ACCD"}},"i"),e("span",{style:{color:"#89DDFF"}},"}"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"docker://harbor.kococ.cn/"),e("span",{style:{color:"#89DDFF"}},"${"),e("span",{style:{color:"#A6ACCD"}},"i"),e("span",{style:{color:"#89DDFF"}},"}"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"--authfile"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#C3E88D"}},"/root/.docker/config.json")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF","font-style":"italic"}},"done")]),s(`
`),e("span",{class:"line"})])])],-1);function E(l,$,B,x,n,N){const r=c;return y(),d(r,{frontmatter:n.frontmatter,data:n.data},{"main-content-md":o(()=>[u,C,D,m,g,k,A,f,b,_,F,v]),"main-header":o(()=>[a(l.$slots,"main-header")]),"main-header-after":o(()=>[a(l.$slots,"main-header-after")]),"main-nav":o(()=>[a(l.$slots,"main-nav")]),"main-content":o(()=>[a(l.$slots,"main-content")]),"main-content-after":o(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":o(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":o(()=>[a(l.$slots,"main-nav-after")]),comment:o(()=>[a(l.$slots,"comment")]),footer:o(()=>[a(l.$slots,"footer")]),aside:o(()=>[a(l.$slots,"aside")]),"aside-custom":o(()=>[a(l.$slots,"aside-custom")]),default:o(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter","data"])}const w=i(h,[["render",E],["__file","/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/镜像批量迁移工具skopeo从docker-registry到harbor.md"]]);export{V as __pageData,w as default};
