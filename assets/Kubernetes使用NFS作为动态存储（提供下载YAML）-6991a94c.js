import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-befed7fa.js";import{_ as u,c as d,w as n,o as f,b as s,U as e,q as o,r as a,W as m,p as A}from"./app-d79bb61a.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-8b4b5bea.js";import"./YunCard.vue_vue_type_style_index_0_lang-fed46e2f.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-20b8fbac.js";const R=JSON.parse('{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","description":"","frontmatter":{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","categories":"Kubernetes","tags":["NFS-client"],"date":"2021-01-19T11:30:00.000Z"},"headers":[{"level":2,"title":"一、nfs服务器安装nfs与配置","slug":"一、nfs服务器安装nfs与配置","link":"#一、nfs服务器安装nfs与配置","children":[]},{"level":2,"title":"二、其它客户端服务器安装nfs-utils","slug":"二、其它客户端服务器安装nfs-utils","link":"#二、其它客户端服务器安装nfs-utils","children":[]},{"level":2,"title":"三、部署NFS实现自动创建PV插件：","slug":"三、部署nfs实现自动创建pv插件：","link":"#三、部署nfs实现自动创建pv插件：","children":[]}],"relativePath":"pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","lastUpdated":1671090556000}'),i=JSON.parse('{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","description":"","frontmatter":{"title":"Kubernetes使用NFS作为动态存储（提供下载YAML）","categories":"Kubernetes","tags":["NFS-client"],"date":"2021-01-19T11:30:00.000Z"},"headers":[{"level":2,"title":"一、nfs服务器安装nfs与配置","slug":"一、nfs服务器安装nfs与配置","link":"#一、nfs服务器安装nfs与配置","children":[]},{"level":2,"title":"二、其它客户端服务器安装nfs-utils","slug":"二、其它客户端服务器安装nfs-utils","link":"#二、其它客户端服务器安装nfs-utils","children":[]},{"level":2,"title":"三、部署NFS实现自动创建PV插件：","slug":"三、部署nfs实现自动创建pv插件：","link":"#三、部署nfs实现自动创建pv插件：","children":[]}],"relativePath":"pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","path":"/Users/vlinux/vlinux/blog/valaxy/vlinux.github.io/pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md","lastUpdated":1671090556000}'),h={name:"pages/posts/Kubernetes使用NFS作为动态存储（提供下载YAML）.md",data(){return{data:i,frontmatter:i.frontmatter}},setup(){A("pageData",i)}},C=s("blockquote",null,[s("p",null,"记录一下小实验，以免以后忘记")],-1),y={id:"一、nfs服务器安装nfs与配置",tabindex:"-1"},_=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"yum -y install nfs-utils rpcbind")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"systemctl  start rpcbind.service ")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"systemctl  start nfs")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"#配置")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mkdir /data/nfs -p")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chow nfsnobody.nfsnobody /data/nfs")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cat>>/etc/exports<<EOF")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"/data/nfs 172.16.208.0/20(rw,sync,no_root_squash,no_all_squash)")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"EOF")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"exportfs  -arv")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),g={id:"二、其它客户端服务器安装nfs-utils",tabindex:"-1"},k=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"yum install -y  nfs-utils")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),v={id:"三、部署nfs实现自动创建pv插件：",tabindex:"-1"},b=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"git clone https://github.com/kubernetes-incubator/external-storage")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),D=s("p",null,"上面的Clone下来的仓库由于是官网的所以可能导致内部有些资源是外网资源，无法正常部署跟启动，于是乎博主自己使用科学上网的方式已经把外网资源给PUll下来替换进去了，现在你只需要下载博主提供的就可以了，下载链接在下面@(你懂的)不用谢",-1),N=s("blockquote",null,[s("p",null,"部署流程如下")],-1),S=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"unzip nfs-client.zip")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cd nfs-client/")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl apply -f rbac.yaml # 授权访问apiserver")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl apply -f deployment.yaml # 部署插件，需修改里面NFS服务器地址与共享目录")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl apply -f class.yaml # 创建存储类")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl get cs # 查看存储类")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),F=s("p",null,"当你出现报错",-1),$=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"pod has unbound immediate PersistentVolumeClaims")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),L=s("p",null,"多半是你的k8s版本高于1.20的问题",-1),K=s("p",null,'第一种解决方法 [tip type="danger" title="使用k8s版本高于v1.20.0的注意"] 修改**/etc/kubernetes/manifests/kube-apiserver.yaml** 文件',-1),M=s("p",null,"添加添加**- --feature-gates=RemoveSelfLink=false**",-1),x=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"[root@master ~]# grep -B 5 'feature-gates' /etc/kubernetes/manifests/kube-apiserver.yaml")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --service-account-key-file=/etc/kubernetes/pki/sa.pub")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --service-account-signing-key-file=/etc/kubernetes/pki/sa.key")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --service-cluster-ip-range=10.96.0.0/12")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --tls-cert-file=/etc/kubernetes/pki/apiserver.crt")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    - --feature-gates=RemoveSelfLink=false #添加内容")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1),Y=s("p",null,"[/tip]",-1),w=s("p",null,"第二种解决方法 修改nfs-client的deployment参数：",-1),V=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"kubectl -n kube-system edit deploy <nfs-client-deploy名>")]),e(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}})])])])],-1);function P(l,U,q,z,r,B){const t=m,c=p;return f(),d(c,{frontmatter:r.frontmatter,data:r.data},{"main-content-md":n(()=>[C,s("h2",y,[e("一、nfs服务器安装nfs与配置 "),o(t,{class:"header-anchor",href:"#一、nfs服务器安装nfs与配置","aria-hidden":"true"},{default:n(()=>[e("#")]),_:1})]),_,s("h2",g,[e("二、其它客户端服务器安装nfs-utils "),o(t,{class:"header-anchor",href:"#二、其它客户端服务器安装nfs-utils","aria-hidden":"true"},{default:n(()=>[e("#")]),_:1})]),k,s("h2",v,[e("三、部署NFS实现自动创建PV插件： "),o(t,{class:"header-anchor",href:"#三、部署nfs实现自动创建pv插件：","aria-hidden":"true"},{default:n(()=>[e("#")]),_:1})]),b,D,s("p",null,[e('[file href="'),o(t,{href:"https://wwa.lanzoui.com/i2mohkkammj",target:"_blank",rel:"noreferrer"},{default:n(()=>[e("https://wwa.lanzoui.com/i2mohkkammj")]),_:1}),e('"]NFS动态存储类[/file]')]),N,S,F,$,L,K,M,x,Y,w,V,s("p",null,[e("将其中的.spec.template.spec.containers[0].image参数修改为："),o(t,{href:"http://k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2",target:"_blank",rel:"noreferrer"},{default:n(()=>[e("k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2")]),_:1}),e(" 等待nfs-client pod启动即可。")])]),"main-header":n(()=>[a(l.$slots,"main-header")]),"main-header-after":n(()=>[a(l.$slots,"main-header-after")]),"main-nav":n(()=>[a(l.$slots,"main-nav")]),"main-content":n(()=>[a(l.$slots,"main-content")]),"main-content-after":n(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":n(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":n(()=>[a(l.$slots,"main-nav-after")]),comment:n(()=>[a(l.$slots,"comment")]),footer:n(()=>[a(l.$slots,"footer")]),aside:n(()=>[a(l.$slots,"aside")]),"aside-custom":n(()=>[a(l.$slots,"aside-custom")]),default:n(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter","data"])}const Z=u(h,[["render",P]]);export{R as __pageData,Z as default};
